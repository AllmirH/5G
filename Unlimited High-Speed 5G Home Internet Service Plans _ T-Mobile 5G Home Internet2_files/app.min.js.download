function encrypt(publicKey,data,encrypted,error){function stringToArrayBuffer(str){for(var buf=new ArrayBuffer(str.length),bufView=new Uint8Array(buf),i=0,strLen=str.length;strLen>i;i++)bufView[i]=str.charCodeAt(i);return buf}function arrayBufferToHex(arrayBuffer){return Array.prototype.map.call(new Uint8Array(arrayBuffer),function(x){return("00"+x.toString(16)).slice(-2)}).join("")}function encryptUsingRSAOAEPforIE11(publicKey,data,encrypted,error){var publicKeyBuffer=stringToArrayBuffer(JSON.stringify(publicKey)),dataBuffer=stringToArrayBuffer(data),tmoCrypto=window.msCrypto;void 0===tmoCrypto&&error('ERROR while getting javascript object "window.msCrypto" is undefined.');var publicKeyOperation=tmoCrypto.subtle.importKey("jwk",publicKeyBuffer,{name:"RSA-OAEP",hash:{name:"SHA-256"}},!1,["encrypt"]);publicKeyOperation.addEventListener("complete",function(){var encryptOperation=tmoCrypto.subtle.encrypt({name:"RSA-OAEP",hash:{name:"SHA-256"}},publicKeyOperation.result,dataBuffer);encryptOperation.addEventListener("complete",function(){encrypted(arrayBufferToHex(encryptOperation.result))},!0),encryptOperation.addEventListener("error",function(){error(encryptOperation.result)},!0)},!0),publicKeyOperation.addEventListener("error",function(){error(publicKeyOperation.result)},!0)}function encryptUsingRSAOAEP(publicKey,data,encrypted,error){void 0===window&&error('ERROR in javascript object "window" is undefined');var tmoCrypto=window.crypto||window.msCrypto;void 0===tmoCrypto&&error('ERROR while getting javascript object. If using microsoft browser then "window.msCrypto" is undefined. If using any other browser then "window.crypto" is undefined'),tmoCrypto.subtle=tmoCrypto.subtle||tmoCrypto.webkitSubtle,void 0===tmoCrypto.subtle&&error('ERROR while getting javascript object.\n 1. If using microsoft browser then "window.msCrypto.subtle" is undefined.\n 2. If using Safari browser then "window.crypto.webkitSubtle" is undefined.\n 3. If using any other browser then "window.crypto.subtle" is undefined'),tmoCrypto.webkitSubtle&&(publicKey=stringToArrayBuffer(JSON.stringify(publicKey))),tmoCrypto.subtle.importKey("jwk",publicKey,{name:"RSA-OAEP",hash:{name:"SHA-256"}},!1,["encrypt"]).then(function(publicKey){tmoCrypto.subtle.encrypt({name:"RSA-OAEP",hash:{name:"SHA-256"}},publicKey,stringToArrayBuffer(data)).then(function(encryptedDataBuffer){encrypted(arrayBufferToHex(encryptedDataBuffer))})["catch"](function(err){error(err)})})["catch"](function(err){error(err)})}var encryptedData;try{return window&&window.navigator&&window.navigator.userAgent?encryptedData=window.navigator.userAgent.indexOf("Trident/7.0")>0?encryptUsingRSAOAEPforIE11(publicKey,data,function(encryptedData){return encrypted(encryptedData)},function(errorData){return error(errorData)}):encryptUsingRSAOAEP(publicKey,data,function(encryptedData){return encrypted(encryptedData)},function(errorData){return error(errorData)}):error("ERROR in javascript object window or window.navigator or window.navigator.userAgent is undefined"),encryptedData}catch(exception){error(exception)}}!function(_){function methodIsAllowed(methodName){return window.__karma__?!1:window.loggingMethods?_.includes(window.loggingMethods,methodName):_.includes(["loading","info","debug","log","warn","error"],methodName)}function setAllowedMethods(methods){window.loggingMethods?(window.loggingMethods.length=0,_.forEach(methods,function(method){window.loggingMethods.push(method)})):window.loggingMethods=methods}function enableLoggingMethod(method){_.includes(window.loggingMethods,method)||window.loggingMethods.push(method)}function disableLoggingMethod(method){_.remove(window.loggingMethods,method)}function info(){methodIsAllowed("info")&&console.info.apply(console,Array.prototype.slice.call(arguments,0))}function debug(){methodIsAllowed("debug")&&console.debug.apply(console,Array.prototype.slice.call(arguments,0))}function log(){methodIsAllowed("log")&&console.log.apply(console,Array.prototype.slice.call(arguments,0))}function warn(){methodIsAllowed("warn")&&console.warn.apply(console,Array.prototype.slice.call(arguments,0))}function error(){methodIsAllowed("error")&&console.error.apply(console,Array.prototype.slice.call(arguments,0))}function moduleRegistered(moduleName,fileName){methodIsAllowed("loading")&&console.info("%c -- module(%s,[...]) -- %s",css.boldWhiteOnBlue,moduleName,fileName)}function moduleConfigured(moduleName,fileName){methodIsAllowed("loading")&&console.info("%c -- module(%s).config() -- %s  ",css.boldPurpleOnGreen,moduleName,fileName)}function moduleInitialized(moduleName){methodIsAllowed("loading")&&console.info('%c -- Module Initialized -- "%s"  ',css.boldGreyOnYellow,moduleName)}function moduleLoaded(moduleName,fileName){methodIsAllowed("loading")&&console.info('%c -- Module Loaded :: "%s" -- "%s" ',css.boldPurpleOnGreen,moduleName,fileName)}function moduleRun(moduleName,fileName){methodIsAllowed("loading")&&console.info('%c -- module(%s).run() -- "%s"  ',css.boldGreyOnYellow,moduleName,fileName)}function routeInitialized(name){methodIsAllowed("loading")&&console.info('%c -- Route Initialized -- "%s"  ',css.boldGreyOnYellow,name)}var css={};css.colors={lightGreen:"#C9FFDC;",lightPurple:"#969AFF;",lightYellow:"#F6FFBD;",lightOrange:"#ffcc66;",lightBlue:"#3399ff;",darkGreen:"darkGreen",grey:"#AAAAAA;",black:"#000000;",white:"#FFFFFF;",red:"#CC0000;",blue:"#00CC00;"},css.font={heavy:"font-weight:600;",bold:"font-weight:600;",purple:"color:"+css.colors.lightPurple,black:"color:"+css.colors.black,white:"color:"+css.colors.white,red:"color:"+css.colors.red,blue:"color:"+css.colors.blue,grey:"color:"+css.colors.grey},css.bg={lightYellow:"background-color:"+css.colors.lightYellow,lightGreen:"background-color:"+css.colors.lightGreen,lightOrange:"background-color:"+css.colors.lightOrange,lightBlue:"background-color:"+css.colors.lightBlue,lightPurple:"background-color:"+css.colors.lightPurple,darkGreen:"background-color:"+css.colors.darkGreen},css.boldGreyOnYellow=css.font.bold+css.font.grey+css.bg.lightYellow,css.boldPurpleOnGreen=css.font.bold+css.font.purple+css.bg.lightGreen,css.boldBlackOnGreen=css.font.bold+css.font.black+css.bg.lightGreen,css.boldBlackOnOrange=css.font.bold+css.font.black+css.bg.lightOrange,css.boldBlackOnBlue=css.font.bold+css.font.black+css.bg.lightBlue,css.boldWhiteOnBlue=css.font.bold+css.font.white+css.bg.lightBlue,css.boldWhiteOnDarkGreen=css.font.bold+css.font.white+css.bg.darkGreen,css.boldRedOnYellow=css.font.bold+css.font.red+css.bg.lightYellow,window.externalLogger={info:info,debug:debug,log:log,warn:warn,error:error,notify:moduleRegistered,moduleRegistered:moduleRegistered,moduleConfigured:moduleConfigured,moduleLoaded:moduleLoaded,routeInitialized:routeInitialized,moduleInitialized:moduleInitialized,moduleRun:moduleRun,setAllowedMethods:setAllowedMethods,enableLoggingMethod:enableLoggingMethod,disableLoggingMethod:disableLoggingMethod,css:css,colors:css.colors};var timeStamp=window["adrum-start-time"];timeStamp&&(timeStamp=(new Date).getTime());var border="\n======================================================================\n";info(border+"\n%c##### started loading app at ",css.boldBlackOnOrange,new Date(timeStamp),"\n"+border)}(_),function(angular){"use strict";angular.module("marketingCore",["ngCookies","ui.bootstrap","slickCarousel","ngAnimate","ngSanitize","base64","ngMaterial","ngMessages"])}(angular),function(angular,externalLogger,_){"use strict";function marketingAppConfig($locationProvider){externalLogger.moduleConfigured("marketingApp","marketingApp.module.js :: marketingAppConfig"),window.skipTmobileAppBootstrap?$locationProvider.html5Mode({enabled:!0,rewriteLinks:!1,requireBase:!1}).hashPrefix("#"):$locationProvider.html5Mode({enabled:!0})}function marketingAppInit(viewport){externalLogger.moduleRun("marketingApp","marketingApp.module.js :: marketingAppInit")}function storeCampaignCookie($location,$cookies){externalLogger.moduleRun("marketingApp","marketingApp.module.js :: store campaign cookie");var queryParms=$location.search();if(!_.isNil(queryParms.cmpid)){var expireIn30Days=moment.utc().add(30,"days");$cookies.put("url_campaign_id",queryParms.cmpid,{expires:expireIn30Days.format("ddd, DD MMM YYYY HH:mm:ss [GMT]"),path:"/",domain:".t-mobile.com"})}}marketingAppConfig.$inject=["$locationProvider"],marketingAppInit.$inject=["viewport"],storeCampaignCookie.$inject=["$location","$cookies"],angular.module("marketingApp",["log.ex.uo","tmobileCore","marketingCore","tmobileBrowse","angular-jwt"]),angular.module("marketingApp").config(marketingAppConfig).run(marketingAppInit).run(["DFacessTokenRequest","apiURLs","JWToken",function(DFacessTokenRequest,apiURLs,JWToken){if(!window.__karma__&&"/cart"!==window.location.pathname&&"/checkout"!==window.location.pathname&&"/"!==window.location.pathname)if(_.get(apiURLs,"isV2AccessTokenDisabled",!1))JWToken.getJSONWebToken();else{var skuCheck=angular.fromJson(Cookies.get("tmobglobalshareddata")),skuCheckValidate=angular.isDefined(skuCheck)?_.get(skuCheck,"shared_id"):!1;skuCheckValidate||DFacessTokenRequest.tokenRequest()}}]).run(["JWToken",function(JWToken){JWToken.setTokenExpIntervalTime()}]).run(storeCampaignCookie),externalLogger.moduleRegistered("marketingApp","marketingApp.module.js")}(angular,externalLogger,_),function(angular,externalLogger){"use strict";angular.module("tmobileCore",["ui.router","angular-cache","ui.router","ui.bootstrap","ngStorage","ngJSONPath","ngCookies","marketingCore"]),externalLogger.moduleRegistered("tmobileCore","core.js")}(angular,externalLogger),function(angular,externalLogger){"use strict";angular.module("tmobileCheckOut",["ui.router","angular-cache","ui.router","ui.bootstrap","ngStorage","ngJSONPath","ngCookies"]),externalLogger.moduleRegistered("tmobileCheckOut","checkOut.module.js")}(angular,externalLogger),function(angular,externalLogger){"use strict";angular.module("tmobileBrowse",["tmobileCore","marketingCore"]),externalLogger.moduleRegistered("tmobileBrowse","browse.module.js")}(angular,externalLogger),function(angular,externalLogger,_){"use strict";function formatTime(timeStamp){return Math.floor(timeStamp/1e3)+"."+timeStamp%1e3}angular.module("tmobileApp",["ngCookies","ngSanitize","ngAria","ngMessages","ui.router","ct.ui.router.extras","ui.bootstrap","angular.filter","ngTouch","ngStorage","ngJSONPath","validation.match","angular-cache","angular-loading-bar","angularUtils.directives.dirPagination","slickCarousel","log.ex.uo","base64","leodido.luhn","tmobileCore","tmobileCheckOut","tmoStateManager","home","marketingApp","tmobileBrowse","angular-jwt"]),externalLogger.moduleRegistered("tmobileApp","app.js"),angular.module("tmobileApp").value("stateChangeTimeStamp",Date.now()).config(["$locationProvider",function($locationProvider){externalLogger.moduleConfigured("tmobileApp","app.js :: $locationProvider"),$locationProvider.html5Mode({enabled:!0,requireBase:angular.isUndefined(window.__karma__)})}]).config(["slickCarouselConfig",function(slickCarouselConfig){externalLogger.moduleConfigured("tmobileApp","app.js :: slickCarouselConfig"),slickCarouselConfig.dots=!0,slickCarouselConfig.autoplay=!1}]).config(["logExProvider",function(logExProvider){externalLogger.moduleConfigured("tmobileApp","app.js :: logExProvider");var enabled=!0,verbose=!1;logExProvider.enableLogging(enabled,verbose),logExProvider.restrictLogMethods(window.loggingMethods),logExProvider.overrideLogPrefix(function(className){var separator=":--> ";return""+(angular.isString(className)?"::"+className:"")+separator})}]).config(["$httpProvider",function($httpProvider){externalLogger.moduleConfigured("tmobileApp","app.js :: $httpProvider"),$httpProvider.useLegacyPromiseExtensions=!1}]).config(["CacheFactoryProvider",function(CacheFactoryProvider){externalLogger.moduleConfigured("tmobileApp","app.js :: CacheFactoryProvider");var cacheOptions={maxAge:18e5,capacity:20,deleteOnExpire:"aggressive",recycleFreq:6e4};window.sessionStorage&&(cacheOptions.storageMode="sessionStorage"),angular.extend(CacheFactoryProvider.defaults,cacheOptions)}]).config(["$stateProvider","$futureStateProvider","AEM_RUNTIME","AEM_RUNTIME_SERVER",function($stateProvider,$futureStateProvider,AEM_RUNTIME,AEM_RUNTIME_SERVER){function loadAemStates($log,$state,aemRoutingService,productStateManager,UPPER_FUNNEL_ABSTRACT_ROOT_STATE_NAME){return aemRoutingService.loadRoutingStates().then(function(aemRoutes){var startProcessing=Date.now(),appRoutes=aemRoutes,skippedRoutes=aemRoutes;aemRoutingService.saveDefaultSkuList(appRoutes);var unusedStates=productStateManager.processAuthoredStates(appRoutes);angular.forEach(unusedStates,function(stateConfig){_.isEmpty($state.get(stateConfig.routeName))&&(stateConfig.parent=UPPER_FUNNEL_ABSTRACT_ROOT_STATE_NAME,stateConfig.views={content:{templateUrl:stateConfig.templateUrl}},$stateProvider.state(stateConfig.routeName,stateConfig))});var processingTime=Date.now()-startProcessing,loadStatistics=productStateManager.getLoadedRouteStatistics();angular.extend(loadStatistics,{totalLoaded:skippedRoutes.length+appRoutes.length,totalSkipped:skippedRoutes.length,totalMisc:unusedStates.length}),angular.extend(loadStatistics.loadedStates,{misc:unusedStates,skipped:skippedRoutes}),externalLogger.info("%caemRoutes.json processed in %s seconds",externalLogger.css.boldBlackOnOrange,formatTime(processingTime)),$log.log(loadStatistics)})}$futureStateProvider.addResolve(loadAemStates)}]).config(["$provide","$httpProvider",function($provide,$httpProvider){function pendingRequestInterceptorConstructor($log,$q,$injector){function logPendingRequests(){var $http=$injector.get("$http"),pendingRequests=_.filter($http.pendingRequests,function(request){return!request.url.endsWith(".html")});if(pendingRequests.length>0){var count=1,list="";angular.forEach(pendingRequests,function(request){list+="\n		"+count+") "+request.method+" :: "+request.url,count+=1}),externalLogger.info("%cWaiting for %d $http request to resolve",externalLogger.css.boldRedOnYellow,pendingRequests.length,list)}else{var $timeout=$injector.get("$timeout");$timeout(function(){var pendingRequests=_.filter($http.pendingRequests,function(request){return!request.url.endsWith(".html")});if(pendingRequests.length<=0){var $rootScope=$injector.get("$rootScope");$rootScope.$broadcast("ALL_DATA_REQUESTS_COMPLETED")}},0,!0)}}function requestInterceptor(config){if(!_.isEmpty(config.url)&&!config.url.endsWith(".html")){$log.log("request sent: "+config.url);var $rootScope=$injector.get("$rootScope");$rootScope.$broadcast("DATA_REQUEST_SENT")}return config}function responseInterceptor(response){return _.isEmpty(response.config.url)||response.config.url.endsWith(".html")||($log.log("response received: "+response.config.url),logPendingRequests()),response}function requestErrorInterceptor(rejection){return $log.log("request failed: "+rejection.config.url),logPendingRequests(),$q.reject(rejection)}function responseErrorInterceptor(rejection){return $log.log("response failed: "+rejection.config.url),logPendingRequests(),$q.reject(rejection)}return{request:requestInterceptor,response:responseInterceptor,requestError:requestErrorInterceptor,responseError:responseErrorInterceptor}}pendingRequestInterceptorConstructor.$inject=["$log","$q","$injector"],$provide.factory("pendingRequestInterceptor",pendingRequestInterceptorConstructor),$httpProvider.interceptors.push("pendingRequestInterceptor")}]).run(["globalCartService","$window",function(globalCartService,$window){$window.tmng={cart:globalCartService}}]).run(["tmobNotificationService","$document",function(tmobNotificationService,$document){$document.on("click",function(){tmobNotificationService.addNotification=[]})}]).run(["globalConfig","commonStorage",function(globalConfig,commonStorage){if(externalLogger.moduleRun("tmobileApp","app.js :: sync commonStorage"),globalConfig.versions&&(!commonStorage.getFromSharedCookie("sessionVersion")||globalConfig.versions.sessionVersion!=commonStorage.getFromSharedCookie("sessionVersion"))){commonStorage.clearAll();try{commonStorage.assignIntoSharedCookie("sessionVersion",globalConfig.versions.sessionVersion)}catch(err){}}}]).run(["$log","$rootScope","$timeout","$http","$location","$window","$modalStack","stateChangeTimeStamp","globalConfig","globalValue","serviceWorkerService",function($log,$rootScope,$timeout,$http,$location,$window,$modalStack,stateChangeTimeStamp,globalConfig,globalValue,serviceWorkerService){function reportDataRequestsCompleted(toState){var dataLoadTime=Date.now()-startTimeWaitingForData;dataLoadTime>1e3&&externalLogger.info('%cTotal Time to complete all $http requests for "%s": %d.%d seconds',externalLogger.css.boldRedOnYellow,toState.name,Math.floor(dataLoadTime/1e3),dataLoadTime%1e3),externalLogger.info('%c"%s" View is loaded, rendered and ready in %s seconds...',externalLogger.css.boldBlackOnGreen,toState.name,formatTime(Date.now()-stateChangeTimeStamp))}function waitForAngularReady(toState,toParams){startTimeWaitingForData=Date.now(),externalLogger.info('%cstate successfully changed to "%s" in %s seconds',externalLogger.css.boldRedOnYellow,toState.name,formatTime(Date.now()-stateChangeTimeStamp)),externalLogger.info('%cwaiting for "%s" view to complete loading data and render view',externalLogger.css.boldRedOnYellow,toState.name),$timeout(function(){if(_.isEmpty($http.pendingRequests))reportDataRequestsCompleted(toState);else{var urls=_.map($http.pendingRequests,"url");externalLogger.info('%c"%s" view has loaded in %s seconds but is waiting for %i  data requests to complete...',externalLogger.css.boldPurpleOnGreen,toState.name,formatTime(Date.now()-stateChangeTimeStamp),urls.length),angular.isUndefined(destroyListener)&&(destroyListener=$rootScope.$on("ALL_DATA_REQUESTS_COMPLETED",function(){$log.log('"ALL_DATA_REQUESTS_COMPLETED"'),reportDataRequestsCompleted(toState),destroyListener(),destroyListener=void 0}))}angular.getTestability(angular.element(document.body)).whenStable(function(){var finishedLoading=Date.now(),startTime=$window.appFinishedLoading?stateChangeTimeStamp:$window["adrum-start-time"],loadTime=finishedLoading-startTime,stringLoadTime=""+(loadTime/1e3>>0)+"."+loadTime%1e3,message="View loaded and stable.";$window.appFinishedLoading||($window.appFinishedLoading=!0,message="Angular App loaded and stable.");var border="----------------------------------------------------------------------";externalLogger.info("%c\n%s\n	%s Total Time: %s seconds\n%s",externalLogger.css.boldBlackOnOrange,border,message,stringLoadTime,border),navigator.serviceWorker&&serviceWorkerService.prefetchTask(toState,toParams),$window.prerenderReady=!0})},0)}function changeUnavForState(toState){globalConfig.noUnavStates&&(_.includes(globalConfig.noUnavStates,toState.name)?(angular.element("div[unav-section='header']").css("display","none"),angular.element("div[unav-section='footer']").css("display","none"),angular.element("div[id='body-main-div']").addClass("p-t-0 p-b-0"),angular.element("div[id='tmobileApp']").removeClass("container bg-white")):(angular.element("div[unav-section='header']").css("display","block"),angular.element("div[unav-section='footer']").css("display","block"),angular.element("div[id='body-main-div']").removeClass("p-t-0 p-b-0"),angular.element("div[id='tmobileApp']").addClass("container bg-white")))}var destroyListener,startTimeWaitingForData=null,isFirstRoute=!0;$rootScope.$on("$stateNotfound",function(event,unfoundState,fromState,fromParams){$log.info("\n*** $stateNotFound\n",unfoundState,"\nfromState:",angular.toJson(fromState),",\nfromParams:",angular.toJson(fromParams))}),$rootScope.$on("$stateChangeError",function(event,toState,toParams,fromState,fromParams,error){$log.info("\n*** $stateChangeError\n",toState.name,"\nerror:",error,",\ntoState:",angular.toJson(_.omit(toState,"data")),", toParams:",angular.toJson(toParams))}),$rootScope.$on("$stateChangeStart",function(event,toState,toParams,fromState,fromParams,options){$modalStack.getTop()&&$modalStack.dismissAll(),$window.prerenderReady=!1,stateChangeTimeStamp=Date.now(),isFirstRoute&&(isFirstRoute=!1,externalLogger.info("%cApp has completed load and initialization in %s seconds",externalLogger.css.boldBlackOnOrange,formatTime(stateChangeTimeStamp-window["adrum-start-time"])),externalLogger.info('%clooking up initial url path "%s" in routing table',externalLogger.css.boldBlackOnOrange,$location.path())),externalLogger.info("%c *** %s ---- \nname: %O\nsearch: %O\ntoState: %O\ntoParams: %O",externalLogger.css.boldWhiteOnDarkGreen,event.name,toState.name,$location.search(),angular.toJson(_.omit(toState,"data")),angular.toJson(toParams))}),$rootScope.$on("$stateChangeSuccess",function(event,toState,toParams,fromState,fromParams,options){changeUnavForState(toState),globalValue.state=toState.name,externalLogger.info("%c *** %s ---- \nname: %O\nsearch: %O\ntoState: %O\ntoParams: %O",externalLogger.css.boldWhiteOnDarkGreen,event.name,toState.name,$location.search(),angular.toJson(_.omit(toState,"data")),angular.toJson(toParams)),$window.__karma__||waitForAngularReady(toState,toParams)}),externalLogger.moduleRun("tmobileApp","app.js :: registered Event Listeners")}])}(window.angular,window.externalLogger,window._),function(angular,externalLogger){"use strict";angular.module("tmobileApp").constant("LOWER_FUNNEL_ABSTRACT_ROOT_STATE_NAME","buy-root").config(["$stateProvider","APP_ROOT_STATE_NAME","LOWER_FUNNEL_ABSTRACT_ROOT_STATE_NAME",function($stateProvider,APP_ROOT_STATE_NAME,LOWER_FUNNEL_ABSTRACT_ROOT_STATE_NAME){externalLogger.moduleConfigured("tmobileApp","buy.js :: config router"),$stateProvider.state(LOWER_FUNNEL_ABSTRACT_ROOT_STATE_NAME,{"abstract":!0,parent:APP_ROOT_STATE_NAME,views:{main:{templateUrl:"app/lowerFunnel/abstractRoot/lowerFunnel.tpl.html",controller:"LowerFunnelController as vm"}}})}])}(angular,externalLogger),function(angular,externalLogger){"use strict";angular.module("tmobileCore").constant("PRODUCT_CATEGORIES",{phone:{browseUrlRoot:"cell-phones",detailUrlRoot:"cell-phone"},accessory:{browseUrlRoot:"accessories",detailUrlRoot:"accessory"},"internet-device":{browseUrlRoot:"internet-devices",detailUrlRoot:"internet-device"},wearable:{browseUrlRoot:"wearables",detailUrlRoot:"wearable"}}).constant("UPPER_FUNNEL_ABSTRACT_ROOT_STATE_NAME","shopping-root").config(["$stateProvider","UPPER_FUNNEL_ABSTRACT_ROOT_STATE_NAME","APP_ROOT_STATE_NAME",function($stateProvider,UPPER_FUNNEL_ABSTRACT_ROOT_STATE_NAME,APP_ROOT_STATE_NAME){externalLogger.moduleConfigured("tmobileBrowse","shop.js :: config router"),$stateProvider.state(UPPER_FUNNEL_ABSTRACT_ROOT_STATE_NAME,{"abstract":!0,parent:APP_ROOT_STATE_NAME,views:{main:{templateUrl:"app/upperFunnel/abstractRoot/upperFunnel.tpl.html",controller:"UpperFunnelController as vm"}},resolve:{toggleData:["$log","toggleService",function($log,toggleService){return toggleService.getToggleFeature().then(function(){$log.log(" resolve :: toggleService")})}]}})}])}(angular,externalLogger),function(angular,externalLogger){"use strict";function configureRouter($stateProvider,MASTER_ERROR_STATE_NAME){$stateProvider.state(MASTER_ERROR_STATE_NAME,{url:"/error",params:{statusCode:{squash:!0,value:404}},views:{main:{templateUrl:"/app/errors/error.tpl.html",controller:"ErrorController as vm"}}})}configureRouter.$inject=["$stateProvider","MASTER_ERROR_STATE_NAME"],angular.module("tmobileCore").constant("MASTER_ERROR_STATE_NAME","root.error").config(configureRouter)}(angular,externalLogger),function(angular){"use strict";function universalMenuDataServiceFn($location,$window,apiService,$http){function isB2b(){return service.model.isB2b=$location.host().contains("business.t-mobile.com"),service.model.isB2b}function unavData(){var b2b=isB2b(),url="";if(9e3===$location.port()||"9000"===$location.port())url=b2b===!0?"/mockData/businessUnavData.json":"/mockData/unavData.json";else{var getObject=b2b===!0?apiService.getURL("universalBusinessMenu"):apiService.getURL("universalConsumerMenu");url=getObject.url}$http.get(url,{authRequired:!1,cache:!0}).then(function(result){service.model.unavData=result.data})}function isMobileView(){return $window.innerWidth<724}function isOsNav(){return"true"===$window.isOsNav}function getCopyrightText(){var currentYear=(new moment).year(),copyrightText="©2002-{currentYear} T-Mobile USA, INC.";return copyrightText.replace("{currentYear}",currentYear)}var service=this;service.model={unavData:{},isB2b:"",isOsNav:!1,copyrightText:getCopyrightText()},service.unavData=unavData,service.isB2b=isB2b,service.isMobileView=isMobileView,service.isOsNav=isOsNav}universalMenuDataServiceFn.$inject=["$location","$window","apiService","$http"],angular.module("tmobileApp").service("universalMenuDataService",universalMenuDataServiceFn)}(angular),function(angular,lodash){"use strict";function tokenUtilsConstructor($rootScope,$q,$log,$window,apiURLs,authorization,authTokenManager,jwtConfigConstants,jwtHelper,tokenTtl,cartStorage,apiService,toggleService){function generateTokenRsHandler(tokenData){var response={status:"failed"};return tokenData&&tokenData.data&&tokenData.data.expires_in?($rootScope.cookiesExpiresIn=moment().add(tokenData.data.expires_in,"seconds").toDate(),authTokenManager.setTokenCookies(tokenData.data,"token",angular.equals(apiURLs.storage,"localStorage"),tokenTtl.token.timetolive),response.status="done",response):response}function storeJWTInLocalStorage(tokenData){var response={status:"failed"};if(tokenData&&tokenData.data&&tokenData.data.accessToken){$rootScope.cookiesExpiresIn=moment().add(jwtConfigConstants.token.timetolive,"seconds").toDate();var oAuthTokenData=tokenData.data,accessToken=jwtHelper.decodeToken(oAuthTokenData.accessToken),jwtToken={access_token:accessToken.sub,usn:oAuthTokenData.usn,expiry:1e3*accessToken.exp,jwt_token:oAuthTokenData.accessToken};return lodash.isNil(oAuthTokenData.creditProfileId)||lodash.isNil(oAuthTokenData.accountId)||lodash.isNil(oAuthTokenData.profileId)||(cartStorage.setCreditProfileId(oAuthTokenData.creditProfileId),cartStorage.setProfileAccountId(oAuthTokenData.accountId),cartStorage.setProfileId(oAuthTokenData.profileId)),authTokenManager.getTokenCookies("jwt_token",angular.equals(apiService.getURL("storage").url,"localStorage"))||(authTokenManager.setTokenCookies(jwtToken,"jwt_token",angular.equals(apiURLs.storage,"localStorage"),jwtConfigConstants.token.timetolive),factoryObject.apiCalled=!1),response.status="done",response.tokenData=tokenData.data,response}return response}function generateSession(forceLogin,callback){var tokenCookies=authTokenManager.getTokenCookies("token",angular.equals(apiURLs.storage,"localStorage")),token=null;return tokenCookies&&(token=tokenCookies.access_token),token&&!forceLogin?token:authorization.generateToken().then(generateTokenRsHandler)["catch"](function(err){$log.log("Something went wrong",err)})}function generateToken(forceLogin){var defer=$q.defer();if(lodash.get(toggleService.model,"toggles.isV2Disabled",!1)){var response={};defer.resolve(response)}else{var tokenCookies=authTokenManager.getTokenCookies("token",angular.equals(apiURLs.storage,"localStorage")),token=null;if(tokenCookies&&(token=tokenCookies.access_token),token&&!forceLogin)return defer.resolve(),defer.promise;authorization.generateToken().then(function(tokenData){tokenData&&tokenData.data&&tokenData.data.expires_in&&($rootScope.cookiesExpiresIn=moment().add(tokenData.data.expires_in,"seconds").toDate(),authTokenManager.setTokenCookies(tokenData.data,"token",angular.equals(apiURLs.storage,"localStorage"),tokenTtl.token.timetolive),defer.resolve())})}return defer.promise}function generateCryptoKeys(){return $window.crypto.subtle.generateKey({name:jwtConfigConstants.crypto.algorithm,modulusLength:2048,publicExponent:new Uint8Array([1,0,1]),hash:{name:jwtConfigConstants.crypto.hash}},!1,["sign","verify"]).then(function(key){return{publicKey:key.publicKey,privateKey:key.privateKey}},function(err){$log.error(err)})}function getCryptoJWK(){var defer=$q.defer(),dbName=jwtConfigConstants.indexedDB.dbName,objectStoreName=jwtConfigConstants.indexedDB.storeName,keyName=jwtConfigConstants.indexedDB.jwtKeyName,indexedDB=$window.indexedDB,open=indexedDB.open(dbName,1);return open.onupgradeneeded=function(){var db=open.result;db.createObjectStore(objectStoreName)},open.onsuccess=function(){var db=open.result,objectStore=db.transaction(objectStoreName,"readonly").objectStore(objectStoreName);objectStore.get(keyName).onsuccess=function(event){var keyPair=event.target.result;keyPair?(db.close(),defer.resolve(keyPair)):generateCryptoKeys().then(function(keys){objectStore=db.transaction(objectStoreName,"readwrite").objectStore(objectStoreName),objectStore.add(keys,keyName),db.close(),defer.resolve(keys)})}},open.onerror=function(){generateCryptoKeys().then(function(keyPair){defer.resolve(keyPair)})},defer.promise}function exportCryptoJWK(){var defer=$q.defer();if(!$window.crypto||!$window.crypto.subtle){var error="Your current browser does not support the Web Cryptography API! This page will not work.";return $log.error(error),defer.reject(error)}return getCryptoJWK().then(function(data){$window.crypto.subtle.exportKey("jwk",data.publicKey).then(function(key){defer.resolve(JSON.stringify(key))})}),defer.promise}function generateJWT(){var defer=$q.defer();if(lodash.get(apiURLs,"isJWTAccessTokenEnabled",!1)){var tokenCookies=authTokenManager.getTokenCookies("jwt_token",angular.equals(apiURLs.storage,"localStorage"));if((angular.isUndefined(tokenCookies)||angular.equals(tokenCookies,null))&&!factoryObject.apiCalled)return factoryObject.apiCalled=!0,factoryObject.exportCryptoJWK().then(function(key){return authorization.generateJWT(key)}).then(storeJWTInLocalStorage)["catch"](function(error){$log.error(error)});defer.resolve({status:"done",tokenData:tokenCookies,message:"token from cache"})}return defer.resolve({status:"failed",tokenData:void 0,message:"isJWTAccessTokenEnabled: false"}),defer.promise}function generatePoPToken(authToken,request){var defer=$q.defer();return factoryObject.getCryptoJWK().then(function(keys){authorization.generatePOP(authToken,keys.privateKey,request).then(function(token){defer.resolve(token)},function(error){defer.reject(error)})},function(error){defer.reject(error)}),defer.promise}var factoryObject={};return factoryObject.generateSession=generateSession,factoryObject.generateToken=generateToken,factoryObject.generateJWT=generateJWT,factoryObject.exportCryptoJWK=exportCryptoJWK,factoryObject.generatePoPToken=generatePoPToken,factoryObject.getCryptoJWK=getCryptoJWK,factoryObject}tokenUtilsConstructor.$inject=["$rootScope","$q","$log","$window","apiURLs","authorization","authTokenManager","jwtConfigConstants","jwtHelper","tokenTtl","cartStorage","apiService","toggleService"],angular.module("tmobileCore").factory("tokenUtils",tokenUtilsConstructor)}(angular,window._),function(angular){"use strict";function smsUtilConstructor($log,$window,coreServices,globalConfig,apiURLs,httpRequestWrapper){}smsUtilConstructor.$inject=["$log","$window","coreServices","globalConfig","apiURLs","httpRequestWrapper"],angular.module("tmobileApp").factory("smsUtil",smsUtilConstructor)}(window.angular),function(angular,externalLogger){"use strict";angular.module("tmobileApp").config(["$stateProvider",function($stateProvider){externalLogger.moduleConfigured("core/tmobileApp","parsys"),$stateProvider.state("parsys",{url:"/parsys",templateUrl:"app/parsys/parsys.html",controller:"ParsysCtrl"})}])}(angular,externalLogger),function(angular){"use strict";function ParsysCtrlConstructor($log,$scope,$interval,commonServices){var $window=commonServices.$window,vm=this;vm.parsysColumnsHeights={},vm.parsysWindowSize={};var parSysDiv=angular.element(vm.parsysId);$interval(function(){parSysDiv=angular.element(vm.parsysId);for(var divs=angular.element(vm.colDivider),triggerVLine=!1,i=0;i<divs.length;i++)vm.parsysColumnsHeights[i]!==divs[i].clientHeight&&(vm.parsysColumnsHeights[i]=divs[i].clientHeight,-1!==divs[i].className.indexOf("bottom")&&(divs[i].style.height=vm.parsysColumnsHeights[i]),
triggerVLine=!0);(vm.parsysWindowSize.width!==$window.innerWidth||vm.parsysWindowSize.height!==$window.innerHeight)&&(vm.parsysWindowSize.width=$window.innerWidth,vm.parsysWindowSize.height=$window.innerHeight,vm.resizingVLine(),triggerVLine=!1),triggerVLine&&vm.resizingVLine()},1e3),vm.resizingVLine=function(){var screenWidth=$window.innerWidth;$window.innerHeight;$log.log("screenWidth  "+screenWidth);var mediaType,rowDivs=0;screenWidth>=1200?mediaType="lg":screenWidth>=992&&1200>screenWidth?mediaType="md":screenWidth>=768&&992>screenWidth?mediaType="sm":768>=screenWidth&&(mediaType="xs"),vm.css={position:"absolute",width:"0px",padding:"15px 0px 15px 0px",top:"5px",bottom:"5px",border:"1px solid #DDDDDD",right:"-2px"};for(var dividers=document.getElementsByClassName(vm.spanId),i=0;i<dividers.length;i++)dividers[i].style.visibility="hidden";angular.forEach(vm.parsysparams,function(value,key){if(value.mediaSize===mediaType){var completedColumns,startingIndex=0;0===value.rowIndex?(startingIndex=0,completedColumns=value.Value):value.rowIndex>0&&(startingIndex=completedColumns,completedColumns+=value.Value);for(var divs=document.getElementsByClassName(vm.colDivider),maxHeight=0,i=0;i<value.Value;i++)maxHeight<divs[rowDivs].clientHeight&&(maxHeight=divs[rowDivs].clientHeight),rowDivs++;2===value.Value?(vm.hidevline||(dividers[startingIndex].style.visibility="visible"),dividers[startingIndex].style.height=maxHeight-15+"px",dividers[startingIndex].closest(".bottom")&&(dividers[startingIndex].closest(".bottom").style.height=dividers[startingIndex].style.height),dividers[startingIndex].closest(".middle")&&(dividers[startingIndex].closest(".middle").style.height=dividers[startingIndex].style.height),dividers[startingIndex].closest("div").clientHeight>dividers[startingIndex+1].closest("div").clientHeight?dividers[startingIndex+1].closest("div").style.height=dividers[startingIndex].style.height:dividers[startingIndex+1].closest("div").style.height=dividers[startingIndex+1].closest("div").clientHeight+"px",dividers[startingIndex+1].getAttribute("class").indexOf(value.mediaSize+"Zero")>-1&&(dividers[startingIndex].style.visibility="hidden")):3===value.Value?(vm.hidevline||(dividers[startingIndex].style.visibility="visible",dividers[startingIndex+1].style.visibility="visible"),dividers[startingIndex].style.height=maxHeight-15+"px",dividers[startingIndex+1].style.height=maxHeight-15+"px",dividers[startingIndex].closest(".bottom")&&(dividers[startingIndex].closest(".bottom").style.height=dividers[startingIndex].style.height),dividers[startingIndex].closest(".middle")&&(dividers[startingIndex].closest(".middle").style.height=dividers[startingIndex].style.height),dividers[startingIndex+1].closest(".bottom")&&(dividers[startingIndex+1].closest(".bottom").style.height=dividers[startingIndex+1].style.height),dividers[startingIndex+1].closest(".middle")&&(dividers[startingIndex+1].closest(".middle").style.height=dividers[startingIndex+1].style.height),dividers[startingIndex+1].closest("div").clientHeight>dividers[startingIndex+2].closest("div").clientHeight?dividers[startingIndex+2].closest("div").style.height=dividers[startingIndex+1].style.height:dividers[startingIndex+2].closest("div").style.height=dividers[startingIndex+2].closest("div").clientHeight+"px",dividers[startingIndex+2].getAttribute("class").indexOf(value.mediaSize+"Zero")>-1&&(dividers[startingIndex+1].style.visibility="hidden"),dividers[startingIndex+1].getAttribute("class").indexOf(value.mediaSize+"Zero")>-1&&dividers[startingIndex+2].getAttribute("class").indexOf(value.mediaSize+"Zero")>-1&&(dividers[startingIndex].style.visibility="hidden")):4===value.Value&&(vm.hidevline||(dividers[startingIndex].style.visibility="visible",dividers[startingIndex+1].style.visibility="visible",dividers[startingIndex+2].style.visibility="visible"),dividers[startingIndex].style.height=maxHeight-15+"px",dividers[startingIndex+1].style.height=maxHeight-15+"px",dividers[startingIndex+2].style.height=maxHeight-15+"px",dividers[startingIndex].closest(".bottom")&&(dividers[startingIndex].closest(".bottom").style.height=dividers[startingIndex].style.height),dividers[startingIndex].closest(".middle")&&(dividers[startingIndex].closest(".middle").style.height=dividers[startingIndex].style.height),dividers[startingIndex+1].closest(".bottom")&&(dividers[startingIndex+1].closest(".bottom").style.height=dividers[startingIndex+1].style.height),dividers[startingIndex+1].closest(".middle")&&(dividers[startingIndex+1].closest(".middle").style.height=dividers[startingIndex+1].style.height),dividers[startingIndex+2].closest(".bottom")&&(dividers[startingIndex+2].closest(".bottom").style.height=dividers[startingIndex+2].style.height),dividers[startingIndex+2].closest(".middle")&&(dividers[startingIndex+2].closest(".middle").style.height=dividers[startingIndex+2].style.height),dividers[startingIndex+2].closest("div").clientHeight>dividers[startingIndex+3].closest("div").clientHeight?dividers[startingIndex+3].closest("div").style.height=dividers[startingIndex+2].style.height:dividers[startingIndex+3].closest("div").style.height=dividers[startingIndex+3].closest("div").clientHeight+"px",dividers[startingIndex+3].getAttribute("class").indexOf(value.mediaSize+"Zero")>-1&&(dividers[startingIndex+2].style.visibility="hidden"),dividers[startingIndex+2].getAttribute("class").indexOf(value.mediaSize+"Zero")>-1&&dividers[startingIndex+3].getAttribute("class").indexOf(value.mediaSize+"Zero")>-1&&(dividers[startingIndex+1].style.visibility="hidden"),dividers[startingIndex+1].getAttribute("class").indexOf(value.mediaSize+"Zero")>-1&&dividers[startingIndex+2].getAttribute("class").indexOf(value.mediaSize+"Zero")>-1&&dividers[startingIndex+3].getAttribute("class").indexOf(value.mediaSize+"Zero")>-1&&(dividers[startingIndex].style.visibility="hidden"))}})}}ParsysCtrlConstructor.$inject=["$log","$scope","$interval","commonServices"],angular.module("tmobileApp").controller("ParsysCtrl",ParsysCtrlConstructor)}(angular),function(angular){"use strict";function emailUtilConstructor(globalConfig,coreServices,$location,mpLocalizationService){function sendOrderConfirmationEmail(detailsToSend,fromUFCC){var url,body=globalConfig.credentials.selligentServletParams;return body.userData.LANGUAGE=mpLocalizationService.getCookie("MP_LANG")||"en",body.userData.Name=detailsToSend.fullName,body.userData.Mail=detailsToSend.email,body.userData.FIRST_NAME=detailsToSend.firstName,fromUFCC?(url=coreServices.apiURLs.selligentGenericServletUrl,body.userData.OPT_IN=void 0,body.campaignData.CREDIT_SELECTION=void 0,body.campaignData.SUBSCRIBE_SOURCE=void 0,body.campaignData.IPADDRESS=void 0,body.campaignData.FINANCING_TYPE=void 0,body.campaignData.SUBMISSION_TIME=void 0,body.config="ufccConfirmation",body.campaignData.ACTIONCODE="UFCC",body.campaignData.LEAD_CAPTURE_LOCATION=$location.absUrl()):(url=coreServices.apiURLs.selligentServletUrl,body.campaignData.CREDIT_SELECTION=detailsToSend.selectedCreditClass,body.campaignData.FINANCING_TYPE=detailsToSend.financingType,body.campaignData.SUBMISSION_TIME=detailsToSend.inWorkingHours),coreServices.httpRequestWrapper.post(url,body)}return{sendOrderConfirmationEmail:sendOrderConfirmationEmail}}emailUtilConstructor.$inject=["globalConfig","coreServices","$location","mpLocalizationService"],angular.module("tmobileCore").factory("emailUtil",emailUtilConstructor)}(angular),function(angular,lodash){"use strict";function dateUtilsConstructor(){function isFederalHoliday(federalHolidayList){var today=new Date,currentMonth=today.getMonth()+1,currentDate=today.getDate();if(angular.isDefined(federalHolidayList)){angular.isArray(federalHolidayList)||(federalHolidayList=[federalHolidayList]);var holiday=lodash.find(federalHolidayList,function(holiday){var dateMonth=holiday.federalHoliday.split("-");return currentMonth===parseInt(dateMonth[0])&&currentDate===parseInt(dateMonth[1])||isWeekendHoliday(holiday.federalHoliday)})}return!lodash.isEmpty(holiday)}function isOptionalHoliday(optionalHolidayList,federalState){var today=new Date,currentMonth=today.getMonth()+1,currentDate=today.getDate();if(angular.isDefined(optionalHolidayList)){angular.isArray(optionalHolidayList)||(optionalHolidayList=[optionalHolidayList]);var holiday=lodash.find(optionalHolidayList,function(holiday){var dateMonth=holiday.optFederalHoliday.split("-");return currentMonth===parseInt(dateMonth[0])&&currentDate===parseInt(dateMonth[1])&&holiday.optFederalState===federalState||holiday.optFederalState===federalState&&isWeekendHoliday(holiday.optFederalHoliday)})}return!lodash.isEmpty(holiday)}function isWeekendHoliday(holidayDate){var holiday=holidayDate.split("-"),today=new Date,currentMonth=today.getMonth()+1,currentDay=getWeekdayNameForDate(today),modDate=new Date,holidayStatus=!1;return currentMonth===parseInt(holiday[0])&&"Friday"===currentDay?(modDate=modDate.getDate()+1,modDate===parseInt(holiday[1])&&(holidayStatus=!0)):currentMonth===parseInt(holiday[0])&&"Monday"===currentDay&&(modDate=modDate.getDate()-1,modDate===parseInt(holiday[1])&&(holidayStatus=!0)),holidayStatus}function weekOffDay(callCenterHolidayList,federalState){var currentDay=getWeekdayNameForDate(new Date);if(angular.isDefined(callCenterHolidayList)){angular.isArray(callCenterHolidayList)||(callCenterHolidayList=[callCenterHolidayList]);var holiday=lodash.find(callCenterHolidayList,function(holiday){return holiday.weekOffDay===currentDay&&holiday.weekOffState===federalState})}return!lodash.isEmpty(holiday)}function callCenterOperatingHours(onTime,offTime){onTime=onTime.split(":"),offTime=offTime.split(":");var initTime=new Date;initTime.setHours(onTime[0],onTime[1],0);var endTime=new Date;endTime.setHours(offTime[0],offTime[1],0);var purchaseDateTime=new Date,purchaseHour=purchaseDateTime.getHours(),purchaseMinute=purchaseDateTime.getMinutes(),purchaseSecond=purchaseDateTime.getSeconds(),holidayStatus=!1;return purchaseDateTime.setHours(purchaseHour,purchaseMinute,purchaseSecond),(initTime>purchaseDateTime||purchaseDateTime>endTime)&&(holidayStatus=!0),holidayStatus}function getWeekdayNameForDate(dateObject){var weekday=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];return weekday[dateObject.getDay()]}return{isFederalHoliday:isFederalHoliday,isOptionalHoliday:isOptionalHoliday,weekOffDay:weekOffDay,callCenterOperatingHours:callCenterOperatingHours,getWeekdayNameForDate:getWeekdayNameForDate}}angular.module("tmobileCore").factory("dateUtils",dateUtilsConstructor)}(window.angular,window._),function(angular,lodash){"use strict";function commonUtilsConstructor($log,jsonPath,globalValue,globalConfig){function recursive(object,exprArray,index,destPathArray,prevPath,resultArray){var arrayValue=searchJsonArray(object,exprArray[index]);if(arrayValue&&Array.isArray(arrayValue)&&1==arrayValue.length&&(arrayValue=Array.isArray(arrayValue[0])?arrayValue[0]:arrayValue[0]),index==exprArray.length-1){var currentPath=destPathArray[index],destValue=prevPath+"."+currentPath;if(!arrayValue)return;var jsonDataValue=arrayValue,jsonData={path:destValue,value:jsonDataValue};return void resultArray.push(jsonData)}return angular.forEach(arrayValue,function(value,key){var currentPath=destPathArray[index]+"["+key+"]",destValue=prevPath+"."+currentPath;recursive(value,exprArray,index+1,destPathArray,destValue,resultArray);var jsonData={path:destValue};resultArray.push(jsonData)}),resultArray}function searchNArray(object,srcPath,destPath){var exprs=srcPath.split("[n]."),destPathArray=destPath.split("[n]."),tempDestObeject={},finalArray="",resultArray=[],lastIndex=exprs.length-1;if(exprs[lastIndex].indexOf("[n]")>-1&&(exprs[lastIndex]=exprs[lastIndex].replace(/\[n\]/g,""),destPathArray[lastIndex]=destPathArray[lastIndex].replace(/\[n\]/g,"")),finalArray=recursive(object,exprs,0,destPathArray,"",resultArray)){$log.log("[transformByMap] final array for dynamic path :: ",resultArray);var tempDestPaths=resultArray;angular.forEach(tempDestPaths,function(value,key){if(value){var newJson;if(resultArray[key].value&&-1==value.path.indexOf("=")){var destPath=value.path.substring(1);newJson=assignValue(destPath,JSON.stringify(resultArray[key].value))}else if(value.path.indexOf("=")>-1){var srcJsonValue=value.path.substring(value.path.indexOf("=")+1),destPath=value.path.substring(1,value.path.indexOf("="));newJson=assignValue(destPath,srcJsonValue)}tempDestObeject=_.merge(tempDestObeject,newJson)}})}return tempDestObeject}function assignValue(destPath,srcJsonString){var myObj="myruleobject.";destPath||(myObj="myruleobject.");var newJson=convertPathToJson(myObj+destPath),jsonValue=JSON.parse(srcJsonString);if(!destPath)return newJson=jsonValue;var keyToSearch=destPath.substring(0,destPath.lastIndexOf(".")),keyToStoreValue=destPath.substring(destPath.lastIndexOf(".")+1),jsonRef=searchJson(newJson,keyToSearch);return jsonRef[keyToStoreValue]=jsonValue,newJson}function urlParser(urlString){var a=document.createElement("a");return a.href=urlString,a}function searchJson(jsonData,jPath){var value;if(!jsonData)return value;var searchItem=jsonPath(jsonData,"$.."+jPath);return angular.isDefined(searchItem)&&searchItem.length>0&&(value=searchItem[0]),value}function searchJsonArray(jsonData,jPath){var value;if(!jsonData)return value;var searchItems=jsonPath(jsonData,"$.."+jPath);return angular.isDefined(searchItems)&&searchItems.length>0&&(value=searchItems),value}function convertPathToJson(string){for(var sourceArray=string.split("."),top={},point=top;sourceArray.length;){var work=sourceArray.shift();if(/([a-zA-Z_][a-zA-Z0-9_]*)\[([0-9]+)\]/.test(work)){var matches=/([a-zA-Z_][a-zA-Z0-9_]*)\[([a-zA-Z0-9_]+)\]/.exec(work),matchName=matches[1],matchIndex=matches[2];if(point[matchName]=[],matches.input.indexOf("=")>0){var morework=matches.input.split("=");value=morework[1].trim(),value=value.replace(/#dot#/g,"."),isNaN(value)||(value=Number(value))}point[matchName][matchIndex]=value?value:{},point=point[matchName][matchIndex]}else if(/([a-zA-Z_][a-zA-Z0-9_]*)\[([a-zA-Z0-9_]+)\]/.test(work)){var matches=/([a-zA-Z_][a-zA-Z0-9_]*)\[([a-zA-Z0-9_]+)\]/.exec(work),matchName=matches[1],matchIndex=matches[2];point[matchName]=[];var value;if(matches.input.indexOf("=")>0){var morework=matches.input.split("=");value=morework[1].trim(),value=value.replace(/#dot#/g,"."),isNaN(value)||(value=Number(value))}point[matchName][matchIndex]=value?value:{},point=point[matchName][matchIndex]}else if(work.indexOf("[")>-1||work.indexOf("]")>-1);else if(work.indexOf("=")>0){var morework=work.split("=");work=morework[0].trim();var value=morework[1].trim();value=value.replace(/#dot#/g,"."),isNaN(value)||(value=Number(value)),point[work]=value,angular.equals("undefined",value)&&(point[work]=void 0),point=point[work]}else work=work.trim(),point[work]={},point=point[work]}var ret;for(var k in top)ret=top[k];return ret}function transformByMap(mapCode,srcObject,destObect){var mapCodeArray;"object"==typeof mapCode&&(mapCodeArray=[],angular.forEach(mapCode,function(destPath,srcExp){mapCodeArray.push({srcExp:srcExp,destPath:destPath})}));var mapObject;if(mapCodeArray?mapObject={mapItems:mapCodeArray}:(globalValue.authorValue&&(transformMap=searchJson(globalValue.authorValue,"rootPage.rules.transformMap")),mapObject=_.find(transformMap,{mapCode:mapCode})),$log.log("[transformByMap] map name :: ",mapCode),mapObject){var tempDestObeject={};angular.forEach(mapObject.mapItems,function(value,key){var srcValue;if(_.includes(value.srcExp,"value:")){var srcValue=value.srcExp.split(":");srcValue=JSON.stringify(srcValue[1]),tempDestObeject=_.merge(tempDestObeject,newJson)}else if(_.includes(value.srcExp,"json:")){var srcJsonValue=value.srcExp.substring(value.srcExp.indexOf(":")+1),newJson=assignValue(value.destPath,srcJsonValue);tempDestObeject=_.merge(tempDestObeject,newJson)}else if(_.includes(value.srcExp,"[n]")){var tempDestObt=searchNArray(srcObject,value.srcExp,value.destPath);tempDestObeject=_.merge(tempDestObeject,tempDestObt)}else srcValue=searchJson(srcObject,value.srcExp),srcValue=JSON.stringify(srcValue);var newJsonPath="myruleobject.";if(srcValue){var newJson;if(_.includes(value.destPath,"=")){var srcJsonValueTemp=value.destPath.substring(value.destPath.indexOf("=")+1);newJsonPath=value.destPath.substring(0,value.destPath.indexOf("=")+1)+srcJsonValueTemp;var srcJsonValue=newJsonPath.substring(newJsonPath.indexOf("=")+1);newJson=assignValue(newJsonPath.substring(0,newJsonPath.indexOf("=")),srcJsonValue)}else{newJsonPath=value.destPath+"="+srcValue;var srcJsonValue=newJsonPath.substring(newJsonPath.indexOf("=")+1);newJson=assignValue(value.destPath,srcJsonValue)}tempDestObeject=_.merge(tempDestObeject,newJson)}}),$log.log("[transformByMap] transformed Object :: ",tempDestObeject),destObect=_.merge(destObect,tempDestObeject)}}function sortCollection(arr1,arr2,propName){return arr1.sort(function(val1,val2){return val1[propName]?arr2.indexOf(val1[propName])>=0&&arr2.indexOf(val2[propName])<0?-1:arr2.indexOf(val1[propName])<0&&arr2.indexOf(val2[propName])>=0?1:arr2.indexOf(val1[propName])-arr2.indexOf(val2[propName]):void 0}),arr1}function loadDictionary(){var translate_keys="Á,Ă,Ắ,Ặ,Ằ,Ẳ,Ẵ,Ǎ,Â,Ấ,Ậ,Ầ,Ẩ,Ẫ,Ä,Ǟ,Ȧ,Ǡ,Ạ,Ȁ,À,Ả,Ȃ,Ā,Ą,Å,Ǻ,Ḁ,Ⱥ,Ã,Ꜳ,Æ,Ǽ,Ǣ,Ꜵ,Ꜷ,Ꜹ,Ꜻ,Ꜽ,Ḃ,Ḅ,Ɓ,Ḇ,Ƀ,Ƃ,Ć,Č,Ç,Ḉ,Ĉ,Ċ,Ƈ,Ȼ,Ď,Ḑ,Ḓ,Ḋ,Ḍ,Ɗ,Ḏ,ǲ,ǅ,Đ,Ƌ,Ǳ,Ǆ,É,Ĕ,Ě,Ȩ,Ḝ,Ê,Ế,Ệ,Ề,Ể,Ễ,Ḙ,Ë,Ė,Ẹ,Ȅ,È,Ẻ,Ȇ,Ē,Ḗ,Ḕ,Ę,Ɇ,Ẽ,Ḛ,Ꝫ,Ḟ,Ƒ,Ǵ,Ğ,Ǧ,Ģ,Ĝ,Ġ,Ɠ,Ḡ,Ǥ,Ḫ,Ȟ,Ḩ,Ĥ,Ⱨ,Ḧ,Ḣ,Ḥ,Ħ,Í,Ĭ,Ǐ,Î,Ï,Ḯ,İ,Ị,Ȉ,Ì,Ỉ,Ȋ,Ī,Į,Ɨ,Ĩ,Ḭ,Ꝺ,Ꝼ,Ᵹ,Ꞃ,Ꞅ,Ꞇ,Ꝭ,Ĵ,Ɉ,Ḱ,Ǩ,Ķ,Ⱪ,Ꝃ,Ḳ,Ƙ,Ḵ,Ꝁ,Ꝅ,Ĺ,Ƚ,Ľ,Ļ,Ḽ,Ḷ,Ḹ,Ⱡ,Ꝉ,Ḻ,Ŀ,Ɫ,ǈ,Ł,Ǉ,Ḿ,Ṁ,Ṃ,Ɱ,Ń,Ň,Ņ,Ṋ,Ṅ,Ṇ,Ǹ,Ɲ,Ṉ,Ƞ,ǋ,Ñ,Ǌ,Ó,Ŏ,Ǒ,Ô,Ố,Ộ,Ồ,Ổ,Ỗ,Ö,Ȫ,Ȯ,Ȱ,Ọ,Ő,Ȍ,Ò,Ỏ,Ơ,Ớ,Ợ,Ờ,Ở,Ỡ,Ȏ,Ꝋ,Ꝍ,Ō,Ṓ,Ṑ,Ɵ,Ǫ,Ǭ,Ø,Ǿ,Õ,Ṍ,Ṏ,Ȭ,Ƣ,Ꝏ,Ɛ,Ɔ,Ȣ,Ṕ,Ṗ,Ꝓ,Ƥ,Ꝕ,Ᵽ,Ꝑ,Ꝙ,Ꝗ,Ŕ,Ř,Ŗ,Ṙ,Ṛ,Ṝ,Ȑ,Ȓ,Ṟ,Ɍ,Ɽ,Ꜿ,Ǝ,Ś,Ṥ,Š,Ṧ,Ş,Ŝ,Ș,Ṡ,Ṣ,Ṩ,Ť,Ţ,Ṱ,Ț,Ⱦ,Ṫ,Ṭ,Ƭ,Ṯ,Ʈ,Ŧ,Ɐ,Ꞁ,Ɯ,Ʌ,Ꜩ,Ú,Ŭ,Ǔ,Û,Ṷ,Ü,Ǘ,Ǚ,Ǜ,Ǖ,Ṳ,Ụ,Ű,Ȕ,Ù,Ủ,Ư,Ứ,Ự,Ừ,Ử,Ữ,Ȗ,Ū,Ṻ,Ų,Ů,Ũ,Ṹ,Ṵ,Ꝟ,Ṿ,Ʋ,Ṽ,Ꝡ,Ẃ,Ŵ,Ẅ,Ẇ,Ẉ,Ẁ,Ⱳ,Ẍ,Ẋ,Ý,Ŷ,Ÿ,Ẏ,Ỵ,Ỳ,Ƴ,Ỷ,Ỿ,Ȳ,Ɏ,Ỹ,Ź,Ž,Ẑ,Ⱬ,Ż,Ẓ,Ȥ,Ẕ,Ƶ,Ĳ,Œ,ᴀ,ᴁ,ʙ,ᴃ,ᴄ,ᴅ,ᴇ,ꜰ,ɢ,ʛ,ʜ,ɪ,ʁ,ᴊ,ᴋ,ʟ,ᴌ,ᴍ,ɴ,ᴏ,ɶ,ᴐ,ᴕ,ᴘ,ʀ,ᴎ,ᴙ,ꜱ,ᴛ,ⱻ,ᴚ,ᴜ,ᴠ,ᴡ,ʏ,ᴢ,á,ă,ắ,ặ,ằ,ẳ,ẵ,ǎ,â,ấ,ậ,ầ,ẩ,ẫ,ä,ǟ,ȧ,ǡ,ạ,ȁ,à,ả,ȃ,ā,ą,ᶏ,ẚ,å,ǻ,ḁ,ⱥ,ã,ꜳ,æ,ǽ,ǣ,ꜵ,ꜷ,ꜹ,ꜻ,ꜽ,ḃ,ḅ,ɓ,ḇ,ᵬ,ᶀ,ƀ,ƃ,ɵ,ć,č,ç,ḉ,ĉ,ɕ,ċ,ƈ,ȼ,ď,ḑ,ḓ,ȡ,ḋ,ḍ,ɗ,ᶑ,ḏ,ᵭ,ᶁ,đ,ɖ,ƌ,ı,ȷ,ɟ,ʄ,ǳ,ǆ,é,ĕ,ě,ȩ,ḝ,ê,ế,ệ,ề,ể,ễ,ḙ,ë,ė,ẹ,ȅ,è,ẻ,ȇ,ē,ḗ,ḕ,ⱸ,ę,ᶒ,ɇ,ẽ,ḛ,ꝫ,ḟ,ƒ,ᵮ,ᶂ,ǵ,ğ,ǧ,ģ,ĝ,ġ,ɠ,ḡ,ᶃ,ǥ,ḫ,ȟ,ḩ,ĥ,ⱨ,ḧ,ḣ,ḥ,ɦ,ẖ,ħ,ƕ,í,ĭ,ǐ,î,ï,ḯ,ị,ȉ,ì,ỉ,ȋ,ī,į,ᶖ,ɨ,ĩ,ḭ,ꝺ,ꝼ,ᵹ,ꞃ,ꞅ,ꞇ,ꝭ,ǰ,ĵ,ʝ,ɉ,ḱ,ǩ,ķ,ⱪ,ꝃ,ḳ,ƙ,ḵ,ᶄ,ꝁ,ꝅ,ĺ,ƚ,ɬ,ľ,ļ,ḽ,ȴ,ḷ,ḹ,ⱡ,ꝉ,ḻ,ŀ,ɫ,ᶅ,ɭ,ł,ǉ,ſ,ẜ,ẛ,ẝ,ḿ,ṁ,ṃ,ɱ,ᵯ,ᶆ,ń,ň,ņ,ṋ,ȵ,ṅ,ṇ,ǹ,ɲ,ṉ,ƞ,ᵰ,ᶇ,ɳ,ñ,ǌ,ó,ŏ,ǒ,ô,ố,ộ,ồ,ổ,ỗ,ö,ȫ,ȯ,ȱ,ọ,ő,ȍ,ò,ỏ,ơ,ớ,ợ,ờ,ở,ỡ",traslate_values="A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,AA,AE,AE,AE,AO,AU,AV,AV,AY,B,B,B,B,B,B,C,C,C,C,C,C,C,C,D,D,D,D,D,D,D,D,D,D,D,DZ,DZ,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,ET,F,F,G,G,G,G,G,G,G,G,G,H,H,H,H,H,H,H,H,H,I,I,I,I,I,I,I,I,I,I,I,I,I,I,I,I,I,D,F,G,R,S,T,IS,J,J,K,K,K,K,K,K,K,K,K,K,L,L,L,L,L,L,L,L,L,L,L,L,L,L,LJ,M,M,M,M,N,N,N,N,N,N,N,N,N,N,N,N,NJ,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,OI,OO,E,O,OU,P,P,P,P,P,P,P,Q,Q,R,R,R,R,R,R,R,R,R,R,R,C,E,S,S,S,S,S,S,S,S,S,S,T,T,T,T,T,T,T,T,T,T,T,A,L,M,V,TZ,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,V,V,V,V,VY,W,W,W,W,W,W,W,X,X,Y,Y,Y,Y,Y,Y,Y,Y,Y,Y,Y,Y,Z,Z,Z,Z,Z,Z,Z,Z,Z,IJ,OE,A,AE,B,B,C,D,E,F,G,G,H,I,R,J,K,L,L,M,N,O,OE,O,OU,P,R,N,R,S,T,E,R,U,V,W,Y,Z,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,aa,ae,ae,ae,ao,au,av,av,ay,b,b,b,b,b,b,b,b,o,c,c,c,c,c,c,c,c,c,d,d,d,d,d,d,d,d,d,d,d,d,d,d,i,j,j,j,dz,dz,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,et,f,f,f,f,g,g,g,g,g,g,g,g,g,g,h,h,h,h,h,h,h,h,h,h,h,hv,i,i,i,i,i,i,i,i,i,i,i,i,i,i,i,i,i,d,f,g,r,s,t,is,j,j,j,j,k,k,k,k,k,k,k,k,k,k,k,l,l,l,l,l,l,l,l,l,l,l,l,l,l,l,l,l,lj,s,s,s,s,m,m,m,m,m,m,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,nj,o,o,o,o,o,o,o,o,o,o,o,o,o,o,o,o,o,o,o,o,o,o,o,o",keys=_.split(translate_keys,","),values=_.split(traslate_values,",");_.forEach(keys,function(key,index){dict[key]=values[index]})}function removeStringAccents(input){var inputCharArr=_.toArray(input);_.forEach(inputCharArr,function(char,index){_.isNil(dict[char])||(inputCharArr[index]=dict[char])});var result=_.join(inputCharArr,"");return result}function getRegexFromGlobalConfig(key,defaultRegex){var regex=defaultRegex,regexMap=lodash.get(globalConfig,key);return lodash.isNil(regexMap)||lodash.isNil(regexMap.pattern)||lodash.isNil(regexMap.flags)||(regex=new RegExp(regexMap.pattern,regexMap.flags)),regex}function pipefyItemsByComma(commaSeperatedDeviceSKUs){return commaSeperatedDeviceSKUs.replace(/,/g,"|")}function isCommerceV3URL(url){return url&&url.indexOf("commerce/v3/")>=0}function isEOSURL(url){return url&&url.indexOf("credit-screen/v1")>=0||url&&url.indexOf("credit-screen/v2")>=0||url&&url.indexOf("publickey")>=0}function isLexisNexisUrl(url){return url&&url.indexOf("lexis-nexis")>=0}var transformMap=[{mapCode:"cartLineItem1",mapItems:[{srcExp:"plan.dataServiceSoc",destPath:"lineItemDetails.planDetails.socs.dataService"},{srcExp:"plan.ratePlanSoc",destPath:"lineItemDetails.planDetails.socs.ratePlan"}]},{mapCode:"cartObject1",mapItems:[{srcExp:"lineOfServices[n].service[n].productType",destPath:"lineItem[n].detail.service[n].individualAttributeProductType"},{srcExp:"value:I am hero",destPath:"lineItem[0].lineItemDetails[2].customValue"},{srcExp:'lineOfServices[?(@.lineNo=="1" || @.lineNo=="3")][n].service[n].producType',destPath:"lineItem[n].detail.service[n].novalue"},{srcExp:"lineOfServices[n].service[n].productType",destPath:"lineItem[n].detail.service[n].product.subLevel.productType"},{srcExp:"lineOfServices[n].service[n].description",destPath:"lineItem[n].detail.service[n].desc.subDescription"},{srcExp:"lineOfServices[n].device.sku",destPath:'lineItem[n].assignCustomSku.sku={"custom sku":"X!@@#!@#D"}'},{srcExp:"lineOfServices[n].service[n]",destPath:"lineItem_today[n].arrayOfServivice.subServices[n]"},{srcExp:"plan.dataServiceSoc",destPath:"lineItemDetails.planDetails.socs.dataService"},{srcExp:"plan.ratePlanSoc",destPath:"lineItemDetails.planDetails.socs.ratePlan"},{srcExp:"plan.ratePlanSoc",destPath:"lineItemDetails.planDetails.socs.ratePlan=hello"},{srcExp:'json:{"test":"value","secondJsonData":{"name":"myname"}}',destPath:"line.item.customjson"}]},{mapCode:"cartObject2",mapItems:[{srcExp:'json:{"test":"test1","test2":{"name":"myname"}}',destPath:"line.item.customjson"}]}],dict={};return loadDictionary(),{urlParser:urlParser,searchJson:searchJson,searchJsonArray:searchJsonArray,convertPathToJson:convertPathToJson,transformByMap:transformByMap,sortCollection:sortCollection,removeStringAccents:removeStringAccents,getRegexFromGlobalConfig:getRegexFromGlobalConfig,pipefyItemsByComma:pipefyItemsByComma,isCommerceV3URL:isCommerceV3URL,isEOSURL:isEOSURL,isLexisNexisUrl:isLexisNexisUrl}}commonUtilsConstructor.$inject=["$log","jsonPath","globalValue","globalConfig"],angular.module("tmobileCore").factory("commonUtils",commonUtilsConstructor)}(window.angular,window._),function(angular){"use strict";function commonStorageServiceConstructor($cookies,apiURLs,$sessionStorage,$localStorage,globalConfig,$location,CacheFactory,$document){function setTokenFromCookie(){var token=$cookies.getObject("token");token&&(commonStorage.token=token.access_token)}function setTokenFromSession(){var token=localStorage.getItem("token");token&&(commonStorage.token=angular.fromJson(token).access_token)}function setToken(token){commonStorage.token=token}function getToken(){return angular.equals(apiURLs.storage,"localStorage")?setTokenFromSession():setTokenFromCookie(),commonStorage.token}function setCookieExpiry(cookieOptions){try{cookieOptions.expires=new Date(angular.fromJson(localStorage.getItem("jwt_token")).expiry)}catch(ex){}}function assignIntoSharedCookie(key,value){var cookieOptions,_globalSharedData=$cookies.getObject("tmobglobalshareddata");_globalSharedData?_globalSharedData[key]=value:(_globalSharedData={},_globalSharedData[key]=value),$location.host()&&$location.host().search(globalConfig.cookieOption.domain)<0&&(globalConfig.cookieOption.domain=$location.host()),cookieOptions=angular.copy(globalConfig.cookieOption||{}),setCookieExpiry(cookieOptions),$cookies.putObject("tmobglobalshareddata",_globalSharedData,cookieOptions),key===counterName&&fireUNAVEvent()}function fireUNAVEvent(){var event=new CustomEvent("unavBadgeEvent",{bubbles:!0,cancelable:!0,detail:"cart"});window.dispatchEvent(event)}function updateCartCounter(operand){var currentCounter=parseInt(getFromSharedCookie(counterName)||0,10),updatedCounter=currentCounter+operand;assignIntoSharedCookie(counterName,updatedCounter)}function removeFromSharedCookie(key){var cookieOptions,_globalSharedData=$cookies.getObject("tmobglobalshareddata");delete _globalSharedData[key],$location.host()&&$location.host().search(globalConfig.cookieOption.domain)<0&&(globalConfig.cookieOption.domain=$location.host()),cookieOptions=angular.copy(globalConfig.cookieOption||{}),setCookieExpiry(cookieOptions),$cookies.putObject("tmobglobalshareddata",_globalSharedData,cookieOptions)}function assignIntoSharedTmoCookie(key,value){$location.host()&&$location.host().search(globalConfig.cookieOption.domain)<0&&(globalConfig.cookieOption.domain=$location.host());var baseDomain=globalConfig.cookieOption.domain;if(value=JSON.stringify(value),"tmo2mytmo"===key){var expireAfter=new Date;expireAfter.setDate(expireAfter.getDate()+2),$document.context.cookie=key+"="+value+"; domain="+baseDomain+"; expires="+expireAfter+"; path=/"}else $document.context.cookie=key+"="+value+"; domain="+baseDomain+"; path=/"}function getFromSharedCookie(key){var _value,_globalSharedData=$cookies.getObject("tmobglobalshareddata");return _globalSharedData&&(_value=_globalSharedData[key]),_value}function assignIntoSharedSession(key,value){var _globalSharedData=$sessionStorage.tmobglobalshareddata;_globalSharedData?_globalSharedData[key]=value:(_globalSharedData={},_globalSharedData[key]=value),$sessionStorage.tmobglobalshareddata=_globalSharedData}function getFromSharedSession(key){var _value,_globalSharedData=$sessionStorage.tmobglobalshareddata;return _globalSharedData&&(_value=_globalSharedData[key]),_value}function assignIntoSharedLS(key,value){var _globalSharedData=$localStorage.tmobglobalshareddata;_globalSharedData?_globalSharedData[key]=value:(_globalSharedData={},_globalSharedData[key]=value),$localStorage.tmobglobalshareddata=_globalSharedData}function removeFromSharedSLS(key){var _globalSharedData=$localStorage.tmobglobalshareddata;return _globalSharedData&&delete _globalSharedData[key],_globalSharedData}function getFromSharedSLS(key){var _value,_globalSharedData=$localStorage.tmobglobalshareddata;return _globalSharedData&&(_value=_globalSharedData[key]),_value}function getCacheObject(storageMode,expire){var cacheName="tmobglobalshareddata.cache",cacheConf={storagePrefix:"tmng.",deleteOnExpire:"aggressive"};return expire&&(cacheConf.maxAge=expire),storageMode&&(cacheName=cacheName+"."+storageMode,cacheConf.storageMode=storageMode),CacheFactory.get(cacheName)||CacheFactory.createCache(cacheName,cacheConf),CacheFactory.get(cacheName)}function assignIntoSharedCache(key,value,storageMode,expireInMs){dataCache=getCacheObject(storageMode,expireInMs),dataCache.put(key,value)}function getFromSharedCache(key,storageMode){dataCache=getCacheObject(storageMode);var getData=dataCache.get(key);return getData}function destroyCacheObject(){dataCache=getCacheObject(),dataCache.destroy()}function clearAll(){$localStorage.$reset(),$sessionStorage.$reset(),destroyCacheObject();var cookies=$cookies.getAll();angular.forEach(cookies,function(v,k){$cookies.remove(k)})}var dataCache,commonStorage={},counterName="cartCounter";return{setToken:setToken,getToken:getToken,clearAll:clearAll,assignIntoSharedCookie:assignIntoSharedCookie,assignIntoSharedTmoCookie:assignIntoSharedTmoCookie,getFromSharedCookie:getFromSharedCookie,assignIntoSharedSession:assignIntoSharedSession,getFromSharedSession:getFromSharedSession,assignIntoSharedLS:assignIntoSharedLS,getFromSharedSLS:getFromSharedSLS,removeFromSharedSLS:removeFromSharedSLS,getCacheObject:getCacheObject,destroyCacheObject:destroyCacheObject,assignIntoSharedCache:assignIntoSharedCache,getFromSharedCache:getFromSharedCache,removeFromSharedCookie:removeFromSharedCookie,updateCartCounter:updateCartCounter}}commonStorageServiceConstructor.$inject=["$cookies","apiURLs","$sessionStorage","$localStorage","globalConfig","$location","CacheFactory","$document"],angular.module("tmobileCore").service("commonStorage",commonStorageServiceConstructor)}(angular),function(angular,lodash){"use strict";function transformCartFactoryV3($rootScope,creditClassService,toggleService,globalAssetRepositoryConstants,globalConfig,commonUtils,cartStorage,cartConstants,globalValue,commonStorage,checkOutConstants){function _makeAmountAttributes(jsonData){var _amount00=_searchJsonPathArray(jsonData,"[?(@.amount00 == 0)]");return angular.forEach(_amount00,function(v){if(angular.isDefined(v.amount)){v.amount00=v.amount.toFixed(2);var splitAmount=v.amount00.split(".");v.amountDollar=splitAmount[0],v.amountCents=splitAmount[1]}}),jsonData}function getGARImagePath(imgPath){var imagePath=imgPath;return toggleService.model.toggles.enableGar&&_.includes(imgPath,"/content/dam")&&(imagePath=globalAssetRepositoryConstants.url+imgPath),imagePath}function _createPriceBaseObject(priceSource){var priceObject={amount:priceSource?parseFloat(priceSource.amount):void 0,amount00:0,amountDisplay:lodash.get(priceSource,"display")};return priceObject}function _productPayNowMonthlyPrice(_product){var productPayNowListPrice,productPayNowPurChasePrice,productMonthlyPaymentPrice,refundableDeposit,deposit,productPriceListPrice,productPricePurChasePrice,productMonthlyPrice,productMonthlyPurchasePrice,productCatalogListPrice,productCatalogPurChasePrice;productMonthlyPrice=_searchJsonPath(_product,"contractTerm"),productPayNowListPrice=_searchJsonPath(_product,"priceSummary.payNowPrice.listPrice"),productPayNowPurChasePrice=_searchJsonPath(_product,"priceSummary.payNowPrice.salePrice"),productCatalogListPrice=_searchJsonPath(_product,"catalogPrice.listPrice"),productCatalogPurChasePrice=_searchJsonPath(_product,"catalogPrice.salePrice"),productMonthlyPaymentPrice=_searchJsonPath(_product,"priceSummary.monthlyPrice.listPrice"),productMonthlyPurchasePrice=_searchJsonPath(_product,"priceSummary.monthlyPrice.salePrice"),productPriceListPrice=productPayNowListPrice,productPricePurChasePrice=productPayNowPurChasePrice,refundableDeposit=_searchJsonPath(_product,"deposit"),deposit=_searchJsonPath(_product,"deposit");var wholePrice={payNowPrice:{listPrice:_createPriceBaseObject(productPayNowListPrice),purchasePrice:_createPriceBaseObject(productPayNowPurChasePrice)},monthlyPrice:_createPriceBaseObject(productMonthlyPaymentPrice),monthlyPurchasePrice:_createPriceBaseObject(productMonthlyPurchasePrice),price:{listPrice:_createPriceBaseObject(productPriceListPrice),purchasePrice:_createPriceBaseObject(productPricePurChasePrice)},catalogPrice:{listPrice:_createPriceBaseObject(productCatalogListPrice),purchasePrice:_createPriceBaseObject(productCatalogPurChasePrice)},refundableDeposit:_createPriceBaseObject(refundableDeposit),deposit:_createPriceBaseObject(deposit)};return wholePrice.monthlyPrice.termMonths=productMonthlyPrice,wholePrice.monthlyPurchasePrice.termMonths=productMonthlyPrice,wholePrice}function _simCardPayNowMonthlyPrice(_product){var productPayNowListPrice,productPayNowPurChasePrice,productSimKitListPrice,listPrice=_searchJsonPath(_product,"listPrice"),salePrice=_searchJsonPath(_product,"salePrice");productSimKitListPrice=listPrice?listPrice:void 0,productPayNowListPrice=salePrice?salePrice:void 0,productPayNowPurChasePrice=salePrice?salePrice:void 0;var wholePrice={payNowPrice:{listPrice:_createPriceBaseObject(productPayNowListPrice),purchasePrice:_createPriceBaseObject(productPayNowPurChasePrice)},simKitListPrice:_createPriceBaseObject(productSimKitListPrice),price:{listPrice:_createPriceBaseObject(productPayNowListPrice),purchasePrice:_createPriceBaseObject(productPayNowPurChasePrice)}};return wholePrice;
}function _lineTotalPayNowMonthlyPrice(_product){var productPayNowPrice,productMonthlyPrice,refundPrice,totalPrice,subTotalPayNowPrice,subTotalMonthlyPrice;productPayNowPrice=_searchJsonPath(_product,"priceSummary.payNowPrice.salePrice"),productMonthlyPrice=_searchJsonPath(_product,"priceSummary.monthlyPrice.salePrice"),refundPrice=_searchJsonPath(_product,"deposit"),totalPrice=_searchJsonPath(_product,"tax.totalTax"),subTotalPayNowPrice=productPayNowPrice,subTotalMonthlyPrice=productMonthlyPrice;var wholePrice={payNowPrice:_createPriceBaseObject(productPayNowPrice),monthlyPrice:_createPriceBaseObject(productMonthlyPrice),refundableDesposit:{amount:refundPrice?parseFloat(refundPrice.salePrice.amount):void 0,amount00:0,amountDisplay:refundPrice},total:{amount:totalPrice?parseFloat(totalPrice.amount):void 0,amount00:0,amountDisplay:totalPrice},subTotalPayNowPrice:_createPriceBaseObject(subTotalPayNowPrice),subTotalMonthlyPrice:_createPriceBaseObject(subTotalMonthlyPrice)};return wholePrice}function _cartPayNowMonthlyPrice(_product){var productPayNowPrice,productMonthlyPrice,refundPrice,totalPrice,subTotalPayNowPrice,subTotalMonthlyPrice,totalPayNowPrice,totalMonthlyPrice;productPayNowPrice=_searchJsonPath(_product,"total.payNowPrice.salePrice"),productMonthlyPrice=_searchJsonPath(_product,"total.monthlyPrice.salePrice"),totalPayNowPrice=_searchJsonPath(_product,"total.payNowPrice.salePrice"),totalMonthlyPrice=_searchJsonPath(_product,"total.monthlyPrice.salePrice"),refundPrice=_searchJsonPath(_product,"deposit"),totalPrice=_searchJsonPath(_product,"tax.totalTax"),subTotalPayNowPrice=_searchJsonPath(_product,"subTotal.priceSummary.payNowPrice.salePrice"),subTotalMonthlyPrice=_searchJsonPath(_product,"subTotal.priceSummary.monthlyPrice.salePrice");var wholePrice={payNowPrice:_createPriceBaseObject(productPayNowPrice),monthlyPrice:_createPriceBaseObject(productMonthlyPrice),refundableDesposit:{amount:refundPrice?parseFloat(refundPrice.amount):void 0,amount00:0,amountDisplay:refundPrice},total:{amount:totalPrice?parseFloat(totalPrice.amount):void 0,amount00:0,amountDisplay:totalPrice},subTotalPayNowPrice:_createPriceBaseObject(subTotalPayNowPrice),subTotalMonthlyPrice:_createPriceBaseObject(subTotalMonthlyPrice),totalPayNowPrice:_createPriceBaseObject(totalPayNowPrice),totalMonthlyPrice:_createPriceBaseObject(totalMonthlyPrice)};return wholePrice}function _getAccessoryDetails(cartData){var accessoryTotalPrice,accessoryDetails=[],accessories={},accessoryElements=cartData.accessories,accessoryDetails=lodash.map(accessoryElements,function(accessoryObject){var listPrice=_searchJsonPath(accessoryObject,"price.priceSummary.payNowPrice.listPrice"),purchasePrice=_searchJsonPath(accessoryObject,"price.priceSummary.payNowPrice.salePrice"),monthlyPrice=_searchJsonPath(accessoryObject,"price.priceSummary.monthlyPrice.salePrice"),catalogSalePrice=_searchJsonPath(accessoryObject,"price.catalogPrice.salePrice"),catalogListPrice=_searchJsonPath(accessoryObject,"price.catalogPrice.listPrice"),priceListPrice=_searchJsonPath(accessoryObject,"price.catalogPrice.listPrice"),pricePurchasePrice=_searchJsonPath(accessoryObject,"price.catalogPrice.salePrice"),totalAccessoryPrice=_searchJsonPath(accessoryObject,"pricing.total"),fullImageUrl=lodash.get(accessoryObject,"imageUrl")?lodash.get(accessoryObject,"imageUrl"):lodash.get(accessoryObject,"imageURL");return{isProductAdded:!0,availablity:lodash.get(accessoryObject,"availablity"),availableToDate:lodash.get(accessoryObject,"availableToDate"),availableFromDate:lodash.get(accessoryObject,"availableFromDate"),id:lodash.get(accessoryObject,"id"),accessoryType:lodash.get(accessoryObject,"offerType"),accessorySubType:lodash.get(accessoryObject,"offerSubType"),sku:lodash.get(accessoryObject,"upc"),familyName:lodash.get(accessoryObject,"familyName"),offerId:lodash.get(accessoryObject,"offerId"),quantity:lodash.get(accessoryObject,"quantity"),color:lodash.get(accessoryObject,"color"),colorSwatch:accessoryObject.colorSwatch?getGARImagePath(accessoryObject.colorSwatch):"",productImage:getGARImagePath(fullImageUrl),skuName:lodash.get(accessoryObject,"familyName"),manufacturer:lodash.get(accessoryObject,"manufacturer"),paymentOption:lodash.get(accessoryObject,"selectedPricingOption"),promotions:lodash.get(accessoryObject,"price.promotions"),productType:lodash.get(accessoryObject,"accessoryType"),statusValue:lodash.get(accessoryObject,"inventoryStatus"),payNowPrice:{listPrice:_createPriceBaseObject(listPrice),purchasePrice:_createPriceBaseObject(purchasePrice)},catalogPrice:{listPrice:_createPriceBaseObject(catalogListPrice),purchasePrice:_createPriceBaseObject(catalogSalePrice)},monthlyPrice:{amount:_searchJsonPath(monthlyPrice,"amount"),amountDisplay:_searchJsonPath(monthlyPrice,"display"),termMonths:_searchJsonPath(accessoryObject,"price.priceSummary.monthlyPrice.contractTerm"),amount00:0},priceDetails:{listPrice:_createPriceBaseObject(priceListPrice),purchasePrice:_createPriceBaseObject(pricePurchasePrice)},totalPrice:_createPriceBaseObject(totalAccessoryPrice)}});cartData.accessoriesTotal&&(accessoryTotalPrice=cartData.accessoriesTotal[0]);var accPriceDetails=_createPriceBaseObject(_searchJsonPath(accessoryTotalPrice,"payNowPrice.listPrice")),accPayNowPrice=_createPriceBaseObject(_searchJsonPath(accessoryTotalPrice,"payNowPrice.salePrice")),accMonthlyPrice=_createPriceBaseObject(_searchJsonPath(accessoryTotalPrice,"monthlyPrice.salePrice"));return accessories={mvcAttrs:{},accessoryDetails:accessoryDetails,isAccessoryEIPEligible:_searchJsonPath(cartData,"accessoriesEipEligible"),priceDetails:accPriceDetails,payNowPrice:accPayNowPrice,monthlyPrice:accMonthlyPrice}}function _getShippingOption(cartData){var shippingOptions=cartData.shippingOptions,selectedShippingOption={};return angular.isDefined(shippingOptions)&&(selectedShippingOption={name:shippingOptions.displayName,selected:cartConstants.OTHERS.TRUE,cost:shippingOptions.cost.amount,costValue:shippingOptions.cost.amount,carrier:shippingOptions.carrier}),selectedShippingOption}function getServiceDetails(lineData){var serviceDetails=[],preServiceDetails=_searchJsonPathArray(lineData,"services");if(preServiceDetails){preServiceDetails=preServiceDetails[0];var serviceDetails=lodash.map(preServiceDetails,function(serviceItem){var wholePrice=serviceItem.price?_productPayNowMonthlyPrice(serviceItem.price):void 0,transformedServieObj={isProductAdded:lodash.get(serviceItem,"upc")?!0:!1,offerType:lodash.get(serviceItem,"offerType"),upc:lodash.get(serviceItem,"upc"),familyName:lodash.get(serviceItem,"familyName"),serviceSOCs:void 0,payNowPrice:lodash.get(wholePrice,"payNowPrice"),isSelected:!0,enabled:!0,isAvailable:!0,monthlyPrice:lodash.get(wholePrice,"monthlyPrice"),pricing:lodash.get(serviceItem,"price.priceSummary.monthlyPrice.salePrice"),promotions:lodash.get(serviceItem,"price.promotions"),serviceCategory:lodash.get(serviceItem,"category"),serviceId:lodash.get(serviceItem,"upc"),lineNumber:lodash.get(lineData,"lineNumber"),serviceName:lodash.get(serviceItem,"familyName")};if(toggleService.model.toggles.isTaxesEnabled){var taxInclusive=lodash.get(serviceItem,"taxInclusive");transformedServieObj.isTaxInclusive=0==taxInclusive?!1:!0}return transformedServieObj})}return serviceDetails}function _getFormattedDate(dateValue){if(angular.isDefined(dateValue)){var myDate=new Date(dateValue);if(myDate=moment(myDate),myDate.isValid())return myDate.format("M/D")}return""}function _getFinalShippingDate(lineItems,accessories){var dates={availFromDate:"",availToDate:""};return lodash.forEach(lineItems,function(lineItem){var deviceDetails=lineItem.simKitDetails.isBYODAdded?lineItem.simKitDetails:lineItem.lineItemDetails.deviceDetails,shippingAvailToDateTime=""===dates.availToDate?0:new Date(dates.availToDate).getTime(),lineItemAvailToDateTime=""===deviceDetails.availableToDate?0:new Date(deviceDetails.availableToDate).getTime();deviceDetails.availableFromDate&&deviceDetails.availableToDate&&lineItemAvailToDateTime>shippingAvailToDateTime&&_setFinalShippingDate(dates,deviceDetails)}),lodash.forEach(accessories.accessoryDetails,function(accDetails){var shippingAvailToDateTime=""===dates.availToDate?0:new Date(dates.availToDate).getTime(),accAvailToDateTime=""===accDetails.availableToDate?0:new Date(accDetails.availableToDate).getTime();accDetails.availableFromDate&&accDetails.availableToDate&&accAvailToDateTime>shippingAvailToDateTime&&_setFinalShippingDate(dates,accDetails)}),dates.availFromDate=_getFormattedDate(dates.availFromDate),dates.availToDate=_getFormattedDate(dates.availToDate),dates}function _setFinalShippingDate(dates,detailsObj){return dates.availFromDate=detailsObj.availableFromDate,dates.availToDate=detailsObj.availableToDate,dates}function _getCartPromotions(cartPromotions){var promotions=[];return cartPromotions&&cartPromotions.length>0&&(promotions=lodash.filter(cartPromotions,function(promo){return"CART"===promo.promoType})),lodash.uniqBy(promotions,"promoId")}function _getCustomCartPromotions(cart){var promotions=[];lodash.forEach(cart.lines,function(line){line.device.price&&line.device.price.promotions&&line.device.price.promotions.length>0&&lodash.forEach(line.device.price.promotions,function(promo){"CART"===promo.promoType&&promo.promoCode&&promotions.push(promo)})}),lodash.forEach(cart.accessories,function(accessory){accessory.price&&accessory.price.promotions&&accessory.price.promotions.length>0&&lodash.forEach(accessory.price.promotions,function(promo){"CART"===promo.promoType&&promo.promoCode&&promotions.push(promo)})});var cartPromotions=_getCartPromotions(_searchJsonPath(cart.pricing,"subTotal.promotions"));return cartPromotions&&promotions.concat(cartPromotions),lodash.uniqBy(promotions,"promoId")}function _getMiniBrowseEIPPrices(cart){var isAccessoryEIP=!1;return cart.accessories&&cart.accessoriesEipEligible?lodash.forEach(cart.accessories,function(accessory){"EIP"===accessory.selectedPricingOption&&(isAccessoryEIP=!0)}):isAccessoryEIP=!1,isAccessoryEIP}function getGARImagePathForOfferModal(longDes){var longDescription=longDes;return toggleService.model.toggles.enableGar&&_.includes(longDes,"/content/dam")&&(longDescription=longDes.replace("/content/dam",globalAssetRepositoryConstants.url+"/content/dam")),longDescription}function _getDevicePromotions(promotions){var cart=[],tradeIn=[],catalog=[];promotions&&promotions.length>0&&lodash.forEach(promotions,function(promo){switch(promo.promoType){case"CART":promo.longDescription=getGARImagePathForOfferModal(promo.longDescription),cart.push(promo);break;case"CATALOG":promo.longDescription=getGARImagePathForOfferModal(promo.longDescription),catalog.push(promo);break;case"TRADEIN":promo.longDescription=getGARImagePathForOfferModal(promo.longDescription),tradeIn.push(promo);break;default:angular.noop()}});var devicePromotions={cart:cart,catalog:catalog,tradeIn:tradeIn};return devicePromotions}function _getDeviceDetails(lineData){var deviceElement=_searchJsonPath(lineData,"device"),wholeDevicePrice=deviceElement.price?_productPayNowMonthlyPrice(deviceElement.price):void 0,fullImageUrl=lodash.get(deviceElement,"imageUrl")?lodash.get(deviceElement,"imageUrl"):lodash.get(deviceElement,"imageURL"),deviceDetails={id:deviceElement.id,productType:deviceElement.offerType,productSubType:deviceElement.offerSubtype,availableFromDate:deviceElement.availableFromDate,availableToDate:deviceElement.availableToDate,sku:deviceElement.upc,deviceId:deviceElement.deviceId,familyId:deviceElement.familyId,familyName:deviceElement.manufacturer+" "+lodash.get(deviceElement,"offerName"),quantity:1,memory:deviceElement.memory?deviceElement.memory:void 0,color:deviceElement.color,isHandset:angular.equals(deviceElement.offerSubType,"Handset")?!0:!1,isTablet:angular.equals(deviceElement.offerSubType,"Tablet")?!0:!1,isWearable:angular.equals(deviceElement.offerSubtype,"Wearable")?!0:!1,colorSwatch:deviceElement.colorSwatch?getGARImagePath(deviceElement.colorSwatch):"",manufacturer:deviceElement.manufacturer,frontImage:getGARImagePath(fullImageUrl),memoryUOM:deviceElement.memoryUom,description:deviceElement.description,promotions:_getDevicePromotions(_searchJsonPath(deviceElement,"price.promotions")),devicePromotionalCredits:_getDevicePromotionalCredits(_searchJsonPath(deviceElement,"price.promotions")),credits:_searchJsonPath(deviceElement,"price.credits"),catalogPrice:lodash.get(wholeDevicePrice,"catalogPrice"),payNowPrice:lodash.get(wholeDevicePrice,"payNowPrice"),monthlyPrice:lodash.get(wholeDevicePrice,"monthlyPurchasePrice"),priceDetails:lodash.get(wholeDevicePrice,"price"),refundableDeposit:lodash.get(wholeDevicePrice,"refundableDeposit"),deposit:lodash.get(wholeDevicePrice,"deposit"),pricingOption:deviceElement.selectedPricingOption,statusValue:deviceElement.inventoryStatus,totalPrice:{totalPriceDisplay:wholeDevicePrice?wholeDevicePrice.price.listPrice.amountDisplay:void 0},contractTerms:lodash.get(wholeDevicePrice,"monthlyPrice.termMonths"),simType:lodash.get(deviceElement,"simType")};return deviceDetails}function _getPlanDetails(lineData){angular.isDefined(lineData.plan)&&angular.isDefined(lineData.plan.dataOptions)&&(lineData.plan.dataOptions.lineNumber=lineData.lineNumber);var planElement=_searchJsonPath(lineData,"plan"),wholePlanPrice=planElement.price?_productPayNowMonthlyPrice(planElement.price):void 0,planDetails={id:planElement.id,productType:"PLAN",sku:planElement.offerId,description:_searchJsonPathArray(planElement,"description"),familyName:lodash.get(planElement,"familyName"),memory:planElement.memory,planSOCs:planElement.socs,promotions:_searchJsonPath(planElement,"price.promotions"),cartTypePromotion:_getCartPromotions(_searchJsonPath(planElement,"price.promotions")),payNowPrice:lodash.get(wholePlanPrice,"payNowPrice"),monthlyPrice:lodash.get(wholePlanPrice,"monthlyPurchasePrice"),monthlyPurchasePrice:lodash.get(wholePlanPrice,"monthlyPurchasePrice"),planOptionsPrice:lodash.get(planElement,"price.planOptionsPrice"),dataOptionsPrice:lodash.get(planElement,"price.dataOptionsPrice"),dataOptions:lodash.get(planElement,"dataOptions")};return planDetails}function _getTradeInDetails(lineData){return _searchJsonPath(lineData,"tradeIn")}function getMonthlyPaymentDetails(lineData){var globalAuthorValue=globalValue.authorValue,islinePromoEnabled=lodash.get(toggleService.model,"toggles.islinePromoEnabled"),autoPayObject=_searchJsonPath(lineData,'price.promotions[?(@.promoType == "auto_pay")]'),monthlyPymentDetails=[{title:lodash.get(globalAuthorValue,"cart.essentials.lineLabel","Line"),charge:lodash.get(lineData,"plan.price.planOptionsPrice.listPrice.amount",0)}],deviceElement=_searchJsonPath(lineData,"device"),devicePricing={title:lodash.get(globalAuthorValue,"cart.essentials.deviceLabel","Device"),charge:lodash.get(lineData,"device.price.priceSummary.monthlyPrice.salePrice.amount",0)},lineAutoPayDiscount={title:lodash.get(globalAuthorValue,"rootPage.pricing.autoPayDiscountLabel","AutoPay Discount"),charge:lodash.get(autoPayObject,"discountValue.amount",0),discountPromotion:!0};if(islinePromoEnabled){monthlyPymentDetails.push(lineAutoPayDiscount);var planPromotions=_searchJsonPath(lineData,"plan.price.promotions");_pushLinePromotiomToLine(planPromotions,monthlyPymentDetails)}if(monthlyPymentDetails.push(devicePricing),islinePromoEnabled){var devicePromotions=_getDevicePromotions(_searchJsonPath(deviceElement,"price.promotions"));_pushDevicePromotiomToLineLevel(devicePromotions.cart,monthlyPymentDetails)}return monthlyPymentDetails}function _pushDevicePromotiomToLineLevel(promoElement,monthlyPymentDetails){angular.forEach(promoElement,function(promo){var promotionalCredits;if(angular.isDefined(promo.promotionalCredits)&&(promotionalCredits=lodash.find(promo.promotionalCredits,{creditType:"RECURRING"}))){var obj={title:promo.promoName,charge:promotionalCredits.recurringAmount,discountPromotion:!0};monthlyPymentDetails.push(obj)}})}function _pushLinePromotiomToLine(promoElement,monthlyPymentDetails){angular.forEach(promoElement,function(promo){var promotionalCredits;if("CART"===promo.promoType){angular.isDefined(promo.promotionalCredits)&&(promotionalCredits=lodash.find(promo.promotionalCredits,{creditType:"RECURRING"}));var obj={title:promo.promoName,charge:angular.isDefined(promotionalCredits)?promotionalCredits.recurringAmount:promo.discountValue.amount,discountPromotion:!0};monthlyPymentDetails.push(obj)}})}function _getDevicePromotionalCredits(promotions){var promotionalCreditArray=[],cartPromotions=_getCartPromotions(promotions);return lodash.isEmpty(cartPromotions)||angular.forEach(cartPromotions,function(promo){if(angular.isDefined(promo.promotionalCredits)){var promoCredit=lodash.find(promo.promotionalCredits,{creditType:"RECURRING"});promoCredit&&promotionalCreditArray.push({promoName:promo.promoName,charge:promoCredit.recurringAmount})}}),promotionalCreditArray}function _getSimKitDetails(lineData,isBYODAdded){var simKitElement,wholeSimKitPrice,simKitName,simKitDetails={},globalAuthorValue=globalValue.authorValue,kittedSim=getKittedSimObject(lineData);return isBYODAdded?(simKitElement=_searchJsonPath(lineData,"device"),wholeSimKitPrice=simKitElement?_simCardPayNowMonthlyPrice(simKitElement.price.priceSummary.payNowPrice):void 0,simKitName=lodash.get(simKitElement,"manufacturer")+" "+lodash.get(simKitElement,"offerName"),simKitDetails=_setSimKitInfo(lodash.get(simKitElement,"description"),wholeSimKitPrice,lodash.get(simKitElement,"upc"),simKitName),simKitDetails.promotions=_getDevicePromotions(_searchJsonPath(simKitElement,"price.promotions")),simKitDetails.availableFromDate=simKitElement.availableFromDate,simKitDetails.availableToDate=simKitElement.availableToDate,simKitDetails.statusValue=simKitElement.inventoryStatus):lodash.get(toggleService.model,"toggles.isSimKitEnabled")&&!lodash.isEmpty(kittedSim)&&(wholeSimKitPrice=kittedSim?_simCardPayNowMonthlyPrice(kittedSim):void 0,simKitName=lodash.get(globalAuthorValue.rootPage.pricingBreakdown,"simCardLabel"),simKitDetails=_setSimKitInfo(lodash.get(kittedSim,"description"),wholeSimKitPrice,lodash.get(kittedSim,"sku"),simKitName)),simKitDetails}function _setSimKitInfo(description,wholeSimKitPrice,simKitId,simKitName){var simKitDetails={productName:"SIM Card",simKitId:simKitId,simKitName:simKitName,description:description,payNowPrice:lodash.get(wholeSimKitPrice,"payNowPrice"),priceDetails:lodash.get(wholeSimKitPrice,"price"),listPrice:lodash.get(wholeSimKitPrice,"simKitListPrice")};return simKitDetails}function getKittedSimObject(lineItem){var kittedSim={},simType=lineItem.device.simType;return simType&&simType.toLowerCase()===cartConstants.P_SIM.toLowerCase()&&lineItem.charges&&lineItem.lineType!==cartConstants.DEVICE_TYPE.WEARABLE&&(kittedSim=lodash.find(lineItem.charges,{chargeType:"KittedSim"})),kittedSim}function _getAuditRecords(checkOutData){var autoPay=_searchJsonPath(checkOutData,'auditRecords[?(@["auditKey"]=="AUTO_PAY")].auditValue'),storePayment=_searchJsonPath(checkOutData,'auditRecords[?(@["auditKey"]=="STORE_PAYMENT")].auditValue'),auditRecords={isActualAutoPay:autoPay,isActualStorePayment:storePayment};return autoPay=angular.isDefined(autoPay)?angular.fromJson(autoPay):!0,storePayment=angular.isDefined(storePayment)?angular.fromJson(storePayment):!0,auditRecords.isAutoPay=autoPay,auditRecords.isStorePayment=storePayment,auditRecords}function _getCartTradeInType(lines){var cartTradeInType,tradeInTypes=lines.reduce(function(mappedArray,line){return angular.isDefined(line.tradeInDetails)&&mappedArray.indexOf(line.tradeInDetails.tradeInType)<0&&mappedArray.push(line.tradeInDetails.tradeInType),mappedArray},[]);return cartTradeInType=0===tradeInTypes.length?void 0:1===tradeInTypes.length?tradeInTypes[0]:"MIXED"}function _getStructuredCheckOutSubTotal(checkOutData){var amountDisplay=_searchJsonPath(checkOutData,'initData.selectedShippingOptions[?(@.selected==="true")].cost'),taxTotal=_searchJsonPath(checkOutData,"pricing.tax.totalTax"),monthlyPrice=_searchJsonPath(checkOutData,"pricing.total.monthlyPrice.salePrice"),payNowPrice=_searchJsonPath(checkOutData,"pricing.total.payNowPrice.salePrice"),shippingFee={display:amountDisplay,amount:amountDisplay?parseFloat(amountDisplay.replace(/\$|,/g,"")):amountDisplay,amount00:0,amountDisplay:amountDisplay},allTotal={subTotal:{tax:{total:_createPriceBaseObject(taxTotal)},shippingFee:_createPriceBaseObject(shippingFee),oneTimeFee:{amount:0,amount00:0,amountDisplay:"$0.00"}},total:{monthlyPrice:_createPriceBaseObject(monthlyPrice),payNowPrice:_createPriceBaseObject(payNowPrice)}};return commonUtils.transformByMap("transformCheckOutSubTotal",checkOutData,allTotal),_makeAmountAttributes(allTotal),allTotal}function _getStructuredCartDetails(myCart){if(!myCart.cart)return{flags:{},error:"error"};var isAutoPay=commonStorage.getFromSharedSLS(checkOutConstants.AUTO_PAY_TOGGLE),cartLineItem=myCart.cart.lines,cartSettings=globalConfig.cartSettings,lineItems=[],orderGroupData={},isTabletLineAvailable=angular.isUndefined(_searchJsonPathArray(lineItems,'[?(@.lineType=="TABLET")]'))[0]?!1:!0,orderStatusOrder=cartSettings.orderStatusOrder;orderStatusOrder||(orderStatusOrder={AVAILABLE_FOR_BACK_ORDER:{orderGroup:0,orderDisplay:"Back Order"},AVAILABLE_FOR_PRE_ORDER:{orderGroup:1,orderDisplay:"Pre Order"},AVAILABLE:{orderGroup:2,orderDisplay:"Your Order"}});var phpServiceName=lodash.get(cartSettings,"line.service.phpServiceName","Premium Handset Protection"),accessoryIncluded=!1,isBYODOnly=!0,isDeviceEIP=!1,isTradeInDeviceIncluded=!1,isCartPromoCodeExists=!1,isDevicePromoCodeExists=!1,isTotalMonthlyTaxed=!0;angular.forEach(cartLineItem,function(element){var orderAvail=_searchJsonPath(element,"device.availability"),orderGroup=0,orderAvailDisplay="",orderStatusOrderValue=orderStatusOrder[orderAvail];orderStatusOrderValue?(orderGroup=orderStatusOrderValue.orderGroup,orderAvailDisplay=orderStatusOrderValue.orderDisplay):(orderAvail="AVAILABLE",orderAvailDisplay="Your Order",orderGroup=2),orderGroupData[orderGroup]=orderAvail,element.simKit=element.simKit?element.simKit:{},element.plan=element.plan?element.plan:{},element.device=element.device?element.device:{};var isBYODAdded="SimCard"===element.device.category?!0:!1,isBYODOnlyCheck=element.device.offerSubtype===cartConstants.SIM_CARD,deviceDetails={},serviceDetails=getServiceDetails(element);lodash.get(toggleService.model,"toggles.isTaxesEnabled",!1)&&serviceDetails.length>0&&angular.forEach(serviceDetails,function(service){service.isTaxInclusive||(isTotalMonthlyTaxed=!1)}),isBYODAdded||(deviceDetails=_getDeviceDetails(element)),isBYODOnlyCheck||(isBYODOnly=!1);var planDetails=_getPlanDetails(element),monthlyPaymentDetails=toggleService.model.toggles.isEssentialsEnabled?getMonthlyPaymentDetails(element):void 0,simKitDetails=_getSimKitDetails(element,isBYODAdded),simCharges=_searchJsonPath(element,"charges"),tradeInDetails=_getTradeInDetails(element);tradeInDetails&&(tradeInDetails.deviceIMEI=lodash.get(tradeInDetails,"deviceImei",""),isTradeInDeviceIncluded=!0);var deviceCartPromotionsCheck=_getCartPromotions(_searchJsonPath(element.device,"price.promotions"));deviceCartPromotionsCheck&&deviceCartPromotionsCheck.length>0&&(isDevicePromoCodeExists=!0);var lineObject=element,wholeLinePrice=lineObject.price?_lineTotalPayNowMonthlyPrice(lineObject.price):void 0,lineLevelAutoPayObject=_searchJsonPath(element,'price.promotions[?(@.promoType == "auto_pay")]');angular.isUndefined(lineLevelAutoPayObject)?lineLevelAutoPayObject=mockNoCredit:lineLevelAutoPayObject.applied=angular.isDefined(isAutoPay)?isAutoPay:!0;var lineItem={mvcAttrs:{},lineNo:element.lineName,lineNumber:element.lineNumber?parseInt(element.lineNumber,10):element.lineNumber,lineId:element.id,orderAvailability:orderAvail,orderGroup:orderGroup,orderAvailabilityDisplay:orderAvailDisplay,lineType:element.lineType,ishybridBanEligible:"TABLET"===element.lineType||"WEARABLE"===element.lineType?isTabletLineAvailable:!1,isPHPFlow:!0,isTradeInPromoFlow:tradeInDetails?"DOLLARZEROPROMO"===tradeInDetails.tradeInType:void 0,isTradeInStandardFlow:tradeInDetails?"STANDARD"===tradeInDetails.tradeInType:void 0,lineItemDetails:{deviceDetails:deviceDetails,planDetails:planDetails,serviceDetails:serviceDetails,monthlyPaymentDetails:monthlyPaymentDetails},simKitDetails:simKitDetails,payNowPrice:lodash.get(wholeLinePrice,"payNowPrice"),monthlyPrice:lodash.get(wholeLinePrice,"monthlyPrice"),refundableDesposit:lodash.get(wholeLinePrice,"refundableDesposit"),subTotalPayNowPrice:lodash.get(wholeLinePrice,"subTotalPayNowPrice"),subTotalMonthlyPrice:lodash.get(wholeLinePrice,"subTotalMonthlyPrice"),discount:lineLevelAutoPayObject,isAutoPayOn:lineLevelAutoPayObject.applied,autoPayDiscount:"$"+lineLevelAutoPayObject.discountValue.amount,autoPayDiscountValue:lineLevelAutoPayObject.discountValue.amount,tradeInDetails:tradeInDetails,charges:simCharges};!isTabletLineAvailable||"TABLET"!==element.lineType&&"WEARABLE"!==element.lineType||(isTabletLineAvailable=!1),lineItem.lineItemDetails.deviceDetails.isProductAdded=lineItem.lineItemDetails.deviceDetails.sku?!0:!1,lineItem.lineItemDetails.planDetails.isProductAdded=lineItem.lineItemDetails.planDetails.id?!0:!1,lineItem.simKitDetails.isProductAdded=lineItem.simKitDetails.simKitId?!0:!1,lineItem.simKitDetails.isBYODAdded=isBYODAdded?!0:!1,lineItem.simKitDetails.isOnlySimAdded=isBYODAdded?!0:!1,lineItem.lineItemDetails.planDetails.planId=lineItem.lineItemDetails.planDetails.sku,lineItem.lineItemDetails.planDetails.planName=lineItem.lineItemDetails.planDetails.familyName?lineItem.lineItemDetails.planDetails.familyName.trim():lineItem.lineItemDetails.planDetails.familyName,lineItem.simKitDetails.displayName=lineItem.simKitDetails.simKitName?lineItem.simKitDetails.simKitName:"",angular.equals(lineItem.lineItemDetails.deviceDetails.pricingOption,"EIP")&&(lineItem.lineItemDetails.deviceDetails.pricingOption="MONTHLY",isDeviceEIP=!0),lineItem.isOrderEligible=!1;var isProductAdded=_searchJsonPath(lineItem,"lineItemDetails.deviceDetails.isProductAdded");if(isProductAdded||(isProductAdded=_searchJsonPath(lineItem,"simKitDetails.isProductAdded")),isProductAdded?lineItem.isOrderEligible=!0:lineItem.isOrderEligible=!1,lineItem.isProductAdded=lineItem.isOrderEligible,lineItem.simKitDetails.isBYODAdded===!0)lineItem.isPHPFlow=!1;else{var phpServiceAvailable=_searchJsonPath(lineItem,'lineItemDetails.serviceDetails[?(@.serviceCategory =="'+phpServiceName+'")]');phpServiceAvailable||(lineItem.isPHPFlow=!1)}commonUtils.transformByMap("cartLineItem",lineObject,lineItem),lineItems.push(lineItem)}),lineItems=_.sortBy(lineItems,["lineNumber"]);var lineItemsHandsetArray,lineItemsTabletArray,maxHandsetLength,totalProductsAllowed,maxTabletLength,isLineMaxHandsetLimitReached,isLineMaxTabletLimitReached,isDeviceLimitReached,lineItemsWearableArray,selectedCreditType;selectedCreditType=creditClassService.getCreditClass(),selectedCreditType&&selectedCreditType["class"]&&("creditClass3"===selectedCreditType["class"]?(totalProductsAllowed=cartSettings.maxLineLimit.creditClass3.maxTotalLine,maxHandsetLength=cartSettings.maxLineLimit.creditClass3.maxHandsetLine,maxTabletLength=cartSettings.maxLineLimit.creditClass3.maxTabletLine):(totalProductsAllowed=cartSettings.maxLineLimit.creditClass1.maxTotalLine,maxHandsetLength=cartSettings.maxLineLimit.creditClass1.maxHandsetLine,maxTabletLength=cartSettings.maxLineLimit.creditClass1.maxTabletLine)),lineItemsHandsetArray=angular.isDefined(_searchJsonPathArray(lineItems,'[?(@.lineType=="HANDSET")]'))?_searchJsonPathArray(lineItems,'[?(@.lineType=="HANDSET")]'):[],lineItemsTabletArray=angular.isDefined(_searchJsonPathArray(lineItems,'[?(@.lineType=="TABLET")]'))?_searchJsonPathArray(lineItems,'[?(@.lineType=="TABLET")]'):[],lineItemsWearableArray=angular.isDefined(_searchJsonPathArray(lineItems,'[?(@.lineType=="WEARABLE")]'))?_searchJsonPathArray(lineItems,'[?(@.lineType=="WEARABLE")]'):[],lineItemsWearableArray&&(lineItemsTabletArray=lineItemsTabletArray?lineItemsTabletArray:[],lineItemsTabletArray=lineItemsTabletArray.concat(lineItemsWearableArray)),isLineMaxHandsetLimitReached=lineItemsHandsetArray&&lineItemsHandsetArray.length>=maxHandsetLength?!0:!1,isLineMaxTabletLimitReached=lineItemsTabletArray&&lineItemsTabletArray.length>=maxTabletLength?!0:!1,isDeviceLimitReached=lineItemsHandsetArray.length+lineItemsTabletArray.length>=totalProductsAllowed?!0:!1;var accessories=_getAccessoryDetails(myCart.cart),selectedShippingOptions=_getShippingOption(myCart.cart),wholeCartPrice=_cartPayNowMonthlyPrice(myCart.cart.pricing),cartLevelAutoPayObject=_searchJsonPath(myCart,'pricing.subTotal.promotions[?(@.promoType === "auto_pay")]');angular.isUndefined(cartLevelAutoPayObject)?cartLevelAutoPayObject=mockNoCredit:cartLevelAutoPayObject.applied=angular.isDefined(isAutoPay)?isAutoPay:!0;var _autoPayDiscount=cartLevelAutoPayObject.discountValue.amount,cartDetails={mvcAttrs:{enablePlanSelector:globalConfig.cartSettings.enablePlanSelector},cartId:myCart.cart.cartId,orderId:myCart.cart.extCartId,tradeInType:_getCartTradeInType(lineItems),modifiedTime:moment().format("x"),selectedCreditClass:creditClassService.getCreditClass(),lineItems:lineItems,totalLines:lineItems.length,promotions:_getCartPromotions(_searchJsonPath(myCart.cart.pricing,"subTotal.promotions")),customPromotions:_getCustomCartPromotions(myCart.cart),payNowPrice:lodash.get(wholeCartPrice,"payNowPrice"),monthlyPrice:lodash.get(wholeCartPrice,"monthlyPrice"),subTotalPayNowPrice:lodash.get(wholeCartPrice,"subTotalPayNowPrice"),subTotalMonthlyPrice:lodash.get(wholeCartPrice,"subTotalMonthlyPrice"),refundableDesposit:lodash.get(wholeCartPrice,"refundableDesposit"),autoPayDiscount:"$"+_autoPayDiscount,finalShippingDate:_getFinalShippingDate(lineItems,accessories),total:lodash.get(wholeCartPrice,"total"),totalPayNowPrice:lodash.get(wholeCartPrice,"totalPayNowPrice"),totalMonthlyPrice:lodash.get(wholeCartPrice,"totalMonthlyPrice"),accessories:accessories,orderGroupData:orderGroupData,shippingOptions:selectedShippingOptions,flags:{isFamilyMatch:!1,isEmptyCart:!1,isOnlyAccessory:!1,isAccessoryFlow:!1,isPHPFlow:!0,isDefaultCart:!1,isCheckoutErrorMsg:!1,isLineMaxHandsetLimitReached:isLineMaxHandsetLimitReached,isLineMaxTabletLimitReached:isLineMaxTabletLimitReached,isDeviceLimitReached:isDeviceLimitReached,isOrderEligible:!1,isVoiceLineAdded:!1,isEmpty:!1,isProductAdded:!1,isPriceBreakdownEnable:!1,isNotifyFRP:!1,isNotifyEIP:!1,isMiniBrowseAccessoryEIPEligible:_getMiniBrowseEIPPrices(myCart.cart),isDeviceInHandset:!1,isDeviceinTablet:!1,isDeviceinWearable:!1,isEmptyLine:!1,isCheckoutEnable:!0,isOMOrder:!1,isTotalMonthlyTaxed:isTotalMonthlyTaxed,isAutoPayOn:cartLevelAutoPayObject.applied}};_autoPayDiscount>0&&(cartDetails.discount=cartLevelAutoPayObject.discountValue),cartDetails.accessories.accessoryDetails.length>0&&(cartDetails.flags.isOrderEligible=!0),lodash.forEach(cartDetails.lineItems,function(item){"HANDSET"===item.lineType&&item.isProductAdded===!0&&(cartDetails.flags.isDeviceInHandset=!0),"TABLET"===item.lineType&&item.isProductAdded===!0&&(cartDetails.flags.isDeviceInTablet=!0),"WEARABLE"===item.lineType&&item.isProductAdded===!0&&(cartDetails.flags.isDeviceInWearable=!0),item.isProductAdded===!1&&(cartDetails.flags.isEmptyLine=!0)});var isProductNotAddedInCart=_searchJsonPathArray(cartDetails,"lineItems[?(@.isOrderEligible == false)]"),isHandsetAddedInCart=_searchJsonPathArray(cartDetails,'[?(@.lineType=="HANDSET")]'),isLineItemsTabletInCart=_searchJsonPathArray(cartDetails,'[?(@.lineType=="TABLET")]'),isLineItemsWearableInCart=_searchJsonPathArray(cartDetails,'[?(@.lineType=="WEARABLE")]');isLineItemsWearableInCart&&(isLineItemsTabletInCart=isLineItemsTabletInCart?isLineItemsTabletInCart:[],isLineItemsTabletInCart=isLineItemsTabletInCart.concat(isLineItemsWearableInCart));var isPhpServiceAdded=_searchJsonPathArray(cartDetails.lineItems,"[?(@.isPHPFlow == true)]");cartDetails.flags.isPHPFlow=isPhpServiceAdded?!0:!1,cartDetails.flags.isOrderEligible=isProductNotAddedInCart?!1:!0,
cartDetails.flags.isVoiceLineAdded=angular.isUndefined(isHandsetAddedInCart)?!1:!0,cartDetails.flags.isDefaultCart=cartStorage.getDefaultCartFlag(),0===cartDetails.lineItems.length&&0===cartDetails.accessories.accessoryDetails.length&&(cartDetails.flags.isEmpty=!0,cartDetails.flags.isOrderEligible=!1,cartDetails.flags.isOnlyAccessory=!1),0===cartDetails.lineItems.length&&cartDetails.accessories.accessoryDetails.length>0&&(cartDetails.flags.isOnlyAccessory=!0,cartDetails.flags.isPHPFlow=!1,lodash.get(toggleService.model,"toggles.isV3AccessoryOnlyDisabled")===!0?(cartDetails.flags.isOrderEligible=!1,cartDetails.flags.isCheckoutEnable=!1):cartDetails.flags.isOrderEligible=!0),cartDetails.accessories.accessoryDetails.length>0&&(accessoryIncluded=!0,isBYODOnly=!1);var cartPromotionsCheck=_getCartPromotions(_searchJsonPath(myCart.cart.pricing,"subTotal.promotions"));cartPromotionsCheck&&cartPromotionsCheck.length>0&&(isCartPromoCodeExists=!0);var simKitData=_searchJsonPathArray(isHandsetAddedInCart,"simKitDetails");cartDetails.flags.isProductAdded=_searchJsonPath(simKitData,"[?(@.isProductAdded == true || @.isBYODAdded == true )]")?!0:!1,!cartDetails.flags.isProductAdded&&isLineItemsTabletInCart&&isLineItemsTabletInCart.length>=1?cartDetails.flags.isCheckoutErrorMsg=!1:cartDetails.flags.isCheckoutErrorMsg=!0,cartDetails.flags.isProductAdded&&isLineItemsTabletInCart&&isLineItemsTabletInCart.length>=1?cartDetails.flags.isHybridBanMsg=!0:cartDetails.flags.isHybridBanMsg=!1;var accessoryItems=_searchJsonPathArray(cartDetails,"accessories.accessoryDetails[?(@.isProductAdded == true)]");accessoryItems?cartDetails.flags.isPriceBreakdownEnable=!0:cartDetails.flags.isPriceBreakdownEnable=_searchJsonPathArray(cartDetails,"lineItems[?(@.isOrderEligible == true)]")?!0:!1,globalConfig.cartSettings.isPHPModalEnabled||(cartDetails.flags.isPHPFlow=!1);var paymentOption=_searchJsonPath(cartDetails,"accessories.accessoryDetails[0].paymentOption");return cartDetails.accessories.isAccessoryEIPEligible&&"FRP"!==paymentOption&&(cartDetails.flags.isNotifyEIP=!0),(cartDetails.accessories.isAccessoryEIPEligible&&"FRP"===paymentOption||!cartDetails.accessories.isAccessoryEIPEligible)&&(cartDetails.flags.isNotifyFRP=!0),lodash.get(toggleService.model,"toggles.isFullOrderEnabled",!1)&&(lodash.get(toggleService.model,"toggles.isBYODOMOrder",!1)&&isBYODOnly?cartDetails.flags.isOMOrder=!0:!lodash.get(toggleService.model,"toggles.isFRPOMOrder",!1)||accessoryIncluded||isDeviceEIP||isTradeInDeviceIncluded||isCartPromoCodeExists||isDevicePromoCodeExists?cartDetails.flags.isOMOrder=!1:cartDetails.flags.isOMOrder=!0),commonUtils.transformByMap("transformCart",myCart.cart,cartDetails),_makeAmountAttributes(cartDetails),cartDetails}function _getStructuredCheckOutDetails(checkOutData){function createAddressObject(addressType){var addressObject={address1:_searchJsonPath(profileObject,addressType+".address1"),address2:_searchJsonPath(profileObject,addressType+".address2"),city:_searchJsonPath(profileObject,addressType+".city"),state:_searchJsonPath(profileObject,addressType+".region"),zip:_searchJsonPath(profileObject,addressType+".zipCode")};return addressObject}var personalInfo,shipInfo,billInfo,e911Info,billSameAsShip,e911SameAsShip,profileObject=_searchJsonPath(checkOutData,"cart.profile");profileObject||(profileObject={});var orderData=checkOutData;personalInfo={middleName:_searchJsonPath(profileObject,"personalInfo.middleName"),lastName:_searchJsonPath(profileObject,"personalInfo.lastName"),firstName:_searchJsonPath(profileObject,"personalInfo.firstName"),carrier:_searchJsonPath(profileObject,"personalInfo.carrier"),phoneNumber:_searchJsonPath(profileObject,"personalInfo.phoneNumber"),email:_searchJsonPath(profileObject,"personalInfo.confirmEmail"),confirmEmail:_searchJsonPath(profileObject,"personalInfo.confirmEmail"),creditClass:_searchJsonPath(profileObject,"personalInfo.creditClass")},shipInfo=createAddressObject("shippingAddress"),billInfo=createAddressObject("billingAddress"),e911Info=createAddressObject("e911Address");var tempShipInfo=angular.copy(shipInfo),tempBillInfo=angular.copy(billInfo),tempE911Info=angular.copy(e911Info);shipInfo&&billInfo&&angular.equals(tempShipInfo,tempBillInfo)?(billInfo=angular.copy(shipInfo),shipInfo.disclaimer={checkbox:!0},billSameAsShip=!0):(billInfo&&(shipInfo.disclaimer={checkbox:!1}),billSameAsShip=!1),shipInfo&&e911Info&&angular.equals(tempShipInfo,tempE911Info)?(e911Info=angular.copy(shipInfo),billInfo.disclaimer={checkbox:!0},e911SameAsShip=!0):e911Info?(billInfo.disclaimer={checkbox:!1},e911SameAsShip=!1):e911SameAsShip=!1;var creditcheck={idType:_searchJsonPath(orderData,"_creditcheckinfo[0]._creditcheckdetails..id-type"),idNumber:_searchJsonPath(orderData,"_creditcheckinfo[0]._creditcheckdetails..id-value"),expiryDate:_searchJsonPath(orderData,"_creditcheckinfo[0]._creditcheckdetails..expiry-date"),dob:_searchJsonPath(orderData,"_creditcheckinfo[0]._creditcheckdetails..bday"),state:_searchJsonPath(orderData,"_creditcheckinfo[0]._creditcheckdetails..region"),ssn:_searchJsonPath(orderData,"_creditcheckinfo[0]._creditcheckdetails..social-security-number")},chosenShippingOption={shippingOption:commonUtils.searchJson(checkOutData.cart.shippingOptions,'[?(@. selected =="true")]')?commonUtils.searchJson(checkOutData.cart.shippingOptions,'[?(@. selected =="true")]').name:void 0},pricingInfo=_getStructuredCheckOutSubTotal(orderData);pricingInfo.total.total=_createPriceBaseObject(_searchJsonPath(orderData,"_total[0].cost[0]"));var auditRecords=_getAuditRecords(checkOutData),checkOutInfo={personalInfo:personalInfo,shipInfo:shipInfo,billInfo:billInfo,e911Info:e911Info,creditcheck:creditcheck,chosenShipping:chosenShippingOption,billSameAsShip:billSameAsShip,e911SameAsShip:e911SameAsShip,flags:{}};return angular.merge(checkOutInfo,pricingInfo),angular.merge(checkOutInfo.flags,auditRecords),commonUtils.transformByMap("transformCheckOut",checkOutData,checkOutInfo),_makeAmountAttributes(checkOutInfo),checkOutInfo}function transformCartData(json){var transformedData=_getStructuredCartDetails(json);return $rootScope.$broadcast("cart-notifications",{cartData:transformedData}),transformedData}function transformTPPCheckoutData(json){var transformedData=_getStructuredCartDetails(json);return transformedData}function transformCheckOutData(data){var carData=_getStructuredCartDetails(data);if(carData.error)return carData;var checkOutData=_getStructuredCheckOutDetails(data);return checkOutData.error||(checkOutData.reviewCart=carData),checkOutData}function transformCheckOutSubTotal(data){return _getStructuredCheckOutSubTotal(data)}function totalFinanceAmountCalculation(cartObj){var totalFinancedAmountAccessory=0,totalFinancedAmountDevice=0,totalFinancedAmount=0;return cartObj&&(cartObj.accessories||cartObj.lineItems)&&(cartObj.lineItems&&angular.forEach(cartObj.lineItems,function(value,key){var promoDev=0;if(angular.equals(value.lineItemDetails.deviceDetails.pricingOption,cartConstants.MONTHLY)&&value.lineItemDetails&&value.lineItemDetails.deviceDetails.catalogPrice){var devicePromotion=value.lineItemDetails.deviceDetails.promotions,catalogPrice=parseFloat(lodash.get(value.lineItemDetails,"deviceDetails.catalogPrice.listPrice.amount",0)),payNowPrice=parseFloat(lodash.get(value.lineItemDetails,"deviceDetails.payNowPrice.purchasePrice.amount",0));angular.isDefined(devicePromotion)&&angular.isDefined(devicePromotion.cart)&&angular.forEach(devicePromotion.cart,function(promotion,keys){promoDev+=parseFloat(lodash.get(promotion,"discountValue.amount",0))}),totalFinancedAmountDevice+=catalogPrice-promoDev-payNowPrice}}),cartObj.accessories&&angular.forEach(cartObj.accessories.accessoryDetails,function(value,key){var promoAcc=0;if(angular.equals(value.paymentOption,cartConstants.EIP)&&value.catalogPrice){var catalogPrice=parseFloat(lodash.get(value,"catalogPrice.listPrice.amount",0)),payNowPrice=parseFloat(lodash.get(value,"payNowPrice.purchasePrice.amount",0)),accCartPromotion=lodash.filter(value.promotions,{promoType:"CART"});angular.forEach(accCartPromotion,function(promotion,keys){promoAcc+=parseFloat(lodash.get(promotion,"discountValue.amount",0))}),totalFinancedAmountAccessory+=catalogPrice-promoAcc-payNowPrice}})),totalFinancedAmountDevice=0>totalFinancedAmountDevice?0:totalFinancedAmountDevice,totalFinancedAmountAccessory=0>totalFinancedAmountAccessory?0:totalFinancedAmountAccessory,totalFinancedAmount=parseFloat(totalFinancedAmountDevice)+parseFloat(totalFinancedAmountAccessory),totalFinancedAmount.toFixed(2)}function _getQuote(quoteData,checkOutInfo){var amountDisplay=_searchJsonPath(checkOutInfo.initData,"selectedShippingOptions[?(@.selected===true)].cost"),taxTotal=_searchJsonPath(quoteData,"pricing.tax.totalTax"),monthlyPrice=_searchJsonPath(quoteData,"pricing.total.monthlyPrice.salePrice"),payNowPrice=_searchJsonPath(quoteData,"pricing.total.payNowPrice.salePrice"),taxState=_searchJsonPath(quoteData,"pricing.tax.stateTax"),taxCounty=_searchJsonPath(quoteData,"pricing.tax.countyTax"),shippingFee={display:amountDisplay,amount:amountDisplay?parseFloat(amountDisplay.replace(/\$|,/g,"")):amountDisplay,amount00:0,amountDisplay:amountDisplay},allTotal={subTotal:{tax:{total:_createPriceBaseObject(taxTotal),state:_createPriceBaseObject(taxState),county:_createPriceBaseObject(taxCounty)},shippingFee:_createPriceBaseObject(shippingFee),oneTimeFee:{amount:0,amount00:0,amountDisplay:"$0.00"}},total:{monthlyPrice:_createPriceBaseObject(monthlyPrice),payNowPrice:_createPriceBaseObject(payNowPrice)}};return _makeAmountAttributes(allTotal),allTotal}function transformQuotesData(data,checkOutInfo){var cartData=_getStructuredCartDetails(data);if(cartData.error)return cartData;var quoteData=_getQuote(data.cart,checkOutInfo);return quoteData.error||(quoteData.reviewCart=cartData),quoteData}var mockNoCredit={discountValue:{amount:5,currency:"USD",display:"5.00"},promoType:"auto_pay",applied:!1},_searchJsonPath=commonUtils.searchJson,_searchJsonPathArray=commonUtils.searchJsonArray;return{transformCartData:transformCartData,transformCheckOutData:transformCheckOutData,transformCheckOutSubTotal:transformCheckOutSubTotal,totalFinanceAmountCalculation:totalFinanceAmountCalculation,getMonthlyPaymentDetails:getMonthlyPaymentDetails,getServiceDetails:getServiceDetails,transformQuotesData:transformQuotesData,transformTPPCheckoutData:transformTPPCheckoutData}}transformCartFactoryV3.$inject=["$rootScope","creditClassService","toggleService","globalAssetRepositoryConstants","globalConfig","commonUtils","cartStorage","cartConstants","globalValue","commonStorage","checkOutConstants"],angular.module("tmobileCore").factory("transformCartV3",transformCartFactoryV3)}(window.angular,window._),function(angular,lodash){"use strict";function transformCartFactoryV2($rootScope,creditClassService,toggleService,globalAssetRepositoryConstants,globalConfig,commonUtils,cartStorage,cartConstants,globalValue){function _makeAmountAttributes(jsonData){var _amount00=_searchJsonPathArray(jsonData,"[?(@.amount00 == 0)]");return angular.forEach(_amount00,function(v){if(angular.isDefined(v.amount)){v.amount00=v.amount.toFixed(2);var splitAmount=v.amount00.split(".");v.amountDollar=splitAmount[0],v.amountCents=splitAmount[1]}}),jsonData}function getGARImagePath(imgPath){var imagePath=imgPath;return toggleService.model.toggles.enableGar&&_.includes(imgPath,"/content/dam")&&(imagePath=globalAssetRepositoryConstants.url+imgPath),imagePath}function _createPriceBaseObject(priceSource){var priceObject={amount:priceSource?parseFloat(priceSource.amount):void 0,amount00:0,amountDisplay:lodash.get(priceSource,"display")};return priceObject}function _productPayNowMonthlyPrice(_product){var productPayNowListPrice,productPayNowPurChasePrice,productMonthlyPaymentPrice,premiumFees,clubFees,refundableDeposit,deposit,productPriceListPrice,productPricePurChasePrice,productMonthlyPrice,productMonthlyPurchasePrice,productCatalogListPrice,productCatalogPurChasePrice;productMonthlyPrice=_searchJsonPath(_product,"contractTerm"),productPayNowListPrice=_searchJsonPath(_product,"priceSummary.payNowPrice.listPrice"),productPayNowPurChasePrice=_searchJsonPath(_product,"priceSummary.payNowPrice.salePrice"),productCatalogListPrice=_searchJsonPath(_product,"priceSummary.catalogPrice.listPrice"),productCatalogPurChasePrice=_searchJsonPath(_product,"priceSummary.catalogPrice.salePrice"),productMonthlyPaymentPrice=_searchJsonPath(_product,"priceSummary.monthlyPrice.listPrice"),productMonthlyPurchasePrice=_searchJsonPath(_product,"priceSummary.monthlyPrice.salePrice"),productPriceListPrice=productPayNowListPrice,productPricePurChasePrice=productPayNowPurChasePrice,premiumFees=_searchJsonPath(_product,"options.premiumFee")?_searchJsonPath(_product,"options.premiumFee"):_searchJsonPath(_product,"options[0].premiumFee"),clubFees=_searchJsonPath(_product,"options.clubFee")?_searchJsonPath(_product,"options.clubFee"):_searchJsonPath(_product,"options[0].clubFee"),refundableDeposit=_searchJsonPath(_product,"deposit"),deposit=_searchJsonPath(_product,"deposit");var wholePrice={payNowPrice:{listPrice:_createPriceBaseObject(productPayNowListPrice),purchasePrice:_createPriceBaseObject(productPayNowPurChasePrice)},monthlyPrice:_createPriceBaseObject(productMonthlyPaymentPrice),monthlyPurchasePrice:_createPriceBaseObject(productMonthlyPurchasePrice),price:{listPrice:_createPriceBaseObject(productPriceListPrice),purchasePrice:_createPriceBaseObject(productPricePurChasePrice)},catalogPrice:{listPrice:_createPriceBaseObject(productCatalogListPrice),purchasePrice:_createPriceBaseObject(productCatalogPurChasePrice)},premiumFee:{listPrice:_createPriceBaseObject(lodash.get(premiumFees,"listPrice")),purchasePrice:_createPriceBaseObject(lodash.get(premiumFees,"purchasePrice"))},clubFee:{listPrice:_createPriceBaseObject(lodash.get(clubFees,"listPrice.amount")),purchasePrice:_createPriceBaseObject(lodash.get(clubFees,"purchasePrice.amount"))},refundableDeposit:_createPriceBaseObject(refundableDeposit),deposit:_createPriceBaseObject(deposit)};return wholePrice.monthlyPrice.termMonths=productMonthlyPrice,wholePrice.monthlyPurchasePrice.termMonths=productMonthlyPrice,wholePrice}function _simCardPayNowMonthlyPrice(_product){var productPayNowListPrice,productPayNowPurChasePrice,productMonthlyPaymentPrice,productMonthlyPrice,productSimKitListPrice,monthlyPrice=_searchJsonPath(_product,"monthlyPrice"),payNowPrice=_searchJsonPath(_product,"payNowPrice");productSimKitListPrice=payNowPrice?payNowPrice.listPrice:void 0,productPayNowListPrice=payNowPrice?payNowPrice.salePrice:void 0,productPayNowPurChasePrice=payNowPrice?payNowPrice.salePrice:void 0,productMonthlyPaymentPrice=monthlyPrice?monthlyPrice.salePrice:void 0,productMonthlyPrice=_searchJsonPath(_product,"contractTerm");var wholePrice={payNowPrice:{listPrice:_createPriceBaseObject(productPayNowListPrice),purchasePrice:_createPriceBaseObject(productPayNowPurChasePrice)},monthlyPrice:_createPriceBaseObject(productMonthlyPaymentPrice),simKitListPrice:_createPriceBaseObject(productSimKitListPrice),price:{listPrice:_createPriceBaseObject(productPayNowListPrice),purchasePrice:_createPriceBaseObject(productPayNowPurChasePrice)}};return wholePrice.monthlyPrice.termMonths=productMonthlyPrice,wholePrice}function _lineTotalPayNowMonthlyPrice(_product){var productPayNowPrice,productMonthlyPrice,refundPrice,totalPrice,subTotalPayNowPrice,subTotalMonthlyPrice;productPayNowPrice=_searchJsonPath(_product,"priceSummary.payNowPrice.salePrice"),productMonthlyPrice=_searchJsonPath(_product,"priceSummary.monthlyPrice.salePrice"),refundPrice=_searchJsonPath(_product,"deposit"),totalPrice=_searchJsonPath(_product,"tax.totalTax"),subTotalPayNowPrice=productPayNowPrice,subTotalMonthlyPrice=productMonthlyPrice;var wholePrice={payNowPrice:_createPriceBaseObject(productPayNowPrice),monthlyPrice:_createPriceBaseObject(productMonthlyPrice),refundableDesposit:{amount:refundPrice?parseFloat(refundPrice.amount):void 0,amount00:0,amountDisplay:refundPrice?refundPrice.display:void 0},total:{amount:totalPrice?parseFloat(totalPrice.amount):void 0,amount00:0,amountDisplay:totalPrice},subTotalPayNowPrice:_createPriceBaseObject(subTotalPayNowPrice),subTotalMonthlyPrice:_createPriceBaseObject(subTotalMonthlyPrice)};return wholePrice}function _cartPayNowMonthlyPrice(_product){var productPayNowPrice,productMonthlyPrice,refundPrice,totalPrice,subTotalPayNowPrice,subTotalMonthlyPrice;productPayNowPrice=_searchJsonPath(_product,"total.payNowPrice.salePrice"),productMonthlyPrice=_searchJsonPath(_product,"total.monthlyPrice.salePrice"),refundPrice=_searchJsonPath(_product,"deposit"),totalPrice=_searchJsonPath(_product,"tax.totalTax"),subTotalPayNowPrice=_searchJsonPath(_product,"subTotal.priceSummary.payNowPrice.salePrice"),subTotalMonthlyPrice=_searchJsonPath(_product,"subTotal.priceSummary.monthlyPrice.salePrice");var wholePrice={payNowPrice:_createPriceBaseObject(productPayNowPrice),monthlyPrice:_createPriceBaseObject(productMonthlyPrice),refundableDesposit:{amount:refundPrice?parseFloat(refundPrice.amount):void 0,amount00:0,amountDisplay:refundPrice},total:{amount:totalPrice?parseFloat(totalPrice.amount):void 0,amount00:0,amountDisplay:totalPrice},subTotalPayNowPrice:_createPriceBaseObject(subTotalPayNowPrice),subTotalMonthlyPrice:_createPriceBaseObject(subTotalMonthlyPrice)};return wholePrice}function _getAccessoryDetails(cartData){var accessoryTotalPrice,accessoryDetails=[],accessories={},accessoryElements=cartData.accessories;angular.forEach(accessoryElements,function(accessoryItem){var accessoryObject=accessoryItem,listPrice=_searchJsonPath(accessoryObject,"price.priceSummary.payNowPrice.listPrice"),purchasePrice=_searchJsonPath(accessoryObject,"price.priceSummary.payNowPrice.salePrice"),monthlyPrice=_searchJsonPath(accessoryObject,"price.priceSummary.monthlyPrice.salePrice"),catalogSalePrice=_searchJsonPath(accessoryObject,"price.priceSummary.catalogPrice.salePrice"),catalogListPrice=_searchJsonPath(accessoryObject,"price.priceSummary.catalogPrice.listPrice"),priceListPrice=_searchJsonPath(accessoryObject,"pricing.listPrice"),pricePurchasePrice=_searchJsonPath(accessoryObject,"pricing.mrp"),totlaAccessoryPrice=_searchJsonPath(accessoryObject,"pricing.total"),accessoryDetail={isProductAdded:!0,availablity:accessoryObject.availablity,id:accessoryObject.id,accessoryType:accessoryObject.offerType,accessorySubType:accessoryObject.offerSubType,sku:accessoryObject.upc,familyName:accessoryObject.familyName,offerId:accessoryObject.offerId,quantity:accessoryObject.quantity,color:accessoryObject.color,colorSwatch:getGARImagePath(accessoryObject.colorSwatch),productImage:getGARImagePath(accessoryObject.imageURL),skuName:accessoryObject.familyName,manufacturer:null,paymentOption:_searchJsonPath(accessoryObject,"selectedPricingOption"),promotions:_searchJsonPath(accessoryObject,"price.promotions"),payNowPrice:{listPrice:_createPriceBaseObject(listPrice),purchasePrice:_createPriceBaseObject(purchasePrice)},catalogPrice:{listPrice:_createPriceBaseObject(catalogListPrice),purchasePrice:_createPriceBaseObject(catalogSalePrice)},monthlyPrice:{amount:_searchJsonPath(monthlyPrice,"amount"),amountDisplay:_searchJsonPath(monthlyPrice,"display"),termMonths:_searchJsonPath(monthlyPrice,"contractTerm"),amount00:0},priceDetails:{listPrice:_createPriceBaseObject(priceListPrice),purchasePrice:_createPriceBaseObject(pricePurchasePrice)},totalPrice:_createPriceBaseObject(totlaAccessoryPrice)};accessoryDetail.productType=accessoryDetail.accessoryTypeaccessoryType,commonUtils.transformByMap("transformCartAccessoryItem",accessoryObject,accessoryDetail),accessoryDetails.push(accessoryDetail)}),cartData.accessoriesTotal&&(accessoryTotalPrice=cartData.accessoriesTotal[0]);var accPriceDetails=_createPriceBaseObject(_searchJsonPath(accessoryTotalPrice,"payNowPrice.listPrice")),accPayNowPrice=_createPriceBaseObject(_searchJsonPath(accessoryTotalPrice,"payNowPrice.salePrice")),accMonthlyPrice=_createPriceBaseObject(_searchJsonPath(accessoryTotalPrice,"monthlyPrice.salePrice"));return accessories={mvcAttrs:{},accessoryDetails:accessoryDetails,isAccessoryEIPEligible:_searchJsonPath(cartData,"accessoriesEipEligible"),priceDetails:accPriceDetails,payNowPrice:accPayNowPrice,monthlyPrice:accMonthlyPrice}}function _getShippingOption(cartData){var shippingOptions=cartData.shippingOptions,selectedShippingOptions=[];return angular.forEach(shippingOptions,function(value){var option={deliveryTime:value.deliveryTime,name:value.displayName,displayName:value.name,selected:value.selected,cost:lodash.isArray(value.cost)?value.cost[1]:value.cost,actionUrl:value.actionURL,costValue:lodash.isArray(value.cost)?parseFloat(value.cost[1].substring(1)):parseFloat(value.cost.substring(1))};selectedShippingOptions.push(option)}),selectedShippingOptions}function _getServiceDetails(lineData){var serviceDetails=[],preServiceDetails=_searchJsonPathArray(lineData,"services");return preServiceDetails&&(preServiceDetails=preServiceDetails[0],angular.forEach(preServiceDetails,function(serviceItem){var wholePrice=serviceItem.price?_productPayNowMonthlyPrice(serviceItem.price):void 0,serviceDetail={isProductAdded:_searchJsonPath(serviceItem,"upc")?!0:!1,productType:_searchJsonPath(serviceItem,"offerType"),upc:_searchJsonPath(serviceItem,"upc"),familyName:_searchJsonPath(serviceItem,"familyName"),serviceSOCs:void 0,payNowPrice:lodash.get(wholePrice,"payNowPrice"),isSelected:!0,enabled:!0,isAvailable:!0,monthlyPrice:lodash.get(wholePrice,"monthlyPrice"),pricing:_searchJsonPath(serviceItem,"price.priceSummary.monthlyPrice.salePrice"),promotions:_searchJsonPath(serviceItem,"price.promotions")};serviceDetail.serviceCategory=_searchJsonPath(serviceItem,"category"),serviceDetail.serviceId=serviceDetail.upc,serviceDetail.serviceName=serviceDetail.familyName,serviceDetails.push(serviceDetail)})),serviceDetails}function _getFormattedDate(dateValue){if(angular.isDefined(dateValue)){var myDate=new Date(dateValue);if(myDate=moment(myDate),myDate.isValid())return myDate.format("M/D")}return""}function _getFinalShippingDate(lineItems){var dates={availFromDate:"",availToDate:""};return lodash.forEach(lineItems,function(lineItem){var deviceDetails=lineItem.lineItemDetails.deviceDetails,shippingAvailToDateTime=""===dates.availToDate?0:new Date(dates.availToDate).getTime(),lineItemAvailToDateTime=""===deviceDetails.availableToDate?0:new Date(deviceDetails.availableToDate).getTime();deviceDetails.availableFromDate&&deviceDetails.availableToDate&&lineItemAvailToDateTime>shippingAvailToDateTime&&(dates.availFromDate=deviceDetails.availableFromDate,dates.availToDate=deviceDetails.availableToDate)}),dates.availFromDate=_getFormattedDate(dates.availFromDate),dates.availToDate=_getFormattedDate(dates.availToDate),dates}function _getCartPromotions(cartPromotions){var promotions=[];return cartPromotions&&cartPromotions.length>0&&lodash.forEach(cartPromotions,function(promo){"CART"===promo.promoType&&promotions.push(promo)}),lodash.uniqBy(promotions,"promoId")}function _getCustomCartPromotions(cart){var promotions=[];lodash.forEach(cart.lines,function(line){line.device.price&&line.device.price.promotions&&line.device.price.promotions.length>0&&lodash.forEach(line.device.price.promotions,function(promo){"CART"===promo.promoType&&promo.promoCode&&promotions.push(promo)})}),lodash.forEach(cart.accessories,function(accessory){accessory.price&&accessory.price.promotions&&accessory.price.promotions.length>0&&lodash.forEach(accessory.price.promotions,function(promo){"CART"===promo.promoType&&promo.promoCode&&promotions.push(promo)})});var cartPromotions=_getCartPromotions(_searchJsonPath(cart.pricing,"subTotal.promotions"));return cartPromotions&&promotions.concat(cartPromotions),lodash.uniqBy(promotions,"promoId")}function _getMiniBrowseEIPPrices(cart){var isAccessoryEIP=!1;return cart.accessories&&cart.accessoriesEipEligible?lodash.forEach(cart.accessories,function(accessory){"EIP"===accessory.selectedPricingOption&&(isAccessoryEIP=!0)}):isAccessoryEIP=!1,isAccessoryEIP}function getGARImagePathForOfferModal(longDes){var longDescription=longDes;return toggleService.model.toggles.enableGar&&_.includes(longDes,"/content/dam")&&(longDescription=longDes.replace("/content/dam",globalAssetRepositoryConstants.url+"/content/dam")),longDescription}function _getDevicePromotions(promotions){var cart=[],tradeIn=[],catalog=[];promotions&&promotions.length>0&&lodash.forEach(promotions,function(promo){"CART"===promo.promoType?(promo.longDescription=getGARImagePathForOfferModal(promo.longDescription),cart.push(promo)):"CATALOG"===promo.promoType?(promo.longDescription=getGARImagePathForOfferModal(promo.longDescription),catalog.push(promo)):"TRADEIN"===promo.promoType?(promo.longDescription=getGARImagePathForOfferModal(promo.longDescription),tradeIn.push(promo)):angular.noop()});var devicePromotions={cart:cart,catalog:catalog,tradeIn:tradeIn};return devicePromotions}function _getDeviceDetails(lineData){var deviceElement=_searchJsonPath(lineData,"device"),wholeDevicePrice=deviceElement.price?_productPayNowMonthlyPrice(deviceElement.price):void 0,deviceDetails={id:deviceElement.id,productType:deviceElement.offerType,productSubType:deviceElement.offerSubType,availableFromDate:deviceElement.availableFromDate,availableToDate:deviceElement.availableToDate,sku:deviceElement.upc,deviceId:deviceElement.deviceId,familyId:deviceElement.familyId,familyName:lodash.get(deviceElement,"offerName"),quantity:1,memory:deviceElement.memory?deviceElement.memory:void 0,color:deviceElement.color,isHandset:angular.equals(deviceElement.offerSubType,"Handset")?!0:!1,isTablet:angular.equals(deviceElement.offerSubType,"Tablet")?!0:!1,isWearable:angular.equals(deviceElement.offerSubType,"Wearable")?!0:!1,memoryAnother:deviceElement.memoryAnother,colorAnother:deviceElement.colorAnother,colorSwatch:getGARImagePath(deviceElement.colorSwatch),manufacturer:deviceElement.manufacturer,frontImage:getGARImagePath(deviceElement.imageURL),backImage:getGARImagePath(deviceElement.backImage),leftImage:getGARImagePath(deviceElement.leftImage),rightImage:getGARImagePath(deviceElement.rightImage),thumbNail:getGARImagePath(deviceElement.thumbNail),specImage:getGARImagePath(deviceElement.specImage),memoryUOM:deviceElement.memoryUOM,description:deviceElement.description,promotions:_getDevicePromotions(_searchJsonPath(deviceElement,"price.promotions")),credits:_searchJsonPath(deviceElement,"price.credits"),catalogPrice:lodash.get(wholeDevicePrice,"catalogPrice"),payNowPrice:lodash.get(wholeDevicePrice,"payNowPrice"),monthlyPrice:lodash.get(wholeDevicePrice,"monthlyPurchasePrice"),priceDetails:lodash.get(wholeDevicePrice,"price"),premiumFee:lodash.get(wholeDevicePrice,"premiumFee"),refundableDeposit:lodash.get(wholeDevicePrice,"refundableDeposit"),clubFee:lodash.get(wholeDevicePrice,"clubFee"),deposit:lodash.get(wholeDevicePrice,"deposit"),pricingOption:deviceElement.selectedPricingOption,totalPrice:{totalPriceDisplay:wholeDevicePrice?wholeDevicePrice.price.listPrice.amountDisplay:void 0},contractTerms:lodash.get(wholeDevicePrice,"monthlyPrice.termMonths")};return deviceDetails}function _getPlanDetails(lineData){var planElement=_searchJsonPath(lineData,"plan"),wholePlanPrice=planElement.price?_productPayNowMonthlyPrice(planElement.price):void 0,planDetails={id:planElement.id,productType:planElement.offerType,sku:planElement.offerId,description:_searchJsonPathArray(planElement,"description"),familyName:lodash.get(planElement,"familyName"),manufacturer:planElement.manufacturer,memory:planElement.dataSize,planSOCs:planElement.SOCs,promotions:_searchJsonPath(planElement,"price.promotions"),payNowPrice:lodash.get(wholePlanPrice,"payNowPrice"),monthlyPrice:lodash.get(wholePlanPrice,"monthlyPrice"),monthlyPurchasePrice:lodash.get(wholePlanPrice,"monthlyPurchasePrice")};return planDetails}function _getTradeInDetails(lineData){return _searchJsonPath(lineData,"tradeIn")}function _getMonthlyPaymentDetails(lineData){var globalAuthorValue=globalValue.authorValue;return[{title:lodash.get(globalAuthorValue,"cart.essentials.lineLabel","Line"),charge:lodash.get(lineData,"plan.price.priceSummary.monthlyPrice.listPrice.amount",0)},{title:lodash.get(globalAuthorValue,"cart.essentials.deviceLabel","Device"),charge:lodash.get(lineData,"device.price.priceSummary.monthlyPrice.salePrice.amount",0)}]}function _getSimKitDetails(lineData){var simKitElement=_searchJsonPath(lineData,"simKit"),wholeSimKitPrice=simKitElement?_simCardPayNowMonthlyPrice(simKitElement):void 0,simKitDetails={id:simKitElement.id,productType:simKitElement.productType,productName:"SIM starter kit",manufacturer:simKitElement.manufacturer,simKitId:simKitElement.sku,simKitName:lodash.get(simKitElement,"displayName"),productImage:getGARImagePath(simKitElement.imageURL),promotions:lodash.get(simKitElement,"offers"),payNowPrice:lodash.get(wholeSimKitPrice,"payNowPrice"),monthlyPrice:lodash.get(wholeSimKitPrice,"monthlyPrice"),priceDetails:lodash.get(wholeSimKitPrice,"price"),listPrice:lodash.get(wholeSimKitPrice,"simKitListPrice")};return simKitDetails}function _getAuditRecords(checkOutData){var autoPay=_searchJsonPath(checkOutData,'auditRecords[?(@["auditKey"]=="AUTO_PAY")].auditValue'),storePayment=_searchJsonPath(checkOutData,'auditRecords[?(@["auditKey"]=="STORE_PAYMENT")].auditValue'),auditRecords={isActualAutoPay:autoPay,isActualStorePayment:storePayment};return autoPay=angular.isDefined(autoPay)?angular.fromJson(autoPay):!0,storePayment=angular.isDefined(storePayment)?angular.fromJson(storePayment):!0,auditRecords.isAutoPay=autoPay,auditRecords.isStorePayment=storePayment,auditRecords}function _getCartTradeInType(lines){var cartTradeInType,tradeInTypes=lines.reduce(function(mappedArray,line){return angular.isDefined(line.tradeInDetails)&&mappedArray.indexOf(line.tradeInDetails.tradeInType)<0&&mappedArray.push(line.tradeInDetails.tradeInType),mappedArray},[]);return cartTradeInType=0===tradeInTypes.length?void 0:1===tradeInTypes.length?tradeInTypes[0]:"MIXED"}function _getStructuredCheckOutSubTotal(checkOutData){var amountDisplay=_searchJsonPath(checkOutData,'shippingOptions[?(@.selected==="true")].cost'),taxTotal=_searchJsonPath(checkOutData,"pricing.tax.totalTax"),monthlyPrice=_searchJsonPath(checkOutData,"pricing.total.monthlyPrice.salePrice"),payNowPrice=_searchJsonPath(checkOutData,"pricing.total.payNowPrice.salePrice"),shippingFee={display:amountDisplay,amount:amountDisplay?parseFloat(amountDisplay.replace(/\$|,/g,"")):amountDisplay,amount00:0,amountDisplay:amountDisplay},allTotal={subTotal:{tax:{total:_createPriceBaseObject(taxTotal)},shippingFee:_createPriceBaseObject(shippingFee),oneTimeFee:{amount:0,amount00:0,amountDisplay:"$0.00"}},total:{monthlyPrice:_createPriceBaseObject(monthlyPrice),payNowPrice:_createPriceBaseObject(payNowPrice)}};return commonUtils.transformByMap("transformCheckOutSubTotal",checkOutData,allTotal),_makeAmountAttributes(allTotal),allTotal}function _getStructuredCartDetails(myCart){if(!myCart.cart)return{flags:{},error:"error"};var cartLineItem=myCart.cart.lines,cartSettings=globalConfig.cartSettings,_autoPayAuditRecord=_searchJsonPath(cartStorage.getAuditRecords(),'[?(@["auditKey"] === "AUTO_PAY")]'),_autoPayAuditValue=_autoPayAuditRecord?angular.fromJson(_autoPayAuditRecord.auditValue):!0,lineItems=[],orderGroupData={},isTabletLineAvailable=angular.isUndefined(_searchJsonPathArray(lineItems,'[?(@.lineType=="TABLET")]'))[0]?!1:!0,orderStatusOrder=cartSettings.orderStatusOrder;orderStatusOrder||(orderStatusOrder={AVAILABLE_FOR_BACK_ORDER:{orderGroup:0,orderDisplay:"Back Order"},AVAILABLE_FOR_PRE_ORDER:{orderGroup:1,orderDisplay:"Pre Order"},AVAILABLE:{orderGroup:2,orderDisplay:"Your Order"}});var phpServiceName=lodash.get(cartSettings,"line.service.phpServiceName","Premium Handset Protection");angular.forEach(cartLineItem,function(element){var orderAvail=_searchJsonPath(element,"device.availability"),orderGroup=0,orderAvailDisplay="",orderStatusOrderValue=orderStatusOrder[orderAvail];
orderStatusOrderValue?(orderGroup=orderStatusOrderValue.orderGroup,orderAvailDisplay=orderStatusOrderValue.orderDisplay):(orderAvail="AVAILABLE",orderAvailDisplay="Your Order",orderGroup=2),orderGroupData[orderGroup]=orderAvail,element.simKit=element.simKit?element.simKit:{},element.plan=element.plan?element.plan:{},element.device=element.device?element.device:{};var serviceDetails=_getServiceDetails(element),deviceDetails=_getDeviceDetails(element),planDetails=_getPlanDetails(element),monthlyPaymentDetails=toggleService.model.toggles.isEssentialsEnabled?_getMonthlyPaymentDetails(element):void 0,simKitDetails=_getSimKitDetails(element),tradeInDetails=_getTradeInDetails(element),lineObject=element,wholeLinePrice=lineObject.price?_lineTotalPayNowMonthlyPrice(lineObject.price):void 0,lineLevelAutoPayObject=_searchJsonPath(element,'price.promotions[?(@.promoType == "auto_pay")]');angular.isUndefined(lineLevelAutoPayObject)&&(lineLevelAutoPayObject=mockNoCredit),lineLevelAutoPayObject.applied=_autoPayAuditValue;var lineItem={mvcAttrs:{},lineNo:element.lineName,lineNumber:element.lineNumber?parseInt(element.lineNumber,10):element.lineNumber,lineId:element.id,orderAvailability:orderAvail,orderGroup:orderGroup,orderAvailabilityDisplay:orderAvailDisplay,lineType:element.lineType,ishybridBanEligible:"TABLET"===element.lineType||"WEARABLE"===element.lineType?isTabletLineAvailable:!1,isPHPFlow:!0,isTradeInPromoFlow:tradeInDetails?"DOLLARZEROPROMO"===tradeInDetails.tradeInType:void 0,isTradeInStandardFlow:tradeInDetails?"STANDARD"===tradeInDetails.tradeInType:void 0,lineItemDetails:{deviceDetails:deviceDetails,planDetails:planDetails,serviceDetails:serviceDetails,monthlyPaymentDetails:monthlyPaymentDetails},simKitDetails:simKitDetails,payNowPrice:lodash.get(wholeLinePrice,"payNowPrice"),monthlyPrice:lodash.get(wholeLinePrice,"monthlyPrice"),refundableDesposit:lodash.get(wholeLinePrice,"refundableDesposit"),subTotalPayNowPrice:lodash.get(wholeLinePrice,"subTotalPayNowPrice"),subTotalMonthlyPrice:lodash.get(wholeLinePrice,"subTotalMonthlyPrice"),discount:lineLevelAutoPayObject,isAutoPayOn:lineLevelAutoPayObject.applied,autoPayDiscount:"$"+lineLevelAutoPayObject.discountValue.amount,tradeInDetails:tradeInDetails};!isTabletLineAvailable||"TABLET"!==element.lineType&&"WEARABLE"!==element.lineType||(isTabletLineAvailable=!1),lineItem.lineItemDetails.deviceDetails.isProductAdded=lineItem.lineItemDetails.deviceDetails.sku?!0:!1,lineItem.lineItemDetails.planDetails.isProductAdded=lineItem.lineItemDetails.planDetails.id?!0:!1,lineItem.simKitDetails.isProductAdded=lineItem.simKitDetails.simKitId?!0:!1,lineItem.simKitDetails.isBYODAdded=!!(angular.isDefined(lineItem.simKitDetails.simKitId)&&angular.isUndefined(lineItem.lineItemDetails.deviceDetails.sku)||"SIM_KIT_BYOD"===lineItem.simKitDetails.simKitId),lineItem.simKitDetails.isOnlySimAdded=!!(angular.isDefined(lineItem.simKitDetails.simKitId)&&angular.isUndefined(lineItem.lineItemDetails.deviceDetails.sku)||"SIM_KIT_BYOD"===lineItem.simKitDetails.simKitId),lineItem.lineItemDetails.planDetails.planId=lineItem.lineItemDetails.planDetails.sku,lineItem.lineItemDetails.planDetails.planName=lineItem.lineItemDetails.planDetails.familyName?lineItem.lineItemDetails.planDetails.familyName.trim():lineItem.lineItemDetails.planDetails.familyName,lineItem.simKitDetails.displayName=lineItem.simKitDetails.simKitName,angular.equals(lineItem.lineItemDetails.deviceDetails.pricingOption,"EIP")&&(lineItem.lineItemDetails.deviceDetails.pricingOption="MONTHLY"),lineItem.isOrderEligible=!1;var isProductAdded=_searchJsonPath(lineItem,"lineItemDetails.deviceDetails.isProductAdded");if(isProductAdded||(isProductAdded=_searchJsonPath(lineItem,"simKitDetails.isProductAdded")),isProductAdded?lineItem.isOrderEligible=!0:lineItem.isOrderEligible=!1,lineItem.isProductAdded=lineItem.isOrderEligible,lineItem.simKitDetails.isBYODAdded===!0)lineItem.isPHPFlow=!1;else{var phpServiceAvailable=_searchJsonPath(lineItem,'lineItemDetails.serviceDetails[?(@.serviceCategory =="'+phpServiceName+'")]');phpServiceAvailable||(lineItem.isPHPFlow=!1)}commonUtils.transformByMap("cartLineItem",lineObject,lineItem),lineItems.push(lineItem)}),lineItems=_.sortBy(lineItems,["lineNumber"]);var lineItemsHandsetArray,lineItemsTabletArray,maxHandsetLength,totalProductsAllowed,maxTabletLength,isLineMaxHandsetLimitReached,isLineMaxTabletLimitReached,isDeviceLimitReached,lineItemsWearableArray,selectedCreditType;selectedCreditType=creditClassService.getCreditClass(),selectedCreditType&&selectedCreditType["class"]&&("creditClass3"===selectedCreditType["class"]?(totalProductsAllowed=cartSettings.maxLineLimit.creditClass3.maxTotalLine,maxHandsetLength=cartSettings.maxLineLimit.creditClass3.maxHandsetLine,maxTabletLength=cartSettings.maxLineLimit.creditClass3.maxTabletLine):(totalProductsAllowed=cartSettings.maxLineLimit.creditClass1.maxTotalLine,maxHandsetLength=cartSettings.maxLineLimit.creditClass1.maxHandsetLine,maxTabletLength=cartSettings.maxLineLimit.creditClass1.maxTabletLine)),lineItemsHandsetArray=angular.isDefined(_searchJsonPathArray(lineItems,'[?(@.lineType=="HANDSET")]'))?_searchJsonPathArray(lineItems,'[?(@.lineType=="HANDSET")]'):[],lineItemsTabletArray=angular.isDefined(_searchJsonPathArray(lineItems,'[?(@.lineType=="TABLET")]'))?_searchJsonPathArray(lineItems,'[?(@.lineType=="TABLET")]'):[],lineItemsWearableArray=angular.isDefined(_searchJsonPathArray(lineItems,'[?(@.lineType=="WEARABLE")]'))?_searchJsonPathArray(lineItems,'[?(@.lineType=="WEARABLE")]'):[],lineItemsWearableArray&&(lineItemsTabletArray=lineItemsTabletArray?lineItemsTabletArray:[],lineItemsTabletArray=lineItemsTabletArray.concat(lineItemsWearableArray)),isLineMaxHandsetLimitReached=lineItemsHandsetArray&&lineItemsHandsetArray.length>=maxHandsetLength?!0:!1,isLineMaxTabletLimitReached=lineItemsTabletArray&&lineItemsTabletArray.length>=maxTabletLength?!0:!1,isDeviceLimitReached=lineItemsHandsetArray.length+lineItemsTabletArray.length>=totalProductsAllowed?!0:!1;var accessories=_getAccessoryDetails(myCart.cart),selectedShippingOptions=_getShippingOption(myCart.cart),wholeCartPrice=_cartPayNowMonthlyPrice(myCart.cart.pricing),cartLevelAutoPayObject=_searchJsonPath(myCart,'pricing.subTotal.promotions[?(@.promoType === "auto_pay")]');angular.isUndefined(cartLevelAutoPayObject)&&(cartLevelAutoPayObject=mockNoCredit),cartLevelAutoPayObject.applied=_autoPayAuditValue;var _autoPayDiscount=cartLevelAutoPayObject.discountValue.amount,cartDetails={mvcAttrs:{enablePlanSelector:globalConfig.cartSettings.enablePlanSelector},cartId:myCart.cart.cartId,orderId:myCart.cart.extCartId,tradeInType:_getCartTradeInType(lineItems),modifiedTime:moment().format("x"),selectedCreditClass:creditClassService.getCreditClass(),lineItems:lineItems,totalLines:lineItems.length,promotions:_getCartPromotions(_searchJsonPath(myCart.cart.pricing,"subTotal.promotions")),customPromotions:_getCustomCartPromotions(myCart.cart),payNowPrice:lodash.get(wholeCartPrice,"payNowPrice"),monthlyPrice:lodash.get(wholeCartPrice,"monthlyPrice"),subTotalPayNowPrice:lodash.get(wholeCartPrice,"subTotalPayNowPrice"),subTotalMonthlyPrice:lodash.get(wholeCartPrice,"subTotalMonthlyPrice"),refundableDesposit:lodash.get(wholeCartPrice,"refundableDesposit"),autoPayDiscount:"$"+_autoPayDiscount,finalShippingDate:_getFinalShippingDate(lineItems),total:lodash.get(wholeCartPrice,"total"),accessories:accessories,orderGroupData:orderGroupData,shippingOptions:selectedShippingOptions,flags:{isFamilyMatch:!1,isEmptyCart:!1,isOnlyAccessory:!1,isAccessoryFlow:!1,isPHPFlow:!0,isDefaultCart:!1,isCheckoutErrorMsg:!1,isLineMaxHandsetLimitReached:isLineMaxHandsetLimitReached,isLineMaxTabletLimitReached:isLineMaxTabletLimitReached,isDeviceLimitReached:isDeviceLimitReached,isOrderEligible:!1,isVoiceLineAdded:!1,isEmpty:!1,isProductAdded:!1,isPriceBreakdownEnable:!1,isNotifyFRP:!1,isNotifyEIP:!1,isMiniBrowseAccessoryEIPEligible:_getMiniBrowseEIPPrices(myCart.cart),isDeviceInHandset:!1,isDeviceinTablet:!1,isDeviceinWearable:!1,isEmptyLine:!1,isCheckoutEnable:!0,isAutoPayOn:cartLevelAutoPayObject.applied}};_autoPayDiscount>0&&(cartDetails.discount=cartLevelAutoPayObject.discountValue),cartDetails.accessories.accessoryDetails.length>0&&(cartDetails.flags.isOrderEligible=!0),lodash.forEach(cartDetails.lineItems,function(item){"HANDSET"===item.lineType&&item.isProductAdded===!0&&(cartDetails.flags.isDeviceInHandset=!0),"TABLET"===item.lineType&&item.isProductAdded===!0&&(cartDetails.flags.isDeviceInTablet=!0),"WEARABLE"===item.lineType&&item.isProductAdded===!0&&(cartDetails.flags.isDeviceInWearable=!0),item.isProductAdded===!1&&(cartDetails.flags.isEmptyLine=!0)});var isProductNotAddedInCart=_searchJsonPathArray(cartDetails,"lineItems[?(@.isOrderEligible == false)]"),isHandsetAddedInCart=_searchJsonPathArray(cartDetails,'[?(@.lineType=="HANDSET")]'),isLineItemsTabletInCart=_searchJsonPathArray(cartDetails,'[?(@.lineType=="TABLET")]'),isLineItemsWearableInCart=_searchJsonPathArray(cartDetails,'[?(@.lineType=="WEARABLE")]');isLineItemsWearableInCart&&(isLineItemsTabletInCart=isLineItemsTabletInCart?isLineItemsTabletInCart:[],isLineItemsTabletInCart=isLineItemsTabletInCart.concat(isLineItemsWearableInCart));var isPhpServiceAdded=_searchJsonPathArray(cartDetails.lineItems,"[?(@.isPHPFlow == true)]");cartDetails.flags.isPHPFlow=isPhpServiceAdded?!0:!1,cartDetails.flags.isOrderEligible=isProductNotAddedInCart?!1:!0,cartDetails.flags.isVoiceLineAdded=angular.isUndefined(isHandsetAddedInCart)?!1:!0,cartDetails.flags.isDefaultCart=cartStorage.getDefaultCartFlag(),0===cartDetails.lineItems.length&&0===cartDetails.accessories.accessoryDetails.length&&(cartDetails.flags.isEmpty=!0,cartDetails.flags.isOrderEligible=!1,cartDetails.flags.isOnlyAccessory=!1),0===cartDetails.lineItems.length&&cartDetails.accessories.accessoryDetails.length>0&&(cartDetails.flags.isOrderEligible=!0,cartDetails.flags.isOnlyAccessory=!0,cartDetails.flags.isPHPFlow=!1);var simKitData=_searchJsonPathArray(isHandsetAddedInCart,"simKitDetails");cartDetails.flags.isProductAdded=_searchJsonPath(simKitData,"[?(@.isProductAdded == true || @.isBYODAdded == true )]")?!0:!1,!cartDetails.flags.isProductAdded&&isLineItemsTabletInCart&&isLineItemsTabletInCart.length>=1?cartDetails.flags.isCheckoutErrorMsg=!1:cartDetails.flags.isCheckoutErrorMsg=!0,cartDetails.flags.isProductAdded&&isLineItemsTabletInCart&&isLineItemsTabletInCart.length>=1?cartDetails.flags.isHybridBanMsg=!0:cartDetails.flags.isHybridBanMsg=!1;var accessoryItems=_searchJsonPathArray(cartDetails,"accessories.accessoryDetails[?(@.isProductAdded == true)]");accessoryItems?cartDetails.flags.isPriceBreakdownEnable=!0:cartDetails.flags.isPriceBreakdownEnable=_searchJsonPathArray(cartDetails,"lineItems[?(@.isOrderEligible == true)]")?!0:!1,globalConfig.cartSettings.isPHPModalEnabled||(cartDetails.flags.isPHPFlow=!1);var paymentOption=_searchJsonPath(cartDetails,"accessories.accessoryDetails[0].paymentOption");return cartDetails.accessories.isAccessoryEIPEligible&&"FRP"!==paymentOption&&(cartDetails.flags.isNotifyEIP=!0),(cartDetails.accessories.isAccessoryEIPEligible&&"FRP"===paymentOption||!cartDetails.accessories.isAccessoryEIPEligible)&&(cartDetails.flags.isNotifyFRP=!0),commonUtils.transformByMap("transformCart",myCart.cart,cartDetails),_makeAmountAttributes(cartDetails),cartDetails}function _getStructuredCheckOutDetails(checkOutData){function createAddressObject(addressType){var addressObject={address1:_searchJsonPath(profileObject,addressType+".address1"),address2:_searchJsonPath(profileObject,addressType+".address2"),city:_searchJsonPath(profileObject,addressType+".city"),state:_searchJsonPath(profileObject,addressType+".region"),zip:_searchJsonPath(profileObject,addressType+".zipCode")};return addressObject}var personalInfo,shipInfo,billInfo,e911Info,billSameAsShip,e911SameAsShip,profileObject=_searchJsonPath(checkOutData,"cart.profile");profileObject||(profileObject={});var orderData=checkOutData;personalInfo={middleName:_searchJsonPath(profileObject,"personalInfo.middleName"),lastName:_searchJsonPath(profileObject,"personalInfo.lastName"),firstName:_searchJsonPath(profileObject,"personalInfo.firstName"),carrier:_searchJsonPath(profileObject,"personalInfo.carrier"),phoneNumber:_searchJsonPath(profileObject,"personalInfo.phoneNumber"),email:_searchJsonPath(profileObject,"personalInfo.confirmEmail"),confirmEmail:_searchJsonPath(profileObject,"personalInfo.confirmEmail"),creditClass:_searchJsonPath(profileObject,"personalInfo.creditClass")},shipInfo=createAddressObject("shippingAddress"),billInfo=createAddressObject("billingAddress"),e911Info=createAddressObject("e911Address");var tempShipInfo=angular.copy(shipInfo),tempBillInfo=angular.copy(billInfo),tempE911Info=angular.copy(e911Info);shipInfo&&billInfo&&angular.equals(tempShipInfo,tempBillInfo)?(billInfo=angular.copy(shipInfo),shipInfo.disclaimer={checkbox:!0},billSameAsShip=!0):(billInfo&&(shipInfo.disclaimer={checkbox:!1}),billSameAsShip=!1),shipInfo&&e911Info&&angular.equals(tempShipInfo,tempE911Info)?(e911Info=angular.copy(shipInfo),billInfo.disclaimer={checkbox:!0},e911SameAsShip=!0):e911Info?(billInfo.disclaimer={checkbox:!1},e911SameAsShip=!1):e911SameAsShip=!1;var creditcheck={idType:_searchJsonPath(orderData,"_creditcheckinfo[0]._creditcheckdetails..id-type"),idNumber:_searchJsonPath(orderData,"_creditcheckinfo[0]._creditcheckdetails..id-value"),expiryDate:_searchJsonPath(orderData,"_creditcheckinfo[0]._creditcheckdetails..expiry-date"),dob:_searchJsonPath(orderData,"_creditcheckinfo[0]._creditcheckdetails..bday"),state:_searchJsonPath(orderData,"_creditcheckinfo[0]._creditcheckdetails..region"),ssn:_searchJsonPath(orderData,"_creditcheckinfo[0]._creditcheckdetails..social-security-number")},chosenShippingOption={shippingOption:commonUtils.searchJson(checkOutData.cart.shippingOptions,'[?(@. selected =="true")]')?commonUtils.searchJson(checkOutData.cart.shippingOptions,'[?(@. selected =="true")]').name:void 0},pricingInfo=_getStructuredCheckOutSubTotal(orderData);pricingInfo.total.total=_createPriceBaseObject(_searchJsonPath(orderData,"_total[0].cost[0]"));var auditRecords=_getAuditRecords(checkOutData),checkOutInfo={personalInfo:personalInfo,shipInfo:shipInfo,billInfo:billInfo,e911Info:e911Info,creditcheck:creditcheck,chosenShipping:chosenShippingOption,billSameAsShip:billSameAsShip,e911SameAsShip:e911SameAsShip,flags:{}};return angular.merge(checkOutInfo,pricingInfo),angular.merge(checkOutInfo.flags,auditRecords),commonUtils.transformByMap("transformCheckOut",checkOutData,checkOutInfo),_makeAmountAttributes(checkOutInfo),checkOutInfo}function transformCartData(json){var transformedData=_getStructuredCartDetails(json);return $rootScope.$broadcast("cart-notifications",{cartData:transformedData}),transformedData}function transformCheckOutData(data){var carData=_getStructuredCartDetails(data);if(carData.error)return carData;var checkOutData=_getStructuredCheckOutDetails(data);return checkOutData.error||(checkOutData.reviewCart=carData),checkOutData}function transformCheckOutSubTotal(data){return _getStructuredCheckOutSubTotal(data)}function transformPlanConfigData(data){var planConfigData={},lineItems=[];if(data.plans){angular.forEach(data.plans.lines,function(linePlan){var planOptions=[],selectedPlan=_searchJsonPath(linePlan,"selectedPlan");angular.forEach(linePlan.planOptions,function(planOptionData){var planOption=planOptionData,planOptionSelectorId=_searchJsonPath(planOption,"planOptionSelectorId"),monthlyPrice=_searchJsonPath(planOption,"monthlyPrice");monthlyPrice||(monthlyPrice={}),planOption={planCode:_searchJsonPath(planOption,"label"),planOptionSelectorId:_searchJsonPath(planOption,"planOptionSelectorId"),isSelected:angular.equals(selectedPlan,planOptionSelectorId)?!0:!1,isHeroPlan:!1,monthlyPrice:{amount:monthlyPrice.price?parseFloat(monthlyPrice.price):void 0,amount00:0,amountDisplay:monthlyPrice.displayValue}},planOptions.push(planOption)});var highSpeedPlan=commonUtils.searchJson(planOptions,'[?(@.planCode == "'+globalConfig.cartSettings.line.plan.addOns.highSpeedPlanCode+'")]'),addOnsPlanSelectorId=commonUtils.searchJson(planOptions,"[?(@.isSelected == false )]");highSpeedPlan||(highSpeedPlan={}),addOnsPlanSelectorId||(addOnsPlanSelectorId={});var monthlyPrice=_searchJsonPath(linePlan,"monthlyPrice"),lineItem={lineNumber:_searchJsonPath(linePlan,"lineNumber"),planLineId:_searchJsonPath(linePlan,"lineId"),planLineType:_searchJsonPath(linePlan,"lineType"),lineItemDetails:{planDetails:{selectedPlanId:selectedPlan,planOptions:planOptions,addOns:{label:addOnsPlanSelectorId.planCode,planOptionSelectorId:addOnsPlanSelectorId.planOptionSelectorId,isSelected:highSpeedPlan.isSelected}}},subTotalMonthlyPrice:{amount:monthlyPrice.price?parseFloat(monthlyPrice.price):void 0,amount00:0,amountDisplay:monthlyPrice.displayValue}};lineItems.push(lineItem)}),lineItems=_.sortBy(lineItems,["lineNumber"]);var monthlyPrice=_searchJsonPath(data,"monthlyPrice");planConfigData={planConfigurationID:_searchJsonPath(data,"planConfigurationID"),lineItems:lineItems,monthlyPrice:{amount:monthlyPrice.price?parseFloat(monthlyPrice.price):void 0,amount00:0,amountDisplay:monthlyPrice.displayValue}}}return _makeAmountAttributes(planConfigData),planConfigData}function totalFinanceAmountCalculation(cartObj){var totalFinancedAmountAccessory=0,totalFinancedAmountDevice=0,totalFinancedAmount=0;return cartObj&&(cartObj.accessories||cartObj.lineItems)&&(cartObj.lineItems&&angular.forEach(cartObj.lineItems,function(value,key){var promoDev=0;if(angular.equals(value.lineItemDetails.deviceDetails.pricingOption,cartConstants.MONTHLY)&&value.lineItemDetails&&value.lineItemDetails.deviceDetails.catalogPrice){var devicePromotion=value.lineItemDetails.deviceDetails.promotions,catalogPrice=parseFloat(lodash.get(value.lineItemDetails,"deviceDetails.catalogPrice.listPrice.amount",0)),payNowPrice=parseFloat(lodash.get(value.lineItemDetails,"deviceDetails.payNowPrice.purchasePrice.amount",0));angular.isDefined(devicePromotion)&&angular.isDefined(devicePromotion.cart)&&angular.forEach(devicePromotion.cart,function(promotion,keys){promoDev+=parseFloat(lodash.get(promotion,"discountValue.amount",0))}),totalFinancedAmountDevice+=catalogPrice-promoDev-payNowPrice}}),cartObj.accessories&&angular.forEach(cartObj.accessories.accessoryDetails,function(value,key){var promoAcc=0;if(angular.equals(value.paymentOption,cartConstants.EIP)&&value.catalogPrice){var catalogPrice=parseFloat(lodash.get(value,"catalogPrice.listPrice.amount",0)),payNowPrice=parseFloat(lodash.get(value,"payNowPrice.purchasePrice.amount",0)),accCartPromotion=lodash.filter(value.promotions,{promoType:"CART"});angular.forEach(accCartPromotion,function(promotion,keys){promoAcc+=parseFloat(lodash.get(promotion,"discountValue.amount",0))}),totalFinancedAmountAccessory+=catalogPrice-promoAcc-payNowPrice}})),totalFinancedAmountDevice=0>totalFinancedAmountDevice?0:totalFinancedAmountDevice,totalFinancedAmountAccessory=0>totalFinancedAmountAccessory?0:totalFinancedAmountAccessory,totalFinancedAmount=parseFloat(totalFinancedAmountDevice)+parseFloat(totalFinancedAmountAccessory),totalFinancedAmount.toFixed(2)}var mockNoCredit={discountValue:{amount:5,currency:"USD",display:"5.00"},promoType:"auto_pay",applied:!0},_searchJsonPath=commonUtils.searchJson,_searchJsonPathArray=commonUtils.searchJsonArray;lodash.get(toggleService.model,"toggles.isEssentialsEnabled",!1);return{transformCartData:transformCartData,transformCheckOutData:transformCheckOutData,transformCheckOutSubTotal:transformCheckOutSubTotal,transformPlanConfigData:transformPlanConfigData,totalFinanceAmountCalculation:totalFinanceAmountCalculation,_getMonthlyPaymentDetails:_getMonthlyPaymentDetails}}transformCartFactoryV2.$inject=["$rootScope","creditClassService","toggleService","globalAssetRepositoryConstants","globalConfig","commonUtils","cartStorage","cartConstants","globalValue"],angular.module("tmobileCore").factory("transformCartV2",transformCartFactoryV2)}(window.angular,window._),function(angular,lodash){"use strict";function transformCartFactoryV1($rootScope,creditClassService,toggleService,globalConfig,commonUtils,cartStorage,defaultProductService){function _makeAmountAttributes(jsonData){var _amount00=_searchJsonPathArray(jsonData,"[?(@.amount00 == 0)]");return angular.forEach(_amount00,function(v,k){if(angular.isDefined(v.amount)){v.amount00=v.amount.toFixed(2);var splitAmount=v.amount00.split(".");v.amountDollar=splitAmount[0],v.amountCents=splitAmount[1]}}),jsonData}function _createPriceBaseObject(priceSource){var priceObject={amount:priceSource?parseFloat(priceSource.amount):void 0,amount00:0,amountDisplay:lodash.get(priceSource,"display")};return priceObject}function _productPayNowMonthlyPrice(_product){var productPayNowListPrice,productPayNowPurChasePrice,productMonthlyPaymentPrice,premiumFees,clubFees,refundableDeposit,deposit,productPriceListPrice,productPricePurChasePrice,productMonthlyPrice,productMonthlyPurchasePrice;productMonthlyPrice=_searchJsonPath(_product,"contractTerm"),productPayNowListPrice=_searchJsonPath(_product,"options.payNowAmount")?_searchJsonPath(_product,"options.payNowAmount"):_searchJsonPath(_product,"options[0].payNowAmount"),productPayNowPurChasePrice=_searchJsonPath(_product,"options.payNowAmount")?_searchJsonPath(_product,"options.payNowAmount"):_searchJsonPath(_product,"options[0].payNowAmount"),productMonthlyPaymentPrice=_searchJsonPath(_product,"options.monthlyAmount")?_searchJsonPath(_product,"options.monthlyAmount"):_searchJsonPath(_product,"options[0].monthlyAmount"),productMonthlyPurchasePrice=_searchJsonPath(_product,"options.monthlyAmount")?_searchJsonPath(_product,"options.monthlyAmount"):_searchJsonPath(_product,"options[0].monthlyAmount"),productPriceListPrice=_searchJsonPath(_product,"listPrice"),productPricePurChasePrice=_searchJsonPath(_product,"mrp"),premiumFees=_searchJsonPath(_product,"options.premiumFee")?_searchJsonPath(_product,"options.premiumFee"):_searchJsonPath(_product,"options[0].premiumFee"),clubFees=_searchJsonPath(_product,"options.clubFee")?_searchJsonPath(_product,"options.clubFee"):_searchJsonPath(_product,"options[0].clubFee"),refundableDeposit=_searchJsonPath(_product,"options.depositRefund")?_searchJsonPath(_product,"options.depositRefund"):_searchJsonPath(_product,"options[0].depositRefund"),deposit=_searchJsonPath(_product,"options.deposit")?_searchJsonPath(_product,"options.deposit"):_searchJsonPath(_product,"options[0].deposit");var wholePrice={payNowPrice:{listPrice:_createPriceBaseObject(productPayNowListPrice),purchasePrice:_createPriceBaseObject(productPayNowPurChasePrice)},monthlyPrice:_createPriceBaseObject(productMonthlyPaymentPrice),monthlyPurchasePrice:_createPriceBaseObject(productMonthlyPurchasePrice),price:{listPrice:_createPriceBaseObject(productPriceListPrice),purchasePrice:_createPriceBaseObject(productPricePurChasePrice)},premiumFee:{listPrice:_createPriceBaseObject(lodash.get(premiumFees,"listPrice")),purchasePrice:_createPriceBaseObject(lodash.get(premiumFees,"purchasePrice"))},clubFee:{listPrice:_createPriceBaseObject(lodash.get(clubFees,"listPrice.amount")),purchasePrice:_createPriceBaseObject(lodash.get(clubFees,"purchasePrice.amount"))},refundableDeposit:_createPriceBaseObject(refundableDeposit),deposit:_createPriceBaseObject(deposit)};return wholePrice.monthlyPrice.termMonths=productMonthlyPrice,wholePrice}function _simCardPayNowMonthlyPrice(_product){var productPayNowListPrice,productPayNowPurChasePrice,productMonthlyPaymentPrice,productMonthlyPrice,productSimKitListPrice;productSimKitListPrice=_searchJsonPath(_product,"listPrice"),productPayNowListPrice=_searchJsonPath(_product,"payNowPrice"),productPayNowPurChasePrice=_searchJsonPath(_product,"payNowPrice"),productMonthlyPaymentPrice=_searchJsonPath(_product,"monthlyPrice"),productMonthlyPrice=_searchJsonPath(_product,"contractTerm");var wholePrice={payNowPrice:{listPrice:_createPriceBaseObject(productPayNowListPrice),purchasePrice:_createPriceBaseObject(productPayNowPurChasePrice)},monthlyPrice:_createPriceBaseObject(productMonthlyPaymentPrice),simKitListPrice:_createPriceBaseObject(productSimKitListPrice),price:{listPrice:_createPriceBaseObject(productPayNowListPrice),purchasePrice:_createPriceBaseObject(productPayNowPurChasePrice)}};return wholePrice.monthlyPrice.termMonths=productMonthlyPrice,wholePrice}function _lineTotalPayNowMonthlyPrice(_product){var productPayNowPrice,productMonthlyPrice,refundPrice,totalPrice,subTotalPayNowPrice,subTotalMonthlyPrice;productPayNowPrice=_searchJsonPath(_product,"total.payNowPrice"),productMonthlyPrice=_searchJsonPath(_product,"total.monthlyPrice"),refundPrice=_searchJsonPath(_product,"refundableDepositAmount"),totalPrice=_searchJsonPath(_product,"tax.totalTax"),subTotalPayNowPrice=_searchJsonPath(_product,"subTotal.payNowPrice"),subTotalMonthlyPrice=_searchJsonPath(_product,"subTotal.monthlyPrice");var wholePrice={payNowPrice:_createPriceBaseObject(productPayNowPrice),monthlyPrice:_createPriceBaseObject(productMonthlyPrice),refundableDesposit:{amount:refundPrice?parseFloat(refundPrice.amount):void 0,amount00:0,amountDisplay:refundPrice},total:{amount:totalPrice?parseFloat(totalPrice.amount):void 0,amount00:0,amountDisplay:totalPrice?totalPrice:void 0},subTotalPayNowPrice:_createPriceBaseObject(subTotalPayNowPrice),subTotalMonthlyPrice:_createPriceBaseObject(subTotalMonthlyPrice)};return wholePrice}function _getAccessoryDetails(cartData){var accessoryTotalPrice,accessoryDetails=[],accessories={},accessoryElements=cartData.accessories;angular.forEach(accessoryElements,function(accessoryItem,key){var accessoryObject=accessoryItem,listPrice=(accessoryObject.description[0],_searchJsonPath(accessoryObject,"pricing.options.payNowAmount")),purchasePrice=_searchJsonPath(accessoryObject,"pricing.options.payNowAmount"),monthlyPrice=_searchJsonPath(accessoryObject,"pricing.options.monthlyAmount"),priceListPrice=_searchJsonPath(accessoryObject,"pricing.listPrice"),pricePurchasePrice=_searchJsonPath(accessoryObject,"pricing.mrp"),totlaAccessoryPrice=_searchJsonPath(accessoryObject,"pricing.total"),accessoryDetail={isProductAdded:!0,availablity:accessoryObject.availablity,id:accessoryObject.id,accessoryType:accessoryObject.productType,accessorySubType:accessoryObject.productSubType,sku:accessoryObject.sku,familyName:accessoryObject.skuName,quantity:accessoryObject.quantity,color:null,productImage:accessoryObject.productImageURL,skuName:accessoryObject.skuName,manufacturer:null,paymentOption:_searchJsonPath(accessoryObject,"pricing.options.type"),promotions:_searchJsonPath(accessoryObject,"pricing.promotions"),payNowPrice:{listPrice:_createPriceBaseObject(listPrice),purchasePrice:_createPriceBaseObject(purchasePrice)},monthlyPrice:{amount:_searchJsonPath(monthlyPrice,"amount"),amountDisplay:_searchJsonPath(monthlyPrice,"display"),termMonths:_searchJsonPath(accessoryObject,"pricing.options.contractTerm"),amount00:0},priceDetails:{listPrice:_createPriceBaseObject(priceListPrice),purchasePrice:_createPriceBaseObject(pricePurchasePrice)},totalPrice:_createPriceBaseObject(totlaAccessoryPrice)};accessoryDetail.productType=accessoryDetail.accessoryTypeaccessoryType,commonUtils.transformByMap("transformCartAccessoryItem",accessoryObject,accessoryDetail),accessoryDetails.push(accessoryDetail)}),cartData.accessoriesTotal&&(accessoryTotalPrice=cartData.accessoriesTotal[0]);var accPriceDetails=_createPriceBaseObject(accessoryTotalPrice),accPayNowPrice=_createPriceBaseObject(accessoryTotalPrice),accMonthlyPrice=_createPriceBaseObject(accessoryTotalPrice);return accessoryTotalPrice&&accessoryTotalPrice.payNowPrice&&(accPriceDetails=_createPriceBaseObject(accessoryTotalPrice.payNowPrice),accPayNowPrice=_createPriceBaseObject(accessoryTotalPrice.payNowPrice),accMonthlyPrice=_createPriceBaseObject(accessoryTotalPrice.monthlyPrice)),accessories={mvcAttrs:{},accessoryDetails:accessoryDetails,isAccessoryEIPEligible:_searchJsonPath(cartData,"accessoriesEipEligible"),priceDetails:accPriceDetails,payNowPrice:accPayNowPrice,monthlyPrice:accMonthlyPrice}}function _getShippingOption(cartData){var shippingOptions=cartData.shippingOptions,selectedShippingOptions=[];return angular.forEach(shippingOptions,function(value,key){var option={deliveryTime:value.deliveryTime,name:value.displayName,displayName:value.name,selected:value.selected,cost:value.cost,actionUrl:value.actionURL,costValue:value.cost?parseFloat(value.cost.substring(1)):void 0};selectedShippingOptions.push(option)}),selectedShippingOptions}function _getServiceDetails(lineData){var serviceDetails=[],preServiceDetails=_searchJsonPathArray(lineData,"service");return preServiceDetails&&(preServiceDetails=preServiceDetails[0],angular.forEach(preServiceDetails,function(serviceItem,key){var wholePrice=serviceItem.pricing?_productPayNowMonthlyPrice(serviceItem.pricing):void 0,serviceDetail={isProductAdded:_searchJsonPath(serviceItem,"skuName")?!0:!1,productType:_searchJsonPath(serviceItem,"productType"),sku:_searchJsonPath(serviceItem,"sku"),familyName:_searchJsonPath(serviceItem,"skuName"),serviceSOCs:void 0,payNowPrice:lodash.get(wholePrice,"payNowPrice"),isSelected:!0,enabled:!0,isAvailable:!0,monthlyPrice:lodash.get(wholePrice,"monthlyPrice"),pricing:_searchJsonPath(serviceItem,"pricing.options.monthlyAmount"),promotions:_searchJsonPath(serviceItem,"pricing.promotions")};serviceDetail.serviceCategory=_searchJsonPath(serviceItem,"category"),serviceDetail.serviceId=serviceDetail.sku,serviceDetail.serviceName=serviceDetail.familyName,serviceDetails.push(serviceDetail)})),serviceDetails}function _devicePricingOption(_product){var options;return options=_searchJsonPathArray(_product,"options")?_searchJsonPathArray(_product,"options")[0]:void 0,_searchJsonPath(options,"type")}function _getDeviceDetails(lineData){var deviceElement=_searchJsonPath(lineData,"device"),wholeDevicePrice=deviceElement.pricing?_productPayNowMonthlyPrice(deviceElement.pricing):void 0,pricingOption=deviceElement.pricing?_devicePricingOption(deviceElement.pricing):void 0,deviceDetails={id:deviceElement.id,productType:deviceElement.productType,productSubType:deviceElement.productSubType,sku:deviceElement.sku,deviceId:deviceElement.deviceId,familyName:lodash.get(deviceElement,"skuName"),quantity:1,memory:deviceElement.memory?deviceElement.memory[0]:void 0,color:deviceElement.color,isHandset:angular.equals(deviceElement.productSubType,"Handset")?!0:!1,isTablet:angular.equals(deviceElement.productSubType,"Tablet")?!0:!1,isWearable:angular.equals(deviceElement.productSubType,"Wearable")?!0:!1,memoryAnother:deviceElement.memoryAnother,colorAnother:deviceElement.colorAnother,colorSwatch:deviceElement.colorSwatch,manufacturer:deviceElement.manufacturer,frontImage:deviceElement.productImageURL,backImage:deviceElement.backImage,leftImage:deviceElement.leftImage,rightImage:deviceElement.rightImage,thumbNail:deviceElement.thumbNail,specImage:deviceElement.specImage,memoryUOM:deviceElement.memoryUOM,promotions:_searchJsonPath(deviceElement,"pricing.promotions"),payNowPrice:lodash.get(wholeDevicePrice,"payNowPrice"),monthlyPrice:lodash.get(wholeDevicePrice,"monthlyPrice"),priceDetails:lodash.get(wholeDevicePrice,"price"),premiumFee:lodash.get(wholeDevicePrice,"premiumFee"),refundableDeposit:lodash.get(wholeDevicePrice,"refundableDeposit"),clubFee:lodash.get(wholeDevicePrice,"clubFee"),deposit:lodash.get(wholeDevicePrice,"deposit"),totalPrice:{totalPriceDisplay:wholeDevicePrice?wholeDevicePrice.price.listPrice.amountDisplay:void 0},pricingOption:pricingOption};return deviceDetails=defaultProductService.updateMemoryValue(deviceDetails)}function _getPlanDetails(lineData){var planElement=_searchJsonPath(lineData,"plan"),wholePlanPrice=planElement.pricing?_productPayNowMonthlyPrice(planElement.pricing):void 0,planDetails={id:planElement.id,productType:planElement.productType,sku:planElement.code,description:_searchJsonPathArray(planElement,"description"),
familyName:lodash.get(planElement,"skuName"),manufacturer:planElement.manufacturer,memory:planElement.dataSize,planSOCs:void 0,promotions:_searchJsonPath(planElement,"pricing.promotions"),payNowPrice:lodash.get(wholePlanPrice,"payNowPrice"),monthlyPrice:lodash.get(wholePlanPrice,"monthlyPrice"),monthlyPurchasePrice:lodash.get(wholePlanPrice,"monthlyPurchasePrice")};return planDetails}function _getSimKitDetails(lineData){var simKitElement=_searchJsonPath(lineData,"simKit"),wholeSimKitPrice=simKitElement?_simCardPayNowMonthlyPrice(simKitElement):void 0,simKitDetails={id:simKitElement.id,productType:simKitElement.productType,productName:"SIM starter kit",manufacturer:simKitElement.manufacturer,simKitId:simKitElement.sku,simKitName:lodash.get(simKitElement,"skuName"),productImage:simKitElement.productImageURL,promotions:lodash.get(simKitElement,"offers"),payNowPrice:lodash.get(wholeSimKitPrice,"payNowPrice"),monthlyPrice:lodash.get(wholeSimKitPrice,"monthlyPrice"),priceDetails:lodash.get(wholeSimKitPrice,"price"),listPrice:lodash.get(wholeSimKitPrice,"simKitListPrice")};return simKitDetails}function _getAuditRecords(checkOutData){var autoPay=_searchJsonPath(checkOutData,'auditRecords[?(@["auditKey"]=="AUTO_PAY")].auditValue'),storePayment=_searchJsonPath(checkOutData,'auditRecords[?(@["auditKey"]=="STORE_PAYMENT")].auditValue'),auditRecords={isActualAutoPay:autoPay,isActualStorePayment:storePayment};return autoPay=angular.isDefined(autoPay)?JSON.parse(autoPay):!0,storePayment=angular.isDefined(storePayment)?JSON.parse(storePayment):!0,auditRecords.isAutoPay=autoPay,auditRecords.isStorePayment=storePayment,auditRecords}function _getStructuredCartDetails(myCart){if(!myCart.cart)return{flags:{},error:"error"};var cartLineItem=myCart.cart.lineOfServices,cartSettings=globalConfig.cartSettings,lineItems=[],orderGroupData={},orderStatusOrder=cartSettings.orderStatusOrder;orderStatusOrder||(orderStatusOrder={AVAILABLE_FOR_BACK_ORDER:{orderGroup:0,orderDisplay:"Back Order"},AVAILABLE_FOR_PRE_ORDER:{orderGroup:1,orderDisplay:"Pre Order"},AVAILABLE:{orderGroup:2,orderDisplay:"Your Order"}});var phpServiceName=lodash.get(cartSettings,"line.service.phpServiceName","Premium Handset Protection");angular.forEach(cartLineItem,function(element,key){var orderAvail=_searchJsonPath(element,"device.availability"),orderGroup=0,orderAvailDisplay="",orderStatusOrderValue=orderStatusOrder[orderAvail];orderStatusOrderValue?(orderGroup=orderStatusOrderValue.orderGroup,orderAvailDisplay=orderStatusOrderValue.orderDisplay):(orderAvail="AVAILABLE",orderAvailDisplay="Your Order",orderGroup=2),orderGroupData[orderGroup]=orderAvail,element.simKit=element.simCard?element.simCard:{},element.plan=element.plan?element.plan:{},element.device=element.device?element.device:{};var serviceDetails=_getServiceDetails(element),deviceDetails=_getDeviceDetails(element),planDetails=_getPlanDetails(element),simKitDetails=_getSimKitDetails(element),lineObject=element,wholeLinePrice=lineObject.pricing?_lineTotalPayNowMonthlyPrice(lineObject.pricing):void 0,lineLevelAutoPayObject=_searchJsonPath(element,'discounts[?(@.discounttype == "auto_pay")]');void 0==lineLevelAutoPayObject&&(lineLevelAutoPayObject=mockNoCredit);var lineItem={mvcAttrs:{},lineNo:element.lineNo,lineNumber:element.lineNo?parseInt(element.lineNo):element.lineNo,lineId:element.id,orderAvailability:orderAvail,orderGroup:orderGroup,orderAvailabilityDisplay:orderAvailDisplay,lineType:element.lineType,isPHPFlow:!0,isTradeInPromoFlow:cartStorage.getTradeInPromoFlag(element.id),isTradeInStandardFlow:cartStorage.getTradeInStandardFlag(element.id),lineItemDetails:{deviceDetails:deviceDetails,planDetails:planDetails,serviceDetails:serviceDetails},simKitDetails:simKitDetails,payNowPrice:lodash.get(wholeLinePrice,"payNowPrice"),monthlyPrice:lodash.get(wholeLinePrice,"monthlyPrice"),refundableDesposit:lodash.get(wholeLinePrice,"refundableDesposit"),subTotalPayNowPrice:lodash.get(wholeLinePrice,"subTotalPayNowPrice"),subTotalMonthlyPrice:lodash.get(wholeLinePrice,"subTotalMonthlyPrice"),discount:lineLevelAutoPayObject,isAutoPayOn:lineLevelAutoPayObject.eligible&&lineLevelAutoPayObject.applied,autoPayDiscount:"$"+lineLevelAutoPayObject.amount.amount};lineItem.lineItemDetails.deviceDetails.isProductAdded=lineItem.lineItemDetails.deviceDetails.sku?!0:!1,lineItem.lineItemDetails.planDetails.isProductAdded=lineItem.lineItemDetails.planDetails.id?!0:!1,lineItem.simKitDetails.isProductAdded=lineItem.simKitDetails.simKitId?!0:!1,lineItem.simKitDetails.isBYODAdded=!((angular.isUndefined(lineItem.simKitDetails.simKitId)||!angular.isUndefined(lineItem.lineItemDetails.deviceDetails.sku))&&"SIM_KIT_BYOD"!=lineItem.simKitDetails.simKitId),lineItem.simKitDetails.isOnlySimAdded=!((angular.isUndefined(lineItem.simKitDetails.simKitId)||!angular.isUndefined(lineItem.lineItemDetails.deviceDetails.sku))&&"SIM_KIT_BYOD"!=lineItem.simKitDetails.simKitId),lineItem.lineItemDetails.planDetails.planId=lineItem.lineItemDetails.planDetails.sku,lineItem.lineItemDetails.planDetails.planName=lineItem.lineItemDetails.planDetails.familyName,lineItem.simKitDetails.displayName=lineItem.simKitDetails.simKitName,angular.equals(lineItem.lineItemDetails.deviceDetails.pricingOption,"EIP")&&(lineItem.lineItemDetails.deviceDetails.pricingOption="MONTHLY"),lineItem.isOrderEligible=!1;var isProductAdded=_searchJsonPath(lineItem,"lineItemDetails.deviceDetails.isProductAdded");if(isProductAdded||(isProductAdded=_searchJsonPath(lineItem,"simKitDetails.isProductAdded")),isProductAdded?lineItem.isOrderEligible=!0:lineItem.isOrderEligible=!1,lineItem.isProductAdded=lineItem.isOrderEligible,1==lineItem.simKitDetails.isBYODAdded)lineItem.isPHPFlow=!1;else{var phpServiceAvailable=_searchJsonPath(lineItem,'lineItemDetails.serviceDetails[?(@.serviceCategory =="'+phpServiceName+'")]');phpServiceAvailable||(lineItem.isPHPFlow=!1)}commonUtils.transformByMap("cartLineItem",lineObject,lineItem),lineItems.push(lineItem)}),lineItems=_.sortBy(lineItems,["lineNumber"]);var lineItemsHandsetArray,lineItemsTabletArray,maxHandsetLength,totalProductsAllowed,maxTabletLength,isLineMaxHandsetLimitReached,isLineMaxTabletLimitReached,isDeviceLimitReached,lineItemsWearableArray,selectedCreditType;selectedCreditType=creditClassService.getCreditClass(),selectedCreditType&&selectedCreditType["class"]&&("creditClass3"==selectedCreditType["class"]?(totalProductsAllowed=cartSettings.maxLineLimit.creditClass3.maxTotalLine,maxHandsetLength=cartSettings.maxLineLimit.creditClass3.maxHandsetLine,maxTabletLength=cartSettings.maxLineLimit.creditClass3.maxTabletLine):(totalProductsAllowed=cartSettings.maxLineLimit.creditClass1.maxTotalLine,maxHandsetLength=cartSettings.maxLineLimit.creditClass1.maxHandsetLine,maxTabletLength=cartSettings.maxLineLimit.creditClass1.maxTabletLine)),lineItemsHandsetArray=angular.isUndefined(_searchJsonPathArray(lineItems,'[?(@.lineType=="HANDSET")]'))?[]:_searchJsonPathArray(lineItems,'[?(@.lineType=="HANDSET")]'),lineItemsTabletArray=angular.isUndefined(_searchJsonPathArray(lineItems,'[?(@.lineType=="TABLET")]'))?[]:_searchJsonPathArray(lineItems,'[?(@.lineType=="TABLET")]'),lineItemsWearableArray=angular.isUndefined(_searchJsonPathArray(lineItems,'[?(@.lineType=="WEARABLE")]'))?[]:_searchJsonPathArray(lineItems,'[?(@.lineType=="WEARABLE")]'),lineItemsWearableArray&&(lineItemsTabletArray=lineItemsTabletArray?lineItemsTabletArray:[],lineItemsTabletArray=lineItemsTabletArray.concat(lineItemsWearableArray)),isLineMaxHandsetLimitReached=lineItemsHandsetArray&&lineItemsHandsetArray.length>=maxHandsetLength?!0:!1,isLineMaxTabletLimitReached=lineItemsTabletArray&&lineItemsTabletArray.length>=maxTabletLength?!0:!1,isDeviceLimitReached=lineItemsHandsetArray.length+lineItemsTabletArray.length>=totalProductsAllowed?!0:!1;var accessories=_getAccessoryDetails(myCart.cart),selectedShippingOptions=_getShippingOption(myCart.cart),wholeCartPrice=_lineTotalPayNowMonthlyPrice(myCart.cart.pricing),cartLevelAutoPayObject=_searchJsonPath(myCart,'pricing.discounts[?(@.discounttype == "auto_pay")]');void 0==cartLevelAutoPayObject&&(cartLevelAutoPayObject=mockNoCredit);var cartDetails={mvcAttrs:{enablePlanSelector:globalConfig.cartSettings.enablePlanSelector},cartId:myCart.cart.cartId,orderId:myCart.cart.orderId,modifiedTime:moment().format("x"),selectedCreditClass:creditClassService.getCreditClass(),lineItems:lineItems,promotions:myCart.cart.pricing.promotions,payNowPrice:lodash.get(wholeCartPrice,"payNowPrice"),monthlyPrice:lodash.get(wholeCartPrice,"monthlyPrice"),subTotalPayNowPrice:_searchJsonPath(myCart.cart.pricing.subtotal,"payNowPrice"),subTotalMonthlyPrice:_searchJsonPath(myCart.cart.pricing.subtotal,"monthlyPrice"),refundableDesposit:lodash.get(wholeCartPrice,"refundableDesposit"),autoPayDiscount:"$"+cartLevelAutoPayObject.amount.amount,discount:cartLevelAutoPayObject,total:lodash.get(wholeCartPrice,"total"),accessories:accessories,orderGroupData:orderGroupData,shippingOptions:selectedShippingOptions,flags:{isFamilyMatch:!1,isEmptyCart:!1,isOnlyAccessory:!1,isAccessoryFlow:!1,isCheckoutErrorMsg:!1,isPHPFlow:!0,isDefaultCart:!1,isLineMaxHandsetLimitReached:isLineMaxHandsetLimitReached,isLineMaxTabletLimitReached:isLineMaxTabletLimitReached,isDeviceLimitReached:isDeviceLimitReached,isOrderEligible:!1,isVoiceLineAdded:!1,isEmpty:!1,isProductAdded:!1,isPriceBreakdownEnable:!1,isNotifyFRP:!1,isNotifyEIP:!1,isAutoPayOn:cartLevelAutoPayObject.eligible&&cartLevelAutoPayObject.applied},discountedMonthlyPrice:cartLevelAutoPayObject.eligible&&cartLevelAutoPayObject.applied?cartLevelAutoPayObject.priceAfterDiscount.amount:cartLevelAutoPayObject.priceBeforeDiscount.amount};cartDetails.accessories.accessoryDetails.length>0&&(cartDetails.flags.isOrderEligible=!0);var isProductNotAddedInCart=_searchJsonPathArray(cartDetails,"lineItems[?(@.isOrderEligible == false)]"),isHandsetAddedInCart=_searchJsonPathArray(cartDetails,'[?(@.lineType=="HANDSET")]'),isLineItemsTabletInCart=_searchJsonPathArray(cartDetails,'[?(@.lineType=="TABLET")]'),isLineItemsWearableInCart=_searchJsonPathArray(cartDetails,'[?(@.lineType=="WEARABLE")]');isLineItemsWearableInCart&&(isLineItemsTabletInCart=isLineItemsTabletInCart?isLineItemsTabletInCart:[],isLineItemsTabletInCart=isLineItemsTabletInCart.concat(isLineItemsWearableInCart));var isPhpServiceAdded=_searchJsonPathArray(cartDetails.lineItems,"[?(@.isPHPFlow == true)]");cartDetails.flags.isPHPFlow=isPhpServiceAdded?!0:!1,cartDetails.flags.isVoiceLineAdded=angular.isUndefined(isHandsetAddedInCart)?!1:!0,isProductNotAddedInCart||angular.isUndefined(isHandsetAddedInCart)?cartDetails.flags.isOrderEligible=!1:cartDetails.flags.isOrderEligible=!0,cartDetails.flags.isDefaultCart=cartStorage.getDefaultCartFlag(),0===cartDetails.lineItems.length&&0===cartDetails.accessories.accessoryDetails.length&&(cartDetails.flags.isEmpty=!0,cartDetails.flags.isOrderEligible=!1,cartDetails.flags.isOnlyAccessory=!1),0===cartDetails.lineItems.length&&cartDetails.accessories.accessoryDetails.length>0&&(cartDetails.flags.isOrderEligible=!0,cartDetails.flags.isOnlyAccessory=!0,cartDetails.flags.isPHPFlow=!1);var simKitData=_searchJsonPathArray(isHandsetAddedInCart,"simKitDetails");cartDetails.flags.isProductAdded=_searchJsonPath(simKitData,"[?(@.isProductAdded == true || @.isBYODAdded == true )]")?!0:!1,!cartDetails.flags.isProductAdded&&isLineItemsTabletInCart&&isLineItemsTabletInCart.length>=1?cartDetails.flags.isCheckoutErrorMsg=!1:cartDetails.flags.isCheckoutErrorMsg=!0,cartDetails.flags.isProductAdded&&isLineItemsTabletInCart&&isLineItemsTabletInCart.length>=1?cartDetails.flags.isHybridBanMsg=!0:cartDetails.flags.isHybridBanMsg=!1;var accessoryItems=_searchJsonPathArray(cartDetails,"accessories.accessoryDetails[?(@.isProductAdded == true)]");accessoryItems?cartDetails.flags.isPriceBreakdownEnable=!0:cartDetails.flags.isPriceBreakdownEnable=_searchJsonPathArray(cartDetails,"lineItems[?(@.isOrderEligible == true)]")?!0:!1,globalConfig.cartSettings.isPHPModalEnabled||(cartDetails.flags.isPHPFlow=!1);var paymentOption=_searchJsonPath(cartDetails,"accessories.accessoryDetails[0].paymentOption");return cartDetails.accessories.isAccessoryEIPEligible&&"FRP"!=paymentOption&&(cartDetails.flags.isNotifyEIP=!0),(cartDetails.accessories.isAccessoryEIPEligible&&"FRP"==paymentOption||!cartDetails.accessories.isAccessoryEIPEligible)&&(cartDetails.flags.isNotifyFRP=!0),commonUtils.transformByMap("transformCart",myCart.cart,cartDetails),_makeAmountAttributes(cartDetails),cartDetails}function _getStructuredCheckOutDetails(checkOutData){function createAddressObject(addressType){var addressObject={address1:_searchJsonPath(profileObject,addressType+".address1"),address2:_searchJsonPath(profileObject,addressType+".address2"),city:_searchJsonPath(profileObject,addressType+".city"),state:_searchJsonPath(profileObject,addressType+".region"),zip:_searchJsonPath(profileObject,addressType+".zipCode")};return addressObject}var personalInfo,shipInfo,billInfo,e911Info,billSameAsShip,e911SameAsShip,profileObject=_searchJsonPath(checkOutData,"cart.profile");profileObject||(profileObject={});var orderData=checkOutData;personalInfo={middleName:_searchJsonPath(profileObject,"personalInfo.middleName"),lastName:_searchJsonPath(profileObject,"personalInfo.lastName"),firstName:_searchJsonPath(profileObject,"personalInfo.firstName"),carrier:_searchJsonPath(profileObject,"personalInfo.carrier"),phoneNumber:_searchJsonPath(profileObject,"personalInfo.phoneNumber"),email:_searchJsonPath(profileObject,"personalInfo.confirmEmail"),confirmEmail:_searchJsonPath(profileObject,"personalInfo.confirmEmail"),creditClass:_searchJsonPath(profileObject,"personalInfo.creditClass")},shipInfo=createAddressObject("shippingAddress"),billInfo=createAddressObject("billingAddress"),e911Info=createAddressObject("e911Address");var tempShipInfo=angular.copy(shipInfo),tempBillInfo=angular.copy(billInfo),tempE911Info=angular.copy(e911Info);shipInfo&&billInfo&&angular.equals(tempShipInfo,tempBillInfo)?(billInfo=angular.copy(shipInfo),shipInfo.disclaimer={checkbox:!0},billSameAsShip=!0):(billInfo&&(shipInfo.disclaimer={checkbox:!1}),billSameAsShip=!1),shipInfo&&e911Info&&angular.equals(tempShipInfo,tempE911Info)?(e911Info=angular.copy(shipInfo),billInfo.disclaimer={checkbox:!0},e911SameAsShip=!0):e911Info&&(billInfo.disclaimer={checkbox:!1},e911SameAsShip=!1);var creditcheck={idType:_searchJsonPath(orderData,"_creditcheckinfo[0]._creditcheckdetails..id-type"),idNumber:_searchJsonPath(orderData,"_creditcheckinfo[0]._creditcheckdetails..id-value"),expiryDate:_searchJsonPath(orderData,"_creditcheckinfo[0]._creditcheckdetails..expiry-date"),dob:_searchJsonPath(orderData,"_creditcheckinfo[0]._creditcheckdetails..bday"),state:_searchJsonPath(orderData,"_creditcheckinfo[0]._creditcheckdetails..region"),ssn:_searchJsonPath(orderData,"_creditcheckinfo[0]._creditcheckdetails..social-security-number")},chosenShippingOption={shippingOption:commonUtils.searchJson(checkOutData.cart.shippingOptions,'[?(@. selected =="true")]')?commonUtils.searchJson(checkOutData.cart.shippingOptions,'[?(@. selected =="true")]').name:void 0},pricingInfo=_getStructuredCheckOutSubTotal(orderData);pricingInfo.total.total=_createPriceBaseObject(_searchJsonPath(orderData,"_total[0].cost[0]"));var auditRecords=_getAuditRecords(checkOutData),checkOutInfo={personalInfo:personalInfo,shipInfo:shipInfo,billInfo:billInfo,e911Info:e911Info,creditcheck:creditcheck,chosenShipping:chosenShippingOption,billSameAsShip:billSameAsShip,e911SameAsShip:e911SameAsShip,flags:{}};return angular.merge(checkOutInfo,pricingInfo),angular.merge(checkOutInfo.flags,auditRecords),commonUtils.transformByMap("transformCheckOut",checkOutData,checkOutInfo),_makeAmountAttributes(checkOutInfo),checkOutInfo}function _getStructuredCheckOutSubTotal(checkOutData){var amountDisplay=_searchJsonPath(checkOutData,'shippingOptions[?(@.selected==="true")].cost'),taxTotal=_searchJsonPath(checkOutData,"pricing.tax.totalTax"),monthlyPrice=_searchJsonPath(checkOutData,"pricing.total.monthlyPrice"),payNowPrice=_searchJsonPath(checkOutData,"pricing.total.payNowPrice"),shippingFee={display:amountDisplay,amount:amountDisplay?parseFloat(amountDisplay.replace(/\$|,/g,"")):amountDisplay,amount00:0,amountDisplay:amountDisplay},allTotal={subTotal:{tax:{total:_createPriceBaseObject(taxTotal)},shippingFee:_createPriceBaseObject(shippingFee),oneTimeFee:{amount:0,amount00:0,amountDisplay:"$0.00"}},total:{monthlyPrice:_createPriceBaseObject(monthlyPrice),payNowPrice:_createPriceBaseObject(payNowPrice)}};return commonUtils.transformByMap("transformCheckOutSubTotal",checkOutData,allTotal),_makeAmountAttributes(allTotal),allTotal}function transformCartData(json){var transformedData=_getStructuredCartDetails(json);return $rootScope.$broadcast("cart-notifications",{cartData:transformedData}),transformedData}function transformCheckOutData(data){var carData=_getStructuredCartDetails(data);if(carData.error)return carData;var checkOutData=_getStructuredCheckOutDetails(data);return checkOutData.error||(checkOutData.reviewCart=carData),checkOutData}function transformCheckOutSubTotal(data){return _getStructuredCheckOutSubTotal(data)}function transformPlanConfigData(data){var planConfigData={},lineItems=[];if(data.plans){angular.forEach(data.plans.lines,function(linePlan,key){var planOptions=[],selectedPlan=_searchJsonPath(linePlan,"selectedPlan");angular.forEach(linePlan.planOptions,function(planOption,key){var planOptionSelectorId=_searchJsonPath(planOption,"planOptionSelectorId"),monthlyPrice=_searchJsonPath(planOption,"monthlyPrice");monthlyPrice||(monthlyPrice={});var planOption={planCode:_searchJsonPath(planOption,"label"),planOptionSelectorId:_searchJsonPath(planOption,"planOptionSelectorId"),isSelected:angular.equals(selectedPlan,planOptionSelectorId)?!0:!1,isHeroPlan:!1,monthlyPrice:{amount:monthlyPrice.price?parseFloat(monthlyPrice.price):void 0,amount00:0,amountDisplay:monthlyPrice.displayValue}};planOptions.push(planOption)});var highSpeedPlan=commonUtils.searchJson(planOptions,'[?(@.planCode == "'+globalConfig.cartSettings.line.plan.addOns.highSpeedPlanCode+'")]'),addOnsPlanSelectorId=commonUtils.searchJson(planOptions,"[?(@.isSelected == false )]");highSpeedPlan||(highSpeedPlan={}),addOnsPlanSelectorId||(addOnsPlanSelectorId={});var monthlyPrice=_searchJsonPath(linePlan,"monthlyPrice"),lineItem={lineNumber:_searchJsonPath(linePlan,"lineNumber"),planLineId:_searchJsonPath(linePlan,"lineId"),planLineType:_searchJsonPath(linePlan,"lineType"),lineItemDetails:{planDetails:{selectedPlanId:selectedPlan,planOptions:planOptions,addOns:{label:addOnsPlanSelectorId.planCode,planOptionSelectorId:addOnsPlanSelectorId.planOptionSelectorId,isSelected:highSpeedPlan.isSelected}}},subTotalMonthlyPrice:{amount:monthlyPrice.price?parseFloat(monthlyPrice.price):void 0,amount00:0,amountDisplay:monthlyPrice.displayValue}};lineItems.push(lineItem)}),lineItems=_.sortBy(lineItems,["lineNumber"]);var monthlyPrice=_searchJsonPath(data,"monthlyPrice");planConfigData={planConfigurationID:_searchJsonPath(data,"planConfigurationID"),lineItems:lineItems,monthlyPrice:{amount:monthlyPrice.price?parseFloat(monthlyPrice.price):void 0,amount00:0,amountDisplay:monthlyPrice.displayValue}}}return _makeAmountAttributes(planConfigData),planConfigData}var mockNoCredit={eligible:!0,amount:{amount:5,currency:"USD",display:"5.00"},discounttype:"auto_pay",applied:!0,priceAfterDiscount:{amount:100,currency:"USD",display:"100.00"},priceBeforeDiscount:{amount:105,currency:"USD",display:"105.00"}},_searchJsonPath=commonUtils.searchJson,_searchJsonPathArray=commonUtils.searchJsonArray;return{transformCartData:transformCartData,transformCheckOutData:transformCheckOutData,transformCheckOutSubTotal:transformCheckOutSubTotal,transformPlanConfigData:transformPlanConfigData}}transformCartFactoryV1.$inject=["$rootScope","creditClassService","toggleService","globalConfig","commonUtils","cartStorage","defaultProductService"],angular.module("tmobileCore").factory("transformCartV1",transformCartFactoryV1)}(window.angular,window._),function(angular){"use strict";function transformCartFactory(apiService,transformCartV1,transformCartV2,transformCartV3){function getFactory(apiKey){return apiKey?3===apiService.getVersion(apiKey)?transformCartV3:2===apiService.getVersion(apiKey)?transformCartV2:transformCartV1:void 0}return{getFactory:getFactory}}transformCartFactory.$inject=["apiService","transformCartV1","transformCartV2","transformCartV3"],angular.module("tmobileCore").factory("transformCart",transformCartFactory)}(window.angular),function(angular){"use strict";function CartUtilsFn(jsonPath,coreServices,apiURLs,cartStorage){var resetTokenCount=0;return{checkError:function(response){var errorData;return response&&(-1===response.status&&null===response.data||response.data&&response.data.errors)&&(resetTokenCount++,errorData={error:"error",errorDesc:"Error when connecting the Cart",resetToken:!0,resetTokenCount:resetTokenCount}),errorData},getCommonErrorData:function(){var errorData;return errorData={error:"error",errorDesc:"Error when connecting"}},checkSuccess:function(response){var successData;return(angular.equals("Created",response.statusText)||angular.equals("OK",response.statusText))&&(successData="done"),successData},searchJson:function(jsonData,jPath){var value,val=jsonPath(jsonData,"$.."+jPath);return angular.isDefined(val)&&val.length>0&&(value=val[0]),value},searchJsonArray:function(jsonData,jPath){var value,val=jsonPath(jsonData,"$.."+jPath);return angular.isDefined(val)&&val.length>0&&(value=val),value}}}CartUtilsFn.$inject=["jsonPath","coreServices","apiURLs","cartStorage"],angular.module("tmobileCore").service("CartUtils",CartUtilsFn)}(angular),function(angular,lodash){"use strict";function cartStorageServiceConstructor($rootScope,commonStorage,PROFILE_DATA,SHIPPING_DATA,CART_STORAGE_EVENTS,$log,toggleService){function getGlobalSmartCartInfo(){return privateModel.smartCartInfo}function setGlobalSmartCartInfo(smartCartInfo,onLoad){privateModel.smartCartInfo=smartCartInfo,privateModel.noOfItemsProcessed=0;var digitalToRetail=lodash.get(toggleService.model,"toggles.digitalToRetail",!1);if(!digitalToRetail||!onLoad||lodash.isEmpty(privateModel.smartCartInfo.lineItems)&&lodash.isEmpty(privateModel.smartCartInfo.accessories.accessoryDetails))me.isDataSocSelected||me.raisePdlEvent(privateModel.smartCartInfo);else{$rootScope.$on(CART_STORAGE_EVENTS.ON_LOAD_CART_PAGE,function(event,data,storeId){$log.log("pdl.run.onLoadCartPage :: cart page is loaded with inventory status:",data),setTotalItemsCount(),lodash.isEmpty(privateModel.smartCartInfo.lineItems)||me.setCartInfo(privateModel.smartCartInfo.lineItems,!0,data,storeId),lodash.isEmpty(privateModel.smartCartInfo.accessories)||me.setCartInfo(privateModel.smartCartInfo.accessories.accessoryDetails,!1,data,storeId),me.isDataSocSelected||privateModel.noOfItemsProcessed!==privateModel.totalNoOfItemsInCart||me.raisePdlEvent(privateModel.smartCartInfo)})}}function setTotalItemsCount(){privateModel.totalNoOfItemsInCart=0,lodash.isEmpty(privateModel.smartCartInfo.lineItems)||(privateModel.totalNoOfItemsInCart=lodash.filter(privateModel.smartCartInfo.lineItems,function(line){return lodash.isUndefined(line.lineItemDetails.deviceDetails.sku)?void 0:line}).length),lodash.isEmpty(privateModel.smartCartInfo.accessories)||(privateModel.totalNoOfItemsInCart=privateModel.totalNoOfItemsInCart+privateModel.smartCartInfo.accessories.accessoryDetails.length)}function setCartInfo(items,isDevice,data,storeId){angular.forEach(items,function(item){isDevice?item.lineItemDetails.deviceDetails.sku===data.sku&&lodash.isUndefined(item.lineItemDetails.deviceDetails.storeID)&&(item.lineItemDetails.deviceDetails.statusValue=data.inventoryAvailability.statusValue,item.lineItemDetails.deviceDetails.storeID=storeId,item.lineItemDetails.deviceDetails.discount=lodash.get(item,"discount.discountValue.amount",""),privateModel.noOfItemsProcessed=privateModel.noOfItemsProcessed+1):item.sku===data.sku&&lodash.isUndefined(item.storeID)&&(item.statusValue=data.inventoryAvailability.statusValue,item.storeID=storeId,privateModel.noOfItemsProcessed=privateModel.noOfItemsProcessed+1)})}function raisePdlEvent(smartCartInfo){$log.log("pdl.run.raisePdlEvent :: smartCartInfo:",smartCartInfo),$rootScope.$emit(CART_STORAGE_EVENTS.PDL_CHANGES_IN_CART_DATA,smartCartInfo),$rootScope.$emit(CART_STORAGE_EVENTS.CART_BACKGROUND_PROCESS,smartCartInfo)}function getPersistedGlobalSmartCartInfo(){return privateModel.persistedSmartCartInfo}function setPersistedGlobalSmartCartInfo(smartCartInfo){privateModel.persistedSmartCartInfo=smartCartInfo}function setDefaultCartFlag(value){commonStorage.assignIntoSharedCookie(CART_STORAGE_EVENTS.ISLINE,value)}function getDefaultCartFlag(){var flag=commonStorage.getFromSharedCookie(CART_STORAGE_EVENTS.ISLINE);return flag!==!1}function getGlobalCheckOutInfo(){return privateModel.checkOutInfo}function setGlobalCheckOutInfo(checkOutInfo){checkOutInfo&&(checkOutInfo.cardInfo={}),privateModel.checkOutInfo=checkOutInfo}function getCartUrl(){return privateModel.cartUrl}function setCartUrl(cartUrl){if(privateModel.cartUrl=cartUrl,cartUrl&&""!==cartUrl){var cartId=cartUrl.split("raptor/")[1];cartId&&me.setCartId(cartId)}}function getCartToken(){return commonStorage.getToken()}function setCartToken(cartToken){commonStorage.setToken(cartToken)}function getAuthCount(){return privateModel.authCount}function setAuthCount(authCount){privateModel.authCount=authCount}function getFingerPrintId(){return privateModel.fingerPrintId}function setFingerPrintId(fingerprint){privateModel.fingerPrintId=fingerprint}function setLineServiceConstituentActionURL(lineServiceConstituentActionURL){commonStorage.assignIntoSharedCookie(CART_STORAGE_EVENTS.SELECT_CONSTITUENT_ACTION_URL,lineServiceConstituentActionURL)}function getLineServiceConstituentActionURL(){return commonStorage.getFromSharedCookie(CART_STORAGE_EVENTS.SELECT_CONSTITUENT_ACTION_URL)}function setCreditClassJson(creditClassJson){commonStorage.assignIntoSharedLS(CART_STORAGE_EVENTS.CREDIT_CLASS_JSON,creditClassJson)}function setSIMKitDetails(simKitDetails){commonStorage.assignIntoSharedSession(CART_STORAGE_EVENTS.SIM_KIT_DETAILS,simKitDetails)}function getSIMKitDetails(){return commonStorage.getFromSharedSession(CART_STORAGE_EVENTS.SIM_KIT_DETAILS)}function setProfileData(profileData){privateModel.profileData=profileData}function getProfileData(){return privateModel.profileData}function setDeviceFamily(skuId,familyId){var key=CART_STORAGE_EVENTS.FAMILY_DATA,familyJson=commonStorage.getFromSharedSLS(key)||{};familyJson[skuId]=familyId,commonStorage.assignIntoSharedLS(key,familyJson)}function getDeviceFamily(skuId){var deviceFamily,familyJson=commonStorage.getFromSharedSLS(CART_STORAGE_EVENTS.FAMILY_DATA);return familyJson&&(deviceFamily=familyJson[skuId]),deviceFamily}function setAccessoryFamily(skuId,familyId){var key=CART_STORAGE_EVENTS.FAMILY_DATA,familyJson=commonStorage.getFromSharedSLS(key)||{};familyJson[skuId]=familyId,commonStorage.assignIntoSharedLS(key,familyJson)}function getAccessoryFamily(skuId){var accessoryFamily,familyJson=commonStorage.getFromSharedSLS(CART_STORAGE_EVENTS.FAMILY_DATA);return familyJson&&(accessoryFamily=familyJson[skuId]),accessoryFamily}function getRecentDeviceFamily(){var recentDeviceFamily,familyJson=commonStorage.getFromSharedSLS(CART_STORAGE_EVENTS.FAMILY_DATA);return familyJson&&(recentDeviceFamily=familyJson[Object.keys(familyJson)[0]]),recentDeviceFamily}function setPaymentOption(paymentoption){commonStorage.assignIntoSharedSession(CART_STORAGE_EVENTS.PAYMENT_OPTION,paymentoption)}function getPaymentOption(){return commonStorage.getFromSharedCookie(CART_STORAGE_EVENTS.PAYMENT_OPTION)||commonStorage.getFromSharedSession(CART_STORAGE_EVENTS.PAYMENT_OPTION)}function getSKU(){return commonStorage.getFromSharedCookie(CART_STORAGE_EVENTS.SKU)}function getZipCode(){return commonStorage.getFromSharedSession(CART_STORAGE_EVENTS.ZIP_CODE)}function setZipCode(zipCode){commonStorage.assignIntoSharedSession(CART_STORAGE_EVENTS.ZIP_CODE,zipCode)}function getStateCode(){return commonStorage.getFromSharedSession(CART_STORAGE_EVENTS.STATE_CODE)}function setStateCode(stateCode){commonStorage.assignIntoSharedSession(CART_STORAGE_EVENTS.STATE_CODE,stateCode)}function clearAfterOrderCreatedAndAuthFail(){me.setGlobalSmartCartInfo(void 0),me.setGlobalCheckOutInfo(void 0),me.setCartUrl(void 0),me.setCartId(void 0),me.setZipCode(void 0),me.setStateCode(void 0),me.setRecommendedZipCode(void 0),commonStorage.destroyCacheObject()}function setMockCartCreated(value){commonStorage.assignIntoSharedCookie(CART_STORAGE_EVENTS.MOCK_CREATED,value)}function getMockCartCreated(){return commonStorage.getFromSharedCookie(CART_STORAGE_EVENTS.MOCK_CREATED)}function setCartId(cartId){commonStorage.assignIntoSharedCookie(CART_STORAGE_EVENTS.CART_ID,cartId);var parsedToken,accessTokenLs,timeToLiveLs,isDCPV3=lodash.get(toggleService.model,"toggles.isDcpV3ApiEnabled",!0);commonStorage.getFromSharedCookie("shared_id")||(isDCPV3?(parsedToken=angular.fromJson(localStorage.getItem("jwt_token")||"{}"),accessTokenLs=parsedToken.access_token,commonStorage.assignIntoSharedCookie("shared_id",accessTokenLs)):(parsedToken=angular.fromJson(localStorage.getItem("token")||"{}"),accessTokenLs=parsedToken.access_token,timeToLiveLs=parsedToken.timetolive,commonStorage.assignIntoSharedCookie("shared_id",accessTokenLs),commonStorage.assignIntoSharedCookie("timetolive",timeToLiveLs)))}function getCartId(){return commonStorage.getFromSharedCookie(CART_STORAGE_EVENTS.CART_ID)}function removeCartId(){commonStorage.removeFromSharedCookie(CART_STORAGE_EVENTS.CART_ID)}function setOrderId(orderId){orderId&&commonStorage.assignIntoSharedCookie(CART_STORAGE_EVENTS.ORDER_ID,orderId)}function getOrderId(){return commonStorage.getFromSharedCookie(CART_STORAGE_EVENTS.ORDER_ID)}function removOrderId(){commonStorage.removeFromSharedCookie(CART_STORAGE_EVENTS.ORDER_ID)}function setServiceId(serviceId,lineId){"clearData"===serviceId?commonStorage.assignIntoSharedLS(CART_STORAGE_EVENTS.SERVICE_ID+lineId,void 0):serviceId&&commonStorage.assignIntoSharedLS(CART_STORAGE_EVENTS.SERVICE_ID+lineId,serviceId)}function getServiceId(lineId){return commonStorage.getFromSharedSLS(CART_STORAGE_EVENTS.SERVICE_ID+lineId)}function setSelectedServiceId(serviceId,lineId){"clearData"===serviceId?commonStorage.assignIntoSharedLS(CART_STORAGE_EVENTS.SELECTED_SERVICE_ID+lineId,void 0):serviceId&&commonStorage.assignIntoSharedLS(CART_STORAGE_EVENTS.SELECTED_SERVICE_ID+lineId,serviceId)}function getSelectedServiceId(lineId){return commonStorage.getFromSharedSLS(CART_STORAGE_EVENTS.SELECTED_SERVICE_ID+lineId)}function removeServiceId(lineId){commonStorage.removeFromSharedSLS(CART_STORAGE_EVENTS.SERVICE_ID+lineId),commonStorage.removeFromSharedSLS(CART_STORAGE_EVENTS.SELECTED_SERVICE_ID+lineId),commonStorage.removeFromSharedSLS(CART_STORAGE_EVENTS.BUNDLE_SERVICES+lineId)}function getLineType(lineId){return lineId?commonStorage.getFromSharedCookie(CART_STORAGE_EVENTS.LINE_TYPE+lineId):commonStorage.getFromSharedCookie(CART_STORAGE_EVENTS.LINE_TYPE)}function setLineType(lineType,lineId){lineType&&commonStorage.assignIntoSharedCookie(CART_STORAGE_EVENTS.LINE_TYPE+lineId,lineType)}function getVersionId(){return commonStorage.getFromSharedCookie(CART_STORAGE_EVENTS.VERSION_ID)}function setVersionId(versionId){commonStorage.assignIntoSharedCookie(CART_STORAGE_EVENTS.VERSION_ID,versionId)}function getPlanConfigData(){return privateModel.planConfigData}function setPlanConfigData(planConfigData){privateModel.planConfigData=planConfigData}function getCurrentState(){return privateModel.currentState}function setCurrentState(currentState){privateModel.currentState=currentState}function getColorSwatchFlag(lineId){return commonStorage.getFromSharedCookie(CART_STORAGE_EVENTS.COLOR_SWATCH+lineId)}function setColorSwatchFlag(lineId,value){
commonStorage.assignIntoSharedCookie(CART_STORAGE_EVENTS.COLOR_SWATCH+lineId,value)}function getServiceOptions(lineId,storageMode){return lodash.get(toggleService.model,"toggles.isEssentialsEnabled",!1)?commonStorage.getFromSharedSLS(CART_STORAGE_EVENTS.SERVICE_OPTIONS+lineId):commonStorage.getFromSharedCache(CART_STORAGE_EVENTS.SERVICE_OPTIONS+lineId,storageMode)}function setServiceOptions(lineId,value,storageMode,expireInMs){lodash.get(toggleService.model,"toggles.isEssentialsEnabled",!1)?commonStorage.assignIntoSharedLS(CART_STORAGE_EVENTS.SERVICE_OPTIONS+lineId,value):commonStorage.assignIntoSharedCache(CART_STORAGE_EVENTS.SERVICE_OPTIONS+lineId,value,storageMode,expireInMs)}function getEligibleDataSocs(lineId,lineType){return commonStorage.getFromSharedSLS(CART_STORAGE_EVENTS.ELIGIBLE_DATA_SOCS+lineId+lineType)}function setEligibleDataSocs(lineId,lineType,dataSocObj){commonStorage.assignIntoSharedLS(CART_STORAGE_EVENTS.ELIGIBLE_DATA_SOCS+lineId+lineType,dataSocObj)}function getRecommendedZipCode(){return commonStorage.getFromSharedSession(CART_STORAGE_EVENTS.RECOMMENDED_ZIP_CODE)}function setRecommendedZipCode(zipCode){commonStorage.assignIntoSharedSession(CART_STORAGE_EVENTS.RECOMMENDED_ZIP_CODE,zipCode)}function setBundleServices(serviceData,lineId){"clearData"===serviceData?commonStorage.assignIntoSharedLS(CART_STORAGE_EVENTS.BUNDLE_SERVICES+lineId,void 0):serviceData&&commonStorage.assignIntoSharedLS(CART_STORAGE_EVENTS.BUNDLE_SERVICES+lineId,serviceData)}function getBundleServices(lineId){return commonStorage.getFromSharedSLS(CART_STORAGE_EVENTS.BUNDLE_SERVICES+lineId)}function getNotificationState(){return commonStorage.getFromSharedSLS(CART_STORAGE_EVENTS.NOTIFICATION_STATE)}function setNotificationState(value){commonStorage.assignIntoSharedLS(CART_STORAGE_EVENTS.NOTIFICATION_STATE,value)}function getEIPSettings(){return commonStorage.getFromSharedSLS(CART_STORAGE_EVENTS.EIP_SETTINGS)}function setEIPSettings(value){commonStorage.assignIntoSharedLS(CART_STORAGE_EVENTS.EIP_SETTINGS,value)}function getRecommendedServiceFlag(lineId){return commonStorage.getFromSharedSLS(CART_STORAGE_EVENTS.RECOMMENDED_SERVICE_TILE+lineId)}function setRecommendedServiceFlag(lineId,value){commonStorage.assignIntoSharedLS(CART_STORAGE_EVENTS.RECOMMENDED_SERVICE_TILE+lineId,value)}function setDevices(devicesData){var devices=devicesData;angular.isArray(devices)||(devices=angular.fromJson(devices));var deviceList=_.filter(devices,function(value){return"Smartphone"===value.device_type||"Phone First"===value.device_type}),tabletList=_.filter(devices,function(value){return"webConnect"===value.device_type});me.devices=deviceList,me.tablets=tabletList}function getDevices(){return me.devices}function getTablets(){return me.tablets}function setCarriers(carriersData){var carriers=carriersData;angular.isArray(carriers)||(carriers=angular.fromJson(carriers)),me.carriers=carriers}function getCarriers(){return me.carriers}function setFbSessionId(fbSessionId){commonStorage.assignIntoSharedSession(CART_STORAGE_EVENTS.FB_SESSION_ID,fbSessionId)}function getFbSessionId(){return commonStorage.getFromSharedSession(CART_STORAGE_EVENTS.FB_SESSION_ID)}function isAccessoryEIPtoggle(status){status||commonStorage.getFromSharedSession(CART_STORAGE_EVENTS.EIPTOGGLE),commonStorage.assignIntoSharedSession(CART_STORAGE_EVENTS.EIPTOGGLE,status)}function eipNudge(code){code||commonStorage.getFromSharedSession(CART_STORAGE_EVENTS.EIPNUDGE),commonStorage.assignIntoSharedSession(CART_STORAGE_EVENTS.EIPNUDGE,code)}function accessoryPaymentOption(option){option||commonStorage.getFromSharedSession(CART_STORAGE_EVENTS.ACCESSORYPAYMENTOPTION),commonStorage.assignIntoSharedSession(CART_STORAGE_EVENTS.ACCESSORYPAYMENTOPTION,option)}function getCreditClassChange(){return commonStorage.getFromSharedSession(CART_STORAGE_EVENTS.CREDIT_CLASS_CHANGE)}function getCreditClass(){return commonStorage.getFromSharedCookie(CART_STORAGE_EVENTS.CREDIT_CLASS)}function setCreditClassChange(isChange,lineCount){var creditClassChange=getCreditClassChange();angular.isUndefined(creditClassChange)&&(creditClassChange={}),creditClassChange.isChange=isChange,angular.isDefined(lineCount)&&(creditClassChange.count=lineCount),commonStorage.assignIntoSharedSession(CART_STORAGE_EVENTS.CREDIT_CLASS_CHANGE,creditClassChange)}function setAbandonCartURL(abandonCartURL){commonStorage.assignIntoSharedCookie(CART_STORAGE_EVENTS.ABANDON_CART_URL,abandonCartURL)}function getAbandonCartURL(){return commonStorage.getFromSharedCookie(CART_STORAGE_EVENTS.ABANDON_CART_URL)}function setSaveCartURL(saveCartURL){commonStorage.assignIntoSharedCookie(CART_STORAGE_EVENTS.SAVE_CART_URL,saveCartURL)}function getSaveCartURL(){return commonStorage.getFromSharedCookie(CART_STORAGE_EVENTS.SAVE_CART_URL)}function setSaveCartFlag(saveCartFlag){commonStorage.assignIntoSharedCookie(CART_STORAGE_EVENTS.SAVE_CART_FLAG,saveCartFlag)}function getSaveCartFlag(){return commonStorage.getFromSharedCookie(CART_STORAGE_EVENTS.SAVE_CART_FLAG)}function setFinalizeInStoreFlag(finalizeInStoreFlag){commonStorage.assignIntoSharedCookie(CART_STORAGE_EVENTS.FINALIZE_IN_STORE_FLAG,finalizeInStoreFlag)}function getFinalizeInStoreFlag(){commonStorage.assignIntoSharedCookie(CART_STORAGE_EVENTS.FINALIZE_IN_STORE_FLAG)}function setPsSessionId(psSessionId){commonStorage.assignIntoSharedSession(CART_STORAGE_EVENTS.PS_SESSION_ID,psSessionId)}function getPsSessionId(){return commonStorage.getFromSharedSession(CART_STORAGE_EVENTS.PS_SESSION_ID)}function setTradeInPromoFlag(lineId,value){commonStorage.assignIntoSharedLS(CART_STORAGE_EVENTS.TRADE_IN_PROMO_FLAG+lineId,value)}function getTradeInPromoFlag(lineId){return commonStorage.getFromSharedSLS(CART_STORAGE_EVENTS.TRADE_IN_PROMO_FLAG+lineId)}function setTradeInStandardFlag(lineId,value){commonStorage.assignIntoSharedLS(CART_STORAGE_EVENTS.TRADE_IN_STANDARD_FLAG+lineId,value)}function getTradeInStandardFlag(lineId){return commonStorage.getFromSharedSLS(CART_STORAGE_EVENTS.TRADE_IN_STANDARD_FLAG+lineId)}function setTmoData(data){commonStorage.assignIntoSharedTmoCookie(CART_STORAGE_EVENTS.TMO,data)}function setShippingOption(shippingOption){me.shippingOption=shippingOption}function getShippingOption(){return me.shippingOption}function setProfileId(profileId){commonStorage.assignIntoSharedCookie(CART_STORAGE_EVENTS.PROFILE_ID,profileId)}function getProfileId(){return commonStorage.getFromSharedCookie(CART_STORAGE_EVENTS.PROFILE_ID)}function setAuditRecords(auditRecords){me.auditRecords=auditRecords}function getAuditRecords(){return me.auditRecords}function setWebOnlyInfo(value){commonStorage.assignIntoSharedCookie(CART_STORAGE_EVENTS.WEB_ONLY,value)}function getWebOnlyInfo(){return commonStorage.getFromSharedCookie(CART_STORAGE_EVENTS.WEB_ONLY)}function setCreditProfileId(creditProfileId){commonStorage.assignIntoSharedCookie(CART_STORAGE_EVENTS.CREDIT_PROFILE_ID,creditProfileId)}function getCreditProfileId(){return commonStorage.getFromSharedCookie(CART_STORAGE_EVENTS.CREDIT_PROFILE_ID)}function removeCreditProfileId(){commonStorage.removeFromSharedCookie(CART_STORAGE_EVENTS.CREDIT_PROFILE_ID)}function setProfileAccountId(profileAccountId){commonStorage.assignIntoSharedCookie(CART_STORAGE_EVENTS.PROFILE_ACCOUNT_ID,profileAccountId)}function getProfileAccountId(){return commonStorage.getFromSharedCookie(CART_STORAGE_EVENTS.PROFILE_ACCOUNT_ID)}function setSoftCreditCheck(scc){commonStorage.assignIntoSharedCookie(CART_STORAGE_EVENTS.SOFT_CREDIT_CHECK,scc)}function getSoftCreditCheck(){return commonStorage.getFromSharedCookie(CART_STORAGE_EVENTS.SOFT_CREDIT_CHECK)}function removeSoftCreditCheck(){commonStorage.removeFromSharedCookie(CART_STORAGE_EVENTS.SOFT_CREDIT_CHECK)}function setHardCreditCheck(hcc){commonStorage.assignIntoSharedCookie(CART_STORAGE_EVENTS.HARD_CREDIT_CHECK,hcc)}function getHardCreditCheck(){return commonStorage.getFromSharedCookie(CART_STORAGE_EVENTS.HARD_CREDIT_CHECK)}function removeHardCreditCheck(){commonStorage.removeFromSharedCookie(CART_STORAGE_EVENTS.HARD_CREDIT_CHECK)}function setPriceIndicator(priceIndicator){commonStorage.assignIntoSharedCookie(CART_STORAGE_EVENTS.PRICEINDICATOR,priceIndicator)}function getPriceIndicator(){return commonStorage.getFromSharedCookie(CART_STORAGE_EVENTS.PRICEINDICATOR)}function setPlanIntentCookie(plan){commonStorage.assignIntoSharedCookie(CART_STORAGE_EVENTS.RATE_PLAN_INTENT,plan)}function getPlanIntentCookie(){return commonStorage.getFromSharedCookie(CART_STORAGE_EVENTS.RATE_PLAN_INTENT)}function removePlanIntentCookie(){return commonStorage.removeFromSharedCookie(CART_STORAGE_EVENTS.RATE_PLAN_INTENT)}function setSelectedPlanType(planType){commonStorage.assignIntoSharedCookie(CART_STORAGE_EVENTS.SELECTED_PLAN_TYPE,planType)}function getSelectedPlanType(){return commonStorage.getFromSharedCookie(CART_STORAGE_EVENTS.SELECTED_PLAN_TYPE)}function getIsEIPReservationRequired(){return commonStorage.getFromSharedCookie(CART_STORAGE_EVENTS.IS_EIP_RESERVATION_REQUIRED)}function setIsEIPReservationRequired(flag){commonStorage.assignIntoSharedCookie(CART_STORAGE_EVENTS.IS_EIP_RESERVATION_REQUIRED,flag)}var me;me=this;var privateModel={authCount:0,apiDay2:!0,profileData:{}},isDataSocSelected=!1;commonStorage.destroyCacheObject(),me.setGlobalSmartCartInfo=setGlobalSmartCartInfo,me.getGlobalSmartCartInfo=getGlobalSmartCartInfo,me.setGlobalCheckOutInfo=setGlobalCheckOutInfo,me.getGlobalCheckOutInfo=getGlobalCheckOutInfo,me.getPersistedGlobalSmartCartInfo=getPersistedGlobalSmartCartInfo,me.setPersistedGlobalSmartCartInfo=setPersistedGlobalSmartCartInfo,me.setCartUrl=setCartUrl,me.getCartUrl=getCartUrl,me.setCartToken=setCartToken,me.getCartToken=getCartToken,me.setAuthCount=setAuthCount,me.getAuthCount=getAuthCount,me.setFingerPrintId=setFingerPrintId,me.getFingerPrintId=getFingerPrintId,me.setLineServiceConstituentActionURL=setLineServiceConstituentActionURL,me.getLineServiceConstituentActionURL=getLineServiceConstituentActionURL,me.setCreditClassJson=setCreditClassJson,me.setSIMKitDetails=setSIMKitDetails,me.getSIMKitDetails=getSIMKitDetails,me.setProfileData=setProfileData,me.getProfileData=getProfileData,me.setDeviceFamily=setDeviceFamily,me.getDeviceFamily=getDeviceFamily,me.setAccessoryFamily=setAccessoryFamily,me.getAccessoryFamily=getAccessoryFamily,me.getRecentDeviceFamily=getRecentDeviceFamily,me.setPaymentOption=setPaymentOption,me.getPaymentOption=getPaymentOption,me.getSKU=getSKU,me.setServiceOptions=setServiceOptions,me.getServiceOptions=getServiceOptions,me.getRecommendedServiceFlag=getRecommendedServiceFlag,me.setRecommendedServiceFlag=setRecommendedServiceFlag,me.setRecommendedZipCode=setRecommendedZipCode,me.getRecommendedZipCode=getRecommendedZipCode,me.getZipCode=getZipCode,me.setZipCode=setZipCode,me.clearAfterOrderCreatedAndAuthFail=clearAfterOrderCreatedAndAuthFail,me.setMockCartCreated=setMockCartCreated,me.getMockCartCreated=getMockCartCreated,me.setCartId=setCartId,me.getCartId=getCartId,me.removeCartId=removeCartId,me.setNotificationState=setNotificationState,me.getNotificationState=getNotificationState,me.setEIPSettings=setEIPSettings,me.getEIPSettings=getEIPSettings,me.setOrderId=setOrderId,me.getOrderId=getOrderId,me.removOrderId=removOrderId,me.setServiceId=setServiceId,me.getServiceId=getServiceId,me.setSelectedServiceId=setSelectedServiceId,me.getSelectedServiceId=getSelectedServiceId,me.setBundleServices=setBundleServices,me.getBundleServices=getBundleServices,me.removeServiceId=removeServiceId,me.getLineType=getLineType,me.setLineType=setLineType,me.getVersionId=getVersionId,me.setVersionId=setVersionId,me.getPlanConfigData=getPlanConfigData,me.setPlanConfigData=setPlanConfigData,me.getCurrentState=getCurrentState,me.setCurrentState=setCurrentState,me.getColorSwatchFlag=getColorSwatchFlag,me.setColorSwatchFlag=setColorSwatchFlag,me.getDefaultCartFlag=getDefaultCartFlag,me.setDefaultCartFlag=setDefaultCartFlag,me.setDevices=setDevices,me.getDevices=getDevices,me.getTablets=getTablets,me.setCarriers=setCarriers,me.getCarriers=getCarriers,me.setFbSessionId=setFbSessionId,me.getFbSessionId=getFbSessionId,me.setAbandonCartURL=setAbandonCartURL,me.getAbandonCartURL=getAbandonCartURL,me.setSaveCartURL=setSaveCartURL,me.getSaveCartURL=getSaveCartURL,me.setSaveCartFlag=setSaveCartFlag,me.getSaveCartFlag=getSaveCartFlag,me.setFinalizeInStoreFlag=setFinalizeInStoreFlag,me.getFinalizeInStoreFlag=getFinalizeInStoreFlag,me.setPsSessionId=setPsSessionId,me.getPsSessionId=getPsSessionId,me.setTradeInPromoFlag=setTradeInPromoFlag,me.getTradeInPromoFlag=getTradeInPromoFlag,me.setTradeInStandardFlag=setTradeInStandardFlag,me.getTradeInStandardFlag=getTradeInStandardFlag,me.setCreditClassChange=setCreditClassChange,me.getCreditClassChange=getCreditClassChange,me.getCreditClass=getCreditClass,me.setAuditRecords=setAuditRecords,me.getAuditRecords=getAuditRecords,me.setShippingOption=setShippingOption,me.getShippingOption=getShippingOption,me.setProfileId=setProfileId,me.getProfileId=getProfileId,me.accessoryPaymentOption=accessoryPaymentOption,me.isAccessoryEIPtoggle=isAccessoryEIPtoggle,me.eipNudge=eipNudge,me.PROFILE_DATA=PROFILE_DATA,me.SHIPPING_DATA=SHIPPING_DATA,me.setTmoData=setTmoData,me.setWebOnlyInfo=setWebOnlyInfo,me.getWebOnlyInfo=getWebOnlyInfo,me.raisePdlEvent=raisePdlEvent,me.setCartInfo=setCartInfo,me.setCreditProfileId=setCreditProfileId,me.getCreditProfileId=getCreditProfileId,me.removeCreditProfileId=removeCreditProfileId,me.setProfileAccountId=setProfileAccountId,me.getProfileAccountId=getProfileAccountId,me.setSoftCreditCheck=setSoftCreditCheck,me.getSoftCreditCheck=getSoftCreditCheck,me.removeSoftCreditCheck=removeSoftCreditCheck,me.setHardCreditCheck=setHardCreditCheck,me.getHardCreditCheck=getHardCreditCheck,me.removeHardCreditCheck=removeHardCreditCheck,me.setPlanIntentCookie=setPlanIntentCookie,me.getPlanIntentCookie=getPlanIntentCookie,me.removePlanIntentCookie=removePlanIntentCookie,me.setSelectedPlanType=setSelectedPlanType,me.getSelectedPlanType=getSelectedPlanType,me.getIsEIPReservationRequired=getIsEIPReservationRequired,me.setIsEIPReservationRequired=setIsEIPReservationRequired,me.setPriceIndicator=setPriceIndicator,me.getPriceIndicator=getPriceIndicator,me.getEligibleDataSocs=getEligibleDataSocs,me.setEligibleDataSocs=setEligibleDataSocs,me.isDataSocSelected=isDataSocSelected,me.getStateCode=getStateCode,me.setStateCode=setStateCode}cartStorageServiceConstructor.$inject=["$rootScope","commonStorage","PROFILE_DATA","SHIPPING_DATA","CART_STORAGE_EVENTS","$log","toggleService"],angular.module("tmobileCore").constant("PROFILE_DATA",{firstName:".",lastName:".",emailId:"x@x.com"}).constant("SHIPPING_DATA",{address1:"1 MLK Blvd",city:"Atlanta",state:"GA",zip:"30324"}).constant("CART_STORAGE_SESSION_KEYS",{GLOBAL_SMART_CART_INFO:"globalSmartCartInfo",GLOBAL_CHECKOUT_INFO:"globalCheckOutInfo"}).constant("CART_STORAGE_EVENTS",{SKU:"sku",PDL_CHANGES_IN_CART_DATA:"pdlChangesInCartData",CART_BACKGROUND_PROCESS:"cartBackgroundProcess",SIM_KIT_DETAILS:"SIMKitDetails",PAYMENT_OPTION:"paymentOption",ZIP_CODE:"zipCode",FAMILY_DATA:"familData",SELECT_CONSTITUENT_ACTION_URL:"selectconstituentactionURL",CREDIT_CLASS_JSON:"creditClassJson",MOCK_CREATED:"mockCreated",CART_ID:"cartId",ORDER_ID:"orderId",SERVICE_ID:"serviceId",SELECTED_SERVICE_ID:"selectedServiceId",LINE_TYPE:"lineType",VERSION_ID:"versionId",COLOR_SWATCH:"colorSwatch",SERVICE_OPTIONS:"serviceOptions",RECOMMENDED_SERVICE_TILE:"recommendedServiceTile",RECOMMENDED_ZIP_CODE:"RecommendedZipCode",BUNDLE_SERVICES:"bundleServices",ISLINE:"isLine",FB_SESSION_ID:"fbSessionId",NOTIFICATION_STATE:"notification_state",EIP_SETTINGS:"EIPSettings",ABANDON_CART_URL:"abandonCartURL",SAVE_CART_URL:"saveCartURL",SAVE_CART_FLAG:"saveCartFlag",CREDIT_CLASS:"creditClass",CREDIT_CLASS_CHANGE:"is_credit_class_change",PS_SESSION_ID:"psSessionId",TRADE_IN_PROMO_FLAG:"tradeInPromoFlag",TRADE_IN_STANDARD_FLAG:"tradeInStandardFlag",EIPTOGGLE:"isAccessoryEIPtoggle",EIPNUDGE:"eipnudge",ACCESSORYPAYMENTOPTION:"accessoryPaymentOption",TMO:"tmo2mytmo",FINALIZE_IN_STORE_FLAG:"finalizeInStoreFlag",PROFILE_ID:"profileId",WEB_ONLY:"WebOnlyOffer",ON_LOAD_CART_PAGE:"onLoadCartPage",CREDIT_PROFILE_ID:"creditProfileId",PROFILE_ACCOUNT_ID:"profileAccountId",SOFT_CREDIT_CHECK:"scc",HARD_CREDIT_CHECK:"hcc",PRICEINDICATOR:"priceIndicator",ELIGIBLE_DATA_SOCS:"dataSocOnAddOnModal",RATE_PLAN_INTENT:"ratePlanIntent",SELECTED_PLAN_TYPE:"planType",IS_EIP_RESERVATION_REQUIRED:"isEIPReservationEligible"}).service("cartStorage",cartStorageServiceConstructor)}(angular,window._),function(angular,lodash){"use strict";function apiServiceConstructor(toggleService,apiURLs,apiURLsV2,apiURLsV3){function getVersion(apiKey){var version;return version=lodash.get(apiURLsV3,apiKey)?3:lodash.get(apiURLsV2,apiKey)?2:1}function getURL(apiKey){var url;url=lodash.get(apiURLsV3,apiKey)?lodash.get(apiURLsV3,apiKey):lodash.get(apiURLsV2,apiKey)?lodash.get(apiURLsV2,apiKey):lodash.get(apiURLs,apiKey);var version=getVersion(apiKey);return{url:url,version:version}}var vm=this;return vm.getVersion=getVersion,vm.getURL=getURL,vm}apiServiceConstructor.$inject=["toggleService","apiURLs","apiURLsV2","apiURLsV3"],angular.module("tmobileCore").service("apiService",apiServiceConstructor)}(window.angular,window._),function(angular,_,CQ_Analytics){"use strict";function cqAnlyticesService(){function clearCQAnalytics(){angular.isDefined(CQ_Analytics)&&CQ_Analytics.TmobileStoreMgr&&(CQ_Analytics.TmobileStoreMgr.setProperty("devicetype",""),CQ_Analytics.TmobileStoreMgr.setProperty("sku",""),CQ_Analytics.TmobileStoreMgr.setProperty("Family",""),CQ_Analytics.TmobileStoreMgr.setProperty("Manufacturer",""),CQ_Analytics.TmobileStoreMgr.setProperty("browsePageType",""),CQ_Analytics.TmobileStoreMgr.setProperty("SiteType",""))}var service=this;return service.clearCQAnalytics=clearCQAnalytics,service}angular.module("tmobileApp").service("cqAnlyticesService",cqAnlyticesService)}(angular,_,window.CQ_Analytics),function(angular,_){"use strict";function unoHandOffV3Constructor($log,$state,commonStorage,globalValue,unoHandOff,tokenTtl,cartConstants,dataFactory,essentialsService,essentialsServiceCart,cartStorage,cartHttpDataService,toggleService,$q,cartControllerHelperService){function getPlanType(essentialAuthorObject){return _.find(essentialAuthorObject.devicePlans,function(plan){return plan.isDefault===!0})}function getDataFactoryRequest(){var dfRequest=new dataFactory.DFRequest;return dfRequest.input={key:cartConstants.ESSENTIALS_CONSTANT.PLAN_TYPE},dfRequest}function line2getPlanType(essentialAuthorObject){var dfRequest=getDataFactoryRequest(),cacheKey=cartConstants.ESSENTIALS_CONSTANT.CACHE.DATA_KEY_NEW+JSON.stringify(dfRequest.input),dataCache=dataFactory.getCacheObject(cartConstants.ESSENTIALS_CONSTANT.CACHE.NAME),planType=dataCache.get(cacheKey);return planType||(planType=getPlanType(essentialAuthorObject).planType),planType}function postPlantoCart(createdLineItem,plan,getEligibleResponse){return essentialsServiceCart.postPlansToCart(createdLineItem,plan,getEligibleResponse,!0,createdLineItem.lineId).then(function(postPlanInLineResp){$log.log("In line plan is updated",postPlanInLineResp),vm.planIntentScenario&&cartStorage.removePlanIntentCookie(),$state.go("myCart")})["catch"](function(postPlanInLineError){$log.error("cart creation something wrong",postPlanInLineError)})}function initialization(_toggleData){var sharedCookieValues=unoHandOff.sharedCookie(_toggleData);return sharedCookieValues.cartId&&(unoHandOff.cookieManager(sharedCookieValues,"v3"),sharedCookieValues.sku)?cartHttpDataService.getCart().then(function(response){if(_toggleData.toggles.isEclaEnabled&&(cartControllerHelperService.checkFinanceEstimatesCall(),commonStorage.removeFromSharedCookie(cartConstants.PAYMENT_OPTION)),response&&response.lineItems.length>=0){globalValue&&globalValue.authorValue&&!globalValue.authorValue.cart&&unoHandOff.getEssentialsAuthorData();var sharedStructCartData=cartStorage.getGlobalSmartCartInfo(),length=sharedStructCartData.lineItems.length-1,createdLineItem=sharedStructCartData.lineItems[length],newLineId=createdLineItem.lineId;return cartStorage.setCartId(sharedStructCartData.cartId),cartStorage.setOrderId(sharedStructCartData.orderId),essentialsService.getEligiblePlans(newLineId,createdLineItem.lineType,!1).then(function(getEligibleResponse){$log.log("cart loaded",getEligibleResponse);var plan,essentialAuthorObject=_.get(globalValue.authorValue,"cart.essentials","");if(vm.planIntentScenario){plan=cartStorage.getPlanIntentCookie();var dfRequest=getDataFactoryRequest();dataFactory.setVO(cartConstants.ESSENTIALS_CONSTANT.CACHE.DATA_KEY_NEW,dfRequest,plan)}else plan=line2getPlanType(essentialAuthorObject);return commonStorage.removeFromSharedCookie("sku"),0>=length?essentialsServiceCart.createAuditRecord().then(function(auditResponse){if($log.log("Audit call executed",auditResponse),vm.planIntentScenario){var defPromise;return defPromise=essentialsServiceCart.checkEligibilityAndOpenIneligibleModal(createdLineItem,plan)?postPlantoCart(createdLineItem,plan,getEligibleResponse):$q.defer()}return postPlantoCart(createdLineItem,plan,getEligibleResponse)})["catch"](function(auditError){$log.error("In cart creation during audit call something went wrong",auditError)}):postPlantoCart(createdLineItem,plan,getEligibleResponse)})["catch"](function(getEligiblePlanError){$log.error("In cart creation getEligiblePlan something went wrong",getEligiblePlanError)})}})["catch"](function(ecart){$log.error("cartID creation something went wrong",ecart)}):void 0}var vm=this;return vm.planIntentScenario=essentialsServiceCart.checkPlanIntentScenario(),vm.initialization=initialization,vm}unoHandOffV3Constructor.$inject=["$log","$state","commonStorage","globalValue","unoHandOff","tokenTtl","cartConstants","dataFactory","essentialsService","essentialsServiceCart","cartStorage","cartHttpDataService","toggleService","$q","cartControllerHelperService"],angular.module("tmobileCore").service("unoHandOffV3",unoHandOffV3Constructor)}(angular,window._),function(angular,_){"use strict";function unoHandOffConstructor($log,commonStorage,essentialsService,globalValue,globalConfig,tokenTtl,jwtHelper,cartStorage,authorValueService,cartHttpDataService,cartControllerHelperService,essentialsServiceCart){function getEssentialsAuthorData(){authorValueService.loadAuthorJson("/bin/authorvalue/content/t-mobile/smartcartdialog.json").then(function(response){globalValue.authorValue.cart=response.cart},function(error){$log.log("Error getting smart cart dialog data : "+error)})}function getGlobalCart(){var cartInfo=cartStorage.getGlobalSmartCartInfo();return cartInfo&&!cartInfo.error?cartInfo:!1}function sharedCookie(_toggleData){var v3ApiEnable=_toggleData.toggles.isDcpV3ApiEnabled,id=commonStorage.getFromSharedCookie("shared_id"),v3TokenEnabler=v3ApiEnable&&(id&&id.length)>40;return{token:v3TokenEnabler?commonStorage.getFromSharedCookie("shared_id"):commonStorage.getFromSharedCookie("shared_id"),expires_in:commonStorage.getFromSharedCookie("expires_in"),cartId:commonStorage.getFromSharedCookie("cartId"),profileID:commonStorage.getFromSharedCookie("profileId"),sku:commonStorage.getFromSharedCookie("sku"),paymentType:commonStorage.getFromSharedCookie("paymentOption"),deviceType:commonStorage.getFromSharedCookie("lineType"),creditClass:v3ApiEnable?commonStorage.getFromSharedCookie("creditClass"):"",profileAccountId:v3ApiEnable?commonStorage.getFromSharedCookie("profileAccountId"):"",creditProfileId:v3ApiEnable?commonStorage.getFromSharedCookie("creditProfileId"):"",priceIndicator:v3ApiEnable?commonStorage.getFromSharedCookie("priceIndicator"):"",scc:v3ApiEnable?commonStorage.getFromSharedCookie("scc"):"",hcc:v3ApiEnable?commonStorage.getFromSharedCookie("hcc"):""}}function getSharedCookieForCheckout(){var sharedCookieValues={token:commonStorage.getFromSharedCookie("shared_id"),expires_in:commonStorage.getFromSharedCookie("expires_in"),cartId:commonStorage.getFromSharedCookie("cartId"),profileId:commonStorage.getFromSharedCookie("profileId"),creditProfileId:commonStorage.getFromSharedCookie("creditProfileId"),planType:commonStorage.getFromSharedCookie("planType")};return cookieManager(sharedCookieValues,"v3"),sharedCookieValues}function getFamilyId(resp){try{var lines=resp.lineItems;return lines[lines.length-1].lineItemDetails.deviceDetails.familyId}catch(ex){return""}}function cookieManager(sharedCookieValues,version){if(sharedCookieValues.token){var getTimeToLive=function(){if(angular.isUndefined(sharedCookieValues.timetolive)){const timeToLive=Math.round(new Date/1e3)+tokenTtl.token.timetolive;return commonStorage.assignIntoSharedCookie("timetolive",timeToLive),timeToLive}return sharedCookieValues.timetolive},isV2=angular.equals(version,"v2"),tokenValue=isV2?sharedCookieValues.token:jwtHelper.decodeToken(sharedCookieValues.token),tokenObj={access_token:sharedCookieValues.token,expires_in:sharedCookieValues.expires_in,timetolive:getTimeToLive(),usn:isV2?"":tokenValue.usn};isV2||(tokenObj.expiry=1e3*tokenValue.exp);var tokenVersion=isV2?"token":"jwt_token";localStorage.setItem(tokenVersion,angular.toJson(tokenObj));var parsedToken=angular.isString(tokenObj)?angular.fromJson(tokenObj||"{}"):tokenObj;commonStorage.assignIntoSharedCookie("timetolive",parsedToken.timetolive),commonStorage.assignIntoSharedCookie("usn",parsedToken.usn)}}function initialization(_toggleData){var sharedCookieValues=sharedCookie(_toggleData);return sharedCookieValues.cartId&&sharedCookieValues.token&&(cookieManager(sharedCookieValues,"v2"),sharedCookieValues.sku)?cartHttpDataService.getCart().then(function(response){if(response&&response.lineItems.length>=0){globalValue&&globalValue.authorValue&&!globalValue.authorValue.cart&&getEssentialsAuthorData();var requestBody={itemCode:_.get(globalConfig.cartSettings,"constants.mockSKUs.addNewLine",""),selectedCreditLevel:sharedCookieValues.creditClass||"GOOD",financeOption:"",subType:sharedCookieValues.deviceType},structCartData=getGlobalCart();return essentialsService.createEmptyLine(requestBody,{structCartData:structCartData}).then(function(){$log.log("Empty line created");var sharedStructCartData=cartStorage.getGlobalSmartCartInfo(),length=sharedStructCartData.lineItems.length-1,createdLineItem=sharedStructCartData.lineItems[length],lineId=createdLineItem.lineId;cartStorage.setCartId(sharedStructCartData.cartId),cartStorage.setOrderId(sharedStructCartData.orderId);var addToLinerequestBody={sku:sharedCookieValues.sku,pricingOption:sharedCookieValues.paymentType};return cartHttpDataService.addToLine(addToLinerequestBody,lineId).then(function(addtolineresponse){$log.log("Device added to line",addtolineresponse);var globalCartData=cartStorage.getGlobalSmartCartInfo(),length1=globalCartData.lineItems.length-1,createdLineItem1=globalCartData.lineItems[length1],newLineId=createdLineItem1.lineId;return cartStorage.setDeviceFamily(sharedCookieValues.sku,getFamilyId(addtolineresponse)),commonStorage.removeFromSharedCookie("sku"),essentialsServiceCart.createAuditRecord().then(function(auditResponse){return $log.log("audit fail",auditResponse),cartControllerHelperService.eligiblePlans(newLineId,createdLineItem).then(function(planResponse){$log.log("cart loaded all end well",planResponse)})["catch"](function(ePlan){$log.error("Fetching plan something wrong",ePlan)})})["catch"](function(auditError){$log.error("audit error something wrong",auditError)})})["catch"](function(eLine){$log.error("adding to line something wrong",eLine)})})["catch"](function(eLine){$log.error("Empty line creation something wrong",eLine)})}})["catch"](function(ecart){$log.error("cart creation something wrong",ecart)}):void 0}var vm=this;return vm.initialization=initialization,vm.sharedCookie=sharedCookie,vm.getEssentialsAuthorData=getEssentialsAuthorData,vm.getFamilyId=getFamilyId,vm.cookieManager=cookieManager,vm.getSharedCookieForCheckout=getSharedCookieForCheckout,vm}unoHandOffConstructor.$inject=["$log","commonStorage","essentialsService","globalValue","globalConfig","tokenTtl","jwtHelper","cartStorage","authorValueService","cartHttpDataService","cartControllerHelperService","essentialsServiceCart"],angular.module("tmobileCore").service("unoHandOff",unoHandOffConstructor)}(angular,window._),function(angular){"use strict";function toggleService(commonServices,httpRequest){function getToggleFeature(){var url;return url=9e3===$location.port()?"mockData/aemToggle.json":"config/aemToggle.json",httpRequest.authGet(url).then(function(result){var obj={};return _.isEmpty(result.data)||(obj=result.data,service.model.toggles=obj.toggles),obj})}var service=this,$location=commonServices.$location;service.model={toggles:""},service.getToggleFeature=getToggleFeature}toggleService.$inject=["commonServices","httpRequest"],angular.module("tmobileCore").service("toggleService",toggleService)}(angular),function(angular){"use strict";function sessionServiceConstructor($sessionStorage){return{setSessionItem:function(key,item){$sessionStorage[key]=item},getSessionItem:function(key){return $sessionStorage[key]},removeAllSession:function(){sessionStorage.clear()}}}sessionServiceConstructor.$inject=["$sessionStorage"],angular.module("tmobileCore").service("session",sessionServiceConstructor)}(angular),function(angular,lodash){"use strict";function serviceWorkerService($log,aemRoutingService,$timeout,toggleService){function registerServiceWorkerOnHome(){var serviceWorkerEnabledPaths=["/content/t-mobile/consumer/index.html","/","/store-locator"],activateSW=serviceWorkerEnabledPaths.indexOf(location.pathname)>-1;activateSW&&$timeout(function(){loadSWforHomePage="/store-locator"!==location.pathname,window.addEventListener("load",function(){aemRoutingService.loadRoutingStates().then(function(aemRoutes){aemRoutingService.saveServiceWorkerList(aemRoutes),aemRoutingService.serviceWorkerList?processServiceWorkerTask():navigator.serviceWorker&&unRegisterServiceWorker()})})},0)}function postMessageonStateChange(){"serviceWorker"in navigator&&(null===navigator.serviceWorker.controller&&aemRoutingService.serviceWorkerList?navigator.serviceWorker.register("/runtime-caching.js").then(function(registration){var serviceworker;registration.installing?serviceworker=registration.installing:registration.waiting?serviceworker=registration.waiting:registration.active&&(serviceworker=registration.active),serviceworker&&serviceworker.addEventListener("statechange",function(e){"activated"===e.target.state&&aemRoutingService.serviceWorkerList&&navigator.serviceWorker.controller.postMessage({msg:"Dynamic routes",serviceWorkerObj:aemRoutingService.serviceWorkerList})})})["catch"](function(err){$log.log("ServiceWorker registration is failed",err)}):null!==navigator.serviceWorker.controller&&void 0===aemRoutingService.serviceWorkerList?unRegisterServiceWorker():null!==navigator.serviceWorker.controller&&(postMessagetoServiceWorker("check for browse cache"),navigator.serviceWorker.addEventListener("message",function(event){unRegisterServiceWorker()}),navigator.serviceWorker.controller.postMessage({msg:"Already Activated",serviceWorkerObj:aemRoutingService.serviceWorkerList})))}function postMessagetoServiceWorker(message){"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(reg){null!==navigator.serviceWorker.controller&&navigator.serviceWorker.controller.postMessage(message)})}function unRegisterServiceWorker(){postMessagetoServiceWorker("clear browse cache"),navigator.serviceWorker.getRegistrations().then(function(registrations){_.forEach(registrations,function(registration){registration.unregister()})})}function processServiceWorkerTask(){navigator.serviceWorker&&navigator.serviceWorker.register("/runtime-caching.js").then(function(registration){var serviceworker;registration.installing?serviceworker=registration.installing:registration.waiting?serviceworker=registration.waiting:registration.active&&(serviceworker=registration.active),serviceworker&&("activated"===serviceworker.state&&aemRoutingService.serviceWorkerList.home&&(navigator.serviceWorker.addEventListener("message",function(event){
navigator.serviceWorker.controller.postMessage("clear browse cache"),registration.unregister()}),navigator.serviceWorker.controller.postMessage({msg:"Already Activated",serviceWorkerObj:aemRoutingService.serviceWorkerList}),prefetchForStateCategory(loadSWforHomePage?"home":"store-locator")),serviceworker.addEventListener("statechange",function(e){"activated"===e.target.state&&aemRoutingService.serviceWorkerList.home&&(navigator.serviceWorker.controller.postMessage({msg:"Dynamic routes",serviceWorkerObj:aemRoutingService.serviceWorkerList}),prefetchForStateCategory(loadSWforHomePage?"home":"store-locator"))}))})["catch"](function(err){$log.log("ServiceWorker registration is failed",err)})}function prefetchTask(toState,toParams){var stateCategory="";toState&&toState.name&&(stateCategory=toState.name.replace("-preview","")),toParams&&toParams.browseCategory?stateCategory+=toParams.browseCategory.replace(".html",""):toParams&&toParams.detailCategory&&(stateCategory+=toParams.detailCategory),prefetchForStateCategory(stateCategory)}function prefetchForStateCategory(stateCategory){if(aemRoutingService.serviceWorkerList&&aemRoutingService.serviceWorkerList[stateCategory]){var dcpServiceList=aemRoutingService.serviceWorkerList[stateCategory].dcpService,dcpServiceAuthorization=aemRoutingService.serviceWorkerList[stateCategory].authorizationService;if(dcpServiceAuthorization&&!lodash.get(toggleService.model,"toggles.isV2Disabled",!1)){var clientId="https://api.t-mobile.com/oauth/v1/access"===dcpServiceAuthorization?"hV6lfg3EBAiVX5EZjbpexLoLhGhuGiWR":"regf2J8znJpfzOZjSijG9YiWwBtJc0BO",data=retrieveToken(dcpServiceAuthorization,clientId);_.forEach(dcpServiceList,function(dcpServiceUrl){prefetchDcpService(dcpServiceUrl,data)})}var localJsonList=aemRoutingService.serviceWorkerList[stateCategory].localJson;_.forEach(localJsonList,function(url){fetch(url)});var thirdPartyResourceList=aemRoutingService.serviceWorkerList[stateCategory].thirdpartyResources;_.forEach(thirdPartyResourceList,function(url){fetch(url,{mode:"no-cors"})});var imagesList=aemRoutingService.serviceWorkerList[stateCategory].images;_.forEach(imagesList,function(url){fetch(url,{mode:"no-cors"})})}}function retrieveToken(dcpServiceAuthorization,clientId){var promise,payload={grant_type:"client_credentials",client_id:clientId};return promise=fetch(dcpServiceAuthorization,{headers:{"Content-Type":"application/x-www-form-urlencoded"},method:"POST",body:queryString.stringify(payload)}).then(function(res){return res.json()}).then(function(data){return data})}function prefetchDcpService(serviceurl,data){data.then(function(response){var authorization="Bearer "+response.access_token;fetch(serviceurl,{headers:{Authorization:authorization}})})}var loadSWforHomePage,service=this;return service.registerServiceWorkerOnHome=registerServiceWorkerOnHome,service.postMessageonStateChange=postMessageonStateChange,service.postMessagetoServiceWorker=postMessagetoServiceWorker,service.prefetchTask=prefetchTask,service}serviceWorkerService.$inject=["$log","aemRoutingService","$timeout","toggleService"],angular.module("tmobileCore").service("serviceWorkerService",serviceWorkerService)}(angular,_),function(angular){"use strict";angular.module("tmobileCore").service("priceLabelService",["session",function(session){return{setPricingLabel:function(pricingLabelData){session.setSessionItem("pricingLabelData",pricingLabelData)},getPricingLabel:function(){return session.getSessionItem("pricingLabelData")}}}])}(angular),function(angular,_,CQ_Analytics){function mpLocalizationService($rootScope,httpRequest,apiURLs,$q,globalConfig){function init(){1===MPkeys.UrlLang.indexOf("p_js_")&&(MPkeys.SrcUrl=window.top.document.location.href,MPkeys.UrlLang=MPkeys.SrcLang)}function getCookie(name){var start=document.cookie.indexOf(name+"=");if(0>start)return null;start=start+name.length+1;var end=document.cookie.indexOf(";",start);for(0>end&&(end=document.cookie.length);" "==document.cookie.charAt(start);)start++;return decodeURIComponent(document.cookie.substring(start,end))}function setCookie(name,value,path,domain){var cookie=name+"="+encodeURIComponent(value);path&&(cookie+="; path="+path),domain&&(cookie+="; domain="+domain);var now=new Date;now.setTime(now.getTime()+31536e6),cookie+="; expires="+now.toUTCString(),document.cookie=cookie}function switchLanguage(lang){if(lang!=MPkeys.SrcLang){var script=document.createElement("SCRIPT");script.src=location.protocol+"//"+MPkeys.Domains[lang]+"/"+MPkeys.SrcLang+lang+"/?1023749632;"+encodeURIComponent(MPkeys.SrcUrl),document.body.appendChild(script)}else if(lang==MPkeys.SrcLang&&MPkeys.UrlLang!=MPkeys.SrcLang){var script=document.createElement("SCRIPT");script.src=location.protocol+"//"+MPkeys.Domains[MPkeys.UrlLang]+"/"+MPkeys.SrcLang+MPkeys.UrlLang+"/?1023749634;"+encodeURIComponent(location.href),document.body.appendChild(script)}return!1}function switchToLang(url){window.top.location.href=url}function loadLocalizationScript(){var sourceMpelFile="https://es.t-mobile.com/mpel/mpel.js";if(sourceMpelFile){var script=document.querySelector("script[src*='"+sourceMpelFile+"']");if(!script){var heads=document.getElementsByTagName("head");if(heads&&heads.length){var head=heads[0];head&&(script=document.createElement("script"),script.setAttribute("src",sourceMpelFile),script.setAttribute("type","text/javascript"),script.setAttribute("id","mpelid"),head.appendChild(script))}}}}function getUserPreferredLanguage(){var userPreferredLanguage;return userPreferredLanguage=apiURLs.enableLocalization?null===getCookie("MP_LANG")||"en"===getCookie("MP_LANG")?"English":"Spanish":""}var MP_service=this,MPkeys={Version:"1.0.23",Domains:{es:"es.t-mobile.com"},SrcLang:"en",UrlLang:"mp_js_current_lang",SrcUrl:decodeURIComponent("mp_js_orgin_url")};return MP_service.init=init,MP_service.getCookie=getCookie,MP_service.setCookie=setCookie,MP_service.switchLanguage=switchLanguage,MP_service.switchToLang=switchToLang,MP_service.MPkeys=MPkeys,MP_service.loadLocalizationScript=loadLocalizationScript,MP_service.localizationFlag=apiURLs.enableLocalization,MP_service.getUserPreferredLanguage=getUserPreferredLanguage,MP_service}mpLocalizationService.$inject=["$rootScope","httpRequest","apiURLs","$q","globalConfig"],angular.module("tmobileApp").service("mpLocalizationService",mpLocalizationService),angular.module("marketingApp").service("mpLocalizationService",mpLocalizationService)}(window.angular,window._,window.CQ_Analytics),function(angular,lodash){"use strict";function loggingService($injector){function getLocationService(){return angular.isUndefined($location)&&($location=$injector.get("$location")),$location}function initializeCircularDependencies(){$timeout=angular.isUndefined($timeout)?$injector.get("$timeout"):$timeout,$http=angular.isUndefined($http)?$injector.get("$http"):$http}function processPendingLogQueue(){initializeCircularDependencies(),$http(pendingLogs[0]).then(function(){pendingLogs.shift(),pendingLogs.length>0&&processPendingLogQueue()})["catch"](function(exception){$log.warn("Error server-side logging failed",exception),1===pendingLogs.length&&$timeout(processPendingLogQueue,6e4)})}function consoleLogger(methodName,args){"exception"!==methodName&&_.includes($window.loggingMethods,methodName)&&$log[methodName].apply($log,args)}function postLogToServer(methodName,logData){var localtoggleService=$injector.get("toggleService");if(!lodash.get(localtoggleService.model,"toggles.disableLogging",!0)&&("exception"===methodName||_.includes($window.loggingMethods,methodName))){consoleLogger(methodName,[].slice.call(arguments));var customData=createJsonBody(logData),commonStorage=$injector.get("commonStorage"),authorization="Bearer "+commonStorage.getToken(),headers={Authorization:authorization},httpConfig={timeStamp:Date.now().toString(),method:"POST",url:apiURLs.logging,data:customData,headers:headers,ignoreLoadingBar:!0};pendingLogs.length<MAX_PENDING_LOGS&&pendingLogs.push(httpConfig),processPendingLogQueue()}}function exceptionHandler(exception,cause){if(!angular.isUndefined(exception)){getLocationService();var logType="exception",data={type:logType,url:getLocationService().absUrl(),message:exception.message,stackTrace:exception.stack,cause:cause||""};postLogToServer(logType,data)}}function debug(message,debugData){var logType="debug",data={type:logType,url:getLocationService().absUrl(),message:message,data:debugData};postLogToServer(logType,data)}function error(errorMessage){var logType="error",data={type:logType,url:getLocationService().absUrl(),message:errorMessage};postLogToServer(logType,data)}var $location,$http,$timeout,service=this,MAX_PENDING_LOGS=1,pendingLogs=[],apiURLs=$injector.get("apiURLs"),$log=$injector.get("$log"),$window=$injector.get("$window");service.error=error,service.debug=debug,service.exceptionHandler=exceptionHandler}function createJsonBody(logData){var uuid=sessionStorage.getItem("clientuuid"),requestBody={timeStamp:new Date,organization:"tmobileh",system:"TMNG",component:"TMNG_API_FACADE",environment:logData.environment,event_type:logData.eventType,service_trans_id:uuid,interaction_id:uuid,log_type:logData.type,targets:[{name:logData.methodName,flow_name:logData.methodName,url:logData.url,request:{headers:logData.requestHeaders,query_parms:logData.queryParams,content:logData.content,content_type:logData.contentType,end_time:logData.endTime,start_time:logData.startTime},response:{headers:logData.responseHeaders,content:logData.content,content_type:logData.contentType,end_time:logData.endTime,start_time:logData.startTime}}]};return requestBody["debug"===logData.type?"debug":"errors"]=[{code:logData.code,message:logData.message,details:"debug"===logData.type?logData.data:logData.stackTrace,cause:logData.cause||""}],requestBody}loggingService.$inject=["$injector"],angular.module("tmobileCore").service("loggingService",loggingService)}(angular,_),function(angular,externalLogger){"use strict";function config($httpProvider){externalLogger.moduleConfigured("tmobileCore","http-uuid.config :: config");var uuid=sessionStorage.getItem("clientuuid");uuid||(uuid=UUIDjs.create(4).toString(),sessionStorage.setItem("clientuuid",uuid));var param={clientuuid:uuid};document.cookie="clientuuid="+uuid,$httpProvider.interceptors.push(["$log","globalConfig","commonUtils",function($log,globalConfig,commonUtils){return{request:function(config){try{var parser=commonUtils.urlParser(config.url);if(globalConfig.ignore&&globalConfig.ignore.uuidHosts&&_.includes(globalConfig.ignore.uuidHosts,parser.hostname))return config}catch(error){$log.log("error when ignoring the UUID for hosts",error)}return config.url.indexOf("apigee.net")<0&&(angular.isDefined(config.headers)||(config.headers={}),angular.extend(config.headers,param)),config}}}])}config.$inject=["$httpProvider"],angular.module("tmobileCore").config(config)}(angular,externalLogger),function(angular){"use strict";function httpDataCacheServiceConstructor(CacheFactory,globalConfig,jsonPath,$log){function getCacheName(expiry,version){var cacheName="http.data.cache."+expiry;return angular.isDefined(version)&&null!==version&&(cacheName=cacheName+"."+version),CacheFactory.get(cacheName)||CacheFactory.createCache(cacheName,{storagePrefix:"tmng.",deleteOnExpire:"aggressive",maxAge:expiry,storageMode:"localStorage"}),CacheFactory.get(cacheName)}function getUrlCache(url){if(!globalConfig||!globalConfig.httpCacheConfig)return!1;if(!globalConfig.httpCacheConfig.enableCache)return!1;var urlCache,_gc=globalConfig;if(urlCache=jsonPath(_gc,'$..cacheUrls[?(@.url=="'+url+'")]'),urlCache&&$log.log("urlCache",urlCache),urlCache&&urlCache.length>0){var _cacheName=urlCache[0].expireInMs,_version=urlCache[0].version;return angular.isUndefined(urlCache[0].expireInMs)&&(_cacheName=_gc.httpCacheConfig.expireInMilliSeconds,_version="1.0"),getCacheName(_cacheName,_version)}return!1}return{getUrlCache:getUrlCache}}httpDataCacheServiceConstructor.$inject=["CacheFactory","globalConfig","jsonPath","$log"],angular.module("tmobileCore").service("httpDataCache",httpDataCacheServiceConstructor)}(angular),function(angular){"use strict";function cacheInterceptor(httpDataCache){function request(config){var cache=httpDataCache.getUrlCache(config.url);return cache&&(config.cache=cache),config}return{request:request}}function httpCacheConfig($httpProvider){externalLogger.moduleConfigured("tmobileCore","httpCache.config.js :: httpCacheConfig"),$httpProvider.interceptors.push("cacheInterceptor")}cacheInterceptor.$inject=["httpDataCache"],httpCacheConfig.$inject=["$httpProvider"],angular.module("tmobileCore").factory("cacheInterceptor",cacheInterceptor).config(httpCacheConfig)}(angular,externalLogger),function(angular){"use strict";function circuitBreakerInterceptor($injector){function checkAPIResponse(response){return response.config.url.indexOf("search-promote")>-1?_.isEmpty(_.get(response.data,"values")):response.config.url.indexOf("productDetails")>-1?_.isEmpty(_.get(response.data,"productdetails")):response.config.url.indexOf("products")>-1?_.isEmpty(_.get(response.data,"products")):!1}function isCircuitBreakerResponse(response){return!_.isEmpty(response.config["cb-response"])&&(200!==response.status||_.isEmpty(response.data)||checkAPIResponse(response))}function requestConfig(config){return _.isEmpty(config.headers["cb-response"])||(config["cb-response"]=config.headers["cb-response"],delete config.headers["cb-response"]),config}function responseConfig(epResponse){var $http=$injector.get("$http");if(isCircuitBreakerResponse(epResponse)){var url=epResponse.config["cb-response"];return $http.get(url).then(function(response){return response.config["cb-response"]=!0,response})["catch"](function(error,response){})}return epResponse}return{request:requestConfig,response:responseConfig}}function circuitBreakerConfig($httpProvider){externalLogger.moduleConfigured("tmobileCore","circuitBreaker.config.js :: circuitBreakerConfig"),$httpProvider.interceptors.push("circuitBreakerInterceptor")}circuitBreakerInterceptor.$inject=["$injector"],circuitBreakerConfig.$inject=["$httpProvider"],angular.module("tmobileCore").factory("circuitBreakerInterceptor",circuitBreakerInterceptor).config(circuitBreakerConfig)}(angular,externalLogger),function(angular){"use strict";function httpRequest($log,$http,$q){function get(url,params){var config={authRequired:!0,method:"GET",url:_.isEmpty(params)?url:url+"?"+queryString.stringify(params)};return $http(config)}function jsonp(url,params){var promise,req={};if(params){var qs=queryString.stringify(params);req.url=url+"?"+qs}else req.url=url;return req.method="JSONP",promise=$http(req).then(function(response){return response})}function post(url,data){var promise,req={};return data&&(req.data=data),req.url=url,req.method="POST",promise=$http(req).then(function(response){return response})}function authPost(url,headers,data){var promise,req={};return req.url=url,req.method="POST",req.headers=headers,req.data=data,promise=$http(req).then(function(response){return response})}function authGet(url,headers,data){var promise,req={};return req.url=url,req.method="GET",req.headers=headers,req.data=data,promise=$http(req).then(function(response){return response})}function tokenPost(url){var promise,req={};return req.url=url,req.method="POST",req.data={grant_type:"password",role:"PUBLIC",scope:"raptor"},req.transformRequest=function(obj){var str=[];return angular.forEach(obj,function(p){str.push(encodeURIComponent(p)+"="+encodeURIComponent(obj[p]))}),str.join("&")},promise=$http(req).then(function(response){return $log.log("response.data",response.data),response})}function getJSON(url){var deffered=$q.defer(),promise=deffered.promise,xhr=new XMLHttpRequest;return xhr.open("get",url,!0),xhr.responseType="json",xhr.onload=function(){var status=xhr.status;200==status?deffered.resolve(xhr.response):deffered.reject(status)},xhr.send(),promise}var service=this;service.get=get,service.jsonp=jsonp,service.post=post,service.authPost=authPost,service.authGet=authGet,service.tokenPost=tokenPost,service.getJSON=getJSON}httpRequest.$inject=["$log","$http","$q"],angular.module("tmobileCore").service("httpRequest",httpRequest)}(angular),function(angular,lodash){"use strict";function geoLocationService($window,$q,$log,mpLocalizationService,toggleService,geoLocationConstants){function isAbobeAllowed(){var lang=null===mpLocalizationService.getCookie(geoLocationConstants.cookiesLanguage)?geoLocationConstants.englishLanguage:mpLocalizationService.getCookie(geoLocationConstants.cookiesLanguage);return angular.equals(lang,geoLocationConstants.englishLanguage)||angular.equals(lang,geoLocationConstants.spanishLanguage)}function getLocation(){var locationData={},defer=$q.defer();return $window.navigator.permissions?$window.navigator.permissions.query({name:geoLocationConstants.geoLocation}).then(function(permissionStatus){permissionStatus.state===geoLocationConstants.permissionGranted?svc.getCoordinates().then(function(position){locationData.coords={latitude:position.coords.latitude,longitude:position.coords.longitude},locationData.isUserLocationEnabled=!0,defer.resolve(locationData)}):defer.resolve(getAdobeLocation())})["catch"](function(){defer.resolve(getAdobeLocation())}):defer.resolve(getAdobeLocation()),defer.promise}function getAdobeLocation(){var locationData={};if(svc.isAdobeAllowed()){var sessionIPC=angular.fromJson(sessionStorage.getItem("IPC"));sessionIPC&&(locationData.coords={latitude:sessionIPC.latitude,longitude:sessionIPC.longitude})}return locationData.isUserLocationEnabled=!1,locationData}function getCoordinates(){var deferred=$q.defer();return $window.navigator.geolocation.getCurrentPosition(function(position){deferred.resolve(position)},function(error){deferred.reject(error),$log.log("Error Code: "+error.code+" Error Message: "+error.message)},{}),deferred.promise}function getZipCode(){var deferred=$q.defer();return svc.getCoordinates().then(function(pos){$log.log("pos",pos);var geocoder=new $window.google.maps.Geocoder,locationData={location:{lat:pos.coords.latitude,lng:pos.coords.longitude}};geocoder.geocode(locationData,function(results,status){if($log.log("results",results),status===$window.google.maps.GeocoderStatus.OK){var zipCode=_.find(results[0].address_components,{types:["postal_code"]}).long_name;deferred.resolve(zipCode)}else deferred.reject({results:results,status:status})})}),deferred.promise}function validateZipCode(zipCode){var deferred=$q.defer(),geocoder=new $window.google.maps.Geocoder;return geocoder.geocode({address:zipCode},function(results,status){var responseZipCode={};status===$window.google.maps.GeocoderStatus.OK&&(responseZipCode=_.find(results[0].address_components,{types:["postal_code"]})),deferred.resolve(lodash.includes([lodash.get(responseZipCode,"long_name","NO-ZIP"),lodash.get(responseZipCode,"short_name","NO-ZIP")],zipCode))}),deferred.promise}function getUserCurrentLocationState(zipCode){var deferred=$q.defer(),geocoder=new $window.google.maps.Geocoder;return geocoder.geocode({address:zipCode},function(results,status){if(status===$window.google.maps.GeocoderStatus.OK){var responseState=_.find(results[0].address_components,{types:["administrative_area_level_1"]});responseState?(responseState=responseState.short_name,deferred.resolve(responseState)):deferred.reject({results:results,status:status})}else deferred.reject({results:results,status:status})}),deferred.promise}function userLocationStateAndZipStatus(zipCode){var deferred=$q.defer(),geocoder=new $window.google.maps.Geocoder;return geocoder.geocode({address:zipCode},function(results,status){var responseZipCode={},responseState={},zipState=!1;status===$window.google.maps.GeocoderStatus.OK&&(responseZipCode=_.find(results[0].address_components,{types:["postal_code"]}),responseState=_.find(results[0].address_components,{types:["administrative_area_level_1"]})),responseState&&(responseState=responseState.short_name),zipState=lodash.includes([lodash.get(responseZipCode,"long_name","NO-ZIP"),lodash.get(responseZipCode,"short_name","NO-ZIP")],zipCode),deferred.resolve({zipStatus:zipState,state:responseState})}),deferred.promise}function getState(){var deferred=$q.defer();return svc.getCoordinates().then(function(pos){$log.log("pos",pos);var geocoder=new $window.google.maps.Geocoder,latlng={lat:pos.coords.latitude,lng:pos.coords.longitude};geocoder.geocode({location:latlng},function(results,status){$log.log("results",results),status===$window.google.maps.GeocoderStatus.OK?(state=_.find(results[0].address_components,{types:["administrative_area_level_1"]}).short_name,deferred.resolve(state)):deferred.reject({results:results,status:status})})},function(error){deferred.reject(error)}),deferred.promise}function getLatLng(location){var deferred=$q.defer(),response=[],geocoder=new $window.google.maps.Geocoder;return geocoder.geocode({address:location},function(results,status){status===$window.google.maps.GeocoderStatus.OK?(response[0]=results[0].geometry.location.lat(),response[1]=results[0].geometry.location.lng(),response[2]=lodash.isEmpty(results[0].geometry.bounds)?null:results[0].geometry.bounds,deferred.resolve(response)):deferred.reject({results:results,status:status})}),deferred.promise}function getCoordinatesViaState(state){var deferred=$q.defer(),response=[],geocoder=new $window.google.maps.Geocoder;return geocoder.geocode({address:state,componentRestrictions:{country:"US",administrativeArea:"administrative_area_level_1"}},function(results,status){status===$window.google.maps.GeocoderStatus.OK?(response[0]=results[0].geometry.location.lat(),response[1]=results[0].geometry.location.lng(),response[2]=lodash.isEmpty(results[0].geometry.bounds)?null:results[0].geometry.bounds,deferred.resolve(response)):deferred.reject({results:results,status:status})}),deferred.promise}var state,svc=this;svc.getCoordinates=getCoordinates,svc.getZipCode=getZipCode,svc.validateZipCode=validateZipCode,svc.getUserCurrentLocationState=getUserCurrentLocationState,svc.getState=getState,svc.getLatLng=getLatLng,svc.getCoordinatesViaState=getCoordinatesViaState,svc.getLocation=getLocation,svc.getAdobeLocation=getAdobeLocation,svc.isAdobeAllowed=isAbobeAllowed,svc.userLocationStateAndZipStatus=userLocationStateAndZipStatus}geoLocationService.$inject=["$window","$q","$log","mpLocalizationService","toggleService","geoLocationConstants"],angular.module("tmobileCore").service("geoLocation",geoLocationService),angular.module("marketingCore").service("geoLocation",geoLocationService)}(window.angular,window._),function(angular,lodash){"use strict";function digitalToRetailService(globalValue){function setAvailabiltyStatus(){lodash.isEmpty(service.digitalToRetailAuthoring)||(service.availabilityMessage={103:service.digitalToRetailAuthoring.inStock,102:service.digitalToRetailAuthoring.fewLeft,101:service.digitalToRetailAuthoring.outOfStock})}var service=this;return service.digitalToRetailAuthoring=globalValue.authorValue.storeauthoring.digitalToRetail,setAvailabiltyStatus(),service.setAvailabiltyStatus=setAvailabiltyStatus,service}digitalToRetailService.$inject=["globalValue"],angular.module("tmobileApp").service("digitalToRetailService",digitalToRetailService)}(window.angular,window._),function(angular){"use strict";function defaultProductService($location){function getDefaultProductFromURL(params,promoUrl){var defaultSelectedProduct;return params.Memory&&params.Color?(defaultSelectedProduct=findProductByMemoryAndColor(promoUrl.color,promoUrl.memory),(angular.isUndefined(defaultSelectedProduct)||_.isEmpty(defaultSelectedProduct))&&(defaultSelectedProduct=findProductByColor(promoUrl.color)),(angular.isUndefined(defaultSelectedProduct)||_.isEmpty(defaultSelectedProduct))&&(defaultSelectedProduct=findProductByMemory(promoUrl.memory))):params.Memory&&!params.Color?defaultSelectedProduct=findProductByMemory(promoUrl.memory):!params.Memory&&params.Color&&(defaultSelectedProduct=findProductByColor(promoUrl.color)),defaultSelectedProduct=angular.isDefined(defaultSelectedProduct)?defaultSelectedProduct:findProductbyOverrideSku(),angular.isDefined(defaultSelectedProduct)?defaultSelectedProduct:sortedProducts[0]}function findProductByColor(color){return _.find(sortedProducts,function(product){return _.isMatch(trimString(color),trimString(product.Color))})}function findProductByMemory(memory){return _.find(sortedProducts,function(product){return _.isMatch(trimString(memory),trimString(product.Memory))})}function findProductByMemoryAndColor(color,memory){return _.find(sortedProducts,function(product){return _.isMatch(trimString(color),trimString(product.Color))&&_.isMatch(trimString(memory),trimString(product.Memory))})}function findProductbyOverrideSku(){return _.find(sortedProducts,function(product){return _.isMatch(aemOverride,product.SKU)})}function sortByLowestPrice(productFamily){return _.sortBy(productFamily,function(productValue){return parseInt(productValue.pricing[0].components[0].purchasePrice.amount,10)})}function trimString(str){return str.replace(/%40|~2F|%2B|%23|%24|%25|%5E|%26|%7B|%7D|%5B|%5D|%26|%C2%AE|%E2%84%A2|%3A|%24|%2C|%22|~2F|'/gi,"").replace(/\(|\)/g,"").replace(/-+/g,"-").replace(/-/g,"").replace(/ /g,"").toLowerCase()}function filterSpecialCharacter(params){var queryParams=params,updatedQueryParams=queryParams.replace(/[^a-zA-Z0-9()_-]/g,"-").replace(/-{2,}/g,"-").replace(/\(|\)/g,"").toLowerCase();return updatedQueryParams}function updateQueryStringParameters(queryString){angular.isDefined(queryString.color)&&$location.search("color",filterSpecialCharacter(queryString.color)),angular.isDefined(queryString.memory)&&$location.search("memory",filterSpecialCharacter(queryString.memory))}function getDefaultDisplaySKU(productFamily,promoUrl,aemOverrideSKU){aemOverride=aemOverrideSKU,sortedProducts=sortByLowestPrice(productFamily);var defaultProduct;return angular.isDefined(promoUrl)&&!_.isEmpty(promoUrl)?defaultProduct=getDefaultProductFromURL({Memory:!_.isEmpty(promoUrl.memory),Color:!_.isEmpty(promoUrl.color)},promoUrl):!_.isEmpty(aemOverrideSKU)&&angular.isDefined(aemOverrideSKU)?_.each(productFamily,function(product){aemOverrideSKU===product.SKU&&(defaultProduct=product)}):defaultProduct=sortedProducts[0],defaultProduct||(defaultProduct=sortedProducts[0]),defaultProduct}function updateMemoryValue(obj){var unit="GB";return _.isEmpty(obj.MemoryUOM)?_.isEmpty(obj.memoryUOM)||(unit=obj.memoryUOM,_.isEmpty(obj.memory)||(obj.memory=obj.memory.replace(/[^0-9]/g,"")+" "+unit)):(unit=obj.MemoryUOM,_.isEmpty(obj.Memory)||(obj.Memory=obj.Memory.replace(/[^0-9]/g,"")+" "+unit)),_.isEmpty(obj.Specifications)||_.map(obj.Specifications,function(item){"Memory"===item.label&&""!==item.value&&_.map(item.value,function(value,key){_.isEmpty(value)||(item.value[key]=value+" "+unit)})}),obj}var sortedProducts,aemOverride,service=this;return service.getDefaultDisplaySKU=getDefaultDisplaySKU,service.updateQueryStringParameters=updateQueryStringParameters,service.updateMemoryValue=updateMemoryValue,service}defaultProductService.$inject=["$location"],angular.module("tmobileCore").service("defaultProductService",defaultProductService)}(angular,window._),function(angular){"use strict";function creditClassService($sessionStorage,$localStorage,loggingService,session,cartStorage){function _loadCreditClassData(){var sharedData=$localStorage.tmobglobalshareddata;sharedData&&(_creditClassJson=sharedData.creditClassJson)}function _assignIntoSharedLS(key,value){var sharedData=$localStorage.tmobglobalshareddata||{};sharedData[key]=value,$localStorage.tmobglobalshareddata=sharedData}function getFromSharedLS(key){var sharedData=$localStorage.tmobglobalshareddata;return sharedData?sharedData[key]:void 0}function setCreditClass(selectedCreditClass){_assignIntoSharedLS(SELECTED_CREDIT_CLASS,selectedCreditClass)}function getCreditClass(){return self.getFromSharedLS(SELECTED_CREDIT_CLASS)||cartStorage.getCreditClass()}function setCreditClassName(selectedCreditClass){_assignIntoSharedLS(SELECTED_CREDIT_CLASS_NAME,selectedCreditClass)}function getCreditClassName(){return self.getFromSharedLS(SELECTED_CREDIT_CLASS_NAME)}function getEPCreditClass(){var creditClassObj=getCreditClass();return creditClassObj?appToEPMapping[creditClassObj["class"]]:void 0}function setEPCreditClass(creditClassName){_creditClassJson||_loadCreditClassData();var creditClassJson=_.find(_creditClassJson,{"class":epToAppMapping[creditClassName]});self.setCreditClass(creditClassJson),loggingService.debug("creditClassService : Base Class JSON Data ",self.creditClassJson)}function setCreditClassJson(creditClassJson){_assignIntoSharedLS(CREDIT_CLASS_JSON,creditClassJson),_creditClassJson=creditClassJson}function getEPCreditClassValue(creditClassName){return creditClassName?appToEPMapping[creditClassName]:void 0}function setDefaultCreditClass(defaultCreditClass){session.setSessionItem(DEFAULT_CREDIT_CLASS_NAME,defaultCreditClass)}function getDefaultCreditClass(){return session.getSessionItem("defaultCreditClassName")}var self=this,SELECTED_CREDIT_CLASS="selectedCreditClass",SELECTED_CREDIT_CLASS_NAME="selectedCreditClassName",CREDIT_CLASS_JSON="creditClassJson",DEFAULT_CREDIT_CLASS_NAME="defaultCreditClassName",_creditClassJson=void 0,epToAppMapping={GOOD:"creditClass1",BUILDING:"creditClass2",NONE:"creditClass3"},appToEPMapping={creditClass1:"GOOD",creditClass2:"BUILDING",creditClass3:"NONE"};self.setCreditClass=setCreditClass,self.getCreditClass=getCreditClass,self.setCreditClassName=setCreditClassName,self.getCreditClassName=getCreditClassName,self.setEPCreditClass=setEPCreditClass,self.getEPCreditClass=getEPCreditClass,self.setDefaultCreditClass=setDefaultCreditClass,self.getDefaultCreditClass=getDefaultCreditClass,self.getFromSharedLS=getFromSharedLS,self.setCreditClassJson=setCreditClassJson,self.getEPCreditClassValue=getEPCreditClassValue,_loadCreditClassData()}creditClassService.$inject=["$sessionStorage","$localStorage","loggingService","session","cartStorage"],angular.module("tmobileCore").service("creditClassService",creditClassService)}(window.angular),function(angular){"use strict";function commonServicesConstructor($compile,$cookies,$document,$filter,$http,$interval,$location,$log,$q,$rootScope,$state,$stateParams,$timeout,$urlRouter,$window,$localStorage,$sessionStorage,session){function openHomePage(param){var homepageUrl="http://www.t-mobile.com";if("home"===param)$window.location.href=homepageUrl;else{var name="popup",features="width=500,height=500";$window.open(homepageUrl,name,features)}}return{$compile:$compile,$cookies:$cookies,$document:$document,$filter:$filter,$http:$http,$interval:$interval,$location:$location,$log:$log,$q:$q,$rootScope:$rootScope,$state:$state,$stateParams:$stateParams,$timeout:$timeout,$urlRouter:$urlRouter,$window:$window,$localStorage:$localStorage,$sessionStorage:$sessionStorage,session:session,openHomePage:openHomePage}}commonServicesConstructor.$inject=["$compile","$cookies","$document","$filter","$http","$interval","$location","$log","$q","$rootScope","$state","$stateParams","$timeout","$urlRouter","$window","$localStorage","$sessionStorage","session"],angular.module("tmobileCore").factory("commonServices",commonServicesConstructor)}(window.angular),function(angular,uuid,lodash){"use strict";function authorizationServiceConstructor($http,$q,$log,apiURLs,apiService,globalConfig,authTokenManager,$window){function generateToken(){var defer=$q.defer();if(lodash.get(apiURLs,"isV2AccessTokenDisabled",!1)){var response={};defer.resolve(response)}else{var req=this.accessTokenRequest();this.generateInteractionId(),req.method="POST",req.ignoreForAuth=!0,$http(req).then(function(response){lodash.get(response,"data",!1)&&!lodash.isEmpty(response.data)&&lodash.get(apiURLs,"isV2AccessTokenEnabled",!1)&&(response.data={access_token:response.data.accessToken||"",expires_in:response.data.expiresIn||0}),defer.resolve(response)},function(error){$log.error("abort promise get access token")})}return defer.promise}function accessTokenRequest(){
var req={};return lodash.get(apiURLs,"isV2AccessTokenEnabled",!1)?(req.headers={applicationId:"TMO","api-version":"v2",channelId:"WEB","Content-Type":"application/json"},req.data=globalConfig.credentials.global_v2,req.url=apiService.getURL("authorizationV2API").url):(req.headers={"Content-Type":"application/x-www-form-urlencoded"},req.data=queryString.stringify(globalConfig.credentials.global),req.url=apiService.getURL("authorization").url),req}function generateInteractionId(){var interactionId=uuid.create().toString();authTokenManager.setTokenCookies(interactionId,"interactionId",angular.equals(apiURLs.storage,"localStorage"))}function generateJWT(jwk){var req={};return req.headers={"Content-Type":"application/json"},req.data={jwk:jwk},req.method="POST",req.url=apiService.getURL("authorizationHAPI").url,$http(req)}function generatePOP(authToken,jwk,request){var defer=$q.defer(),header={alg:"RS256",typ:"JWT"};const partialToken=Base64URL.stringify(utf8ToUint8Array(JSON.stringify(header),$window.btoa))+"."+Base64URL.stringify(utf8ToUint8Array(JSON.stringify({at:authToken.jwt_token,exp:Date.now()+3e4,m:request.method,u:request.url}),$window.btoa));return crypto.subtle.sign("RSASSA-PKCS1-v1_5",jwk,utf8ToUint8Array(partialToken,$window.btoa)).then(function(signature){var yourFinalSignedPoPToken=partialToken+"."+Base64URL.stringify(new Uint8Array(signature));defer.resolve(yourFinalSignedPoPToken)},function(error){defer.reject(error)}),defer.promise}function utf8ToUint8Array(str,btoa){var str1=btoa(unescape(encodeURIComponent(str)));return Base64URL.parse(str1)}var Base64URL={stringify:function(a){const base64string=btoa(String.fromCharCode.apply(0,a));return base64string.replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")},parse:function(s){var s1=s.replace(/-/g,"+").replace(/_/g,"/").replace(/\s/g,"");return new Uint8Array(Array.prototype.map.call(atob(s1),function(c){return c.charCodeAt(0)}))}};return this.generateToken=generateToken,this.generateInteractionId=generateInteractionId,this.accessTokenRequest=accessTokenRequest,this.generateJWT=generateJWT,this.generatePOP=generatePOP,this}authorizationServiceConstructor.$inject=["$http","$q","$log","apiURLs","apiService","globalConfig","authTokenManager","$window"],angular.module("tmobileCore").service("authorization",authorizationServiceConstructor)}(angular,window.UUIDjs,window._),function(angular,lodash){"use strict";function authTokenManager($rootScope,$cookies,$window,session,loggingService,apiURLs,globalConfig,$location,commonStorage,tokenTtl){function clear(){localStorage.clear(),commonStorage.assignIntoSharedCookie("shared_id",null),commonStorage.assignIntoSharedCookie("expires_in",null),commonStorage.assignIntoSharedCookie("timetolive",null),commonStorage.assignIntoSharedCookie("cartId",null),commonStorage.assignIntoSharedCookie("sku",null),commonStorage.assignIntoSharedCookie("usn",null),commonStorage.assignIntoSharedCookie("profileID",null),commonStorage.assignIntoSharedCookie("paymentOption",null),commonStorage.assignIntoSharedCookie("lineType",null),commonStorage.assignIntoSharedCookie("creditProfileId",null),commonStorage.assignIntoSharedCookie("accountId",null),commonStorage.assignIntoSharedCookie("orderId",null),commonStorage.assignIntoSharedCookie("scc",null),commonStorage.assignIntoSharedCookie("hcc",null),$window.location.reload()}function setSessionToken(token){session.setSessionItem(sessionTokenKey,token)}function getSessionToken(){return session.getSessionItem(sessionTokenKey)}function setTokenCookies(token,tokenKey,localStorageOn,expiredInSeconds){$location.host()&&$location.host().search(globalConfig.cookieOption.domain)<0&&(globalConfig.cookieOption.domain=$location.host());var options=globalConfig.cookieOption;options.expires=$rootScope.cookiesExpiresIn,localStorageOn?(isNaN(expiredInSeconds)||!lodash.isObject(token)||lodash.isArray(token)||(token.timetolive=Math.round(new Date/1e3)+1*expiredInSeconds),localStorage.setItem(tokenKey||sessionTokenKey,angular.toJson(token))):$cookies.put(tokenKey||sessionTokenKey,angular.toJson(token),options)}function clearSession(){if("localStorage"===apiURLs.storage)localStorage.clear();else{var cookies=$cookies.getAll();angular.forEach(cookies,function(v,k){$cookies.remove(k)})}}function getTokenCookies(tokenKey,localStorageOn){var token=localStorageOn?localStorage.getItem(tokenKey||sessionTokenKey):$cookies.get(tokenKey||sessionTokenKey);if(token)try{token=angular.fromJson(token);var expiry=angular.fromJson(localStorage.getItem("jwt_token")||"{}").expiry;expiry&&expiry-(new Date).getTime()<1?(localStorage.removeItem("token"),localStorage.removeItem("jwt_token"),clear(),token=null):expiry||(localStorageOn&&angular.isDefined(token.timetolive)&&token.timetolive-Math.round(new Date/1e3)<1?(localStorage.removeItem(tokenKey),token=null,clear()):"token"===tokenKey&&angular.isUndefined(token.timetolive)&&(localStorage.removeItem(tokenKey),token=null,clear()))}catch(e){loggingService.error("We have an error parsing session token key. Here is the error body : ",angular.toJson(e))}return token}var sessionTokenKey="token";return{setSessionToken:setSessionToken,getSessionToken:getSessionToken,setTokenCookies:setTokenCookies,getTokenCookies:getTokenCookies,clearSession:clearSession}}authTokenManager.$inject=["$rootScope","$cookies","$window","session","loggingService","apiURLs","globalConfig","$location","commonStorage","tokenTtl"],angular.module("tmobileCore").service("authTokenManager",authTokenManager)}(angular,window._),function(angular,externalLogger){"use strict";function aemRoutingService($log,$q,$http,$window,AEM_ROUTES_API_URL,AEM_NON_ROUTES_API_URL,AEM_RUNTIME_SERVER){function formatTime(timeStamp){return Math.floor(timeStamp/1e3)+"."+timeStamp%1e3}function saveDefaultSkuList(routeList){var list=[];angular.forEach(routeList,function(route){_.isEmpty(route.data)||_.isEmpty(route.data.defaultsku)||list.push(route.data.defaultsku)}),service.defaultSkus=list}function saveServiceWorkerList(routeList){angular.forEach(routeList,function(route){_.isEmpty(route.serviceworker)||(service.serviceWorkerList=route.serviceworker)})}function getAemRouteJsonData(AEM_ROUTES){if("/store-locator"===$window.location.pathname){var aemRoutesUrl=AEM_ROUTES+"?ignoreLoadingBar=true";getAemRouteJson(aemRoutesUrl)}else getAemRouteJson(AEM_ROUTES)}function getAemRouteJson(AEM_ROUTES){var startLoading=Date.now();$http.get(AEM_ROUTES).then(function(response){if(!angular.isArray(response.data)){deferLoadingRoutes.reject(response);var msg="AEM Routes not found at "+AEM_ROUTES+"!";throw new Error(msg)}var finishedLoading=Date.now();service.aemRoutesData=response.data,externalLogger.info("%caemRoutes.json loaded in %s seconds",externalLogger.css.boldBlackOnOrange,formatTime(finishedLoading-startLoading)),service.saveServiceWorkerList(response.data),deferLoadingRoutes.resolve(response.data)},function(response){$log.error("AEM Routes could not be loaded from "+AEM_ROUTES,response),deferLoadingRoutes.reject(response)})}function loadRoutingStates(){if(angular.isUndefined(deferLoadingRoutes)){var AEM_ROUTES=AEM_RUNTIME_SERVER.isWebserver?AEM_NON_ROUTES_API_URL:AEM_ROUTES_API_URL;deferLoadingRoutes=$q.defer(),$log.log("aemRoutingService is Loading route states using data from "+AEM_ROUTES),angular.isDefined(window.__karma__)?deferLoadingRoutes.resolve([]):getAemRouteJsonData(AEM_ROUTES)}return deferLoadingRoutes.promise}var deferLoadingRoutes,service=this;return service.loadRoutingStates=loadRoutingStates,service.saveDefaultSkuList=saveDefaultSkuList,service.saveServiceWorkerList=saveServiceWorkerList,service}aemRoutingService.$inject=["$log","$q","$http","$window","AEM_ROUTES_API_URL","AEM_NON_ROUTES_API_URL","AEM_RUNTIME_SERVER"],angular.module("tmobileCore").constant("AEM_ROUTES_API_URL","/config/aemRoutes.json").constant("AEM_NON_ROUTES_API_URL","/config/aemRoutes.root.json").service("aemRoutingService",aemRoutingService)}(angular,externalLogger),function(angular,CQ){"use strict";angular.module("tmobileCore").service("aemProps",function(){return{isAuthor:function(){return angular.isDefined(CQ)?angular.isDefined(CQ.WCM):!1}}})}(angular,window.CQ),function(angular,lodash){"use strict";function pdlServiceConstructor(PDLEVENT,pdlBridge,pdlConstant,cartStorage,jsonPath,commonUtils,commonServices,globalValue,commonStorage,toggleService){function triggerEvent(event){$window.digitalData.hasCallbacks()&&$window.digitalData.triggerEvent(event)}function pushEvent(eventObj){eventObj.eventInfo.timeStamp=(new Date).toJSON(),$window.digitalData.events.push(eventObj)}function setCartObject(cartObject){pdlBridge.assignCartToDigitalData(cartObject)}function addSimKitIntoEventProducts(cartObject,cartProduct,isRemoveEvent){function setPlanAndAddOn(line){var planDetailObject=lodash.get(line,"lineItemDetails.planDetails",{}),planDetail=pdlBridge.getProduct(planDetailObject);angular.isDefined(planDetail.id)&&(planDetail.attributes.lineNumber=lodash.get(line,"lineNumber"),combinedProducts.push(planDetail));var dataOptionObject=lodash.get(line,"lineItemDetails.planDetails.dataOptions",{});if(lodash.get(toggleService.model,"toggles.isPDLEventEnabledForDataSoc",!1)&&angular.isDefined(dataOptionObject)&&dataOptionObject["default"]===!1){planDetailObject.productSubType=pdlConstant.DATA_SOC_TEXT;var dataSocDetail=pdlBridge.getProduct(planDetailObject);dataSocDetail.attributes.lineNumber=lodash.get(line,"lineNumber"),combinedProducts.push(dataSocDetail),delete planDetailObject.productSubType}angular.forEach(lodash.get(line,"lineItemDetails.serviceDetails",[]),function(service){var serviceDetail=pdlBridge.getProduct(service);angular.isDefined(serviceDetail.id)&&combinedProducts.push(serviceDetail)})}if(cartProduct&&angular.equals("hardgood",cartProduct.type)){var combinedProducts;return angular.forEach(cartObject.lineItems,function(line){var deviceProduct=commonUtils.searchJson(line,'[?(@.sku =="'+cartProduct.id+'")]');if(deviceProduct&&(!combinedProducts||combinedProducts.length>0)){var simKitProduct=pdlBridge.getProduct(line.simKitDetails);cartProduct.attributes.lineNumber=line.lineNumber,combinedProducts=[],combinedProducts.push(cartProduct),angular.isDefined(simKitProduct.id)&&combinedProducts.push(simKitProduct),isRemoveEvent&&setPlanAndAddOn(line)}}),combinedProducts||(angular.equals(pdlConstant.PRODUCT_TYPE.accessories,cartProduct.subType)||angular.equals(pdlConstant.PRODUCT_SUBTYPE.SIMKIT,cartProduct.subType)?(combinedProducts=[],combinedProducts.push(cartProduct)):combinedProducts=cartProduct),combinedProducts}return cartProduct}function setCartAddEvent(cartProduct){var cartAddProducts=[],product=pdlBridge.getProduct(cartProduct),cartInfo=cartStorage.getGlobalSmartCartInfo();product&&angular.equals("softgood",product.type)?cartAddProducts.push(product):product&&angular.equals("hardgood",product.type)&&(product=addSimKitIntoEventProducts(cartInfo,product),angular.forEach(product,function(item){cartAddProducts.push(item)}));var cartAddEvent=angular.copy(PDLEVENT.cartAdd);cartAddEvent.product=cartAddProducts,setCartEventDescription(cartAddEvent,cartProduct.productType),pushEvent(cartAddEvent),triggerEvent(pdlConstant.TRIGGER_BASIC_EVENT),cartProduct.productType===pdlConstant.PRODUCT_TYPE.service&&(setPageLoadEvent(),triggerEvent(pdlConstant.TRIGGER_BASIC_EVENT))}function setCartRemoveEvent(cartProduct){cartRemoveProducts=[];var product=pdlBridge.getProduct(cartProduct);if(product&&angular.equals(pdlConstant.PRODUCT_TYPE.softgood,product.type)?cartRemoveProducts.push(product):product&&angular.equals(pdlConstant.PRODUCT_TYPE.hardgood,product.type)&&(product=addSimKitIntoEventProducts(_self.previousCartData,product,!0),angular.forEach(product,function(item){cartRemoveProducts.push(item)})),!angular.equals(pdlConstant.PRODUCT_TYPE.softgood,product.type)||!isDeviceRemoved&&angular.equals(product.subType,"service")){var cartRemoveEvent=angular.copy(PDLEVENT.cartRemove);cartRemoveEvent.product=cartRemoveProducts,setCartEventDescription(cartRemoveEvent),_self.defaultDeviceData.isDeviceSelected&&angular.equals(_self.defaultDeviceData.lineType,"HANDSET")&&(cartRemoveEvent.product=cartRemoveEvent.product.filter(function(item){return item.attributes.lineNumber=_self.defaultDeviceData.lineNumber,item})),pushEvent(cartRemoveEvent),triggerEvent(pdlConstant.TRIGGER_BASIC_EVENT),resetdefaultDeviceDataObject()}}function resetdefaultDeviceDataObject(){_self.defaultDeviceData={isDeviceSelected:!1,lineNumber:"",lineType:""}}function setCartEventForService(addedServiceProduct,removedServiceProduct){setCartEventForServiceData("cartAdd",addedServiceProduct),setCartEventForServiceData("cartRemove",removedServiceProduct),_self.defaultServiceData.isDefaultServiceSelected||setPageLoadEvent(),triggerEvent(pdlConstant.TRIGGER_BASIC_EVENT),_self.isUpdateClicked=!1,resetDefaultServiceDataObject()}function resetDefaultServiceDataObject(){_self.defaultServiceData={isDefaultServiceSelected:!1,familyName:"",lineNumber:"",type:""}}function setCartEventForServiceData(cartEventType,services){if(!_.isEmpty(services)){var cartEvent="cartAdd"===cartEventType?angular.copy(PDLEVENT.cartAdd):angular.copy(PDLEVENT.cartRemove);_self.defaultServiceData.isDefaultServiceSelected&&_self.defaultServiceData.type===pdlConstant.PRODUCT_SUBTYPE.SERVICE&&(services[0].attributes.lineNumber=_self.defaultServiceData.lineNumber),cartEvent.product=services,setCartEventDescription(cartEvent),pushEvent(cartEvent),triggerEvent(pdlConstant.TRIGGER_BASIC_EVENT)}}function setCartEventDescription(cartEvent,productType){var data,authorValue=globalValue.authorValue,clickEvents=commonUtils.searchJson(authorValue,"page.pdl.clickEvents");cartEvent.eventInfo.eventAction===PDLEVENT.cartRemove.eventInfo.eventAction?(data={},data.title="Remove",data.assetType=pdlConstant.ASSET_TYPE.LINK):cartEvent&&cartEvent.eventInfo.eventAction===PDLEVENT.cartAdd.eventInfo.eventAction&&(data=_.find(clickEvents.button,["elementAttribute",pdlConstant.EVENT_ATTRIBUTES.ADD_LINE]),lodash.isEmpty(data)||(data.title=angular.equals(productType,pdlConstant.PRODUCT_TYPE.service)?lodash.get(authorValue.cart,"services.addToCartCta"):lodash.get(authorValue.cart,"miniPdp.cartCta"),_.get($window.digitalData.events[$window.digitalData.events.length-3],"eventInfo.eventType","")===PDLEVENT.modalLoad.eventInfo.eventType&&(data.modalName=pdlConstant.MODAL_DATA.MINI_PDP_MODAL))),setCartEventDescriptionData(cartEvent,data)}function setCartEventDescriptionData(cartEvent,data){if(!lodash.isEmpty(data)&&lodash.get(data,"data",{})){var targetURL=data.target,icid=data.icid,assetType=data.assetType;switch(cartEvent.eventDescription.ctaName=data.title||"",cartEvent.eventDescription.modalName=data.modalName||"",cartEvent.eventDescription.assetType=assetType||"",_self.isDuplicateEvent&&(cartEvent.eventDescription.ctaName=pdlConstant.CTA_NAME.DUPLICATE,cartEvent.eventDescription.modalName="",cartEvent.eventDescription.assetType=pdlConstant.ASSET_TYPE.LINK),targetURL===pdlConstant.NA&&(targetURL=""),icid){case pdlConstant.ICID.ADDAPHONE_ICID:icid="";break;case pdlConstant.ICID.REMOVE_ICID:icid="",assetType=pdlConstant.ASSET_TYPE.LINK}cartEvent.eventDescription.icid=icid||"",cartEvent.eventDescription.targetUrl=targetURL||"",cartEvent.eventDescription.formName=data.formName||"",lodash.get(toggleService.model,"toggles.isPDLEventEnabledForDataSoc",!1)&&_self.isUpdateClicked&&(cartEvent.eventDescription.assetType=pdlConstant.ASSET_TYPE.BUTTON,cartEvent.eventDescription.ctaName=pdlConstant.CTA_NAME.UPDATE,cartEvent.eventDescription.modalName=pdlConstant.BACK_DROP_MODALS.deviceProtectionAndServicesSelectorModalV3.modalName),lodash.get(toggleService.model,"toggles.isPDLEventEnabledForDataSoc",!1)&&_self.defaultServiceData.isDefaultServiceSelected&&(cartEvent.eventDescription.assetType=pdlConstant.ASSET_TYPES.CHECKBOX,cartEvent.eventDescription.ctaName=_self.defaultServiceData.familyName,cartEvent.eventDescription.modalName="")}}function setCheckOutStepEvent(stepName,orderNumber){var checkOutStepEvent={eventInfo:{eventAction:pdlConstant.EVENT_ACTION.LOAD,eventType:pdlConstant.EVENT_TYPE.CHECKOUT_STEP},attributes:{stepName:stepName}},prevUrl=pdlBridge.getPrevUrl();if(angular.isDefined(orderNumber)&&(checkOutStepEvent.attributes.orderNumber=orderNumber),stepName===pdlConstant.EVENT_ATTRIBUTES.STEP_NAME.softOrderConfirm){var orderType="Prospect",tradeInType=$window.digitalData.cart.tradeInType;angular.isDefined(tradeInType)?checkOutStepEvent.attributes.orderType=orderType+":"+tradeInType+"Trade-in":checkOutStepEvent.attributes.orderType=orderType+":No Trade-in"}$window.digitalData.page.category.primaryCategory=pdlConstant.PAGE_CATEGORY.PRIMARY_SHOP,$window.digitalData.page.category.subCategory=pdlConstant.PAGE_CATEGORY.PAGETYPE_CHECKOUT,$window.digitalData.page.category.pageType=pdlConstant.PAGE_CATEGORY.PAGETYPE_CHECKOUT,$window.digitalData.page.pageInfo.pageName=checkOutStepEvent.attributes.stepName,$window.digitalData.page.pageInfo.pageTitle=document.title,$window.digitalData.page.pageInfo.pageURL=$location.absUrl(),$window.digitalData.page.pageInfo.previousPageURL=prevUrl,$window.digitalData.page.pageInfo.variant="",$window.digitalData.events.push(checkOutStepEvent)}function setModalLoadEvent(modalObject,product){$log.log("pdl::pdlBridge.getProduct::",product);var modalLoadEvent=angular.copy(PDLEVENT.modalLoad),lineDetails=$window.digitalData.cart.product;if(modalLoadEvent.product=product,angular.isDefined(modalLoadEvent.attributes)&&(modalLoadEvent.attributes.modalID=modalObject.modalID,modalLoadEvent.attributes.modalName=modalObject.modalName,modalLoadEvent.attributes.deviceType=lodash.get(modalObject,"deviceType",""),modalLoadEvent.attributes.icidList=pdlStorage.currentIcids),angular.isDefined(modalLoadEvent.attributes)&&(angular.isDefined(modalObject.userEngagementTool)&&(modalLoadEvent.attributes.userEngagementTool=modalObject.userEngagementTool),angular.isDefined(modalObject.dynamicContent)&&(modalLoadEvent.attributes.dynamicContent=modalObject.dynamicContent),angular.isDefined(modalObject.errorCode)&&angular.isDefined(modalObject.errorText))){var modalError=[],errorObject={errorText:modalObject.errorText,errorCode:modalObject.errorCode};modalError.push(errorObject),modalLoadEvent.eventInfo.eventType=pdlConstant.EVENT_TYPE.ERROR_MODAL,modalLoadEvent.error=modalError}var tradeDetails=[];angular.forEach(lineDetails,function(item){"Handset"===item.subType&&tradeDetails.push(item)}),angular.isUndefined(modalLoadEvent.attributes)&&(modalLoadEvent.attributes={}),angular.forEach(tradeDetails,function(item){var type=lodash.get(item,"tradeInDetails.tradeInType");type&&(modalLoadEvent.attributes.orderType="Prospect: "+type+" Trade-In ")}),angular.isDefined(modalObject.dynamicContent)&&"no"!==modalObject.dynamicContent&&(modalLoadEvent.attributes.dynamicContent=modalObject.dynamicContent),modalObject.modalID==pdlConstant.MODALID.SAVE_CART_ID&&delete modalLoadEvent.product,modalObject.modalID===pdlConstant.MODALID.SET_LOCATION_MODAL_ID&&(delete modalLoadEvent.product,delete modalLoadEvent.attributes.deviceType),modalObject.storeId&&(modalLoadEvent.eventDescription={storeID:modalObject.storeId}),$log.log("modal load event :: formatted modal load event object :: ",angular.toJson(modalLoadEvent)),pushEvent(modalLoadEvent),modalLoadEvent.attributes&&angular.isDefined(modalLoadEvent.attributes.orderType)&&"No Trade-in"!==modalLoadEvent.attributes.orderType&&setPageLoadEvent()}function setModalCloseEvent(modalObject){var targetUrl=modalObject.targetUrl||"",ctaName=pdlConstant.CTA_NAME.MODAL_CLOSE,assetType=pdlConstant.ASSET_TYPE.BUTTON,precedingClickEvent={eventInfo:{eventAction:pdlConstant.EVENT_ACTION.CLICK,eventType:pdlConstant.EVENT_TYPE.CLICK_TO_NAVIGATE},eventDescription:{assetType:assetType,ctaName:ctaName,targetUrl:targetUrl,modalName:modalObject.modalName},category:{eventCategory:pdlConstant.EVENT_ACTION.CLICK},attributes:{}};isRequiredModalExist(modalObject.modalName)?precedingClickEvent.attributes={dynamicContent:""}:lodash.isNull(modalObject.attribute)?delete precedingClickEvent.attributes:precedingClickEvent.attributes={type:pdlConstant.EVENT_TYPE.CLICK_TO_NAVIGATE},$window.digitalData.events.push(precedingClickEvent),triggerEvent(pdlConstant.TRIGGER_BASIC_EVENT),setModalBackDropCloseEvent(modalObject)}function setModalBackDropCloseEvent(modalObject){var dynamicContent=modalObject.dynamicContent||"",modalCloseEvent={eventInfo:{eventAction:pdlConstant.EVENT_ACTION.CLOSE,eventType:pdlConstant.EVENT_TYPE.MODAL},attributes:{modalID:modalObject.modalID,modalName:modalObject.modalName,dynamicContent:dynamicContent,icidList:pdlStorage.currentIcids}};angular.isDefined(modalObject.userEngagementTool)&&(modalCloseEvent.attributes.userEngagementTool=modalObject.userEngagementTool),pushEvent(modalCloseEvent),triggerEvent(pdlConstant.TRIGGER_BASIC_EVENT)}function removeHTMLTagsAndTruncate(htmlString){return htmlString&&htmlString.replace(/<[^>]*>/g,"").substring(0,pdlConstant.HTML_ERROR_LENGTH)||""}function setCheckoutErrorEvent(pdlErrorObject){var errorEvent={eventInfo:{eventAction:pdlConstant.EVENT_ACTION.CLICK,eventType:pdlConstant.EVENT_ACTION.ERROR},eventDescription:{formName:pdlErrorObject.formName,modalName:pdlErrorObject.modalName},error:[{errorText:removeHTMLTagsAndTruncate(pdlErrorObject.errorText),errorCode:pdlErrorObject.errorCode}]};$window.digitalData.events.push(errorEvent),pdlCheckForUndefinedOrNull(),triggerEvent(pdlConstant.TRIGGER_BASIC_EVENT)}function pdlCheckForUndefinedOrNull(){angular.forEach($window.digitalData.events,function(event){for(var propertyName in event.eventDescription)_.isNil(event.eventDescription[propertyName])&&(event.eventDescription[propertyName]="")})}function setErrorEvent(pdlErrorObject){var errorEvent={eventInfo:{eventAction:pdlConstant.EVENT_ACTION.CLICK,eventType:pdlConstant.EVENT_ACTION.ERROR},category:{eventCategory:pdlConstant.EVENT_CATEGORY.ERROR},eventDescription:{errorText:pdlErrorObject.errorText,errorCode:pdlErrorObject.errorCode}};angular.isDefined(pdlErrorObject.modalName)&&(errorEvent.eventDescription.modalName=pdlErrorObject.modalName),angular.isDefined(pdlErrorObject.eventAction)&&(errorEvent.eventInfo.eventAction=pdlErrorObject.eventAction),$window.digitalData.events.push(errorEvent)}function setCreditEstimationEvent(creditClass,modalData,pdlFamilyData){var creditEstimationEvent=angular.copy(PDLEVENT.creditEstimation);angular.isDefined(creditEstimationEvent.attributes)&&(angular.isDefined(pdlConstant.EVENT_ATTRIBUTES.CREDIT_LEVEL[creditClass["class"]])?creditEstimationEvent.attributes.creditLevel=pdlConstant.EVENT_ATTRIBUTES.CREDIT_LEVEL[creditClass["class"]]:creditEstimationEvent.attributes.creditLevel=pdlConstant.EVENT_ATTRIBUTES.CREDIT_LEVEL[creditClass.creditClass],angular.isDefined(modalData)&&(creditEstimationEvent.attributes.modalName=modalData.modalName),angular.isDefined(pdlFamilyData)&&(creditEstimationEvent.eventDescription={},creditEstimationEvent.eventDescription.ctaName=pdlFamilyData,creditEstimationEvent.eventDescription.targetUrl="")),pushEvent(creditEstimationEvent),$window.digitalData.cart.creditLevel=pdlConstant.EVENT_ATTRIBUTES.CREDIT_LEVEL[creditClass["class"]]}function setClickToCallEvent(clickCallData){var clickToCallEvent=angular.copy(PDLEVENT.clickToCall);angular.isDefined(clickToCallEvent.attributes)&&(clickCallData.tfn&&(clickToCallEvent.attributes.tfn=clickCallData.tfn),angular.isUndefined(clickCallData.tfn)&&angular.isUndefined(clickCallData.icidList)&&(clickToCallEvent.eventDescription.ctaName=clickCallData.pdlEvent.ctaName,clickToCallEvent.eventDescription.targetUrl=clickCallData.pdlEvent.target,clickToCallEvent.eventDescription.assetType=clickCallData.pdlEvent.assetType,clickToCallEvent.eventDescription.icid=clickCallData.pdlEvent.icid||"",clickToCallEvent.eventDescription.modalName=clickCallData.pdlEvent.modalName||"",clickToCallEvent.eventDescription.formName=clickCallData.pdlEvent.formName||"",clickToCallEvent.attributes.tfn=clickCallData.pdlEvent.tfn),clickCallData.pdlEvent.storeId&&(clickToCallEvent.eventDescription.storeID=clickCallData.pdlEvent.storeId),clickCallData.icidList&&(_.includes(pdlStorage.currentIcids,clickCallData.icidList)||pdlStorage.currentIcids.push(clickCallData.icidList),clickToCallEvent.attributes.icidList=pdlStorage.currentIcids)),pushEvent(clickToCallEvent)}function setCallMeNowEvent(callMeData){var callMeNowEvent={eventInfo:{eventAction:pdlConstant.EVENT_ACTION.CLICK,eventType:pdlConstant.EVENT_TYPE.CLICK_TO_ACTION},attributes:{type:callMeData.type},eventDescription:{ctaName:callMeData.ctaName}};$window.digitalData.events.push(callMeNowEvent)}function setFormDataEvent(formData){var formFieldEvent={eventInfo:{eventAction:pdlConstant.EVENT_ACTION.CLICK,eventType:pdlConstant.EVENT_TYPE.FORM_START},category:{eventCategory:formData.eventCategory?formData.eventCategory:pdlConstant.EVENT_CATEGORY.CLICK},eventDescription:{formName:formData.formName||"",modalName:formData.modalName||""}};formData.storeId&&(formFieldEvent.eventDescription.storeID=formData.storeId);var isAdded=!1;const lastIndex=$window.digitalData.events.map(function(data){return data.eventInfo.eventAction===pdlConstant.EVENT_ACTION.LOAD&&data.eventInfo.eventType!==pdlConstant.EVENT_TYPE.MODAL&&data.attributes&&data.attributes.stepName!==pdlConstant.EVENT_ATTRIBUTES.STEP_NAME.LoadingCreditCheck}).lastIndexOf(!0);var eventLength=$window.digitalData.events.length;if(eventLength>1)for(var i=lastIndex+1;eventLength>i;i++)if($window.digitalData.events[i].eventInfo.eventType==pdlConstant.EVENT_TYPE.FORM_START){isAdded=!0;break}isAdded||($window.digitalData.events.push(formFieldEvent),triggerEvent(pdlConstant.TRIGGER_BASIC_EVENT))}function setToolTipEvent(clickCallData){var tooltipData=angular.copy(PDLEVENT.dynamicClick);angular.isDefined(tooltipData.eventDescription)&&(tooltipData.eventDescription.ctaName=clickCallData.ctaName,tooltipData.eventDescription.assetType=clickCallData.assetType,angular.isDefined(clickCallData.targetUrl)&&(tooltipData.eventDescription.targetUrl=clickCallData.targetUrl)),angular.isDefined(clickCallData.eventType)&&(tooltipData.eventInfo.eventType=clickCallData.eventType),pushEvent(tooltipData)}function setNudgeModalEvent(nudgeData){var nudgeEvent=angular.copy(PDLEVENT.modalNudge);pdlConstant.NUDGE_DATA.CART_RETRIEVE_DATA!==nudgeData&&(setPageLoadEvent(),triggerEvent(pdlConstant.TRIGGER_BASIC_EVENT)),angular.isDefined(nudgeEvent.attributes)&&(nudgeEvent.attributes.nudgeText=nudgeData,pushEvent(nudgeEvent),triggerEvent(pdlConstant.TRIGGER_BASIC_EVENT))}function setRetrieveCartEvent(dynamicData){var retrieveCartModalData=angular.copy(PDLEVENT.cartRetrieve);retrieveCartModalData.eventDescription=dynamicData.eventDescription;var cartDetails=$window.digitalData.cart.product;angular.isDefined(cartDetails)&&(retrieveCartModalData.product=cartDetails),pushEvent(retrieveCartModalData)}function setSaveCartEvent(dynamicData){var saveCartModalData=angular.copy(PDLEVENT.cartSave);saveCartModalData.eventDescription=dynamicData.eventDescription,saveCartModalData.eventInfo=dynamicData.eventInfo?dynamicData.eventInfo:saveCartModalData.eventInfo;var cartDetails=$window.digitalData.cart.product;angular.isDefined(cartDetails)&&(saveCartModalData.product=cartDetails),pushEvent(saveCartModalData),triggerEvent(pdlConstant.TRIGGER_BASIC_EVENT)}function setDynamicClickEvent(dynamicData){var dynamicClickEvent=angular.copy(PDLEVENT.dynamicClick);if(dynamicClickEvent.eventDescription){dynamicClickEvent.eventDescription.title=dynamicData.title||"";var icid=dynamicData.icid,assetType=dynamicData.assetType;switch(icid){case pdlConstant.ICID.duplicate_ICID:_self.isDuplicateEvent=!0,icid="",assetType=pdlConstant.ASSET_TYPE.LINK;break;case pdlConstant.ICID.REMOVE_ICID:icid="",_self.isDuplicateEvent=!1,assetType=pdlConstant.ASSET_TYPE.LINK;break;default:_self.isDuplicateEvent=!1}dynamicClickEvent.eventDescription.icid=icid||"",dynamicClickEvent.eventDescription.assetType=assetType||"",dynamicClickEvent.eventDescription.ctaName=dynamicData.ctaName||dynamicData.title,dynamicClickEvent.eventDescription.targetUrl=dynamicData.target||"",dynamicClickEvent.eventDescription.userSelection=dynamicData.userSelection?$filter("parseText")(dynamicData.userSelection):"",dynamicClickEvent.eventDescription.filterName=dynamicData.filterName||"",dynamicClickEvent.eventDescription.formName=dynamicData.formName||""}if(angular.isDefined(dynamicData.collapsed)&&(dynamicClickEvent.eventDescription.ctaName=(dynamicData.collapsed?"Expand: ":"Collapse: ")+dynamicData.ctaName),dynamicClickEvent.eventInfo&&(dynamicClickEvent.eventInfo.eventType=dynamicData.eventType?dynamicData.eventType:pdlConstant.EVENT_TYPE.NAV_CLICK),"filter"===dynamicData.eventAction&&(dynamicClickEvent.eventInfo.eventAction=dynamicData.eventAction||""),dynamicData.modalName&&"filter"===dynamicData.eventAction&&(dynamicClickEvent.eventDescription.modalName=dynamicData.modalName),dynamicData.eventCategory&&(dynamicClickEvent.category.eventCategory=dynamicData.eventCategory),dynamicData.modalName&&"filter"!==dynamicData.eventAction&&(dynamicClickEvent.attributes.modalName=dynamicData.modalName),dynamicData.product){var product=[];angular.forEach(dynamicData.product,function(productData){product.push(pdlBridge.getProduct(productData))}),dynamicClickEvent.product=product}("Add Phone image"===dynamicClickEvent.eventDescription.ctaName||"Add Accessory image"===dynamicClickEvent.eventDescription.ctaName)&&(dynamicClickEvent.eventDescription.targetUrl="",0!==digitalData.cart.lineCount&&(dynamicClickEvent.eventInfo.eventType="clickToAction")),dynamicData.storeId&&(dynamicClickEvent.eventDescription.storeID=dynamicData.storeId),pushEvent(dynamicClickEvent)}function setNavigationClickEvent(navClickEventData){var navigationEvent={eventInfo:{eventAction:pdlConstant.EVENT_ACTION.CLICK,eventType:pdlConstant.EVENT_TYPE.NAV_CLICK},attributes:{type:navClickEventData.type,modalName:angular.isUndefined(navClickEventData.modalName)?null:navClickEventData.modalName},eventDescription:{ctaName:angular.equals("addLine",navClickEventData.buttonType)?navClickEventData.ctaName+" | "+navClickEventData.productName:navClickEventData.ctaName,targetUrl:navClickEventData.targetUrl,icid:angular.isUndefined(navClickEventData.icid)?null:navClickEventData.icid,assetType:angular.isUndefined(navClickEventData.assetType)?null:navClickEventData.assetType}};"oferModal"===navClickEventData.category&&delete navigationEvent.attributes.modalName,navClickEventData.modalName===pdlConstant.MODAL_DATA.SET_LOCATION_MODAL&&(delete navigationEvent.attributes,navigationEvent.eventDescription.modalName=navClickEventData.modalName),$window.digitalData.pageInfo={},$window.digitalData.pageInfo.pageName=navClickEventData.pageName,$window.digitalData.pageInfo.pageTitle=navClickEventData.pageTitle,$window.digitalData.events.push(navigationEvent)}function setNavClickEvent(navData){var navClickEvent=angular.copy(PDLEVENT.navClick);navClickEvent.link&&(navClickEvent.link.navType=navData.navType,navClickEvent.link.linkName=navData.linkName,navClickEvent.link.icid=navData.icid,navClickEvent.link.linkURL=navData.linkURL,navClickEvent.link.hierarchy=navData.hierarchy),navClickEvent.eventDescription&&(navClickEvent.eventDescription.ctaName=navData.linkName,navClickEvent.eventDescription.targetUrl=navData.linkURL),navClickEvent.attributes&&(navClickEvent.attributes.modalName=navData.hierarchy),pushEvent(navClickEvent)}function setUNavClickEvent(navData){var navClickEvent=angular.copy(PDLEVENT.navClick);navClickEvent.eventInfo&&(navClickEvent.eventInfo.eventType="navigation"),navClickEvent.category&&(navClickEvent.category={}),navClickEvent.eventDescription&&(navClickEvent.eventDescription.navType=navData.category,navClickEvent.eventDescription.subCategory=navData.subCategory,navClickEvent.eventDescription.ctaName=navData.ctaName,navClickEvent.eventDescription.targetUrl=navData.targetUrl,navClickEvent.eventDescription.icid=navData.icid),pushEvent(navClickEvent),
triggerEvent(pdlConstant.TRIGGER_BASIC_EVENT)}function setMenuNavigationClickPDL(navData){var navClickEvent=angular.copy(PDLEVENT.navClick);navClickEvent.eventInfo&&(navClickEvent.eventInfo.eventType="navigation"),navClickEvent.category&&(navClickEvent.category={}),navClickEvent.eventDescription&&(navClickEvent.eventDescription.navType=navData.category,navClickEvent.eventDescription.subCategory=navData.subCategory,navClickEvent.eventDescription.ctaName=navData.ctaName,navClickEvent.eventDescription.targetUrl=navData.targetUrl),pushEvent(navClickEvent),triggerEvent(pdlConstant.TRIGGER_BASIC_EVENT)}function setLinkClickEvent(linkData){var linkClickEvent=angular.copy(PDLEVENT.linkClick);linkClickEvent.eventDescription&&(linkClickEvent.eventDescription.ctaName=linkData.linkName,linkClickEvent.eventDescription.targetURL="NA"===linkData.linkURL?"":_.get(linkData,"linkURL","")),pushEvent(linkClickEvent)}function setPageData(){pdlBridge.assignPageToDigitalData(null)}function setPageLoadEvent(product,url){var pageLoadEvent=angular.copy(PDLEVENT.pageLoad);pageLoadEvent.product=product?product:[];var lineDetails=$window.digitalData.cart.product,tradeDetails=[];pageLoadEvent.attributes&&(pageLoadEvent.attributes.dynamicContent="",pageLoadEvent.attributes.icidList=pdlStorage.currentIcids,lodash.forEach(lineDetails,function(item){"Handset"===item.subType&&tradeDetails.push(item)}),lodash.forEach(tradeDetails,function(item){var type=lodash.get(item,"tradeInDetails.tradeInType");type?pageLoadEvent.attributes.orderType="Prospect: "+type+" Trade-In ":pageLoadEvent.attributes.orderType="No Trade-in"})),pdlStorage.pageLoadEvent=pageLoadEvent,pushEvent(pageLoadEvent)}function setTradeInPageLoadEvent(){var pageLoadEvent=angular.copy(PDLEVENT.pageLoad);pageLoadEvent.attributes&&(pageLoadEvent.attributes.dynamicContent="",pageLoadEvent.attributes.icidList=pdlStorage.currentIcids,pageLoadEvent.attributes.orderType=" Prospect: No Trade-In  "),pdlStorage.pageLoadEvent=pageLoadEvent,pushEvent(pageLoadEvent),pdlBridge.assignSPAPageDataToDigitalData($location.url),triggerEvent(pdlConstant.TRIGGER_BASIC_EVENT)}function setToggleCheckEvent(checkedValue,eventDescription){var e911Event={eventDescription:{modalName:eventDescription.modalName,ctaName:"",ModuleName:eventDescription.moduleName},eventInfo:{eventAction:pdlConstant.EVENT_CATEGORY.CLICK,eventType:pdlConstant.EVENT_TYPE.CLICK_TO_ACTION,timestamp:(new Date).toString()},attributes:{type:eventDescription.type}};"autoPaySwitch"===eventDescription.ctaName?e911Event.eventDescription.ctaName="check"===checkedValue?"AutoPay Toggle: ON":"AutoPay Toggle: OFF":e911Event.eventDescription.ctaName=eventDescription.moduleName+": "+checkedValue,$window.digitalData.events.push(e911Event)}function setProductSwatchEvent(colorData){var event={eventInfo:{eventAction:pdlConstant.EVENT_ACTION.CLICK,eventType:pdlConstant.EVENT_TYPE.CLICK_TO_ACTION,timeStamp:(new Date).toString()},attributes:{type:"navigation"},eventDescription:{ctaName:colorData,targetUrl:""}};$window.digitalData.events.push(event)}function setMemorySwatchEvent(memoryData){var event={eventInfo:{eventAction:pdlConstant.EVENT_ACTION.CLICK,eventType:pdlConstant.EVENT_TYPE.CLICK_TO_ACTION,timeStamp:(new Date).toString()},attributes:{type:"navigation"},eventDescription:{ctaName:memoryData,targetUrl:""}};$window.digitalData.events.push(event)}function hasPlanChanged(newCart,_selfOld){var oldPlanId=lodash.get(_selfOld,"previousCartData.lineItems[0].lineItemDetails.planDetails.planName","");if(""===oldPlanId)return!1;var newPlanId=lodash.get(newCart,"lineItems[0].lineItemDetails.planDetails.planName","");return""===newPlanId?!1:oldPlanId.trim()!==newPlanId.trim()}function hasDeviceRemoved(newCart,_selfOld){var oldlineItems=lodash.get(_selfOld,"previousCartData.lineItems",[]),newlineItems=lodash.get(newCart,"lineItems","");return newlineItems.length-oldlineItems.length<0?!0:!1}function processCartDataAndEvent(oldCart,newCart){function callEventForNewCart(productkey){var products=jsonPath(newCart,"$..["+productkey+"]");angular.forEach(products,function(product){!product.isProductAdded||angular.equals("simKitDetails",productkey)&&!product.isBYODAdded||setCartAddEvent(product)})}function checkCartEvents(key,productKey){var oldCartObject=jsonPath(oldCart,"$..["+key+"]"),newCartObject=jsonPath(newCart,"$..["+key+"]"),oldCartProducts=oldCartObject,newCartProducts=newCartObject,itemInNew=null,itemInOld=null,noEvents=null;angular.equals("lineItemDetails.serviceDetails",key)&&(oldCartProducts&&(oldCartProducts=[].concat.apply([],oldCartProducts)),newCartProducts&&(newCartProducts=[].concat.apply([],newCartProducts))),angular.equals("accessories.accessoryDetails",key)&&(oldCartProducts=oldCartProducts[0],newCartProducts=newCartProducts[0]);var productStack=[];angular.forEach(oldCartProducts,function(v1,index){var i=0;if(v1.isProductAdded&&(!angular.equals("simKitDetails",key)||v1.isBYODAdded)&&!_.includes(productStack,v1[productKey])&&(productStack.push(v1[productKey]),itemInNew=jsonPath(newCartProducts,"$..[?(@."+productKey+' == "'+v1[productKey]+'")]'),itemInOld=jsonPath(oldCartProducts,"$..[?(@."+productKey+' == "'+v1[productKey]+'")]'),itemInNew?itemInOld||(itemInOld=[]):itemInNew=[],itemInNew&&itemInOld&&(noEvents=itemInOld.length-itemInNew.length,noEvents>0)))for(i=0;noEvents>i;i++)"lineItemDetails.serviceDetails"!==key?setCartRemoveEvent(v1):removedServiceProduct.push(pdlBridge.getProduct(v1));lodash.get(toggleService.model,"toggles.isPDLEventEnabledForDataSoc",!1)&&v1.isProductAdded&&angular.isDefined(v1.dataOptions)&&!v1.dataOptions["default"]&&angular.isDefined(newCartProducts[index])&&angular.isDefined(newCartProducts[index].dataOptions)&&(newCartProducts[index].dataOptions["default"]||newCartProducts[index].dataOptions.soc!==v1.dataOptions.soc)&&angular.equals("lineItemDetails.planDetails",key)&&(v1.productSubType=pdlConstant.DATA_SOC_TEXT,removedServiceProduct.push(pdlBridge.getProduct(v1)),delete v1.productSubType)}),productStack=[],angular.forEach(newCartProducts,function(v1,index){var i=0;if(v1.isProductAdded&&(!angular.equals("simKitDetails",key)||v1.isBYODAdded)&&!_.includes(productStack,v1[productKey])&&(productStack.push(v1[productKey]),itemInNew=jsonPath(newCartProducts,"$..[?(@."+productKey+' == "'+v1[productKey]+'")]'),itemInOld=jsonPath(oldCartProducts,"$..[?(@."+productKey+' == "'+v1[productKey]+'")]'),itemInNew?itemInOld||(itemInOld=[]):itemInNew=[],itemInNew&&itemInOld&&(noEvents=itemInNew.length-itemInOld.length,noEvents>0)))for(i=0;noEvents>i;i++)"lineItemDetails.serviceDetails"!==key?setCartAddEvent(v1):addedServiceProduct.push(pdlBridge.getProduct(v1));lodash.get(toggleService.model,"toggles.isPDLEventEnabledForDataSoc",!1)&&v1.isProductAdded&&angular.isDefined(v1.dataOptions)&&!v1.dataOptions["default"]&&angular.isDefined(oldCartProducts[index])&&angular.isDefined(oldCartProducts[index].dataOptions)&&(oldCartProducts[index].dataOptions["default"]||oldCartProducts[index].dataOptions.soc!==v1.dataOptions.soc)&&angular.equals("lineItemDetails.planDetails",key)&&(v1.productSubType=pdlConstant.DATA_SOC_TEXT,addedServiceProduct.push(pdlBridge.getProduct(v1)),delete v1.productSubType)})}var services=null,accessories=null,addedServiceProduct=[],removedServiceProduct=[];delete newCart.reviewCart,isDeviceRemoved=hasDeviceRemoved(newCart,_self);var isPlanChanged=hasPlanChanged(newCart,_self);return!_self.previousCartData&&newCart.lineItems&&newCart.lineItems.length>0?(setCartObject(newCart),void(_self.previousCartData=angular.copy(newCart))):(_self.previousCartData&&(oldCart=_self.previousCartData,delete oldCart.reviewCart),setCartObject(newCart),oldCart?(oldCart||(oldCart=_self.previousCartData),$log.log("old cart time ",oldCart.modifiedTime," new cart time ",newCart.modifiedTime),void(angular.equals(oldCart.modifiedTime,newCart.modifiedTime)||($timeout(function(){pdlStorage.currentIcids=[]},500),isPlanChanged||(fromUno||checkCartEvents("lineItemDetails.deviceDetails","sku"),fromUno=!1,checkCartEvents("lineItemDetails.planDetails","planName"),checkCartEvents("simKitDetails","simKitId"),checkCartEvents("lineItemDetails.serviceDetails","serviceId"),checkCartEvents("accessories.accessoryDetails","id")),_self.previousCartData=angular.copy(newCart),_self.isDuplicateEvent=!1,!lodash.get(toggleService.model,"toggles.isPDLEventEnabledForDataSoc",!1)||!_self.isUpdateClicked&&!_self.defaultServiceData.isDefaultServiceSelected||_.isEmpty(addedServiceProduct)&&_.isEmpty(removedServiceProduct)||setCartEventForService(addedServiceProduct,removedServiceProduct)))):(callEventForNewCart("lineItemDetails.deviceDetails"),callEventForNewCart("lineItemDetails.planDetails"),callEventForNewCart("simKitDetails"),services=jsonPath(newCart,"$..lineItemDetails.serviceDetails"),services&&services.length>0&&(services=services[0]),angular.forEach(services,function(service){service.isProductAdded&&setCartAddEvent(service)}),accessories=jsonPath(newCart,"$..accessories.accessoryDetails"),accessories&&accessories.length>0&&(accessories=accessories[0]),void(_self.previousCartData=angular.copy(newCart))))}function initDigitalData(){$window.digitalData.events=[]}function callCartAddEvent(cartObject,cartProduct){setCartObject(cartObject),setCartAddEvent(cartProduct)}function callCartRemoveEvent(cartObject,cartProduct){setCartObject(cartObject),setCartRemoveEvent(cartProduct),triggerEvent(pdlConstant.TRIGGER_BASIC_EVENT)}function triggerEventOnInterval(event){var elapsedTime=0,max=6,gap=250,interval=$interval(function(){elapsedTime+=1,(elapsedTime==max||$window.digitalData&&$window.digitalData.hasCallbacks&&$window.digitalData.hasCallbacks()>0)&&($interval.cancel(interval),triggerEvent(event))},gap)}function callCheckOutStepEvent(stepName,orderNumber){$log.log("pdlService.callCheckOutStepEvent::",stepName),setCheckOutStepEvent(stepName,orderNumber),angular.equals(stepName,pdlConstant.EVENT_ATTRIBUTES.STEP_NAME.personalInfoTPP)?(setCartDataIntoDigitalData(),triggerEventOnInterval(pdlConstant.TRIGGER_BASIC_EVENT)):triggerEvent(pdlConstant.TRIGGER_BASIC_EVENT),setCheckOutIntoDigitalData()}function setCartID(){$window.digitalData.cart.cartID=cartStorage.getCartId()}function setCartDataIntoDigitalData(){var cartInfo=cartStorage.getGlobalSmartCartInfo();cartInfo&&!cartInfo.error&&(setCartID(),setCartObject(cartInfo))}function setCheckOutIntoDigitalData(){var checkOutInfo=cartStorage.getGlobalCheckOutInfo();checkOutInfo&&!checkOutInfo.error&&($log.log("pdlService.setCheckOutData :: setCheckOutData is changed "),pdlBridge.assignCheckOutToDigitalData(checkOutInfo))}function callCheckOutStepPersonalInfoEvent(){setCheckOutStepEvent(pdlConstant.EVENT_ATTRIBUTES.STEP_NAME.personalInfo),triggerEvent(pdlConstant.TRIGGER_BASIC_EVENT)}function callModalLoadEvent(modalObject,modalProduct){var product=[];angular.forEach(modalProduct,function(productData){product.push(pdlBridge.getProduct(productData))}),setModalLoadEvent(modalObject,product),triggerEvent(pdlConstant.TRIGGER_BASIC_EVENT),pdlStorage.currentIcids=[]}function callModalCloseEvent(modalObject){setModalCloseEvent(modalObject),triggerEvent(pdlConstant.TRIGGER_BASIC_EVENT)}function callErrorEvent(pdlErrorObject){setErrorEvent(pdlErrorObject),triggerEvent(pdlConstant.TRIGGER_BASIC_EVENT)}function callCreditEstimationEvent(creditClass,modalData,pdlFamilyData){setCreditEstimationEvent(creditClass,modalData,pdlFamilyData),triggerEvent(pdlConstant.TRIGGER_BASIC_EVENT)}function callClickToCallEvent(clickCallData){setClickToCallEvent(clickCallData),triggerEvent(pdlConstant.TRIGGER_BASIC_EVENT)}function callPdlClickForSubmitSearch(searchField,autosearch,searchresultslist){var pdlClickEvent=angular.copy(PDLEVENT.searchClick);angular.isDefined(pdlClickEvent.eventDescription)&&(pdlClickEvent.eventDescription.ctaName="",pdlClickEvent.eventDescription.searchTerm="",pdlClickEvent.eventDescription.assetType="button",pdlClickEvent.eventDescription.autosearch=autosearch?1:0,pdlClickEvent.eventDescription.nullSearchFlag=0>=searchresultslist?!0:!1),angular.isDefined(pdlClickEvent.attributes)&&(pdlClickEvent.attributes.type="search click"),pushEvent(pdlClickEvent),triggerEvent(pdlConstant.TRIGGER_BASIC_EVENT)}function callPdlEventForBladeClick(ctaName,targetUrl){var pdlClickEvent=angular.copy(PDLEVENT.searchClick);angular.isDefined(pdlClickEvent.eventDescription)&&(pdlClickEvent.eventDescription.ctaName="SRP Blade Click:"+ctaName,pdlClickEvent.eventDescription.targetUrl=targetUrl),angular.isDefined(pdlClickEvent.attributes)&&(pdlClickEvent.attributes.type=pdlConstant.EVENT_ATTRIBUTES.BLADE),pushEvent(pdlClickEvent),triggerEvent(pdlConstant.TRIGGER_BASIC_EVENT)}function callPdlClickForSubmitTradeIn(){var pdlClickEvent=angular.copy(PDLEVENT.navClick),authorValue=globalValue.authorValue;angular.isDefined(pdlClickEvent.eventDescription)&&(pdlClickEvent.eventDescription.ctaName=authorValue.rootPage.tradeInTool.tradeInValueScreen.acceptCta,pdlClickEvent.eventDescription.targetUrl=" ",pdlClickEvent.eventDescription.userSelection=authorValue.rootPage.tradeInTool.tradeInValueScreen.standardTradeInHeader),angular.isDefined(pdlClickEvent.attributes)&&(pdlClickEvent.attributes.type="navigation",pdlClickEvent.attributes.modalName="Device Trade-in Confirmation",pdlClickEvent.attributes.userEngaementTool="Device Trade-in",pdlClickEvent.attributes.toolComplete=!0),pushEvent(pdlClickEvent),triggerEvent(pdlConstant.TRIGGER_BASIC_EVENT)}function callPdlClickForRemoveTradeIn(selectedLine,ctaLabel){var pdlClickEvent=angular.copy(PDLEVENT.navClick);angular.isDefined(pdlClickEvent.eventDescription)&&(pdlClickEvent.eventDescription.ctaName=ctaLabel,pdlClickEvent.eventDescription.targetUrl="",pdlClickEvent.eventDescription.orderType="Prospect : "+selectedLine.tradeInDetails.tradeInType),angular.isDefined(pdlClickEvent.attributes)&&(pdlClickEvent.attributes.type="navigation"),pushEvent(pdlClickEvent),triggerEvent(pdlConstant.TRIGGER_BASIC_EVENT),setCartObject(cartStorage.getGlobalSmartCartInfo())}function callCallMeNowEvent(callMeData){setCallMeNowEvent(callMeData),triggerEvent(pdlConstant.TRIGGER_BASIC_EVENT)}function callFormDataEvent(formData){setFormDataEvent(formData)}function callToolTipEvent(callToolTipData){setToolTipEvent(callToolTipData),triggerEvent(pdlConstant.TRIGGER_BASIC_EVENT)}function callRetrieveCartEvent(callRetrieveCartModalData){setRetrieveCartEvent(callRetrieveCartModalData),triggerEvent(pdlConstant.TRIGGER_BASIC_EVENT)}function callDynamicClickEvent(callDynamicClickEventData){setDynamicClickEvent(callDynamicClickEventData),triggerEvent(pdlConstant.TRIGGER_BASIC_EVENT)}function callNavigationClickEvent(navClickEventData){setNavigationClickEvent(navClickEventData),triggerEvent(pdlConstant.TRIGGER_BASIC_EVENT)}function callGenericCTAorLinkEvent(callOrderInStoreModalData){setGenericCTAorLinkEvent(callOrderInStoreModalData),triggerEvent(pdlConstant.TRIGGER_BASIC_EVENT)}function setPdlForTradeInDeviceClick(){var authorValue=globalValue.authorValue,tradeInDeviceClickEvent=angular.copy(PDLEVENT.navClick);tradeInDeviceClickEvent.attributes&&(tradeInDeviceClickEvent.attributes.type="navigation",tradeInDeviceClickEvent.attributes.userEngaementTool="Device Trade-in",tradeInDeviceClickEvent.attributes.toolComplete=!1),tradeInDeviceClickEvent.eventDescription&&(tradeInDeviceClickEvent.eventDescription.ctaName=authorValue.cart.tradeIn.tradeInCTA,tradeInDeviceClickEvent.eventDescription.targetUrl=""),pushEvent(tradeInDeviceClickEvent),triggerEvent(pdlConstant.TRIGGER_BASIC_EVENT)}function getTrackableCheckBoxNames(){var authorValue=globalValue.authorValue;return pdlStorage.trackableCheckBoxNames||(pdlStorage.trackableCheckBoxNames=commonUtils.searchJson(authorValue,"page.pdl.trackableCheckBoxNames")),pdlStorage.trackableCheckBoxNames}function compileDOM(){var authorValue=globalValue.authorValue,compileDomByQuery=commonUtils.searchJson(authorValue,"page.pdl.compileDomByQuery"),rootCompileDomByQuery=commonUtils.searchJson(authorValue,"rootPage.pdl.compileDomByQuery");return compileDomByQuery||(compileDomByQuery=[]),compileDomByQuery=compileDomByQuery.concat(rootCompileDomByQuery),0===compileDomByQuery.length?void(pdlStorage.isDOMCompileDone=!0):(angular.forEach(compileDomByQuery,function(query){var element=angular.element(query);$compile(element.contents())}),void(pdlStorage.isDOMCompileDone=!0))}function setSPAPageDataAndEvent(url,product){var interval=$interval(function(){if(pdlStorage.isStillListingIcids?(pdlStorage.idleTimeListingIcid=0,pdlStorage.isStillListingIcids=!1):pdlStorage.idleTimeListingIcid++,!pdlStorage.isDOMCompileDone&&pdlStorage.idleTimeListingIcid>5&&(pdlStorage.idleTimeListingIcid=0,compileDOM()),pdlStorage.idleTimeListingIcid>5){var deviceType,pageInfo=$window.digitalData.page.pageInfo;pageInfo.previousPageURL="N/A",angular.equals(pageInfo.previousPageURL,pageInfo.pageURL)||(pdlBridge.assignSPAPageDataToDigitalData(url),setPageLoadEvent(product,url)),deviceType="cell-phone"===$stateParams.detailCategory?"Phones":"internet-device"===$stateParams.detailCategory?"Tablets and Devices":"Accessories",product&&$window.digitalData&&($window.digitalData.page.pageInfo.pageName=deviceType+": "+product.name,$window.digitalData.page.pageInfo.pageTitle=product.name,$window.digitalData.page.category.subCategory=$stateParams.detailCategory),$log.log("page load event :: formatted page event object (500ms):: ",angular.toJson(pdlStorage.pageLoadEvent)),triggerEvent(pdlConstant.TRIGGER_BASIC_EVENT),pdlStorage.currentIcids=[],$stateParams.detailCategory&&$cookies.put("loadPDLGenerated","true"),$location.hash().contains("reviews")&&loadProductReviewsEvent(),$interval.cancel(interval)}},100)}function callPDPLoadEvent(pdlProduct){if(pdlProduct){var product=pdlBridge.getProduct(pdlProduct);setSPAPageDataAndEvent($location.url,product)}}function callToggleCheckEvent(fieldName,checkedValue,eventDescription){setToggleCheckEvent(checkedValue,eventDescription),triggerEvent(pdlConstant.TRIGGER_BASIC_EVENT)}function clearIcidList(){pdlStorage.currentIcids=[]}function setPLPFilterAndSortOptions(options){pdlStorage.plpFilterAndSortOptions=options}function callNudgeModalEvent(nudgeData){setNudgeModalEvent(nudgeData)}function setPdlForClickTradeIn(data){var clickEvent=angular.copy(PDLEVENT.navClick);clickEvent.attributes&&(clickEvent.attributes.type="Navigation",clickEvent.attributes.userEngaementTool="Device Trade-in",_.isEmpty(data.modelName)||(clickEvent.attributes.modalName=data.modelName),clickEvent.attributes.userAttributeSelection="Trade-In["+data.carrier+"]:["+data.make+"]:["+data.deviceModel+"]:["+data.deviceConditionOption+"]"),clickEvent.eventDescription&&(clickEvent.eventDescription.ctaName="Get Estimate",clickEvent.eventDescription.targetUrl="www.t-mobile.com"),pushEvent(clickEvent),triggerEvent(pdlConstant.TRIGGER_BASIC_EVENT)}function setCommonPageLoad(){var pageLoadEvent=angular.copy(PDLEVENT.pageLoad);pageLoadEvent.eventInfo.timestamp=new Date,pageLoadEvent.attributes.icid=[],pushEvent(pageLoadEvent),triggerEvent(pdlConstant.TRIGGER_BASIC_EVENT)}function setPageLoadDataForTradeIn(pageLoadData,tradeInData){pdlStorage={};var pageLoadEvent=angular.copy(PDLEVENT.pageLoad);pdlStorage.currentIcids=[],pageLoadEvent.attributes&&(pageLoadEvent.attributes.dynamicContent="",pageLoadEvent.attributes.icidList=pdlStorage.currentIcids,pageLoadEvent.attributes.userEngagementTool=tradeInData.userEngagementTool),pdlStorage.pageLoadEvent=pageLoadEvent,$window.digitalData.pageInfo={},$window.digitalData.pageInfo.pageName=tradeInData.pageName,$window.digitalData.pageInfo.pageTitle=tradeInData.pageTitle,pushEvent(pageLoadEvent)}function callProductSwatchEvent(colorData){setProductSwatchEvent(colorData),triggerEvent(pdlConstant.TRIGGER_BASIC_EVENT)}function callMemorySwatchEvent(memoryData){setMemorySwatchEvent(memoryData),triggerEvent(pdlConstant.TRIGGER_BASIC_EVENT)}function callDynamicClickEventFromPdl(element,attrs,type){var typeAttrs,clickEvents,pageTitle,authorValue=globalValue.authorValue;typeAttrs=commonUtils.searchJson(authorValue,"page.pdl.clickAttributes"),clickEvents=commonUtils.searchJson(authorValue,"page.pdl.clickEvents"),pageTitle=commonUtils.searchJson(authorValue,"page.pageTitle"),"SmartCart"===pageTitle&&(pdlStorage.currentIcids=lodash.map($window.document.querySelectorAll("[data-icid]"),"dataset.icid"));var icidListToAssignCheckoutData=commonUtils.searchJson(authorValue,"page.pdl.icidListToAssignCheckoutData");if(typeAttrs||clickEvents||(typeAttrs=commonUtils.searchJson(authorValue,"rootPage.pdl.clickAttributes"),clickEvents=commonUtils.searchJson(authorValue,"rootPage.pdl.clickEvents"),icidListToAssignCheckoutData=commonUtils.searchJson(authorValue,"rootPage.pdl.icidListToAssignCheckoutData")),typeAttrs&&clickEvents){typeAttrs=typeAttrs[type],clickEvents=clickEvents[type];var attrIdentifierValue,linkObject;angular.forEach(typeAttrs,function(v,k){if(!attrs[v]||!(attrs[v].indexOf("(")>-1||attrs[v].indexOf(")")>-1)){var clickJson=commonUtils.searchJson(clickEvents,'[?(@.elementAttribute=="'+attrs[v]+'")]');attrs[v]&&!attrIdentifierValue&&clickJson&&(attrIdentifierValue=attrs[v],linkObject=angular.copy(clickJson),delete linkObject.elementAttribute,pdlStorage.isStillListingIcids=!0,"SmartCart"===pageTitle||_.includes(pdlStorage.currentIcids,linkObject.icid)||linkObject.icid&&pdlStorage.currentIcids.push(linkObject.icid),element.bind("click",function(){_.includes(icidListToAssignCheckoutData,linkObject.icid)&&setCheckOutIntoDigitalData(),angular.equals(linkObject.clickType,"dynamic")?setDynamicClickEvent(linkObject):angular.equals(linkObject.clickType,"navigation")?setNavClickEvent(linkObject):angular.equals(linkObject.clickType,"linkClick")&&setLinkClickEvent(linkObject),triggerEvent(pdlConstant.TRIGGER_BASIC_EVENT)}))}})}}function callTradeInModalCloseEvent(tradeinVal){var modalCloseEvent={eventInfo:{eventAction:"close",eventType:"modal",timestamp:new Date},attributes:{modalID:"",dynamicContent:"",icidList:pdlStorage.currentIcids,userEngagementTool:tradeinVal.userEngagementTool,modalName:tradeinVal.modalName}};$window.digitalData.events.push(modalCloseEvent),triggerEvent(pdlConstant.TRIGGER_BASIC_EVENT)}function callMixedMediaClickEvent(ctaName){var event={eventInfo:{eventAction:pdlConstant.EVENT_ACTION.CLICK,eventType:pdlConstant.EVENT_TYPE.CLICK_TO_ACTION},attributes:{type:pdlConstant.EVENT_ATTRIBUTES.NAVIGATION},eventDescription:{ctaName:ctaName,targetUrl:$location.absUrl()}};$window.digitalData.events.push(event),triggerEvent(pdlConstant.TRIGGER_BASIC_EVENT)}function CTANavOrClickEvent(ctaName,targetUrl,isNav,btnType,assetType,attribute,modalName,storeId){var type="";type=btnType&&"call"===btnType?isNav?pdlConstant.EVENT_TYPE.CLICK_TO_NAVIGATE:pdlConstant.EVENT_TYPE.CLICK_TO_CALL:isNav?pdlConstant.EVENT_TYPE.CLICK_TO_NAVIGATE:pdlConstant.EVENT_TYPE.CLICK_TO_ACTION;var asset=assetType||"",target=targetUrl||"",event={eventInfo:{eventAction:pdlConstant.EVENT_ACTION.CLICK,eventType:type,timeStamp:(new Date).toString()},eventDescription:{ctaName:ctaName,targetUrl:target,assetType:asset,icid:"",modalName:modalName||""},category:{eventCategory:pdlConstant.EVENT_CATEGORY.CLICK},attributes:{}};storeId&&(event.eventDescription.storeID=storeId),isRequiredModalExist(modalName)?event.attributes={dynamicContent:""}:lodash.isNull(attribute)?delete event.attributes:event.attributes={type:angular.isDefined(attribute)?attribute:pdlConstant.EVENT_ATTRIBUTES.NAVIGATION},$window.digitalData.events.push(event),triggerEvent(pdlConstant.TRIGGER_BASIC_EVENT)}function setSLPageLoadEvent(data){urlData=lodash.isString(data)?angular.fromJson(data.replace(/\'/g,'"')):angular.fromJson(data)||""}function setSearchPageLoadEvent(searchInput,resultCount,searchResultData){$window.digitalData.page.pageInfo.pageName="Find A Store",$window.digitalData.page.pageInfo.pageURL=$location.absUrl(),$window.digitalData.page.category.primaryCategory="Store Locator",$window.digitalData.page.category.subCategory="",digitalData.page.pageInfo.dynamicValue="Search Result Quantity | "+resultCount;var event={eventInfo:{eventAction:"load",eventType:"page",timeStamp:(new Date).toString()},attributes:{icidList:[],searchTerm:""}};searchResultData&&(event.store={search:searchResultData}),$window.digitalData.events.push(event),triggerEvent(pdlConstant.EVENT_ACTION.PAGE_LOAD)}function richTextLinkClick(event){$window.digitalData.events.push(event),triggerEvent(pdlConstant.TRIGGER_BASIC_EVENT)}function setGetInLinePageLoadEvent(modalObject){$window.digitalData.page.pageInfo.pageName="Get In Line",$window.digitalData.page.pageInfo.pageURL=$location.absUrl(),$window.digitalData.page.category.primaryCategory="Store Locator",$window.digitalData.page.category.subCategory="","Confirmation"==modalObject.modalName&&($window.digitalData.page.pageInfo.pageName="Confirmation",$window.digitalData.page.category.subCategory="Get In Line");var event={eventInfo:{eventAction:"load",eventType:"page",timeStamp:(new Date).toString()},attributes:{icidList:[],searchTerm:""}};modalObject.storeId&&(event.store={storeID:modalObject.storeId}),$window.digitalData.events.push(event),triggerEvent(pdlConstant.EVENT_ACTION.PAGE_LOAD)}function setFormCompleteEvent(formName,modalName,reason,transectionId,storeId,appointmentType){var eventCategory=angular.equals(formName,pdlConstant.FORM_NAME.APPOINTMENT_FORM)?pdlConstant.EVENT_CATEGORY.APPOINTMENT:"",event={eventInfo:{eventAction:pdlConstant.EVENT_ACTION.CLICK,eventType:pdlConstant.EVENT_TYPE.FORM_COMPLETE},attributes:{type:pdlConstant.EVENT_ATTRIBUTES.NAVIGATION},category:{eventCategory:eventCategory},eventDescription:{formName:formName||"",userSelection:reason||"",modalName:modalName||"",transId:transectionId||"",storeID:storeId||"",apntType:appointmentType||""}};const lastIndex=$window.digitalData.events.map(function(data){return data.eventInfo.eventAction===pdlConstant.EVENT_ACTION.LOAD&&data.eventInfo.eventType!==pdlConstant.EVENT_TYPE.MODAL&&data.attributes&&data.attributes.stepName!==pdlConstant.EVENT_ATTRIBUTES.STEP_NAME.LoadingCreditCheck}).lastIndexOf(!0);var eventLength=$window.digitalData.events.length;if(eventLength>1)for(var i=lastIndex+1;eventLength>i;i++)if($window.digitalData.events[i].eventInfo.eventType==pdlConstant.EVENT_TYPE.FORM_START){$window.digitalData.events.push(event),triggerEvent(pdlConstant.CLICK_EVENT);break}}function CTAClickEvent(ctaName,targetUrl,modalName,formName,dateData,storeId){var event={eventInfo:{eventAction:pdlConstant.EVENT_ACTION.CLICK,eventType:pdlConstant.EVENT_TYPE.CLICK_TO_NAVIGATE},attributes:{type:pdlConstant.EVENT_ATTRIBUTES.NAVIGATION},eventDescription:{ctaName:ctaName,targetUrl:targetUrl,modalName:modalName,formName:formName,userSelection:dateData}};storeId&&(event.eventDescription.storeID=storeId),$window.digitalData.events.push(event),triggerEvent(pdlConstant.TRIGGER_BASIC_EVENT)}function setGenericCTAorLinkEvent(clickData){var pdlEventData={eventInfo:{eventType:pdlConstant.EVENT_TYPE.CLICK_TO_NAVIGATE,eventAction:pdlConstant.EVENT_ACTION.CLICK},category:{eventCategory:pdlConstant.EVENT_CATEGORY.CLICK}};pdlEventData.eventDescription=clickData.description,pushEvent(pdlEventData)}function formNavorCTAClick(formClickData){var formClickEvent={eventInfo:{eventType:pdlConstant.EVENT_TYPE.CLICK_TO_NAVIGATE,eventAction:pdlConstant.EVENT_ACTION.CLICK},attributes:{type:formClickData.isClick?pdlConstant.EVENT_TYPE.CLICK_TO_ACTION:pdlConstant.EVENT_ATTRIBUTES.NAVIGATION},eventDescription:{ctaName:formClickData.ctaName,targetUrl:formClickData.targetUrl?formClickData.targetUrl:$location.absUrl(),modalName:formClickData.modalName}};angular.isDefined(formClickData.formName)&&(formClickEvent.eventDescription.formName=formClickData.formName),angular.isDefined(formClickData.userSelection)&&(formClickEvent.eventDescription.userSelection=formClickData.userSelection),"N/A"===formClickEvent.eventDescription.targetUrl&&(formClickEvent.eventDescription.targetUrl=""),formClickData.storeId&&(formClickEvent.eventDescription.storeID=formClickData.storeId),pushEvent(formClickEvent),triggerEvent(pdlConstant.TRIGGER_BASIC_EVENT)}function orderInStoreFormComplete(pdlData){var formCompleteEvent={eventInfo:{eventType:pdlConstant.EVENT_TYPE.FORM_COMPLETE,eventAction:pdlConstant.EVENT_ACTION.CLICK},category:{eventCategory:"carttoretail"},eventDescription:{formName:pdlData.formName,modalName:pdlData.modalName,transId:pdlData.transId}};pushEvent(formCompleteEvent),triggerEvent(pdlConstant.TRIGGER_BASIC_EVENT)}function applyStoreFilterCTAEvent(pdlData){var applyCtaEventData={eventInfo:{eventType:pdlConstant.EVENT_ACTION.CLICK,eventAction:pdlData.assetType},eventDescription:{assetType:pdlData.assetType,formName:pdlData.formName,modalName:pdlData.modalName,sortName:pdlData.sortName}};pushEvent(applyCtaEventData),triggerEvent(pdlConstant.TRIGGER_BASIC_EVENT)}function applyStoreFilterEvent(pdlData){var applyCtaEventData={eventInfo:{eventType:pdlConstant.EVENT_ACTION.CLICK,eventAction:pdlConstant.EVENT_ACTION.FILTER},eventDescription:{assetType:pdlData.assetType,filterName:pdlData.filterName}};pushEvent(applyCtaEventData),triggerEvent(pdlConstant.TRIGGER_BASIC_EVENT)}function storeLocatorModalLoadEvent(modalName){var SLmodalLoadEvent=angular.copy(PDLEVENT.storeLocatorModalLoad);SLmodalLoadEvent.attributes={modalID:modalName+"_ID",modalName:modalName},pushEvent(SLmodalLoadEvent),triggerEvent(SLmodalLoadEvent.TRIGGER_BASIC_EVENT)}function storeLocatorModalCloseEvent(modalName){var SLmodalCloseEvent=angular.copy(PDLEVENT.storeLocatorModalClose);SLmodalCloseEvent.attributes={modalID:modalName+"_ID",modalName:modalName},pushEvent(SLmodalCloseEvent),triggerEvent(SLmodalCloseEvent.TRIGGER_BASIC_EVENT)}function orderInStoreFormStartEvent(formData){var formStartEventData={eventInfo:{eventType:pdlConstant.EVENT_TYPE.FORM_START,eventAction:pdlConstant.EVENT_ACTION.CLICK},eventDescription:{formName:formData.formName,modalName:formData.modalName}};pushEvent(formStartEventData),triggerEvent(pdlConstant.TRIGGER_BASIC_EVENT)}function setSLStoreDetailsPageLoadEvent(modalObject){$window.digitalData.page.pageInfo.pageName=modalObject.modalName,$window.digitalData.page.pageInfo.pageURL=$location.absUrl(),$window.digitalData.page.category.primaryCategory="Store Locator",$window.digitalData.page.category.subCategory="Store Details";var event={eventInfo:{eventAction:pdlConstant.EVENT_ACTION.LOAD,eventType:pdlConstant.EVENT_TYPE.PAGE,timeStamp:(new Date).toString()},attributes:{icidList:[]}};modalObject.storeId&&(event.store={storeID:modalObject.storeId}),$window.digitalData.events.push(event),triggerEvent(pdlConstant.EVENT_ACTION.PAGE_LOAD)}function setAppointmentPageLoadOrCloseEvent(modal){var modalObject;modalObject=lodash.isString(modal)?angular.fromJson(modal.replace(/\'/g,'"')):angular.fromJson(modal),$window.digitalData.page.pageInfo.pageName=modalObject.modalName,$window.digitalData.page.pageInfo.pageURL=$location.absUrl(),$window.digitalData.page.category.primaryCategory="Store Locator",$window.digitalData.page.category.subCategory="Appointment",$window.digitalData.page.category.pageType="Store Locator",$window.digitalData.page.pageInfo.timeStamp=(new Date).toString();var event={eventInfo:{eventAction:pdlConstant.EVENT_ACTION.LOAD,eventType:pdlConstant.EVENT_TYPE.PAGE,timeStamp:(new Date).toString()},attributes:{icidList:[]}};modalObject.storeId&&(event.store={storeID:modalObject.storeId}),$window.digitalData.events.push(event),triggerEvent(pdlConstant.EVENT_ACTION.PAGE_LOAD)}function loadProductReviewsEvent(reviewAnalytics){if(reviewAnalytics)pushEvent(angular.copy(PDLEVENT.reviewsLoad)),triggerEvent(pdlConstant.EVENT_ACTION.CLICK);else if("true"!==$cookies.get("reviewsCaptured")){var loadReviewsEvent=angular.copy(PDLEVENT.reviewsLoad);pushEvent(loadReviewsEvent),triggerEvent(pdlConstant.EVENT_ACTION.CLICK),$cookies.put("reviewsCaptured","true")}}function isRequiredModalExist(modalName){return pdlConstant.MODAL_NAMES.indexOf(modalName)>-1}function setDefaultServiceDataObject(isDefaultServiceSelected,familyName,lineNo,type){
_self.defaultServiceData.isDefaultServiceSelected=isDefaultServiceSelected,_self.defaultServiceData.familyName=familyName,_self.defaultServiceData.lineNumber=lineNo,_self.defaultServiceData.type=type}var urlData,_self=this,$window=commonServices.$window,$timeout=commonServices.$timeout,$stateParams=commonServices.$stateParams,$cookies=commonServices.$cookies,$log=commonServices.$log,$location=commonServices.$location,$filter=commonServices.$filter,$compile=commonServices.$compile,$interval=commonServices.$interval,isDeviceRemoved=!1,cartRemoveProducts=[],previousCartData=null,pdlStorage={},isDuplicateEvent=!1,isUpdateClicked=!1,defaultServiceData={isDefaultServiceSelected:!1,familyName:"",lineNumber:"",type:""},fromUno=commonStorage.getFromSharedCookie("sku")?!0:!1,defaultDeviceData={isDeviceSelected:!1,lineNumber:"",lineType:""};return pdlStorage.currentIcids=[],pdlStorage.idleTimeListingIcid=0,_self={initDigitalData:initDigitalData,callPageLoadEvent:setPageData,callPdlClickForRemoveTradeIn:callPdlClickForRemoveTradeIn,callCartAddEvent:callCartAddEvent,callCartRemoveEvent:callCartRemoveEvent,callDynamicClickEvent:callDynamicClickEvent,callCheckOutStepEvent:callCheckOutStepEvent,setCheckOutData:pdlBridge.assignCheckOutToDigitalData,callCheckOutStepPersonalInfoEvent:callCheckOutStepPersonalInfoEvent,callModalLoadEvent:callModalLoadEvent,callCreditEstimationEvent:callCreditEstimationEvent,callClickToCallEvent:callClickToCallEvent,callCallMeNowEvent:callCallMeNowEvent,processCartDataAndEvent:processCartDataAndEvent,setSPAPageDataAndEvent:setSPAPageDataAndEvent,setCartData:setCartObject,callErrorEvent:callErrorEvent,callDynamicClickEventFromPdl:callDynamicClickEventFromPdl,callNavigationClickEvent:callNavigationClickEvent,callNudgeModalEvent:callNudgeModalEvent,clearIcidList:clearIcidList,callFormDataEvent:callFormDataEvent,callPDPLoadEvent:callPDPLoadEvent,callToggleCheckEvent:callToggleCheckEvent,getTrackableCheckBoxNames:getTrackableCheckBoxNames,setPLPFilterAndSortOptions:setPLPFilterAndSortOptions,callProductSwatchEvent:callProductSwatchEvent,callToolTipEvent:callToolTipEvent,callRetrieveCartEvent:callRetrieveCartEvent,setDynamicClickEvent:setDynamicClickEvent,setNavClickEvent:setNavClickEvent,setSaveCartEvent:setSaveCartEvent,setPageLoadDataForTradeIn:setPageLoadDataForTradeIn,setPdlForClickTradeIn:setPdlForClickTradeIn,setPdlForTradeInDeviceClick:setPdlForTradeInDeviceClick,setCommonPageLoad:setCommonPageLoad,setTradeInPageLoadEvent:setTradeInPageLoadEvent,callPdlClickForSubmitTradeIn:callPdlClickForSubmitTradeIn,callModalCloseEvent:callModalCloseEvent,callTradeInModalCloseEvent:callTradeInModalCloseEvent,callMemorySwatchEvent:callMemorySwatchEvent,callMixedMediaClickEvent:callMixedMediaClickEvent,CTANavOrClickEvent:CTANavOrClickEvent,callPdlClickForSubmitSearch:callPdlClickForSubmitSearch,callPdlEventForBladeClick:callPdlEventForBladeClick,setSLPageLoadEvent:setSLPageLoadEvent,setSearchPageLoadEvent:setSearchPageLoadEvent,setSLStoreDetailsPageLoadEvent:setSLStoreDetailsPageLoadEvent,setGetInLinePageLoadEvent:setGetInLinePageLoadEvent,setFormCompleteEvent:setFormCompleteEvent,CTAClickEvent:CTAClickEvent,richTextLinkClick:richTextLinkClick,callGenericCTAorLinkEvent:callGenericCTAorLinkEvent,setGenericCTAorLinkEvent:setGenericCTAorLinkEvent,orderInStoreFormComplete:orderInStoreFormComplete,setUNavClickEvent:setUNavClickEvent,setMenuNavigationClickPDL:setMenuNavigationClickPDL,applyStoreFilterCTAEvent:applyStoreFilterCTAEvent,storeLocatorModalLoadEvent:storeLocatorModalLoadEvent,storeLocatorModalCloseEvent:storeLocatorModalCloseEvent,formNavorCTAClick:formNavorCTAClick,orderInStoreFormStartEvent:orderInStoreFormStartEvent,setAppointmentPageLoadOrCloseEvent:setAppointmentPageLoadOrCloseEvent,loadProductReviewsEvent:loadProductReviewsEvent,setCartAddEvent:setCartAddEvent,pushEvent:pushEvent,setCartRemoveEvent:setCartRemoveEvent,cartRemoveProducts:cartRemoveProducts,previousCartData:previousCartData,addSimKitIntoEventProducts:addSimKitIntoEventProducts,hasPlanChanged:hasPlanChanged,hasDeviceRemoved:hasDeviceRemoved,triggerEvent:triggerEvent,setCartEventDescriptionData:setCartEventDescriptionData,isDuplicateEvent:isDuplicateEvent,isUpdateClicked:isUpdateClicked,defaultServiceData:defaultServiceData,setModalBackDropCloseEvent:setModalBackDropCloseEvent,setCheckoutErrorEvent:setCheckoutErrorEvent,setCartEventForServiceData:setCartEventForServiceData,setCartEventForService:setCartEventForService,defaultDeviceData:defaultDeviceData,resetdefaultDeviceDataObject:resetdefaultDeviceDataObject,resetDefaultServiceDataObject:resetDefaultServiceDataObject,setDefaultServiceDataObject:setDefaultServiceDataObject,applyStoreFilterEvent:applyStoreFilterEvent,setCheckOutIntoDigitalData:setCheckOutIntoDigitalData}}pdlServiceConstructor.$inject=["PDLEVENT","pdlBridge","pdlConstant","cartStorage","jsonPath","commonUtils","commonServices","globalValue","commonStorage","toggleService"],angular.module("tmobileCore").service("pdlService",pdlServiceConstructor)}(window.angular,window._),function(angular){"use strict";function pdlEventDataConstructor(pdlConstant,PDLEVENT){PDLEVENT.cartAdd={eventInfo:{eventAction:pdlConstant.EVENT_ACTION.CART_ADD,eventType:pdlConstant.EVENT_TYPE.CART},category:{eventCategory:pdlConstant.EVENT_CATEGORY.CART},eventDescription:{}},PDLEVENT.cartSave={eventInfo:{eventAction:pdlConstant.EVENT_ACTION.CART_SAVE,eventType:pdlConstant.EVENT_TYPE.CART},category:{eventCategory:pdlConstant.EVENT_CATEGORY.CART},eventDescription:{}},PDLEVENT.cartRetrieve={eventInfo:{eventAction:pdlConstant.EVENT_ACTION.CART_RETRIEVE,eventType:pdlConstant.EVENT_TYPE.CART},category:{eventCategory:pdlConstant.EVENT_CATEGORY.CART},eventDescription:{}},PDLEVENT.cartRemove={eventInfo:{eventAction:pdlConstant.EVENT_ACTION.CART_REMOVE,eventType:pdlConstant.EVENT_TYPE.CART},category:{eventCategory:pdlConstant.EVENT_CATEGORY.CART},eventDescription:{}},PDLEVENT.modalLoad={eventInfo:{eventAction:pdlConstant.EVENT_ACTION.LOAD,eventType:pdlConstant.EVENT_TYPE.MODAL},attributes:{}},PDLEVENT.modalClose={eventInfo:{eventAction:pdlConstant.EVENT_ACTION.CLOSE,eventType:pdlConstant.EVENT_TYPE.MODAL},attributes:{},category:{eventCategory:pdlConstant.EVENT_CATEGORY.CART}},PDLEVENT.modalNudge={eventInfo:{eventAction:pdlConstant.EVENT_ACTION.LOAD,eventType:pdlConstant.EVENT_TYPE.NUDGE},attributes:{},category:{eventCategory:pdlConstant.EVENT_CATEGORY.NUDGE_LOAD}},PDLEVENT.creditEstimation={eventInfo:{eventAction:pdlConstant.EVENT_ACTION.CREDIT_ESTIMATION,eventType:pdlConstant.EVENT_TYPE.CREDIT},category:{eventCategory:pdlConstant.EVENT_CATEGORY.CREDIT},attributes:{}},PDLEVENT.clickToCall={eventInfo:{eventAction:pdlConstant.EVENT_ACTION.CLICK,eventType:pdlConstant.EVENT_TYPE.CLICK_TO_CALL},category:{eventCategory:pdlConstant.EVENT_CATEGORY.CLICK_TO_CALL},eventDescription:{},attributes:{}},PDLEVENT.dynamicClick={eventInfo:{eventAction:pdlConstant.EVENT_ACTION.CLICK},category:{eventCategory:pdlConstant.EVENT_CATEGORY.CLICK},eventDescription:{},attributes:{}},PDLEVENT.navClick={eventInfo:{eventAction:pdlConstant.EVENT_ACTION.CLICK,eventType:pdlConstant.EVENT_TYPE.NAV_CLICK},category:{eventCategory:pdlConstant.EVENT_CATEGORY.NAV_CLICK},link:{},eventDescription:{},attributes:{}},PDLEVENT.linkClick={eventInfo:{eventAction:pdlConstant.EVENT_ACTION.CLICK,eventType:pdlConstant.EVENT_TYPE.CLICK_TO_ACTION},eventDescription:{}},PDLEVENT.filterSort={eventInfo:{eventAction:pdlConstant.EVENT_ACTION.CLICK,eventType:pdlConstant.EVENT_TYPE.CLICK_TO_ACTION},attributes:{},eventDescription:{}},PDLEVENT.pageLoad={eventInfo:{eventAction:pdlConstant.EVENT_ACTION.LOAD,eventType:pdlConstant.EVENT_TYPE.PAGE},attributes:{}},PDLEVENT.searchClick={eventInfo:{eventAction:pdlConstant.EVENT_ACTION.CLICK,eventType:pdlConstant.EVENT_TYPE.SEARCH},category:{eventCategory:pdlConstant.EVENT_CATEGORY.STORE_SEARCH},eventDescription:{},attributes:{}},PDLEVENT.storeLocatorModalLoad={eventInfo:{eventAction:pdlConstant.EVENT_ACTION.LOAD,eventType:pdlConstant.EVENT_TYPE.MODAL},attributes:{}},PDLEVENT.storeLocatorModalClose={eventInfo:{eventAction:pdlConstant.EVENT_ACTION.CLOSE,eventType:pdlConstant.EVENT_TYPE.MODAL},attributes:{}},PDLEVENT.reviewsLoad={eventInfo:{eventAction:pdlConstant.EVENT_ACTION.LOAD,eventType:pdlConstant.EVENT_TYPE.REVIEW_RATING},category:{eventCategory:pdlConstant.EVENT_CATEGORY.REVIEW_RATING}}}pdlEventDataConstructor.$inject=["pdlConstant","PDLEVENT"],angular.module("tmobileCore").run(pdlEventDataConstructor)}(angular),function(angular){"use strict";angular.module("tmobileCore").value("PDLEVENT",{})}(angular),function(angular,lodash){"use strict";function pdlBridgeConstructor(pdlConstant,$location,$log,globalConfig,globalValue,$window,commonUtils,cartStorage,$state,toggleService){function createProduct(productdata){var product={id:"",name:"",type:"NA",subType:"",accountType:"NA",price:{dueToday:parseFloat("0"),dueMonthly:parseFloat("0")},attributes:{}},fullPrice="",isProductSubTypeSIMKIT=lodash.get(toggleService.model,"toggles.isProductSubTypeSIMKIT",!1);if(angular.isDefined(productdata.FullPrice)&&(fullPrice=parseFloat(productdata.FullPrice.replace(/\$|,/g,""))),productdata.hasOwnProperty("PlanName"))product.id=productdata.SKU,product.name=productdata.PlanName,product.type="softgood",product.subType="plan",product.accountType="postpay",product.price.fullRetailPrice=fullPrice,product.price.dueToday=productdata.Today_price,product.price.dueMonthly=productdata.Monthly_price,product.attributes={lineNumber:0,SOC:productdata.planSOCs.displayValue};else if(productdata.hasOwnProperty("Memory")&&productdata.hasOwnProperty("pricing")){if(product.id=productdata.SKU,product.name=productdata.Family,product.type="hardgood",product.subType=isProductSubTypeSIMKIT&&(productdata.Family&&productdata.Family.toLowerCase().search("sim starter kit")>-1||productdata.Family.toLowerCase().search("sim kit")>-1)?"SIMKIT":productdata.ProductSubType,product.accountType="postpay",product.itemStatus=productdata.statusValue,product.price.fullRetailPrice=fullPrice,product.price.listRetailPrice=fullPrice,angular.isArray(productdata.pricing)){var selectedCreditVal=cartStorage.getGlobalCheckOutInfo(),creditClass=selectedCreditVal.reviewCart.selectedCreditClass["class"],productPrice=_.find(productdata.pricing,function(creditValue){return pdlConstant.CLASS_LEVEL_MAP[creditClass]===creditValue.creditLevel&&creditValue.type===service.model.financeType});_.isEmpty(productPrice)||(product.price.dueToday=productPrice.payNowAmount.display,product.price.dueMonthly=productPrice.monthlyAmount.display)}else product.price.dueToday=productdata.pricing.Upfront,product.price.dueMonthly=productdata.pricing.Monthly;product.attributes={lineID:"",quantity:1,description:productdata.Description,storage:"",FinanceType:"",availabilityStatus:productdata.InvStatus,lineNumber:"",SKU:productdata.SKU,manufacturer:productdata.Manufacturer,color:productdata.Color,condition:"new",usingEIP:"",EIPmonths:parseFloat("0")}}else if(productdata.hasOwnProperty("productType")&&angular.equals(productdata.productType,"DEVICE")&&!productdata.hasOwnProperty("simKitId")){product.id=productdata.sku,product.name=productdata.familyName,product.type="hardgood",product.subType=isProductSubTypeSIMKIT&&productdata.hasOwnProperty("familyName")&&(productdata.familyName.toLowerCase().search("sim starter kit")>-1||productdata.familyName.toLowerCase().search("sim kit")>-1)?"SIMKIT":productdata.productSubType,product.accountType="postpay",product.itemStatus=productdata.statusValue||"",product.price.fullRetailPrice=productdata.priceDetails.purchasePrice.amount,product.price.dueToday=productdata.payNowPrice.purchasePrice.amount,product.price.listRetailPrice=productdata.payNowPrice.listPrice.amount,product.price.dueMonthly=productdata.monthlyPrice.amount,product.price.discount=productdata.discount||"",product.attributes={lineNumber:0,SKU:productdata.sku,usingEIP:"N/A",productStatus:""},angular.isDefined(product.subType)&&(product.subType=product.subType.toLowerCase());var pdlConfig=globalConfig.pdl.config;pdlConfig||(pdlConfig={MONTHLY:"usingEIP"}),angular.forEach(pdlConfig,function(value,key){product.attributes[value]=!1});var usingAttr=pdlConfig[productdata.pricingOption];usingAttr&&(product.attributes[usingAttr]=!0),product.attributes.usingEIP&&(product.attributes.EIPMonths=productdata.monthlyPrice.termMonths),product.attributes.usingClub&&(product.attributes.clubLevel=productdata.clubTier)}else lodash.get(toggleService.model,"toggles.isPDLEventEnabledForDataSoc",!1)&&productdata.hasOwnProperty(pdlConstant.PRODUCT_SUBTYPE_TEXT)&&angular.equals(productdata.productSubType,pdlConstant.DATA_SOC_TEXT)?(product.id=productdata.dataOptions.soc,product.name=productdata.dataOptions.displayName,product.type=pdlConstant.PRODUCT_TYPE.softgood,product.subType=pdlConstant.PRODUCT_SUBTYPE.SERVICE,product.accountType=pdlConstant.ACCOUNT_TYPE_POSTPAID,product.price.fullRetailPrice="",product.price.listRetailPrice="",product.price.dueToday="",product.price.dueMonthly=productdata.dataOptionsPrice.salePrice.amount,product.price.discount="",product.attributes={lineNumber:productdata.dataOptions.lineNumber||"",SKU:"",SOC:productdata.dataOptions.soc,usingEIP:"",EIPmonths:"",productStatus:""}):productdata.hasOwnProperty("productType")&&(angular.equals(productdata.productType,"Plan")||angular.equals(productdata.productType,"PLAN"))?(product.name=productdata.planName,product.type="softgood",product.subType="plan",product.accountType="postpay",product.price.dueToday=productdata.payNowPrice.purchasePrice.amount,product.price.dueMonthly=productdata.monthlyPrice.amount,product.price.fullRetailPrice="",product.price.listRetailPrice="",product.price.discount="",angular.isDefined(productdata.dataOptions)&&(product.id=productdata.planId,product.attributes={lineNumber:0,SOC:productdata.planId,usingEIP:"",productStatus:"",EIPMonths:""})):productdata.hasOwnProperty("productType")&&angular.isDefined(productdata.productType)&&angular.equals(productdata.productType.toLowerCase(),"service")||productdata.hasOwnProperty("offerType")&&angular.isDefined(productdata.offerType)&&angular.equals(productdata.offerType.toLowerCase(),"service")?(product.id=_.get(productdata,"serviceId",""),product.name=_.get(productdata,"serviceName",""),product.type="softgood",product.subType="service",product.accountType="postpay",product.price.fullRetailPrice=angular.equals(productdata.offerType.toLowerCase(),"service")?"":_.get(productdata,"payNowPrice.listPrice.amount",""),product.price.dueToday=angular.equals(productdata.offerType.toLowerCase(),"service")?"":_.get(productdata,"payNowPrice.purchasePrice.amount",""),product.price.dueMonthly=_.get(productdata,"monthlyPrice.amount",""),product.attributes={lineNumber:_.get(productdata,"lineNumber",0),SOC:_.get(productdata,"serviceId","")},angular.equals(productdata.offerType.toLowerCase(),"service")&&(product.price.listRetailPrice="",product.price.discount="",product.attributes.usingEIP="",product.attributes.EIPMonths="",product.attributes.productStatus="")):productdata.hasOwnProperty("simKitId")?(product.id=productdata.simKitId,product.name=productdata.simKitName,product.type="hardgood",product.subType="SIMKIT",product.accountType="postpay",product.itemStatus=productdata.statusValue,product.price.fullRetailPrice=productdata.priceDetails.listPrice.amount,product.price.dueToday=productdata.priceDetails.purchasePrice.amount,product.attributes={lineNumber:0,SKU:productdata.simKitId,manufacturer:_.get(productdata,"manufacturer",""),color:_.get(productdata,"color",""),condition:"new",usingEIP:"",EIPMonths:""}):angular.equals(productdata.productType,"ACCESSORY")||angular.equals(productdata.accessoryType,"ACCESSORY")?(product.id=productdata.sku,product.name=productdata.familyName,product.type="hardgood",product.subType="accessories",product.accountType="postpay",product.price.fullRetailPrice=_.get(productdata,"priceDetails.purchasePrice.amount",""),product.price.listRetailPrice=_.get(productdata,"priceDetails.listPrice.amount",""),product.price.discount="",product.price.dueToday=productdata.payNowPrice.purchasePrice.amount,product.price.dueMonthly=productdata.monthlyPrice.amount,product.itemStatus=_.get(productdata,"statusValue",""),product.attributes={SKU:productdata.sku,manufacturer:_.get(productdata,"manufacturer",""),color:_.get(productdata,"color",""),condition:"new",usingEIP:"",EIPMonths:""}):productdata.hasOwnProperty("imageArray")?(product.id=productdata.SKU,product.name=productdata.Family,product.type="hardgood",product.subType="accessories",product.price.fullRetailPrice=fullPrice,product.price.dueToday=productdata.UpFront,product.price.dueMonthly=productdata.UpFront,product.attributes={SKU:productdata.SKU,manufacturer:productdata.Manufacturer,color:productdata.color,condition:"new",usingEIP:"N/A",EIPmonths:parseFloat("0")}):productdata.hasOwnProperty("SKU")&&angular.equals(productdata.SKU,"SIM_KIT_BYOD")&&(product.id="SIM_KIT_BYOD",product.name=productdata.Family,product.type="hardgood",product.subType="SIMKIT",product.accountType="postpay",product.itemStatus=productdata.statusValue,product.price.fullRetailPrice=fullPrice,product.price.dueToday=parseFloat("0"),product.price.dueMonthly=parseFloat("0"),product.attributes={lineNumber:0,SKU:"SIM_KIT_BYOD",manufacturer:productdata.Manufacturer,color:productdata.color,condition:"new",usingEIP:"N/A",EIPmonths:parseFloat("0")});if(productdata&&productdata.promotions){var promos=[];angular.forEach(productdata.promotions,function(value,key){var promo={code:value.promoCode,name:value.promoTitle,description:value.description};angular.isDefined(value.promoCode)&&promos.push(promo)}),promos.length>0&&(product.promo=promos)}return commonUtils.transformByMap("pdlCreateProduct",productdata,product),product}function setPageObject(pageInfo){pageInfo.pageTitle=document.title,pageInfo.pageName=$window.location.pathname.substring($window.location.pathname.lastIndexOf("/")+1),pageInfo.domain=$window.location.hostname,pageInfo.language=navigator.language}function setCartDataObject(cartObject){var cart=$window.digitalData.cart,user=$window.digitalData.user,lineproducts=[],products=[];$log.log("pdlBridge.assignCartToDigitalData::",cartObject),angular.forEach(cartObject.lineItems,function(lineItem){var device=null,devicePrice=null,plan=null,services=null,simKit=null;if(lineItem.lineItemDetails.deviceDetails.isProductAdded&&(device=createProduct(lineItem.lineItemDetails.deviceDetails),cart.deviceDownPaymentRequired||(devicePrice=lineItem.lineItemDetails.deviceDetails.payNowPrice.purchasePrice,devicePrice>0&&(cart.deviceDownPaymentRequired=!0)),void 0===lineItem.tradeInDetails?device.tradeInDetails={tradeInType:"No Trade-in"}:lineItem.tradeInDetails&&(lineItem.isTradeInPromoFlow||lineItem.isTradeInStandardFlow)&&(device.tradeInDetails={},device.tradeInDetails.tradeInId=lineItem.tradeInDetails.tradeInId,device.tradeInDetails.tradeInType=lineItem.tradeInDetails.tradeInType,device.tradeInDetails.tradeInPrice={listPrice:{amount:_.get(lineItem,"tradeInDetails.tradeInPrice.listPrice.amount","")},salePrice:{amount:_.get(lineItem,"tradeInDetails.tradeInPrice.salePrice.amount","")}}),device.attributes.lineNumber=lineItem.lineNo,device.attributes.lineID=_.get(lineItem,"lineId",""),lineproducts.push(device)),lineItem.lineItemDetails.planDetails.isProductAdded){var planDetails=lineItem.lineItemDetails.planDetails;plan=createProduct(planDetails),plan.attributes.lineNumber=lineItem.lineNo,plan.attributes.lineID=_.get(lineItem,"lineId",""),lineproducts.push(plan);var dataOptionObject=planDetails.dataOptions;if(lodash.get(toggleService.model,"toggles.isPDLEventEnabledForDataSoc",!1)&&angular.isDefined(dataOptionObject)&&dataOptionObject["default"]===!1){planDetails.productSubType=pdlConstant.DATA_SOC_TEXT;var dataOption=createProduct(planDetails);dataOption.attributes.lineNumber=lineItem.lineNo,dataOption.attributes.lineID=_.get(lineItem,"lineId",""),lineproducts.push(dataOption),delete planDetails.productSubType}}services=lineItem.lineItemDetails.serviceDetails,angular.forEach(services,function(service){var serviceItem=null;service.isProductAdded&&(serviceItem=createProduct(service),serviceItem.attributes.lineNumber=lineItem.lineNo,serviceItem.attributes.lineID=_.get(lineItem,"lineId",""),lineproducts.push(serviceItem))}),lineItem.simKitDetails.isProductAdded&&(simKit=createProduct(lineItem.simKitDetails),simKit.attributes.lineNumber=lineItem.lineNo,simKit.attributes.lineID=_.get(lineItem,"lineId",""),lineproducts.push(simKit)),products.push(lineproducts)}),cart.price.promo=[],angular.forEach(cartObject.promotions,function(promo){cart.price.promo.push({code:promo.promoCode,name:promo.promoTitle,description:promo.promoDescription})}),angular.forEach(cartObject.accessories.accessoryDetails,function(value){var accessory=createProduct(value);lineproducts.push(accessory)}),cart.product=lineproducts,cartObject.lineItems&&(cart.lineCount=cartObject.lineItems.length),cartObject.refundableDesposit.amount>0&&(cart.lineDepositRequired=!0),cart.price.subtotal={dueToday:_.get(cartObject,"subTotalPayNowPrice.amount",""),dueMonthly:_.get(cartObject,"subTotalMonthlyPrice.amount","")},cart.price.total={dueToday:_.get(cartObject,"totalPayNowPrice.amount",""),dueMonthly:_.get(cartObject,"totalMonthlyPrice.amount","")},cartObject.selectedCreditClass&&"creditClass3"===cartObject.selectedCreditClass["class"]&&(cart.price.subtotal.dueTodayBreakdown={refundable:cartObject.refundableDesposit.amount,nonRefundable:parseFloat((cartObject.subTotalPayNowPrice.amount-cartObject.refundableDesposit.amount).toFixed(2))},cart.price.total.dueTodayBreakdown={refundable:cartObject.refundableDesposit.amount,nonRefundable:parseFloat((cartObject.subTotalPayNowPrice.amount-cartObject.refundableDesposit.amount).toFixed(2))}),cartObject.selectedCreditClass&&(cart.creditLevel=pdlConstant.EVENT_ATTRIBUTES.CREDIT_LEVEL[cartObject.selectedCreditClass["class"]]),cartObject.tradeInType&&(cart.tradeInType=cartObject.tradeInType),lodash.get(toggleService.model,"toggles.isTPPON",!1)&&(user.credit=cartStorage.getPriceIndicator()||""),commonUtils.transformByMap("pdlSetCartObject",cartObject,cart),commonUtils.transformByMap("pdlSetCartObject",cartObject,user)}function setCheckOutObject(checkOutObject){var cart=$window.digitalData.cart,customer=$window.digitalData.customer,user=$window.digitalData.user;if(checkOutObject){var selectedMethod=commonUtils.searchJson(checkOutObject.initData.selectedShippingOptions,'[?(@.selected== true || @.selected== "true" )]'),methodName="";selectedMethod&&(methodName=selectedMethod.name),cart.currentCarrier=checkOutObject.personalInfo.carrier,cart.shipping={method:methodName,address:{city:checkOutObject.shipInfo.city,stateProvince:checkOutObject.shipInfo.state,postalCode:checkOutObject.shipInfo.zip,country:"US"}},cart.billing={paymentType:"via",address:{city:checkOutObject.billInfo.city,stateProvince:checkOutObject.billInfo.state,postalCode:checkOutObject.billInfo.zip,country:"US"}},cart.price.taxesFees={dueToday:isNaN(checkOutObject.subTotal.tax.total.amount)?0:checkOutObject.subTotal.tax.total.amount,dueMonthly:0},cart.price.shippingFee={dueToday:isNaN(checkOutObject.subTotal.shippingFee.amount)?0:checkOutObject.subTotal.shippingFee.amount},cart.price.total={dueToday:isNaN(checkOutObject.total.payNowPrice.amount)?0:checkOutObject.total.payNowPrice.amount,dueMonthly:isNaN(checkOutObject.total.monthlyPrice.amount)?0:checkOutObject.total.monthlyPrice.amount},angular.isUndefined(checkOutObject.reviewCart.selectedCreditClass)?checkOutObject.reviewCart.selectedCreditClass={"class":"creditClass1"}:checkOutObject.reviewCart.selectedCreditClass,"creditClass3"===checkOutObject.reviewCart.selectedCreditClass["class"]&&(cart.price.subtotal.dueTodayBreakdown={refundable:checkOutObject.reviewCart.refundableDesposit.amount,nonRefundable:parseFloat((checkOutObject.reviewCart.subTotalPayNowPrice.amount-checkOutObject.reviewCart.refundableDesposit.amount).toFixed(2))},cart.price.total.dueTodayBreakdown={refundable:checkOutObject.reviewCart.refundableDesposit.amount,nonRefundable:parseFloat((checkOutObject.reviewCart.payNowPrice.amount-checkOutObject.reviewCart.refundableDesposit.amount).toFixed(2))}),lodash.get(toggleService.model,"toggles.isTPPON",!1)&&(user.credit=cartStorage.getPriceIndicator()||""),commonUtils.transformByMap("pdlSetCheckOutObject",checkOutObject,cart),commonUtils.transformByMap("pdlPersonalInfoCheckOutObject",checkOutObject,customer),commonUtils.transformByMap("pdlPersonalInfoCheckOutObject",checkOutObject,user)}}function setPageDataObject(){function getContent(key){var value=_.find(metaDatas,{name:key});return angular.isDefined(value)&&value.length>0?value.content:""}var metaDatas=[],x=document.getElementsByTagName("meta"),metaData=null,pageInfo=$window.digitalData.page.pageInfo,i=0;for(i=0;i<x.length;i++)metaData={name:x[i].getAttribute("name"),content:x[i].getAttribute("content")},metaDatas.push(metaData);setPageObject(pageInfo),angular.forEach(pageInfo,function(v,k){v=getContent(k),angular.equals("",v)||(pageInfo[k]=v)})}function fetchPrevUrl(){return prevPageUrl}function setSPAPageObject(url){function mapPageInfo(pageProp){pageInfo=$window.digitalData.page.pageInfo,category=$window.digitalData.page.category;var pageObj={};return pageInfo.pageID=pageProp.pageID?pageProp.pageID:"",pageInfo.pageName=pageProp.pageName?pageProp.pageName:"",pageInfo.pageTitle=pageProp.pageTitlePDL?pageProp.pageTitlePDL:"",pageInfo.version=pageProp.version?pageProp.version:"",pageInfo.language=pageProp.language?pageProp.language:"",pageInfo.variant=pageProp.variant?pageProp.variant:"",pageInfo.currencyCode=pageProp.currencyCode?pageProp.currencyCode:"",pageInfo.TFN=pageProp.TFN?pageProp.TFN:"",category.pageType=pageProp.pageType?pageProp.pageType:"",category.primaryCategory=pageProp.primaryCategory?pageProp.primaryCategory:"",category.subCategory=pageProp.subCategory?pageProp.subCategory:"",pageObj.pageInfo=pageInfo,pageObj.category=category,pageObj}var pageInfo={},category={},authorValue=globalValue.authorValue,pdlValue=commonUtils.searchJson(authorValue,"page.pdl");"detail"===$state.current.name&&(pdlValue=commonUtils.searchJson(authorValue,"rootPage.pdl")),pdlValue&&($window.digitalData.page=mapPageInfo(pdlValue),$log.log("pdlBridge:: assignSPAPageDataToDigitalData:pageInfo ",$window.digitalData.page)),pageInfo=$window.digitalData.page.pageInfo,angular.equals("",pageInfo.pageURL)?pageInfo.previousPageURL="":pageInfo.previousPageURL=angular.copy(pageInfo.pageURL),pageInfo.pageURL=$location.absUrl(),prevPageUrl=pageInfo.pageURL,pageInfo.previousPageURL?pageInfo.prevPageName=$window.location.pathname.substring($window.document.referrer.lastIndexOf("/")+2):pageInfo.prevPageName="",pageInfo.responsiveState=$window.navigatorDetect.type()}var service=this;service.model={financeType:""};var prevPageUrl;return{assignCartToDigitalData:setCartDataObject,assignCheckOutToDigitalData:setCheckOutObject,assignPageToDigitalData:setPageDataObject,getProduct:createProduct,assignSPAPageDataToDigitalData:setSPAPageObject,model:service.model,getPrevUrl:fetchPrevUrl}}pdlBridgeConstructor.$inject=["pdlConstant","$location","$log","globalConfig","globalValue","$window","commonUtils","cartStorage","$state","toggleService"],angular.module("tmobileCore").service("pdlBridge",pdlBridgeConstructor)}(angular,_),function(angular){"use strict";function initializePdl($rootScope,$log,$window,pdlService,cartStorage,serviceWorkerService){function setBasicValues(){$window.digitalData.cart.cartID=cartStorage.getCartId()}externalLogger.moduleRun("tmobileCore","pdl.run.js :: initializePdl"),serviceWorkerService.registerServiceWorkerOnHome();$rootScope.$on("$stateChangeSuccess",function(event,next){serviceWorkerService.postMessageonStateChange(),$log.log("pdl::$stateChangeSuccess next url ",next.url),$log.log("pdl::$stateChangeSuccess ::: clearIcidList"),pdlService.clearIcidList(),angular.equals("store-locator",next.name)||angular.equals("detail-preview",next.name)||angular.equals("detail",next.name)||angular.equals("checkOut",next.name)||pdlService.setSPAPageDataAndEvent(next.url)}),$rootScope.$on("pdlLoadCartAndCheckOutData",function(event,data){angular.isUndefined(data.error)&&pdlService.setCartData(data.reviewCart)}),$rootScope.$on("pdlChangesInCartData",function(event,data){$log.log("pdl.run.pdlChangesInCartData :: cart item is changed"),data&&!data.error&&(setBasicValues(),pdlService.processCartDataAndEvent(null,data))});$rootScope.$on("abttPDPSelectingProduct",function(event,data){$log.log("pdl.run.abttPDPProductSelecting :: PDP ",data.SKU),$window.abttData.pdp.sku=data.SKU}),$window.abttData={pdp:{localSku:void 0,skuListeners:[],set sku(sku){this.localSku=sku;for(var i=0;i<this.skuListeners.length;i++)this.skuListeners[i](sku)},get sku(){return this.localSku},onSkuChange:function(listener){this.skuListeners.push(listener)}}}}initializePdl.$inject=["$rootScope","$log","$window","pdlService","cartStorage","serviceWorkerService"],angular.module("tmobileCore").run(initializePdl)}(angular),function(angular){"use strict";angular.module("tmobileCore").constant("pdlConstant",{TRIGGER_BASIC_EVENT:["eventInfo","category","attributes","product","eventDescription"],EVENT_ACTION:{CART_ADD:"cartAdd",CART_SAVE:"cartSave",CART_RETRIEVE:"cartRetrieve",CART_REMOVE:"cartRemove",LOAD:"load",CLOSE:"close",CREDIT_ESTIMATION:"creditEstimation",PAGE_LOAD:"pageLoad",CLICK:"click",SEARCH_INITIATION:"search initiation",SEARCH_RESULT_CLICK:"search result click",ERROR:"error",NUDGE:"nudge",STATE_UPDATE:"stateUpdate",SAVE_MY_CART:"save my cart",FILTER:"filter",MODAL_LOAD:"modalLoad"},EVENT_TYPE:{CART:"cart",PAGE:"page",CHECKOUT_STEP:"checkoutStep",MODAL:"modal",ERROR_MODAL:"errormodal",NUDGE:"nudge",CREDIT:"credit",USER:"user",DYNAMIC:"dynamic",NAV_CLICK:"clickToNavigate",LINK_CLICK:"linkClick",CLICK_TO_CALL:"clickToCall",CLICK_TO_ACTION:"clickToAction",CLICK_TO_NAVIGATE:"clickToNavigate",FORM_START:"form start",FORM_COMPLETE:"form complete",REVIEW_RATING:"review",SEARCH:"search"},EVENT_CATEGORY:{CART:"cart",CREDIT:"credit",CLICK:"click",ERROR:"error",NAV_CLICK:"clickToNavigate",LINK_CLICK:"linkClick",CLICK_TO_CALL:"clickToCall",NUDGE_LOAD:"nudgeLoad",REVIEW_RATING:"review",APPOINTMENT:"appointment",STORE_SEARCH:"storesearch"},EVENT_ATTRIBUTES:{BLADE:"blade",NAVIGATION:"navigation",STEP_NAME:{callmenow:"Call Me Now",personalInfo:"Info & Shipping",personalInfoTPP:"Personal Info",shippingPayment:"Payment & Credit",shippingPaymentTPP:"Shipping & Payment",verifyId:"Verify Id",creditCheck:"Credit Check",noCreditCheck:"No credit check",reviewCart:"Review & Submit",termsCondition:"Terms & Conditions",softOrderConfirm:"Soft Order Confirmation",creditModal:"Credit Modal",selectCreditModal:"Select Credit Modal",tmoOnePlanModal:"TMO One Plan Modal",tmoOneNoCreditPlanModal:"TMO One No Credit Plan Modal",noCreditCheckLearnMoreModal:"NoCreditCheckLearnMoreModal",SkipCreditCheckLearnMoreModal:" Skip Credit Check Learn More Modal",MaxLinesDeviceErrorModal:"Max Lines Device Error Modal",MaxLinesCreditTierSwitchModal:"Max Lines Credit Tier Switch Modal",MaxLinesCreditTierSwitchCartModal:"Max Lines Credit Tier SwitchCart Modal",LoadingCreditCheck:"Loading credit check",ssnLearnmoreModal:"ssn Learn More Modal",offerModalPopup:"Offer Modal Popup"},CREDIT_LEVEL:{creditClass1:"01 prime",creditClass2:"02 subprime",creditClass3:"Skip Credit Check"},ADD_LINE:"Add a line"},CREDIT_TYPES:{AWESOME_CREDIT:"Awesome credit"},PRODUCT_TYPE:{softgood:"softgood",hardgood:"hardgood",accessories:"accessories",service:"Service"},CLASS_LEVEL_MAP:{creditClass1:"GOOD",creditClass2:"BUILDING",creditClass3:"NONE"},NUDGE_DATA:{CART_RETRIEVE_DATA:"Your cart has been retrieved!"},MODALID:{SAVE_CART_ID:"SaveCartID",PRICE_UPDATE_ID:"PriceUpdateID",AUTH_FAIL_MODAL_ID:"AuthFailID",SERVICE_FAIL_MODAL_ID:"ServiceFailID",SSN_MODAL_ID:"ssnLearnMoreID",OFFER_MODAL_POPUP_ID:"OfferModalPopupId",SET_LOCATION_MODAL_ID:"SetLocationModalID"
},MODAL_DATA:{MINI_PDP_MODAL:"Mini PDP Modal",POPULAR_ACCESSORIES_MODAL:"Popular Accessories Modal",BRING_YOUR_OWN_PHONE_MODAL:"Bring Your Own Phone",PRICE_BREAKDOWN_MODAL:"Price Breakdown Modal",PRICE_UPDATE_MODAL:"Price Update",FINALIZE_IN_STORE:"Finalize In Store",FINALIZE_IN_STORE_THANK_YOU:"Finalize In Store Thank You",AUTH_FAIL_MODAL:"Auth Fail Modal",SERVICE_FAIL_MODAL:"Service Fail Modal",SET_LOCATION_MODAL:"Set Location"},CARTOVERRIDE_MODAL_NAME:"cartOverride",PRODUCT_SUBTYPE:{SIMKIT:"SIMKIT",PLAN:"plan",SERVICE:"service"},NA:"NA",ICID:{ADDAPHONE_ICID:"ADDAPHONE_ICID",duplicate_ICID:"duplicate_ICID",REMOVE_ICID:"REMOVE_ICID"},ASSET_TYPE:{LINK:"link",BUTTON:"Button"},CTA_NAME:{DUPLICATE:"Duplicate",CHECKOUT_NOW:"Check Out Now",MODAL_CLOSE:"Close",UPDATE:"Update"},FORM_NAME:{PERSONAL_INFO:"Checkout Personal Info",CREDIT_CHECK:"Checkout Credit Check",VERIFY_ID:"Checkout Verify ID",SHIPPING_PAYMENT:"Checkout Shipping & Payment",REVIEW_SUBMIT_FORM:"Checkout Review and Submit",APPOINTMENT_FORM:"Appointment Form",ORDER_IN_STORE_TO_RETAIL:"Order in store to Retail Form",REQUEST_A_CALL:"Request a call"},PAGE_CATEGORY:{PRIMARY_SHOP:"Shop",SUBCATEGORY_CART:"Cart",PAGETYPE_CHECKOUT:"checkout"},CALL_US_IDS:["callUsCta","callUsLink"],BACK_DROP_MODALS:{tradeInTool:{modalID:"",modalName:"Check Trade-in Value",userEngagementTool:"Device Trade-In"},locationFPOModal:{modalID:"SetLocationModalID",modalName:"Set Location"},priceBreakdownModal:{modalID:"PriceBreakdownModalID",modalName:"Price Breakdown"},callMeNowModal:{modalID:"Call Me Now ModalID",modalName:"Call Me Now"},finalizeInStoreModal:{modalID:"Finalize In StoreID",modalName:"Finalize in Store"},finalizeCartThankYouModal:{modalID:"Finalize In Store Thank YouID",modalName:"Finalize in Store Thank You"},cartOverride:{modalID:"Cart OverrideID",modalName:"Cart Override"},deviceProtectionAndServicesSelectorModalV3:{modalID:"DeviceProtectionServiceModalID",modalName:"Device Protection and Services"}},HTML_ERROR_LENGTH:254,SHIPPING_PAYMENT_ERROR:"Sorry, an error prevented saving your data. Please check your data and retry. If the error still persists, please try reloading the page.",REVIEW_SUBMIT_ERROR:"Sorry, an error prevented submitting your order.",USER_CONSENT:{CALL_ME_NOW:"Call Me Now consent"},ACCOUNT_TYPE_POSTPAID:"postpay",DATA_SOC_TEXT:"DATASOC",PRODUCT_SUBTYPE_TEXT:"productSubType",MODAL_NAMES:["Device Protection and Services"],PRODUCT_PLAN_TYPE:"PLAN",ASSET_TYPES:{CHECKBOX:"checkbox"}})}(angular),function(angular){"use strict";function pdlInputConstructor($timeout,pdlService,commonUtils){return{restrict:"E",link:function(scope,element,attrs){$timeout(function(){var type=element[0].type;if(angular.equals("checkbox",type)){var fieldName=element[0].name,checkBoxNames=pdlService.getTrackableCheckBoxNames(),eventDescription=commonUtils.searchJson(checkBoxNames,'[?(@.name=="'+fieldName+'")].eventDescription');eventDescription&&element.bind("change",function(){element[0].id&&(eventDescription.ctaName=element[0].attributes[1].nodeValue),pdlService.callToggleCheckEvent(fieldName,element[0].checked?"check":"uncheck",eventDescription)})}},500)}}}pdlInputConstructor.$inject=["$timeout","pdlService","commonUtils"],angular.module("tmobileCore").directive("input",pdlInputConstructor)}(window.angular),function(angular){"use strict";function pdlImg($parse,$log,pdlService){function handleDynamicClickEvent(element,attrs,type,isSavingIcid){pdlService.callDynamicClickEventFromPdl(element,attrs,type,isSavingIcid)}return{restrict:"E",link:function(scope,element,attrs){handleDynamicClickEvent(element,attrs,"img",!0)}}}pdlImg.$inject=["$parse","$log","pdlService"],angular.module("tmobileCore").directive("img",pdlImg)}(angular),function(angular){"use strict";function pdlEvent($parse,$log,$timeout,$interval,pdlService,pdlConstant,toggleService){function handleCartEvents(scope,attrs){var cart=null,cartProduct=null;angular.isDefined(attrs.pdlCartObject)&&angular.isDefined(attrs.pdlCartProduct)&&(cart=$parse(attrs.pdlCartObject)(scope),cartProduct=$parse(attrs.pdlCartProduct)(scope),angular.equals(attrs.pdlEvent,pdlConstant.EVENT_ACTION.CART_ADD)&&pdlService.callCartAddEvent(cart,cartProduct))}function handleCheckOutStepEvents(scope,attrs){var checkOutData=null;angular.isDefined(attrs.pdlCheckoutStep)&&(angular.equals(attrs.pdlEvent,pdlConstant.EVENT_TYPE.CHECKOUT_STEP)&&($log.log("pdlEvent ",attrs.pdlEvent,attrs.pdlCheckoutStep),pdlService.callCheckOutStepEvent(pdlConstant.EVENT_ATTRIBUTES.STEP_NAME[attrs.pdlCheckoutStep])),angular.isDefined(attrs.pdlCheckoutData)&&(checkOutData=$parse(attrs.pdlCheckoutData)(scope),pdlService.setCheckOutData(checkOutData)))}function handleCreditEstimationEvent(scope,attrs){var modalData,creditData=null;angular.equals(attrs.pdlEvent,pdlConstant.EVENT_ACTION.CREDIT_ESTIMATION)&&(angular.isDefined(attrs.pdlModalData)&&(modalData=$parse(attrs.pdlModalData)(scope)),angular.isDefined(attrs.pdlCreditData)&&(creditData=$parse(attrs.pdlCreditData)(scope)),pdlService.callCreditEstimationEvent(creditData,modalData,attrs.pdlFamilyData))}function handleClickToCallEvent(scope,attrs){var clickCallData=null;angular.equals(attrs.pdlEvent,pdlConstant.EVENT_ACTION.CLICK)&&angular.isDefined(attrs.pdlClickCallData)&&(clickCallData=$parse(attrs.pdlClickCallData)(scope),pdlConstant.CALL_US_IDS.indexOf(attrs.id)>-1&&updateTfnAndTargetUrl("#"+attrs.id,clickCallData),pdlService.callClickToCallEvent(clickCallData))}function updateTfnAndTargetUrl(elementId,clickCallData){var href=_.get(angular.element(elementId)[0],"firstElementChild.href",":");href.indexOf(":")>0?clickCallData.pdlEvent.tfn=href.split(":")[1]:clickCallData.pdlEvent.tfn=href,clickCallData.pdlEvent.targetUrl=href,clickCallData.pdlEvent.target=clickCallData.pdlEvent.targetUrl?clickCallData.pdlEvent.targetUrl:clickCallData.pdlEvent.target}function handleCallMeEvent(scope,attrs){var callMeData=null;angular.equals(attrs.pdlEvent,pdlConstant.EVENT_ACTION.CLICK)&&angular.isDefined(attrs.pdlCallMeData)&&(callMeData=$parse(attrs.pdlCallMeData)(scope),pdlService.callCallMeNowEvent(callMeData))}function handleToolTipToCallEvent(scope,attrs){var clickCallData=null;angular.equals(attrs.pdlEvent,pdlConstant.EVENT_ACTION.CLICK)&&angular.isDefined(attrs.pdlToolTipCallData)&&(clickCallData=$parse(attrs.pdlToolTipCallData)(scope),pdlService.callToolTipEvent(clickCallData))}function handleNudgeModalEvent(scope,attrs){var nudgeData=null;angular.equals(attrs.pdlEvent,pdlConstant.EVENT_ACTION.NUDGE)&&angular.isDefined(attrs.pdlNudgeData)&&(nudgeData=$parse(attrs.pdlNudgeData)(scope),pdlService.callNudgeModalEvent(nudgeData))}function handleDynamicLinkClickEvent(scope,attrs){var dynamicClickData=null;if(angular.equals(attrs.pdlEvent,pdlConstant.EVENT_ACTION.CLICK)&&angular.isDefined(attrs.pdlDynamicLinkClickData)){if(dynamicClickData=$parse(attrs.pdlDynamicLinkClickData)(scope),angular.isDefined(attrs.pdlValidate)&&"true"===attrs.pdlValidate)return!1;angular.isDefined(scope.accordion)&&(dynamicClickData.collapsed=scope.accordion.collapse),pdlService.callDynamicClickEvent(dynamicClickData)}}function handleNavigationClickEvent(scope,attrs){var navClickData=null;angular.equals(attrs.pdlEvent,pdlConstant.EVENT_ACTION.CLICK)&&angular.isDefined(attrs.pdlNavClickData)&&(navClickData=$parse(attrs.pdlNavClickData)(scope),pdlService.callNavigationClickEvent(navClickData))}function handleCTANavOrClickEvent(scope,attrs){var navClickData=null;angular.equals(attrs.pdlEvent,pdlConstant.EVENT_ACTION.CLICK)&&angular.isDefined(attrs.pdlNavOrClickEvent)&&(navClickData=$parse(attrs.pdlNavOrClickEvent)(scope),pdlService.CTANavOrClickEvent(navClickData.ctaName,navClickData.targetUrl,navClickData.isNav,navClickData.btnType,navClickData.assetType,navClickData.type,navClickData.modalName))}function handleFormCTAClickEvent(scope,attrs){var formClickData=null;angular.isDefined(attrs.pdlFormClickData)&&(formClickData=$parse(attrs.pdlFormClickData)(scope),pdlService.formNavorCTAClick(formClickData))}function handleCheckOutPersonalInfoEvent(scope,attrs){angular.isDefined(attrs.pdlCheckoutStep)&&(angular.equals(attrs.pdlCheckoutStep,"personalInfo")?($log.log("pdlCheckoutStep ",attrs.pdlCheckoutStep),"true"===attrs.istppon?pdlService.callCheckOutStepEvent(pdlConstant.EVENT_ATTRIBUTES.STEP_NAME.personalInfoTPP):pdlService.callCheckOutStepEvent(pdlConstant.EVENT_ATTRIBUTES.STEP_NAME.personalInfo)):angular.equals(attrs.pdlCheckoutStep,"callmenow")&&($log.log("pdlCheckoutStep ",attrs.pdlCheckoutStep),pdlService.callCheckOutStepEvent(pdlConstant.EVENT_ATTRIBUTES.STEP_NAME.callmenow)))}function handleVerifyIdEvent(scope,attrs){angular.isDefined(attrs.pdlCheckoutStep)&&angular.equals(attrs.pdlCheckoutStep,"verifyId")&&($log.log("pdlCheckoutStep ",attrs.pdlCheckoutStep),pdlService.callCheckOutStepEvent(pdlConstant.EVENT_ATTRIBUTES.STEP_NAME.verifyId))}function handleRunCreditCheckEvent(scope,attrs){angular.isDefined(attrs.pdlCheckoutStep)&&angular.equals(attrs.pdlCheckoutStep,pdlConstant.EVENT_ATTRIBUTES.STEP_NAME.LoadingCreditCheck)&&($log.log("pdlCheckoutStep ",attrs.pdlCheckoutStep),pdlService.callCheckOutStepEvent(pdlConstant.EVENT_ATTRIBUTES.STEP_NAME.LoadingCreditCheck))}function handleCheckOutShipingPaymentEvent(scope,attrs){angular.isDefined(attrs.pdlCheckoutStep)&&angular.equals(attrs.pdlCheckoutStep,"shippingPayment")&&($log.log("pdlCheckoutStep ",attrs.pdlCheckoutStep),angular.equals(attrs.istppon,"true")?pdlService.callCheckOutStepEvent(pdlConstant.EVENT_ATTRIBUTES.STEP_NAME.shippingPaymentTPP):pdlService.callCheckOutStepEvent(pdlConstant.EVENT_ATTRIBUTES.STEP_NAME.shippingPayment))}function handleCheckOutCreditCheckEvent(scope,attrs){angular.isDefined(attrs.pdlCheckoutStep)&&angular.equals(attrs.pdlCheckoutStep,"creditCheck")&&($log.log("pdlCheckoutStep ",attrs.pdlCheckoutStep),pdlService.callCheckOutStepEvent(pdlConstant.EVENT_ATTRIBUTES.STEP_NAME.creditCheck))}function handleCheckOutNoCreditCheckEvent(scope,attrs){angular.isDefined(attrs.pdlCheckoutStep)&&angular.equals(attrs.pdlCheckoutStep,"noCreditCheck")&&($log.log("pdlCheckoutStep ",attrs.pdlCheckoutStep),pdlService.callCheckOutStepEvent(pdlConstant.EVENT_ATTRIBUTES.STEP_NAME.noCreditCheck))}function handleCheckOutReviewCartEvent(scope,attrs){angular.isDefined(attrs.pdlCheckoutStep)&&angular.equals(attrs.pdlCheckoutStep,"reviewCart")&&($log.log("pdlCheckoutStep ",attrs.pdlCheckoutStep),pdlService.callCheckOutStepEvent(pdlConstant.EVENT_ATTRIBUTES.STEP_NAME.reviewCart))}function handleCheckOutSoftOrderEvent(scope,attrs){angular.isDefined(attrs.pdlCheckoutStep)&&angular.equals(attrs.pdlCheckoutStep,"softOrderConfirm")&&($log.log("pdlCheckoutStep ",attrs.pdlCheckoutStep),pdlService.callCheckOutStepEvent(pdlConstant.EVENT_ATTRIBUTES.STEP_NAME.softOrderConfirm,attrs.pdlOrderNumber))}function handleFormDataEvent(scope,attrs){var formObject=null,isFormStartAnalyticsOn=_.get(toggleService.model.toggles,"isFormStartAnalyticsOn",!1);angular.isDefined(attrs.pdlFormData)&&isFormStartAnalyticsOn&&(formObject=$parse(attrs.pdlFormData)(scope),""!==formObject.formName&&pdlService.callFormDataEvent(formObject))}function handleModalLoadEvent(scope,attrs){var productData=null,modalObject=null;angular.isDefined(attrs.pdlModalData)&&(attrs.pdlProductData&&(productData=$parse(attrs.pdlProductData)(scope)),!angular.equals(attrs.pdlEvent,pdlConstant.EVENT_TYPE.MODAL)||productData&&0===productData.length||(modalObject=$parse(attrs.pdlModalData)(scope),pdlService.callModalLoadEvent(modalObject,productData)))}function handleModalCloseEvent(scope,attrs){var modalObject=null;angular.isDefined(attrs.pdlModalData)&&(modalObject=$parse(attrs.pdlModalData)(scope),pdlService.callModalCloseEvent(modalObject)),"checkoutStep"===attrs.pdlFlow&&("true"===attrs.istppon?pdlService.callCheckOutStepEvent(pdlConstant.EVENT_ATTRIBUTES.STEP_NAME.shippingPaymentTPP):pdlService.callCheckOutStepEvent(pdlConstant.EVENT_ATTRIBUTES.STEP_NAME.shippingPayment))}function handleErrorEvent(scope,attrs){var errorObject=null;angular.isDefined(attrs.pdlErrorData)&&angular.equals(attrs.pdlEvent,pdlConstant.EVENT_ACTION.ERROR)&&(errorObject=$parse(attrs.pdlErrorData)(scope),pdlService.callErrorEvent(errorObject))}function handlePDPLoadEvent(scope,attrs){var productData=null;if(attrs.pdlProductData)var interval=$interval(function(){productData=$parse(attrs.pdlProductData)(scope),pdlService.callPDPLoadEvent(productData),$interval.cancel(interval)},100)}function handleTradeInPageLoadEvent(scope,attrs){var pageLoadData=$parse(attrs.pdlEvent)(scope),tradeInData=$parse(attrs.tradeInPageData)(scope);angular.equals(attrs.pdlEvent,pdlConstant.EVENT_ACTION.PAGE_LOAD)&&pdlService.setPageLoadDataForTradeIn(pageLoadData,tradeInData)}function handleProductSwatchEvent(scope,attrs){angular.equals(attrs.pdlEvent,"productSwatch")&&pdlService.callProductSwatchEvent(attrs.pdlColorData)}function handleMemorySwatchEvent(scope,attrs){angular.equals(attrs.pdlEvent,"memorySwatch")&&pdlService.callMemorySwatchEvent(attrs.pdlMemoryData)}function handlePageLoadEvent(){pdlService.setCommonPageLoad()}function handleRichTextLink(scope,element,attrs){var el=angular.element(element[0]),anchor=el.find("a"),ctaName=el[0].innerText,targetUrl=anchor[0].href,pdlEventInfo=$parse(attrs.pdlEventInfo)(scope),eventDescription={ctaName:ctaName,targetUrl:targetUrl};pdlEventInfo.storeId&&(eventDescription.storeID=pdlEventInfo.storeId,delete pdlEventInfo.storeId);var attributes={};targetUrl.contains("tel:")&&(attributes.tfn=targetUrl.split("tel:")[1]);var event={eventInfo:pdlEventInfo,attributes:attributes,eventDescription:eventDescription};pdlService.richTextLinkClick(event)}function pdlEventInit(scope,element,attrs){if($log.log("pdl-event : ",attrs.pdlEvent),angular.equals("pdp",attrs.pdlEvent)&&handlePDPLoadEvent(scope,attrs),angular.equals(attrs.pdlEvent,"storeLocator")&&pdlService.setSLPageLoadEvent(attrs.pdlModalData),angular.equals(attrs.pdlEvent,"searchResults")&&pdlService.setSearchPageLoadEvent(),angular.equals(attrs.pdlEvent,"storeDetails")){var storeDetailsModalData=$parse(attrs.pdlModalData)(scope);pdlService.setSLStoreDetailsPageLoadEvent(storeDetailsModalData)}if((angular.equals(attrs.pdlEvent,"storeAppointment")||angular.equals(attrs.pdlEvent,"storeAppointmentClose"))&&pdlService.setAppointmentPageLoadOrCloseEvent(attrs.pdlModalData),angular.equals(attrs.pdlEvent,"getInLine")){var getInLineModalData=$parse(attrs.pdlModalData)(scope);pdlService.setGetInLinePageLoadEvent(getInLineModalData)}angular.equals(attrs.pdlEvent,"richTextLink")&&element.bind("click",function(){handleRichTextLink(scope,element,attrs)}),angular.equals(attrs.pdlEvent,"pageLoad")&&handleTradeInPageLoadEvent(scope,attrs),angular.equals(attrs.pdlEvent,"page")&&handlePageLoadEvent(scope,attrs),angular.equals(attrs.pdlEvent,"modal")&&handleModalLoadEvent(scope,attrs),angular.equals(attrs.pdlEvent,"modal-close")&&element.bind("click",function(){handleModalCloseEvent(scope,attrs)}),angular.equals(attrs.pdlEvent,"form-start")&&element.bind("blur",function(){element.val()&&handleFormDataEvent(scope,attrs)}),angular.equals(attrs.pdlCheckoutStep,"personalInfo")||angular.equals(attrs.pdlCheckoutStep,"shippingPayment")||angular.equals(attrs.pdlCheckoutStep,"creditCheck")||angular.equals(attrs.pdlCheckoutStep,"noCreditCheck")||angular.equals(attrs.pdlCheckoutStep,"reviewCart")||angular.equals(attrs.pdlCheckoutStep,"softOrderConfirm")||angular.equals(attrs.pdlEvent,pdlConstant.EVENT_TYPE.MODAL)||angular.equals(attrs.pdlCheckoutStep,"callmenow")||element.bind("click",function(){handleNavigationClickEvent(scope,attrs),handleDynamicLinkClickEvent(scope,attrs),handleCTANavOrClickEvent(scope,attrs),handleFormCTAClickEvent(scope,attrs),$timeout(function(){handleCartEvents(scope,attrs),handleCheckOutStepEvents(scope,attrs),handleCreditEstimationEvent(scope,attrs),handleClickToCallEvent(scope,attrs),handleCallMeEvent(scope,attrs),handleProductSwatchEvent(scope,attrs),handleToolTipToCallEvent(scope,attrs),handleMemorySwatchEvent(scope,attrs)},100)}),handleCheckOutPersonalInfoEvent(scope,attrs),handleVerifyIdEvent(scope,attrs),handleRunCreditCheckEvent(scope,attrs),handleCheckOutShipingPaymentEvent(scope,attrs),handleCheckOutCreditCheckEvent(scope,attrs),handleCheckOutNoCreditCheckEvent(scope,attrs),handleCheckOutReviewCartEvent(scope,attrs),handleCheckOutSoftOrderEvent(scope,attrs),handleNudgeModalEvent(scope,attrs),handleErrorEvent(scope,attrs)}return{restrict:"A",link:function(scope,element,attrs){$timeout(function(){pdlEventInit(scope,element,attrs)},100)}}}pdlEvent.$inject=["$parse","$log","$timeout","$interval","pdlService","pdlConstant","toggleService"],angular.module("tmobileCore").directive("pdlEvent",pdlEvent)}(window.angular),function(angular){"use strict";function pdlButton(pdlService){function handleDynamicClickEvent(element,attrs,type,isSavingIcid){pdlService.callDynamicClickEventFromPdl(element,attrs,type,isSavingIcid)}return{restrict:"E",link:function(scope,element,attrs){handleDynamicClickEvent(element,attrs,"button",!0)}}}pdlButton.$inject=["pdlService"],angular.module("tmobileCore").directive("button",pdlButton)}(window.angular),function(angular){"use strict";function pdlA($parse,$log,pdlService){function handleDynamicClickEvent(element,attrs,type,isSavingIcid){pdlService.callDynamicClickEventFromPdl(element,attrs,type,isSavingIcid)}return{restrict:"E",link:function(scope,element,attrs){handleDynamicClickEvent(element,attrs,"a",!0)}}}pdlA.$inject=["$parse","$log","pdlService"],angular.module("tmobileCore").directive("a",pdlA)}(window.angular),function(angular){"use strict";function bodyDirectiveConstructor(pdlService){return{restrict:"E",link:function(){pdlService.initDigitalData(),pdlService.callPageLoadEvent("Apple")}}}bodyDirectiveConstructor.$inject=["pdlService"],angular.module("tmobileCore").directive("body",bodyDirectiveConstructor)}(angular),function(angular){"use strict";var digitalData={page:{pageInfo:{pageID:"",pageName:"apple-iphone-6s",pageTitle:"",pageURL:"",previousPageURL:"",prevPageName:"",version:"1.15",language:"en-US",geoRegion:"US",domain:"t-mobile.com",responsiveState:"",variant:"plan first",timeStamp:(new Date).toString(),currencyCode:"USD",TFN:""},category:{primaryCategory:"",subCategory:"",pageType:""},search:{searchTerm:"",searchResultCount:0}},cart:{cartID:"",lineCount:0,creditLevel:"",deviceDownPaymentRequired:!1,lineDepositRequired:!1,currentCarrier:"",product:[],price:{currencyCode:"USD",subtotal:{dueToday:0,dueMonthly:0,dueTodayBreakdown:{refundable:0,nonRefundable:0}},taxesFees:{dueToday:0,dueMonthly:0},shippingFee:{dueToday:0},total:{dueToday:0,dueMonthly:0,dueTodayBreakdown:{refundable:0,nonRefundable:0}},promo:[]},shipping:{method:"standard",address:{city:"",stateProvince:"",postalCode:"",country:""}},billing:{paymentType:"visa",address:{city:"",stateProvince:"",postalCode:"",country:""}}},transaction:{transactionID:"",offer:[],orderType:"",hasTradeIn:!1,hasJUMPUpgrade:!1,hasSCOREUpgrade:!1,hasOtherUpgrade:!1,hasInsuranceClaim:!1,deviceDownPaymentRequired:!1,lineDepositRequired:!1,lineCount:0,itemCount:0,price:{currencyCode:"",subtotal:{dueToday:0,dueMonthly:0},taxesFees:{dueToday:0,dueMonthly:0},total:{dueToday:0,dueMonthly:0},tradeIn:[{deviceName:"",creditAmount:0}],promo:[{code:"",value:0}],netChangeMRC:0,paymentType:""},shipping:{amount:"",method:"",address:{city:"",stateProvince:"",postalCode:"",country:""}},billing:{address:{city:"",stateProvince:"",postalCode:"",country:""}}},customer:{TMobileID:"",creditDecisionCode:"",status:""},events:[{offer:[],eventInfo:{eventAction:"",eventType:"",timeStamp:""},category:{eventCategory:"a for apple"},attributes:{},links:{linkName:"",linkURL:"",linkLocation:[]},filter:{filterName:"",filterSelection:""},search:{},user:[],error:{description:"",code:""},products:[]}],user:{TMobileID:"",credit:""},version:{versionInfo:{dataLayerVersion:"1.0"}},callbacks:[],invoca:{fireTag:"T",numberSelector:".tmo_tfn_number"},thirdPartyTag:{livePerson:"T",foresee:"T"},hasCallbacks:function(){return this.callbacks.length},registerCallback:function(fn){angular.isFunction(fn)&&this.callbacks.push(fn)},triggerEvent:function(filters){var index=0,that=this,eventsLength=this.callbacks.length,event=this.events[this.events.length-1],data={};if(eventsLength&&event&&filters&&filters.length)for(angular.forEach(filters,function(field){event[field]?data[field]=event[field]:that[field]&&angular.forEach(that[field],function(value,key){this[key]=value},data)}),index=0;eventsLength>index;++index)this.callbacks[index](data)}};window.digitalData||(window.digitalData=digitalData),window.location.pathname&&"/store-locator"===window.location.pathname.toLowerCase()&&window.addEventListener("digitalDataReady",function(e){if(e&&/digitalData/i.test(e.detail)){window.digitalData.page.pageInfo.pageName="Store Locator",window.digitalData.page.pageInfo.pageURL=window.location.href,window.digitalData.page.pageInfo.primaryCategory="",window.digitalData.page.pageInfo.subCategory="",window.digitalData.page.pageInfo.timeStamp=(new Date).toString(),window.digitalData.page.category.pageType="Store Locator";var event={eventInfo:{eventAction:"load",eventType:"page",timeStamp:(new Date).toString()},attributes:{icidList:[]}};window.digitalData.events.push(event),window.digitalData.triggerEvent(event)}});var digitalDataReady=new CustomEvent("digitalDataReady",{detail:"PDL Ready"});window.dispatchEvent(digitalDataReady)}(window.angular),function(angular){"use strict";function navBarControllerFunction($location){function isActive(route){return route===$location.path()}var vm=this;vm.menu=[{title:"Home",link:"/"}],vm.isCollapsed=!0,vm.isActive=isActive}navBarControllerFunction.$inject=["$location"],angular.module("tmobileApp").controller("navBarController",navBarControllerFunction)}(angular),function(angular){"use strict";angular.module("tmobileCore").filter("unique",function(){return function(items,filterOn){if(filterOn===!1)return items;if((filterOn||angular.isUndefined(filterOn))&&angular.isArray(items)){var newItems=[],extractValueToCompare=function(item){return angular.isObject(item)&&angular.isString(filterOn)?item[filterOn]:item};angular.forEach(items,function(item){for(var isDuplicate=!1,i=0;i<newItems.length;i++)if(angular.equals(extractValueToCompare(newItems[i]),extractValueToCompare(item))){isDuplicate=!0;break}isDuplicate||newItems.push(item)}),items=newItems}return items}})}(angular),function(angular){"use strict";function telePhone(){return function(telephoneNumber,filterType){var city,number,value="";if(angular.isDefined(telephoneNumber)){if(value=telephoneNumber.toString().trim().replace(/^\+/,""),value.match(/[^0-9]/))return telephoneNumber;switch(value.length){case 1:case 2:case 3:city=value;break;default:city=value.slice(0,3),number=value.slice(3)}}return angular.equals(filterType,"tele")?number?(number=number.length>3?number.slice(0,3)+"-"+number.slice(3,7):number,("("+city+") "+number).trim()):0===value.length?"":"("+city:angular.equals(filterType,"ssn")?number?(number=number.length>2?number.slice(0,2)+"-"+number.slice(2,6):number,(city+"-"+number).trim()):city:void 0}}angular.module("tmobileCore").filter("tel",telePhone)}(window.angular),function(angular){"use strict";angular.module("tmobileCore").filter("startFrom",function(){return function(input,start){return start=+start,void 0!=input?input.slice(start):!1}})}(angular),function(angular){"use strict";angular.module("tmobileCore").filter("splitpipe",function(){return function(input){return input?input.split("|"):null}})}(angular),function(angular){"use strict";angular.module("tmobileCore").filter("splitDollarDecimal",function(){return function(input){if(input){input=input.toString();var i=input.indexOf("$"),j=input.indexOf(".");return 0>i?input.substring(0,j):input.substring(i+1,j)}return null}})}(angular),function(angular){"use strict";angular.module("tmobileCore").filter("significantFigures",function(){return function(input,digits){return input.toPrecision(digits)}})}(angular),function(angular){"use strict";angular.module("tmobileCore").filter("removedollar",function(){return function(input){if(angular.isUndefined(input)||""===input||null===input)return"0";if(input=input.toString()){var i=input.indexOf(".");return 0>i?"$"===input.charAt(0)?input.substring(1):input.substring(0):"$"===input.charAt(0)?input.substring(1,i):input.substring(0,i)}}})}(angular),function(angular,lodash){"use strict";function parseUrlFilter($sce){return function(input){return angular.isString(input)&&!lodash.isEmpty(input)?$sce.trustAsResourceUrl(input):""}}parseUrlFilter.$inject=["$sce"],angular.module("tmobileCore").filter("parseUrl",parseUrlFilter)}(angular,_),function(angular){"use strict";angular.module("tmobileCore").filter("parseText",function(){return function(text){return text?String(text).replace(/<[^>]+>/gm,""):""}})}(angular),function(angular,_){"use strict";function parseJsonFilter($sce){return function(input){return angular.isString(input)&&!_.isEmpty(input)?$sce.parse.JSON(input):void 0}}parseJsonFilter.$inject=["$sce"],angular.module("tmobileCore").filter("parseJson",parseJsonFilter)}(angular,_),function(angular,_){"use strict";function parseHtmlFilter($sce){return function(input){return angular.isString(input)&&!_.isEmpty(input)?$sce.trustAsHtml(input):void 0}}parseHtmlFilter.$inject=["$sce"],angular.module("tmobileCore").filter("parseHtml",parseHtmlFilter)}(angular,_),function(angular,lodash){"use strict";function normalizeFilter(commonUtils){return function(input){return null!==input&&lodash.isString(input)&&!lodash.isEmpty(input)?angular.lowercase(commonUtils.removeStringAccents(input)).trim().replace(commonUtils.getRegexFromGlobalConfig("commonRegex.replaceSpaceWithDashes",/\s+/g),"-").replace(commonUtils.getRegexFromGlobalConfig("commonRegex.replaceSpecialCharsExceptDashWithDashes",/[^a-zA-Z0-9-]/g),"").replace(commonUtils.getRegexFromGlobalConfig("commonRegex.replaceMutilpleOccOfDashWithSingleDash",/-{2,}/g),"-").replace(/^-|-$/g,""):""}}normalizeFilter.$inject=["commonUtils"],angular.module("tmobileCore").filter("normalize",normalizeFilter)}(angular,_),function(angular){"use strict";angular.module("tmobileCore").filter("getByProperty",function(){return function(collection,propertyName,propertyValue){if(collection)for(var i=0,len=collection.length;len>i;i++)if(collection[i][propertyName]===propertyValue)return collection[i];return null}})}(angular),function(angular,_){"use strict";function parseDynamicValue(){return function(replacedValue,message,constValue){if(angular.isString(replacedValue)&&!_.isEmpty(replacedValue)&&angular.isString(message)&&!_.isEmpty(message)){var finalValue=message.replace(constValue,replacedValue);return finalValue}}}angular.module("tmobileCore").filter("parseDynamicValue",parseDynamicValue)}(angular,_),function(angular,lodash){"use strict";function denormalizeFilter(){return function(input){return lodash.isEmpty(input)?"":input.replace("-"," ").replace(/\w\S*/g,function(txt){return txt.charAt(0).toUpperCase()+txt.substr(1).toLowerCase()})}}angular.module("tmobileCore").filter("denormalize",denormalizeFilter)}(angular,_),function(angular){"use strict";angular.module("tmobileCore").filter("afterdecimal",function(){return function(input){if(angular.isUndefined(input)||""===input||null===input)return"00";if(input=input.toString()){var i=input.indexOf("."),j=i+1;return j>0?input.substring(j,j+2):"00"}}})}(angular),function(angular){"use strict";angular.module("tmobileCore").config(["$provide",function($provide){externalLogger.moduleConfigured("tmobileCore","exceptionHandler.decorator.js"),$provide.decorator("$exceptionHandler",["$delegate","loggingService",function($delegate,loggingService){return function(exception,cause){return loggingService.exceptionHandler(exception,cause),$delegate(exception,cause),$delegate}}])}])}(angular,externalLogger),function(angular,lodash){"use strict";function zipCodeModalController($location,geoLocation,cartStorage,$modalInstance,$modalStack,commonServices,$state,extantCartService,CART_STATE_NAME,cartHttpDataService,cartCommonOperationsService,modalType,preHeaderText,htmlContent,htmlPath,autoOpen,productType,authorData,$rootScope,preConfiguredCartId,localCartId,dismissModalOnly,headerText,subHeaderText,errorText,buttonText,preConfiguredCartIdNonNy){function closeModal(){vm.showCartIdBlock=!1,vm.showZipCodeBlock=!1,$modalInstance.dismiss()}function validateZipCodeLocation(zipCodeForm){geoLocation.getUserCurrentLocationState(vm.zipCode).then(function(status){status?"NY"==status?0==vm.cartExist&&""!=preConfiguredCartId?(sessionStorage.setItem("preConfiguredModalDisplayed",!0),commonServices.$window.location.href="/cart/SC?id="+vm.preConfiguredCartId):(vm.customerLocation=status,vm.showCartIdBlock=!0,vm.showZipCodeBlock=!1):0==vm.cartExist&&""!=preConfiguredCartIdNonNy?(sessionStorage.setItem("preConfiguredModalDisplayed",!0),commonServices.$window.location.href="/cart/SC?id="+vm.preConfiguredCartIdNonNy):(vm.customerLocation=status,vm.showCartIdBlock=!0,vm.showZipCodeBlock=!1):vm.invalidZipCode=!0})}function resetValidity(){vm.invalidZipCode=!1}function loadPreConfiguredCart(){"NY"==vm.customerLocation?extantCartService.addConfigCart(vm.localCartId,vm.preConfiguredCartId).then(function(responseData){angular.equals(responseData.status,200)||(vm.message=lodash.get(vm.keyValues[type],"cartFailed","Something went wrong! We're taking you to an empty cart.")),$state.go(CART_STATE_NAME)}):extantCartService.addConfigCart(vm.localCartId,vm.preConfiguredCartIdNonNy).then(function(responseData){angular.equals(responseData.status,200)||(vm.message=lodash.get(vm.keyValues[type],"cartFailed","Something went wrong! We're taking you to an empty cart.")),$state.go(CART_STATE_NAME)})}function goToPreConfiguredCart(){sessionStorage.setItem("preConfiguredModalDisplayed",!0),"NY"==vm.customerLocation?commonServices.$window.location.href="/cart/SC?id="+vm.preConfiguredCartId:commonServices.$window.location.href="/cart/SC?id="+vm.preConfiguredCartIdNonNy}function loadLocalCart(){vm.autoOpen=!1,cartHttpDataService.getCart().then(function(cartResponseStatus){angular.equals(cartResponseStatus,200)||(vm.message=lodash.get(vm.keyValues[type],"cartFailed","Something went wrong! We're taking you to an empty cart.")),$state.go(CART_STATE_NAME)}),cartCommonOperationsService.updateStructCartData(),$state.go(CART_STATE_NAME)}function initialize(){vm.customerLocation,vm.showCartIdBlock=!1,vm.showZipCodeBlock=!0,geoLocation.getZipCode().then(function(zipCode){vm.zipCode=zipCode,vm.invalidZipCode=!1})}var vm=this;vm.cartExist=!1,cartHttpDataService.getCart().then(function(cartResponse){(cartResponse.lineItems.length>0||cartResponse.accessories.accessoryDetails.length>0)&&(vm.cartExist=!0)}),vm.preHeaderText=preHeaderText,vm.htmlContent=htmlContent,vm.htmlPath=htmlPath,vm.productType=productType,vm.authorData=authorData,vm.modalType=modalType,vm.preConfiguredCartId=preConfiguredCartId,vm.preConfiguredCartIdNonNy=preConfiguredCartIdNonNy,vm.localCartId=localCartId,vm.dismissModalOnly=dismissModalOnly,vm.autoOpen=autoOpen,vm.headerText=headerText,vm.subHeaderText=subHeaderText,vm.buttonText=buttonText,vm.errorText=errorText,vm.invalidZipCode=!1,vm.closeModal=closeModal,vm.validateZipCodeLocation=validateZipCodeLocation,vm.resetValidity=resetValidity,vm.cartCommonOperationsService=cartCommonOperationsService,vm.loadPreConfiguredCart=loadPreConfiguredCart,vm.loadLocalCart=loadLocalCart,vm.goToPreConfiguredCart=goToPreConfiguredCart,initialize()}function popUP($scope,$modal){function success(result){$scope.autoOpen=!1}var modalInstance=$modal.open({size:$scope.modalSize,controller:"ZipCodeModalController",controllerAs:"vm",templateUrl:"app/core/directives/zipCodeModal/zipCodeModal.html",resolve:{preHeaderText:function(){return $scope.preHeaderText},htmlContent:function(){return $scope.htmlContent},htmlPath:function(){return $scope.htmlPath},productType:function(){return $scope.productType},modalType:function(){
return $scope.modalType},authorData:function(){return $scope.authorData},preConfiguredCartId:function(){return $scope.preConfiguredCartId},preConfiguredCartIdNonNy:function(){return $scope.preConfiguredCartIdNonNy},localCartId:function(){return $scope.localCartId},dismissModalOnly:function(){return $scope.dismissModalOnly},autoOpen:function(){return $scope.autoOpen},headerText:function(){return $scope.headerText},subHeaderText:function(){return $scope.subHeaderText},buttonText:function(){return $scope.buttonText},errorText:function(){return $scope.errorText}}});modalInstance.result.then(success,success)}function zipCodeModalFunction($log,$modal,compUtils){return{restrict:"A",scope:{preHeaderText:"=",htmlContent:"=",modalType:"=",authorData:"=",productType:"=",modalSize:"@",htmlPath:"@",preConfiguredCartId:"=",preConfiguredCartIdNonNy:"=",localCartId:"=",dismissModalOnly:"=",autoOpen:"=",headerText:"=",subHeaderText:"=",buttonText:"=",errorText:"="},link:function(scope,elm,attrs,$modalInstance){elm.bind("click",function(){popUP(scope,$modal)})},controller:["$scope","$modal",function($scope,$modal){$scope.$watch("autoOpen",function(value){1==value&&popUP($scope,$modal)})}]}}zipCodeModalController.$inject=["$location","geoLocation","cartStorage","$modalInstance","$modalStack","commonServices","$state","extantCartService","CART_STATE_NAME","cartHttpDataService","cartCommonOperationsService","modalType","preHeaderText","htmlContent","htmlPath","autoOpen","productType","authorData","$rootScope","preConfiguredCartId","localCartId","dismissModalOnly","headerText","subHeaderText","errorText","buttonText","preConfiguredCartIdNonNy"],zipCodeModalFunction.$inject=["$log","$modal","compUtils"],angular.module("tmobileCore").controller("ZipCodeModalController",zipCodeModalController).directive("zipCodeModal",zipCodeModalFunction)}(angular),angular.module("tmobileApp").directive("resize",["$window",function($window){return function(scope,element){var w=angular.element($window);scope.getWindowDimensions=function(){return{h:w.height(),w:w.width()}},scope.$watch(scope.getWindowDimensions,function(newValue,oldValue){scope.windowHeight=newValue.h,scope.windowWidth=newValue.w;var headerEl=document.querySelector("#header_navbar"),footerEl=document.querySelector("#divfootermain");if(headerEl){var navHeight=headerEl?headerEl.clientHeight:0,footerHeight=footerEl?footerEl.clientHeight:0;scope.mapMargin=navHeight+footerHeight}else scope.mapMargin=innerWidth>1023?62:50;scope.style=function(){return{height:newValue.h-100+"px",width:newValue.w-100+"px"}}},!0),w.bind("resize",function(){scope.$apply()})}}]),function(angular){"use strict";angular.module("tmobileCore").directive("typeAheadDropdown",function(){return{restrict:"A",link:function(scope,element,attrs){element.bind("keydown",function(evt){40===evt.which&&element.find("ul.dropdown-menu li.active").index()>2&&element.find("ul.dropdown-menu li.active").index()<element.find("li").length-1?element.find("ul.dropdown-menu")[0].scrollTop=28*element.find("ul.dropdown-menu li.active").index():40===evt.which&&element.find("ul.dropdown-menu li.active").index()==element.find("li").length-1?element.find("ul.dropdown-menu")[0].scrollTop=0:38===evt.which&&0!==element.find("ul.dropdown-menu li.active").index()?element.find("ul.dropdown-menu")[0].scrollTop=28*(element.find("ul.dropdown-menu li.active").index()-1):38===evt.which&&0===element.find("ul.dropdown-menu li.active").index()?element.find("ul.dropdown-menu")[0].scrollTop=28*(element.find("li").length-1):element.find("ul.dropdown-menu")[0].scrollTop=0})}}})}(angular),function(angular){"use strict";angular.module("tmobileCore").directive("tmobModal",function(){return{templateUrl:"core/directives/tmobModal/tmobModal.html",restrict:"EA",link:function(scope,element,attrs){}}})}(angular),function(angular){"use strict";angular.module("tmobileCore").directive("tmobHeader",["tmobileAppConfig","$templateRequest","$compile",function(tmobileAppConfig,$templateRequest,$compile){return{templateUrl:"core/directives/tmobHeader/tmobHeader.html",restrict:"EA",link:function(scope,element,attrs){scope.aemIntegration=tmobileAppConfig.aemIntegration,tmobileAppConfig.aemIntegration&&$templateRequest("app/core/directives/tmobHeader/tmobHeader-aemTpl.html").then(function(html){var template=angular.element(html);element.append(template),$compile(template)(scope)})}}}])}(angular),function(angular){"use strict";angular.module("tmobileCore").directive("slideTagToTop",["$anchorScroll","$location",function($anchorScroll,$location){return{restrict:"A",link:function(scope,elem,attrs){elem.focus(function(){$location.hash(attrs.id),$anchorScroll()})}}}])}(angular),function(angular){"use strict";function slickerWrapperDirectiveConstructor($templateCache,$compile,$timeout){return{restrict:"A",scope:{slickerData:"=",authorValue:"="},link:function(scope,elm,attrs){scope.$watch(function(){return JSON.stringify(scope.slickerData)},function(newValue,oldValue){function handleAccessibility(){var newelm=elm;newelm.parent().find("div.slickSlider").removeAttr("role"),elm.removeClass("fadeSlow");var alldescribedByElms=elm.contents().find("*[aria-describedBy]");angular.forEach(alldescribedByElms,function(element,index){var id=element.getAttribute("aria-describedBy");!_.isEmpty(id)&&_.isEmpty(elm.contents().find("#"+id))&&element.removeAttribute("aria-describedBy")});var slickUlLi=elm.contents().find("ul.slick-dots li");slickUlLi.each(function(index){var liAriaControl=this.getAttribute("aria-controls"),liElement=elm.contents().find(this);liElement.find("button").attr("id",liAriaControl),liElement.find("button").attr("aria-label","Product Image "+(index+1))}),slickUlLi.find("button").removeAttr("aria-required tabindex"),slickUlLi.attr("role","tab"),slickUlLi.attr("aria-hidden",!1),elm.contents().find("ul.slick-dots li").attr("aria-selected",!1),elm.contents().find("ul.slick-dots li.slick-active").attr("aria-selected",!0),newelm.replaceWith(elm),elm=newelm}var rawTemplate=$templateCache.get("app/core/directives/slickerwrapper/slickerwrapper.html");elm.addClass("fadeSlow"),elm.html(rawTemplate).show(),$compile(elm.contents())(scope),elm.find(".slider").on("setPosition",function(){$timeout(handleAccessibility,1e3)})})}}}var directiveName="tmobSlickerWrapper";angular.module("tmobileCore").directive(directiveName,slickerWrapperDirectiveConstructor)}(angular),function(angular,lodash){"use strict";function simpleModalPopupController($location,$modalInstance,$modalStack,commonServices,$state,extantCartService,CART_STATE_NAME,cartHttpDataService,cartCommonOperationsService,modalType,htmlContent,htmlPath,autoOpen,productType,headerText,authorData,$rootScope,preConfiguredCartId,localCartId,dismissModalOnly){function pageStatus(){var geturl=$location.$$path;geturl.match("cart")?loadLocalCart():dismiss()}function dismiss(){return vm.productType?($modalInstance.dismiss("cancel"),void("cart"==vm.productType&&$rootScope.$emit("modalClosed",!0))):void $modalInstance.dismiss()}function closeModal(){$modalInstance.dismiss()}function goToCart(){return"cart"==vm.productType?void $modalStack.dismissAll():(vm.autoOpen=!1,void $state.go(CART_STATE_NAME))}function loadPreConfiguredCart(){extantCartService.addConfigCart(vm.localCartId,vm.preConfiguredCartId).then(function(responseData){angular.equals(responseData.status,200)||(vm.message=lodash.get(vm.keyValues[type],"cartFailed","Something went wrong! We're taking you to an empty cart.")),$state.go(CART_STATE_NAME)})}function goToPreConfiguredCart(){sessionStorage.setItem("preConfiguredModalDisplayed",!0),commonServices.$window.location.href="/cart/SC?id="+vm.preConfiguredCartId}function loadLocalCart(){vm.autoOpen=!1,cartHttpDataService.getCart().then(function(cartResponseStatus){angular.equals(cartResponseStatus,200)||(vm.message=lodash.get(vm.keyValues[type],"cartFailed","Something went wrong! We're taking you to an empty cart.")),$state.go(CART_STATE_NAME)}),cartCommonOperationsService.updateStructCartData(),$state.go(CART_STATE_NAME)}var vm=this;vm.htmlContent=htmlContent,vm.htmlPath=htmlPath,vm.autoOpen=autoOpen,vm.productType=productType,vm.headerText=headerText,vm.authorData=authorData,vm.modalType=modalType,vm.preConfiguredCartId=preConfiguredCartId,vm.localCartId=localCartId,vm.dismissModalOnly=dismissModalOnly,vm.dismiss=dismiss,vm.closeModal=closeModal,vm.goToCart=goToCart,vm.loadPreConfiguredCart=loadPreConfiguredCart,vm.loadLocalCart=loadLocalCart,vm.goToPreConfiguredCart=goToPreConfiguredCart,vm.pageStatus=pageStatus}function popUP($scope,$modal){function success(result){$scope.autoOpen=!1}var modalInstance=$modal.open({size:$scope.modalSize,controller:"SimpleModalPopupController",controllerAs:"vm",templateUrl:"app/core/directives/simpleModalPopup/simpleModalPopup.html",resolve:{htmlContent:function(){return $scope.htmlContent},htmlPath:function(){return $scope.htmlPath},autoOpen:function(){return $scope.autoOpen},productType:function(){return $scope.productType},headerText:function(){return $scope.headerText},modalType:function(){return $scope.modalType},authorData:function(){return $scope.authorData},preConfiguredCartId:function(){return $scope.preConfiguredCartId},localCartId:function(){return $scope.localCartId},dismissModalOnly:function(){return $scope.dismissModalOnly}}});modalInstance.result.then(success,success)}function SimpleModalPopupFunction($log,$modal,compUtils){return{restrict:"A",scope:{htmlContent:"=",autoOpen:"=",modalType:"=",authorData:"=",productType:"=",headerText:"=",modalSize:"@",htmlPath:"@",preConfiguredCartId:"=",localCartId:"=",dismissModalOnly:"="},link:function(scope,elm,attrs,$modalInstance){elm.bind("click",function(){popUP(scope,$modal)})},controller:["$scope","$modal",function($scope,$modal){$scope.$watch("autoOpen",function(value){1==value&&popUP($scope,$modal)})}]}}simpleModalPopupController.$inject=["$location","$modalInstance","$modalStack","commonServices","$state","extantCartService","CART_STATE_NAME","cartHttpDataService","cartCommonOperationsService","modalType","htmlContent","htmlPath","autoOpen","productType","headerText","authorData","$rootScope","preConfiguredCartId","localCartId","dismissModalOnly"],SimpleModalPopupFunction.$inject=["$log","$modal","compUtils"],angular.module("tmobileCore").controller("SimpleModalPopupController",simpleModalPopupController).directive("simpleModalPopup",SimpleModalPopupFunction)}(window.angular,window._),function(angular,lodash){"use strict";function seoUpdateConstructor(){return{restrict:"A",scope:!0,link:function(scope,element,attrs){scope.$on("BROWSE_FILTER_INJECT",function(event,seo){function updateSpanishMeta(attribute,value,language){angular.element.find("head").filter(function(item){lodash.forEach(item.childNodes,function(elem){if(8===elem.nodeType&&lodash.includes(elem.textContent,language)){var html='mp_trans_add <meta name="'+attribute+'" content="'+value+'" '+language+"> ",e=document.createComment(html);elem.replaceWith(e)}})})}"english"===attrs.language&&("description"===attrs.name&&(attrs.$set("content",seo.data.endescription),updateSpanishMeta("description",seo.data.esdescription,"descriptionspanish")),"keywords"===attrs.name&&(attrs.$set("content",seo.data.enkeywords),updateSpanishMeta("keywords",seo.data.eskeywords,"keywordspanish")),"title"===attrs.name&&(attrs.$set("content",seo.data.enpageTitle),updateSpanishMeta("title",seo.data.espageTitle,"titlespanish")),"canonical"===attrs.rel&&(attrs.$set("href",seo.data.encanonicalUrl),updateSpanishMeta("canonical",seo.data.escanonicalUrl,"linkspanish")),"alternate"===attrs.rel&&attrs.$set("href",seo.data.encanonicalUrl)),"spanish"===attrs.language&&("description"===attrs.name&&attrs.$set("content",seo.data.esdescription),"keywords"===attrs.name&&attrs.$set("content",seo.data.eskeywords),"title"===attrs.name&&attrs.$set("content",seo.data.espageTitle),"canonical"===attrs.rel&&attrs.$set("href",seo.data.escanonicalUrl),"alternate"===attrs.rel&&attrs.$set("href",seo.data.escanonicalUrl))})}}}angular.module("tmobileCore").directive("seoUpdate",seoUpdateConstructor)}(window.angular,window._),function(angular){"use strict";function seoModalPopupController($scope,$window,$log,$modalInstance,seoService,apiURLs){function cancel(){$modalInstance.dismiss("this is result for dismiss")}function submitData(){function successCallback(){$window.location.reload()}function errorCallback(){$log.log("error request")}var data={url:angular.isDefined(vm.url)?vm.url:"",canonicalUrl:_.isEmpty(vm.canonicalUrl)?"":vm.canonicalUrl,englishTitle:angular.isDefined(vm.englishTitle)?vm.englishTitle:"",spanishTitle:angular.isDefined(vm.spanishTitle)?vm.spanishTitle:"",englishDescription:angular.isDefined(vm.englishDescription)?vm.englishDescription:"",spanishDescription:angular.isDefined(vm.spanishDescription)?vm.spanishDescription:"",englishKeywords:angular.isDefined(vm.englishKeyWords)?vm.englishKeyWords:"",spanishKeywords:angular.isDefined(vm.spanishKeyWords)?vm.spanishKeyWords:"",browseType:angular.isDefined(vm.selectedBrowseType)?vm.selectedBrowseType:"",action:"update"},url=apiURLs.seoDataUpdate;seoService.postseoData(url,data).then(successCallback,errorCallback)}function mobView(){return $window.innerWidth>768?!1:!0}var vm=this;vm.model=seoService.model;var isolateScope=$scope.$parent;vm.englishTitle=isolateScope.englishTitle,vm.spanishTitle=isolateScope.spanishTitle,vm.englishDescription=isolateScope.englishDescription,vm.spanishDescription=isolateScope.spanishDescription,vm.englishKeyWords=isolateScope.englishKeyWords,vm.spanishKeyWords=isolateScope.spanishKeyWords,vm.canonicalUrl=isolateScope.canonicalUrl,vm.selectedBrowseType=isolateScope.browseType,vm.url=isolateScope.url,vm.mobView=mobView,vm.cancel=cancel,vm.submitData=submitData}function seoModalPopupFunction($modal,$log){var RETURN_KEY=13;return{restrict:"A",scope:{englishTitle:"=",spanishTitle:"=",englishDescription:"=",spanishDescription:"=",englishKeyWords:"=",spanishKeyWords:"=",canonicalUrl:"=",url:"=",modalSize:"@",browseType:"="},link:function(scope,element,attrs){function successCallback(result){$log.log("request Failed")}function failureCallback(result){$log.log("called $modalInstance.dismiss(): ",result)}element.bind("click keypress",function(event){var keyCode=angular.isUndefined(event.which)?event.keyCode:event.which;if("click"===event.type||keyCode===RETURN_KEY){event.stopPropagation();var modalInstance=$modal.open({size:scope.modalSize,templateUrl:"app/core/directives/seoModalPopUp/seoModalPopUp.html",controller:seoModalPopupController,controllerAs:"vm",bindToController:!0,scope:scope});modalInstance.result.then(successCallback,failureCallback)}})}}}seoModalPopupController.$inject=["$scope","$window","$log","$modalInstance","seoService","apiURLs"],seoModalPopupFunction.$inject=["$modal","$log"],angular.module("tmobileCore").controller("seoModalPopupController",seoModalPopupController).directive("seoModal",seoModalPopupFunction)}(angular),function(angular,lodash){"use strict";function seoContentConstructor(){return{restrict:"A",scope:!0,link:function(scope,element,attrs){scope.$on("BROWSE_FILTER_INJECT",function(event,seo){function updateTitle(value,language){angular.element.find("head").filter(function(item){lodash.forEach(item.childNodes,function(elem){if(8===elem.nodeType&&lodash.includes(elem.textContent,language)){var html="mp_trans_add <title "+language+">"+value+"</title>",e=document.createComment(html);elem.replaceWith(e)}})})}("english"===seo.data.language||"en"===seo.data.language)&&"title"===attrs.seoContent&&(element[0].innerText=seo.data.enpageTitle,updateTitle(seo.data.espageTitle,"titletagspanish")),("spanish"===seo.data.language||"es"===seo.data.language)&&"title"===attrs.seoContent&&(element[0].innerText=seo.data.espageTitle)})}}}angular.module("tmobileCore").directive("seoContent",seoContentConstructor)}(window.angular,window._),function(angular){"use strict";angular.module("tmobileCore").directive("scrollTop",function(){return function($scope,$element,attrs){angular.element("html,body").animate({scrollTop:0},"slow")}})}(angular),function(angular){"use strict";function renderPageBodyDirectiveConstructor($rootScope,$location){return{restrict:"A",link:function(scope,element,attrs){var url=$location.absUrl();url.indexOf("/cart")>=0||url.indexOf("/checkout")>=0||(angular.element("div[id='unavHeader']").addClass("parsys iparsys ipar-nav unavscope"),angular.element("div[id='tmobileApp']").addClass("container bg-white"),angular.element("div[id='rowDiv']").addClass("row"),angular.element("div[id='page-content']").addClass("col-lg-12 col-md-12 col-sm-12"),angular.element("div[id='unavFooter']").addClass("footer main-footer unavscope"))}}}var moduleName="tmobileCore",directiveName="renderPageBody";renderPageBodyDirectiveConstructor.$inject=["$rootScope","$location"],angular.module(moduleName).directive(directiveName,renderPageBodyDirectiveConstructor)}(angular),function(angular){"use strict";function progressbarConstructor($log,$rootScope){var progressBarButton,progressBarElements=[];return{setButton:function(button){progressBarButton=button},getButton:function(){return progressBarButton},setButtonElements:function(elements){progressBarElements=elements},getButtonElements:function(){return progressBarElements}}}progressbarConstructor.$inject=["$log","$rootScope"],angular.module("tmobileCore").service("progressBarService",progressbarConstructor)}(angular),function(angular){"use strict";function progressbarConstructor(progressBarService,$log){return{restrict:"A",link:function(scope,elm,attrs){elm.bind("click",function(event){if(attrs.progressBar){var jsonElementIds=JSON.parse(attrs.progressBar),htmlElements=[];angular.forEach(jsonElementIds,function(elementId,key){htmlElements.push(document.getElementById(elementId))}),progressBarService.setButtonElements(htmlElements),$log.log("htmlElementshtmlElementshtmlElementshtmlElements ",htmlElements)}progressBarService.setButton(attrs)})}}}progressbarConstructor.$inject=["progressBarService","$log"],angular.module("tmobileCore").directive("progressBar",progressbarConstructor)}(angular),function(angular,externalLogger){"use strict";function configProgressBar(cfpLoadingBarProvider,globalConfig){externalLogger.moduleConfigured("core/tmobileApp","progressbar.config.js :: configProgressBar");var progressBarSettings=globalConfig.progressBar;progressBarSettings&&(angular.isDefined(progressBarSettings.includeSpinner)&&(cfpLoadingBarProvider.includeSpinner=progressBarSettings.includeSpinner),angular.isDefined(progressBarSettings.includeBar)&&(cfpLoadingBarProvider.includeBar=progressBarSettings.includeBar),angular.isDefined(progressBarSettings.spinnerTemplate)&&(cfpLoadingBarProvider.spinnerTemplate=progressBarSettings.spinnerTemplate),angular.isDefined(progressBarSettings.latencyThreshold)&&(cfpLoadingBarProvider.latencyThreshold=progressBarSettings.latencyThreshold))}function progressBarInitializer($log,$rootScope,progressBarService){externalLogger.moduleRun("core/tmobileApp","progressbar.config.js :: progressBarInitializer"),$rootScope.$on("cfpLoadingBar:loading",function(event,data){var attrs=progressBarService.getButton();if(attrs){$log.log("button disabled started......................"),attrs.$set("disabled",!0);var htmlElements=progressBarService.getButtonElements();angular.forEach(htmlElements,function(element,key){element&&(element.disabled=!0,element.style.pointerEvents="none")})}}),$rootScope.$on("cfpLoadingBar:completed",function(event,data){var attrs=progressBarService.getButton();if(attrs){$log.log("button disabled stopped......................"),attrs.$set("disabled",!1);var htmlElements=progressBarService.getButtonElements();angular.forEach(htmlElements,function(element,key){element&&(element.disabled=!1,element.style.pointerEvents="auto")}),progressBarService.setButtonElements(void 0),progressBarService.setButton(void 0)}})}configProgressBar.$inject=["cfpLoadingBarProvider","globalConfig"],progressBarInitializer.$inject=["$log","$rootScope","progressBarService"],angular.module("tmobileApp").config(configProgressBar).run(progressBarInitializer)}(angular,externalLogger),function(){"use strict";function priceOdometerController($scope,$element,$timeout){function spinOdometer(newValue,oldValue){function updatePrice(elm,newValue,oldValue){var od=new Odometer({el:elm,value:oldValue,minIntegerLen:2});od.update(newValue)}newValue="1"+newValue,oldValue="1"+oldValue,updatePrice($element[0],newValue,oldValue)}var doSpin;doSpin=_.isEmpty($scope.spin)||_.isUndefined($scope.spin)?!1:$scope.spin&&"true"===$scope.spin,$timeout(function(){doSpin&&spinOdometer($scope.priceToSpin,"0")}),$scope.$watch("priceToSpin",function(newValue,oldValue){oldValue!==newValue&&doSpin&&spinOdometer(newValue,oldValue)})}function priceOdometerDirective(){return{restrict:"A",scope:{spin:"=priceOdometer",priceToSpin:"@"},controller:priceOdometerController}}priceOdometerController.$inject=["$scope","$element","$timeout"],angular.module("tmobileCore").directive("priceOdometer",priceOdometerDirective)}(),function(angular){"use strict";function phoneInputFn($filter,$browser){return{require:"ngModel",link:function($scope,$element,$attrs,ngModelCtrl){var listener=function(){var value=$element.val().replace(/[^0-9]/g,""),cursorPos=$element[0].selectionStart;$element.val($filter("tel")(value,$attrs.eltype)),11!==$element.val().length&&angular.equals($attrs.eltype,"ssn")&&(4===cursorPos||7===cursorPos?$element[0].setSelectionRange(cursorPos+1,cursorPos+1):$element[0].setSelectionRange(cursorPos,cursorPos))};ngModelCtrl.$parsers.push(function(viewValue){return viewValue.replace(/[^0-9]/g,"").slice(0,10)}),ngModelCtrl.$render=function(){$element.val($filter("tel")(ngModelCtrl.$viewValue,$attrs.eltype))},$element.bind("change",listener),$element.bind("keydown",function(event){var key=event.keyCode;91===key||key>15&&19>key||key>=37&&40>=key||$browser.defer(listener)}),$element.bind("paste cut",function(){$browser.defer(listener)})}}}var moduleName="tmobileCore",directiveName="phoneInput";angular.module(moduleName).directive(directiveName,phoneInputFn)}(angular),function(angular){"use strict";function onlyAlphanumericDirectiveConstructor($browser){return{require:"ngModel",link:function(scope,element,attrs,ngModelCtrl){function listener(){var cursorPos=element[0].selectionStart,value=element.val().replace(/[^a-zA-Z0-9]/g,"");element.val(value),element[0].setSelectionRange(cursorPos,cursorPos)}function removeNonAlphaNumeric(inputValue){if(!inputValue)return"";var cleanInputValue=inputValue.replace(/[^a-zA-Z0-9]/g,"");return cleanInputValue!==inputValue&&(ngModelCtrl.$setViewValue(cleanInputValue),ngModelCtrl.$render()),cleanInputValue}function render(){element.val(ngModelCtrl.$viewValue,!1)}function keyDownHandler(event){var key=event.keyCode;if(!(9===key||46===key||91===key||key>15&&19>key||key>=35&&40>=key))return event.ctrlKey===!0&&65===key?!0:void $browser.defer(listener)}function cutPasteHandler(){$browser.defer(listener)}ngModelCtrl.$render=render,ngModelCtrl.$parsers.push(removeNonAlphaNumeric),element.bind("change",listener),element.bind("keydown",keyDownHandler),element.bind("paste cut",cutPasteHandler)}}}onlyAlphanumericDirectiveConstructor.$inject=["$browser"],angular.module("tmobileCore").directive("onlyAlphanumeric",onlyAlphanumericDirectiveConstructor)}(angular),function(angular){"use strict";function OfferModalPopupFunction($modal,pdlService,pdlConstant){return{restrict:"A",scope:{htmlContent:"=",modalSize:"@",header:"=",cta:"=",imageUrl:"=",showBackButton:"=",showBackButtonAlways:"="},link:function(scope,elm){elm.bind("click keypress",function(event){if(event.stopPropagation(),13===event.which||"click"===event.type){var modalCloseData={modalID:pdlConstant.MODALID.OFFER_MODAL_POPUP_ID,modalName:pdlConstant.EVENT_ATTRIBUTES.STEP_NAME.offerModalPopup};$modal.open({size:scope.modalSize,controller:"OfferTextModalPopupController",controllerAs:"vm",templateUrl:"app/core/directives/offerTextModalPopup/offerTextModalPopup.html",resolve:{htmlContent:function(){return scope.htmlContent},header:function(){return scope.header},cta:function(){return scope.cta},imageUrl:function(){return scope.imageUrl},showBackButton:function(){return scope.showBackButton},showBackButtonAlways:function(){return scope.showBackButtonAlways}}}).result.then(function(){},function(){pdlService.setModalBackDropCloseEvent(modalCloseData)})}})}}}OfferModalPopupFunction.$inject=["$modal","pdlService","pdlConstant"],angular.module("tmobileCore").directive("offerModal",OfferModalPopupFunction)}(window.angular),function(angular){"use strict";function offerTextModalPopupController(htmlContent,header,cta,imageUrl,showBackButton,showBackButtonAlways,$modalInstance,$window){function close(){$modalInstance.close()}function mobView(){return $window.innerWidth<=768}var vm=this;vm.htmlContent=htmlContent,vm.header=header,vm.cta=cta,vm.imageUrl=imageUrl,vm.close=close,vm.mobView=mobView,vm.showBackButton=showBackButton,vm.showBackButtonAlways=showBackButtonAlways}offerTextModalPopupController.$inject=["htmlContent","header","cta","imageUrl","showBackButton","showBackButtonAlways","$modalInstance","$window"],angular.module("tmobileCore").controller("OfferTextModalPopupController",offerTextModalPopupController)}(window.angular),function(){"use strict";function navScrollItemIntoView(){return{restrict:"A",link:function(scope,element){function scrollLeftView(){var parent=element.parent(),offset=parent.scrollLeft(),navBlockWidth=parent[0].clientWidth,position=element.offset().left,elmWidth=element[0].clientWidth,items=parent[0].getElementsByClassName("nav-item"),totalOffset=0,keepLooping=!0;if(angular.forEach(items,function(value){if(keepLooping){var itemElm=angular.element(value);itemElm.offset().left==position&&(keepLooping=!1),totalOffset+=value.clientWidth}}),totalOffset>offset+navBlockWidth){var scrollLeft=Math.abs(navBlockWidth-totalOffset);parent.animate({scrollLeft:scrollLeft},300)}else if(elmWidth+offset>totalOffset){var scrollRight=totalOffset-elmWidth;parent.animate({scrollLeft:scrollRight},300)}}element.on("click",scrollLeftView),element.on("keypress",function(event){13===event.which&&scrollLeftView()})}}}angular.module("tmobileCore").directive("navScrollItemIntoView",navScrollItemIntoView)}(),function(){"use strict";function navScroll(){return{restrict:"A",link:function(scope,element){function getScrollWidth(){for(var navItems=navBlock[0].getElementsByClassName("nav-item"),width=0,i=0;i<navItems.length;i++)width+=navItems[i].clientWidth;return Math.abs(width-navBlock[0].clientWidth)}function scrollRight(){var scrollLength=navBlock[0].scrollLeft-navBlock[0].clientWidth;navBlock.animate({scrollLeft:scrollLength},1e3,setNextPrevStateApply)}function scrollLeft(){var scrollLength=navBlock[0].scrollLeft+navBlock[0].clientWidth;navBlock.animate({scrollLeft:scrollLength},1e3,setNextPrevStateApply)}function setNextPrevStateApply(){setNextPrevState(),scope.$apply()}function setNextPrevState(){var blockWidth=getScrollWidth(),hasNext=navBlock[0].scrollLeft<blockWidth,hasPrev=navBlock[0].scrollLeft>0;hasNext?navNext.removeClass("disabled"):navNext.addClass("disabled"),hasPrev?navPrev.removeClass("disabled"):navPrev.addClass("disabled")}var navBlock=angular.element(element[0].getElementsByClassName("nav-block")[0]),navPrev=angular.element(element[0].getElementsByClassName("nav-prev")[0]),navNext=angular.element(element[0].getElementsByClassName("nav-next")[0]);navPrev.addClass("disabled"),navBlock.on("mousewheel",setNextPrevState),navBlock.on("scroll",setNextPrevState),navPrev.on("click",scrollRight),navNext.on("click",scrollLeft)}}}angular.module("tmobileCore").directive("navScroll",navScroll)}(),function(){"use strict";function navCarouselResize($window){return{restrict:"A",link:function(scope,element){function scrollLeftView(){var offset=element.scrollLeft(),navBlockWidth=element[0].clientWidth,elmWidth=element[0].clientWidth,items=element[0].getElementsByClassName("nav-item"),totalOffset=0,keepLooping=!0;if(angular.forEach(items,function(value){if(keepLooping){var itemElm=angular.element(value);itemElm.hasClass("active")&&(keepLooping=!1),totalOffset+=value.clientWidth}}),totalOffset>offset+navBlockWidth){var scrollLeft=Math.abs(navBlockWidth-totalOffset);element.animate({scrollLeft:scrollLeft},600)}else if(elmWidth+offset>totalOffset){var scrollRight=totalOffset-elmWidth;element.animate({scrollLeft:scrollRight},600)}}function debounce(func,wait,immediate){var timeout;return function(){var context=this,args=arguments,later=function(){timeout=null,immediate||func.apply(context,args)},callNow=immediate&&!timeout;clearTimeout(timeout),timeout=setTimeout(later,wait),callNow&&func.apply(context,args)}}var positionOnResize=debounce(function(){scrollLeftView()},250);angular.element($window).on("resize",positionOnResize)}}}navCarouselResize.$inject=["$window"],angular.module("tmobileCore").directive("navCarouselResize",navCarouselResize)}(),function(angular,_){"use strict";function controllerFunction($scope){function parse(price){if(_.isNumber(price)&&(price=price.toString()),_.isEmpty(price))return void($scope.formattedPrice=["$","0",""]);var pattern="^\\s*['|\"]?\\s*([\\D]*)?(\\d{1,3}(\\"+$scope.thousandSeparator+"?\\d{3})*)\\"+$scope.decimalSeparator+"(\\d{1,2})",regEx=new RegExp(pattern);price=-1==price.indexOf(".")?parseFloat(price.replace("$","").replace(",","")).toFixed(2):price;var money=regEx.exec(price.toString().replace(/\B(?=(\d{3})+(?!\d))/g,","));_.isEmpty(money)?money=["","",""]:money.splice(0,1),/\d+/.exec(money[0])&&(money=[""].concat(money)),_.isEmpty(money[0])&&(money[0]="$"),money.length>3&&money.splice(2,1),$scope.formattedPrice=money;var centsText="";_.isEmpty(money[2])||_.isUndefined(money[2])||(centsText=" & "+money[2]+" cents"),$scope.displayPrice=money[1]+" "+money[0]+centsText}function setBooleanValues(property,force){var defaultValue=_.isBoolean(force)?force:!1;return _.isBoolean(property)||(property=_.isString(property)?_.isEqual(property.toLowerCase(),"true"):defaultValue),property}$scope.getStrikeThrough=function(){return setBooleanValues($scope.strikeThrough)},_.isEmpty($scope.decimalSeparator)&&($scope.decimalSeparator="."),_.isEmpty($scope.thousandSeparator)&&($scope.thousandSeparator="."===$scope.decimalSeparator?",":"."),(_.isEmpty($scope.decimalClass)||_.isUndefined($scope.decimalClass))&&($scope.decimalClass="decimal-hidden"),parse($scope.price),$scope.$watch("price",function(newVal,oldVal){newVal!==oldVal&&parse(newVal)})}function moneyDirectiveDefinitionObject(){return{restrict:"E",scope:{price:"<",spinThePrice:"<",symbolClass:"@",dollarClass:"@",decimalClass:"@",pennyClass:"@",decimalSeparator:"<",thousandSeparator:"@",showOfferDiscount:"@",strikeThrough:"<",taxLabel:"@"},controller:controllerFunction,template:['<span class="display-inline-flex">',"<span ng-if=\"showOfferDiscount == 'true'\">-</span>",'<span aria-describedby="money_{{$id}}" ng-class="{\'text-strike-through\': getStrikeThrough()}">','<span id="money_{{$id}}" class="sr-only">{{displayPrice}}</span>','<span aria-hidden="true" ng-class="symbolClass">{{formattedPrice[0]}}</span>','<span aria-hidden="true" price-odometer="spinThePrice" price-to-spin="{{formattedPrice[1]}}" ng-class="dollarClass">{{formattedPrice[1]}}</span>','<span aria-hidden="true" ng-class="decimalClass">{{decimalSeparator}}</span>','<span aria-hidden="true" price-odometer="spinThePrice" price-to-spin="{{formattedPrice[2]}}" ng-class="pennyClass">{{formattedPrice[2]}}</span>','<span class="plus-tax-label" ng-if="taxLabel" ng-bind-html="taxLabel"></span>',"</span>","</label>"].join("")}}controllerFunction.$inject=["$scope"],angular.module("tmobileCore").directive("money",moneyDirectiveDefinitionObject)}(angular,_),function(angular){"use strict";function modalAccessibilityConstrunctor1(){return{restrict:"A",link:function(scope,element,attrs){element.removeAttr("role")}}}angular.module("tmobileCore").directive("modalAccessibilit",modalAccessibilityConstrunctor1);
}(angular),function(angular){"use strict";function modalAccessibilityConstrunctor(){return{restrict:"A",link:function(scope,element,attrs){angular.element("div[modal-window='']").attr(attrs.modalAccessibility,element[0].id)}}}angular.module("tmobileCore").directive("modalAccessibility",modalAccessibilityConstrunctor)}(angular),function(angular){"use strict";function attributesRemoveConstrunctor1(){return{restrict:"A",link:function(scope,element){element.removeAttr("tabindex").removeAttr("role")}}}angular.module("tmobileCore").directive("attributesRemove",attributesRemoveConstrunctor1)}(angular),function(angular){"use strict";function loadToolTipFn($window,$localStorage,toggleService){return{restrict:"A",link:function($scope,element,attrs){var elementId="#"+attrs.id,authorText=attrs.authorText;null===$window.sessionStorage.getItem("isNewSession")&&($window.sessionStorage.setItem("isNewSession",!0),$localStorage.loadTooltip=!0),angular.isUndefined($localStorage.loadTooltip)&&($localStorage.loadTooltip=!0),angular.element(elementId).popover({placement:"bottom",html:!0,content:'<p class="legal">'+authorText+'</p><a href="#" class="text-magenta lead pull-right" style="top:5px;right:5px;position: absolute; padding-bottom:5px" data-dismiss="alert"><i class="fa fa-close" aria-label="close"></i></a>',trigger:"manual"});var saveCart=toggleService.model.toggles.saveCart;$window.sessionStorage.getItem("isNewSession")&&$localStorage.loadTooltip&&saveCart&&angular.element("#loadtooltip").popover("show"),angular.element($window.document).on("click",".popover .lead",function(event){angular.element(event.target).parents(".popover").popover("hide"),$localStorage.loadTooltip=!1})}}}loadToolTipFn.$inject=["$window","$localStorage","toggleService"];var moduleName="tmobileApp",directiveName="loadToolTip";angular.module(moduleName).directive(directiveName,loadToolTipFn)}(window.angular),function(){"use strict";function bnLazySrc($window,$document,$log,$interval,$timeout){function LazyImage(element){function isVisible(topFoldOffset,bottomFoldOffset){if(!element.is(":visible"))return!1;null===height&&(height=element.height());var top=element.offset().top,bottom=top+height;return bottomFoldOffset>=top&&top>=topFoldOffset||bottomFoldOffset>=bottom&&bottom>=topFoldOffset||topFoldOffset>=top&&bottom>=bottomFoldOffset}function render(){isRendered=!0,renderSource()}function setSource(newSource){source=newSource,isRendered&&renderSource()}function renderSource(){element[0].src=source}var source=null,isRendered=!1,height=null;return{isVisible:isVisible,render:render,setSource:setSource}}function link($scope,element,attributes){var lazyImage=new LazyImage(element);lazyLoader.addImage(lazyImage),attributes.$observe("bnLazySrc",function(newSource){lazyImage.setSource(newSource)}),$scope.$on("$destroy",function(){lazyLoader.removeImage(lazyImage)})}var lazyLoader=function(){function addImage(image){images.push(image),renderTimer||startRenderTimer(),isWatchingWindow||startWatchingWindow()}function removeImage(image){for(var i=0;i<images.length;i++)if(images[i]===image){images.splice(i,1);break}images.length||(clearRenderTimer(),stopWatchingWindow())}function checkDocumentHeight(){if(!renderTimer){var currentDocumentHeight=doc.height();currentDocumentHeight!==documentHeight&&(documentHeight=currentDocumentHeight,startRenderTimer())}}function checkImages(){$log.log("Checking for visible images...");for(var visible=[],hidden=[],windowHeight=win.height(),scrollTop=win.scrollTop(),topFoldOffset=scrollTop,bottomFoldOffset=topFoldOffset+windowHeight,i=0;i<images.length;i++){var image=images[i];image.isVisible(topFoldOffset,bottomFoldOffset)?visible.push(image):hidden.push(image)}for(var j=0;j<visible.length;j++)visible[j].render();images=hidden,clearRenderTimer(),images.length||stopWatchingWindow()}function clearRenderTimer(){clearTimeout(renderTimer),renderTimer=null}function startRenderTimer(){renderTimer=$timeout(checkImages,renderDelay)}function startWatchingWindow(){isWatchingWindow=!0,win.on("resize.bnLazySrc",windowChanged),win.on("scroll.bnLazySrc",windowChanged),documentTimer=$interval(checkDocumentHeight,documentDelay)}function stopWatchingWindow(){isWatchingWindow=!1,win.off("resize.bnLazySrc"),win.off("scroll.bnLazySrc"),clearInterval(documentTimer)}function windowChanged(){renderTimer||startRenderTimer()}var images=[],renderTimer=null,renderDelay=2e3,win=$($window),doc=$document,documentHeight=doc.height(),documentTimer=null,documentDelay=2e3,isWatchingWindow=!1;return{addImage:addImage,removeImage:removeImage}}();return{link:link,restrict:"A"}}bnLazySrc.$inject=["$window","$document","$log","$interval","$timeout"],angular.module("tmobileCore").directive("bnLazySrc",bnLazySrc)}(),function(angular){"use strict";function isolateClick(){return{restrict:"A",link:function(scope,elem){elem.on("click",function(e){e.stopPropagation()})}}}angular.module("tmobileCore").directive("isolateClick",isolateClick)}(angular),function(_){"use strict";function popoverController($scope){function togglePopover(){vm.isVisable=!vm.isVisable,vm.openCloseText=vm.isVisable?"visible":"hidden",vm.isVisable&&(vm.placement=originalPlacement,findBestFit(vm.placement))}function checkVisible(){return vm.isVisable}function checkSmall(){return vm.isSmall}function getHasContent(){return!_.isEmpty(vm.infoText)}function hidePopover(){vm.isVisable=!1,vm.openCloseText="hidden"}function findBestFit(placement){popover=angular.element(document.getElementById("popover_"+$scope.$id));var minWidth=parseFloat(popover.css("min-width")),maxWidth=parseFloat(popover.css("max-width")),width=getMinWidth(placement);if(minWidth>width)for(var i=0;i<placementArray.length;i++)if(placementArray[i]!==placement&&(width=getMinWidth(placementArray[i]),width>=minWidth)){vm.placement=placementArray[i];break}width>maxWidth&&(width=maxWidth),popover.css("width",width+"px")}function getMinWidth(placement){var parent=angular.element(document.getElementById("popover_control_"+$scope.$id)),parentDims=parent[0].getBoundingClientRect(),availableSpace=0;switch(placement){case"left":availableSpace=parentDims.left-parentDims.width/2;break;case"top":case"bottom":availableSpace=window.innerWidth-parentDims.right+parentDims.width;break;case"right":default:availableSpace=window.innerWidth-parentDims.right-parentDims.width}return availableSpace}var vm=this,popover=null,placementArray=["bottom","left","top","right"];_.isEmpty(vm.placement)&&(vm.placement=placementArray[0]);var originalPlacement=vm.placement;vm.isVisable=!1,vm.openCloseText="hidden",vm.togglePopover=togglePopover,vm.checkVisible=checkVisible,vm.hidePopover=hidePopover,vm.getHasContent=getHasContent,vm.checkSmall=checkSmall}function infoPopover(){return{restrict:"E",replace:!1,scope:{infoText:"@",placement:"@",labelText:"@",isSmall:"@"},controller:popoverController,controllerAs:"vm",bindToController:!0,templateUrl:"app/core/directives/info-popover/info-popover.html"}}popoverController.$inject=["$scope"],angular.module("tmobileCore").directive("infoPopover",infoPopover)}(_),function(angular){"use strict";function bringInViewport($window){return{restrict:"A",scope:{changeTop:"@",stickyElementSelector:"@"},link:function(scope,elem,attrs){function bindFocus(element){element.focus(function(){if(!isElementInViewport()){var offset,elOffset=element.offset().top,elHeight=element.height(),windowHeight=innerWindowHeight;offset=windowHeight>elHeight?elOffset-(windowHeight/2-elHeight/2):elOffset,$window.scrollTo(0,offset-bladeHeight)}})}function isElementInViewport(){var el=elem[0],rect=el.getBoundingClientRect(),windowTop=scope.changeTop||scope.stickyElementSelector?bladeHeight:0;return rect.top>=windowTop&&rect.left>=0&&rect.bottom<=innerWindowHeight&&rect.right<=$window.innerWidth}var innerWindowHeight=$window.innerHeight-160,bladeHeight=0;attrs.ngBindHtml?attrs.$observe("ngBindHtml",function(){angular.forEach(elem.find("a"),function(anchor){bindFocus($(anchor))})}):bindFocus(elem),scope.changeTop&&(bladeHeight=angular.element('div[set-class-when-at-top="fix-to-top"]').height()),scope.stickyElementSelector&&(bladeHeight=angular.element(scope.stickyElementSelector).height())}}}bringInViewport.$inject=["$window"],angular.module("tmobileCore").directive("bringInViewport",bringInViewport)}(angular),function(angular){"use strict";function bindHtmlCompileConstructor($parse,$compile,$log,$timeout,pdlService,commonUtils){return{restrict:"A",link:function(scope,element,attrs){scope.$watch(function(){return scope.$eval(attrs.bindHtmlCompile)},function(value){element.html(value&&value.toString());var compileScope=scope;attrs.bindHtmlScope&&(compileScope=scope.$eval(attrs.bindHtmlScope)),$compile(element.contents())(compileScope)})}}}bindHtmlCompileConstructor.$inject=["$parse","$compile","$log","$timeout","pdlService","commonUtils"],angular.module("tmobileCore").directive("bindHtmlCompile",bindHtmlCompileConstructor)}(angular),function(angular){"use strict";function selectAutoFocus(){return{restrict:"A",scope:{autoid:"@"},link:function(scope,element,attrs){element.bind("keydown keypress click",function(event){(13===event.which||1===event.which)&&angular.element("#"+scope.autoid).focus()})}}}angular.module("tmobileCore").directive("autoFocus",selectAutoFocus)}(angular),function(angular){"use strict";function authoredRedirectModalPopupController($scope,$window,$modalInstance,authoredRedirectUrlService,apiURLs){function cancel(){$modalInstance.dismiss("this is result for dismiss")}function submitData(){function successCallback(){$modalInstance.close(data),$window.location.reload()}function errorCallback(){}var data={contentPath:vm.location,actionType:vm.actionType,redirectTarget:vm.redirectTarget,redirectType:vm.redirectType},queryUrl=["contentPath="+data.contentPath,"actionType="+data.actionType,"redirectTarget="+data.redirectTarget,"redirectType="+data.redirectType].join("&"),url=apiURLs.authoredRedirectURLUpdate+queryUrl;authoredRedirectUrlService.postAuthoredRedirectUrlData(url).then(successCallback,errorCallback)}function isEditMode(){return"updateRedirectUrl"==vm.actionType?!0:!1}var vm=this,isolateScope=$scope.$parent;vm.location=isolateScope.path,vm.actionType=isolateScope.actiontype,vm.redirectTarget=isolateScope.redirecttarget,vm.redirectType=isolateScope.redirecttype,vm.deactivationDate=isolateScope.deactivationDate,vm.popupTitle=isolateScope.popuptitle,vm.isEditMode=isEditMode,vm.submitData=submitData,vm.cancel=cancel}function authoredRedirectModalPopupFunction($modal,$log){var RETURN_KEY=13;return{restrict:"A",scope:{path:"=",popuptitle:"@",redirecttarget:"=",redirecttype:"=",modalSize:"@",actiontype:"@",deactivationDate:"="},link:function(scope,element,attrs){function successCallback(result){scope.path=result.path,scope.popupTitle=result.popuptitle,scope.actiontype=result.actiontype,scope.redirectTarget=result.redirecttarget,scope.redirectType=result.redirecttype}function failureCallback(result){$log.log("called $modalInstance.dismiss(): ",result)}element.bind("click keypress",function(event){var keyCode=angular.isUndefined(event.which)?event.keyCode:event.which;if("click"===event.type||keyCode===RETURN_KEY){event.stopPropagation();var modalInstance=$modal.open({size:scope.modalSize,templateUrl:"app/core/directives/authoredRedirectModalPopup/authoredRedirectModalPopup.html",controller:authoredRedirectModalPopupController,controllerAs:"vm",bindToController:!0,scope:scope});modalInstance.result.then(successCallback,failureCallback)}})}}}authoredRedirectModalPopupController.$inject=["$scope","$window","$modalInstance","authoredRedirectUrlService","apiURLs"],authoredRedirectModalPopupFunction.$inject=["$modal","$log"],angular.module("tmobileCore").controller("authoredRedirectModalPopupController",authoredRedirectModalPopupController).directive("authoredRedirectModal",authoredRedirectModalPopupFunction)}(angular),function(angular){"use strict";function appendAriaLabelConstrunctor(){return{restrict:"A",scope:{planData:"@"},link:function(scope,element,attrs){var ariaLabelValue;attrs.$observe("ngBindHtml",function(){ariaLabelValue=element.text();var plan=JSON.parse(scope.planData);plan.recommended?angular.element("#"+plan.code).attr("aria-label","recommended service, "+plan.monthlyPrice+" , montly ,"+plan.name+" , "+ariaLabelValue):angular.element("#"+plan.code).attr("aria-label",plan.monthlyPrice+" , montly ,"+plan.name+" , "+ariaLabelValue)})}}}angular.module("tmobileCore").directive("appendAriaLabel",appendAriaLabelConstrunctor)}(window.angular),function(angular){"use strict";function appendClickEventConstrunctor($compile){return{restrict:"A",link:function(scope,element){scope.$watch(function(){return element.text()},function(){var pathname,pdlObjectString;angular.forEach(element.find("a[href^='modal:']"),function(anchor){pathname=anchor.href.split(/:(.+)?/)[1],pdlObjectString="{ 'assetType': 'Link', 'targetUrl': '', 'ctaName': '"+anchor.text+"', 'type':'navigation', 'isNav': true }",anchor.setAttribute("modal-popup",""),anchor.setAttribute("dialog-description",anchor.text),anchor.setAttribute("dialog-id","autoPayDialog"),anchor.setAttribute("modal-size","lg"),anchor.setAttribute("modal-hide-btn","hidden"),anchor.setAttribute("modal-html",pathname),anchor.setAttribute("href","#"),anchor.setAttribute("pdl-event","click"),anchor.setAttribute("pdl-nav-or-click-event",pdlObjectString)}),$compile(element.contents())(scope)})}}}appendClickEventConstrunctor.$inject=["$compile"],angular.module("tmobileApp").directive("appendClickEvent",appendClickEventConstrunctor)}(window.angular),function(angular){"use strict";function addSeoModalPopupFunction($modal,compUtils,$log,$window){return{restrict:"A",scope:{modalSize:"@"},link:function(scope,elm,attrs,$modalInstance){elm.bind("click keypress",function(event){if(13===event.which||"click"===event.type){event.stopPropagation();var modalInstance=$modal.open({size:scope.modalSize,controller:"addSeoModalPopupController",controllerAs:"vm",templateUrl:"app/core/directives/addSeoModalPopup/addSeoModalPopup.html"});modalInstance.result.then(function(result){$log.info("called $modalInstance.close()"),$window.location.reload(!0)},function(result){$log.info("called $modalInstance.dismiss()")})}})}}}addSeoModalPopupFunction.$inject=["$modal","compUtils","$log","$window"],angular.module("tmobileCore").directive("addSeoModalPopup",addSeoModalPopupFunction)}(window.angular),function(angular){"use strict";function addSeoModalPopupControllerFunction($modalInstance,$window,$log,seoService,apiURLs){function cancel(){$modalInstance.dismiss("cancel")}function submitData(){function successCallback(){$modalInstance.close(data)}function errorCallback(){$log.log(" request error")}var data={url:angular.isDefined(vm.url)?vm.url:"",canonicalUrl:_.get(vm,"canonicalUrl",""),englishTitle:_.get(vm,"englishTitle",""),spanishTitle:_.get(vm,"spanishTitle",""),englishDescription:_.get(vm,"englishDescription",""),spanishDescription:_.get(vm,"spanishDescription",""),englishKeywords:_.get(vm,"englishKeywords",""),spanishKeywords:_.get(vm,"spanishKeywords",""),browseType:_.get(vm,"selectedBrowseType",""),action:"add"},hostUrl=apiURLs.seoDataUpdate;seoService.postseoData(hostUrl,data).then(successCallback,errorCallback)}function mobView(){return $window.innerWidth>768}var vm=this;vm.model=seoService.model,vm.browseType=vm.model.browseType,vm.selectedBrowseType=vm.browseType[0],vm.cancel=cancel,vm.submitData=submitData,vm.mobView=mobView,vm.addCategory=!0}addSeoModalPopupControllerFunction.$inject=["$modalInstance","$window","$log","seoService","apiURLs"],angular.module("tmobileCore").controller("addSeoModalPopupController",addSeoModalPopupControllerFunction)}(window.angular),function(angular){"use strict";function dataFactoryServiceConstructor(globalConfig,CacheFactory,DFRequest,$injector,$log,$q,commonUtils){function getCacheObject(storageMode,expiry){var cacheName="datafactory.cache",cacheConf={storagePrefix:"tmng.",deleteOnExpire:"aggressive",storageMode:storageMode};return expiry&&(cacheName="datafactory.cache."+expiry,cacheConf.maxAge=expiry),storageMode&&(cacheName=cacheName+"."+storageMode),CacheFactory.get(cacheName)||CacheFactory.createCache(cacheName,cacheConf),CacheFactory.get(cacheName)}function obtainVO(dataKeyName,requestData,callBack){var defaultServices={defaultService:"noservice",defaultSessionService:"noservice"},dataService=dataFactoryConf.dataServices[dataKeyName],cacheName=null,dataCache=null,cacheDataKey=null,dataObject=null,serviceName=null,serviceInstance=null,expireInMs=null;if(dataService||(dataService=dataFactoryConf.dataServices.defaultService),dataService){if(cacheName=dataService.storageOption,expireInMs=dataService.expireInMs,dataCache=getCacheObject(cacheName,expireInMs),cacheDataKey=dataKeyName+angular.toJson(requestData.input),dataObject=dataCache.get(cacheDataKey),requestData.conf.resetCache&&(dataObject=void 0),$log.log("defaultServices[dataKeyName]:: ",defaultServices[dataKeyName]),dataObject||!angular.isUndefined(defaultServices[dataKeyName]))return callBack&&callBack(dataObject),dataObject;if(serviceName=dataService.serviceName,serviceInstance=$injector.get(serviceName),!serviceInstance)return{};serviceInstance.obtainObject(requestData.input,function(data){dataObject=angular.copy(data),dataCache.put(cacheDataKey,dataObject),callBack(dataObject)})}}function obtainObject(dataKeyName,requestData,isObjectExists){var dataService,defaultServices={defaultService:"noservice",defaultSessionService:"noservice"};angular.isObject(dataKeyName)?(dataService=dataKeyName,dataKeyName=dataService.serviceName):dataService=dataFactoryConf.dataServices[dataKeyName];var cacheName=null,dataCache=null,cacheDataKey=null,dataObject=null,serviceName=null,serviceInstance=null,expireInMs=null;return dataService||(dataService=dataFactoryConf.dataServices.defaultService),dataService&&(cacheName=dataService.storageOption,expireInMs=dataService.expireInMs,dataCache=getCacheObject(cacheName,expireInMs),cacheDataKey=dataKeyName+(requestData.input?angular.toJson(requestData.input):""),dataObject=dataCache.get(cacheDataKey),isObjectExists)?dataObject:$q(function(resolve,reject){var methodName;dataService&&(requestData.conf.resetCache&&(dataObject=void 0),$log.log("defaultServices[dataKeyName]:: ",defaultServices[dataKeyName]),!dataObject&&angular.isUndefined(defaultServices[dataKeyName])?(serviceName=dataService.serviceName,serviceInstance=$injector.get(serviceName),serviceInstance?(methodName=dataService.methodName,methodName||(methodName="obtainObject",requestData.args=[requestData.input]),serviceInstance[methodName].apply(null,requestData.args||[]).then(function(data){if(dataObject=data){if(dataService.cacheKeys){var inputObj={};angular.forEach(dataService.cacheKeys,function(v){inputObj[v.key]=commonUtils.searchJson(data,v.jsonPath)}),cacheDataKey=dataKeyName+angular.toJson(inputObj)}dataCache.put(cacheDataKey,dataObject),resolve(dataObject)}else reject(dataObject)})):reject(dataObject)):resolve(dataObject))})}function setVO(dataKeyName,requestData,responseData){var cacheName=dataFactoryConf.dataServices[dataKeyName].storageOption,expireInMs=dataFactoryConf.dataServices[dataKeyName].expireInMs,dataCache=getCacheObject(cacheName,expireInMs),cacheDataKey=dataKeyName+angular.toJson(requestData.input);responseData&&dataCache.put(cacheDataKey,responseData)}function isObjectExists(dataKeyName,requestData){return obtainObject(dataKeyName,requestData,!0)}var svc=this,dataFactoryConf={dataServices:globalConfig.dataCacheServices};return svc.getCacheObject=getCacheObject,svc.DFRequest=DFRequest,svc.getVO=obtainVO,svc.getObject=obtainObject,svc.setVO=setVO,svc.isObjectExists=isObjectExists,svc}dataFactoryServiceConstructor.$inject=["globalConfig","CacheFactory","DFRequest","$injector","$log","$q","commonUtils"],angular.module("tmobileCore").service("dataFactory",dataFactoryServiceConstructor)}(angular),function(angular){"use strict";function DFRequestFactoryConstructor(){var DFRequest=function(){var input,conf={resetCache:!1};return{conf:conf,input:input}};return DFRequest}angular.module("tmobileCore").factory("DFRequest",DFRequestFactoryConstructor)}(angular),function(angular,lodash){"use strict";function userInfoControllerConstructor(commonUtils,checkOutValidationUtil,checkOutModelService,toggleService,checkOutConstants,globalValue,cartStorage){var vm=this;vm.uiType=vm.sourceType.type,vm.checkoutInfo=checkOutModelService.model.checkOutInfo,vm.validatePhoneOnChange=checkOutValidationUtil.validatePhoneOnChange,vm.SECTIONS={INFOANDSHIPPING:checkOutConstants.SECTIONS.INFOANDSHIPPING},vm.toggles=toggleService.model.toggles;var creditCheckTpp=lodash.get(globalValue.authorValue,"checkout.personalInfoTpp"),isTPPON=lodash.get(toggleService.model,"toggles.isTPPON",!1);switch(vm.creditCheck=!1,localStorage.setItem("isCheckoutModalOpenFlow","false"),vm.uiType){case vm.SECTIONS.INFOANDSHIPPING:vm.emailRegex=/^\s*[\w\-\+_]+(\.[\w\-\+_]+)*\@[\w\-\+_]+\.[\w\-\+_]+(\.[\w\-\+_]+)*\s*$/,vm.userInfoAuthorValue={title:isTPPON?commonUtils.searchJson(creditCheckTpp,"personalInfoHeaderTPP"):commonUtils.searchJson(vm.authorValue,"personalInfoHeader"),firstName:commonUtils.searchJson(vm.authorValue,"firstName"),firstNameError:commonUtils.searchJson(vm.authorValue,"firstNameError"),firstNameHelperText:commonUtils.searchJson(vm.authorValue,"firstNameHelperText"),middleName:commonUtils.searchJson(vm.authorValue,"middleName"),lastName:commonUtils.searchJson(vm.authorValue,"lastName"),lastNameError:commonUtils.searchJson(vm.authorValue,"lastNameError"),lastNameHelperText:commonUtils.searchJson(vm.authorValue,"lastNameHelperText"),emailAddress:commonUtils.searchJson(vm.authorValue,"emailAddress"),emailAddressError:commonUtils.searchJson(vm.authorValue,"emailAddressError"),emailAddrHelperText:commonUtils.searchJson(vm.authorValue,"emailAddrHelperText"),phoneNumber:commonUtils.searchJson(vm.authorValue,"phoneNumber"),phoneNumberError:commonUtils.searchJson(vm.authorValue,"phoneNumberError"),phoneNumberFormatError:commonUtils.searchJson(vm.authorValue,"phoneNumberFormatError"),phoneNumHelperText:commonUtils.searchJson(vm.authorValue,"phoneNumHelperText"),userConsent:commonUtils.searchJson(vm.authorValue,"userConsent"),ctaText:commonUtils.searchJson(vm.authorValue,"ctaText"),ssnEntrustImage:commonUtils.searchJson(vm.authorValue,"ssnEntrustImage"),privacyPolicyLink:commonUtils.searchJson(vm.authorValue,"privacyPolicyLink"),portInEligibilityLink:isTPPON?commonUtils.searchJson(creditCheckTpp,"portInEligibilityLinkTPP"):commonUtils.searchJson(vm.authorValue,"portInEligibilityLink")};break;case"applicationForm":vm.emailRegex=/^\s*[\w\-\+_]+(\.[\w\-\+_]+)*\@[\w\-\+_]+\.[\w\-\+_]+(\.[\w\-\+_]+)*\s*$/,vm.userInfoAuthorValue={title:commonUtils.searchJson(vm.authorValue,"personalInfoHeader"),firstName:commonUtils.searchJson(vm.authorValue,"firstName"),firstNameError:commonUtils.searchJson(vm.authorValue,"firstNameError"),firstNameHelperText:commonUtils.searchJson(vm.authorValue,"firstNameHelperText"),middleName:commonUtils.searchJson(vm.authorValue,"middleName"),lastName:commonUtils.searchJson(vm.authorValue,"lastName"),lastNameError:commonUtils.searchJson(vm.authorValue,"lastNameError"),lastNameHelperText:commonUtils.searchJson(vm.authorValue,"lastNameHelperText"),emailAddress:commonUtils.searchJson(vm.authorValue,"emailAddress"),emailAddressError:commonUtils.searchJson(vm.authorValue,"emailAddressError"),emailAddrHelperText:commonUtils.searchJson(vm.authorValue,"emailAddrHelperText"),phoneNumber:commonUtils.searchJson(vm.authorValue,"phoneNumber"),phoneNumberError:commonUtils.searchJson(vm.authorValue,"phoneNumberError"),phoneNumberFormatError:commonUtils.searchJson(vm.authorValue,"phoneNumberFormatError"),phoneNumHelperText:commonUtils.searchJson(vm.authorValue,"phoneNumHelperText"),userConsent:commonUtils.searchJson(vm.authorValue,"userConsent"),ctaText:commonUtils.searchJson(vm.authorValue,"ctaText"),ssnEntrustImage:commonUtils.searchJson(vm.authorValue,"ssnEntrustImage"),privacyPolicyLink:commonUtils.searchJson(vm.authorValue,"privacyPolicyLink")};break;case"callMeNowModal":var callMeNowUserConsent=[{consentText:commonUtils.searchJson(vm.authorValue,"consentText")}];vm.userInfoAuthorValue={title:commonUtils.searchJson(vm.authorValue,"header"),subTitle:commonUtils.searchJson(vm.authorValue,"subHeader"),firstName:commonUtils.searchJson(vm.authorValue,"firstName"),firstNameError:commonUtils.searchJson(vm.authorValue,"firstNameError"),firstNameHelperText:commonUtils.searchJson(vm.authorValue,"firstNameHelperText"),lastName:commonUtils.searchJson(vm.authorValue,"lastName"),lastNameError:commonUtils.searchJson(vm.authorValue,"lastNameError"),lastNameHelperText:commonUtils.searchJson(vm.authorValue,"lastNameHelperText"),phoneNumber:commonUtils.searchJson(vm.authorValue,"phoneNumber"),phoneNumberError:commonUtils.searchJson(vm.authorValue,"phoneNumberError"),phoneNumberFormatError:commonUtils.searchJson(vm.authorValue,"phoneNumberFormatError"),phoneNumHelperText:commonUtils.searchJson(vm.authorValue,"phoneNumHelperText"),zipCode:commonUtils.searchJson(vm.authorValue,"zipLabel"),zipCodeHelperText:commonUtils.searchJson(vm.authorValue,"zipHelper"),zipCodeRequiredError:commonUtils.searchJson(vm.authorValue,"zipError"),zipCodePatternError:commonUtils.searchJson(vm.authorValue,"zipInvalidPatternError"),userConsent:callMeNowUserConsent,ctaText:commonUtils.searchJson(vm.authorValue,"ctaText"),resultModalHeader:commonUtils.searchJson(vm.authorValue,"resultModalHeader"),resultModalImmediateSubHeader:commonUtils.searchJson(vm.authorValue,"resultModalImmediateSubHeader"),resultModalLateSubHeader:commonUtils.searchJson(vm.authorValue,"resultModalLateSubHeader")}}if(vm.userInfoAuthorValue.userConsent&&(vm.userConsentIndex=vm.userInfoAuthorValue.userConsent.length-1,angular.isObject(vm.userInfoAuthorValue.userConsent[vm.userConsentIndex])||(vm.userInfoAuthorValue.userConsent[vm.userConsentIndex]=angular.fromJson(vm.userInfoAuthorValue.userConsent[vm.userConsentIndex]))),isTPPON&&("true"===cartStorage.getHardCreditCheck()||"true"===cartStorage.getSoftCreditCheck())){var firstName=lodash.get(checkOutModelService.model.checkOutInfo.personalInfo,checkOutConstants.VERIFY_ID.FIRSTNAME),lastName=lodash.get(checkOutModelService.model.checkOutInfo.personalInfo,checkOutConstants.VERIFY_ID.LASTNAME);angular.isUndefined(firstName)&&angular.isUndefined(lastName)?vm.creditCheck=!1:vm.creditCheck=!0}vm.isTPPON=isTPPON}userInfoControllerConstructor.$inject=["commonUtils","checkOutValidationUtil","checkOutModelService","toggleService","checkOutConstants","globalValue","cartStorage"],angular.module("tmobileApp").controller("userInfoController",userInfoControllerConstructor)}(window.angular,window._),function(angular){"use strict";var userInfoComponentConstructor={templateUrl:"app/core/components/userInfo/userInfo.html",controller:"userInfoController as vm",bindings:{sourceType:"<",authorValue:"<",submitAction:"=",inputData:"=",errors:"<",icons:"<",hideShipping:"<",modalName:"<",formName:"<",userConsent:"<"}};angular.module("tmobileApp").component("userInfo",userInfoComponentConstructor)}(window.angular),function(angular){"use strict";function upperFunnelCreditCheckResultController(upperFunnelCreditCheckUtils){var vm=this;vm.keyValue={},upperFunnelCreditCheckUtils.showError?(vm.keyValue.formSubmitImage=vm.authorValue.formSubmitErrorImage,vm.keyValue.formSubmitTitle=vm.authorValue.formSubmitErrorTitle,vm.keyValue.formSubmitHeader=vm.authorValue.formSubmitErrorHeader,vm.keyValue.formSubmitSubHeader=vm.authorValue.formSubmitErrorSubHeader):(vm.keyValue.formSubmitImage=vm.authorValue.formSubmitSuccessImage,vm.keyValue.formSubmitTitle=vm.authorValue.formSubmitSuccessTitle,vm.keyValue.formSubmitHeader=vm.authorValue.formSubmitSuccessHeader,vm.keyValue.formSubmitSubHeader=vm.authorValue.formSubmitSuccessSubHeader)}upperFunnelCreditCheckResultController.$inject=["upperFunnelCreditCheckUtils"],angular.module("tmobileCore").controller("UpperFunnelCreditCheckResultController",upperFunnelCreditCheckResultController)}(window.angular),function(angular){"use strict";var upperFunnelCreditCheckResult={bindings:{authorValue:"<"},controller:"UpperFunnelCreditCheckResultController",controllerAs:"vm",templateUrl:"app/core/components/upperFunnelCreditCheckResult/upperFunnelCreditCheckResult.tpl.html"};angular.module("tmobileCore").component("upperFunnelCreditCheckResult",upperFunnelCreditCheckResult)}(window.angular),function(angular){"use strict";function upperFunnelCreditCheckFactory(){var showError=!1;return{showError:showError}}angular.module("tmobileCore").factory("upperFunnelCreditCheckUtils",upperFunnelCreditCheckFactory)}(window.angular),function(angular){"use strict";function upperFunnelCreditCheckController($log,$state,upperFunnelCreditCheckUtils,emailUtil){function toggleForm(){vm.showApplicationForm=!0}function submitUFFCForm(userForm){var dataToSendToSelligent={};if(userForm&&(userForm.isSubmitted=!0,!userForm.$invalid&&!userForm.$pending)){var middleName=_.get(vm.userInformation,"middleName"," ");middleName.indexOf(" ")<0&&(middleName=" "+middleName+" "),dataToSendToSelligent={firstName:vm.userInformation.firstName,fullName:vm.userInformation.firstName+middleName+vm.userInformation.lastName,email:vm.userInformation.email,inWorkingHours:_.get(vm.authorValue.displayCallMeNow,"isOffHours")?"OFF":"ON"},emailUtil.sendOrderConfirmationEmail(dataToSendToSelligent,!0).then(function(response){$log.log("Here's the response from the Selligent API: ",response)})["catch"](function(error){$log.log("Something went wrong. Here's the error from the Selligent API: ",error)}),upperFunnelCreditCheckUtils.showError="Error"===vm.userInformation.firstName,$state.go(vm.authorValue.ufccSubmitRouteName)}}var vm=this;vm.userInformation={},vm.showApplicationForm=!1,vm.toggleForm=toggleForm,vm.submitUFFCForm=submitUFFCForm}upperFunnelCreditCheckController.$inject=["$log","$state","upperFunnelCreditCheckUtils","emailUtil"],angular.module("tmobileCore").controller("UpperFunnelCreditCheckController",upperFunnelCreditCheckController)}(window.angular),function(angular){"use strict";var upperFunnelCreditCheck={bindings:{authorValue:"<"},controller:"UpperFunnelCreditCheckController",controllerAs:"vm",templateUrl:"app/core/components/upperFunnelCreditCheck/upperFunnelCreditCheck.tpl.html"};angular.module("tmobileCore").component("upperFunnelCreditCheck",upperFunnelCreditCheck)}(window.angular),function(angular,lodash){"use strict";function tradeValueScreenControllerFunction($sce,$filter,$window,$modalInstance,cartHttpDataService,cartCommonOperationsService,cartStorage,selectedLine,globalValue,keyValues,tmobNotificationService,pdlService,toggleService){function close(data){var tradeInVal={modalName:"Device Trade-in Confirmation"};pdlService.callTradeInModalCloseEvent(tradeInVal),tmobNotificationService.addNotification.push("cart025"),tmobNotificationService.showNotification(tmobNotificationService.addNotification),$modalInstance.close()}function submit(){var body;"STANDARD"===vm.model.formData.tradeInOption?(body={quoteId:"0",tradeInPrice:vm.devicePrice,tradeInSalePrice:vm.devicePrice,deviceSku:"11111111",deviceName:vm.tradeInDetails.deviceModel,deviceCarrier:vm.tradeInDetails.carrier,deviceMake:vm.tradeInDetails.make,deviceModel:vm.tradeInDetails.deviceModel,disposition:"ACCEPT",tradeInType:vm.model.formData.tradeInOption,deviceCondition:vm.tradeInDetails.deviceConditionOption,suppressFmv:"true"},body=vm.setDeviceImei(body),cartHttpDataService.addTradeIn(vm.lineId,body).then(function(cartResponse){cartCommonOperationsService.updateStructCartData(),$modalInstance.close(),tmobNotificationService.addNotification.push("cart024"),tmobNotificationService.showNotification(tmobNotificationService.addNotification)})):(body={quoteId:"0",tradeInPrice:vm.devicePrice,tradeInSalePrice:vm.devicePrice,deviceSku:"11111111",deviceName:vm.tradeInDetails.deviceModel,deviceCarrier:vm.tradeInDetails.carrier,
deviceMake:vm.tradeInDetails.make,deviceModel:vm.tradeInDetails.deviceModel,disposition:"ACCEPT",tradeInType:vm.model.formData.tradeInOption,deviceCondition:vm.tradeInDetails.deviceConditionOption,suppressFmv:"true"},body=vm.setDeviceImei(body),cartHttpDataService.addTradeIn(vm.lineId,body).then(function(cartResponse){cartCommonOperationsService.updateStructCartData(),$modalInstance.close(),tmobNotificationService.addNotification.push("cart023"),tmobNotificationService.showNotification(tmobNotificationService.addNotification)})),vm.pdlData={userSelection:vm.model.formData.tradeInOption},pdlService.callPdlClickForSubmitTradeIn(vm.pdlData)}function setDeviceImei(body){var toggles=toggleService.model.toggles;return toggles.isDcpV3ApiEnabled?body.deviceImei=vm.tradeInDetails.imei:body.deviceIMEI=vm.tradeInDetails.imei,body}function mobileView(){vm.isMobileView=$window.innerWidth<767?!0:!1}function readMoreStandard(){vm.isStandardShort=!1,vm.isStandardClose=!0,vm.isStandardOpen=!1}function readLessStandard(){vm.isStandardShort=!0,vm.isStandardClose=!1,vm.isStandardOpen=!0}function readMorePromo(){vm.isPromoShort=!1,vm.isPromoClose=!0,vm.isPromoOpen=!1}function readLessPromo(){vm.isPromoShort=!0,vm.isPromoClose=!1,vm.isPromoOpen=!0}function htmlToPlaintext(text){return text?String(text).replace(/<[^>]+>/gm,""):""}function processPromoDescription(){var trimText=null,promoTradeInLegalText=htmlToPlaintext(vm.promoData.longDescription);promoTradeInLegalText.length>150&&(vm.isPromoShort=!0,vm.isPromoClose=!1,vm.isPromoOpen=!0,trimText=$filter("limitTo")(vm.promoData.longDescription,150,0),vm.authorValue.promoTradeInLegalText=$sce.trustAsHtml(trimText))}function processLegalStandard(){var trimText=null,standardTradeInLegalText=htmlToPlaintext(vm.authorValue.tradeInValueScreen.standardTradeInLegalText);standardTradeInLegalText.length>150&&(vm.isStandardShort=!0,vm.isStandardClose=!1,vm.isStandardOpen=!0,trimText=$filter("limitTo")(vm.authorValue.tradeInValueScreen.standardTradeInLegalText,150,0),vm.authorValue.standardTradeInLegalText=$sce.trustAsHtml(trimText))}var vm=this;vm.pdlData={},vm.model={formData:{}},vm.authorValue=globalValue.authorValue.rootPage.tradeInTool,vm.tradeInDetails=keyValues,vm.lineId=selectedLine.lineId,vm.close=close,vm.submit=submit,vm.isMobileView=!1,vm.is_open=!1,vm.promoData=vm.tradeInDetails.promoData,vm.devicePrice=vm.tradeInDetails.devicePrice,vm.mobileView=mobileView,vm.pdlData=vm.pdlData,vm.isStandardShort=!1,vm.isPromoShort=!1,vm.htmlToPlaintext=htmlToPlaintext,vm.readMoreStandard=readMoreStandard,vm.readLessStandard=readLessStandard,vm.readMorePromo=readMorePromo,vm.readLessPromo=readLessPromo,vm.processPromoDescription=processPromoDescription,vm.processLegalStandard=processLegalStandard,vm.mobileView(),vm.setDeviceImei=setDeviceImei,vm.promoData&&vm.promoData.longDescription&&vm.processPromoDescription(),vm.model.formData.tradeInOption=vm.promoData?"DOLLARZEROPROMO":"STANDARD",vm.authorValue.tradeInValueScreen&&vm.authorValue.tradeInValueScreen.standardTradeInLegalText&&vm.processLegalStandard()}var moduleName="tmobileApp",controllerName="tradeValueScreenController";angular.module(moduleName).controller(controllerName,tradeValueScreenControllerFunction)}(window.angular,window._),function(angular,lodash){"use strict";function tradeInToolControllerConstructor(tradeInService,cartCommonOperationsService,globalValue,luhn,toggleService){function close(){vm.modalInstance.close()}function submit(){"GOOD"===vm.model.formData.deviceConditionOption&&vm.isEligible===!0?(angular.forEach(vm.model.tradeInData,function(key,index){key.carrier===vm.model.formData.carrier&&key.make===vm.model.formData.make&&key.model===vm.model.formData.deviceModel&&(vm.model.formData.devicePrice=key.price)}),"FULL"===vm.selectedLine.lineItemDetails.deviceDetails.pricingOption||toggleService.model.toggles.isDcpV3ApiEnabled||"creditClass3"===vm.cartCommonOperationsService.model.structCartData.selectedCreditClass["class"]?toggleService.model.toggles.isDcpV3ApiEnabled&&"FULL"!==vm.selectedLine.lineItemDetails.deviceDetails.pricingOption?getPromoResponse(vm.model.formData,vm.selectedLine):tradeInService.openTradeValueScreen(vm.selectedLine,vm.model.formData):getPromoResponse(vm.model.formData,vm.selectedLine)):(vm.model.formData.devicePrice=0,vm.model.formData.promoData=null,tradeInService.openTradeValueScreen(vm.selectedLine,vm.model.formData)),callPDLforButtonClick(vm.model.formData),vm.modalInstance.close()}function getPromoResponse(formData,selectedLine){tradeInService.getPromo(formData.deviceModel,selectedLine.lineItemDetails.deviceDetails.sku).then(function(promoResponse){var dataStruct=promoResponse.data;vm.model.formData.promoData=getTransformedPromos(dataStruct),tradeInService.openTradeValueScreen(selectedLine,formData)})}function getMakeData(){vm.model.MakeData=[],angular.forEach(vm.model.tradeInData,function(key,index){key.carrier===vm.model.formData.carrier&&vm.model.MakeData.push(key.make)}),vm.model.formData.make=void 0,vm.model.formData.deviceModel=void 0}function getModelData(){vm.model.deviceModelData=[],angular.forEach(vm.model.tradeInData,function(key,index){key.carrier===vm.model.formData.carrier&&key.make===vm.model.formData.make&&vm.model.deviceModelData.push(key.model)}),vm.model.formData.deviceModel=void 0}function checkIMEI(imeiFormControl){luhn.check(vm.model.formData.imei)?(imeiFormControl.$setValidity("valid",!0),vm.isImeiValid=!1):imeiFormControl.$setValidity("valid",!1)}function getTradeInService(){tradeInService.getTradeInService().then(function(tradeInResponse){var dataStruct=tradeInResponse.data;vm.model.tradeInData=getTransformedTradeIn(dataStruct),angular.forEach(vm.model.tradeInData,function(key,index){vm.model.CarrierData.push(key.carrier)})})}function callPDLforButtonClick(data){tradeInService.callclickToNavigatePDL(data)}function applyIMEI(){tradeInService.getValidationIMEI(vm.model.formData.imei).then(function(IMEIResponse){200===IMEIResponse.status&&"ELIGIBLE"===IMEIResponse.data.statusCode&&(vm.isEligible=!0)})}function checkValidIMEI(imeiFormControl){imeiFormControl.$valid&&(applyIMEI(),vm.isImeiValid=!0)}function getTransformedTradeIn(tradeInResponse){var newResponse=[];return tradeInResponse&&angular.forEach(tradeInResponse.productOfferings,function(tradeInData,index){var productData={};productData.chargeType=tradeInData.prices[0].oneTimeCharges[0].chargeType,productData.price=tradeInData.prices[0].oneTimeCharges[0].amount,productData.carrier=tradeInData.products[0].serviceProvider,productData.make=tradeInData.products[0].manufacturer,productData.model=tradeInData.products[0].model,newResponse.push(productData)}),newResponse}function getTransformedPromos(promoResponse){var promoData=null;return angular.forEach(promoResponse.promotions,function(promo,index){lodash.includes(promo.tradeInIntents,"DOLLARZEROPROMO")&&(promoData=promo)}),promoData}function startsWith(tradeDeviceData,viewValue){return viewValue.indexOf("-")>=0?tradeDeviceData.substr(0,viewValue.length).toLowerCase()==viewValue.toLowerCase():tradeDeviceData.replace(/-/g,"").substr(0,viewValue.length).toLowerCase()==viewValue.toLowerCase()}var vm=this;vm.model={CarrierData:[],MakeData:[],deviceModelData:[],formData:{},tradeInData:[]},vm.authorValue=globalValue.authorValue.rootPage,vm.isImeiValid=!1,vm.isEligible=!1,vm.imei={},vm.close=close,vm.submit=submit,vm.getMakeData=getMakeData,vm.getModelData=getModelData,vm.checkIMEI=checkIMEI,vm.applyIMEI=applyIMEI,vm.checkValidIMEI=checkValidIMEI,vm.callPDLforButtonClick=callPDLforButtonClick,vm.cartCommonOperationsService=cartCommonOperationsService,vm.startsWith=startsWith,vm.getPromoResponse=getPromoResponse,getTradeInService()}tradeInToolControllerConstructor.$inject=["tradeInService","cartCommonOperationsService","globalValue","luhn","toggleService"],angular.module("tmobileApp").controller("tradeInToolController",tradeInToolControllerConstructor)}(window.angular,_),function(angular){"use strict";function tradeInDeviceServiceConstructor(httpRequestWrapper,apiService,$q,toggleService){function obtainObject(input,callback){return vm.toggles.tradeInCachedData===!0?_fromCache(input,callback):_fromDirect(input,callback)}function _fromDirect(input,callback){if(vm.isStarted){var defer=$q.defer();return defer.reject(null),defer.promise}var query=input?{ignoreLoadingBar:input.ignoreLoadingBar}:null,urlObject=apiService.getURL("tradeInDevices"),carrierURL=urlObject.url,data={programType:"DRP"},header={"Content-Type":"application/json",Accept:"application/json"};return httpRequestWrapper.post(carrierURL,data,query,header,!0,"tradeInDevices").then(function(tradeInResponse){return callback?void callback(tradeInResponse):tradeInResponse})}function _fromCache(input,callback){var query=input?{ignoreLoadingBar:input.ignoreLoadingBar}:null,urlObject=apiService.getURL("tradeInCache"),carrierURL=urlObject.url;carrierURL=location.origin+carrierURL;var header=null;return httpRequestWrapper.get(carrierURL,query,header,!1,"tradeInCache").then(function(tradeInResponse){return callback?void callback(tradeInResponse):tradeInResponse})}var vm=this;vm.toggles=toggleService.model.toggles,vm.obtainObject=obtainObject}tradeInDeviceServiceConstructor.$inject=["httpRequestWrapper","apiService","$q","toggleService"],angular.module("tmobileApp").service("tradeInDeviceService",tradeInDeviceServiceConstructor)}(angular),function(angular){"use strict";function tradeInServiceConstructor(httpRequestWrapper,cartControllerHelperService,CartCommonModal,pdlService,apiService,$q,tradeInDeviceService){function getValidationIMEI(imeiNumber){var urlObject=apiService.getURL("tradeInIMEI"),imeiURL=urlObject.url,query={accountType:"I",accountSubType:"R",eligibilityType:"DEVICE_ELIGIBILITY",serialNumber:imeiNumber},header={"Content-Type":"application/json",Accept:"application/json"};return httpRequestWrapper.post(imeiURL,query,null,header,!0,"tradeInIMEI").then(function(tradeInResponse){return tradeInResponse})}function getTradeInService(){var defered=$q.defer();return tradeInDeviceService.obtainObject().then(function(tradeInDeviceData){defered.resolve(tradeInDeviceData)}),defered.promise}function openTradeValueScreen(selectedLine,modalObj){var commonResolves=cartControllerHelperService.commonResolves(null,selectedLine,null,modalObj),resolveAttributes={resolve:angular.extend(commonResolves.keyValues,commonResolves.selectedLine)};CartCommonModal.openCartModal("tradeValueScreen",resolveAttributes,emptyCallBack)}function getPromo(deviceModel,sku){var authrequired,urlObject=apiService.getURL("browsePromos"),promoURL=urlObject.url,header={},body={shopper:{salesChannel:"WEB",accountType:"I"},products:[{newItemSku:[sku],tradeInDeviceModel:deviceModel}],promotions:{pricingOption:"EIP",promotionTypes:["TRADEIN"],transactionTypes:["ACTIVATION"]}};return 3===urlObject.version?(body.shopper.accountSubtype="R",authrequired=!0):(header={"Content-Type":"application/json"},body.shopper.accountSubType="R",authrequired=!1),httpRequestWrapper.post(promoURL,body,null,header,authrequired,"browsePromos").then(function(tradeInResponse){return tradeInResponse})}function callclickToNavigatePDL(data){pdlService.setPdlForClickTradeIn(data)}function emptyCallBack(modalObj){}var vm=this;return vm.getTradeInService=getTradeInService,vm.openTradeValueScreen=openTradeValueScreen,vm.getValidationIMEI=getValidationIMEI,vm.callclickToNavigatePDL=callclickToNavigatePDL,vm.getPromo=getPromo,vm}tradeInServiceConstructor.$inject=["httpRequestWrapper","cartControllerHelperService","CartCommonModal","pdlService","apiService","$q","tradeInDeviceService"],angular.module("tmobileApp").service("tradeInService",tradeInServiceConstructor)}(angular),function(angular){"use strict";var tradeInToolComponentConstructor={templateUrl:"app/core/components/tradeInTool/tradeInTool.html",controller:"tradeInToolController",controllerAs:"tradeInCtrl",bindings:{modalInstance:"=",selectedLine:"="}};angular.module("tmobileApp").component("tradeInTool",tradeInToolComponentConstructor)}(angular),function(angular){"use strict";function tmobPlanSelectorDirectiveConstructor($log,$templateCache,$compile,$interval,$state,slickCarouselBreakpoints,planSelectorService,authorValueService,componentStorage,commonServices){}tmobPlanSelectorDirectiveConstructor.$inject=["$log","$templateCache","$compile","$interval","$state","slickCarouselBreakpoints","planSelectorService","authorValueService","componentStorage","commonServices"];var moduleName="tmobileApp",directiveName="tmobPlanSelector";angular.module(moduleName).directive(directiveName,tmobPlanSelectorDirectiveConstructor)}(angular),function(angular){"use strict";function planSelectorHttpDataServiceConstructor(apiURLs,httpRequest,compUtils){}planSelectorHttpDataServiceConstructor.$inject=["apiURLs","httpRequest","compUtils"],angular.module("tmobileCore").service("planSelectorHttpDataService",planSelectorHttpDataServiceConstructor)}(angular),function(angular){"use strict";function planSelectorServiceConstructor(dataFactory){}planSelectorServiceConstructor.$inject=["dataFactory"],angular.module("tmobileCore").service("planSelectorService",planSelectorServiceConstructor)}(angular),function(angular,externalLogger){}(angular,externalLogger),function(angular){"use strict";function notificationServiceConstructor(){function setNotificationList(notifications){notifications.messages&&!_.isArray(notifications.messages)&&(notifications.messages=[notifications.messages]),vm.notificationList=notifications}function showNotification(notifykey){angular.forEach(vm.notificationKeys,function(value,key){value(notifykey)})}function getNotification(callback){vm.notificationKeys.push(callback)}var vm=this;return vm.notificationList={},vm.notificationKeys=[],vm.addNotification=[],vm.isAbLoaded=!1,vm.isSaveCartloaded=!1,vm.isBotLoaded=!1,vm.showNotification=showNotification,vm.setNotificationList=setNotificationList,vm.getNotification=getNotification,vm}angular.module("tmobileCore").service("tmobNotificationService",notificationServiceConstructor)}(window.angular),function(angular){"use strict";function notificationDirectiveConstructor($log,$timeout,$interval,$templateCache,$compile,$window,$state,authorValueService,tmobNotificationService,commonUtils,jsonPath,pdlService){function renderTemplate(scope,element,attrs){function renderPendingNotifications(){i++;var notifications=authorValueService.getAuthorValue(attrs.componentIdentifier);tmobNotificationService.setNotificationList(notifications),tmobNotificationService.getNotification(function(notifykey){var totalMsg=[],object=[];if(notifykey.forEach(function(key){var obj=commonUtils.searchJson(notifications,'[?(@.messageKey =="'+key+'")]');obj&&-1==totalMsg.indexOf(obj)&&(totalMsg.push(obj),object.push(obj),pdlService.callNudgeModalEvent(obj.messageValue))}),notifications.messages&&notifications.messages.length>0){scope.notificationMsg=totalMsg;var rawTemplate=$templateCache.get("app/core/components/tmobNotification/tmobNotification.html");element.html(rawTemplate).show(),$compile(element.contents())(scope),object.forEach(function(objex){function removeElement(elm){$timeout(function(){elm.addClass("display-none")},2e3)}if(!objex.hideTimer){var timer=1e3*parseInt(objex.messageTimer);$timeout(function(){var elm=angular.element(document.querySelector("#"+objex.messageKey));elm.addClass("nudge bg-magenta display-none"),removeElement(elm)},timer)}})}}),scope.close=function(id){var elm=angular.element(document.querySelector("#"+id));elm.addClass("nudge bg-magenta display-none");var timer=2e3;$timeout(function(){elm.addClass("display-none")},timer)}}var i=0;renderPendingNotifications()}return{restrict:"E",scope:{onLoadCallback:"&"},link:function(scope,element,attrs){renderTemplate(scope,element,attrs),scope.onLoadCallback()}}}notificationDirectiveConstructor.$inject=["$log","$timeout","$interval","$templateCache","$compile","$window","$state","authorValueService","tmobNotificationService","commonUtils","jsonPath","pdlService"];var moduleName="tmobileApp",directiveName="tmobNotification";angular.module(moduleName).directive(directiveName,notificationDirectiveConstructor)}(angular),function(angular){"use strict";function stateManagerServiceConstructor($cookies,$log,$window,$state,jsonPath,globalConfig,commonStorage){function storeState(toState){commonStorage.assignIntoSharedCookie("lastVisitedState",toState.name)}function checkState(event,toState,toParams,globalConfigJSON){if(stateStorage.isStateManageDone)return"resume";if(stateStorage.isStateManageDone=!0,globalConfigJSON.stateManger){if(globalConfigJSON.stateManger.goToLastVisitedPage){var lastVisitedState=commonStorage.getFromSharedCookie("lastVisitedState");return angular.equals(toState.name,lastVisitedState)?"resume":($log.log("stateManager blocked stateChangeStart because the target state is not the lastVisitedState ("+lastVisitedState+")"),event.preventDefault(),$log.log("stateManagerService.checkState() is redirecting to target state "+lastVisitedState),$state.go(lastVisitedState),"redirect")}var goToThisPage=globalConfigJSON.stateManger.goToThisPage;if(angular.equals(toState.url,goToThisPage))return"resume";var goTotState,stateList=$state.get(),searchItem=jsonPath(stateList,'$..[?(@.url =="'+goToThisPage+'")]');return angular.isDefined(searchItem)&&searchItem.length>0&&(goTotState=searchItem[0]),goTotState?($log.log("$state.get() ",goTotState.name),$log.log("stateManagerService isblocking $stateChangeStart because goTotState == "+goTotState),event.preventDefault(),$log.log("stateManagerService.checkState() is redirecting to goTotState "+goTotState.name),$state.go(goTotState.name),"redirect"):($log.log("stateManagerService isblocking $stateChangeStart because goTotState is not set"),event.preventDefault(),$log.log("stateManagerService.checkState() is redirecting to goToThisPage "+goToThisPage),$state.go(goToThisPage),"redirect")}return"resume"}var stateStorage={};this.storeState=storeState,this.checkState=checkState}stateManagerServiceConstructor.$inject=["$cookies","$log","$window","$state","jsonPath","globalConfig","commonStorage"];var serviceName="stateManagerService";angular.module("tmoStateManager",["ngCookies","ngJSONPath"]),externalLogger.moduleRegistered("tmoStateManager","stateManager.service.js"),angular.module("tmoStateManager").service(serviceName,stateManagerServiceConstructor).run(["$rootScope","stateManagerService",function($rootScope,stateManagerService){externalLogger.moduleRun("tmoStateManager","stateManager.service.js"),$rootScope.$on("$stateChangeSuccess",function(event,toState,toParams,fromState,fromParams,options){stateManagerService.storeState(toState)})}])}(angular),function(angular){"use strict";var steps={templateUrl:"app/core/components/steps/steps.tpl.html",controller:"StepsController as vm",bindings:{authorValue:"<",icons:"<"}};angular.module("tmobileCore").component("steps",steps)}(window.angular),function(angular,lodash){"use strict";function stepsController(){var vm=this;vm.stepsContentArray=[],angular.isDefined(vm.authorValue)&&lodash.forEach(vm.authorValue.stepsContent,function(value){vm.stepsContentArray.push(angular.fromJson(value))})}angular.module("tmobileCore").controller("StepsController",stepsController)}(window.angular,window._),function(angular){"use strict";var productGridComponent={controller:"productGridComponentController",controllerAs:"vm",templateUrl:"app/core/components/productGrid/productGrid.component.html",bindings:{product:"<",authorValue:"<"}};angular.module("tmobileApp").component("productGrid",productGridComponent)}(angular),function(angular){"use strict";function productGridComponentControllerConstructor(browseService,creditClassService,commonServices,toggleService){function getPriceTypeAvailableEIPForDevice(product){return browseService.getPriceTypeAvailableEIPForDevice(product)}function getCreditRatedPriceToday(product){return vm.showPrice=vm.model.showPrices.todayPrice,vm.showLegalText=browseService.showLegalText(),browseService.getCreditRatedPriceToday(product)}function getCreditRatedPriceTotal(product){return vm.showPrice=vm.model.showPrices.totalPrice,vm.showLegalText=browseService.showLegalText(),browseService.getCreditRatedPriceTotal(product)}function getCreditRatedPriceDiscounted(product){return vm.showPrice=vm.model.showPrices.totalPrice,vm.showLegalText=browseService.showLegalText(),browseService.getCreditRatedPriceDiscounted(product)}function showPricing(product,allowCreditClass3,discountState){var currentCreditClass=creditClassService.getCreditClass();vm.model.creditClassSelected=currentCreditClass,angular.isUndefined(currentCreditClass)&&(currentCreditClass={},currentCreditClass["class"]="creditClass1",vm.model.creditClassSelected=currentCreditClass);var showingDiscount=showDiscount(product),results=discountState===showingDiscount&&allowCreditClass3===("creditClass3"===currentCreditClass["class"]);return results}function showDiscount(product){var discountPrice=getCreditRatedPriceDiscounted(product),originalPrice=getCreditRatedPriceTotal(product),discountBool=discountPrice===originalPrice;return!discountBool}function getPriceTypeAvailableEIP(product){return browseService.getPriceTypeAvailableEIP(product)}function setImage(item,selectedColorIndex){showPricing(item),item.selectedColorIndex=selectedColorIndex,item.productImage=item.thumbNail.split("|")[selectedColorIndex],item.prodPrice=getLeastPriceColorIndex(item,selectedColorIndex),item.detailLink.options="?color="+getSwatchColorTitle(item,selectedColorIndex)}function getLeastPriceColorIndex(item,selectedColorIndex){var color=getSwatchColorTitle(item,selectedColorIndex);if(color)for(var colorName="COLOR_"+color.toUpperCase(),colors=item.deviceColorSKU.split("|"),prices=item.salePriceSku.split("|"),leastPrice="",i=0;i<colors.length;i++)colors[i]===colorName&&(_.isEmpty(leastPrice)||prices[i]<=leastPrice)&&(leastPrice=prices[i],selectedColorIndex=i);return selectedColorIndex}function getSwatchColorTitle(item,colorIndex){var name=item.searchableColors.split("|")[colorIndex].replace("COLOR_","");return"(PRODUCT)RED"===name?name:name.substring(0,1)+name.substring(1).toLowerCase()}function isProductNotAvailableForOrder(availableRule){return"COMING_SOON"===availableRule||"NOT_AVAILABLE_COMING_SOON"===availableRule}function encodeProductURL(str){return str.replace(/%40|~2F|%2B|%23|%24|%25|%5E|%26|%7B|%7D|%5B|%5D|%26|%C2%AE|%E2%84%A2|%3A|%24|%2C|%22|~2F|'/gi,"").replace(/\(|\)/g,"").replace(/ /g,"-").replace(/-+/g,"-").toLowerCase()}var vm=this,$log=commonServices.$log,openHomePage=commonServices.openHomePage;$log.log("Product Grid Component Controller is initializing "),vm.showPrice=!0,vm.showLegalText=!0,vm.model=browseService.model,vm.offerLabelForItem=browseService.getOfferLabelForItem,vm.badgeIsValidForProduct=browseService.badgeIsValidForProduct,vm.openHomePage=openHomePage,vm.setImage=setImage,vm.getSwatchColorTitle=getSwatchColorTitle,vm.showPricing=showPricing,vm.showDiscount=showDiscount,vm.getCreditRatedPriceToday=getCreditRatedPriceToday,vm.getCreditRatedPriceMonthly=browseService.getCreditRatedPriceMonthly,vm.getCreditRatedPriceDiscounted=browseService.getCreditRatedPriceDiscounted,vm.getCreditRatedPriceTotal=browseService.getCreditRatedPriceTotal,vm.getPriceTypeAvailableEIP=getPriceTypeAvailableEIP,vm.isSimToolkit=browseService.isSimToolkit,vm.isProductNotAvailableForOrder=isProductNotAvailableForOrder,vm.toggles=toggleService.model.toggles,vm.nonEIPToggleValue=toggleService.model.toggles.NonEipToggle,vm.getPriceTypeAvailableEIPForDevice=getPriceTypeAvailableEIPForDevice,vm.encodeProductURL=encodeProductURL}productGridComponentControllerConstructor.$inject=["browseService","creditClassService","commonServices","toggleService"],angular.module("tmobileApp").controller("productGridComponentController",productGridComponentControllerConstructor)}(angular),function(angular,lodash){"use strict";function priceLockupController($scope,toggleService,cartStorage){function setBooleanValues(property,force){var defaultValue=_.isBoolean(force)?force:!1;return _.isBoolean(property)||(property=_.isString(property)?_.isEqual(property.toLowerCase(),"true"):defaultValue),property}$scope.leftOnly=setBooleanValues($scope.leftOnly),$scope.showAsDiscount=setBooleanValues($scope.showAsDiscount),$scope.showTotalPricing=setBooleanValues($scope.showTotalPricing),$scope.leftMagenta=setBooleanValues($scope.leftMagenta,!0),$scope.legalTermsMobile=setBooleanValues($scope.legalTermsMobile,!0),$scope.totalPriceOnly=setBooleanValues($scope.totalPriceOnly,!0),$scope.showOfferDiscount=setBooleanValues($scope.showOfferDiscount),$scope.leftTextId="lt_"+Date.now(),$scope.leftSubTextId="lst_"+Date.now(),$scope.rightTextId="rt_"+Date.now(),$scope.rightSubTextId="rst_"+Date.now(),_.isEmpty($scope.decimalSeparator)&&($scope.decimalSeparator="."),_.isEmpty($scope.sizeClass)&&($scope.sizeClass="price-lockup-medium"),_.isEmpty($scope.leftAmount)&&($scope.leftAmount="$0"),_.isEmpty($scope.rightAmount)&&($scope.rightAmount="$0"),$scope.getLeftMagenta=function(){return setBooleanValues($scope.leftMagenta,!0)},$scope.getLeftOnly=function(){return setBooleanValues($scope.leftOnly)},$scope.getShowAsDiscount=function(){return setBooleanValues($scope.showAsDiscount)},$scope.getShowTotalPricing=function(){return setBooleanValues($scope.showTotalPricing)},$scope.showlegalTermsMobile=function(){return setBooleanValues($scope.legalTermsMobile,!0)},$scope.getTotalPriceOnly=function(){return setBooleanValues($scope.totalPriceOnly,!0)},$scope.getShowOfferDiscount=function(){return setBooleanValues($scope.showOfferDiscount)}}function priceLockupDirective(){return{restrict:"E",scope:{leftOnly:"@",spin:"@",sizeClass:"@",leftAmount:"@",rightAmount:"@",decimalSeparator:"@",leftText:"@",leftTextTpp:"@",leftSubText:"@",rightText:"@",rightTextTpp:"@",rightSubText:"@",autoPayOn:"@",autoPayDiscount:"@",rightAutoPayText:"@",rightTaxText:"@",hybridBanSubText:"@",hybridBanFlag:"@",leftMagenta:"@",showAsDiscount:"@",showTotalPricing:"@",totalPriceText:"@",totalPrice:"@",totalPriceOnly:"@",totalOriginalPrice:"@",rightAutoPayStartingText:"@",legalTermsText:"@",legalTermsMobile:"@",creditSelected:"@",taxAndFeesText:"@",dueTodayText:"@",rightNoAutoPayText:"@",showOfferDiscount:"@",taxLabel:"@"},templateUrl:"app/core/components/priceLockup/priceLockup.template.html",replace:!0,controller:priceLockupController}}priceLockupController.$inject=["$scope","toggleService","cartStorage"],angular.module("tmobileApp").directive("priceLockup",priceLockupDirective)}(angular,_),function(angular){"use strict";var pdpHelpBlockComponent={controller:"pdpHelpBlockController",controllerAs:"vm",templateUrl:"app/core/components/pdpHelpBlock/pdpHelpBlock.component.html",bindings:{authorValue:"=",pageType:"@",isNeedHelp:"<"}};angular.module("tmobileApp").component("pdpHelpBlock",pdpHelpBlockComponent)}(window.angular),function(angular,lodash){"use strict";function pdpHelpBlockComponentControllerConstructor($window,CartCommonModal,cartControllerHelperService,toggleService,cartStorage,geoLocation,globalValue,invocaScriptService,cartCommonOperationsService){function openCallMeNowModal(source){var _commonResolves=cartControllerHelperService.commonResolves(null,null,null,vm.authorValue,null,null,source),resolveAttributes={resolve:angular.extend(_commonResolves.keyValues,_commonResolves.source)};vm.authorValue.callMeLinkUrl?$window.open(vm.authorValue.callMeLinkUrl,"_top"):CartCommonModal.openCartModal("callMeNowModal",resolveAttributes,emptyModalCallBack)}function emptyModalCallBack(modalObject){}function invocaRun(){invocaScriptService.runPnapi()}function initialize(){_.get(authorValue,"displayCallMeNow.showCallMeNow")?geoLocation.getState().then(function(state){vm.disableCallMeNowCTA=!!lodash.find(authorValue.rootPage.callMeNowHolidaysOpHrs.blockedStates,{callMeBlockedstate:state})},function(){vm.disableCallMeNowCTA=!1}):vm.disableCallMeNowCTA=!0;var cartLineItems=cartCommonOperationsService.model.structCartData.lineItems;cartLineItems&&0===cartLineItems.length&&(vm.isEmptyCart=!0)}var vm=this;vm.isB2B=$window.isB2B;var authorValue=globalValue.authorValue;vm.isEmptyCart=!1,vm.toggles=toggleService.model.toggles,vm.isBotShopping=!!cartStorage.getFbSessionId(),vm.emptyModalCallBack=emptyModalCallBack,vm.openCallMeNowModal=openCallMeNowModal,vm.invocaRun=invocaRun,initialize()}pdpHelpBlockComponentControllerConstructor.$inject=["$window","CartCommonModal","cartControllerHelperService","toggleService","cartStorage","geoLocation","globalValue","invocaScriptService","cartCommonOperationsService"],angular.module("tmobileApp").controller("pdpHelpBlockController",pdpHelpBlockComponentControllerConstructor)}(window.angular,window._),function(angular){"use strict";function paymentOptionsController(globalValue){var vm=this;vm.options=globalValue.authorValue.rootPage.deviceAuthoring.paymentOptions}paymentOptionsController.$inject=["globalValue"],angular.module("tmobileApp").controller("accessoryPaymentOptionsController",paymentOptionsController)}(angular),function(){"use strict";var paymentOptions={bindings:{ngModel:"="},controller:"accessoryPaymentOptionsController",controllerAs:"vm",templateUrl:"app/core/components/paymentOptions/paymentOptions.html"};angular.module("tmobileApp").component("paymentOptions",paymentOptions)}(),function(){"use strict";var paginationComponentConfig={bindings:{numberOfPages:"<",currentPage:"<",numberOfPagesToDisplay:"<",large:"<",small:"<"},controller:"paginationComponentController",controllerAs:"vm",templateUrl:"app/core/components/pagination/pagination.component.html"};angular.module("tmobileApp").component("paginationComponent",paginationComponentConfig)}(),function(angular){"use strict";function coreServicesConstructor($injector){return{globalConfig:$injector.get("globalConfig"),logger:$injector.get("loggingService"),authorization:$injector.get("authorization"),authTokenManager:$injector.get("authTokenManager"),cartStorage:$injector.get("cartStorage"),creditClassService:$injector.get("creditClassService"),tokenUtils:$injector.get("tokenUtils"),httpRequest:$injector.get("httpRequest"),session:$injector.get("session"),httpRequestWrapper:$injector.get("httpRequestWrapper"),apiURLs:$injector.get("apiURLs"),apiZoomLevel:$injector.get("apiZoomLevel"),jsonPath:$injector.get("jsonPath"),commonUtils:$injector.get("commonUtils"),toggleService:$injector.get("toggleService")}}var serviceName="coreServices";angular.module("tmobileApp").service(serviceName,coreServicesConstructor)}(angular),function(angular,lodash){"use strict";function DFacessFactoryConstructor($rootScope,$q,$log,authorization,authTokenManager,apiURLs,tokenUtils,tokenTtl,toggleService){function acessTokenRequest(){var tokenCookies=authTokenManager.getTokenCookies("token",angular.equals(apiURLs.storage,"localStorage"));return angular.isUndefined(tokenCookies)||angular.equals(tokenCookies,null)?authorization.generateToken().then(function(accessTokenResponse){return angular.equals(accessTokenResponse.status,200)?($rootScope.cookiesExpiresIn=moment().add(accessTokenResponse.data.expires_in,"seconds").toDate(),authTokenManager.setTokenCookies(accessTokenResponse.data,"token",angular.equals(apiURLs.storage,"localStorage"),tokenTtl.token.timetolive),accessTokenResponse):void 0}):$q.resolve(tokenCookies)}function jwtAccessTokenRequest(){tokenUtils.generateJWT()}function tokenRequest(){lodash.get(apiURLs,"isV2AccessTokenDisabled",!1)?jwtAccessTokenRequest():acessTokenRequest()}return{acessTokenRequest:acessTokenRequest,jwtAccessTokenRequest:jwtAccessTokenRequest,tokenRequest:tokenRequest}}DFacessFactoryConstructor.$inject=["$rootScope","$q","$log","authorization","authTokenManager","apiURLs","tokenUtils","tokenTtl","toggleService"],angular.module("tmobileCore").factory("DFacessTokenRequest",DFacessFactoryConstructor)}(angular,window._),function(angular,_){"use strict";function appRootController(commonServices){var $log=commonServices.$log;$log.log("App Root Controller is initializing...");
}appRootController.$inject=["commonServices"],angular.module("tmobileCore").controller("AppRootController",appRootController)}(angular,_),function(angular){"use strict";angular.module("tmobileCore").constant("APP_ROOT_STATE_NAME","root").config(["$stateProvider","APP_ROOT_STATE_NAME",function($stateProvider,APP_ROOT_STATE_NAME){externalLogger.moduleConfigured("tmobileCore","appRoot.js"),$stateProvider.state(APP_ROOT_STATE_NAME,{"abstract":!0,controller:"AppRootController as vm",templateUrl:"app/core/appRoot/appRoot.tpl.html",resolve:{}}),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(reg){null!==navigator.serviceWorker.controller&&navigator.serviceWorker.controller.postMessage("check for browse cache")})}])}(angular),function(){"use strict";var accessoryLegalTextMessages={bindings:{cartObj:"=",keyValuePair:"<"},controller:"accessoryLegalTextController",controllerAs:"vm",templateUrl:"app/core/components/accessoryLegalText/accessoryLegalText.html"};angular.module("tmobileApp").component("accessoryLegalText",accessoryLegalTextMessages)}(),function(angular){"use strict";function accessoryLegalTextConstrunctor(){function getTotalEIPPrice(){vm.EIPPrice=0;for(var z=0;z<vm.cartObj.accessories.accessoryDetails.length;z++)vm.EIPPrice=parseFloat(vm.EIPPrice)+parseFloat(vm.cartObj.accessories.accessoryDetails[z].totalPrice.amount),vm.EIPPrice=parseFloat(vm.EIPPrice).toFixed(2);return vm.EIPPrice}var vm=this;vm.getTotalEIPPrice=getTotalEIPPrice}angular.module("tmobileApp").controller("accessoryLegalTextController",accessoryLegalTextConstrunctor)}(angular),function(angular){"use strict";function authorValueServiceConstructor($q,$location,$state,$log,$urlRouter,$stateParams,dataFactory,compUtils,globalConfig,globalValue,apiURLs,UPPER_FUNNEL_ABSTRACT_ROOT_STATE_NAME){function loadAuthorJson(url){var $defered=$q.defer();$log.log('Attempting to load json data from authorValueService for "'+url+'"');var dfRequest=new dataFactory.DFRequest;return dfRequest.input={url:url},dataFactory.getObject("authorValueFactory",dfRequest).then(function(authorJson){authorJsonStorage.authorJsonData=authorJson,$defered.resolve(authorJsonStorage.authorJsonData)}),$defered.promise}function getAuthorValue(identifier){return identifier?(authorJsonStorage.authorValue=compUtils.searchJson(authorJsonStorage.authorJsonData,'[?(@.identifier =="'+identifier+'")]'),authorJsonStorage.authorValue||(authorJsonStorage.authorValue=authorJsonStorage.authorJsonData),model.authorValue=authorJsonStorage.authorValue,authorJsonStorage.authorValue):authorJsonStorage.authorJsonData}function assignValue(scope,attr){scope.authorValue=getAuthorValue(attr.componentIdentifier)||{}}function workRouterLogic(toState,toParams){var defer=$q.defer(),authorUrlConfig=null,authorJsonUrl=null,isAuthorJsonRequired=!0;if(delete authorJsonStorage.identifier,$log.log("$stateParams ",$stateParams),!globalConfig.enableAuthorValueCall)return defer.resolve(),defer.promise;if(angular.isDefined(globalConfig.ignore)&&_.includes(globalConfig.ignore.authorValueUrls,toState.url))return defer.resolve(),defer.promise;if(routerEventPrevented&&$log.log("stateChangeStart prevented in authorValueService because a prior stateChange did not find authorData and we are still waiting for that author data to arrive."),toParams&&toParams.browseCategory){var path=toParams.browseCategory.replace(/.html/g,"");authorUrlConfig=_.find(globalConfig.authorValueUrlMap,"browseCategory"),authorUrlConfig&&(authorJsonUrl=authorUrlConfig.browseCategory[path])}else if(toParams&&toParams.detailCategory){return defer.resolve(),defer.promise;var path}authorJsonUrl||(authorJsonUrl=$location.path());var url=toState.url;if(authorUrlConfig=_.find(globalConfig.authorValueUrlMap,{url:url}),authorUrlConfig&&!_.isEmpty(authorUrlConfig.authorValueUrl)&&(authorJsonUrl=authorUrlConfig.authorValueUrl,isAuthorJsonRequired=!0),isAuthorJsonRequired){if(authorJsonUrl=authorJsonUrl.replace(/.html/g,""),globalConfig.authorValueExtension&&(authorJsonUrl=authorJsonUrl.replace(globalConfig.authorValueExtension,"")),authorJsonUrl=apiURLs.authorValue+authorJsonUrl+".json",$log.log("author Json Url ",authorJsonUrl),!authorUrlStorage[authorJsonUrl])return $log.log('prevent state change to "'+toState.url+'" because we do not have this url saved in authorUrlStorage'),routerEventPrevented=!0,loadAuthorJson(authorJsonUrl).then(function(data){authorUrlStorage[authorJsonUrl]=!0,authorJsonStorage.authorValue=data,globalValue.authorValue=authorJsonStorage.authorValue,routerEventPrevented=!1,$log.log("authorValueService.loadAuthorJson() is directing to target state "+toState.name+","+angular.toJson(toParams)),defer.resolve()}),defer.promise;loadAuthorJson(authorJsonUrl).then(function(data){authorUrlStorage[authorJsonUrl]=!0,authorJsonStorage.authorValue=data,globalValue.authorValue=authorJsonStorage.authorValue,routerEventPrevented=!1,defer.resolve()})}return defer.promise}var authorJsonStorage={},model={},authorUrlStorage={},routerEventPrevented=!1;this.authorValue=model.authorValue,this.loadAuthorJson=loadAuthorJson,this.getAuthorValue=getAuthorValue,this.workRouterLogic=workRouterLogic,this.assignValue=assignValue}authorValueServiceConstructor.$inject=["$q","$location","$state","$log","$urlRouter","$stateParams","dataFactory","compUtils","globalConfig","globalValue","apiURLs","UPPER_FUNNEL_ABSTRACT_ROOT_STATE_NAME"],angular.module("tmobileCore").service("authorValueService",authorValueServiceConstructor)}(angular),function(angular){"use strict";function authorValueHttpDataFactoryConstructor($q,$log,$http,httpRequestWrapper,compUtils,commonUtils,globalConfig){function changeSingleQuoteToDouble(authorJsonData){authorJsonData&&angular.forEach(globalConfig.authorValueSingleQuoteAttrs,function(sQ,k){var singleQuoteValues=commonUtils.searchJsonArray(authorJsonData,sQ);singleQuoteValues&&angular.forEach(singleQuoteValues,function(eachQuote,qKey){angular.forEach(eachQuote,function(value,key){value=value.replace(/\'/g,'"'),eachQuote[key]=value})})})}function textToJson(jsonData){changeSingleQuoteToDouble(jsonData);for(var text=angular.toJson(jsonData),startIndex=0;startIndex>-1;)if(startIndex=text.indexOf('["{'),startIndex>-1){var quoteString=text.substring(startIndex),endIndex=quoteString.indexOf('}"]'),replacableString=quoteString.substring(0,endIndex+3);text=text.replace(replacableString,"##replaceString##"),replacableString=replacableString.replace(/\\"/g,'"'),replacableString=replacableString.replace(/"{/g,"{"),replacableString=replacableString.replace(/}"/g,"}"),replacableString=replacableString.replace(/\\\"/g,'"'),text=text.replace("##replaceString##",replacableString)}for(startIndex=0;startIndex>-1;)if(startIndex=text.indexOf('"{\\"'),$log.log("authorValueHttpDataService:scenario 2 :: index ",startIndex),startIndex>-1){var quoteString=text.substring(startIndex),endIndex=quoteString.indexOf('"}"'),replacableString=quoteString.substring(0,endIndex+3);text=text.replace(replacableString,"##replaceString##"),replacableString=replacableString.replace(/"{\\"/g,'{"'),replacableString=replacableString.replace(/\\":\\"/g,'":"'),replacableString=replacableString.replace(/\\",\\"/g,'","'),replacableString=replacableString.replace(/\\"}"/g,'"}'),replacableString=replacableString.replace(/\\\"/g,'"'),replacableString=replacableString.replace(/\\\"/g,'"'),replacableString=replacableString.replace(/}\",/g,"},"),text=text.replace("##replaceString##",replacableString)}return JSON.parse(text,dateReviver)}function dateReviver(key,value){if("string"==typeof value){if(""===value)return value;if(!isNaN(value))return Number(value);if("true"===value)return!0;if("false"===value)return!1}return value}function obtainAuthorValue(input){var url=input&&input.url?input.url:void 0;if(!url)return!1;var $defered=$q.defer(),query={};return input.ignoreLoadingBar&&(query.ignoreLoadingBar=!0),url.indexOf("checkout")>0&&(query=void 0),httpRequestWrapper.get(url,query,null,!1).then(function(response){var authorJsonData=response.data;authorJsonData=textToJson(authorJsonData),$defered.resolve(authorJsonData)}),$defered.promise}return{obtainObject:obtainAuthorValue}}authorValueHttpDataFactoryConstructor.$inject=["$q","$log","$http","httpRequestWrapper","compUtils","commonUtils","globalConfig"],angular.module("tmobileCore").factory("authorValueHttpDataFactory",authorValueHttpDataFactoryConstructor)}(angular),function(angular,lodash){"use strict";function BreadcrumbController($filter){function click(item){vm.items.pop(),vm.onClick(item)}function getSEOModel(){var _seoItems=[],model={"@context":"http://schema.org","@type":"BreadcrumbList",itemListElement:_seoItems};return lodash.forEach(vm.items,function(item,index){var _item={"@id":item.url,name:item.label};_.isNil(item)||_seoItems.push({"@type":"ListItem",position:index+1,item:_item})}),$filter("parseHtml")($filter("json")(model))}var vm=this;vm.getSEOModel=getSEOModel,vm.click=click}BreadcrumbController.$inject=["$filter"],angular.module("tmobileCore").controller("BreadcrumbController",BreadcrumbController)}(window.angular,_),function(angular){"use strict";var breadcrumb={templateUrl:"app/core/components/breadcrumb/breadcrumb.tpl.html",controller:"BreadcrumbController",controllerAs:"vm",bindings:{styleClass:"<",items:"<",onClick:"&"}};angular.module("tmobileCore").component("breadcrumb",breadcrumb)}(window.angular),function(angular){"use strict";var calendarOption={bindings:{ngModel:"=",isOpen:"=",label:"@",federalHoliday:"<"},controller:"calendarController",controllerAs:"vm",templateUrl:"app/core/components/calendar/calendar.html"};angular.module("tmobileApp").component("calendar",calendarOption)}(window.angular),function(angular){"use strict";function calendarController(){function disabledDate(date,mode){var isHoliday=!1,weekDay=date.getDay(),today=moment(date),yesterday=moment(date).add(-1,"days"),tomorrow=moment(date).add(1,"days");if(vm.federalHoliday)var currentFormate=today.format("MM-DD"),isTodayHoliday=_.find(vm.federalHoliday,{federalHoliday:currentFormate}),nextDate=tomorrow.format("MM-DD"),isNextDayHoliday=_.find(vm.federalHoliday,{federalHoliday:nextDate}),lastDate=yesterday.format("MM-DD"),isLastDayHoliday=_.find(vm.federalHoliday,{federalHoliday:lastDate});switch(weekDay){case 0:isHoliday=vm.disableWeekends===!0;break;case 6:isHoliday=vm.disableWeekends===!0;break;case 5:angular.isDefined(isNextDayHoliday)&&(isHoliday=!0);break;case 1:angular.isDefined(isLastDayHoliday)&&(isHoliday=!0);break;default:isHoliday=!1}return angular.isDefined(isTodayHoliday)&&(isHoliday=!0),isHoliday}function openCalendar($event){$event.preventDefault(),$event.stopPropagation(),vm.isOpen=!0}var vm=this;vm.disabled=disabledDate,vm.open=openCalendar,vm.minDate=new Date,vm.isOpen=!1,vm.disableWeekends=!0,vm.formats=["MM/dd/yyyy","yyyy/MM/dd","dd.MM.yyyy","shortDate"],vm.format=vm.formats[0],vm.ngModel=moment(new Date).format("MM/DD/YYYY")}angular.module("tmobileApp").controller("calendarController",calendarController)}(angular),function(){"use strict";var carouselNavigation={bindings:{},controller:"carouselNavigationController",controllerAs:"vm",templateUrl:"app/core/components/carouselNavigation/carouselNavigation.html"};angular.module("tmobileApp").component("carouselNavigation",carouselNavigation)}(),function(){"use strict";function carouselNavigationController(browseService,commonServices){function changeData(ind,product){vm.model.isOffline||(ind>0&&"All Categories"!==product.label?vm.model.locationQueryParams.ac="category-"+product.label.replace(/[^a-zA-Z0-9()_-]/g,"-").replace(/-{2,}/g,"-").replace(/\(|\)/g,"").replace(/[-]$/,"").toLowerCase():(delete vm.model.locationQueryParams.ac,$location.search("ac",null)),vm.model.currentPage=1,vm.model.locationQueryParams.page=vm.model.currentPage,vm.model.subNav=product,vm.model.isFilterSeleted=!0,browseService.getProductData().then(function(){}),$rootScope.$broadcast("BROWSE_FILTER_UPDATED",{filters:[product],queryParams:browseService.model.locationQueryParams}))}var vm=this,$location=commonServices.$location,$rootScope=commonServices.$rootScope;vm.model=browseService.model,vm.changeData=changeData}carouselNavigationController.$inject=["browseService","commonServices"],angular.module("tmobileApp").controller("carouselNavigationController",carouselNavigationController)}(),function(angular){"use strict";var moduleName="tmobileApp",componentName="ccpaCommonFooter",footercomponentConstructor={templateUrl:"app/core/components/ccpafooter/footer.html",controller:"CCPAFooterController",controllerAs:"vm",bindings:{keyValue:"="}};angular.module(moduleName).component(componentName,footercomponentConstructor)}(angular),function(angular){"use strict";function footerControllerFunction($scope,$rootScope,mpLocalizationService,universalMenuDataService,toggleService){function toggleLanguage(lang){mpLocalizationService.init(),mpLocalizationService.switchLanguage(mpLocalizationService.MPkeys.UrlLang==lang?"en":lang),vm.userPreferredLanguage=null==mpLocalizationService.getCookie("MP_LANG")?"en":mpLocalizationService.getCookie("MP_LANG")}var vm=this;vm.footerKeyValues=vm.keyValue,vm.toggles=toggleService.model.toggles,vm.universalNavService=universalMenuDataService,vm.isLocalizationEnabled=mpLocalizationService.localizationFlag,vm.isLocalizationEnabled&&(mpLocalizationService.loadLocalizationScript(),vm.userPreferredLanguage=null==mpLocalizationService.getCookie("MP_LANG")?"en":mpLocalizationService.getCookie("MP_LANG")),vm.toggleLanguage=toggleLanguage}footerControllerFunction.$inject=["$scope","$rootScope","mpLocalizationService","universalMenuDataService","toggleService"];var controllerName="CCPAFooterController";angular.module("tmobileApp").controller(controllerName,footerControllerFunction)}(angular),function(angular){"use strict";function compUtilsConstructor($compile,jsonPath){function decodeHtml(htmlString){var txt=document.createElement("textarea");return txt.innerHTML=htmlString,txt.value}function transformHtmlAttrs(scope,elm,attrs){angular.forEach(attrs,function(v,k){"$"===k.charAt[0]||angular.equals("authorValue",k)||(scope[k]=decodeHtml(v),attrs[k]="",$compile(elm)(scope))})}function searchJson(jsonData,jPath){var value,searchItem=jsonPath(jsonData,"$.."+jPath);return angular.isDefined(searchItem)&&searchItem.length>0&&(value=searchItem[0]),value}function searchJsonArray(jsonData,jPath){var value,searchItems=jsonPath(jsonData,"$.."+jPath);return angular.isDefined(searchItems)&&searchItems.length>0&&(value=searchItems),value}return{decodeHtml:decodeHtml,transformHtmlAttrs:transformHtmlAttrs,searchJson:searchJson,searchJsonArray:searchJsonArray}}compUtilsConstructor.$inject=["$compile","jsonPath"],angular.module("tmobileCore").service("compUtils",compUtilsConstructor)}(angular),function(angular){"use strict";function componentIdentifierDirectiveConstructor(componentStorage){return{restrict:"A",link:function(scope,element,attrs){componentStorage.registerMe(scope,element,attrs)}}}componentIdentifierDirectiveConstructor.$inject=["componentStorage"];var moduleName="tmobileCore",directiveName="componentIdentifier";angular.module(moduleName).directive(directiveName,componentIdentifierDirectiveConstructor)}(angular),function(angular){"use strict";function componentStorageConstructor($log){function registerMe(scope,element,attrs){var componentIdentifier=attrs.componentIdentifier;if(componentIdentifier){var component={element:element,attrs:attrs};$log.log("componentStorage::registerComponent::  ",componentIdentifier,component),storage[componentIdentifier]=component}}function getComponent(identifier){return storage[identifier]}var storage={};return{registerMe:registerMe,getComponent:getComponent}}componentStorageConstructor.$inject=["$log"];var serviceName="componentStorage";angular.module("tmobileCore").service(serviceName,componentStorageConstructor)}(angular),function(angular,externalLogger){"use strict";angular.module("tmobileApp").config(["$stateProvider",function($stateProvider){externalLogger.moduleConfigured("core/tmobileApp","contactUsBanner.dev.js"),$stateProvider.state("contactUsBanner",{url:"/contactUsBanner",templateUrl:"app/core/components/contactUsBanner/contactUsBanner.dev.html"})}])}(window.angular,window.externalLogger),function(angular){"use strict";function ContactUsBannerFn(){return{restrict:"E",replace:!0,templateUrl:"app/core/components/contactUsBanner/contactUsBanner.html"}}angular.module("tmobileCore").directive("contactUsBanner",ContactUsBannerFn)}(angular),function(angular){"use strict";function CoverageDeviceListDirectiveConstructor($log,$templateCache,$compile,$interval,authorValueService){function renderTemplate(scope,element,attrs){function checkRender(){if(templateRenderCount+=1,templateRenderCount>20&&$interval.cancel(interval),scope.authorValue=authorValueService.getAuthorValue(attrs.componentIdentifier)||{},!_.isEmpty(scope.authorValue)){$interval.cancel(interval);var coverageData=scope.authorValue,deviceInColumn=coverageData.itemsColumn,tempDeviceList=[];scope.title=coverageData.devicesTitle,scope.structDeviceListData=[],angular.forEach(coverageData.devicesList,function(item,index){_.isEmpty(item.manufacturer)||angular.forEach(item.deviceNameList,function(deviceObj,key){_.isEmpty(deviceObj.deviceName)||(deviceObj.manufacturer=item.manufacturer,tempDeviceList.length%deviceInColumn===0&&(tempDeviceList=[],scope.structDeviceListData.push(tempDeviceList)),0===key||deviceObj.manufacturer!==item.deviceNameList[key-1].manufacturer?deviceObj.displayManufacturer=!0:deviceObj.displayManufacturer=!1,tempDeviceList.push(deviceObj))})});var rawTemplate=$templateCache.get("app/core/components/coverageDeviceList/coverageDeviceList.html");element.html(rawTemplate).show(),$compile(element.contents())(scope)}$log.log("structured device List data :: ",scope.structDeviceListData)}var templateRenderCount=0,interval=$interval(checkRender,500)}return{restrict:"EA",scope:{},link:renderTemplate}}CoverageDeviceListDirectiveConstructor.$inject=["$log","$templateCache","$compile","$interval","authorValueService"];var moduleName="tmobileApp",directiveName="coverageDeviceList";angular.module(moduleName).directive(directiveName,CoverageDeviceListDirectiveConstructor)}(angular),function(angular,externalLogger){"use strict";angular.module("tmobileApp").constant("COVERAGE_DEVICE_LIST_STATE_NAME","coverageDeviceList").config(["$stateProvider","LOWER_FUNNEL_ABSTRACT_ROOT_STATE_NAME","COVERAGE_DEVICE_LIST_STATE_NAME",function($stateProvider,LOWER_FUNNEL_ABSTRACT_ROOT_STATE_NAME,COVERAGE_DEVICE_LIST_STATE_NAME){externalLogger.moduleConfigured("tmobileApp","coverageDeviceList :: config "+COVERAGE_DEVICE_LIST_STATE_NAME+" route");var covrageDeviceListStateConfig={url:"/optional-services",parent:LOWER_FUNNEL_ABSTRACT_ROOT_STATE_NAME,templateUrl:"app/core/components/coverageDeviceList/coverageDeviceList.Dev.html"};$stateProvider.state(COVERAGE_DEVICE_LIST_STATE_NAME,covrageDeviceListStateConfig)}])}(angular,externalLogger),function(angular){angular.module("tmobileApp").controller("creditClassSelectorCtrl",["$scope","$modal",function($scope,$modal){}])}(angular),function(angular,externalLogger){"use strict";angular.module("tmobileApp").config(["$stateProvider",function($stateProvider){externalLogger.moduleConfigured("core/tmobileApp","creditClassSelector.js"),$stateProvider.state("creditClassSelector",{url:"/creditClassSelector",templateUrl:"app/core/components/creditClassSelector/creditClassSelector.html"})}])}(angular,externalLogger),function(angular){"use strict";function detailPricingController($scope,productDetailsService,pdlBridge){function setDefaultPricingOption(){angular.isDefined(productDetailsService.model.selectedCreditClass)&&"creditClass3"===productDetailsService.model.selectedCreditClass["class"]?($scope.activeEIPPricing=!1,$scope.activeFRPPricing=!0,productDetailsService.model.priceOption="full",productDetailsService.model.selectedVal="full",pdlBridge.model.financeType="FRP"):"accessory"===productDetailsService.model.productCategoryType?productDetailsService.isAccessoryEIPEligible(productDetailsService.model.selectedProduct)?($scope.activeEIPPricing=!0,$scope.activeFRPPricing=!1):($scope.activeEIPPricing=!1,$scope.activeFRPPricing=!0):productDetailsService.isEIPProductTypeAvailable(productDetailsService.model.selectedProduct)?($scope.activeEIPPricing=!0,$scope.activeFRPPricing=!1,productDetailsService.model.selectedVal="monthly",pdlBridge.model.financeType="EIP"):($scope.activeEIPPricing=!1,$scope.activeFRPPricing=!0,productDetailsService.model.selectedVal="full",pdlBridge.model.financeType="FRP")}function setBooleanValues(property,force){var defaultValue=_.isBoolean(force)?force:!1;return _.isBoolean(property)||(property=_.isString(property)?_.isEqual(property.toLowerCase(),"true"):defaultValue),property}_.isEmpty($scope.strikeThroughText)&&($scope.strikeThroughText="{discount}"),$scope.monthyPricing=setBooleanValues($scope.monthlyPricing),$scope.frpPricing=setBooleanValues($scope.frpPricing),$scope.showTotalPricing=setBooleanValues($scope.showTotalPricing),$scope.showAsDiscount=setBooleanValues($scope.showAsDiscount),$scope.leftMagenta=setBooleanValues($scope.leftMagenta,!0),$scope.legalTermsMobile=setBooleanValues($scope.legalTermsMobile,!0),$scope.totalPriceOnly=setBooleanValues($scope.totalPriceOnly,!0),$scope.totalSaving=$scope.strikeThroughText.replace("{discount}",$scope.discountMoney),setDefaultPricingOption(),_.isEmpty($scope.decimalSeparator)&&($scope.decimalSeparator="."),_.isEmpty($scope.sizeClass)&&($scope.sizeClass="price-lockup-medium"),_.isEmpty($scope.monthlyToday)&&($scope.monthlyToday="$0"),_.isEmpty($scope.monthlyFinance)&&($scope.monthlyFinance="$0"),_.isEmpty($scope.monthlyFinance)&&($scope.monthlyFinance="$0"),$scope.showMonthyPricing=function(){return setBooleanValues($scope.monthlyPricing,!0)},$scope.showFRPPricing=function(){return setBooleanValues($scope.frpPricing,!0)},$scope.getShowAsDiscount=function(){return setBooleanValues($scope.showAsDiscount)},$scope.getShowTotalPricing=function(){return setBooleanValues($scope.showTotalPricing)},$scope.showlegalTermsMobile=function(){return setBooleanValues($scope.legalTermsMobile,!0)},$scope.getTotalPriceOnly=function(){return setBooleanValues($scope.totalPriceOnly,!0)},$scope.updateSelectedPricing=function(selectedPricingOption){"eip"===selectedPricingOption?($scope.activeEIPPricing=!0,$scope.activeFRPPricing=!1,productDetailsService.model.selectedVal="monthly",productDetailsService.model.priceOption="monthly",productDetailsService.model.userSelectedPricing="EIP",pdlBridge.model.financeType="EIP"):($scope.activeEIPPricing=!1,$scope.activeFRPPricing=!0,productDetailsService.model.selectedVal="full",productDetailsService.model.priceOption="full",productDetailsService.model.userSelectedPricing="FRP",pdlBridge.model.financeType="FRP")}}function detailPricingDirective(){return{restrict:"E",scope:{leftHeaderTxt:"@",monthlyToday:"@",monthlyFinance:"@",monthlyText:"@",downTaxLabel:"@",rightHeaderTxt:"@",frpPrice:"@",frpTaxLabel:"@",discountedPrice:"@",showDiscountedPricing:"@",showAsDiscount:"@",showTotalPricing:"@",totalPriceText:"@",totalPrice:"@",totalPriceOnly:"@",totalOriginalPrice:"@",noCreditCheck:"@",monthlyPricing:"@",frpPricing:"@",legalTermsText:"@",legalTermsMobile:"@",purchasePrice:"@",strikeThroughText:"@",frpPriceLabel:"@",discountMoney:"@"},templateUrl:"app/core/components/detailPricing/detailPricing.template.html",controller:detailPricingController}}detailPricingController.$inject=["$scope","productDetailsService","pdlBridge"],angular.module("tmobileApp").directive("detailPricing",detailPricingDirective)}(angular),function(angular){"use strict";angular.module("tmobileApp").constant("inventoryFilterConstant",{Select:"Select",Unselect:"Unselect"})}(angular),function(angular,lodash){"use strict";function storeLocatorModalControllerConstructor($scope,$modalInstance,apiService,storeLocatorModelService,storeLocatorInitUtil,storeLocatorUtil,$timeout,$log,storeLocatorConstants,mapEventHandlerUtil,mapEventSubscriberUtil,inventoryFilterConstant,cartStorage,toggleService){function showNearByStores(){if(vm.model.start=1,vm.model.showPrev=!1,vm.model.d2rModelManager.firstTimeInventoryLoad=!1,vm.model.pageType===vm.pages.CART||vm.model.pageType===vm.pages.MINIPDP||vm.model.pageType===vm.pages.PDP||vm.model.pageType===vm.pages.CARTACCESSORIES||vm.model.pageType===vm.pages.ACCESSORYMMINIPDP){var storeIdArray=lodash.map(vm.model.d2rModelManager.storesModelArr,function(obj){return obj.id});storeLocatorUtil.setInventoryData(getSKUArr(),storeIdArray).then(function(){vm.model.d2rModelManager.firstTimeInventoryLoad=!0,setListView()})}else setListView(),vm.model.d2rModelManager.firstTimeInventoryLoad=!0}function getSKUArr(){var skuArray=[],cartObj=cartStorage.getGlobalSmartCartInfo();if(vm.model.pageType===vm.pages.CART&&angular.isDefined(cartObj.lineItems)||vm.model.pageType===vm.pages.CARTACCESSORIES&&angular.isDefined(cartObj.accessories)){for(var i=0;i<cartObj.lineItems.length;i++)cartObj.lineItems[i].lineItemDetails.deviceDetails.sku&&skuArray.push(cartObj.lineItems[i].lineItemDetails.deviceDetails.sku);vm.toggles.d2rAccessories&&angular.isDefined(cartObj.accessories.accessoryDetails)&&angular.forEach(cartObj.accessories.accessoryDetails,function(accessory){angular.isDefined(accessory.sku)&&skuArray.push(accessory.sku)})}else(vm.model.pageType===vm.pages.MINIPDP||vm.model.pageType===vm.pages.PDP||vm.model.pageType===vm.pages.ACCESSORYMMINIPDP)&&(skuArray=[vm.model.d2rModelManager.product.sku]);return skuArray}function setListView(){vm.model.storeFilterAuthor.applyFilter?(vm.inventoryFilterStatus=inventoryFilterConstant.Select,vm.inventoryFilterStatusPdl=inventoryFilterConstant.Unselect,vm.model.storeList=vm.model.d2rModelManager.getInStockStores()):(vm.inventoryFilterStatus=inventoryFilterConstant.Unselect,vm.inventoryFilterStatusPdl=inventoryFilterConstant.Select,vm.model.storeList=vm.model.d2rModelManager.getAllStores()),vm.model.storeList&&vm.model.storeList.length<=vm.model.maxStoreDisplay?(vm.model.end=vm.model.storeList.length,vm.model.showNext=!1):(vm.model.end=vm.model.maxStoreDisplay,vm.model.showNext=!0),$timeout(function(){mapEventSubscriberUtil.subscribeToMapEvents(),"storeDetailView"!==vm.model.sectionToDisplay&&storeLocatorInitUtil.loadStoreMarkers()},2e3)}function close(store){try{vm.model.d2rModelManager.selectStore(store.getID()),vm.model.d2rModelManager=null}catch(ex){$log.error(ex.message)}vm.model.storeLocatorInModal=!1,$modalInstance.close("close")}function setStoreModelDefault(){angular.extend(vm.model,{getInventory:!0,storeLocatorInModal:!0})}function showSearchAreaButton(){"storeDetailView"===vm.model.sectionToDisplay?vm.searchEnable=vm.toggles.isSearchButtonEnabled:vm.searchEnable=!0}function init(){setStoreModelDefault(),angular.extend(vm,defaults),showNearByStores(),showSearchAreaButton()}var vm=this;vm.model=storeLocatorModelService.model,vm.views=storeLocatorConstants.SECTIONS,vm.productAnalyticsData=storeLocatorModelService.model.productAnalyticsData,vm.toggles=toggleService.model.toggles,vm.pages=storeLocatorConstants.PAGES;var inventoryFilterHandler=$scope.$on("apply-inventory-filter",function(){showNearByStores(),inventoryFilterHandler()}),defaults=Object.freeze({pccMapUrl:apiService.getURL("pccMap").url,close:close,showNearByStores:showNearByStores});$scope.$on("CLOSE_STORE_DETAIL",close),vm.onClickSearchThisArea=storeLocatorInitUtil.onSearchThisAreaClicked,vm.showSearchAreaButton=showSearchAreaButton,init()}storeLocatorModalControllerConstructor.$inject=["$scope","$modalInstance","apiService","storeLocatorModelService","storeLocatorInitUtil","storeLocatorUtil","$timeout","$log","storeLocatorConstants","mapEventHandlerUtil","mapEventSubscriberUtil","inventoryFilterConstant","cartStorage","toggleService"],angular.module("tmobileApp").controller("storeLocatorModalController",storeLocatorModalControllerConstructor)}(window.angular,window._),function(angular){"use strict";var storeViewComponent={bindings:{authorValue:"<",pageType:"@",item:"<"},controller:"storeViewController",controllerAs:"vm",templateUrl:"app/core/components/digitalToRetail/components/storeView/storeView.tpl.html"};angular.module("tmobileApp").component("storeView",storeViewComponent)}(window.angular),function(angular,lodash){"use strict";function storeViewControllerConstructor($log,$modal,D2RModelManager,productDetailsService,storeLocatorUtil,storeLocatorModelService,inventoryUtils,globalValue,storeLocatorConstants,digitalToRetailConstant,toggleService,cartStorage,$rootScope,accessoriesService){function openStoreLocatorModal(isAppointment){storeLocatorModelService.setStoreFilterAuthorContentInModel(vm.pageType),isAppointment?(storeModel.storeLocatorInModal=!0,storeModel.sectionToDisplay=storeLocatorConstants.SECTIONS.APPOINTMENT_FORM):(storeModel.sectionToDisplay=storeLocatorConstants.SECTIONS.SEARCH_RESULTS,storeModel.pageType=vm.pageType),storeModel.d2rModelManager=d2rModelManager,$modal.open({windowClass:"store-locator-d2r-modal",controller:"storeLocatorModalController",templateUrl:"app/core/components/digitalToRetail/components/storeLocator/storeLocatorModal.tpl.html",controllerAs:"vm"}).result.then(getSelectedStore)}function openAppointmentFlow(){openStoreLocatorModal(!0),storeLocatorModelService.showOperationSection(storeLocatorConstants.PAGES.ISA)}function setProduct(noInventoryFetch){d2rModelManager.setProduct(vm.item),noInventoryFetch||getInventory()}function subscribeToProductUpdates(noInventoryFetch){return setProduct(noInventoryFetch),productDetailsService.onProductDataUpdate().then(angular.noop,angular.noop,setModifiedProduct)}function getLocation(){return storeLocatorUtil.getUserLocation().then(function(data){vm.location=data},function(){throw d2rModelManager.product.setInventoryAvailability(digitalToRetailConstant.INVENTORY_STATUS.STORE_UNKNOWN),storeLocatorModelService.getPDLDataReady(),new Error("abort promise getLocation")})}function getStores(){return storeLocatorUtil.getStoreList(vm.location,storeModel.start,storeModel.d2rResultsCount,storeModel.miles,!0).then(function(storeResults){var storeList=d2rModelManager.setStores(storeResults.data);lodash.isEmpty(storeList)&&d2rModelManager.product.setInventoryAvailability(digitalToRetailConstant.INVENTORY_STATUS.STORE_UNKNOWN)},function(){throw d2rModelManager.product.setInventoryAvailability(digitalToRetailConstant.INVENTORY_STATUS.STORE_UNKNOWN),new Error("abort promise getStores")})}function getSelectedStore(){return storeModel.store=d2rModelManager.getSelectedStore(),vm.selectedStore=storeModel.currentStore?storeModel.currentStore:storeModel.store,vm.selectedStore}function getInventory(){return angular.isDefined(getSelectedStore())?inventoryUtils.callInventoryAvailabilityAPI(d2rModelManager.product.sku,getSelectedStore().getID()).then(function(inventoryResponse){var storeId="";if(angular.equals(inventoryResponse.data.statusCode,"200")){var result=inventoryResponse.data.result;if(result){var inventory=result.inventoryAvailabilityList[0];storeId=inventory.storeId,getSelectedStore().inventoryUpdate(inventory,d2rModelManager.product.getFamilyId()),d2rModelManager.product.inventoryUpdate(inventory)}else d2rModelManager.product.setInventoryAvailability(digitalToRetailConstant.INVENTORY_STATUS.INV_UNKNOWN)}else d2rModelManager.product.setInventoryAvailability(digitalToRetailConstant.INVENTORY_STATUS.INV_UNKNOWN);$rootScope.$broadcast("onLoadCartPage",d2rModelManager.product,storeId),storeLocatorModelService.getPDLDataReady()},function(){throw storeModel.hideContainer=!0,new Error("abort promise getInventory")}):null}function stopLoading(){vm.isLoading=!1,vm.productAnalyticsData=storeModel.productAnalyticsData}function errorCatch(){$log.log("error")}function getModel(){vm.hideContainer=storeModel.hideContainer;var activeModel=lodash.find(d2rModelManager.models(),function(model){return model.product.sku===vm.item.SKU});return vm.foundProductinArray=angular.isDefined(activeModel),
d2rModelManager=angular.isDefined(activeModel)?activeModel:d2rModelManager}function addModelToArray(){d2rModelManager.addModel(d2rModelManager)}function init(){if(storeModel.pageType=vm.pageType,angular.extend(vm,defaults),subscribeToProductUpdates(!0),getModel(),vm.foundProductinArray)storeLocatorModelService.getPDLDataReady(),$rootScope.$broadcast("onLoadCartPage",d2rModelManager.product,getSelectedStore().getID()),stopLoading();else{var sessionStoreArray=d2rModelManager.getStoreArrayFromSession();lodash.isEmpty(sessionStoreArray)?getLocation().then(getStores).then(getInventory)["catch"](errorCatch)["finally"](stopLoading):(d2rModelManager.storesModelArr.length<=0&&d2rModelManager.setStores(sessionStoreArray),getInventory()["catch"](errorCatch)["finally"](stopLoading)),addModelToArray()}vm.isLoading=!1}function showStoreDetailPage(){storeLocatorModelService.setStoreFilterAuthorContentInModel(vm.pageType),storeModel.storeLocatorInModal=!0,storeModel.d2rModelManager=d2rModelManager,$modal.open({windowClass:"store-locator-d2r-modal",controller:"storeLocatorModalController",templateUrl:"app/core/components/digitalToRetail/components/storeLocator/storeLocatorModal.tpl.html",controllerAs:"vm"}).result.then(getSelectedStore),storeModel.pageType=vm.pageType,storeLocatorModelService.showOperationSection(storeLocatorConstants.PAGES.STORE)}function setModifiedProduct(){switch(vm.pageType){case storeLocatorConstants.PAGES.PDP:d2rModelManager.setProduct({familyId:productDetailsService.model.selectedProduct.familyId,SKU:productDetailsService.model.selectedProduct.SKU});break;case storeLocatorConstants.PAGES.MINIPDP:d2rModelManager.setProduct({familyId:productDetailsService.miniPDPSelectedProduct.familyId,SKU:productDetailsService.miniPDPSelectedProduct.SKU});break;case storeLocatorConstants.PAGES.ACCESSORYMMINIPDP:storeModel.selectedProduct;d2rModelManager.setProduct({familyId:accessoriesService.selectedAccessory.familyId,SKU:accessoriesService.selectedAccessory.SKU})}getInventory()}function triggerPDLEvent(ctaName,modalName){return{eventType:"clickToNavigate",assetType:"link",product:storeModel.productAnalyticsData,ctaName:ctaName,modalName:modalName,eventCategory:"storeinventory"}}function getPdlEventName(){switch(vm.pageType){case"pdp":return"pdp";case"minipdp":return"modal";default:return""}}function getPdlProductData(){if(!lodash.isEmpty(vm.productAnalyticsData))switch(vm.pageType){case"pdp":return vm.productAnalyticsData[0];case"minipdp":return vm.productAnalyticsData;default:return""}}var vm=this,storeModel=storeLocatorModelService.model,d2rModelManager=D2RModelManager.prototype.model();vm.toggles=toggleService.model.toggles,vm.cartData=cartStorage.getGlobalSmartCartInfo();var defaults=Object.freeze({isLoading:!0,selectedSKU:"",product:d2rModelManager.getProduct(),location:{},digitalToRetailAuthoring:globalValue.authorValue.storeauthoring.digitalToRetail,selectedStore:null,foundProductinArray:!1});init(),vm.openStoreLocatorModal=openStoreLocatorModal,vm.openAppointmentFlow=openAppointmentFlow,vm.getSelectedStore=getSelectedStore,vm.showStoreDetailPage=showStoreDetailPage,vm.addModelToArray=addModelToArray,vm.getModel=getModel,vm.stopLoading=stopLoading,vm.getLocation=getLocation,vm.getStores=getStores,vm.getInventory=getInventory,vm.setModifiedProduct=setModifiedProduct,vm.triggerPDLEvent=triggerPDLEvent,vm.getPdlEventName=getPdlEventName,vm.getPdlProductData=getPdlProductData}storeViewControllerConstructor.$inject=["$log","$modal","D2RModelManager","productDetailsService","storeLocatorUtil","storeLocatorModelService","inventoryUtils","globalValue","storeLocatorConstants","digitalToRetailConstant","toggleService","cartStorage","$rootScope","accessoriesService"],angular.module("tmobileApp").controller("storeViewController",storeViewControllerConstructor)}(window.angular,window._),function(angular){"use strict";angular.module("tmobileApp").constant("digitalToRetailConstant",{INVENTORY_STATUS:{STORE_LOCATION_UNKNOWN:"STORE_LOCATION_UNKNOWN",INV_UNKNOWN:"INV_UNKNOWN",STORE_UNKNOWN:"STORE_UNKNOWN",103:"IN_STOCK",102:"FEW_LEFT",101:"OUT_OF_STOCK"},INVENTORY_STATUS_AUTHOR_KEY:{INV_UNKNOWN:"INV_UNKNOWN",STORE_UNKNOWN:"STORE_UNKNOWN"},INVENTORY_STATUS_TOGGLE:{SHOW:"SHOW",HIDE:"HIDE"},APPOINTMENT_CTA_TOGGLE:{SHOW:"SHOW",HIDE:"HIDE"},APPLY_STORE_FILTER:{YES:"YES",NO:"NO"},PAGE_TYPE:{CART:"cart",PDP:"pdp"},MAGENTA_STORE:"RETAIL",INVENTORY_STATUS_CODE:{IN_STOCK:103,FEW_LEFT:102,OUT_OF_STOCK:101,INV_UNKNOWN:108},DTR_MODAL_NAME:{STORE_DETAILS:"Store Details Page",STORE_LIST:"Store List Page"}})}(window.angular),function(angular,lodash){"use strict";function inventoryStatusService(toggleService,cartStorage,inventoryUtils,cartConstants,commonServices,$log,digitalToRetailConstant,globalValue){function getCartSkuList(){var cartSkuList=[];return vm.cartObj=cartStorage.getGlobalSmartCartInfo(),angular.isDefined(vm.cartObj.lineItems)&&angular.forEach(vm.cartObj.lineItems,function(lineItem){lodash.isEmpty(lineItem.lineItemDetails.deviceDetails.sku)||cartSkuList.push(lineItem.lineItemDetails.deviceDetails.sku)}),vm.d2rAccessories&&angular.isDefined(vm.cartObj.accessories.accessoryDetails)&&(cartSkuList=lodash.concat(cartSkuList,lodash.map(vm.cartObj.accessories.accessoryDetails,function(accessory){return accessory.sku})||[])),cartSkuList}function loadInventoryData(selectedStore){var deferred=$q.defer();return vm.selectedStore=selectedStore,getCartSkuList(),vm.deviceList=[],vm.accessoryList=[],vm.selectedStore.cartObj=angular.copy(vm.cartObj),angular.forEach(vm.selectedStore.cartObj.lineItems,function(line){angular.isDefined(line.lineItemDetails.deviceDetails.familyName)&&vm.deviceList.push(line)}),vm.d2rAccessories&&angular.forEach(vm.selectedStore.cartObj.accessories.accessoryDetails,function(accessory){angular.isDefined(accessory.familyName)&&vm.accessoryList.push(accessory)}),deferred.resolve(),deferred.promise}function getInventoryDetails(){var skuArray=vm.getCartSkuList(),storeId=vm.selectedStore.id;return inventoryUtils.callInventoryAvailabilityAPI(skuArray,storeId).then(function(inventoryData){if(angular.equals(inventoryData.data.statusCode,"200")){var inventoryDetails=inventoryData.data.result.inventoryAvailabilityList[0],availableCount=0;inventoryDetails&&(availableCount+=setInventoryStatus(vm.selectedStore.cartObj.lineItems,inventoryDetails,!0),vm.d2rAccessories&&(availableCount+=setInventoryStatus(vm.selectedStore.cartObj.accessories.accessoryDetails,inventoryDetails,!1))),setAvailabilityMsgOnCTA(vm.selectedStore,availableCount)}else $log.log("status != 200")})}function setInventoryStatus(cartItemObj,inventoryDetails,isDevice){var availableItemCount=0;return angular.forEach(cartItemObj,function(item){angular.forEach(inventoryDetails.skuDetails,function(skuDetail){if(isDevice&&item.lineItemDetails.deviceDetails.sku===skuDetail.skuId||!isDevice&&item.sku===skuDetail.skuId){skuDetail.availabilityStatus=skuDetail.availabilityStatus||digitalToRetailConstant.INVENTORY_STATUS.INV_UNKNOWN;var inventoryStatus=inventoryUtils.getSKUinventoryStatusKeyMatch(skuDetail);(103===skuDetail.availabilityStatus||102===skuDetail.availabilityStatus)&&(availableItemCount++,item.isAvailable=!0),item.statusValue=inventoryStatus.statusValue,item.availabilityStatus=skuDetail.availabilityStatus}})}),availableItemCount}function setAvailabilityMsgOnCTA(store,availableCount){vm.outOfStock=!1;var skuArray=vm.getCartSkuList();vm.showItemsCTAName=cartConstants.SAVE_CART.SHOW_ITEMS,skuArray.length===availableCount&&availableCount>1?store.inventoryStatus=vm.storeauthoring.digitalToRetail.allInStock:skuArray.length===availableCount&&1===availableCount?store.inventoryStatus=vm.storeauthoring.digitalToRetail.inStock:skuArray.length>availableCount&&availableCount>1?store.inventoryStatus=availableCount+" "+vm.storeauthoring.digitalToRetail.fewInStock:skuArray.length>availableCount&&1===availableCount?store.inventoryStatus=vm.storeauthoring.digitalToRetail.inStock:(store.inventoryStatus=vm.storeauthoring.digitalToRetail.outOfStock,vm.outOfStock=!0)}var vm=this;vm.d2rAccessories=lodash.get(toggleService.model,"toggles.d2rAccessories",!1);var $q=commonServices.$q;vm.storeauthoring=globalValue.authorValue.storeauthoring,vm.loadInventoryData=loadInventoryData,vm.getInventoryDetails=getInventoryDetails,vm.getCartSkuList=getCartSkuList,vm.setAvailabilityMsgOnCTA=setAvailabilityMsgOnCTA}inventoryStatusService.$inject=["toggleService","cartStorage","inventoryUtils","cartConstants","commonServices","$log","digitalToRetailConstant","globalValue"],angular.module("tmobileApp").service("inventoryStatusService",inventoryStatusService)}(window.angular,window._),function(angular,lodash){"use strict";angular.module("tmobileApp").factory("D2RModelManager",["D2RStore","D2RProduct","digitalToRetailConstant","storeLocatorModelService","storeLocatorConstants",function(D2RStore,D2RProduct,digitalToRetailConstant,storeLocatorModelService,storeLocatorConstants){function D2RModelManager(){this.product=new D2RProduct,this.storesModelArr=[]}return D2RModelManager.prototype={modelArr:[],firstTimeInventoryLoad:!1,model:function(){var newModel=new D2RModelManager;return newModel},addModel:function(newModel){this.modelArr.push(newModel)},models:function(){return this.modelArr},clearModels:function(){this.modelArr=[]},setProduct:function(data){return this.product.setData(data),this.product},getProduct:function(){return this.product},getSKUArr:function(pageType){var singleItemPages=[storeLocatorConstants.PAGES.PDP,storeLocatorConstants.PAGES.ACCESSORYMMINIPDP,storeLocatorConstants.PAGES.MINIPDP];return lodash.includes(singleItemPages,pageType)?[this.getProduct().getSKU()]:this.modelArr.map(function(dataModelManager){return dataModelManager.getProduct().getSKU()})},getInStockStores:function(){return lodash.filter(this.storesModelArr,function(store){return store.filteredAvailableStores()})},getAllStores:function(){return this.storesModelArr},setStores:function(storeArr){this.storesModelArr=[];var self=this;return lodash.forEach(storeArr,function(storeObj){storeObj.type===digitalToRetailConstant.MAGENTA_STORE&&self.storesModelArr.push(new D2RStore(storeObj))}),this.setStoreArrayInSession(),this.getAllStores()},getStore:function(storeID){return lodash.find(this.storesModelArr,function(store){return store.getID()===storeID})},selectStore:function(storeID){this.getStore(storeID).select(),lodash.forEach(this.storesModelArr,function(store){store.resetSelection(storeID)})},getSelectedStore:function(){var selectedStore=storeLocatorModelService.model.store;return lodash.find(this.storesModelArr,function(store){return store.isSelected})||(selectedStore&&Object.keys(selectedStore).length?new D2RStore(storeLocatorModelService.model.store):this.getFirstStore())},getFirstStore:function(){return this.storesModelArr[0]},removeNonMagentaStores:function(arrStores){return lodash.filter(arrStores,function(store){return store.type===digitalToRetailConstant.MAGENTA_STORE?store:void 0})},updateStoreArrtoAllModels:function(sessionStoreArray){this.modelArr.length>0&&lodash.forEach(this.modelArr,function(model,index){model.setStores(sessionStoreArray)})},setStoresInSession:function(inStore){sessionStorage.setItem("selectedStore",angular.toJson(inStore)),this.selectStore(inStore.id),this.updateStoreArrtoAllModels(this.storesModelArr),this.setStoreArrayInSession()},setStoreArrayInSession:function(){sessionStorage.setItem("storeArray",angular.toJson(this.storesModelArr))},getStoreArrayFromSession:function(){return angular.fromJson(sessionStorage.getItem("storeArray"))}},D2RModelManager}])}(window.angular,window._),function(angular,lodash){"use strict";angular.module("tmobileApp").factory("D2RProduct",["digitalToRetailConstant","inventoryUtils","storeLocatorModelService",function(digitalToRetailConstant,inventoryUtils,storeLocatorModelService){function D2RProduct(productData){productData&&this.setData(productData)}return D2RProduct.prototype={setData:function(productData){this.setSKU(productData.SKU),this.setFamilyId(productData.familyId)},setAvailabilityStatusCode:function(availabilityStatusCode){this.availabilityStatusCode=availabilityStatusCode},getAvailabilityStatusCode:function(){return this.availabilityStatusCode},setSKU:function(sku){this.sku=sku},getSKU:function(){return this.sku},getFamilyId:function(){return this.familyId},setFamilyId:function(familyId){this.familyId=familyId},setInventoryAvailability:function(availabilityStatus){var statusKey=lodash.isNil(availabilityStatus)?digitalToRetailConstant.INVENTORY_STATUS.INV_UNKNOWN:availabilityStatus;this.setAvailabilityStatusCode(statusKey),this.inventoryAvailability=inventoryUtils.getInventoryStatusKeyMatch(statusKey,this.getFamilyId()),storeLocatorModelService.model.inventoryDetails.availabilityCode=statusKey},getInventoryStatusMessage:function(){return storeLocatorModelService.model.inventoryDetails.statusValue=this.inventoryAvailability.statusValue,this.inventoryAvailability.statusValue},filterAvailabilityStatus:function(){return 102===this.availabilityStatusCode||103===this.availabilityStatusCode},isInventoryStatusHidden:function(){return lodash.isNil(this.inventoryAvailability)||lodash.isNil(this.inventoryAvailability.showInventory)?!0:this.inventoryAvailability.showInventory===digitalToRetailConstant.INVENTORY_STATUS_TOGGLE.HIDE},inventoryUpdate:function(inventory){if(inventory){var skuDetail=inventory.skuDetails&&inventory.skuDetails[0]||{};this.setInventoryAvailability(skuDetail.availabilityStatus)}},inventoryUpdateOnCart:function(skuDetail){this.setInventoryAvailability(skuDetail.availabilityStatus),this.setSKU(skuDetail.skuId)},getD2RContainerHeader:function(){return inventoryUtils.getHeaderTextContainer(this.getAvailabilityStatusCode()).globalInvContainerText},getInventoryContainerHeaderMessage:function(){return lodash.get(this.inventoryAvailability,"inventoryContainerMsg","")}},D2RProduct}])}(window.angular,window._),function(angular){"use strict";angular.module("tmobileApp").factory("D2RStore",["inventoryUtils","digitalToRetailConstant",function(inventoryUtils,digitalToRetailConstant){function D2RStore(storeData){storeData&&this.setData(storeData)}return D2RStore.prototype={setData:function(storeData){angular.extend(this,storeData),this.isSelected=storeData.isSelected?!0:!1},resetSelection:function(storeID){storeID!==this.getID()&&(this.isSelected=!1)},inventoryUpdate:function(inventory,familyId){if(inventory){var skuDetail=inventory.skuDetails&&inventory.skuDetails[0]||{};this.setStoreParticipation("true"===inventory.storeParticipation),this.setSKUParticipation("true"===skuDetail.skuParticipation),this.setAvailabilityCode(skuDetail.availabilityStatus),this.setSKU(skuDetail.skuId),this.setStoreAppointment(skuDetail,familyId)}},setStoreAppointment:function(skuDetail,familyId){this.scheduleAppointment=inventoryUtils.getStoreAppointmentKeyMatch(skuDetail,this.getID(),familyId).show===digitalToRetailConstant.APPOINTMENT_CTA_TOGGLE.SHOW},setStoreParticipation:function(storeParticipation){this.storeParticipation=storeParticipation},getStoreParticipation:function(){return this.storeParticipation},select:function(){this.isSelected=!0},getID:function(){return this.id},getName:function(){return this.name},getDistance:function(){return this.storeDistance},isAppointmentAvailable:function(){return this.scheduleAppointment&&this.inStoreAppointment||!1},setAvailabilityCode:function(availabilityCode){this.availabilityCode=availabilityCode},getAvailabilityCode:function(){return this.availabilityCode},isInStock:function(){return 103===this.availabilityCode},isFew:function(){return 102===this.availabilityCode},isOutOfStock:function(){return 101===this.availabilityCode},filteredAvailableStores:function(){return 102===this.availabilityCode||103===this.availabilityCode},isInventoryKnown:function(){return this.isInStock()||this.isFew()||this.isOutOfStock()},isInventoryUnknown:function(){return!this.isInventoryKnown()},setSKU:function(sku){this.sku=sku},getSKU:function(){return this.sku},setSKUParticipation:function(value){this.skuParticipation=value},getSKUParticipation:function(){return this.skuParticipation},inventoryUpdateOnCart:function(skuDetail,familyId,storeParticipation){this.setStoreParticipation("true"===storeParticipation),this.setSKUParticipation("true"===skuDetail.skuParticipation),this.setAvailabilityCode(skuDetail.availabilityStatus),this.setSKU(skuDetail.skuId),this.setStoreAppointment(skuDetail,familyId)}},D2RStore}])}(window.angular),function(angular,lodash){"use strict";function inventoryUtilsConstructor(apiService,httpRequestWrapper,digitalToRetailConstant,globalValue){function callInventoryAvailabilityAPI(skuArray,storeID){angular.isString(skuArray)&&(skuArray=skuArray.split(",")),angular.isString(storeID)&&(storeID=storeID.split(","));var body={products:skuArray,locations:storeID},header={},url=apiService.getURL("inventoryVisibilityAPI").url;return httpRequestWrapper.post(url,body,null,header,!0,"inventoryAPI")}function getInventoryStatusKeyMatch(availabilityStatus,familyId){var inventoryStatusFamilyLevelArr=transformStatusList(digitalToRetailAuthoring.inventoryStatusFamilyLevel),inventoryStatusGlobalLevel=transformStatusList(digitalToRetailAuthoring.inventoryStatusGlobalLevel);return lodash.find(inventoryStatusFamilyLevelArr,function(status){return status.statusKey===digitalToRetailConstant.INVENTORY_STATUS[availabilityStatus]&&angular.equals(status.familyId,familyId)})||lodash.find(inventoryStatusGlobalLevel,function(status){return status.statusKey===digitalToRetailConstant.INVENTORY_STATUS[availabilityStatus]})||{showInventory:digitalToRetailConstant.INVENTORY_STATUS_TOGGLE.HIDE}}function getSKUinventoryStatusKeyMatch(skuInventory){var inventoryStatusSkuLevelArr=transformStatusList(digitalToRetailAuthoring.inventoryStatusSkuLevel),inventoryStatusGlobalLevel=transformStatusList(digitalToRetailAuthoring.inventoryStatusGlobalLevel);return lodash.find(inventoryStatusSkuLevelArr,function(status){return status.statusKey===digitalToRetailConstant.INVENTORY_STATUS[skuInventory.availabilityStatus]&&angular.equals(status.skuId,skuInventory.skuId)})||lodash.find(inventoryStatusGlobalLevel,function(status){return status.statusKey===digitalToRetailConstant.INVENTORY_STATUS[skuInventory.availabilityStatus]})||{showInventory:digitalToRetailConstant.INVENTORY_STATUS_TOGGLE.HIDE}}function getStoreAppointmentKeyMatch(input,storeId,familyId){var appointmentInventoryLevel=transformStatusList(digitalToRetailAuthoring.appointmentInventoryLevel),appointmentFamilyLevel=transformStatusList(digitalToRetailAuthoring.appointmentFamilyLevel),appointmentStoreLevel=transformStatusList(digitalToRetailAuthoring.appointmentStoreLevel);return lodash.find(appointmentFamilyLevel,function(element){return element.statusKey===digitalToRetailConstant.INVENTORY_STATUS[input.availabilityStatus]&&angular.equals(element.familyId,familyId)})||lodash.find(appointmentStoreLevel,function(element){return element.statusKey===digitalToRetailConstant.INVENTORY_STATUS[input.availabilityStatus]&&angular.equals(element.storeId,storeId)})||lodash.find(appointmentInventoryLevel,function(element){return element.statusKey===digitalToRetailConstant.INVENTORY_STATUS[input.availabilityStatus]})||{show:digitalToRetailConstant.INVENTORY_STATUS_TOGGLE.HIDE}}function getHeaderTextContainer(availabilityStatusCode){var inventoryStatusGlobalLevel=transformStatusList(digitalToRetailAuthoring.inventoryStatusGlobalLevel);return lodash.find(inventoryStatusGlobalLevel,function(status){return status.statusKey===digitalToRetailConstant.INVENTORY_STATUS[availabilityStatusCode]})||{}}function transformStatusList(input){var output;return output=lodash.isArray(input)?lodash.map(input,function(item){return angular.isString(item)?angular.fromJson(item):item}):angular.isString(input)?angular.fromJson(input):input}var digitalToRetailAuthoring=lodash.get(globalValue.authorValue.storeauthoring,"digitalToRetail");return{callInventoryAvailabilityAPI:callInventoryAvailabilityAPI,getInventoryStatusKeyMatch:getInventoryStatusKeyMatch,getHeaderTextContainer:getHeaderTextContainer,getStoreAppointmentKeyMatch:getStoreAppointmentKeyMatch,getSKUinventoryStatusKeyMatch:getSKUinventoryStatusKeyMatch}}inventoryUtilsConstructor.$inject=["apiService","httpRequestWrapper","digitalToRetailConstant","globalValue"],angular.module("tmobileApp").factory("inventoryUtils",inventoryUtilsConstructor)}(window.angular,window._),function(angular){"use strict";function entrust(){return{restrict:"E",scope:{fullPrice:"@",discountPrice:"@",priceLabel:"@"},templateUrl:"app/core/components/discountLockup/discountLockup.template.html",replace:!0,link:function(scope,element,attrs){function init(){scope.label=scope.priceLabel,scope.fullPrice=scope.fullPrice&&scope.fullPrice.length>0?scope.fullPrice:"00.00";var fullCostArray=parseCost(scope.fullPrice);scope.fullPriceDollar=fullCostArray[0],scope.fullPriceCents=fullCostArray[1],scope.discountPrice=scope.discountPrice&&scope.discountPrice.length>0?scope.discountPrice:"00.00";var disPriceArray=parseCost(scope.discountPrice);scope.disPriceDollar=disPriceArray[0],scope.disPriceCents=disPriceArray[1],scope.strikeThrough="",scope.hideDiscount="",scope.fullPrice!=scope.discountPrice?scope.strikeThrough="strike-through":scope.hideDiscount="hide-discount"}function parseCost(amount){if(!amount||""===amount.trim())throw"Cost information is improper";if(amount=amount.replace("$",""),isNaN(parseFloat(amount)))throw"Cost is not a valid number";return amount.indexOf(".")>-1?amount.split("."):[amount,"00"]}init()}}}angular.module("tmobileApp").directive("discountLockup",entrust)}(angular),function(angular){"use strict";function httpErrorStateConstructor($httpProvider){externalLogger.moduleConfigured("tmobileCore","errorState.config.js")}httpErrorStateConstructor.$inject=["$httpProvider"],angular.module("tmobileCore").config(httpErrorStateConstructor)}(window.angular),function(angular){"use strict";function errorStateDirectiveConstructor($log,$timeout,$interval,$templateCache,$compile,$window,$state,globalValue,errorStateService,commonUtils,jsonPath){function renderTemplate(scope,element,attrs){scope.$on("onShowError",function(event,errorArray){if(errorArray&&errorArray.length>0){var returnObject=commonUtils.searchJson(errorArray,'[?(@.functionality=="'+attrs.functionality+'")]');returnObject&&(scope.error=returnObject,scope.error.autherValueKeyMessage=commonUtils.searchJson(globalValue.authorValue,returnObject.authorValueKey))}else scope.error=null;var rawTemplate=$templateCache.get("app/core/components/errorState/errorState.html");element.html(rawTemplate).show(),$compile(element.contents())(scope)})}return{restrict:"E",scope:!0,link:function(scope,element,attrs){renderTemplate(scope,element,attrs)}}}errorStateDirectiveConstructor.$inject=["$log","$timeout","$interval","$templateCache","$compile","$window","$state","globalValue","errorStateService","commonUtils","jsonPath"],angular.module("tmobileApp").directive("errorState",errorStateDirectiveConstructor)}(angular),function(angular){"use strict";function errorStateServiceConstructor($rootScope,commonUtils,globalConfig){function broadcastError(){$rootScope.$broadcast("onShowError",errorArray)}function showError(key){errorArray=commonUtils.searchJson(errorList,key),broadcastError()}function receiveError(data){showError("OK")}function resetErrorAll(){errorArray=[],broadcastError()}function resetError(functionality){errorArray=_.filter(errorArray,function(error){return error.functionality!==functionality}),broadcastError()}var errorList=globalConfig.errorStates,errorArray=null;return{receiveError:receiveError,resetErrorAll:resetErrorAll,resetError:resetError,showError:showError}}errorStateServiceConstructor.$inject=["$rootScope","commonUtils","globalConfig"],angular.module("tmobileCore").service("errorStateService",errorStateServiceConstructor)}(angular),function(angular){"use strict";function featureListCtrlFn($modal){function openlearnMoreFeaturesModal(learnMorePath){$modal.open({windowClass:"modalClass",templateUrl:learnMorePath})}var vm=this;vm.openlearnMoreFeaturesModal=openlearnMoreFeaturesModal}featureListCtrlFn.$inject=["$modal"],angular.module("tmobileApp").controller("featureListCtrl",featureListCtrlFn)}(window.angular),function(angular){"use strict";function featureListDirectiveConstructor($log,$templateCache,$compile,$window,$timeout,$filter){function setFeatureData(scope,attrs){var featuresAuthorData;if(scope.featureListCol1=[],scope.featureListCol2=[],scope.featureData&&""!==scope.featureData){featuresAuthorData=$filter("orderBy")(scope.featureData,"-includedFeature");for(var i=0;i<featuresAuthorData.length;i++)i<featuresAuthorData.length/2?scope.featureListCol1.push(featuresAuthorData[i]):scope.featureListCol2.push(featuresAuthorData[i])}}return{restrict:"A",transclude:!0,scope:{featureData:"="},templateUrl:"app/core/components/featureList/featureList.html",link:function(scope,element,attrs){setFeatureData(scope,attrs)}}}featureListDirectiveConstructor.$inject=["$log","$templateCache","$compile","$window","$timeout","$filter"];var moduleName="tmobileApp",directiveName="featureList";angular.module(moduleName).directive(directiveName,featureListDirectiveConstructor)}(window.angular),function(angular){"use strict";var moduleName="tmobileApp",componentName="commonFooter",footercomponentConstructor={templateUrl:"app/core/components/footer/footer.html",controller:"FooterController",controllerAs:"vm",bindings:{keyValue:"="}};angular.module(moduleName).component(componentName,footercomponentConstructor)}(angular),function(angular){"use strict";function footerControllerFunction($scope,$rootScope,mpLocalizationService,universalMenuDataService,toggleService){function toggleLanguage(lang){mpLocalizationService.init(),mpLocalizationService.switchLanguage(mpLocalizationService.MPkeys.UrlLang==lang?"en":lang),vm.userPreferredLanguage=null==mpLocalizationService.getCookie("MP_LANG")?"en":mpLocalizationService.getCookie("MP_LANG")}var vm=this;vm.footerKeyValues=vm.keyValue,vm.toggles=toggleService.model.toggles,vm.universalNavService=universalMenuDataService,vm.isLocalizationEnabled=mpLocalizationService.localizationFlag,vm.isLocalizationEnabled&&(mpLocalizationService.loadLocalizationScript(),vm.userPreferredLanguage=null==mpLocalizationService.getCookie("MP_LANG")?"en":mpLocalizationService.getCookie("MP_LANG")),vm.toggleLanguage=toggleLanguage}footerControllerFunction.$inject=["$scope","$rootScope","mpLocalizationService","universalMenuDataService","toggleService"];var controllerName="FooterController";angular.module("tmobileApp").controller(controllerName,footerControllerFunction)}(angular),function(angular){"use strict";var impactRadiusComponentConstructor={controller:"impactRadiusController",controllerAs:"vm",bindings:{pageView:"@",idNumber:"<?"}};angular.module("marketingCore").component("impactRadius",impactRadiusComponentConstructor)}(window.angular),function(angular){"use strict";function impactRadiusControllerConstructor(authTokenManager,apiService){function loadIRScript(channelId,tag,custId,orderId){var url=apiService.getURL("impactRadiusScript").url,head=document.getElementsByTagName("head")[0],impactRadiusScript=document.createElement("script");url=url.replace("{{channelId}}",channelId).replace("{{tag}}",tag).replace("{{custId}}",custId).replace("{{orderId}}",orderId),impactRadiusScript.src=url,impactRadiusScript.async=!0,head.appendChild(impactRadiusScript)}function loadLivePersonGlobalScript(custId){var head=document.getElementsByTagName("head")[0],impactRadiusScript=document.createElement("script");impactRadiusScript.async=!0;var scriptContent='window.lpTag && lpTag.events.bind({\neventName: "conversationInfo",\nappName: "lpUnifiedWindow",\nfunc: function(eventData) {\ntry {\nif (eventData.state && (eventData.state + "").toLowerCase() == "initialised") {\nire(\'trackConversion\', {{leadId}}, {\norderId: \'{{amcId}}\',\ncustomerId: (eventData.conversationId || "").toString(),\ncustomerEmail: ""\n});\n}\n} catch (ex) {\n}\n},\n triggerOnce: false\n});\n';impactRadiusScript.textContent=scriptContent.replace("{{leadId}}",leadIDConstants[vm.pageView]).replace("{{amcId}}",custId),head.appendChild(impactRadiusScript)}function createConversionTag(custId,orderId){var head=document.getElementsByTagName("head")[0],impactRadiusScript=document.createElement("script");switch(impactRadiusScript.async=!0,vm.pageView){case"APPOINTMENT_CONF":var scriptContent='ire(\'trackConversion\', {{leadId}}, {\norderId: "{{amcId}}",\ncustomerId: "{{leadId_SF}}",\ncustomerEmail: "",\n}, {verifySiteDefinitionMatch: true});\n';impactRadiusScript.textContent=scriptContent.replace("{{leadId}}",leadIDConstants[vm.pageView]).replace("{{amcId}}",custId).replace("{{leadId_SF}}",vm.idNumber),head.appendChild(impactRadiusScript);break;case"SAVE_CART_TO_RETAIL":var scriptContent='ire(\'trackConversion\', {{leadId}}, {\norderId: "{{amcId}}",\ncustomerId: "{{cartID}}",\ncustomerEmail: "",\n}, {verifySiteDefinitionMatch: true});\n';impactRadiusScript.textContent=scriptContent.replace("{{leadId}}",leadIDConstants[vm.pageView]).replace("{{amcId}}",custId).replace("{{cartID}}",vm.idNumber),head.appendChild(impactRadiusScript);break;case"VIP_AAL_CONF":window.irEvent.setCustomerId(orderId.toString()),window.irEvent.setOrderId(custId.toString()),window.irEvent.fire();break;case"VIP_AAL_CONF_API":impactRadiusScript.src=apiService.getURL("VIP_AAL_Script").url,head.appendChild(impactRadiusScript)}}function initialize(){var adobeMarkettingIdKey="MCMID",adobeMarkettingId=authTokenManager.getTokenCookies("AMCV_1358406C534BC94D0A490D4D@AdobeOrg");angular.isDefined(adobeMarkettingId)&&(adobeMarkettingId=decodeURIComponent(adobeMarkettingId),amcId=adobeMarkettingId.split("|")[adobeMarkettingId.split("|").indexOf(adobeMarkettingIdKey)+1]);var custId=amcId||"none";if(angular.equals(vm.pageView,"LP_SCRIPT"))loadLivePersonGlobalScript(custId);else{var channelId=channelIDConstants[vm.pageView],orderId=authTokenManager.getTokenCookies("interactionId")||"123456789012443231",tag="ifconv";if("CHECKOUT_CONF"===vm.pageView&&(orderId=vm.idNumber,tag="conv"),_.has(channelIDConstants,vm.pageView))loadIRScript(channelId,tag,custId,orderId);else{if(!_.has(leadIDConstants,vm.pageView))return;createConversionTag(custId,orderId)}}}var vm=this,amcId="",channelIDConstants={CART_VIEW:"11555",CHECKOUT_SHIPPING:"11556",CHECKOUT_PAYMENT:"11557",CHECKOUT_REVIEW:"11135",CHECKOUT_CONF:"10286",SWITCH_TO_TMOBILE:"13379"},leadIDConstants={APPOINTMENT_CONF:"14926",SAVE_CART_TO_RETAIL:"14924",VIP_AAL_CONF:void 0,VIP_AAL_CONF_API:void 0,LP_SCRIPT:"13224"};initialize()}impactRadiusControllerConstructor.$inject=["authTokenManager","apiService"],angular.module("marketingCore").controller("impactRadiusController",impactRadiusControllerConstructor)}(angular),function(angular){"use strict";var invocaScriptComponentConstructor={controller:"invocaScriptController",controllerAs:"vm",bindings:{invocaToggle:"<"}};angular.module("marketingCore").component("invocaScript",invocaScriptComponentConstructor)}(window.angular),function(angular){"use strict";function invocaScriptControllerConstructor(commonServices,invocaScriptService){var vm=this,$window=commonServices.$window,toggles=vm.invocaToggle;$window.addEventListener("load",function(){toggles.invocaScript&&($window.InvocaTagId="1639/1045158119",invocaScriptService.invocaToggle=!0,invocaScriptService.loadInvocaScript()),toggles.lpCampaignIDToggle&&invocaScriptService.sendPageUrlToLivePerson()})}invocaScriptControllerConstructor.$inject=["commonServices","invocaScriptService"],angular.module("marketingCore").controller("invocaScriptController",invocaScriptControllerConstructor)}(window.angular),function(angular,lodash,invoca){"use strict";function invocaScriptServiceConstructor(commonServices,apiService){function loadInvocaScript(){$timeout(function(){try{var url=apiService.getURL("invoca").url,head=$window.document.getElementsByTagName("head")[0],invocaScriptElem=$window.document.createElement("script");
invocaScriptElem.src=url,invocaScriptElem.defer=!0,head.appendChild(invocaScriptElem)}catch(err){$log.log("Error occurred while running invoca",err)}},2e3)}function runPnapi(timeoutDuration){vm.invocaToggle&&$timeout(function(){var Invoca=invoca||$window.Invoca;lodash.isEmpty(Invoca)?loadInvocaScript():Invoca.PNAPI.run()},timeoutDuration||1e3)}function addlpcampaignID(url){$window.lpTag&&$window.lpTag.sdes&&$window.lpTag.sdes.push({type:"mrktInfo",info:{campaignId:url}})}function sendPageUrlToLivePerson(){$timeout(function(){try{addlpcampaignID($window.location.href),$rootScope.$on("$locationChangeSuccess",function(event,newUrl,oldUrl){oldUrl!==newUrl&&addlpcampaignID(newUrl)})}catch(err){$log.log("Error occurred while pushing page URL to LivePerson",err)}},3e3)}var $timeout=commonServices.$timeout,$window=commonServices.$window,$rootScope=commonServices.$rootScope,$log=commonServices.$log,vm=this;vm.invocaToggle=!1,vm.loadInvocaScript=loadInvocaScript,vm.runPnapi=runPnapi,vm.sendPageUrlToLivePerson=sendPageUrlToLivePerson}invocaScriptServiceConstructor.$inject=["commonServices","apiService"],angular.module("marketingCore").service("invocaScriptService",invocaScriptServiceConstructor)}(window.angular,window._,window.Invoca),function(angular,externalLogger){"use strict";angular.module("tmobileApp").config(["$stateProvider",function($stateProvider){externalLogger.moduleConfigured("core/tmobileApp","legalText.dev.js"),$stateProvider.state("legalTextState",{url:"/legalText",templateUrl:"app/core/components/legalText/legalText.dev.html"})}])}(angular,externalLogger),function(angular){"use strict";function LegalTextFn(compUtils,$log){return{restrict:"E",replace:!0,templateUrl:"app/core/components/legalText/legalText.html",link:function(scope,elm,attrs){$log.log("scope.legalTextAV ",scope.legalTextAV,JSON.stringify(scope.legalTextAV)),compUtils.transformHtmlAttrs(scope,elm,attrs)}}}LegalTextFn.$inject=["compUtils","$log"],angular.module("tmobileCore").directive("legalText",LegalTextFn)}(window.angular),function(angular){"use strict";var moduleName="tmobileApp",componentName="microData",microDataComponentConstructor={template:'<script type="application/ld+json" id="microDataID"></script>',controller:"microDataController",controllerAs:"vm",bindings:{product:"=",producttype:"="}};angular.module(moduleName).component(componentName,microDataComponentConstructor)}(angular),function(angular){"use strict";function microDataControllerFunction($scope,$sce,$filter,commonServices,globalAssetRepositoryConstants){function getFrontImage(){var frontImage;return frontImage=angular.isDefined(vm.product.FrontImage)?vm.product.FrontImage.indexOf(globalAssetRepositoryConstants.url)>-1?vm.product.FrontImage:commonServices.$window.location.origin+vm.product.FrontImage:""}function invStatusMapping(InvStatus){switch(InvStatus){case"AVAILABLE":return"InStock";case"AVAILABLE_FOR_PRE_ORDER":return"PreOrder";case"AVAILABLE_FOR_BACK_ORDER":return"LimitedAvailability";case"NOT_AVAILABLE":return"OutOfStock";case"NOT_AVAILABLE_FOR_SALE_ONLINE":return"InStoreOnly";default:return"OutOfStock"}}var vm=this;$scope.$watch("vm.product",function(){vm.product.Family&&(vm.jsonLDData={"@context":"http://schema.org","@type":"Product",name:vm.product.Family,image:getFrontImage(),color:angular.isDefined(vm.product.Color)?vm.product.Color:"",description:angular.isDefined(vm.product.Description)?vm.product.Description:"",brand:{"@type":"Thing",name:vm.product.Manufacturer}},"accessory"!==vm.producttype.toLowerCase()&&""!==vm.product.AverageStarRating&&"0"!==vm.product.AverageStarRating&&(vm.jsonLDData=angular.extend(vm.jsonLDData,{aggregateRating:{"@type":"AggregateRating",ratingValue:""!==vm.product.AverageStarRating?vm.product.AverageStarRating:0,reviewCount:""!==vm.product.ReviewCount?vm.product.ReviewCount:0}})),"NOT_AVAILABLE_COMING_SOON"!==vm.product.InvStatus&&(vm.jsonLDData=angular.extend(vm.jsonLDData,{offers:{"@type":"Offer",price:(vm.product.FullPrice!==vm.product.PurchasePrice?vm.product.PurchasePrice:vm.product.FullPrice).replace("$",""),availability:angular.isDefined(vm.product.InvStatus)?invStatusMapping(vm.product.InvStatus):"",priceCurrency:"USD"}})),document.getElementById("microDataID").textContent=$sce.trustAsHtml($filter("json")(vm.jsonLDData)))})}microDataControllerFunction.$inject=["$scope","$sce","$filter","commonServices","globalAssetRepositoryConstants"];var controllerName="microDataController";angular.module("tmobileApp").controller(controllerName,microDataControllerFunction)}(angular),function(angular){"use strict";function modalHistoryServiceFunction(){function push(obj){modalHistory.push(obj)}function pop(){return currentItem=modalHistory.pop()}function hasHistory(){return modalHistory.length>0}function clearHistory(){modalHistory=[]}function setCurrentItem(newItem){currentItem&&modalHistory.push(currentItem),currentItem=newItem}function getCurrentItem(){return currentItem}function resetCurrent(){currentItem=!1}var modalHistory=[],currentItem=null;return{push:push,pop:pop,hasHistory:hasHistory,clearHistory:clearHistory,setCurrentItem:setCurrentItem,getCurrentItem:getCurrentItem,resetCurrent:resetCurrent}}angular.module("tmobileCore").service("modalHistoryService",modalHistoryServiceFunction)}(angular),function(angular){"use strict";function modalPopupControllerFunction(){}angular.module("tmobileCore").controller("ModalPopupController",modalPopupControllerFunction)}(angular),function(){"use strict";function modalPopupDirective($log,$http,$modalStack,$window,$interval,$modal,modalHistoryService,modalPopupService,$parse,pdlService){return{restrict:"A",scope:{modalSize:"@",modalClass:"@",modalHtml:"@",modalBack:"@",modalHideBtn:"@",dialogDescription:"@",dialogId:"@",closeallModal:"@",toggleModal:"@",modalType:"@"},link:function(scope,element,attrs){if(angular.isDefined(modalPopupService.getInterval())&&($interval.cancel(modalPopupService.getInterval()),modalPopupService.setInterval(void 0)),$log.log("userAgent",$window.navigator.userAgent),$window.navigator.userAgent.indexOf("Safari")>-1&&$window.navigator.userAgent.indexOf("Chrome")<0){var intervalRef=$interval(function(){var bodyClass=angular.element("body")[0].className;if($log.log("bodyClass",bodyClass),bodyClass.indexOf("modal-open")>-1)angular.element("body").addClass("bodyFixed");else if(bodyClass.indexOf("modal-open")<0&&bodyClass.indexOf("bodyFixed")>-1){angular.element("body").removeClass("bodyFixed"),$interval.cancel(modalPopupService.getInterval()),modalPopupService.setInterval(void 0);var scrollTop=angular.element(".utilPaddingBottomTop").offset().top;$window.scrollTo(0,scrollTop)}},500);modalPopupService.setInterval(intervalRef)}element.bind("click",function(){var modalClass=scope.modalClass||"modal-default",modalSize=scope.modalSize,htmlTemplateUrl=scope.modalHtml,rawTemplate="",_modalBack="",modalHide="",modalHideCheck=void 0===scope.modalHideBtn?"hidden-lg hidden-md":scope.modalHideBtn,closeallModal=scope.closeallModal,toggleModal=scope.toggleModal;scope.modalType;angular.isDefined(toggleModal)&&sessionStorage.setItem("prevModalName",toggleModal),0===modalPopupService.getModalInstanceURLs().length&&(modalPopupService.setModalInstanceIndex(0),modalHide=modalHideCheck);var urlIndex=modalPopupService.getModalInstanceIndex();urlIndex>0?urlIndex-=1:modalHide=modalHideCheck;var currentItem={url:htmlTemplateUrl,size:modalSize};if(angular.isDefined(attrs.modalBack))$log.log("modal back is defined "),modalPopupService.setModalInstanceIndex(modalPopupService.getModalInstanceIndex()),urlIndex=modalPopupService.getModalInstanceIndex();else{$log.log("modal back is undefined ");var item={url:htmlTemplateUrl,size:modalSize};modalPopupService.setModalInstanceURL(item),$log.log("urls",modalPopupService.getModalInstanceURLs()),modalPopupService.setModalInstanceIndex(modalPopupService.getModalInstanceIndex()),_modalBack="modal-back"}$log.log("index",modalPopupService.getModalInstanceIndex());var prevPopUpName=sessionStorage.getItem("prevModalName"),prevModal=document.getElementById(prevPopUpName);if(attrs.fromback){var modalData=modalHistoryService.pop();modalData||(modalHistoryService.resetCurrent(),modalPopupService.getModalInstance().close()),""!=htmlTemplateUrl?htmlTemplateUrl=modalData.url:angular.isDefined(prevPopUpName)&&(prevModal.style.display="block"),modalData["class"]&&(modalClass=modalData["class"]),modalData.size&&(modalSize=modalData.size)}else modalHistoryService.setCurrentItem(currentItem);modalHistoryService.hasHistory()||(modalHide=modalHideCheck);var actionToPerform="$close()";closeallModal&&(actionToPerform="dismiss()",angular.isDefined(prevPopUpName)&&(prevModal.style.display="none"));var htmlPart1='<div  class="modal-repository" ng-swipe-left="dismiss()" ng-swipe-right="dismiss()"><div class="tmobmodal modal-header">',htmlPart2='<button type="button" ng-click="'+actionToPerform+'" class="close" role="button"  aria-label="Close"></button>',htmlPart3='<p class="modal-back '+modalHide+'"> <a role="button" class="p-b-20 p-t-10" href="javascript:void(0)" fromback="true" modal-popup="" '+_modalBack+' modal-html=""'+modalPopupService.getModalInstanceURL(urlIndex).url+'" modal-size="'+modalPopupService.getModalInstanceURL(urlIndex).size+'"><span class="glyphicon glyphicon-chevron-left iconsize" aria-hidden="true"></span><span class="modal-back-position"> Back </span></a></p></div><h1 aria-hidden=\'true\' modal-accessibility=\'aria-labelledby\' id='+scope.dialogId+" class='sr-only'>"+scope.dialogDescription+"</h1><div class='modal-body' ng-swipe-left='dismiss()' ng-swipe-right='dismiss()'>";return $http.get(htmlTemplateUrl).then(function(response){if(200===response.status){var aemHTMLElement=angular.element(response.data),pdlModalData=_.get(aemHTMLElement[2],"attributes[2].nodeValue");if(pdlModalData){var pdlObject=$parse(pdlModalData)(scope);pdlObject.modalName&&(htmlPart2='<button type="button" ng-click="'+actionToPerform+'" class="close" role="button"  aria-label="Close" pdl-event="modal-close" pdl-modal-data='+JSON.stringify(pdlModalData)+"></button>")}rawTemplate=htmlPart1+htmlPart2+htmlPart3+response.data+"</div></div>"}else rawTemplate=htmlPart1+htmlPart2+htmlPart3+"<H1>ERROR: HTML NOT FOUND</H1></div></div>";angular.isDefined(modalPopupService.getModalInstance())&&($log.log("modalInstance",modalPopupService.getModalInstance()),modalPopupService.getModalInstance().close());var modalCloseData={modalID:angular.isDefined(pdlObject)?pdlObject.modalID:"",modalName:angular.isDefined(pdlObject)?pdlObject.modalName:""},modalInstanceRef=$modal.open({template:rawTemplate,windowClass:modalClass,size:modalSize,controller:["$scope","modalHistoryService",function($scope,modalHistoryService){$scope.dismiss=function(){modalHistoryService.resetCurrent(),modalHistoryService.clearHistory(),$modalStack.dismissAll()}}]});modalPopupService.setModalInstance(modalInstanceRef),modalInstanceRef.result.then(function(data){},function(error){pdlService.setModalBackDropCloseEvent(modalCloseData),modalHistoryService.resetCurrent(),modalHistoryService.clearHistory()})}),!1})}}}modalPopupDirective.$inject=["$log","$http","$modalStack","$window","$interval","$modal","modalHistoryService","modalPopupService","$parse","pdlService"],angular.module("tmobileCore").directive("modalPopup",modalPopupDirective)}(),function(angular){"use strict";function modalPopupService(){function setInterval(ref){interval=ref}function getInterval(){return interval}function setModalInstanceURL(url){modalInstanceURLs.push(url)}function getModalInstanceURL(index){return modalInstanceURLs[index]}function getModalInstanceURLs(){return modalInstanceURLs}function setModalInstanceIndex(index){modalInstanceIndex=index}function getModalInstanceIndex(){return modalInstanceIndex}function setModalInstance(instance){modalInstance=instance}function getModalInstance(){return modalInstance}var modalInstance,interval,modalInstanceIndex,modalInstanceURLs=[];return{setInterval:setInterval,getInterval:getInterval,setModalInstanceURL:setModalInstanceURL,getModalInstanceURL:getModalInstanceURL,getModalInstanceURLs:getModalInstanceURLs,setModalInstanceIndex:setModalInstanceIndex,getModalInstanceIndex:getModalInstanceIndex,setModalInstance:setModalInstance,getModalInstance:getModalInstance}}angular.module("tmobileCore").service("modalPopupService",modalPopupService)}(angular),function(){"use strict";function paginationComponentController($scope,browseService,toggleService){function getNumberOfPagesToDisplay(width){var count=5;return SCREEN_MOBILE_SMALL>width?count=2:SCREEN_MOBILE_LARGE>width&&(count=3),count}function init(){(_.isEmpty(vm.numberOfPagesToDisplay)||_.isUndefined(vm.numberOfPagesToDisplay))&&(vm.numberOfPagesToDisplay=getNumberOfPagesToDisplay(screen.width)),_.isUndefined(vm.currentPage)&&(vm.currentPage=0);var startingNumber=vm.currentPage<=vm.numberOfPagesToDisplay?0:vm.currentPage-vm.numberOfPagesToDisplay;setPageArray(),vm.getPageNumberArray(startingNumber)}function initPaginationContainer(numberOfPages){_.isUndefined(vm.currentPage)&&(vm.currentPage=0),vm.numberOfPages=numberOfPages;var startingNumber=vm.currentPage<=vm.numberOfPagesToDisplay?0:vm.currentPage-vm.numberOfPagesToDisplay;setPageArray(),vm.getPageNumberArray(startingNumber)}function setPageArray(){vm.pageNumbersArray=[];for(var num=1;num<vm.numberOfPages+1;num++)vm.pageNumbersArray.push(num)}function getPageNumberArray(startingNumber){vm.slicedPageNumbersArray=[],vm.slicedPageNumbersArray=vm.pageNumbersArray.slice(startingNumber,startingNumber+vm.numberOfPagesToDisplay)}function getStartingNumber(){var startingNumber=null;if(vm.currentPage>=vm.slicedPageNumbersArray[vm.numberOfPagesToDisplay-1]){var isLastRow=vm.currentPage-1>=vm.numberOfPages-vm.numberOfPagesToDisplay;startingNumber=isLastRow?vm.numberOfPages-vm.numberOfPagesToDisplay:vm.currentPage-1}else if(vm.currentPage<=vm.slicedPageNumbersArray[0]){var isFirstRow=vm.currentPage<=vm.numberOfPagesToDisplay;startingNumber=isFirstRow?0:vm.currentPage-vm.numberOfPagesToDisplay}return startingNumber}function updateSelection(number){vm.currentPage=number;var startingNumber=getStartingNumber();null!==startingNumber&&vm.getPageNumberArray(startingNumber),browseService.model.currentPage=vm.currentPage,browseService.model.locationQueryParams.page=browseService.model.currentPage,browseService.changePage()}function previousPage(){vm.currentPage-=1;var startingNumber=getStartingNumber();null!==startingNumber&&vm.getPageNumberArray(startingNumber),browseService.model.currentPage=vm.currentPage,browseService.model.locationQueryParams.page=browseService.model.currentPage,browseService.changePage()}function nextPage(){var currentPageNo=parseInt(vm.currentPage);currentPageNo+=1;var startingNumber=getStartingNumber();null!==startingNumber&&vm.getPageNumberArray(startingNumber),browseService.model.currentPage=currentPageNo,browseService.model.locationQueryParams.page=browseService.model.currentPage,browseService.changePage()}function isCBSuccess(){return _.get(toggleService.model,"toggles.isCBSuccess",!1)}var vm=this,SCREEN_MOBILE_SMALL=400,SCREEN_MOBILE_LARGE=700;$scope.$on("resetPaginationPage",function(arg,data){vm.currentPage=1,initPaginationContainer(data)}),$scope.$on("PRODUCT_COUNT_MINIMUM",function(arg,data){initPaginationContainer(data)}),vm.slicedPageNumbersArray=null,vm.pageNumbersArray=null,vm.getNumberOfPagesToDisplay=getNumberOfPagesToDisplay,vm.isCBSuccess=isCBSuccess,vm.init=init,vm.getPageNumberArray=getPageNumberArray,vm.updateSelection=updateSelection,vm.previousPage=previousPage,vm.nextPage=nextPage}paginationComponentController.$inject=["$scope","browseService","toggleService"],angular.module("tmobileApp").controller("paginationComponentController",paginationComponentController)}(),function(angular){"use strict";function contentCarousel($window,$compile,$log,utils,analyticsUtils,viewport,$timeout){return{restrict:"A",link:function(scope,element,attr){function onInit(e,slick){!viewport.breakpointUp("desktop")&&utils.isTouch()&&(element[0].className+=" touch-device");var slickCloned=element[0].querySelectorAll(".slick-cloned");angular.forEach(slickCloned,function(slickClone){$compile(angular.element(slickClone))(scope)}),element.one("click",scope.slickConfig.method.slickPause),slick.$slider[0].style.opacity="1",angular.element($window).triggerHandler("resize");var clickItems=element[0].querySelectorAll(".slick-dots button, .slick-arrow");clickItems.forEach(function(e){e.addEventListener("click",function(){$timeout(function(){analyticsUtils.trackCarousel(next>prevSlide,element)},500)})})}function onBeforeChange(e,slick,currentSlide,nextSlide){prevSlide=currentSlide,next=nextSlide}function disableAutoPlay(){scope.slickConfig.autoplay=!1}function cleanup(){scope.slickConfig&&scope.slickConfig.method.unslick()}function onSwipe(e,slick,direction){var trackingNav;trackingNav="left"===direction?!0:!1,analyticsUtils.trackCarousel(trackingNav,element)}var prevSlide,next,disablePlay=element[0].getAttribute("data-disableautorotate");"true"===disablePlay&&disableAutoPlay(),scope.slickConfig&&(scope.slickConfig.event.init=onInit,scope.slickConfig.event.beforeChange=onBeforeChange,scope.slickConfig.event.swipe=onSwipe),scope.$on("$destroy",cleanup)}}}contentCarousel.$inject=["$window","$compile","$log","utils","analyticsUtils","viewport","$timeout"],angular.module("marketingCore").directive("contentCarousel",contentCarousel)}(angular),function(angular,lodash){"use strict";function seoControllerConstructor($window,seoService,apiURLs){function ignoreClick($event){$event.stopPropagation()}function removeData(items){function successCallback(){$window.location.reload()}function errorCallback(){}var data={url:lodash.get(items,"url"),canonicalUrl:lodash.get(items,"seoData.canonicalUrl"),englishTitle:lodash.get(items,"seoData.title.en"),spanishTitle:lodash.get(items,"seoData.title.es"),englishDescription:lodash.get(items,"seoData.description.en"),spanishDescription:lodash.get(items,"seoData.description.es"),englishKeywords:lodash.get(items,"seoData.keywords.en"),spanishKeywords:lodash.get(items,"seoData.keywords.es"),browseType:lodash.get(items,"browseType"),action:"delete"},hostUrl=apiURLs.seoDataUpdate;seoService.postseoData(hostUrl,data).then(successCallback,errorCallback)}function getData(){seoService.getseoData().then(function(){vm.seoData=seoService.model.seoData})}var vm=this;vm.encodename={en:"English",es:"Spanish"},vm.oneAtATime=!1,vm.seoData=seoService.model.seoData,vm.getData=getData,vm.removeData=removeData,vm.ignoreClick=ignoreClick}seoControllerConstructor.$inject=["$window","seoService","apiURLs"],angular.module("tmobileApp").controller("seoController",seoControllerConstructor)}(window.angular,window._),function(angular){"use strict";function countdownTimer($interval,$http,$log,analyticsUtils){return{restrict:"A",link:function(scope,element,attr){function getTimeRemaining(currentTime){var t=Math.max(expirationTime-currentTime,0),days=Math.max(Math.floor(t/864e5),0),hours=Math.max(Math.floor(t/36e5%24),0),minutes=Math.max(Math.floor(t/1e3/60%60),0),seconds=Math.max(Math.floor(t/1e3%60),0),timeRemaining={total:t,days:days,hours:hours,minutes:minutes,seconds:seconds};return moduleElement.data("timeRemaining",timeRemaining),hasTracked||0===timeRemaining.total||(hasTracked=!0),timeRemaining}function removeTransitionEndClass(timeRemaining,el){"0"!==timeRemaining&&el.removeClass("transition-end")}function updateClock(){var currentTime=serverTime,timeRemaining=getTimeRemaining(currentTime),days=("0"+timeRemaining.days).slice(-2),hours=("0"+timeRemaining.hours).slice(-2),minutes=("0"+timeRemaining.minutes).slice(-2),seconds=("0"+timeRemaining.seconds).slice(-2);serverTime+=250,digits.removeClass("digit0 digit1 digit2 digit3 digit4 digit5 digit6 digit7 digit8 digit9"),day1.addClass("digit"+days.charAt(0)),day2.addClass("digit"+days.charAt(1)),hour1.addClass("digit"+hours.charAt(0)),hour2.addClass("digit"+hours.charAt(1)),minute1.addClass("digit"+minutes.charAt(0)),minute2.addClass("digit"+minutes.charAt(1)),second1.addClass("digit"+seconds.charAt(0)),second2.addClass("digit"+seconds.charAt(1)),removeTransitionEndClass(days.charAt(0),day1),removeTransitionEndClass(days.charAt(1),day2),removeTransitionEndClass(hours.charAt(0),hour1),removeTransitionEndClass(hours.charAt(1),hour2),removeTransitionEndClass(minutes.charAt(0),minute1),removeTransitionEndClass(minutes.charAt(1),minute2),removeTransitionEndClass(seconds.charAt(0),second1),removeTransitionEndClass(seconds.charAt(1),second2),angular.isNumber(urgentTime)&&currentTime>urgentTime&&(settings.urgentColor&&element.find(".countdown-timer-face .digit").css({color:settings.urgentColor}),element.addClass("countdown-timer-urgent"),element.find(".countdown-timer-headline").html(settings.urgentText)),element.toggleClass("show-days",timeRemaining.days>=1),timeRemaining.total<=0&&($interval.cancel(timeInterval),showExpiredState())}function showExpiredState(){var expiredOverlay,section=element.closest(".marketing-section");section.is(".offers-component")?(expiredOverlay=section.find(".countdown-timer-expired"),element.find(".countdown-timer-headline").html(settings.expirationText),element.detach().prependTo(expiredOverlay),section.find(".content-wrap .cta").remove(),expiredOverlay.addClass("active"),section.find(".content-wrap").attr("aria-hidden","true").attr("tabindex","-1"),section.find(".legal").attr("aria-hidden","true").attr("tabindex","-1")):section.is(".offers-carousel")?(expiredOverlay=section.find(".carousel-countdown-timer-expired"),element.find(".carousel-countdown-timer-headline").html(settings.expirationText),element.detach().prependTo(expiredOverlay),section.find(".content-wrap .cta").remove(),expiredOverlay.addClass("active"),section.find(".offers-slick-carousel").attr("aria-hidden","true").attr("tabindex","-1"),section.find(".offers-bottom").attr("aria-hidden","true").attr("tabindex","-1")):element.remove()}function cleanup(){$interval.cancel(timeInterval)}var hasTracked,serverTime,timeInterval,settings=angular.fromJson(attr.settings),startTime=Date.parse(settings.startTime),urgentTime=Date.parse(settings.urgentTime),expirationTime=Date.parse(settings.expirationTime),currentDate=Date.now(),moduleElement=element.closest("[data-module-id]"),digits=element.find(".digit").addClass("transition-end"),day1=element.find(".day1"),day2=element.find(".day2"),hour1=element.find(".hour1"),hour2=element.find(".hour2"),minute1=element.find(".minute1"),minute2=element.find(".minute2"),second1=element.find(".second1"),second2=element.find(".second2");return scope.$on("$destroy",cleanup),angular.isNumber(startTime)&&angular.isNumber(expirationTime)?(currentDate>=startTime&&$http({method:"GET",url:"/etc/clientlibs/t-mobile/publish/app/clientlibs_app/assets/images/marketing/menu-icn-white.svg",params:{time:(new Date).getTime()}}).then(function(response){(response.headers("date")||response.data.date)&&(serverTime=Date.parse(response.headers("date")||response.data.date),updateClock(),expirationTime>=startTime&&(timeInterval=$interval(updateClock,250),element.closest(".offers-carousel").length&&element.closest(".offers-carousel").addClass("contains-timer"),element.addClass("visible-timer")))},function(response){$log.error("There was an problem with the request.")}),digits.on("transitionend",function(e){angular.element(e.currentTarget).addClass("transition-end")}),1):!1}}}countdownTimer.$inject=["$interval","$http","$log","analyticsUtils"],angular.module("marketingCore").directive("countdownTimer",countdownTimer)}(angular),function(angular){angular.module("tmobileApp").constant("urlConstants",{URL:{POST_SHIPPING_OPTIONS:"postShippingOptionsUrl"}})}(window.angular),function(angular){"use strict";function coverageContent($window,$compile,$http,$log,utils,analyticsUtils){return{restrict:"A",link:function(scope,element,attr){function updateContent(geolocation){var matchedLocationIndex,latitude=geolocation.latitude,longitude=geolocation.longitude,locations=angular.fromJson(attr.locations);if(locations){for(var i=0;i<locations.length;i++)matchLocation(latitude,longitude,locations[i].latitude,locations[i].longitude)&&(matchedLocationIndex=i);angular.isDefined(matchedLocationIndex)&&(path=locations[matchedLocationIndex].path,$http({method:"GET",url:path}).then(onSuccess,onError))}}function matchLocation(userLat,userLong,locationLat,locationLong){if(!(userLat&&userLong&&locationLat&&locationLong))return!1;var lat1=parseFloat(userLat),lon1=parseFloat(userLong),lat2=parseFloat(locationLat),lon2=parseFloat(locationLong),distance=utils.getDistanceFromLatLonInKm(lat1,lon1,lat2,lon2);return 80>=distance?!0:void 0}function onSuccess(response){var htmlContent=$compile(response.data)(scope),module=angular.element(htmlContent);element.parent().html(htmlContent),scope.$broadcast("domContentReplaced"),analyticsUtils.trackAsyncModule("Coverage",path,module.attr("data-analytics-id"),module.attr("data-module-id"))}function onError(response){$log.error("There was a problem loading coverage content.")}function cleanup(){}scope.$on("$destroy",cleanup),utils.getGeolocation().then(updateContent,function(error){$log.error("error")});var path}}}coverageContent.$inject=["$window","$compile","$http","$log","utils","analyticsUtils"],angular.module("marketingCore").directive("coverageContent",coverageContent)}(angular),function(angular){"use strict";angular.module("tmobileCore").value("globalValue",{})}(angular),function(angular){"use strict";function CustomSelectDropdownFn($log){return{restrict:"E",require:"^ngModel",scope:{ngModel:"=",items:"=",onChangeCtrlFn:"&onChangeCallback",selectName:"=",selectId:"=",selection:"@"},templateUrl:"app/marketing/directives/customDropdownSelect/customDropdownSelectTemplate.html",link:function(scope,element){scope.$watch("items",function(){for(var idx in scope.items)scope.items[idx].id===scope.selection&&(scope.selectedOpt=scope.items[idx],scope.customOptionSelected=0!==parseInt(idx,10)?!0:!1)});var bodyEl=angular.element("body"),selectDropdown=element.find(".custom-select-dropdown"),selectLabel=element.find(".custom-label-text");scope.onClickSelectItem=function(index,selectItem){scope.ngModel=selectItem,bodyEl.removeClass("dropdown-is-open"),selectDropdown.removeClass("dropdown-active"),scope.customOptionSelected=0!==index?!0:!1,scope.selectedOpt=selectItem,scope.onChangeCtrlFn({plan:selectItem.id})},scope.resetDropdown=function(defaultItem){scope.ngModel=defaultItem,scope.customOptionSelected=!1,scope.selectedOpt=defaultItem,scope.onChangeCtrlFn({plan:defaultItem.id})},selectLabel.on("click",function(){bodyEl.addClass("dropdown-is-open"),selectDropdown.toggleClass("dropdown-active")}),element.bind("keyup",function(ev){27===ev.which&&(bodyEl.removeClass("dropdown-is-open"),selectDropdown.removeClass("dropdown-active"))}),angular.element(document).bind("click",function(event){var isClickedElementChildOfDropdown=element.find(event.target).length>0;isClickedElementChildOfDropdown||(bodyEl.removeClass("dropdown-is-open"),selectDropdown.removeClass("dropdown-active"))})}}}CustomSelectDropdownFn.$inject=["$log"],angular.module("marketingCore").directive("customSelectDropdown",CustomSelectDropdownFn)}(window.angular),function(angular,externalLogger){"use strict";angular.module("tmobileApp").constant("FRAUD_FAIL_STATE_NAME","fraudFail").config(["$stateProvider","LOWER_FUNNEL_ABSTRACT_ROOT_STATE_NAME","FRAUD_FAIL_STATE_NAME",function($stateProvider,LOWER_FUNNEL_ABSTRACT_ROOT_STATE_NAME,FRAUD_FAIL_STATE_NAME){externalLogger.moduleConfigured("tmobileApp","fraudFail :: config "+FRAUD_FAIL_STATE_NAME+" route");var fraudFailStateConfig={url:"/checkout/hard-stop",parent:LOWER_FUNNEL_ABSTRACT_ROOT_STATE_NAME,views:{content:{templateUrl:"app/checkOut/views/fraudFail/fraudFail.html",controller:"FraudFailCtrl",controllerAs:"vm"}}};$stateProvider.state(FRAUD_FAIL_STATE_NAME,fraudFailStateConfig)}])}(angular,externalLogger),function(angular){"use strict";function dealSignUp($window,analyticsUtils){return{restrict:"A",link:function(scope,element,attr){function getStatus(){var status=element.find("form").data("customer-status");switch(status){case"carrier":return scope.vm.formData.currentCustomer=element.find('select[name="currentCarrier"]').find("option:checked").data("customer"),scope.vm.formData.currentCustomer;case"currentCustomer":return scope.vm.formData.currentCustomer=1,scope.vm.formData.currentCustomer;case"newCustomer":return scope.vm.formData.currentCustomer=0,scope.vm.formData.currentCustomer;default:return scope.vm.formData.currentCustomer=0,scope.vm.formData.currentCustomer}}function cleanup(){}element.find("input, select").on("focus",function(e){angular.element(e.currentTarget).closest(".input-wrapper").addClass("active"),scope.vm.dealsSignUpForm.$pristine&&!isFormStarted&&(analyticsUtils.trackForm({eventType:"form start",analyticsID:scope.analyticsID,submitText:submitCTA}),isFormStarted=!0)}),element.find("input, select").on("blur",function(e){angular.element(e.currentTarget).closest(".input-wrapper").removeClass("active")}),scope.$on("update_carrier",getStatus),scope.$on("valid",function(e,isValid){var optInText=scope.vm.formData.optInText||"Opt in to T-Mobile emails",headerHeight=angular.element(".global-header.sticky").height(),filterHeight=angular.element(".offers-filter-component").height(),scrollTop=element.offset().top-headerHeight-filterHeight;analyticsUtils.trackFormSubmit({eventType:"clickToAction",analyticsID:scope.vm.analyticsID,submitText:submitCTA,targetUrl:submitCTAIcid,assetType:"button",attributes:{user:(scope.vm.formData.currentCustomer?"Customer":"Prospect")+(scope.vm.formData.optin?" | "+optInText:"")}}),isValid===!1?($window.scrollTo(0,scrollTop),element.find(".input-wrapper.error:first input").focus()):isValid===!0&&($window.scrollTo(0,scrollTop),initial.hide(),confirmation.show(),analyticsUtils.trackForm({eventType:"form complete",analyticsID:scope.vm.analyticsID,submitText:submitCTA}))}),scope.$on("modalOpen",function(){"dialog"===scope.htmlTag&&(element.find("input").each(function(i,el){el.id="modal-"+el.id}),element.find("label").each(function(i,el){el.setAttribute("for","modal-"+el.getAttribute("for"))}))});var isFormStarted=!1,dealsForm=element[0].querySelector("form"),submitCTAIcid=dealsForm.querySelector('[type="submit"]').getAttribute("data-icid"),submitCTA=dealsForm.querySelector('[type="submit"]').innerText,initial=element.find(".initial-state"),confirmation=element.find(".success-state");scope.$on("$destroy",cleanup)}}}dealSignUp.$inject=["$window","analyticsUtils"],angular.module("marketingCore").directive("dealSignUp",dealSignUp)}(window.angular),function(angular,lodash){"use strict";function submitOrderUtilConstructor(coreServices,$log,checkOutModelService,globalConfig,emailUtil,globalValue,commonUtils,checkOutConstants,checkOutControllerHelperUtil,mpLocalizationService,checkOutHttpDataUtil,confirmationPageUtil,httpRequestWrapper,toggleService,smsUtil,apiService,modalDialogFactory,pdlService,pdlConstant){function errorHandler(error){return $log.log("Something went wrong ",error),error.status="failed",error}function sendOrderSummaryMail(){var selligentCampaignData,user=checkOutModelService.model.checkOutInfo.personalInfo,cartObject=checkOutModelService.model.checkOutInfo.reviewCart;return user&&cartObject&&(user.middleName=lodash.get(user,"middleName"," "),user.middleName.indexOf(" ")<0&&(user.middleName=" "+user.middleName+" "),selligentCampaignData={firstName:user.firstName,fullName:user.firstName+user.middleName+user.lastName,email:user.email,selectedCreditClass:lodash.get(cartObject,"selectedCreditClass.class","creditClass1"),inWorkingHours:lodash.get(globalValue.authorValue.displayCallMeNow,"isOffHours")?"OFF":"ON"},selligentCampaignData.financingType=angular.equals(selligentCampaignData.selectedCreditClass,"creditClass3")?"FRP":"OTHER",angular.equals(selligentCampaignData.financingType,"OTHER")&&(selligentCampaignData.financingType=commonUtils.searchJson(cartObject,'lineItems[?(@.lineItemDetails.deviceDetails.pricingOption == "MONTHLY")]')?"EIP":"FRP",
angular.equals(selligentCampaignData.financingType,"FRP")&&(selligentCampaignData.financingType=lodash.get(cartObject,"accessories.isAccessoryEIPEligible")?"EIP":"FRP"))),emailUtil.sendOrderConfirmationEmail(selligentCampaignData)}function sendOrderConfirmationToChatFuel(){var apiUrl=coreServices.apiURLs.chatFuelPostOrderConfirmation;apiUrl=apiUrl.replace("{{fbId}}",cartStorage.getFbSessionId());var query=globalConfig.credentials.chatfuel_query_params;return query["message-text"]="Yay! Your order is successfully placed. We'll send you an email regarding the same shortly",coreServices.httpRequestWrapper.post(apiUrl,null,query,null,!0)}function getUserPreferredLang(){return mpLocalizationService.localizationFlag?!mpLocalizationService.getCookie("MP_LANG")||angular.equals(mpLocalizationService.getCookie("MP_LANG"),"en")?"English":"Spanish":""}function submitLegalAgreementTerms(){var defaultCartUrl,query,headers,status,tokenPostURL,body;return status=checkOutConstants.FAILEDSTATUS,defaultCartUrl=coreServices.apiURLs.defaultCartUrl,query={followlocation:"",zoom:coreServices.apiZoomLevel.legalAgreement,auth_token:cartStorage.getCartToken()},headers={"accept-language":"en-US,en;q=0.8"},httpRequestWrapper.get(defaultCartUrl,query,headers,!1).then(function(data){var link=coreServices.jsonPath(data,'$..[?(@.rel == "agreeaction")]');return link.length>0?(tokenPostURL=link[0].href,tokenPostURL+="?followlocation",body={notes:coreServices.cartStorage.getVersionId()},httpRequestWrapper.post(tokenPostURL,body,null,null,!0).then(function(response){return angular.isDefined(response.statusText)&&(angular.equals(checkOutConstants.CREATEDSTATUS,response.statusText)||angular.equals(checkOutConstants.OKSTATUS,response.statusText))?status=checkOutConstants.DONESTATUS:(status=checkOutConstants.FAILEDSTATUS,checkOutControllerHelperUtil.errorLogging(response,"LegalAgreement")),status})):status})["catch"](errorHandler)}function orderSubmitSuccess(){toggleService.model.toggles.zipWhip;cartStorage.getFbSessionId()&&sendOrderConfirmationToChatFuel().then(function(chatFuelResponse){$log.log("Here's the ChatFuel resposne",chatFuelResponse)})["catch"](errorHandler),lodash.get(checkOutModelService.model,"checkOutInfo.reviewCart.flags.isOMOrder",!1)||sendOrderSummaryMail().then(function(selligentResponse){$log.log("Here's the Selligent Response for Sending Confirmation Email to the user: ",selligentResponse)})["catch"](errorHandler),checkOutModelService.model.showExpertBar=!0,coreServices.session.removeAllSession(),coreServices.authTokenManager.clearSession(),cartStorage.clearAfterOrderCreatedAndAuthFail(),lodash.get(toggleService.model,"toggles.isDcpV3ApiEnabled",!1)||coreServices.creditClassService.setCreditClass(void 0),confirmationPageUtil.getConfirmationTemplate(),checkOutModelService.setSectionToBeDisplayed(checkOutConstants.SECTIONS.CONFIRMATION),lodash.get(toggleService.model,"toggles.lpCampaignIDToggle",!1)&&confirmationPageUtil.setOrderNumberForLiveperson(),lodash.get(toggleService.model,"toggles.enableBVPIE",!1)&&confirmationPageUtil.setOrderDetailsForBV(checkOutModelService.model.checkOutInfo)}function authFailModalHandler(){checkOutModelService.model.showExpertBar=!0,checkOutModelService.setSectionToBeDisplayed(checkOutConstants.SECTIONS.PAYMENTANDCREDIT)}function postFinalOrder(){var apiUrl,fingerPrint,requestBody;return apiUrl=coreServices.apiURLs.submitOrderUrl,fingerPrint=cartStorage.getFingerPrintId(),requestBody={fingerPrintId:fingerPrint,cvv:checkOutModelService.model.checkOutInfo.cardInfo.securityCode},httpRequestWrapper.post(apiUrl,requestBody,null,null,!0).then(function(response){angular.isDefined(response.statusText)&&(angular.equals(checkOutConstants.CREATEDSTATUS,response.statusText)||angular.equals(checkOutConstants.OKSTATUS,response.statusText))?response.data.isFraud?(checkOutControllerHelperUtil.checkoutFlowHardStop(),coreServices.logger.debug("Credit card details check : Fraud",null)):response.data.isAuth?(checkOutModelService.model.checkOutInfo.order.orderNumber=coreServices.jsonPath(response.data,"purchase-number")[0],checkOutHttpDataUtil.createAuditRecords(getUserPreferredLang(),null,cartStorage.getFbSessionId(),coreServices.cartStorage.getPsSessionId()).then(orderSubmitSuccess)):(checkOutModelService.model.checkOutInfo.cardInfo.securityCode="",checkOutControllerHelperUtil.authCheck().then(authFailModalHandler)):checkOutModelService.model.errors.displayErrorMessage=!0},function(error){coreServices.logger.debug("Response from Submit Order is probably undefined: ",error),checkOutModelService.model.errors.displayErrorMessage=!0})["catch"](errorHandler)}function getApiUrl(apiName){return apiService.getURL(apiName).url}function submitOrderV3(){var apiUrl,requestBody;return apiUrl=getApiUrl(checkOutConstants.SUBMIT_ORDER_URL),requestBody={cartId:cartStorage.getCartId()},httpRequestWrapper.post(apiUrl,requestBody,null,null,!0).then(function(response){angular.isDefined(response.status)&&angular.equals(response.status,checkOutConstants.HTTP_CODES.STATUS_SUCCESS_201)?(checkOutModelService.model.checkOutInfo.order.orderNumber=response.data.externalOrderNumber,orderSubmitSuccess()):(checkOutModelService.model.errors.displayErrorMessage=!0,pdlService.setCheckoutErrorEvent(setCheckoutErrorEvent(pdlConstant.REVIEW_SUBMIT_ERROR,response.status,pdlConstant.FORM_NAME.REVIEW_SUBMIT_FORM)),modalDialogFactory.openServiceFailModal())},function(error){coreServices.logger.debug("Response from Submit Order is probably undefined: ",error),checkOutModelService.model.errors.displayErrorMessage=!0,pdlService.setCheckoutErrorEvent(setCheckoutErrorEvent(pdlConstant.REVIEW_SUBMIT_ERROR,"",pdlConstant.FORM_NAME.REVIEW_SUBMIT_FORM)),modalDialogFactory.openServiceFailModal()})["catch"](errorHandler)}function submitOrder(){return submitLegalAgreementTerms().then(function(response){return coreServices.logger.debug("Here is the API response for submitting legal agreement terms - status : ",response),angular.equals(checkOutConstants.DONESTATUS,response)?postFinalOrder():checkOutConstants.FAILEDSTATUS})["catch"](errorHandler)}function setCheckoutErrorEvent(errorText,errorCode,formName){return{errorText:errorText||"",errorCode:errorCode||"",formName:formName||""}}var cartStorage=coreServices.cartStorage;return{submitOrder:submitOrder,submitOrderV3:submitOrderV3}}submitOrderUtilConstructor.$inject=["coreServices","$log","checkOutModelService","globalConfig","emailUtil","globalValue","commonUtils","checkOutConstants","checkOutControllerHelperUtil","mpLocalizationService","checkOutHttpDataUtil","confirmationPageUtil","httpRequestWrapper","toggleService","smsUtil","apiService","modalDialogFactory","pdlService","pdlConstant"],angular.module("tmobileApp").factory("submitOrderUtil",submitOrderUtilConstructor)}(window.angular,window._),function(angular){"use strict";function deviceChecker($window,viewport){return{restrict:"A",link:function(scope,element,attr){function getScrollTop(){return element.offset().top-angular.element(".global-header").height()}function cleanup(){}var initial=element.find(".initial-state"),confirmation=element.find(".success-state"),noMatch=element.find(".no-match-state");element.find("input, select").on("focus",function(e){angular.element(e.currentTarget).closest(".input-wrapper").addClass("active")}),element.find("input, select").on("blur",function(e){angular.element(e.currentTarget).closest(".input-wrapper").removeClass("active")}),element.find(".start-over").on("click",function(e){angular.element(e.currentTarget).closest(".state-change").hide(),initial.show(),scope.formData={},element.find("input, select").val(null),viewport.breakpointDown("tablet")&&$window.scrollTo(0,getScrollTop())}),scope.$on("valid",function(e,data){data.isValid?(initial.hide(),viewport.breakpointDown("tablet")&&$window.scrollTo(0,getScrollTop()),data.isCompatible?confirmation.show():noMatch.show()):(element.find(".input-wrapper.error:first input, .input-wrapper.error:first select").focus(),viewport.breakpointDown("tablet")&&$window.scrollTo(0,getScrollTop()))}),scope.$on("$destroy",cleanup)}}}deviceChecker.$inject=["$window","viewport"],angular.module("marketingCore").directive("deviceChecker",deviceChecker)}(angular),function(angular,lodash){"use strict";function personalInfoUtilConstructor(apiURLs,httpRequestWrapper,cartHttpDataService,apiService,cartStorage,$log,checkOutModelService,globalValue,checkOutHttpDataUtil,checkOutConstants){function setPersonalDataTocartStorage(personalInfoData){var profileData={firstName:personalInfoData.firstName,lastName:personalInfoData.lastName,emailId:personalInfoData.emailId};cartStorage.setProfileData(profileData)}function errorHandler(error){return $log.log("Something went wront: ",error),error}function getPersonalInfoData(){return{firstName:checkOutModelService.model.checkOutInfo.personalInfo.firstName,middleName:checkOutModelService.model.checkOutInfo.personalInfo.middleName,lastName:checkOutModelService.model.checkOutInfo.personalInfo.lastName,orderId:"",dateAndTime:checkOutModelService.model.checkOutInfo.personalInfo.dateAndTime,phoneNo:checkOutModelService.model.checkOutInfo.personalInfo.phoneNumber,emailId:checkOutModelService.model.checkOutInfo.personalInfo.email,creditLevel:checkOutModelService.model.checkOutInfo.personalInfo.creditClass||"GOOD"}}function setPersonalInfo(){var apiUrl,personalInfoData,dateAndTime=new Date,userConsentIndex=checkOutModelService.model.checkOutInfo.userConsentIndex,urlObject=apiService.getURL("updateProfile");apiUrl=urlObject.url;var header={};return checkOutModelService.model.checkOutInfo.personalInfo.versionId=globalValue.authorValue.checkout.personalInfoAndShipping.userConsent[userConsentIndex].uniqueId,checkOutModelService.model.checkOutInfo.personalInfo.dateAndTime=dateAndTime.toString(),checkOutModelService.model.checkOutInfo.personalInfo.personlaInfoDisclaimer=!0,personalInfoData=getPersonalInfoData(),2===urlObject.version?cartHttpDataService.getProfileId().then(function(profileId){return apiUrl=apiUrl.replace("{{profileID}}",profileId),header.follow="true",personalInfoData.contactConsentVersionId=checkOutModelService.model.checkOutInfo.personalInfo.versionId,httpRequestWrapper.put(apiUrl,personalInfoData,null,header,"updateProfile","updateProfile").then(function(response){return angular.equals(200,response.status)?(setPersonalDataTocartStorage(personalInfoData),getAutoPayStateInfo()):($log.log("personalInfoUtil.setPersonalInfo:: response ",response),response.status)})["catch"](errorHandler)}):(personalInfoData.aggreementVersionId=checkOutModelService.model.checkOutInfo.personalInfo.versionId,httpRequestWrapper.post(apiUrl,personalInfoData,null,null,!0).then(function(response){return angular.equals(200,response.status)?(setPersonalDataTocartStorage(personalInfoData),getAutoPayStateInfo()):($log.log("personalInfoUtil.setPersonalInfo:: response ",response),response.status)})["catch"](errorHandler))}function getAutoPayStateInfo(){return checkOutHttpDataUtil.getAutoPayState().then(function(responseData){if(angular.equals(responseData.status,200)&&responseData.data){var abandonCartAuditObject=lodash.find(responseData.data.auditRecords,function(record){return angular.equals(record.auditKey,"ABANDON_CART_URL")}),autoPayAuditObject=lodash.find(responseData.data.auditRecords,function(record){return angular.equals(record.auditKey,"AUTO_PAY")}),autoPayAuditValue=autoPayAuditObject?"true"==autoPayAuditObject.auditValue:checkOutModelService.model.checkOutInfo.flags.isAutoPay,storePaymentAuditObject=lodash.find(responseData.data.auditRecords,function(record){return angular.equals(record.auditKey,"STORE_PAYMENT")}),storePaymentAuditValue=storePaymentAuditObject?"true"==storePaymentAuditObject.auditValue:checkOutModelService.model.checkOutInfo.flags.isStorePayment;return angular.isUndefined(abandonCartAuditObject)?checkOutHttpDataUtil.createAuditRecords(autoPayAuditValue,storePaymentAuditValue,null,null,cartStorage.getAbandonCartURL()).then(function(auditRecordsResponse){return $log.log("checkOutHttpDataUtil.createAuditRecords:: auditRecordsResponse ",auditRecordsResponse),auditRecordsResponse.status}):($log.log("checkOutHttpDataUtil.getAutoPayState:: response ",responseData),responseData.status)}return $log.log("checkOutHttpDataUtil.getAutoPayState:: response ",responseData),responseData.status})}function postAuditRecords(){var cartId=cartStorage.getCartId(),apiUrl=apiService.getURL("createAuditRecordsUrl").url.replace("{{cartID}}",cartId),headers={follow:"true"},timestamp=(new Date).toString(),inputData={auditRecords:[{auditKey:checkOutConstants.AUDIT_RECORD_KEY.LEGAL_AGREEMENT_NOTES,auditValue:checkOutModelService.model.checkOutInfo.personalInfo.versionId},{auditKey:checkOutConstants.AUDIT_RECORD_KEY.LEGAL_AGREEMENT_TIMESTAMP,auditValue:timestamp}]};return httpRequestWrapper.post(apiUrl,inputData,null,headers,!0,"createAuditRecordsUrl").then(function(auditRecordsResponse){return $log.log("personalInfoUtil.postAuditRecords:: auditRecordsResponse ",auditRecordsResponse),auditRecordsResponse})}function getPersonalInfoDataV3(){var profileData={};return profileData.firstName=lodash.get(checkOutModelService.model.checkOutInfo.personalInfo,"firstName"),profileData.middleName=lodash.get(checkOutModelService.model.checkOutInfo.personalInfo,"middleName"),profileData.lastName=lodash.get(checkOutModelService.model.checkOutInfo.personalInfo,"lastName"),profileData.phoneNumber=lodash.get(checkOutModelService.model.checkOutInfo.personalInfo,"phoneNumber"),profileData.emailId=lodash.get(checkOutModelService.model.checkOutInfo.personalInfo,"email"),profileData.contactConsentVersionId=lodash.get(checkOutModelService.model.checkOutInfo.personalInfo,"versionId"),profileData}function getPersonalInfoAndIdentifierV3(){return{profileIdentifierDetails:{pin:lodash.get(checkOutModelService.model.checkOutInfo.creditcheck,"portOutPinCode")}}}function setPersonalInfoV3(){var personalInfoData,userConsentIndex=checkOutModelService.model.checkOutInfo.userConsentIndex;return checkOutModelService.model.checkOutInfo.personalInfo.versionId=globalValue.authorValue.checkout.personalInfoAndShipping.userConsent[userConsentIndex].uniqueId,checkOutModelService.model.checkOutInfo.personalInfo.personlaInfoDisclaimer=!0,personalInfoData=getPersonalInfoDataV3(),cartHttpDataService.updateProfileInfoV3(personalInfoData).then(function(response){return angular.equals(204,response.status)?(checkOutHttpDataUtil.setPersonalInfoIntoCache(personalInfoData),postAuditRecords()):($log.log("personalInfoUtil.setPersonalInfoV3:: response ",response),response)})["catch"](errorHandler)}return{setPersonalInfo:setPersonalInfo,setPersonalInfoV3:setPersonalInfoV3,getPersonalInfoDataV3:getPersonalInfoDataV3,getPersonalInfoAndIdentifierV3:getPersonalInfoAndIdentifierV3,postAuditRecords:postAuditRecords}}personalInfoUtilConstructor.$inject=["apiURLs","httpRequestWrapper","cartHttpDataService","apiService","cartStorage","$log","checkOutModelService","globalValue","checkOutHttpDataUtil","checkOutConstants"],angular.module("tmobileApp").factory("personalInfoUtil",personalInfoUtilConstructor)}(window.angular,window._),function(angular){"use strict";function emailCapture(analyticsUtils){return{restrict:"A",link:function(scope,element,attr){function cleanup(){}element.find("input").on("focus",function(e){angular.element(e.currentTarget).closest(".input-wrapper").addClass("active"),scope.vm.emailCaptureForm.$pristine&&!isFormStarted&&(analyticsUtils.trackForm({eventType:"form start",analyticsID:scope.vm.analyticsID,submitText:submitCTA}),isFormStarted=!0)}),element.find("input").on("blur",function(e){angular.element(e.currentTarget).closest(".input-wrapper").removeClass("active")}),element.find(".mat-form-field-flex").on("click",function(e){angular.element(e.currentTarget).find("input").focus()}),scope.$on("valid",function(e,isValid){var attributes={};attributes.user=(scope.formData.currentCustomer?"Customer":"Prospect")+" | "+scope.vm.optinAgrmt,analyticsUtils.trackGenericClick(element.find('button[type="submit"]')[0],attributes),isValid===!1?element.find(".input-wrapper.error:first input").focus():isValid===!0&&(analyticsUtils.trackForm({eventType:"form complete",analyticsID:scope.vm.analyticsID,submitText:submitCTA}),scope.formData={currentCustomer:0})}),scope.$on("modalOpen",function(){"dialog"===scope.vm.htmlTag&&(element.find("input").each(function(i,el){el.id="modal-"+el.id}),element.find("label").each(function(i,el){el.setAttribute("for","modal-"+el.getAttribute("for"))}))});var isFormStarted=!1,emailCaptureForm=element[0].querySelector("form"),submitCTA=emailCaptureForm.querySelector('[type="submit"]').innerText;scope.$on("$destroy",cleanup)}}}emailCapture.$inject=["analyticsUtils"],angular.module("marketingCore").directive("emailCapture",emailCapture)}(angular),!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(t.JSEncrypt={})}(this,function(t){"use strict";function i(t){return e.charAt(t)}function r(t,e){return t&e}function n(t,e){return t|e}function s(t,e){return t^e}function o(t,e){return t&~e}function h(t){if(0==t)return-1;var e=0;return 0==(65535&t)&&(t>>=16,e+=16),0==(255&t)&&(t>>=8,e+=8),0==(15&t)&&(t>>=4,e+=4),0==(3&t)&&(t>>=2,e+=2),0==(1&t)&&++e,e}function a(t){for(var e=0;0!=t;)t&=t-1,++e;return e}function f(t){var e,i,r="";for(e=0;e+3<=t.length;e+=3)i=parseInt(t.substring(e,e+3),16),r+=u.charAt(i>>6)+u.charAt(63&i);for(e+1==t.length?(i=parseInt(t.substring(e,e+1),16),r+=u.charAt(i<<2)):e+2==t.length&&(i=parseInt(t.substring(e,e+2),16),r+=u.charAt(i>>2)+u.charAt((3&i)<<4));(3&r.length)>0;)r+=c;return r}function l(t){var e,r="",n=0,s=0;for(e=0;e<t.length&&t.charAt(e)!=c;++e){var o=u.indexOf(t.charAt(e));0>o||(0==n?(r+=i(o>>2),s=3&o,n=1):1==n?(r+=i(s<<2|o>>4),s=15&o,n=2):2==n?(r+=i(s),r+=i(o>>2),s=3&o,n=3):(r+=i(s<<2|o>>4),r+=i(15&o),n=0))}return 1==n&&(r+=i(s<<2)),r}function E(t,e){return t.length>e&&(t=t.substring(0,e)+b),t}function M(){return new V(null)}function q(t,e){return new V(t,e)}function C(t,e){var i=H[t.charCodeAt(e)];return null==i?-1:i}function F(t){var e=M();return e.fromInt(t),e}function U(t){var e,i=1;return 0!=(e=t>>>16)&&(t=e,i+=16),0!=(e=t>>8)&&(t=e,i+=8),0!=(e=t>>4)&&(t=e,i+=4),0!=(e=t>>2)&&(t=e,i+=2),0!=(e=t>>1)&&(t=e,i+=1),i}function J(){if(null==_){for(_=new K;z>k;){var t=Math.floor(65536*Math.random());Z[k++]=255&t}for(_.init(Z),k=0;k<Z.length;++k)Z[k]=0;k=0}return _.next()}var p,d,w,e="0123456789abcdefghijklmnopqrstuvwxyz",u="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",c="=",g=function(t,e){return(g=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},v=function(t){var e;if(void 0===p){var i="0123456789ABCDEF",r=" \f\n\r	 \u2028\u2029";for(p={},e=0;16>e;++e)p[i.charAt(e)]=e;for(i=i.toLowerCase(),e=10;16>e;++e)p[i.charAt(e)]=e;for(e=0;e<r.length;++e)p[r.charAt(e)]=-1}var n=[],s=0,o=0;for(e=0;e<t.length;++e){var h=t.charAt(e);if("="==h)break;if(-1!=(h=p[h])){if(void 0===h)throw new Error("Illegal character at offset "+e);s|=h,++o>=2?(n[n.length]=s,s=0,o=0):s<<=4}}if(o)throw new Error("Hex encoding incomplete: 4 bits missing");return n},m={decode:function(t){var e;if(void 0===d){var i="= \f\n\r	 \u2028\u2029";for(d=Object.create(null),e=0;64>e;++e)d["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(e)]=e;for(e=0;e<i.length;++e)d[i.charAt(e)]=-1}var r=[],n=0,s=0;for(e=0;e<t.length;++e){var o=t.charAt(e);if("="==o)break;if(-1!=(o=d[o])){if(void 0===o)throw new Error("Illegal character at offset "+e);n|=o,++s>=4?(r[r.length]=n>>16,r[r.length]=n>>8&255,r[r.length]=255&n,n=0,s=0):n<<=6}}switch(s){case 1:throw new Error("Base64 encoding incomplete: at least 2 bits missing");case 2:r[r.length]=n>>10;break;case 3:r[r.length]=n>>16,r[r.length]=n>>8&255}return r},re:/-----BEGIN [^-]+-----([A-Za-z0-9+\/=\s]+)-----END [^-]+-----|begin-base64[^\n]+\n([A-Za-z0-9+\/=\s]+)====/,unarmor:function(t){var e=m.re.exec(t);if(e)if(e[1])t=e[1];else{if(!e[2])throw new Error("RegExp out of sync");t=e[2]}return m.decode(t)}},y=function(){function t(t){this.buf=[+t||0]}return t.prototype.mulAdd=function(t,e){var i,r,n=this.buf,s=n.length;for(i=0;s>i;++i)(r=n[i]*t+e)<1e13?e=0:r-=1e13*(e=0|r/1e13),n[i]=r;e>0&&(n[i]=e)},t.prototype.sub=function(t){var e,i,r=this.buf,n=r.length;for(e=0;n>e;++e)(i=r[e]-t)<0?(i+=1e13,t=1):t=0,r[e]=i;for(;0===r[r.length-1];)r.pop()},t.prototype.toString=function(t){if(10!=(t||10))throw new Error("only base 10 is supported");for(var e=this.buf,i=e[e.length-1].toString(),r=e.length-2;r>=0;--r)i+=(1e13+e[r]).toString().substring(1);return i},t.prototype.valueOf=function(){for(var t=this.buf,e=0,i=t.length-1;i>=0;--i)e=1e13*e+t[i];return e},t.prototype.simplify=function(){var t=this.buf;return 1==t.length?t[0]:this},t}(),b="…",T=/^(\d\d)(0[1-9]|1[0-2])(0[1-9]|[12]\d|3[01])([01]\d|2[0-3])(?:([0-5]\d)(?:([0-5]\d)(?:[.,](\d{1,3}))?)?)?(Z|[-+](?:[0]\d|1[0-2])([0-5]\d)?)?$/,S=/^(\d\d\d\d)(0[1-9]|1[0-2])(0[1-9]|[12]\d|3[01])([01]\d|2[0-3])(?:([0-5]\d)(?:([0-5]\d)(?:[.,](\d{1,3}))?)?)?(Z|[-+](?:[0]\d|1[0-2])([0-5]\d)?)?$/,D=function(){function t(e,i){this.hexDigits="0123456789ABCDEF",e instanceof t?(this.enc=e.enc,this.pos=e.pos):(this.enc=e,this.pos=i)}return t.prototype.get=function(t){if(void 0===t&&(t=this.pos++),t>=this.enc.length)throw new Error("Requesting byte offset "+t+" on a stream of length "+this.enc.length);return"string"==typeof this.enc?this.enc.charCodeAt(t):this.enc[t]},t.prototype.hexByte=function(t){return this.hexDigits.charAt(t>>4&15)+this.hexDigits.charAt(15&t)},t.prototype.hexDump=function(t,e,i){for(var r="",n=t;e>n;++n)if(r+=this.hexByte(this.get(n)),!0!==i)switch(15&n){case 7:r+="  ";break;case 15:r+="\n";break;default:r+=" "}return r},t.prototype.isASCII=function(t,e){for(var i=t;e>i;++i){var r=this.get(i);if(32>r||r>176)return!1}return!0},t.prototype.parseStringISO=function(t,e){for(var i="",r=t;e>r;++r)i+=String.fromCharCode(this.get(r));return i},t.prototype.parseStringUTF=function(t,e){for(var i="",r=t;e>r;){var n=this.get(r++);i+=128>n?String.fromCharCode(n):n>191&&224>n?String.fromCharCode((31&n)<<6|63&this.get(r++)):String.fromCharCode((15&n)<<12|(63&this.get(r++))<<6|63&this.get(r++))}return i},t.prototype.parseStringBMP=function(t,e){for(var i,r,n="",s=t;e>s;)i=this.get(s++),r=this.get(s++),n+=String.fromCharCode(i<<8|r);return n},t.prototype.parseTime=function(t,e,i){var r=this.parseStringISO(t,e),n=(i?T:S).exec(r);return n?(i&&(n[1]=+n[1],n[1]+=+n[1]<70?2e3:1900),r=n[1]+"-"+n[2]+"-"+n[3]+" "+n[4],n[5]&&(r+=":"+n[5],n[6]&&(r+=":"+n[6],n[7]&&(r+="."+n[7]))),n[8]&&(r+=" UTC","Z"!=n[8]&&(r+=n[8],n[9]&&(r+=":"+n[9]))),r):"Unrecognized time: "+r},t.prototype.parseInteger=function(t,e){for(var i,r=this.get(t),n=r>127,s=n?255:0,o="";r==s&&++t<e;)r=this.get(t);if(0===(i=e-t))return n?-1:0;if(i>4){for(o=r,i<<=3;0==(128&(+o^s));)o=+o<<1,--i;o="("+i+" bit)\n"}n&&(r-=256);for(var h=new y(r),a=t+1;e>a;++a)h.mulAdd(256,this.get(a));return o+h.toString()},t.prototype.parseBitString=function(t,e,i){for(var r=this.get(t),n="("+((e-t-1<<3)-r)+" bit)\n",s="",o=t+1;e>o;++o){for(var h=this.get(o),a=o==e-1?r:0,u=7;u>=a;--u)s+=h>>u&1?"1":"0";if(s.length>i)return n+E(s,i)}return n+s},t.prototype.parseOctetString=function(t,e,i){if(this.isASCII(t,e))return E(this.parseStringISO(t,e),i);var r=e-t,n="("+r+" byte)\n";r>(i/=2)&&(e=t+i);for(var s=t;e>s;++s)n+=this.hexByte(this.get(s));return r>i&&(n+=b),n},t.prototype.parseOID=function(t,e,i){for(var r="",n=new y,s=0,o=t;e>o;++o){var h=this.get(o);if(n.mulAdd(128,127&h),s+=7,!(128&h)){if(""===r)if((n=n.simplify())instanceof y)n.sub(80),r="2."+n.toString();else{var a=80>n?40>n?0:1:2;r=a+"."+(n-40*a)}else r+="."+n.toString();if(r.length>i)return E(r,i);n=new y,s=0}}return s>0&&(r+=".incomplete"),r},t}(),x=function(){function t(t,e,i,r,n){if(!(r instanceof B))throw new Error("Invalid tag value.");this.stream=t,this.header=e,this.length=i,this.tag=r,this.sub=n}return t.prototype.typeName=function(){switch(this.tag.tagClass){case 0:switch(this.tag.tagNumber){case 0:return"EOC";case 1:return"BOOLEAN";case 2:return"INTEGER";case 3:return"BIT_STRING";case 4:return"OCTET_STRING";case 5:return"NULL";case 6:return"OBJECT_IDENTIFIER";case 7:return"ObjectDescriptor";case 8:return"EXTERNAL";case 9:return"REAL";case 10:return"ENUMERATED";case 11:return"EMBEDDED_PDV";case 12:return"UTF8String";case 16:return"SEQUENCE";case 17:return"SET";case 18:return"NumericString";case 19:return"PrintableString";case 20:return"TeletexString";case 21:return"VideotexString";case 22:return"IA5String";case 23:return"UTCTime";case 24:return"GeneralizedTime";case 25:return"GraphicString";case 26:return"VisibleString";case 27:return"GeneralString";case 28:return"UniversalString";case 30:return"BMPString"}return"Universal_"+this.tag.tagNumber.toString();case 1:return"Application_"+this.tag.tagNumber.toString();case 2:return"["+this.tag.tagNumber.toString()+"]";case 3:return"Private_"+this.tag.tagNumber.toString()}},t.prototype.content=function(t){if(void 0===this.tag)return null;void 0===t&&(t=1/0);var e=this.posContent(),i=Math.abs(this.length);if(!this.tag.isUniversal())return null!==this.sub?"("+this.sub.length+" elem)":this.stream.parseOctetString(e,e+i,t);switch(this.tag.tagNumber){case 1:return 0===this.stream.get(e)?"false":"true";case 2:return this.stream.parseInteger(e,e+i);case 3:return this.sub?"("+this.sub.length+" elem)":this.stream.parseBitString(e,e+i,t);case 4:return this.sub?"("+this.sub.length+" elem)":this.stream.parseOctetString(e,e+i,t);case 6:return this.stream.parseOID(e,e+i,t);case 16:case 17:return null!==this.sub?"("+this.sub.length+" elem)":"(no elem)";case 12:return E(this.stream.parseStringUTF(e,e+i),t);case 18:case 19:case 20:case 21:case 22:case 26:return E(this.stream.parseStringISO(e,e+i),t);case 30:return E(this.stream.parseStringBMP(e,e+i),t);case 23:case 24:return this.stream.parseTime(e,e+i,23==this.tag.tagNumber)}return null},t.prototype.toString=function(){return this.typeName()+"@"+this.stream.pos+"[header:"+this.header+",length:"+this.length+",sub:"+(null===this.sub?"null":this.sub.length)+"]"},t.prototype.toPrettyString=function(t){void 0===t&&(t="");var e=t+this.typeName()+" @"+this.stream.pos;if(this.length>=0&&(e+="+"),e+=this.length,this.tag.tagConstructed?e+=" (constructed)":!this.tag.isUniversal()||3!=this.tag.tagNumber&&4!=this.tag.tagNumber||null===this.sub||(e+=" (encapsulates)"),e+="\n",null!==this.sub){t+="  ";for(var i=0,r=this.sub.length;r>i;++i)e+=this.sub[i].toPrettyString(t)}return e},t.prototype.posStart=function(){return this.stream.pos},t.prototype.posContent=function(){return this.stream.pos+this.header},t.prototype.posEnd=function(){return this.stream.pos+this.header+Math.abs(this.length)},t.prototype.toHexString=function(){return this.stream.hexDump(this.posStart(),this.posEnd(),!0)},t.decodeLength=function(t){var e=t.get(),i=127&e;if(i==e)return i;if(i>6)throw new Error("Length over 48 bits not supported at position "+(t.pos-1));if(0===i)return null;e=0;for(var r=0;i>r;++r)e=256*e+t.get();return e},t.prototype.getHexStringValue=function(){var t=this.toHexString(),e=2*this.header,i=2*this.length;return t.substr(e,i)},t.decode=function(e){var i;i=e instanceof D?e:new D(e,0);var r=new D(i),n=new B(i),s=t.decodeLength(i),o=i.pos,h=o-r.pos,a=null,u=function(){var e=[];if(null!==s){for(var r=o+s;i.pos<r;)e[e.length]=t.decode(i);if(i.pos!=r)throw new Error("Content size is not correct for container starting at offset "+o)}else try{for(;;){var n=t.decode(i);if(n.tag.isEOC())break;e[e.length]=n}s=o-i.pos}catch(t){throw new Error("Exception while decoding undefined length content: "+t)}return e};if(n.tagConstructed)a=u();else if(n.isUniversal()&&(3==n.tagNumber||4==n.tagNumber))try{if(3==n.tagNumber&&0!=i.get())throw new Error("BIT STRINGs with unused bits cannot encapsulate.");a=u();for(var c=0;c<a.length;++c)if(a[c].tag.isEOC())throw new Error("EOC is not supposed to be actual content.")}catch(t){a=null}if(null===a){if(null===s)throw new Error("We can't skip over an invalid tag with undefined length at offset "+o);i.pos=o+Math.abs(s)}return new t(r,h,s,n,a)},t}(),B=function(){function t(t){var e=t.get();if(this.tagClass=e>>6,this.tagConstructed=0!=(32&e),this.tagNumber=31&e,31==this.tagNumber){var i=new y;do e=t.get(),i.mulAdd(128,127&e);while(128&e);this.tagNumber=i.simplify()}}return t.prototype.isUniversal=function(){return 0===this.tagClass},t.prototype.isEOC=function(){return 0===this.tagClass&&0===this.tagNumber},t}(),R=[2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97,101,103,107,109,113,127,131,137,139,149,151,157,163,167,173,179,181,191,193,197,199,211,223,227,229,233,239,241,251,257,263,269,271,277,281,283,293,307,311,313,317,331,337,347,349,353,359,367,373,379,383,389,397,401,409,419,421,431,433,439,443,449,457,461,463,467,479,487,491,499,503,509,521,523,541,547,557,563,569,571,577,587,593,599,601,607,613,617,619,631,641,643,647,653,659,661,673,677,683,691,701,709,719,727,733,739,743,751,757,761,769,773,787,797,809,811,821,823,827,829,839,853,857,859,863,877,881,883,887,907,911,919,929,937,941,947,953,967,971,977,983,991,997],O=(1<<26)/R[R.length-1],V=function(){function t(t,e,i){null!=t&&("number"==typeof t?this.fromNumber(t,e,i):null==e&&"string"!=typeof t?this.fromString(t,256):this.fromString(t,e))}return t.prototype.toString=function(t){if(this.s<0)return"-"+this.negate().toString(t);var e;if(16==t)e=4;else if(8==t)e=3;else if(2==t)e=1;else if(32==t)e=5;else{if(4!=t)return this.toRadix(t);e=2}var r,n=(1<<e)-1,s=!1,o="",h=this.t,a=this.DB-h*this.DB%e;if(h-->0)for(a<this.DB&&(r=this[h]>>a)>0&&(s=!0,o=i(r));h>=0;)e>a?(r=(this[h]&(1<<a)-1)<<e-a,r|=this[--h]>>(a+=this.DB-e)):(r=this[h]>>(a-=e)&n,0>=a&&(a+=this.DB,--h)),r>0&&(s=!0),s&&(o+=i(r));return s?o:"0"},t.prototype.negate=function(){var e=M();return t.ZERO.subTo(this,e),e},t.prototype.abs=function(){return this.s<0?this.negate():this},t.prototype.compareTo=function(t){var e=this.s-t.s;if(0!=e)return e;var i=this.t;if(0!=(e=i-t.t))return this.s<0?-e:e;for(;--i>=0;)if(0!=(e=this[i]-t[i]))return e;return 0},t.prototype.bitLength=function(){return this.t<=0?0:this.DB*(this.t-1)+U(this[this.t-1]^this.s&this.DM)},t.prototype.mod=function(e){var i=M();return this.abs().divRemTo(e,null,i),this.s<0&&i.compareTo(t.ZERO)>0&&e.subTo(i,i),i},t.prototype.modPowInt=function(t,e){var i;return i=256>t||e.isEven()?new I(e):new N(e),this.exp(t,i)},t.prototype.clone=function(){var t=M();return this.copyTo(t),t},t.prototype.intValue=function(){if(this.s<0){if(1==this.t)return this[0]-this.DV;if(0==this.t)return-1}else{if(1==this.t)return this[0];if(0==this.t)return 0}return(this[1]&(1<<32-this.DB)-1)<<this.DB|this[0]},t.prototype.byteValue=function(){return 0==this.t?this.s:this[0]<<24>>24},t.prototype.shortValue=function(){return 0==this.t?this.s:this[0]<<16>>16},t.prototype.signum=function(){return this.s<0?-1:this.t<=0||1==this.t&&this[0]<=0?0:1},t.prototype.toByteArray=function(){var t=this.t,e=[];e[0]=this.s;var i,r=this.DB-t*this.DB%8,n=0;if(t-->0)for(r<this.DB&&(i=this[t]>>r)!=(this.s&this.DM)>>r&&(e[n++]=i|this.s<<this.DB-r);t>=0;)8>r?(i=(this[t]&(1<<r)-1)<<8-r,i|=this[--t]>>(r+=this.DB-8)):(i=this[t]>>(r-=8)&255,0>=r&&(r+=this.DB,--t)),0!=(128&i)&&(i|=-256),0==n&&(128&this.s)!=(128&i)&&++n,(n>0||i!=this.s)&&(e[n++]=i);return e},t.prototype.equals=function(t){return 0==this.compareTo(t)},t.prototype.min=function(t){return this.compareTo(t)<0?this:t},t.prototype.max=function(t){return this.compareTo(t)>0?this:t},t.prototype.and=function(t){var e=M();return this.bitwiseTo(t,r,e),e},t.prototype.or=function(t){var e=M();return this.bitwiseTo(t,n,e),e},t.prototype.xor=function(t){var e=M();return this.bitwiseTo(t,s,e),e},t.prototype.andNot=function(t){var e=M();return this.bitwiseTo(t,o,e),e},t.prototype.not=function(){for(var t=M(),e=0;e<this.t;++e)t[e]=this.DM&~this[e];
return t.t=this.t,t.s=~this.s,t},t.prototype.shiftLeft=function(t){var e=M();return 0>t?this.rShiftTo(-t,e):this.lShiftTo(t,e),e},t.prototype.shiftRight=function(t){var e=M();return 0>t?this.lShiftTo(-t,e):this.rShiftTo(t,e),e},t.prototype.getLowestSetBit=function(){for(var t=0;t<this.t;++t)if(0!=this[t])return t*this.DB+h(this[t]);return this.s<0?this.t*this.DB:-1},t.prototype.bitCount=function(){for(var t=0,e=this.s&this.DM,i=0;i<this.t;++i)t+=a(this[i]^e);return t},t.prototype.testBit=function(t){var e=Math.floor(t/this.DB);return e>=this.t?0!=this.s:0!=(this[e]&1<<t%this.DB)},t.prototype.setBit=function(t){return this.changeBit(t,n)},t.prototype.clearBit=function(t){return this.changeBit(t,o)},t.prototype.flipBit=function(t){return this.changeBit(t,s)},t.prototype.add=function(t){var e=M();return this.addTo(t,e),e},t.prototype.subtract=function(t){var e=M();return this.subTo(t,e),e},t.prototype.multiply=function(t){var e=M();return this.multiplyTo(t,e),e},t.prototype.divide=function(t){var e=M();return this.divRemTo(t,e,null),e},t.prototype.remainder=function(t){var e=M();return this.divRemTo(t,null,e),e},t.prototype.divideAndRemainder=function(t){var e=M(),i=M();return this.divRemTo(t,e,i),[e,i]},t.prototype.modPow=function(t,e){var i,r,n=t.bitLength(),s=F(1);if(0>=n)return s;i=18>n?1:48>n?3:144>n?4:768>n?5:6,r=8>n?new I(e):e.isEven()?new P(e):new N(e);var o=[],h=3,a=i-1,u=(1<<i)-1;if(o[1]=r.convert(this),i>1){var c=M();for(r.sqrTo(o[1],c);u>=h;)o[h]=M(),r.mulTo(c,o[h-2],o[h]),h+=2}var f,l,p=t.t-1,g=!0,d=M();for(n=U(t[p])-1;p>=0;){for(n>=a?f=t[p]>>n-a&u:(f=(t[p]&(1<<n+1)-1)<<a-n,p>0&&(f|=t[p-1]>>this.DB+n-a)),h=i;0==(1&f);)f>>=1,--h;if((n-=h)<0&&(n+=this.DB,--p),g)o[f].copyTo(s),g=!1;else{for(;h>1;)r.sqrTo(s,d),r.sqrTo(d,s),h-=2;h>0?r.sqrTo(s,d):(l=s,s=d,d=l),r.mulTo(d,o[f],s)}for(;p>=0&&0==(t[p]&1<<n);)r.sqrTo(s,d),l=s,s=d,d=l,--n<0&&(n=this.DB-1,--p)}return r.revert(s)},t.prototype.modInverse=function(e){var i=e.isEven();if(this.isEven()&&i||0==e.signum())return t.ZERO;for(var r=e.clone(),n=this.clone(),s=F(1),o=F(0),h=F(0),a=F(1);0!=r.signum();){for(;r.isEven();)r.rShiftTo(1,r),i?(s.isEven()&&o.isEven()||(s.addTo(this,s),o.subTo(e,o)),s.rShiftTo(1,s)):o.isEven()||o.subTo(e,o),o.rShiftTo(1,o);for(;n.isEven();)n.rShiftTo(1,n),i?(h.isEven()&&a.isEven()||(h.addTo(this,h),a.subTo(e,a)),h.rShiftTo(1,h)):a.isEven()||a.subTo(e,a),a.rShiftTo(1,a);r.compareTo(n)>=0?(r.subTo(n,r),i&&s.subTo(h,s),o.subTo(a,o)):(n.subTo(r,n),i&&h.subTo(s,h),a.subTo(o,a))}return 0!=n.compareTo(t.ONE)?t.ZERO:a.compareTo(e)>=0?a.subtract(e):a.signum()<0?(a.addTo(e,a),a.signum()<0?a.add(e):a):a},t.prototype.pow=function(t){return this.exp(t,new A)},t.prototype.gcd=function(t){var e=this.s<0?this.negate():this.clone(),i=t.s<0?t.negate():t.clone();if(e.compareTo(i)<0){var r=e;e=i,i=r}var n=e.getLowestSetBit(),s=i.getLowestSetBit();if(0>s)return e;for(s>n&&(s=n),s>0&&(e.rShiftTo(s,e),i.rShiftTo(s,i));e.signum()>0;)(n=e.getLowestSetBit())>0&&e.rShiftTo(n,e),(n=i.getLowestSetBit())>0&&i.rShiftTo(n,i),e.compareTo(i)>=0?(e.subTo(i,e),e.rShiftTo(1,e)):(i.subTo(e,i),i.rShiftTo(1,i));return s>0&&i.lShiftTo(s,i),i},t.prototype.isProbablePrime=function(t){var e,i=this.abs();if(1==i.t&&i[0]<=R[R.length-1]){for(e=0;e<R.length;++e)if(i[0]==R[e])return!0;return!1}if(i.isEven())return!1;for(e=1;e<R.length;){for(var r=R[e],n=e+1;n<R.length&&O>r;)r*=R[n++];for(r=i.modInt(r);n>e;)if(r%R[e++]==0)return!1}return i.millerRabin(t)},t.prototype.copyTo=function(t){for(var e=this.t-1;e>=0;--e)t[e]=this[e];t.t=this.t,t.s=this.s},t.prototype.fromInt=function(t){this.t=1,this.s=0>t?-1:0,t>0?this[0]=t:-1>t?this[0]=t+this.DV:this.t=0},t.prototype.fromString=function(e,i){var r;if(16==i)r=4;else if(8==i)r=3;else if(256==i)r=8;else if(2==i)r=1;else if(32==i)r=5;else{if(4!=i)return void this.fromRadix(e,i);r=2}this.t=0,this.s=0;for(var n=e.length,s=!1,o=0;--n>=0;){var h=8==r?255&+e[n]:C(e,n);0>h?"-"==e.charAt(n)&&(s=!0):(s=!1,0==o?this[this.t++]=h:o+r>this.DB?(this[this.t-1]|=(h&(1<<this.DB-o)-1)<<o,this[this.t++]=h>>this.DB-o):this[this.t-1]|=h<<o,(o+=r)>=this.DB&&(o-=this.DB))}8==r&&0!=(128&+e[0])&&(this.s=-1,o>0&&(this[this.t-1]|=(1<<this.DB-o)-1<<o)),this.clamp(),s&&t.ZERO.subTo(this,this)},t.prototype.clamp=function(){for(var t=this.s&this.DM;this.t>0&&this[this.t-1]==t;)--this.t},t.prototype.dlShiftTo=function(t,e){var i;for(i=this.t-1;i>=0;--i)e[i+t]=this[i];for(i=t-1;i>=0;--i)e[i]=0;e.t=this.t+t,e.s=this.s},t.prototype.drShiftTo=function(t,e){for(var i=t;i<this.t;++i)e[i-t]=this[i];e.t=Math.max(this.t-t,0),e.s=this.s},t.prototype.lShiftTo=function(t,e){for(var i=t%this.DB,r=this.DB-i,n=(1<<r)-1,s=Math.floor(t/this.DB),o=this.s<<i&this.DM,h=this.t-1;h>=0;--h)e[h+s+1]=this[h]>>r|o,o=(this[h]&n)<<i;for(h=s-1;h>=0;--h)e[h]=0;e[s]=o,e.t=this.t+s+1,e.s=this.s,e.clamp()},t.prototype.rShiftTo=function(t,e){e.s=this.s;var i=Math.floor(t/this.DB);if(i>=this.t)e.t=0;else{var r=t%this.DB,n=this.DB-r,s=(1<<r)-1;e[0]=this[i]>>r;for(var o=i+1;o<this.t;++o)e[o-i-1]|=(this[o]&s)<<n,e[o-i]=this[o]>>r;r>0&&(e[this.t-i-1]|=(this.s&s)<<n),e.t=this.t-i,e.clamp()}},t.prototype.subTo=function(t,e){for(var i=0,r=0,n=Math.min(t.t,this.t);n>i;)r+=this[i]-t[i],e[i++]=r&this.DM,r>>=this.DB;if(t.t<this.t){for(r-=t.s;i<this.t;)r+=this[i],e[i++]=r&this.DM,r>>=this.DB;r+=this.s}else{for(r+=this.s;i<t.t;)r-=t[i],e[i++]=r&this.DM,r>>=this.DB;r-=t.s}e.s=0>r?-1:0,-1>r?e[i++]=this.DV+r:r>0&&(e[i++]=r),e.t=i,e.clamp()},t.prototype.multiplyTo=function(e,i){var r=this.abs(),n=e.abs(),s=r.t;for(i.t=s+n.t;--s>=0;)i[s]=0;for(s=0;s<n.t;++s)i[s+r.t]=r.am(0,n[s],i,s,0,r.t);i.s=0,i.clamp(),this.s!=e.s&&t.ZERO.subTo(i,i)},t.prototype.squareTo=function(t){for(var e=this.abs(),i=t.t=2*e.t;--i>=0;)t[i]=0;for(i=0;i<e.t-1;++i){var r=e.am(i,e[i],t,2*i,0,1);(t[i+e.t]+=e.am(i+1,2*e[i],t,2*i+1,r,e.t-i-1))>=e.DV&&(t[i+e.t]-=e.DV,t[i+e.t+1]=1)}t.t>0&&(t[t.t-1]+=e.am(i,e[i],t,2*i,0,1)),t.s=0,t.clamp()},t.prototype.divRemTo=function(e,i,r){var n=e.abs();if(!(n.t<=0)){var s=this.abs();if(s.t<n.t)return null!=i&&i.fromInt(0),void(null!=r&&this.copyTo(r));null==r&&(r=M());var o=M(),h=this.s,a=e.s,u=this.DB-U(n[n.t-1]);u>0?(n.lShiftTo(u,o),s.lShiftTo(u,r)):(n.copyTo(o),s.copyTo(r));var c=o.t,f=o[c-1];if(0!=f){var l=f*(1<<this.F1)+(c>1?o[c-2]>>this.F2:0),p=this.FV/l,g=(1<<this.F1)/l,d=1<<this.F2,v=r.t,m=v-c,y=null==i?M():i;for(o.dlShiftTo(m,y),r.compareTo(y)>=0&&(r[r.t++]=1,r.subTo(y,r)),t.ONE.dlShiftTo(c,y),y.subTo(o,o);o.t<c;)o[o.t++]=0;for(;--m>=0;){var b=r[--v]==f?this.DM:Math.floor(r[v]*p+(r[v-1]+d)*g);if((r[v]+=o.am(0,b,r,m,0,c))<b)for(o.dlShiftTo(m,y),r.subTo(y,r);r[v]<--b;)r.subTo(y,r)}null!=i&&(r.drShiftTo(c,i),h!=a&&t.ZERO.subTo(i,i)),r.t=c,r.clamp(),u>0&&r.rShiftTo(u,r),0>h&&t.ZERO.subTo(r,r)}}},t.prototype.invDigit=function(){if(this.t<1)return 0;var t=this[0];if(0==(1&t))return 0;var e=3&t;return(e=(e=(e=(e=e*(2-(15&t)*e)&15)*(2-(255&t)*e)&255)*(2-((65535&t)*e&65535))&65535)*(2-t*e%this.DV)%this.DV)>0?this.DV-e:-e},t.prototype.isEven=function(){return 0==(this.t>0?1&this[0]:this.s)},t.prototype.exp=function(e,i){if(e>4294967295||1>e)return t.ONE;var r=M(),n=M(),s=i.convert(this),o=U(e)-1;for(s.copyTo(r);--o>=0;)if(i.sqrTo(r,n),(e&1<<o)>0)i.mulTo(n,s,r);else{var h=r;r=n,n=h}return i.revert(r)},t.prototype.chunkSize=function(t){return Math.floor(Math.LN2*this.DB/Math.log(t))},t.prototype.toRadix=function(t){if(null==t&&(t=10),0==this.signum()||2>t||t>36)return"0";var e=this.chunkSize(t),i=Math.pow(t,e),r=F(i),n=M(),s=M(),o="";for(this.divRemTo(r,n,s);n.signum()>0;)o=(i+s.intValue()).toString(t).substr(1)+o,n.divRemTo(r,n,s);return s.intValue().toString(t)+o},t.prototype.fromRadix=function(e,i){this.fromInt(0),null==i&&(i=10);for(var r=this.chunkSize(i),n=Math.pow(i,r),s=!1,o=0,h=0,a=0;a<e.length;++a){var u=C(e,a);0>u?"-"==e.charAt(a)&&0==this.signum()&&(s=!0):(h=i*h+u,++o>=r&&(this.dMultiply(n),this.dAddOffset(h,0),o=0,h=0))}o>0&&(this.dMultiply(Math.pow(i,o)),this.dAddOffset(h,0)),s&&t.ZERO.subTo(this,this)},t.prototype.fromNumber=function(e,i,r){if("number"==typeof i)if(2>e)this.fromInt(1);else for(this.fromNumber(e,r),this.testBit(e-1)||this.bitwiseTo(t.ONE.shiftLeft(e-1),n,this),this.isEven()&&this.dAddOffset(1,0);!this.isProbablePrime(i);)this.dAddOffset(2,0),this.bitLength()>e&&this.subTo(t.ONE.shiftLeft(e-1),this);else{var s=[],o=7&e;s.length=1+(e>>3),i.nextBytes(s),o>0?s[0]&=(1<<o)-1:s[0]=0,this.fromString(s,256)}},t.prototype.bitwiseTo=function(t,e,i){var r,n,s=Math.min(t.t,this.t);for(r=0;s>r;++r)i[r]=e(this[r],t[r]);if(t.t<this.t){for(n=t.s&this.DM,r=s;r<this.t;++r)i[r]=e(this[r],n);i.t=this.t}else{for(n=this.s&this.DM,r=s;r<t.t;++r)i[r]=e(n,t[r]);i.t=t.t}i.s=e(this.s,t.s),i.clamp()},t.prototype.changeBit=function(e,i){var r=t.ONE.shiftLeft(e);return this.bitwiseTo(r,i,r),r},t.prototype.addTo=function(t,e){for(var i=0,r=0,n=Math.min(t.t,this.t);n>i;)r+=this[i]+t[i],e[i++]=r&this.DM,r>>=this.DB;if(t.t<this.t){for(r+=t.s;i<this.t;)r+=this[i],e[i++]=r&this.DM,r>>=this.DB;r+=this.s}else{for(r+=this.s;i<t.t;)r+=t[i],e[i++]=r&this.DM,r>>=this.DB;r+=t.s}e.s=0>r?-1:0,r>0?e[i++]=r:-1>r&&(e[i++]=this.DV+r),e.t=i,e.clamp()},t.prototype.dMultiply=function(t){this[this.t]=this.am(0,t-1,this,0,0,this.t),++this.t,this.clamp()},t.prototype.dAddOffset=function(t,e){if(0!=t){for(;this.t<=e;)this[this.t++]=0;for(this[e]+=t;this[e]>=this.DV;)this[e]-=this.DV,++e>=this.t&&(this[this.t++]=0),++this[e]}},t.prototype.multiplyLowerTo=function(t,e,i){var r=Math.min(this.t+t.t,e);for(i.s=0,i.t=r;r>0;)i[--r]=0;for(var n=i.t-this.t;n>r;++r)i[r+this.t]=this.am(0,t[r],i,r,0,this.t);for(n=Math.min(t.t,e);n>r;++r)this.am(0,t[r],i,r,0,e-r);i.clamp()},t.prototype.multiplyUpperTo=function(t,e,i){--e;var r=i.t=this.t+t.t-e;for(i.s=0;--r>=0;)i[r]=0;for(r=Math.max(e-this.t,0);r<t.t;++r)i[this.t+r-e]=this.am(e-r,t[r],i,0,0,this.t+r-e);i.clamp(),i.drShiftTo(1,i)},t.prototype.modInt=function(t){if(0>=t)return 0;var e=this.DV%t,i=this.s<0?t-1:0;if(this.t>0)if(0==e)i=this[0]%t;else for(var r=this.t-1;r>=0;--r)i=(e*i+this[r])%t;return i},t.prototype.millerRabin=function(e){var i=this.subtract(t.ONE),r=i.getLowestSetBit();if(0>=r)return!1;var n=i.shiftRight(r);(e=e+1>>1)>R.length&&(e=R.length);for(var s=M(),o=0;e>o;++o){s.fromInt(R[Math.floor(Math.random()*R.length)]);var h=s.modPow(n,this);if(0!=h.compareTo(t.ONE)&&0!=h.compareTo(i)){for(var a=1;a++<r&&0!=h.compareTo(i);)if(0==(h=h.modPowInt(2,this)).compareTo(t.ONE))return!1;if(0!=h.compareTo(i))return!1}}return!0},t.prototype.square=function(){var t=M();return this.squareTo(t),t},t.prototype.gcda=function(t,e){var i=this.s<0?this.negate():this.clone(),r=t.s<0?t.negate():t.clone();if(i.compareTo(r)<0){var n=i;i=r,r=n}var s=i.getLowestSetBit(),o=r.getLowestSetBit();if(0>o)e(i);else{o>s&&(o=s),o>0&&(i.rShiftTo(o,i),r.rShiftTo(o,r));var h=function(){(s=i.getLowestSetBit())>0&&i.rShiftTo(s,i),(s=r.getLowestSetBit())>0&&r.rShiftTo(s,r),i.compareTo(r)>=0?(i.subTo(r,i),i.rShiftTo(1,i)):(r.subTo(i,r),r.rShiftTo(1,r)),i.signum()>0?setTimeout(h,0):(o>0&&r.lShiftTo(o,r),setTimeout(function(){e(r)},0))};setTimeout(h,10)}},t.prototype.fromNumberAsync=function(e,i,r,s){if("number"==typeof i)if(2>e)this.fromInt(1);else{this.fromNumber(e,r),this.testBit(e-1)||this.bitwiseTo(t.ONE.shiftLeft(e-1),n,this),this.isEven()&&this.dAddOffset(1,0);var o=this,h=function(){o.dAddOffset(2,0),o.bitLength()>e&&o.subTo(t.ONE.shiftLeft(e-1),o),o.isProbablePrime(i)?setTimeout(function(){s()},0):setTimeout(h,0)};setTimeout(h,0)}else{var a=[],u=7&e;a.length=1+(e>>3),i.nextBytes(a),u>0?a[0]&=(1<<u)-1:a[0]=0,this.fromString(a,256)}},t}(),A=function(){function t(){}return t.prototype.convert=function(t){return t},t.prototype.revert=function(t){return t},t.prototype.mulTo=function(t,e,i){t.multiplyTo(e,i)},t.prototype.sqrTo=function(t,e){t.squareTo(e)},t}(),I=function(){function t(t){this.m=t}return t.prototype.convert=function(t){return t.s<0||t.compareTo(this.m)>=0?t.mod(this.m):t},t.prototype.revert=function(t){return t},t.prototype.reduce=function(t){t.divRemTo(this.m,null,t)},t.prototype.mulTo=function(t,e,i){t.multiplyTo(e,i),this.reduce(i)},t.prototype.sqrTo=function(t,e){t.squareTo(e),this.reduce(e)},t}(),N=function(){function t(t){this.m=t,this.mp=t.invDigit(),this.mpl=32767&this.mp,this.mph=this.mp>>15,this.um=(1<<t.DB-15)-1,this.mt2=2*t.t}return t.prototype.convert=function(t){var e=M();return t.abs().dlShiftTo(this.m.t,e),e.divRemTo(this.m,null,e),t.s<0&&e.compareTo(V.ZERO)>0&&this.m.subTo(e,e),e},t.prototype.revert=function(t){var e=M();return t.copyTo(e),this.reduce(e),e},t.prototype.reduce=function(t){for(;t.t<=this.mt2;)t[t.t++]=0;for(var e=0;e<this.m.t;++e){var i=32767&t[e],r=i*this.mpl+((i*this.mph+(t[e]>>15)*this.mpl&this.um)<<15)&t.DM;for(t[i=e+this.m.t]+=this.m.am(0,r,t,e,0,this.m.t);t[i]>=t.DV;)t[i]-=t.DV,t[++i]++}t.clamp(),t.drShiftTo(this.m.t,t),t.compareTo(this.m)>=0&&t.subTo(this.m,t)},t.prototype.mulTo=function(t,e,i){t.multiplyTo(e,i),this.reduce(i)},t.prototype.sqrTo=function(t,e){t.squareTo(e),this.reduce(e)},t}(),P=function(){function t(t){this.m=t,this.r2=M(),this.q3=M(),V.ONE.dlShiftTo(2*t.t,this.r2),this.mu=this.r2.divide(t)}return t.prototype.convert=function(t){if(t.s<0||t.t>2*this.m.t)return t.mod(this.m);if(t.compareTo(this.m)<0)return t;var e=M();return t.copyTo(e),this.reduce(e),e},t.prototype.revert=function(t){return t},t.prototype.reduce=function(t){for(t.drShiftTo(this.m.t-1,this.r2),t.t>this.m.t+1&&(t.t=this.m.t+1,t.clamp()),this.mu.multiplyUpperTo(this.r2,this.m.t+1,this.q3),this.m.multiplyLowerTo(this.q3,this.m.t+1,this.r2);t.compareTo(this.r2)<0;)t.dAddOffset(1,this.m.t+1);for(t.subTo(this.r2,t);t.compareTo(this.m)>=0;)t.subTo(this.m,t)},t.prototype.mulTo=function(t,e,i){t.multiplyTo(e,i),this.reduce(i)},t.prototype.sqrTo=function(t,e){t.squareTo(e),this.reduce(e)},t}();"Microsoft Internet Explorer"==navigator.appName?(V.prototype.am=function(t,e,i,r,n,s){for(var o=32767&e,h=e>>15;--s>=0;){var a=32767&this[t],u=this[t++]>>15,c=h*a+u*o;n=((a=o*a+((32767&c)<<15)+i[r]+(1073741823&n))>>>30)+(c>>>15)+h*u+(n>>>30),i[r++]=1073741823&a}return n},w=30):"Netscape"!=navigator.appName?(V.prototype.am=function(t,e,i,r,n,s){for(;--s>=0;){var o=e*this[t++]+i[r]+n;n=Math.floor(o/67108864),i[r++]=67108863&o}return n},w=26):(V.prototype.am=function(t,e,i,r,n,s){for(var o=16383&e,h=e>>14;--s>=0;){var a=16383&this[t],u=this[t++]>>14,c=h*a+u*o;n=((a=o*a+((16383&c)<<14)+i[r]+n)>>28)+(c>>14)+h*u,i[r++]=268435455&a}return n},w=28),V.prototype.DB=w,V.prototype.DM=(1<<w)-1,V.prototype.DV=1<<w,V.prototype.FV=Math.pow(2,52),V.prototype.F1=52-w,V.prototype.F2=2*w-52;var j,L,H=[];for(j="0".charCodeAt(0),L=0;9>=L;++L)H[j++]=L;for(j="a".charCodeAt(0),L=10;36>L;++L)H[j++]=L;for(j="A".charCodeAt(0),L=10;36>L;++L)H[j++]=L;V.ZERO=F(0),V.ONE=F(1);var _,k,K=function(){function t(){this.i=0,this.j=0,this.S=[]}return t.prototype.init=function(t){var e,i,r;for(e=0;256>e;++e)this.S[e]=e;for(i=0,e=0;256>e;++e)i=i+this.S[e]+t[e%t.length]&255,r=this.S[e],this.S[e]=this.S[i],this.S[i]=r;this.i=0,this.j=0},t.prototype.next=function(){var t;return this.i=this.i+1&255,this.j=this.j+this.S[this.i]&255,t=this.S[this.i],this.S[this.i]=this.S[this.j],this.S[this.j]=t,this.S[t+this.S[this.i]&255]},t}(),z=256,Z=null;if(null==Z){Z=[],k=0;var G=void 0;if(window.crypto&&window.crypto.getRandomValues){var $=new Uint32Array(256);for(window.crypto.getRandomValues($),G=0;G<$.length;++G)Z[k++]=255&$[G]}var Y=function(t){if(this.count=this.count||0,this.count>=256||k>=z)window.removeEventListener?window.removeEventListener("mousemove",Y,!1):window.detachEvent&&window.detachEvent("onmousemove",Y);else try{var e=t.x+t.y;Z[k++]=255&e,this.count+=1}catch(t){}};window.addEventListener?window.addEventListener("mousemove",Y,!1):window.attachEvent&&window.attachEvent("onmousemove",Y)}var X=function(){function t(){}return t.prototype.nextBytes=function(t){for(var e=0;e<t.length;++e)t[e]=J()},t}(),Q=function(){function t(){this.n=null,this.e=0,this.d=null,this.p=null,this.q=null,this.dmp1=null,this.dmq1=null,this.coeff=null}return t.prototype.doPublic=function(t){return t.modPowInt(this.e,this.n)},t.prototype.doPrivate=function(t){if(null==this.p||null==this.q)return t.modPow(this.d,this.n);for(var e=t.mod(this.p).modPow(this.dmp1,this.p),i=t.mod(this.q).modPow(this.dmq1,this.q);e.compareTo(i)<0;)e=e.add(this.p);return e.subtract(i).multiply(this.coeff).mod(this.p).multiply(this.q).add(i)},t.prototype.setPublic=function(t,e){null!=t&&null!=e&&t.length>0&&e.length>0&&(this.n=q(t,16),this.e=parseInt(e,16))},t.prototype.encrypt=function(t){var e=function(t,e){if(e<t.length+11)return null;for(var i=[],r=t.length-1;r>=0&&e>0;){var n=t.charCodeAt(r--);128>n?i[--e]=n:n>127&&2048>n?(i[--e]=63&n|128,i[--e]=n>>6|192):(i[--e]=63&n|128,i[--e]=n>>6&63|128,i[--e]=n>>12|224)}i[--e]=0;for(var s=new X,o=[];e>2;){for(o[0]=0;0==o[0];)s.nextBytes(o);i[--e]=o[0]}return i[--e]=2,i[--e]=0,new V(i)}(t,this.n.bitLength()+7>>3);if(null==e)return null;var i=this.doPublic(e);if(null==i)return null;var r=i.toString(16);return 0==(1&r.length)?r:"0"+r},t.prototype.setPrivate=function(t,e,i){null!=t&&null!=e&&t.length>0&&e.length>0&&(this.n=q(t,16),this.e=parseInt(e,16),this.d=q(i,16))},t.prototype.setPrivateEx=function(t,e,i,r,n,s,o,h){null!=t&&null!=e&&t.length>0&&e.length>0&&(this.n=q(t,16),this.e=parseInt(e,16),this.d=q(i,16),this.p=q(r,16),this.q=q(n,16),this.dmp1=q(s,16),this.dmq1=q(o,16),this.coeff=q(h,16))},t.prototype.generate=function(t,e){var i=new X,r=t>>1;this.e=parseInt(e,16);for(var n=new V(e,16);;){for(;this.p=new V(t-r,1,i),0!=this.p.subtract(V.ONE).gcd(n).compareTo(V.ONE)||!this.p.isProbablePrime(10););for(;this.q=new V(r,1,i),0!=this.q.subtract(V.ONE).gcd(n).compareTo(V.ONE)||!this.q.isProbablePrime(10););if(this.p.compareTo(this.q)<=0){var s=this.p;this.p=this.q,this.q=s}var o=this.p.subtract(V.ONE),h=this.q.subtract(V.ONE),a=o.multiply(h);if(0==a.gcd(n).compareTo(V.ONE)){this.n=this.p.multiply(this.q),this.d=n.modInverse(a),this.dmp1=this.d.mod(o),this.dmq1=this.d.mod(h),this.coeff=this.q.modInverse(this.p);break}}},t.prototype.decrypt=function(t){var e=q(t,16),i=this.doPrivate(e);return null==i?null:function(t,e){for(var i=t.toByteArray(),r=0;r<i.length&&0==i[r];)++r;if(i.length-r!=e-1||2!=i[r])return null;for(++r;0!=i[r];)if(++r>=i.length)return null;for(var n="";++r<i.length;){var s=255&i[r];128>s?n+=String.fromCharCode(s):s>191&&224>s?(n+=String.fromCharCode((31&s)<<6|63&i[r+1]),++r):(n+=String.fromCharCode((15&s)<<12|(63&i[r+1])<<6|63&i[r+2]),r+=2)}return n}(i,this.n.bitLength()+7>>3)},t.prototype.generateAsync=function(t,e,i){var r=new X,n=t>>1;this.e=parseInt(e,16);var s=new V(e,16),o=this,h=function(){var e=function(){if(o.p.compareTo(o.q)<=0){var t=o.p;o.p=o.q,o.q=t}var e=o.p.subtract(V.ONE),r=o.q.subtract(V.ONE),n=e.multiply(r);0==n.gcd(s).compareTo(V.ONE)?(o.n=o.p.multiply(o.q),o.d=s.modInverse(n),o.dmp1=o.d.mod(e),o.dmq1=o.d.mod(r),o.coeff=o.q.modInverse(o.p),setTimeout(function(){i()},0)):setTimeout(h,0)},a=function(){o.q=M(),o.q.fromNumberAsync(n,1,r,function(){o.q.subtract(V.ONE).gcda(s,function(t){0==t.compareTo(V.ONE)&&o.q.isProbablePrime(10)?setTimeout(e,0):setTimeout(a,0)})})},u=function(){o.p=M(),o.p.fromNumberAsync(t-n,1,r,function(){o.p.subtract(V.ONE).gcda(s,function(t){0==t.compareTo(V.ONE)&&o.p.isProbablePrime(10)?setTimeout(a,0):setTimeout(u,0)})})};setTimeout(u,0)};setTimeout(h,0)},t.prototype.sign=function(t,e,i){var r=function(t,e){if(e<t.length+22)return null;for(var i=e-t.length-6,r="",n=0;i>n;n+=2)r+="ff";return q("0001"+r+"00"+t,16)}((W[i]||"")+e(t).toString(),this.n.bitLength()/4);if(null==r)return null;var n=this.doPrivate(r);if(null==n)return null;var s=n.toString(16);return 0==(1&s.length)?s:"0"+s},t.prototype.verify=function(t,e,i){var r=q(e,16),n=this.doPublic(r);return null==n?null:function(t){for(var e in W)if(W.hasOwnProperty(e)){var i=W[e],r=i.length;if(t.substr(0,r)==i)return t.substr(r)}return t}(n.toString(16).replace(/^1f+00/,""))==i(t).toString()},t}(),W={md2:"3020300c06082a864886f70d020205000410",md5:"3020300c06082a864886f70d020505000410",sha1:"3021300906052b0e03021a05000414",sha224:"302d300d06096086480165030402040500041c",sha256:"3031300d060960864801650304020105000420",sha384:"3041300d060960864801650304020205000430",sha512:"3051300d060960864801650304020305000440",ripemd160:"3021300906052b2403020105000414"},tt={};tt.lang={extend:function(t,e,i){if(!e||!t)throw new Error("YAHOO.lang.extend failed, please check that all dependencies are included.");var r=function(){};if(r.prototype=e.prototype,t.prototype=new r,t.prototype.constructor=t,t.superclass=e.prototype,e.prototype.constructor==Object.prototype.constructor&&(e.prototype.constructor=e),i){var n;for(n in i)t.prototype[n]=i[n];var s=function(){},o=["toString","valueOf"];try{/MSIE/.test(navigator.userAgent)&&(s=function(t,e){for(n=0;n<o.length;n+=1){var i=o[n],r=e[i];"function"==typeof r&&r!=Object.prototype[i]&&(t[i]=r)}})}catch(t){}s(t.prototype,i)}}};var et={};void 0!==et.asn1&&et.asn1||(et.asn1={}),et.asn1.ASN1Util=new function(){this.integerToByteHex=function(t){var e=t.toString(16);return e.length%2==1&&(e="0"+e),e},this.bigIntToMinTwosComplementsHex=function(t){var e=t.toString(16);if("-"!=e.substr(0,1))e.length%2==1?e="0"+e:e.match(/^[0-7]/)||(e="00"+e);else{var i=e.substr(1).length;i%2==1?i+=1:e.match(/^[0-7]/)||(i+=2);for(var r="",n=0;i>n;n++)r+="f";e=new V(r,16).xor(t).add(V.ONE).toString(16).replace(/^-/,"")}return e},this.getPEMStringFromHex=function(t,e){return hextopem(t,e)},this.newObject=function(t){var e=et.asn1,i=e.DERBoolean,r=e.DERInteger,n=e.DERBitString,s=e.DEROctetString,o=e.DERNull,h=e.DERObjectIdentifier,a=e.DEREnumerated,u=e.DERUTF8String,c=e.DERNumericString,f=e.DERPrintableString,l=e.DERTeletexString,p=e.DERIA5String,g=e.DERUTCTime,d=e.DERGeneralizedTime,v=e.DERSequence,m=e.DERSet,y=e.DERTaggedObject,b=e.ASN1Util.newObject,T=Object.keys(t);if(1!=T.length)throw"key of param shall be only one.";var S=T[0];if(-1==":bool:int:bitstr:octstr:null:oid:enum:utf8str:numstr:prnstr:telstr:ia5str:utctime:gentime:seq:set:tag:".indexOf(":"+S+":"))throw"undefined key: "+S;if("bool"==S)return new i(t[S]);if("int"==S)return new r(t[S]);if("bitstr"==S)return new n(t[S]);if("octstr"==S)return new s(t[S]);if("null"==S)return new o(t[S]);if("oid"==S)return new h(t[S]);if("enum"==S)return new a(t[S]);if("utf8str"==S)return new u(t[S]);if("numstr"==S)return new c(t[S]);if("prnstr"==S)return new f(t[S]);if("telstr"==S)return new l(t[S]);if("ia5str"==S)return new p(t[S]);if("utctime"==S)return new g(t[S]);if("gentime"==S)return new d(t[S]);if("seq"==S){for(var E=t[S],w=[],D=0;D<E.length;D++){var x=b(E[D]);w.push(x)}return new v({array:w})}if("set"==S){for(E=t[S],w=[],D=0;D<E.length;D++)x=b(E[D]),w.push(x);return new m({array:w})}if("tag"==S){var B=t[S];if("[object Array]"===Object.prototype.toString.call(B)&&3==B.length){var R=b(B[2]);return new y({tag:B[0],explicit:B[1],obj:R})}var O={};if(void 0!==B.explicit&&(O.explicit=B.explicit),void 0!==B.tag&&(O.tag=B.tag),void 0===B.obj)throw"obj shall be specified for 'tag'.";return O.obj=b(B.obj),new y(O)}},this.jsonToASN1HEX=function(t){return this.newObject(t).getEncodedHex()}},et.asn1.ASN1Util.oidHexToInt=function(t){for(var e="",i=parseInt(t.substr(0,2),16),r=(e=Math.floor(i/40)+"."+i%40,""),n=2;n<t.length;n+=2){var s=("00000000"+parseInt(t.substr(n,2),16).toString(2)).slice(-8);r+=s.substr(1,7),"0"==s.substr(0,1)&&(e=e+"."+new V(r,2).toString(10),r="")}return e},et.asn1.ASN1Util.oidIntToHex=function(t){var e=function(t){var e=t.toString(16);return 1==e.length&&(e="0"+e),e},i=function(t){var i="",r=new V(t,10).toString(2),n=7-r.length%7;7==n&&(n=0);for(var s="",o=0;n>o;o++)s+="0";for(r=s+r,o=0;o<r.length-1;o+=7){var h=r.substr(o,7);o!=r.length-7&&(h="1"+h),i+=e(parseInt(h,2))}return i};if(!t.match(/^[0-9.]+$/))throw"malformed oid string: "+t;var r="",n=t.split("."),s=40*parseInt(n[0])+parseInt(n[1]);r+=e(s),n.splice(0,2);for(var o=0;o<n.length;o++)r+=i(n[o]);return r},et.asn1.ASN1Object=function(){this.getLengthHexFromValue=function(){if(void 0===this.hV||null==this.hV)throw"this.hV is null or undefined.";if(this.hV.length%2==1)throw"value hex must be even length: n="+"".length+",v="+this.hV;var t=this.hV.length/2,e=t.toString(16);if(e.length%2==1&&(e="0"+e),128>t)return e;var i=e.length/2;if(i>15)throw"ASN.1 length too long to represent by 8x: n = "+t.toString(16);return(128+i).toString(16)+e},this.getEncodedHex=function(){return(null==this.hTLV||this.isModified)&&(this.hV=this.getFreshValueHex(),this.hL=this.getLengthHexFromValue(),this.hTLV=this.hT+this.hL+this.hV,this.isModified=!1),this.hTLV},this.getValueHex=function(){return this.getEncodedHex(),this.hV},this.getFreshValueHex=function(){return""}},et.asn1.DERAbstractString=function(t){et.asn1.DERAbstractString.superclass.constructor.call(this),this.getString=function(){return this.s},this.setString=function(t){this.hTLV=null,this.isModified=!0,this.s=t,this.hV=stohex(this.s)},this.setStringHex=function(t){this.hTLV=null,this.isModified=!0,this.s=null,this.hV=t},this.getFreshValueHex=function(){return this.hV},void 0!==t&&("string"==typeof t?this.setString(t):void 0!==t.str?this.setString(t.str):void 0!==t.hex&&this.setStringHex(t.hex))},tt.lang.extend(et.asn1.DERAbstractString,et.asn1.ASN1Object),et.asn1.DERAbstractTime=function(t){et.asn1.DERAbstractTime.superclass.constructor.call(this),this.localDateToUTC=function(t){return utc=t.getTime()+6e4*t.getTimezoneOffset(),new Date(utc)},this.formatDate=function(t,e,i){var r=this.zeroPadding,n=this.localDateToUTC(t),s=String(n.getFullYear());"utc"==e&&(s=s.substr(2,2));var o=s+r(String(n.getMonth()+1),2)+r(String(n.getDate()),2)+r(String(n.getHours()),2)+r(String(n.getMinutes()),2)+r(String(n.getSeconds()),2);if(!0===i){var h=n.getMilliseconds();if(0!=h){var a=r(String(h),3);o=o+"."+(a=a.replace(/[0]+$/,""))}}return o+"Z"},this.zeroPadding=function(t,e){return t.length>=e?t:new Array(e-t.length+1).join("0")+t},this.getString=function(){return this.s},this.setString=function(t){this.hTLV=null,this.isModified=!0,this.s=t,this.hV=stohex(t)},this.setByDateValue=function(t,e,i,r,n,s){var o=new Date(Date.UTC(t,e-1,i,r,n,s,0));this.setByDate(o)},this.getFreshValueHex=function(){return this.hV}},tt.lang.extend(et.asn1.DERAbstractTime,et.asn1.ASN1Object),et.asn1.DERAbstractStructured=function(t){et.asn1.DERAbstractString.superclass.constructor.call(this),this.setByASN1ObjectArray=function(t){this.hTLV=null,this.isModified=!0,this.asn1Array=t},this.appendASN1Object=function(t){this.hTLV=null,this.isModified=!0,this.asn1Array.push(t)},this.asn1Array=new Array,void 0!==t&&void 0!==t.array&&(this.asn1Array=t.array)},tt.lang.extend(et.asn1.DERAbstractStructured,et.asn1.ASN1Object),et.asn1.DERBoolean=function(){et.asn1.DERBoolean.superclass.constructor.call(this),this.hT="01",this.hTLV="0101ff"},tt.lang.extend(et.asn1.DERBoolean,et.asn1.ASN1Object),et.asn1.DERInteger=function(t){et.asn1.DERInteger.superclass.constructor.call(this),this.hT="02",this.setByBigInteger=function(t){this.hTLV=null,this.isModified=!0,this.hV=et.asn1.ASN1Util.bigIntToMinTwosComplementsHex(t)},this.setByInteger=function(t){var e=new V(String(t),10);this.setByBigInteger(e)},this.setValueHex=function(t){this.hV=t},this.getFreshValueHex=function(){return this.hV},void 0!==t&&(void 0!==t.bigint?this.setByBigInteger(t.bigint):void 0!==t["int"]?this.setByInteger(t["int"]):"number"==typeof t?this.setByInteger(t):void 0!==t.hex&&this.setValueHex(t.hex))},tt.lang.extend(et.asn1.DERInteger,et.asn1.ASN1Object),et.asn1.DERBitString=function(t){if(void 0!==t&&void 0!==t.obj){var e=et.asn1.ASN1Util.newObject(t.obj);t.hex="00"+e.getEncodedHex()}et.asn1.DERBitString.superclass.constructor.call(this),this.hT="03",this.setHexValueIncludingUnusedBits=function(t){this.hTLV=null,this.isModified=!0,this.hV=t},this.setUnusedBitsAndHexValue=function(t,e){if(0>t||t>7)throw"unused bits shall be from 0 to 7: u = "+t;var i="0"+t;this.hTLV=null,this.isModified=!0,this.hV=i+e},this.setByBinaryString=function(t){var e=8-(t=t.replace(/0+$/,"")).length%8;8==e&&(e=0);for(var i=0;e>=i;i++)t+="0";var r="";for(i=0;i<t.length-1;i+=8){var n=t.substr(i,8),s=parseInt(n,2).toString(16);1==s.length&&(s="0"+s),r+=s}this.hTLV=null,this.isModified=!0,this.hV="0"+e+r},this.setByBooleanArray=function(t){for(var e="",i=0;i<t.length;i++)e+=1==t[i]?"1":"0";this.setByBinaryString(e)},this.newFalseArray=function(t){for(var e=new Array(t),i=0;t>i;i++)e[i]=!1;return e},this.getFreshValueHex=function(){return this.hV},void 0!==t&&("string"==typeof t&&t.toLowerCase().match(/^[0-9a-f]+$/)?this.setHexValueIncludingUnusedBits(t):void 0!==t.hex?this.setHexValueIncludingUnusedBits(t.hex):void 0!==t.bin?this.setByBinaryString(t.bin):void 0!==t.array&&this.setByBooleanArray(t.array))},tt.lang.extend(et.asn1.DERBitString,et.asn1.ASN1Object),et.asn1.DEROctetString=function(t){if(void 0!==t&&void 0!==t.obj){var e=et.asn1.ASN1Util.newObject(t.obj);t.hex=e.getEncodedHex()}et.asn1.DEROctetString.superclass.constructor.call(this,t),this.hT="04"},tt.lang.extend(et.asn1.DEROctetString,et.asn1.DERAbstractString),et.asn1.DERNull=function(){et.asn1.DERNull.superclass.constructor.call(this),this.hT="05",this.hTLV="0500"},tt.lang.extend(et.asn1.DERNull,et.asn1.ASN1Object),et.asn1.DERObjectIdentifier=function(t){var e=function(t){var e=t.toString(16);return 1==e.length&&(e="0"+e),e},i=function(t){var i="",r=new V(t,10).toString(2),n=7-r.length%7;7==n&&(n=0);for(var s="",o=0;n>o;o++)s+="0";for(r=s+r,o=0;o<r.length-1;o+=7){var h=r.substr(o,7);o!=r.length-7&&(h="1"+h),i+=e(parseInt(h,2))}return i};et.asn1.DERObjectIdentifier.superclass.constructor.call(this),this.hT="06",this.setValueHex=function(t){this.hTLV=null,this.isModified=!0,this.s=null,this.hV=t},this.setValueOidString=function(t){if(!t.match(/^[0-9.]+$/))throw"malformed oid string: "+t;var r="",n=t.split("."),s=40*parseInt(n[0])+parseInt(n[1]);r+=e(s),n.splice(0,2);for(var o=0;o<n.length;o++)r+=i(n[o]);this.hTLV=null,this.isModified=!0,this.s=null,this.hV=r},this.setValueName=function(t){var e=et.asn1.x509.OID.name2oid(t);if(""===e)throw"DERObjectIdentifier oidName undefined: "+t;this.setValueOidString(e)},this.getFreshValueHex=function(){return this.hV},void 0!==t&&("string"==typeof t?t.match(/^[0-2].[0-9.]+$/)?this.setValueOidString(t):this.setValueName(t):void 0!==t.oid?this.setValueOidString(t.oid):void 0!==t.hex?this.setValueHex(t.hex):void 0!==t.name&&this.setValueName(t.name))},tt.lang.extend(et.asn1.DERObjectIdentifier,et.asn1.ASN1Object),et.asn1.DEREnumerated=function(t){et.asn1.DEREnumerated.superclass.constructor.call(this),this.hT="0a",this.setByBigInteger=function(t){this.hTLV=null,this.isModified=!0,this.hV=et.asn1.ASN1Util.bigIntToMinTwosComplementsHex(t)},this.setByInteger=function(t){var e=new V(String(t),10);this.setByBigInteger(e)},this.setValueHex=function(t){this.hV=t},this.getFreshValueHex=function(){return this.hV},void 0!==t&&(void 0!==t["int"]?this.setByInteger(t["int"]):"number"==typeof t?this.setByInteger(t):void 0!==t.hex&&this.setValueHex(t.hex))},tt.lang.extend(et.asn1.DEREnumerated,et.asn1.ASN1Object),et.asn1.DERUTF8String=function(t){et.asn1.DERUTF8String.superclass.constructor.call(this,t),this.hT="0c"},tt.lang.extend(et.asn1.DERUTF8String,et.asn1.DERAbstractString),et.asn1.DERNumericString=function(t){et.asn1.DERNumericString.superclass.constructor.call(this,t),this.hT="12"},tt.lang.extend(et.asn1.DERNumericString,et.asn1.DERAbstractString),et.asn1.DERPrintableString=function(t){et.asn1.DERPrintableString.superclass.constructor.call(this,t),this.hT="13"},tt.lang.extend(et.asn1.DERPrintableString,et.asn1.DERAbstractString),et.asn1.DERTeletexString=function(t){et.asn1.DERTeletexString.superclass.constructor.call(this,t),this.hT="14"},tt.lang.extend(et.asn1.DERTeletexString,et.asn1.DERAbstractString),et.asn1.DERIA5String=function(t){et.asn1.DERIA5String.superclass.constructor.call(this,t),this.hT="16"},tt.lang.extend(et.asn1.DERIA5String,et.asn1.DERAbstractString),et.asn1.DERUTCTime=function(t){et.asn1.DERUTCTime.superclass.constructor.call(this,t),
this.hT="17",this.setByDate=function(t){this.hTLV=null,this.isModified=!0,this.date=t,this.s=this.formatDate(this.date,"utc"),this.hV=stohex(this.s)},this.getFreshValueHex=function(){return void 0===this.date&&void 0===this.s&&(this.date=new Date,this.s=this.formatDate(this.date,"utc"),this.hV=stohex(this.s)),this.hV},void 0!==t&&(void 0!==t.str?this.setString(t.str):"string"==typeof t&&t.match(/^[0-9]{12}Z$/)?this.setString(t):void 0!==t.hex?this.setStringHex(t.hex):void 0!==t.date&&this.setByDate(t.date))},tt.lang.extend(et.asn1.DERUTCTime,et.asn1.DERAbstractTime),et.asn1.DERGeneralizedTime=function(t){et.asn1.DERGeneralizedTime.superclass.constructor.call(this,t),this.hT="18",this.withMillis=!1,this.setByDate=function(t){this.hTLV=null,this.isModified=!0,this.date=t,this.s=this.formatDate(this.date,"gen",this.withMillis),this.hV=stohex(this.s)},this.getFreshValueHex=function(){return void 0===this.date&&void 0===this.s&&(this.date=new Date,this.s=this.formatDate(this.date,"gen",this.withMillis),this.hV=stohex(this.s)),this.hV},void 0!==t&&(void 0!==t.str?this.setString(t.str):"string"==typeof t&&t.match(/^[0-9]{14}Z$/)?this.setString(t):void 0!==t.hex?this.setStringHex(t.hex):void 0!==t.date&&this.setByDate(t.date),!0===t.millis&&(this.withMillis=!0))},tt.lang.extend(et.asn1.DERGeneralizedTime,et.asn1.DERAbstractTime),et.asn1.DERSequence=function(t){et.asn1.DERSequence.superclass.constructor.call(this,t),this.hT="30",this.getFreshValueHex=function(){for(var t="",e=0;e<this.asn1Array.length;e++)t+=this.asn1Array[e].getEncodedHex();return this.hV=t,this.hV}},tt.lang.extend(et.asn1.DERSequence,et.asn1.DERAbstractStructured),et.asn1.DERSet=function(t){et.asn1.DERSet.superclass.constructor.call(this,t),this.hT="31",this.sortFlag=!0,this.getFreshValueHex=function(){for(var t=new Array,e=0;e<this.asn1Array.length;e++){var i=this.asn1Array[e];t.push(i.getEncodedHex())}return 1==this.sortFlag&&t.sort(),this.hV=t.join(""),this.hV},void 0!==t&&void 0!==t.sortflag&&0==t.sortflag&&(this.sortFlag=!1)},tt.lang.extend(et.asn1.DERSet,et.asn1.DERAbstractStructured),et.asn1.DERTaggedObject=function(t){et.asn1.DERTaggedObject.superclass.constructor.call(this),this.hT="a0",this.hV="",this.isExplicit=!0,this.asn1Object=null,this.setASN1Object=function(t,e,i){this.hT=e,this.isExplicit=t,this.asn1Object=i,this.isExplicit?(this.hV=this.asn1Object.getEncodedHex(),this.hTLV=null,this.isModified=!0):(this.hV=null,this.hTLV=i.getEncodedHex(),this.hTLV=this.hTLV.replace(/^../,e),this.isModified=!1)},this.getFreshValueHex=function(){return this.hV},void 0!==t&&(void 0!==t.tag&&(this.hT=t.tag),void 0!==t.explicit&&(this.isExplicit=t.explicit),void 0!==t.obj&&(this.asn1Object=t.obj,this.setASN1Object(this.isExplicit,this.hT,this.asn1Object)))},tt.lang.extend(et.asn1.DERTaggedObject,et.asn1.ASN1Object);var it=function(t){function e(i){var r=t.call(this)||this;return i&&("string"==typeof i?r.parseKey(i):(e.hasPrivateKeyProperty(i)||e.hasPublicKeyProperty(i))&&r.parsePropertiesFrom(i)),r}return function(t,e){function i(){this.constructor=t}g(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}(e,t),e.prototype.parseKey=function(t){try{var e=0,i=0,r=/^\s*(?:[0-9A-Fa-f][0-9A-Fa-f]\s*)+$/.test(t)?v(t):m.unarmor(t),n=x.decode(r);if(3===n.sub.length&&(n=n.sub[2].sub[0]),9===n.sub.length){e=n.sub[1].getHexStringValue(),this.n=q(e,16),i=n.sub[2].getHexStringValue(),this.e=parseInt(i,16);var s=n.sub[3].getHexStringValue();this.d=q(s,16);var o=n.sub[4].getHexStringValue();this.p=q(o,16);var h=n.sub[5].getHexStringValue();this.q=q(h,16);var a=n.sub[6].getHexStringValue();this.dmp1=q(a,16);var u=n.sub[7].getHexStringValue();this.dmq1=q(u,16);var c=n.sub[8].getHexStringValue();this.coeff=q(c,16)}else{if(2!==n.sub.length)return!1;var f=n.sub[1].sub[0];e=f.sub[0].getHexStringValue(),this.n=q(e,16),i=f.sub[1].getHexStringValue(),this.e=parseInt(i,16)}return!0}catch(t){return!1}},e.prototype.getPrivateBaseKey=function(){var t={array:[new et.asn1.DERInteger({"int":0}),new et.asn1.DERInteger({bigint:this.n}),new et.asn1.DERInteger({"int":this.e}),new et.asn1.DERInteger({bigint:this.d}),new et.asn1.DERInteger({bigint:this.p}),new et.asn1.DERInteger({bigint:this.q}),new et.asn1.DERInteger({bigint:this.dmp1}),new et.asn1.DERInteger({bigint:this.dmq1}),new et.asn1.DERInteger({bigint:this.coeff})]};return new et.asn1.DERSequence(t).getEncodedHex()},e.prototype.getPrivateBaseKeyB64=function(){return f(this.getPrivateBaseKey())},e.prototype.getPublicBaseKey=function(){var t=new et.asn1.DERSequence({array:[new et.asn1.DERObjectIdentifier({oid:"1.2.840.113549.1.1.1"}),new et.asn1.DERNull]}),e=new et.asn1.DERSequence({array:[new et.asn1.DERInteger({bigint:this.n}),new et.asn1.DERInteger({"int":this.e})]}),i=new et.asn1.DERBitString({hex:"00"+e.getEncodedHex()});return new et.asn1.DERSequence({array:[t,i]}).getEncodedHex()},e.prototype.getPublicBaseKeyB64=function(){return f(this.getPublicBaseKey())},e.wordwrap=function(t,e){if(!t)return t;var i="(.{1,"+(e=e||64)+"})( +|$\n?)|(.{1,"+e+"})";return t.match(RegExp(i,"g")).join("\n")},e.prototype.getPrivateKey=function(){var t="-----BEGIN RSA PRIVATE KEY-----\n";return t+=e.wordwrap(this.getPrivateBaseKeyB64())+"\n",t+="-----END RSA PRIVATE KEY-----"},e.prototype.getPublicKey=function(){var t="-----BEGIN PUBLIC KEY-----\n";return t+=e.wordwrap(this.getPublicBaseKeyB64())+"\n",t+="-----END PUBLIC KEY-----"},e.hasPublicKeyProperty=function(t){return(t=t||{}).hasOwnProperty("n")&&t.hasOwnProperty("e")},e.hasPrivateKeyProperty=function(t){return(t=t||{}).hasOwnProperty("n")&&t.hasOwnProperty("e")&&t.hasOwnProperty("d")&&t.hasOwnProperty("p")&&t.hasOwnProperty("q")&&t.hasOwnProperty("dmp1")&&t.hasOwnProperty("dmq1")&&t.hasOwnProperty("coeff")},e.prototype.parsePropertiesFrom=function(t){this.n=t.n,this.e=t.e,t.hasOwnProperty("d")&&(this.d=t.d,this.p=t.p,this.q=t.q,this.dmp1=t.dmp1,this.dmq1=t.dmq1,this.coeff=t.coeff)},e}(Q),rt=function(){function t(t){t=t||{},this.default_key_size=parseInt(t.default_key_size,10)||1024,this.default_public_exponent=t.default_public_exponent||"010001",this.log=t.log||!1,this.key=null}return t.prototype.setKey=function(t){this.key=new it(t)},t.prototype.setPrivateKey=function(t){this.setKey(t)},t.prototype.setPublicKey=function(t){this.setKey(t)},t.prototype.decrypt=function(t){try{return this.getKey().decrypt(l(t))}catch(t){return!1}},t.prototype.encrypt=function(t){try{return f(this.getKey().encrypt(t))}catch(t){return!1}},t.prototype.sign=function(t,e,i){try{return f(this.getKey().sign(t,e,i))}catch(t){return!1}},t.prototype.verify=function(t,e,i){try{return this.getKey().verify(t,l(e),i)}catch(t){return!1}},t.prototype.getKey=function(t){if(!this.key){if(this.key=new it,t&&"[object Function]"==={}.toString.call(t))return void this.key.generateAsync(this.default_key_size,this.default_public_exponent,t);this.key.generate(this.default_key_size,this.default_public_exponent)}return this.key},t.prototype.getPrivateKey=function(){return this.getKey().getPrivateKey()},t.prototype.getPrivateKeyB64=function(){return this.getKey().getPrivateBaseKeyB64()},t.prototype.getPublicKey=function(){return this.getKey().getPublicKey()},t.prototype.getPublicKeyB64=function(){return this.getKey().getPublicBaseKeyB64()},t.version="3.0.0-rc.1",t}();window.JSEncrypt=rt,t.JSEncrypt=rt,t["default"]=rt,Object.defineProperty(t,"__esModule",{value:!0})}),function(angular){"use strict";function expandableContent($window,analyticsUtils){return{link:function(scope,element,attributes){var articleContainer=element[0];articleContainer.setAttribute("ng-attr-data-expanded",!1),scope.showFullContent=function(event){articleContainer.setAttribute("ng-attr-data-expanded",!0),event.target.setAttribute("aria-expanded",!0),scope.$broadcast("expandableContentRevealed")},scope.onButtonBlur=function(event){var expanded="true"===articleContainer.getAttribute("ng-attr-data-expanded");expanded&&(event.target.style.display="none")}}}}expandableContent.$inject=["$window","analyticsUtils"],angular.module("marketingCore").directive("expandableContent",expandableContent)}(angular),function(angular){"use strict";function creditCardUtilConstructor(coreServices,$log){function _structureCreditCheckRequestBody(checkOutInfo){var body,dob,expiryYear,newvalue;return newvalue="20",expiryYear=newvalue.concat(checkOutInfo.creditcheck.expiryDate.substring(2,4)),dob=checkOutInfo.creditcheck.dob,body={bday:dob.substring(0,2)+"/"+dob.substring(2,4)+"/"+dob.substring(4),"expiry-date":checkOutInfo.creditcheck.expiryDate.substring(0,2)+"/"+expiryYear,"id-type":checkOutInfo.creditcheck.idType.idTypeName,"id-value":checkOutInfo.creditcheck.idNumber,region:checkOutInfo.creditcheck.state,"social-security-number":checkOutInfo.creditcheck.ssn},angular.equals(checkOutInfo.personalInfo.creditClass,"NONE")&&(body["social-security-number"]="11111"+checkOutInfo.creditcheck.ssn),body}function _structureCreditCardRequestBody(checkOutInfo){var body;return body={"name-on-card":checkOutInfo.cardInfo.nameoncard,"card-number":checkOutInfo.cardInfo.creditCardNumber,"card-type":checkOutInfo.cardInfo.crType,cvv:checkOutInfo.cardInfo.securityCode,"expiry-month":checkOutInfo.cardInfo.expMonth,"expiry-year":checkOutInfo.cardInfo.expYear}}function postCheckOutDataResponseHandler(response){var status;return angular.isDefined(response.statusText)&&(angular.equals("Created",response.statusText)||angular.equals("OK",response.statusText))?status="done":(status="failed",$log.log("creditCardUtil.setCreditCheckInfo:: response ",response)),status}function errorHandler(error){return $log.log("Something went wrong:",error),error}function setCreditCheckInfo(checkOutInfo){var body,apiUrl,accessId,cartData;return cartData=coreServices.cartStorage.getGlobalSmartCartInfo(),accessId=cartData.orderId,apiUrl=coreServices.apiURLs.creditcheckUrl+accessId,body=_structureCreditCheckRequestBody(checkOutInfo),coreServices.httpRequestWrapper.post(apiUrl,body,null,null,!0).then(postCheckOutDataResponseHandler)["catch"](errorHandler)}function setCreditCardInfo(checkOutInfo){var cartData,accessId,creditcardUrl,body;return cartData=coreServices.cartStorage.getGlobalSmartCartInfo(),accessId=cartData.orderId,creditcardUrl=coreServices.apiURLs.creditcardUrl+accessId,body=_structureCreditCardRequestBody(checkOutInfo),coreServices.httpRequestWrapper.post(creditcardUrl,body,null,null,!0)}return{setCreditCheckInfo:setCreditCheckInfo,setCreditCardInfo:setCreditCardInfo}}creditCardUtilConstructor.$inject=["coreServices","$log"],angular.module("tmobileApp").factory("creditCardUtil",creditCardUtilConstructor)}(window.angular),function(angular){"use strict";function extVideo($window,$document,$location,$timeout,utils,scene7,analyticsUtils){return{restrict:"A",link:function(scope,element,attr){function playVideo(videoId,s7config){if(currentVideo=videoId,s7config){var config=s7config;contentWrap.css({visibility:"hidden"}),vidWrap.hide(),bcVideoContainer=element.find(".video-js"),bcVideoContainer.hide(),vidOverlay.css({visibility:"visible",display:"flex"}),scrollTo(0,vidOverlay[0].getBoundingClientRect().top+window.pageYOffset-62),vidClose.focus(),angular.element($window).on("scroll.resetVideo",onScroll_window),scene7.foregroundVid(attr.moduleId,videoId,config,onDynamicMediaPlayerInit,onDynamicMediaPlayerTrackEvent)}else utils.loadScript("//players.brightcove.net/1403111602001/ryrlK9I1e_default/index.min.js",onSuccess)}function playBrightCove(){player.catalog.getVideo(videoId,function(error,video){player.catalog.load(video),videoName=player.mediainfo.name,player.play(),contentWrap.css({visibility:"hidden"}),vidWrap.hide(),vidOverlay.css({visibility:"visible",display:"flex"}),scrollTo(0,vidOverlay[0].getBoundingClientRect().top+window.pageYOffset-62),vidClose.focus(),angular.element($window).on("scroll.resetVideo",onScroll_window)})}function resetVideo(scroll){var isScroll=scroll;s7Player?(angular.element($window).off("scroll.resetVideo"),s7Player.dispose(),vidOverlay.css({visibility:"hidden",display:"none"}),endScreen.removeClass("active"),vidWrap.show(),contentWrap.css({visibility:"visible"}),bcVideoContainer.show(),isCarousel||isScroll||element[0].querySelector('[data-action="play-video"][data-video-id="'+currentVideo+'"]').focus()):(angular.element($window).off("scroll.resetVideo"),player.pause(),player.isFullscreen()&&player.exitFullscreen(),vidOverlay.css({visibility:"hidden",display:"none"}),endScreen.removeClass("active"),vidWrap.show(),contentWrap.css({visibility:"visible"}),isCarousel||isScroll||element[0].querySelector('[data-action="play-video"][data-video-id="'+currentVideo+'"]').focus())}function setPlacementId(){for(var moduleList=window.marketingDigitalData&&window.marketingDigitalData.page&&window.marketingDigitalData.page.modules&&window.marketingDigitalData.page.modules.moduleList?window.marketingDigitalData.page.modules.moduleList:[],i=0;i<moduleList.length;i++)if(moduleList[i].ID===analyticsId){placementId=moduleList[i].placementID;break}}function onSuccess(){window.videojs("video-"+attr.moduleId).ready(onReady_video)}function onReady_video(){player=this,player.on("play",function(){duration=this.duration(),scrollPrompt.length&&(angular.element("body").addClass("video-play"),scrollPrompt.hide()),"Android"===utils.getOS()&&angular.element("html, body").animate({scrollTop:vidOverlay.offset().top},100),analyticsUtils.trackVideoPlay(videoName,moduleName,placementId)}),player.on("pause",function(){scrollPrompt.length&&(angular.element("body").removeClass("video-play"),scrollPrompt.show()),analyticsUtils.trackVideoPause(videoName,moduleName,placementId)}),player.on("seeked",function(){analyticsUtils.trackVideoSeeked(videoName,moduleName,placementId)}),player.on("ended",function(){isVideoCarousel?videoEndScreen():resetVideo(),analyticsUtils.trackVideoEnded(videoName,moduleName,placementId)}),player.on("timeupdate",function(){duration=duration?duration:this.duration(),this.currentTime()/duration>=.75&&this.currentTime()/duration<1&&"75%"!==milestone?(milestone="75%",analyticsUtils.trackVideoTimeUpdate(videoName,moduleName,placementId,milestone)):this.currentTime()/duration>=.5&&this.currentTime()/duration<.75&&"50%"!==milestone?(milestone="50%",analyticsUtils.trackVideoTimeUpdate(videoName,moduleName,placementId,milestone)):this.currentTime()/duration>=.25&&this.currentTime()/duration<.5&&"25%"!==milestone&&(milestone="25%",analyticsUtils.trackVideoTimeUpdate(videoName,moduleName,placementId,milestone))}),playBrightCove()}function onScroll_window(){$document.fullscreenElement||$document.webkitFullscreenElement||$document.mozFullScreenElement||$document.msFullscreenElement||(angular.element($window).scrollTop()>element.offset().top+element.innerHeight()&&resetVideo(!0),angular.element($window).scrollTop()<element.offset().top-element.innerHeight()&&resetVideo(!0))}function onClick_play(e){var playButton=angular.element(e.currentTarget);videoId=playButton.attr("data-video-id"),analyticsId=playButton.closest("section").attr("data-analytics-id"),moduleName=playButton.closest("section").find("h3").text();var s7config;setPlacementId();var val=angular.element(e.currentTarget).attr("data-video-id"),matches=val.match(/\//);null!==matches&&(s7config=angular.fromJson(playButton.attr("data-foreground-video-config"))),playVideo(videoId,s7config)}function onClick_close(e){e.preventDefault(),resetVideo()}function videoEndScreen(){endScreen.addClass("active");var fbLink=element.find('.utility[data-video-id="'+currentVideo+'"] .facebook').attr("href"),twtLink=element.find('.utility[data-video-id="'+currentVideo+'"] .twitter').attr("href"),fbAnalytics=element.find('.utility[data-video-id="'+currentVideo+'"] .facebook').attr("data-analytics-id"),twtAnalytics=element.find('.utility[data-video-id="'+currentVideo+'"] .twitter').attr("data-analytics-id");element.find(".end-screen .sharing .facebook").attr("href",fbLink).attr("data-analytics-id",fbAnalytics),element.find(".end-screen .sharing .twitter").attr("href",twtLink).attr("data-analytics-id",twtAnalytics),element.find(".end-screen .all-videos").attr("data-analytics-id",element.attr("data-analytics-id")+"-"+currentVideo+"-videoNext"),element.find(".end-screen .next-video").attr("data-analytics-id",element.attr("data-analytics-id")+"-"+currentVideo+"-videoAll")}function nextVideo(){current=videos.indexOf(currentVideo);var matches=videos[current].match(/\//);null!==matches&&s7Player.dispose(),-1===current&&(current=0);var next=videos[current+1];void 0===next&&(next=videos[0]),currentVideo=next;var s7config,nextMatches=next.match(/\//);null!==nextMatches?(s7config=angular.fromJson(angular.element('[data-video-id="'+next+'"]').attr("data-foreground-video-config")),endScreen.removeClass("active"),playVideo(next,s7config)):(endScreen.removeClass("active"),player.catalog.getVideo(next,function(error,next){player.catalog.load(next),player.play()}))}function cleanup(){angular.element($window).off("scroll.resetVideo",onScroll_window),vidClose.off("click",onClick_close)}if(!element.find('[data-action="play-video"][data-video-id]').length)return!1;var player,videoId,s7Player,analyticsId,moduleName,placementId,videoName,duration,milestone,vidWrap=element.find(".vid-wrap:not(.vid-overlay):first"),bcVideoContainer=element.find("video.video-js"),vidOverlay=element.find(".vid-wrap.vid-overlay:first"),contentWrap=element.find(".card-slick-carousel, .offers-slick-carousel, .product-slick-carousel, .content-slick-carousel"),isVideoCarousel=element.find(".video-slick-carousel"),endScreen=element.find(".end-screen"),vidClose=element.find("button.close:first"),playButton=element.find('[data-action="play-video"]'),scrollPrompt=angular.element(".scroll-prompt"),onDynamicMediaPlayerInit=function(viewer){s7Player=viewer,setPlacementId()},onDynamicMediaPlayerTrackEvent=function(objID,compClass,instName,timeStamp,eventInfo){if(eventInfo){var eventInfo=eventInfo.split(","),eventName=eventInfo[0];switch(eventName){case"LOAD":var videoPath=eventInfo[6];videoPath&&videoPath.length>0&&(videoName=decodeURIComponent(videoPath));break;case"METADATA":var metadataName=eventInfo[1],metadataValue=eventInfo[2];switch(metadataName){case"DURATION":duration=Math.floor(metadataValue/1e3);break;case"SEEK":analyticsUtils.trackVideoSeeked(videoName,moduleName,placementId)}break;case"MILESTONE":var milestone=eventInfo[1]+"%";("25%"===milestone||"50%"===milestone||"75%"===milestone)&&analyticsUtils.trackVideoTimeUpdate(videoName,moduleName,placementId,milestone);break;case"PAUSE":analyticsUtils.trackVideoPause(videoName,moduleName,placementId);break;case"PLAY":analyticsUtils.trackVideoPlay(videoName,moduleName,placementId);break;case"STOP":analyticsUtils.trackVideoEnded(videoName,moduleName,placementId),videoEndScreen()}}};playButton.on("click",onClick_play),playButton.on("keydown",function(e){13===e.which&&playButton.click()}),vidClose.on("click",onClick_close),$timeout(function(){if($location.search().section===attr.moduleId&&$location.search().vid){var s7config,playButton=element.find('[data-action="play-video"][data-video-id="'+$location.search().vid+'"]'),videoId=$location.search().vid,matches=videoId.match(/\//);analyticsId=playButton.closest("section").attr("data-analytics-id"),moduleName=playButton.closest("section").find("h3").text(),setPlacementId(),null!==matches?(s7config=angular.fromJson(playButton.attr("data-foreground-video-config")),playVideo(videoId,s7config)):playButton.click()}},0);var sectionID,currentVideo,allVidBtn,nextVidBtn,url,videos,isVideoCarousel=element[0].querySelector(".video-slick-carousel"),isCarousel=element[0].querySelector('[class*="carousel"]');isVideoCarousel&&(videos=scope.videos.ids,sectionID=element.data("module-id"),allVidBtn=element.find(".end-screen button.all-videos"),nextVidBtn=element.find(".end-screen button.next-video"),url=window.location.href,allVidBtn.on("click",onClick_close),nextVidBtn.on("click",nextVideo));var current;scope.$on("$destroy",cleanup)}}}extVideo.$inject=["$window","$document","$location","$timeout","utils","scene7","analyticsUtils"],angular.module("marketingCore").directive("extVideo",extVideo)}(angular),function(angular,lodash){"use strict";function checkOutHttpDataUtilConstructor(coreServices,commonServices,checkOutModelService,CartUtils,authTokenManager,apiService,httpRequestWrapper,creditClassService,transformCart,cartStorage,commonUtils,checkOutConstants,globalValue,globalConfig,dataFactory,cartHttpDataService,cartConstants){function getProfileInfo(cartId){var ProfileUrl=coreServices.apiURLs.getProfile;return ProfileUrl=ProfileUrl+"/"+cartId,httpRequestWrapper.get(ProfileUrl,null,null,!0)}function errorHandler(error){return $log.log("Something went wrong ",error),error.status="failed",error}function loadCheckOutData(options){var query,apiURL,cartId,checkOutPromise,auditPromise,apiKey,ignoreLoadingBar=options&&!options.ignoreLoadingBar?options.ignoreLoadingBar:!0;if(cartId=coreServices.cartStorage.getCartId(),!creditClassService.getEPCreditClass()&&cartId)return getProfileInfo(cartId).then(function(profileData){var creditSelector=globalValue.authorValue.rootPage.creditClassSelector["class"],epToAppMapping=globalConfig.cartSettings.epToAppMapping,creditClass=epToAppMapping[commonUtils.searchJson(profileData.data,"creditLevel")],creditClassObject=_.find(creditSelector,{"class":creditClass});creditClassService.setCreditClass(creditClassObject);var urlObject=apiService.getURL("getFullCheckout");return apiURL=urlObject.url,apiURL=apiURL.replace("{{cartID}}",cartId),query=3===urlObject.version?{ignoreLoadingBar:ignoreLoadingBar}:{creditLevel:creditClassService.getEPCreditClass()||"GOOD",ignoreLoadingBar:ignoreLoadingBar},checkOutPromise=httpRequestWrapper.get(apiURL,query,null,!0,"getFullCheckout"),auditPromise=getAutoPayState(),apiKey="getFullCheckout",$q.all([checkOutPromise,auditPromise]).then(function(arrayOfResults){var defaultCartResponse=arrayOfResults[0];return defaultCartResponse.data.auditRecords=arrayOfResults[1].data.auditRecords,coreServices.cartStorage.setAuditRecords(arrayOfResults[1].data.auditRecords),handleLoadCheckOutDataResponse(defaultCartResponse,cartId,apiKey)})["catch"](errorHandler)});if(cartId){var urlObject=apiService.getURL("getFullCheckout");apiURL=urlObject.url,apiURL=apiURL.replace("{{cartID}}",cartId),query=3===urlObject.version?{ignoreLoadingBar:ignoreLoadingBar}:{creditLevel:"GOOD",ignoreLoadingBar:ignoreLoadingBar},checkOutPromise=httpRequestWrapper.get(apiURL,query,null,!0,"getFullCheckout"),apiKey="getFullCheckout",auditPromise=getAutoPayState()}else{var urlObjectCart=apiService.getURL("getDefaultCart");apiURL=urlObjectCart.url,query=3===urlObjectCart.version?{ignoreLoadingBar:ignoreLoadingBar}:{creditLevel:"GOOD",ignoreLoadingBar:ignoreLoadingBar},checkOutPromise=httpRequestWrapper.get(apiURL,query,null,!0),apiKey="getDefaultCart"}return $q.all([checkOutPromise,auditPromise]).then(function(arrayOfResults){var defaultCartResponse=arrayOfResults[0];return cartId&&(defaultCartResponse.data.auditRecords=arrayOfResults[1].data.auditRecords,coreServices.cartStorage.setAuditRecords(arrayOfResults[1].data.auditRecords)),handleLoadCheckOutDataResponse(defaultCartResponse,cartId,apiKey)})["catch"](errorHandler)}function createAuditRecords(userPreferredLanguage,storePayment,fbId,psId,abCartURL,scCartURL,emptyCart){var inputData,apiUrl,urlObject=apiService.getURL("createAuditRecordsUrl");apiUrl=urlObject.url;var headers={};headers.follow="TRUE";var cartId=coreServices.cartStorage.getCartId();apiUrl=apiUrl.replace("{{cartID}}",cartId);var timestamp=new Date;return 2===urlObject.version||3===urlObject.version?(_.isBoolean(userPreferredLanguage)?(inputData={auditRecords:[{auditKey:"AUTO_PAY",auditValue:userPreferredLanguage}]},inputData.auditRecords.push({auditKey:"STORE_PAYMENT",auditValue:storePayment})):(inputData={auditRecords:[{auditTime:timestamp,auditKey:"KEY_LANGUAGE_PREFERENCE",auditValue:userPreferredLanguage}]},fbId&&inputData.auditRecords.push({auditKey:"FB_ID",auditValue:fbId}),psId&&inputData.auditRecords.push({auditKey:"PS_ID",auditValue:psId})),abCartURL&&inputData.auditRecords.push({auditKey:"ABANDON_CART_URL",auditValue:abCartURL}),scCartURL&&inputData.auditRecords.push({auditKey:"SAVE_CART_URL",auditValue:scCartURL}),emptyCart&&(inputData.auditRecords.push({auditKey:"applicationid",auditValue:"TMO"}),inputData.auditRecords.push({auditKey:"channelid",auditValue:"WEB"}),inputData.auditRecords.push({auditKey:"clientid",auditValue:"TMNG"}))):(_.isBoolean(userPreferredLanguage)?(inputData={"audit-records":[{"audit-key":"AUTO_PAY","audit-value":userPreferredLanguage}]},inputData["audit-records"].push({"audit-key":"STORE_PAYMENT","audit-value":storePayment})):(inputData={"audit-records":[{"audit-time":timestamp,"audit-key":"KEY_LANGUAGE_PREFERENCE","audit-value":userPreferredLanguage}]},fbId&&inputData["audit-records"].push({"audit-key":"FB_ID","audit-value":fbId}),psId&&inputData["audit-records"].push({"audit-key":"PS_ID","audit-value":psId})),abCartURL&&inputData["audit-records"].push({"audit-key":"ABANDON_CART_URL","audit-value":abCartURL}),scCartURL&&inputData["audit-records"].push({"audit-key":"SAVE_CART_URL","audit-value":scCartURL}),emptyCart&&(inputData["audit-records"].push({"audit-key":"applicationid","audit-value":"TMO"}),inputData["audit-records"].push({"audit-key":"channelid","audit-value":"WEB"}),inputData["audit-records"].push({"audit-key":"clientid","audit-value":"TMNG"}))),cartId?2===urlObject.version||3===urlObject.version?coreServices.httpRequestWrapper.post(apiUrl,inputData,null,headers,!0,"createAuditRecordsUrl"):coreServices.httpRequestWrapper.post(apiUrl,inputData,null,null,!0):void 0}function getAutoPayState(){var urlObject=apiService.getURL("createAuditRecordsUrl"),apiUrl=urlObject.url,cartId=coreServices.cartStorage.getCartId();return cartId?(apiUrl=apiUrl.replace("{{cartID}}",cartId),coreServices.httpRequestWrapper.get(apiUrl,null,null,!0,"createAuditRecordsUrl")):void 0}function handleLoadCheckOutDataResponse(defaultCartResponse,cartId,apiKey){var errorCheck=CartUtils.checkError(defaultCartResponse);if(errorCheck)return errorCheck;if(angular.equals(defaultCartResponse.status,200)){var transformCartFactory=transformCart.getFactory(apiKey),checkOutData=transformCartFactory.transformCheckOutData(defaultCartResponse.data);if(!cartId){var authToken=authTokenManager.getTokenCookies("token",angular.equals(coreServices.apiURLs.storage,"localStorage")),abandonCartURL=location.origin+"/cart/AB?key="+authToken.access_token+"&id="+checkOutData.reviewCart.cartId;coreServices.cartStorage.setCartId(checkOutData.reviewCart.cartId),coreServices.cartStorage.setOrderId(checkOutData.reviewCart.orderId),coreServices.cartStorage.setAbandonCartURL(abandonCartURL)}return checkOutData&&angular.isUndefined(checkOutData.flags.isActualAutoPay)&&createAuditRecords(!0,!0,!1,!1,!1,!1,!0).then(function(){checkOutData.flags.isActualAutoPay=!0,checkOutData.flags.isActualStorePayment=!0,checkOutData.flags.isAutoPay=!0,checkOutData.flags.isStorePayment=!0}),checkOutData}return checkOutConstants.FAILEDSTATUS}function updateProfileInfo(){var urlObject=apiService.getURL("updateProfile"),apiUrl=urlObject.url,header={},profileId=coreServices.cartStorage.getProfileId();apiUrl=apiUrl.replace("{{profileID}}",profileId),header.follow="true";var body={firstName:checkOutModelService.model.checkOutInfo.personalInfo.firstName,middleName:checkOutModelService.model.checkOutInfo.personalInfo.middleName,lastName:checkOutModelService.model.checkOutInfo.personalInfo.lastName,orderId:"",dateAndTime:checkOutModelService.model.checkOutInfo.personalInfo.dateAndTime,phoneNo:checkOutModelService.model.checkOutInfo.personalInfo.phoneNumber,emailId:checkOutModelService.model.checkOutInfo.personalInfo.email,creditLevel:checkOutModelService.model.checkOutInfo.personalInfo.creditClass||"GOOD",contactConsentVersionId:checkOutModelService.model.checkOutInfo.personalInfo.versionId,pin:checkOutModelService.model.checkOutInfo.creditcheck.portOutPinCode};return httpRequestWrapper.put(apiUrl,body,null,header,"updateProfile","updateProfile")}function loadTPPCheckOutData(options){var checkoutApiURL,profileApiURL,cartId,checkoutApiKey,profileApiKey,apiKey,apiURL,checkoutUrlObject,profileUrlObject,checkOutPromise,profilePromise,headers={follow:"true"},ignoreLoadingBar=options&&!options.ignoreLoadingBar?options.ignoreLoadingBar:!0,query={ignoreLoadingBar:ignoreLoadingBar};if(cartId=coreServices.cartStorage.getCartId()){checkoutApiKey="getFullCheckout",checkoutUrlObject=apiService.getURL(checkoutApiKey),checkoutApiURL=checkoutUrlObject.url,checkoutApiURL=checkoutApiURL.replace("{{cartID}}",cartId);var profileId=cartStorage.getProfileId();return profileApiKey=profileId?"updateProfile":"getProfileId",profileUrlObject=apiService.getURL(profileApiKey),profileApiURL=profileId?profileUrlObject.url.replace("{{profileID}}",profileId):profileUrlObject.url,checkOutPromise=httpRequestWrapper.get(checkoutApiURL,query,headers,!0,checkoutApiKey),profilePromise=httpRequestWrapper.get(profileApiURL,query,headers,!0,profileApiKey),$q.all([profilePromise,checkOutPromise]).then(function(arrayOfResults){return prePopulatePersonalInfo(arrayOfResults[0]),handleLoadTPPCartDataResponse(arrayOfResults[1],cartId,checkoutApiKey,!0)})["catch"](errorHandler)}apiKey="getDefaultCart";var urlObjectCart=apiService.getURL(apiKey);return apiURL=urlObjectCart.url,httpRequestWrapper.get(apiURL,query,headers,!0,apiKey).then(function(response){return handleLoadTPPCartDataResponse(response,cartId,apiKey,!1)})["catch"](errorHandler)}function loadFullCheckOutData(){var apiKey="getFullCheckout",headers={follow:"true"},cartId=coreServices.cartStorage.getCartId(),apiUrl=apiService.getURL("getFullCheckout").url;return apiUrl=apiUrl.replace("{{cartID}}",cartId),cartId?httpRequestWrapper.get(apiUrl,null,headers,!0,apiKey).then(function(response){return handleLoadTPPCartDataResponse(response,cartId,apiKey,!0)})["catch"](errorHandler):void 0}function prePopulatePersonalInfo(profileResponse){angular.equals(profileResponse.status,200)?setPersonalInfoIntoCache(profileResponse.data):$log.log("Something went wrong in getProfile")}function handleLoadTPPCartDataResponse(cartResponse,cartId,apiKey,isCheckoutPage){var cartData,errorCheck=CartUtils.checkError(cartResponse);if(errorCheck)return errorCheck;if(angular.equals(cartResponse.status,200)){var transformCartFactory=transformCart.getFactory(apiKey);return cartData=isCheckoutPage?transformCartFactory.transformTPPCheckoutData(cartResponse.data):transformCartFactory.transformCartData(cartResponse.data),cartData&&((angular.isUndefined(cartId)||lodash.isEmpty(cartId))&&(cartStorage.setCartId(cartData.cartId),cartStorage.setOrderId(cartData.orderId)),cartData.flags.isAutoPayOn||createAuditRecords(!0,!0,!1,!1,!1,!1,!0).then(function(){cartData.flags.isActualAutoPay=!0,cartData.flags.isActualStorePayment=!0,cartData.flags.isAutoPay=!0,cartData.flags.isStorePayment=!0})),cartData.reviewCart=angular.copy(cartData),cartData}return checkOutConstants.FAILEDSTATUS}function loadCheckOutHandOffData(cartId,options){var checkoutApiURL,profileApiURL,checkoutApiKey,profileApiKey,checkoutUrlObject,profileUrlObject,checkOutPromise,profilePromise,headers={follow:"true"},ignoreLoadingBar=options&&!options.ignoreLoadingBar?options.ignoreLoadingBar:!0,query={ignoreLoadingBar:ignoreLoadingBar};checkoutApiKey="getFullCheckout",checkoutUrlObject=apiService.getURL(checkoutApiKey),checkoutApiURL=checkoutUrlObject.url.replace("{{cartID}}",cartId);var profileId=cartStorage.getProfileId();return profileApiKey="updateProfile",profileUrlObject=apiService.getURL(profileApiKey),profileApiURL=profileUrlObject.url.replace("{{profileID}}",profileId),checkOutPromise=httpRequestWrapper.get(checkoutApiURL,query,headers,!0,checkoutApiKey),profilePromise=httpRequestWrapper.get(profileApiURL,query,headers,!0,profileApiKey),$q.all([profilePromise,checkOutPromise]).then(function(arrayOfResults){
return prePopulatePersonalInfo(arrayOfResults[0]),handleCheckoutHandOffResponse(arrayOfResults[1],checkoutApiKey)})["catch"](function(error){$log.log("Something went wrong ",error)})}function validateCartResponse(cartData){var flag=!0;return cartData.lineItems[0]&&cartStorage.getSelectedPlanType()?angular.forEach(cartData.lineItems,function(lineItem){lineItem.simKitDetails.isBYODAdded||angular.isDefined(lineItem.lineItemDetails.deviceDetails.id)&&angular.isDefined(lineItem.lineItemDetails.planDetails.id)?!lineItem.simKitDetails.isBYODAdded||angular.isDefined(lineItem.lineItemDetails.planDetails.id)&&angular.isDefined(lineItem.simKitDetails.simKitId)||(flag=!1):flag=!1}):flag=cartData.accessories.accessoryDetails[0]?!0:!1,flag}function handleCheckoutHandOffResponse(cartResponse,apiKey){var cartTransformData,errorCheck=CartUtils.checkError(cartResponse);if(!errorCheck&&angular.equals(cartResponse.status,200)){var transformCartFactory=transformCart.getFactory(apiKey);if(cartTransformData=transformCartFactory.transformTPPCheckoutData(cartResponse.data),cartTransformData&&validateCartResponse(cartTransformData))return cartStorage.setOrderId(cartTransformData.orderId),cartTransformData.reviewCart=angular.copy(cartTransformData),cartTransformData}}function redirectToUnoCart(){var urlObject=apiService.getURL("unoCart");urlObject&&urlObject.url?commonServices.$window.location.href=urlObject.url:commonServices.$window.location.href="/cart"}function createCreditProfileIdBody(){var createCreditProfileBody={};return createCreditProfileBody.creditClass=angular.isDefined(cartStorage.getPriceIndicator())?cartStorage.getPriceIndicator():"A",createCreditProfileBody}function handleEmptyCartFlow(oAuthStatus){var cartId,defPromise=$q.defer();return angular.isUndefined(oAuthStatus)||angular.equals(oAuthStatus,checkOutConstants.DONESTATUS)?lodash.get(toggleService.model,"toggles.isV2Disabled",!1)?cartHttpDataService.getDefaultCart().then(function(response){return handleLoadTPPCartDataResponse(response,cartId,"getDefaultCart",!1)})["catch"](errorHandler):cartHttpDataService.getProfileId().then(function(profileId){return cartHttpDataService.getDefaultCart().then(function(response){return handleLoadTPPCartDataResponse(response,cartId,"getDefaultCart",!1)})["catch"](errorHandler)})["catch"](errorHandler):defPromise.promise}function getQuotesData(){cartHttpDataService.getQuotes().then(function(quotesResponse){if(angular.equals(quotesResponse.status,200)){var apiKey="getQuotes",transformCartFactory=transformCart.getFactory(apiKey);return transformCartFactory.transformQuotesData(quotesResponse.data)}})["catch"](errorHandler)}function setPersonalInfoIntoCache(profileData){var dataCache=dataFactory.getCacheObject(checkOutConstants.CACHE.NAME),dataObject={};dataObject.personalInfo={firstName:lodash.get(profileData.profile,"firstName"),middleName:lodash.get(profileData.profile,"middleName"),lastName:lodash.get(profileData.profile,"lastName"),phoneNumber:lodash.get(profileData.profile,"phoneNumber"),email:lodash.get(profileData.profile,"emailId"),contactConsentVersionId:lodash.get(profileData.profile,"versionId")},dataCache.put(checkOutConstants.CACHE.PERSONAL_INFO_KEY,dataObject)}function loadTPPCartData(oAuthStatus){var scc=cartStorage.getSoftCreditCheck(),hcc=cartStorage.getHardCreditCheck(),cartId=cartStorage.getCartId();return cartId?cartStorage.getCreditProfileId()&&angular.equals(scc,cartConstants.OTHERS.TRUE)&&angular.equals(hcc,cartConstants.OTHERS.TRUE)?getFullCartPromise(cartId):cartHttpDataService.getProfileId().then(function(profileId){return getFullCartPromise(cartId)})["catch"](errorHandler):handleEmptyCartFlow(oAuthStatus)}function updateCartPromise(profileId){var promise,cartId=cartStorage.getCartId(),creditprofileId=cartStorage.getCreditProfileId(),body=createCreditProfileIdBody();return cartId?promise=creditprofileId?cartHttpDataService.updateCreditProfileV3(body,profileId,creditprofileId).then(function(response){(angular.equals(response.status,204)||angular.equals(response.status,200))&&cartStorage.setPriceIndicator(body.creditClass)})["catch"](errorHandler):cartHttpDataService.createCreditProfileV3(profileId,body).then(function(response){angular.equals(response.status,200)&&angular.isDefined(response.data.creditProfile.creditClass)&&(cartStorage.setPriceIndicator(response.data.creditProfile.creditClass),cartStorage.setCreditProfileId(response.data.creditProfile.creditProfileId))})["catch"](errorHandler):Promise.reject({error:checkOutConstants.FAILEDSTATUS})}function getFullCartPromise(cartId){return cartHttpDataService.getFullCart().then(function(cartResponse){return angular.equals(cartResponse.status,200)?handleLoadTPPCartDataResponse(cartResponse,cartId,"getFullCart",!1):void 0})["catch"](errorHandler)}function cancelOrder(){return $q(lodash.get(toggleService.model,"toggles.deleteCartSequentialFlow",!0)?function(resolve,reject){cartStorage.getCartId()&&cartStorage.getProfileId()&&cartStorage.getCreditProfileId()?cartHttpDataService.deleteCart(cartStorage.getCartId()).then(function(){cartHttpDataService.deleteCreditProfile(cartStorage.getProfileId(),cartStorage.getCreditProfileId()).then(function(){cartStorage.removeSoftCreditCheck(),cartStorage.removeHardCreditCheck(),cartStorage.removeCartId(),cartStorage.removeCreditProfileId(),cartStorage.removOrderId();var createCreditProfileBody={};createCreditProfileBody.creditClass="A",cartHttpDataService.createCreditProfileV3(cartStorage.getProfileId(),createCreditProfileBody).then(function(response){lodash.get(response,"data.creditProfile.creditProfileId")?(cartStorage.setCreditProfileId(response.data.creditProfile.creditProfileId),resolve("Success!")):($log.log("Error while creating credit profile"),reject("Error while creating credit profile"))})["catch"](function(ecreditProfile){$log.log("cancelOrder :: Error occurred while creating credit profile",ecreditProfile),reject("Error occurred while creating credit profile")})})["catch"](function(edeleteCreditProfile){$log.log("cancelOrder :: Error occurred in deleteCreditProfile while cancelling order",edeleteCreditProfile),reject("deleteCreditProfile failure!")})})["catch"](function(ecart){$log.log("cancelOrder :: Error occurred in deleteCart while cancelling order",ecart),reject("deleteCart failure!")}):($log.log("Error while getting Ids from cookies"),reject("Error while getting Ids from cookies"))}:function(resolve,reject){cartStorage.getCartId()&&cartStorage.getProfileId()&&cartStorage.getCreditProfileId()?$q.all([cartHttpDataService.deleteCart(cartStorage.getCartId()),cartHttpDataService.deleteCreditProfile(cartStorage.getProfileId(),cartStorage.getCreditProfileId())]).then(function(){cartStorage.removeSoftCreditCheck(),cartStorage.removeHardCreditCheck(),cartStorage.removeCartId(),cartStorage.removeCreditProfileId(),cartStorage.removOrderId();var createCreditProfileBody={};createCreditProfileBody.creditClass="A",cartHttpDataService.createCreditProfileV3(cartStorage.getProfileId(),createCreditProfileBody).then(function(response){lodash.get(response,"data.creditProfile.creditProfileId")?(cartStorage.setCreditProfileId(response.data.creditProfile.creditProfileId),resolve("Success!")):($log.log("Error while creating credit profile"),reject("Error while creating credit profile"))})["catch"](function(ecreditProfile){$log.log("cancelOrder :: Error occurred while creating credit profile",ecreditProfile),reject("Error while creating credit profile")})})["catch"](function(error){$log.log("cancelOrder :: Error occurred while cancelling order",error),reject("Error occurred while cancelling order")}):($log.log("Error while getting Ids from cookies"),reject("Error while getting Ids from cookies"))})}var $log=commonServices.$log,$q=commonServices.$q,toggleService=coreServices.toggleService;return{loadCheckOutData:loadCheckOutData,createAuditRecords:createAuditRecords,getAutoPayState:getAutoPayState,handleLoadCheckOutDataResponse:handleLoadCheckOutDataResponse,updateProfileInfo:updateProfileInfo,loadTPPCheckOutData:loadTPPCheckOutData,handleLoadTPPCartDataResponse:handleLoadTPPCartDataResponse,setPersonalInfoIntoCache:setPersonalInfoIntoCache,getQuotesData:getQuotesData,loadFullCheckOutData:loadFullCheckOutData,handleEmptyCartFlow:handleEmptyCartFlow,loadTPPCartData:loadTPPCartData,getFullCartPromise:getFullCartPromise,updateCartPromise:updateCartPromise,cancelOrder:cancelOrder,loadCheckOutHandOffData:loadCheckOutHandOffData,redirectToUnoCart:redirectToUnoCart}}checkOutHttpDataUtilConstructor.$inject=["coreServices","commonServices","checkOutModelService","CartUtils","authTokenManager","apiService","httpRequestWrapper","creditClassService","transformCart","cartStorage","commonUtils","checkOutConstants","globalValue","globalConfig","dataFactory","cartHttpDataService","cartConstants"],angular.module("tmobileApp").factory("checkOutHttpDataUtil",checkOutHttpDataUtilConstructor)}(window.angular,window._),function(angular){"use strict";function faqContent($window,$timeout){return{restrict:"A",scope:!0,link:function(scope,element,attrs){$timeout(function(){var header=element[0].querySelector(".accordion-toggle");scope.$watch("item.isOpen",function(newValue){newValue===!0?header.setAttribute("aria-expanded",!0):header.setAttribute("aria-expanded",!1)})},300)}}}faqContent.$inject=["$window","$timeout"],angular.module("marketingCore").directive("faqContent",faqContent)}(angular),function(angular,lodash){"use strict";function checkOutControllerHelperUtil(commonServices,coreServices,creditCardTypes,modalDialogFactory,commonUtils,FRAUD_FAIL_STATE_NAME,checkOutModelService,cardTypeCodes,apiService){function getCreditTypeToSend(crName){var crTypeSend="",types=creditCardTypes.creditTypes;return angular.forEach(types,function(v,k){angular.equals(crName,v)&&(crTypeSend=k)}),crTypeSend}function getCreditCardTypeCode(cardName){var cardTypeCode="",CreditCardTypeCodes=cardTypeCodes.typeCodes;return angular.forEach(CreditCardTypeCodes,function(value,key){angular.equals(cardName.toUpperCase(),value)&&(cardTypeCode=key)}),cardTypeCode}function checkoutFlowHardStop(){coreServices.session.removeAllSession(),coreServices.cartStorage.clearAfterOrderCreatedAndAuthFail(),coreServices.creditClassService.setCreditClass(void 0),$log.log('checkOutControllerHelperUtil is redirecting to "AuthFail" because a "hardStop" was called.'),commonServices.$state.go(FRAUD_FAIL_STATE_NAME)}function authCheck(){var authCount=coreServices.cartStorage.getAuthCount();return 2>authCount?(authCount++,coreServices.cartStorage.setAuthCount(authCount),coreServices.logger.debug("credit card details check : unAuthorized for no. of count ",authCount),modalDialogFactory.openAuthFailModal()):(checkoutFlowHardStop(),void coreServices.logger.debug("Credit card details check : unAuthorized",null))}function errorLogging(error,functionName){coreServices.logger.error("We have an error in "+functionName+" Here is the error body : "+angular.toJson(error))}function setConditionalAuthorData(authorValue){var selectedCreditClass=coreServices.creditClassService.getCreditClass()?coreServices.creditClassService.getCreditClass()["class"]:"creditClass1",isOnlyAccessory=lodash.get(checkOutModelService.model.checkOutInfo,"reviewCart.flags.isOnlyAccessory"),conditionalAuthorValue={};return isOnlyAccessory?conditionalAuthorValue.ctaText=angular.copy(commonUtils.searchJson(authorValue,"noCreditCtaText")):angular.equals(selectedCreditClass,"creditClass3")?(conditionalAuthorValue.creditHeader=angular.copy(commonUtils.searchJson(authorValue,"noCreditHeader")),conditionalAuthorValue.creditSubHeader=angular.copy(commonUtils.searchJson(authorValue,"noCreditSubHeader")),conditionalAuthorValue.ssnToolTip=angular.copy(commonUtils.searchJson(authorValue,"noCreditSSNToolTip")),conditionalAuthorValue.ssnHelperText=angular.copy(commonUtils.searchJson(authorValue,"noCreditHelperText")),conditionalAuthorValue.ctaText=angular.copy(commonUtils.searchJson(authorValue,"noCreditCtaText"))):(conditionalAuthorValue.creditHeader=angular.copy(commonUtils.searchJson(authorValue,"creditHeader")),conditionalAuthorValue.creditSubHeader=angular.copy(commonUtils.searchJson(authorValue,"creditSubHeader")),conditionalAuthorValue.ssnToolTip=angular.copy(commonUtils.searchJson(authorValue,"ssnToolTip")),conditionalAuthorValue.ssnHelperText=angular.copy(commonUtils.searchJson(authorValue,"ssnHelperText")),conditionalAuthorValue.ctaText=angular.copy(commonUtils.searchJson(authorValue,"ctaText"))),conditionalAuthorValue}function setAuthorData(authorValue){var modifiText,userConsent=commonUtils.searchJson(authorValue.checkout,"personalInfoAndShipping.userConsent");userConsent&&(checkOutModelService.model.checkOutInfo.userConsentIndex=userConsent.length-1,modifiText=userConsent[checkOutModelService.model.checkOutInfo.userConsentIndex].consentText.replace(/\\n/g,"<br />"),authorValue.checkout.personalInfoAndShipping.userConsent[checkOutModelService.model.checkOutInfo.userConsentIndex].consentText=modifiText);var termsAndCondition=commonUtils.searchJson(authorValue.checkout,"termsandconditions.termsCondition");if(termsAndCondition){var termsConditionIndex=authorValue.checkout.termsandconditions.termsCondition.length-1;coreServices.cartStorage.setVersionId(authorValue.checkout.termsandconditions.termsCondition[termsConditionIndex].versionId),modifiText=authorValue.checkout.termsandconditions.termsCondition[termsConditionIndex].termsContent.replace(/\\n/g," "),authorValue.checkout.termsandconditions.termsCondition[termsConditionIndex].termsContent=modifiText}authorValue.checkout.checkoutConfTfn&&(authorValue.checkout.checkoutConfTfn.callMeNow=authorValue.checkout.callMeNow);var reviewObject=commonUtils.searchJson(authorValue.checkout,"review");reviewObject&&(authorValue.checkout.orderTypeDisplay={AVAILABLE:reviewObject.yourOrder,AVAILABLE_FOR_BACK_ORDER:reviewObject.backOrder,AVAILABLE_FOR_PRE_ORDER:reviewObject.preOrder})}function combineDeviceAccessory(device,accessory){return device.length>0&&accessory.length>0?device.concat(accessory):device.length>0?device.join():accessory.length>0?accessory.join():void 0}function getBlueCoreQueryParams(){var query={},accessorySkuList={},emailaddress=lodash.get(checkOutModelService.model.checkOutInfo.personalInfo,"email"),orderTotal=lodash.get(checkOutModelService.model.checkOutInfo.total,"payNowPrice.amount"),orderNumber=lodash.get(checkOutModelService.model.checkOutInfo.order,"orderNumber"),deviceSkuList=lodash.map(checkOutModelService.model.checkOutInfo.lineItems,function(lineItem){return lodash.result(lineItem,"lineItemDetails.deviceDetails.sku")});if(checkOutModelService.model.checkOutInfo.accessories&&(accessorySkuList=lodash.map(checkOutModelService.model.checkOutInfo.accessories.accessoryDetails,function(accessoryDetail){return lodash.result(accessoryDetail,"sku")})),emailaddress&&(query.email=emailaddress),orderTotal&&(query.total=orderTotal),orderNumber&&(query.order_id=orderNumber),deviceSkuList||accessorySkuList){var skuList=combineDeviceAccessory(deviceSkuList,accessorySkuList);query.product_ids=skuList.toString()}return query}function blueCoreEmailUrl(){var apiUrl=apiService.getURL("blueCore").url,query=getBlueCoreQueryParams();if(query){var qs=queryString.stringify(query);apiUrl=apiUrl.indexOf("?")>0?apiUrl+"&"+qs:apiUrl+"?"+qs}return apiUrl}var $log=commonServices.$log;return{getCreditTypeToSend:getCreditTypeToSend,checkoutFlowHardStop:checkoutFlowHardStop,authCheck:authCheck,errorLogging:errorLogging,setConditionalAuthorData:setConditionalAuthorData,setAuthorData:setAuthorData,getCreditCardTypeCode:getCreditCardTypeCode,blueCoreEmailUrl:blueCoreEmailUrl}}checkOutControllerHelperUtil.$inject=["commonServices","coreServices","creditCardTypes","modalDialogFactory","commonUtils","FRAUD_FAIL_STATE_NAME","checkOutModelService","cardTypeCodes","apiService"],angular.module("tmobileApp").factory("checkOutControllerHelperUtil",checkOutControllerHelperUtil)}(window.angular,window._),function(angular){"use strict";function formAnalytics($timeout,analyticsUtils){return{restrict:"A",scope:{formAnalytics:"<",name:"<"},link:function(scope,element){function onFormStart(){scope.name.$pristine&&!isFormStarted&&(analyticsUtils.trackForm(scope.formAnalytics.formStart),isFormStarted=!0)}function onFormSubmit(){analyticsUtils.trackFormSubmit(scope.formAnalytics.formSubmit),scope.name.$valid&&analyticsUtils.trackForm(scope.formAnalytics.formEnd)}var formSubmit=element.find('button[type="submit"]');$timeout(function(){var formElements=element.find("input, select");formElements.on("focus",onFormStart)}),formSubmit.on("click",onFormSubmit);var isFormStarted=!1}}}formAnalytics.$inject=["$timeout","analyticsUtils"],angular.module("marketingCore").directive("formAnalytics",formAnalytics)}(angular),function(angular,lodash){function checkOutProgressServiceConstructor(globalValue,checkOutConstants,commonUtils,coreServices,toggleService,cartStorage){function disableCheckoutSections(selectedSection){switch(selectedSection){case checkOutConstants.SECTIONS.INFOANDSHIPPING:me.model.enableSection[checkOutConstants.SECTIONS.INFOANDSHIPPING]=!0,me.model.enableSection[checkOutConstants.SECTIONS.VERIFY_CREDIT]=!1,me.model.enableSection[checkOutConstants.SECTIONS.PAYMENTANDCREDIT]=!1,me.model.enableSection[checkOutConstants.SECTIONS.REVIEW]=!1;break;case checkOutConstants.SECTIONS.VERIFY_CREDIT:me.model.enableSection[checkOutConstants.SECTIONS.INFOANDSHIPPING]=!0,me.model.enableSection[checkOutConstants.SECTIONS.VERIFY_CREDIT]=!0,me.model.enableSection[checkOutConstants.SECTIONS.PAYMENTANDCREDIT]=!1,me.model.enableSection[checkOutConstants.SECTIONS.REVIEW]=!1;break;case checkOutConstants.SECTIONS.PAYMENTANDCREDIT:me.model.enableSection[checkOutConstants.SECTIONS.INFOANDSHIPPING]=!0,me.model.enableSection[checkOutConstants.SECTIONS.VERIFY_CREDIT]=!0,me.model.enableSection[checkOutConstants.SECTIONS.PAYMENTANDCREDIT]=!0,me.model.enableSection[checkOutConstants.SECTIONS.REVIEW]=!1;break;case checkOutConstants.SECTIONS.REVIEW:me.model.enableSection[checkOutConstants.SECTIONS.INFOANDSHIPPING]=!0,me.model.enableSection[checkOutConstants.SECTIONS.VERIFY_CREDIT]=!0,me.model.enableSection[checkOutConstants.SECTIONS.PAYMENTANDCREDIT]=!0,me.model.enableSection[checkOutConstants.SECTIONS.REVIEW]=!0;break;default:me.model.enableSection[checkOutConstants.SECTIONS.INFOANDSHIPPING]=!0,me.model.enableSection[checkOutConstants.SECTIONS.VERIFY_CREDIT]=!1,me.model.enableSection[checkOutConstants.SECTIONS.PAYMENTANDCREDIT]=!1,me.model.enableSection[checkOutConstants.SECTIONS.REVIEW]=!1}}function init(){me.model={},me.model.enableSection={};var progressHeader,selectedCreditClass,isTPPON=lodash.get(toggleService.model,"toggles.isTPPON",!1),isVerifyIdentity=angular.equals(coreServices.cartStorage.getSoftCreditCheck(),checkOutConstants.TRUE),checkoutInfo=coreServices.cartStorage.getGlobalCheckOutInfo(),cartData=cartStorage.getGlobalSmartCartInfo();if(selectedCreditClass=coreServices.creditClassService.getCreditClass()?coreServices.creditClassService.getCreditClass()["class"]:"creditClass1",disableCheckoutSections(checkOutConstants.SECTIONS.INFOANDSHIPPING),isTPPON||(progressHeader=checkoutInfo.reviewCart.flags.isOnlyAccessory||"creditClass3"===selectedCreditClass?commonUtils.searchJson(globalValue,"progressBar.sec2accessories"):commonUtils.searchJson(globalValue,"progressBar.sec2")),me.model.arrayOfSections=[{header:isTPPON?commonUtils.searchJson(globalValue,"progressBar.sec1TPP"):commonUtils.searchJson(globalValue,"progressBar.sec1"),name:checkOutConstants.SECTIONS.INFOANDSHIPPING},{header:isTPPON?commonUtils.searchJson(globalValue,"progressBar.sec3TPP"):progressHeader,name:checkOutConstants.SECTIONS.PAYMENTANDCREDIT},{header:isTPPON?commonUtils.searchJson(globalValue,"progressBar.sec4TPP"):commonUtils.searchJson(globalValue,"progressBar.sec3"),name:checkOutConstants.SECTIONS.REVIEW}],isTPPON){var creditCheckHeader;creditCheckHeader=cartData.flags.isOnlyAccessory?commonUtils.searchJson(globalValue,"progressBar.verified"):isVerifyIdentity?commonUtils.searchJson(globalValue,"progressBar.verifyId"):commonUtils.searchJson(globalValue,"progressBar.creditCheck"),me.model.arrayOfSections.splice(1,0,{header:creditCheckHeader,name:checkOutConstants.SECTIONS.VERIFY_CREDIT})}}var me=this;me.disableCheckoutSections=disableCheckoutSections,me.init=init}checkOutProgressServiceConstructor.$inject=["globalValue","checkOutConstants","commonUtils","coreServices","toggleService","cartStorage"],angular.module("tmobileApp").service("checkOutProgressService",checkOutProgressServiceConstructor)}(window.angular,window._),function(angular){"use strict";function fuseSearch(utils){return{restrict:"E",template:function(scope,element){return element&&"true"===element.useDynamicKey?'<ul class="dropdown-menu" id="dropdown-menu" role="listbox"><li id="{{objectKey}}-{{$index}}" index="{{$index}}" ng-class="{active : $index === 0}"ng-focus="addClassActive($event)" ng-mouseover="addClassActive($event)"ng-click="selectElement(element)" ng-repeat="element in newList | limitTo:limitItems"role="option" aria-label="{{element[objectKey]}}"><a ng-bind-html="getElementText(element)"></a></li></ul>':'<ul class="dropdown-menu"><li id="element-{{$index}}" index="{{$index}}" ng-class="{active : $index === 0}"ng-focus="addClassActive($event)" ng-mouseover="addClassActive($event)"ng-click="selectElement(element)" ng-repeat="element in newList | limitTo:limitItems"><a ng-bind-html="getElementText(element)"></a></li></ul>'},scope:{elements:"=",model:"=",objectKey:"@",limitItems:"@",keys:"@",isMutipleKeys:"<",distance:"<",threshold:"<",countUntilSearch:"<",isCaseSensitive:"<",useDynamicKey:"<",tokenize:"<"},link:function(scope,element){var fuse;scope.isClick=!1;var isLoad=!1;utils.loadScript("/etc/clientlibs/t-mobile/publish/lib/fusejs.js",function(){isLoad=!0});var objKeys=[];objKeys=scope.isMutipleKeys?scope.objectKey.split(","):[scope.objectKey];var options={shouldSort:!0,tokenize:!1,threshold:.6,location:0,distance:100,maxPatternLength:32,minMatchCharLength:1,keys:objKeys},matchableLength=0;!isNaN(scope.threshold)&&angular.isNumber(scope.threshold)&&(options.threshold=scope.threshold),!isNaN(scope.distance)&&angular.isNumber(scope.distance)&&(options.distance=scope.distance),!isNaN(scope.countUntilSearch)&&angular.isNumber(scope.countUntilSearch)&&(matchableLength=scope.countUntilSearch),scope.tokenize&&(options.tokenize=scope.tokenize),scope.newList=[],scope.$watch("model",function(newValue,oldValue){isLoad&&Fuse&&(fuse=new Fuse(scope.elements,options),newValue&&newValue.length>=matchableLength?scope.newList=fuse.search(newValue):scope.newList=fuse.search(""),scope.isCaseSensitive?scope.isClick=newValue===scope.newList[0][objKeys[0]]:scope.isClick=newValue.toLowerCase()===scope.newList[0][objKeys[0]].toLowerCase(),scope.showList())},!0),scope.showList=function(){scope.newList.length>0&&!scope.isClick?element[0].classList.add("open"):element[0].classList.remove("open"),scope.isClick=!1},scope.selectElement=function(newElement){objKeys?scope.model=newElement[objKeys[0]]:scope.model=newElement,scope.isClick=!0,element[0].classList.remove("open")},scope.highlight=function(text,search){if(!search)return search;var regex=new RegExp("("+search+")","ig");return text.replace(regex,"<strong>$1</strong>")},scope.addClassActive=function(event){for(var el=angular.element(event.currentTarget),els=element[0].querySelectorAll("li.active"),i=0;i<els.length;i++)els[i].classList.remove("active");el.addClass("active")},scope.getElementText=function(item){return objKeys?scope.highlight(item[objKeys[0]],scope.model):scope.highlight(item,scope.model)}}}}fuseSearch.$inject=["utils"],angular.module("marketingCore").directive("fuseSearch",fuseSearch)}(angular),function(angular,lodash){"use strict";function verifyIdentityModalController($modalInstance,authorValues,modalDialogFactory){function close(){$modalInstance.close(),vm.openCancelCTAModal()}function openQuestionModal(){$modalInstance.close(),modalDialogFactory.openFraudQuestionModal()}function openCancelCTAModal(){$modalInstance.close(),modalDialogFactory.openCancelCtaModal()}var vm=this;vm.verifyIdentityModal=lodash.get(authorValues,"checkout.fraudCheck",{}),vm.close=close,vm.openQuestionModal=openQuestionModal,vm.openCancelCTAModal=openCancelCTAModal}verifyIdentityModalController.$inject=["$modalInstance","authorValues","modalDialogFactory"],angular.module("tmobileApp").controller("verifyIdentityModalController",verifyIdentityModalController)}(window.angular,window._),function(angular){"use strict";function infiniteRunner($window,$modal,$http,$log,utils,analyticsUtils){return{restrict:"A",link:function(scope,element,attr){function onSuccess_loadGame(){}var holiday=element.data("runner");"holiday"===holiday?utils.loadScript("/etc/clientlibs/t-mobile/publish/app/angular_app/assets/images/marketing/infinite-runner-game/holiday.min.js",onSuccess_loadGame):utils.loadScript("/etc/clientlibs/t-mobile/publish/app/angular_app/assets/images/marketing/infinite-runner-game/game.min.js",onSuccess_loadGame)}}}infiniteRunner.$inject=["$window","$modal","$http","$log","utils","analyticsUtils"],angular.module("marketingCore").directive("infiniteRunner",infiniteRunner)}(angular),function(angular,lodash){"use strict";function serviceFailModalController($modalInstance,authorValues){function close(){$modalInstance.close()}var vm=this;vm.servicefailModal=lodash.get(authorValues,"checkout.servicefailmodal",{}),vm.close=close}serviceFailModalController.$inject=["$modalInstance","authorValues"],angular.module("tmobileApp").controller("serviceFailModalController",serviceFailModalController)}(window.angular,window._),function(angular){"use strict";function marketingSpinner(){return{restrict:"E",template:'<div class="mark-spinner" id="mark-spinner"><div class="fa fa-spinner fa-pulse text-magenta"></div></div>',scope:{showSpinner:"="},link:function(scope){var overlay=angular.element(document.getElementsByClassName("mute-screen")[0]),spinner=document.getElementById("mark-spinner");scope.$watch("showSpinner",function(value){value?(overlay.addClass("on"),spinner.style.display="block"):(overlay.removeClass("on"),spinner.style.display="none")})}}}angular.module("marketingCore").directive("marketingSpinner",marketingSpinner)}(window.angular),function(angular,lodash){"use strict";function modalDialogFactory($modal,commonServices,pdlService,pdlConstant,globalValue,checkOutHttpDataUtil){function _setModalCloseData(modalId,modalName){return{modalID:modalId,modalName:modalName}}function _combineModalConfig(config){return lodash.merge(_defaultModalConfig,config)}function _openModal(modalConfig){return $log.log("modalConfig::",modalConfig),$modal.open(modalConfig).result}function openCheckOutHeaderModal(){var modalConfig={templateUrl:"app/checkOut/modalDialogs/checkOutHeaderModal/checkOutHeaderModal.tpl.html",controller:"CheckOutHeaderModalController",controllerAs:"vm"};return _openModal(_combineModalConfig(modalConfig))}function openAuthFailModal(modalResolve){var modalConfig={templateUrl:"app/checkOut/modalDialogs/authFailModal/authFailModal.tpl.html",controller:"AuthFailModalController"};return _openModal(_combineModalConfig(modalConfig),modalResolve).then(function(){},function(){pdlService.setModalBackDropCloseEvent(_setModalCloseData(pdlConstant.MODALID.AUTH_FAIL_MODAL_ID,pdlConstant.MODAL_DATA.AUTH_FAIL_MODAL))})}function openServiceFailModal(modalResolve){var modalConfig={windowClass:"modalClass",templateUrl:"app/checkOut/modalDialogs/serviceFailModal/serviceFailModal.tpl.html",controller:"serviceFailModalController"};return _openModal(_combineModalConfig(modalConfig),modalResolve).then(function(){},function(){pdlService.setModalBackDropCloseEvent(_setModalCloseData(pdlConstant.MODALID.SERVICE_FAIL_MODAL_ID,pdlConstant.MODAL_DATA.SERVICE_FAIL_MODAL))})}function openSsnLearnMoreModal(modalResolve){var modalConfig={templateUrl:"app/checkOut/modalDialogs/ssnLearnMoreModal/ssnLearnMoreModal.tpl.html",controller:"SsnLearnMoreModalController"},modalCloseData={modalID:pdlConstant.MODALID.SSN_MODAL_ID,modalName:pdlConstant.EVENT_ATTRIBUTES.STEP_NAME.ssnLearnmoreModal};return _openModal(_combineModalConfig(modalConfig),modalResolve).then(function(){},function(){pdlService.setModalBackDropCloseEvent(modalCloseData)})}function openPriceBreakDownModal(){var modalConfig={windowClass:"price-breakdown-modal",templateUrl:"app/cart/priceBreakdownModal/priceBreakdownModal.html",controller:"PriceBreakdownController",controllerAs:"priceBreakdownCtrl",resolve:{selectedLine:function(checkOutModelService){return checkOutModelService.model.checkOutInfo.reviewCart},keyValues:function(globalValue){return globalValue.authorValue},source:function(){return"cart"}}};return _openModal(_combineModalConfig(modalConfig))}function openOrderDetailsModal(modalResolve){var modalConfig={templateUrl:"app/checkOut/modalDialogs/orderDetailsModal/orderDetailsModal.html",controller:"OrderDetailsModalController"},modalCloseData={modalID:pdlConstant.MODALID.PRICE_UPDATE_ID,modalName:pdlConstant.MODAL_DATA.PRICE_UPDATE_MODAL};return _openModal(_combineModalConfig(modalConfig),modalResolve).then(function(){},function(){pdlService.setModalBackDropCloseEvent(modalCloseData)})}function openCartManualReviewModal(modalResolve){var modalConfig={templateUrl:"app/cart/cartManualReviewModal/cartManualReviewModal.html",controller:"cartManualReviewModalController"};return _openModal(_combineModalConfig(modalConfig),modalResolve)}function openCCProgressModal(modalResolve){var modalConfig={windowClass:"ccProgressModal",templateUrl:"app/checkOut/modalDialogs/ccProgressModal/ccProgressModal.html",controller:"ccProgressModalController"};return _openModal(_combineModalConfig(modalConfig),modalResolve)}function setModalInstance(modalInstance){ccmodalInstance=modalInstance}function getModalInstance(){return ccmodalInstance}function closeCCProgressModal(){var modalConfig={windowClass:"modalClass"};_combineModalConfig(modalConfig),ccmodalInstance.close()}function openFraudCheckRejectModal(modalResolve){var modalConfig={templateUrl:"app/checkOut/modalDialogs/fraudCheckRejectModal/fraudCheckRejectModal.tpl.html",controller:"fraudCheckRejectModalController"};return _openModal(_combineModalConfig(modalConfig),modalResolve).then(function(){},function(){angular.isDefined(fraudCheck.rejectModalCloseAction)&&(commonServices.$window.location.href=fraudCheck.rejectModalCloseAction)})}function openCancelCtaModal(modalResolve){var modalConfig={windowClass:"cancelCtaModal",templateUrl:"app/checkOut/modalDialogs/cancelCtaModal/cancelCtaModal.html",controller:"cancelCtaModalController"};return _openModal(_combineModalConfig(modalConfig),modalResolve).then(function(){},function(){checkOutHttpDataUtil.cancelOrder().then(function(){angular.isDefined(fraudCheck.cancelCtaModalCloseAction)?commonServices.$window.location.href=fraudCheck.cancelCtaModalCloseAction:commonServices.$window.location.href="/cart"})["catch"](function(errorMessage){$log.log("Error occurred while cancelling order",errorMessage)})})}function openVerifyIdentityModal(modalResolve){var modalConfig={templateUrl:"app/checkOut/modalDialogs/verifyIdentityModal/verifyIdentityModal.tpl.html",controller:"verifyIdentityModalController"};return _openModal(_combineModalConfig(modalConfig),modalResolve).then(function(){},function(){openCancelCtaModal()})}function openFraudCheckTimeoutModal(modalResolve){var modalConfig={templateUrl:"app/checkOut/modalDialogs/fraudCheckTimeoutModal/fraudCheckTimeoutModal.tpl.html",controller:"fraudCheckTimeoutModalController"};return _openModal(_combineModalConfig(modalConfig),modalResolve).then(function(){},function(){angular.isDefined(fraudCheck.timeoutModalCloseAction)&&(commonServices.$window.location.href=fraudCheck.timeoutModalCloseAction)})}function openFraudQuestionModal(modalResolve){var modalConfig={templateUrl:"app/checkOut/modalDialogs/fraudQuestionModal/fraudQuestionModal.tpl.html",
controller:"fraudQuestionModalController"};return _openModal(_combineModalConfig(modalConfig),modalResolve).then(function(){},function(){openCancelCtaModal()})}var ccmodalInstance,$log=commonServices.$log,_defaultModalConfig={size:"lg",windowClass:"modalClass",controllerAs:"vm",resolve:{authorValues:function(globalValue){return globalValue.authorValue}}},fraudCheck=lodash.get(globalValue.authorValue,"checkout.fraudCheck",{});return{openCheckOutHeaderModal:openCheckOutHeaderModal,openAuthFailModal:openAuthFailModal,openServiceFailModal:openServiceFailModal,openSsnLearnMoreModal:openSsnLearnMoreModal,openPriceBreakDownModal:openPriceBreakDownModal,openOrderDetailsModal:openOrderDetailsModal,openCartManualReviewModal:openCartManualReviewModal,openCCProgressModal:openCCProgressModal,closeCCProgressModal:closeCCProgressModal,openVerifyIdentityModal:openVerifyIdentityModal,openFraudQuestionModal:openFraudQuestionModal,openCancelCtaModal:openCancelCtaModal,setModalInstance:setModalInstance,getModalInstance:getModalInstance,openFraudCheckRejectModal:openFraudCheckRejectModal,openFraudCheckTimeoutModal:openFraudCheckTimeoutModal}}modalDialogFactory.$inject=["$modal","commonServices","pdlService","pdlConstant","globalValue","checkOutHttpDataUtil"],angular.module("tmobileApp").factory("modalDialogFactory",modalDialogFactory)}(window.angular,window._),function(angular){"use strict";function marketingTooltip($document){return{restrict:"A",link:function(scope,element,attr){function documentClick(e){this.querySelectorAll(".popover.in")&&e.target!==popOver&&!e.target.parentNode.classList.contains("popover")&&angular.element(popOver).popover("hide")}function cleanup(){$document[0].removeEventListener("click",documentClick)}var popOver=element[0];angular.element(popOver).popover({trigger:"manual",templateUrl:"app/marketing/directives/marketingTooltip/marketingTooltipTemplate.html"}),scope.tooltipClick=function(e){angular.element(popOver).popover("toggle")},$document[0].addEventListener("click",documentClick),scope.$on("$destroy",cleanup)}}}marketingTooltip.$inject=["$document"],angular.module("marketingCore").directive("marketingTooltip",marketingTooltip)}(window.angular),function(angular,lodash){"use strict";function fraudCheckTimeoutModalController($modalInstance,commonServices,authorValues){function onCtaAction(redirectUrl){angular.isDefined(redirectUrl)&&(redirectUrl.includes("tel:")||$modalInstance.close(),commonServices.$window.location.href=redirectUrl)}function init(){vm.fraudCheck=lodash.get(authorValues,"checkout.fraudCheck",{}),vm.onCtaAction=onCtaAction}var vm=this;init()}fraudCheckTimeoutModalController.$inject=["$modalInstance","commonServices","authorValues"],angular.module("tmobileApp").controller("fraudCheckTimeoutModalController",fraudCheckTimeoutModalController)}(window.angular,window._),function(angular,lodash){"use strict";function modalWindowController($scope,$modalInstance,html){$scope.html=html,$scope.opened=$modalInstance.opened,$scope.result=$modalInstance.result,$scope.modalTarget=$modalInstance.target}function modalContent($modal,$http,$log,analyticsUtils){return{restrict:"A",scope:{removeNg:"@"},link:function(scope,element,attr){function prepareModal(e){if(e.preventDefault(),modalTarget=e.currentTarget,element.attr("tabindex","-1"),modalLinkId.indexOf(".html")>-1)modalUrl=modalLinkId.slice(0,-5)+"/_jcr_content/content-body.html",$http({method:"GET",url:modalUrl}).then(onSuccessRequestModalContent,onErrorRequestModalContent);else{modalElement=angular.element('[data-modal-id="'+modalLinkId+'"]');var newModalElement=angular.element(modalElement[0].outerHTML),videoElem=newModalElement[0].querySelector("[data-video-id]");if(videoElem){newModalElement[0].id=modalLinkId+"-modal-version";var videoElements=newModalElement[0].querySelectorAll("[id*="+modalLinkId+']:not([id$="_container"]):not([id$="_container_inner"]):not([id$="s7foregroundVideo"])');lodash.forEach(videoElements,function(elem){elem.id+="-modal-version"});var foregroundVid=newModalElement[0].querySelectorAll("[id="+modalLinkId+"_s7foregroundVideo]"),splitArray=foregroundVid[0].getAttribute("id").split(modalLinkId);foregroundVid[0].setAttribute("id",splitArray.join(modalLinkId+"-modal-version"));var bgVid=newModalElement[0].querySelectorAll('[id$="_container"]');lodash.forEach(bgVid,function(elem){var bgSplitArray=elem.getAttribute("id").split("s7video_"+modalLinkId);elem.setAttribute("id",bgSplitArray.join("s7video_"+modalLinkId+"-modal-version"))}),newModalElement[0].setAttribute("data-module-id",modalLinkId+"-modal-version")}modalElement.length||(modalElement=angular.element("<div></div>")),openModal(scope.removeNg?newModalElement[0].outerHTML.replace(new RegExp("ng-repeat","g"),"").replace(new RegExp("ng-","g"),""):newModalElement)}}function openModal(modalHtml){var html=modalHtml;if(nav.attr("aria-hidden","true"),content.attr("aria-hidden","true"),modalElement){var modalName;modalName=modalElement.find("h2").length?modalElement.find("h2:first").text():modalElement.find("h3").length?modalElement.find("h3:first").text():angular.element(modalElement).data("componentTitle"),modalNameForAnalytics=modalName,analyticsUtils.trackModal(modalElement.attr("data-module-id")?modalElement.attr("data-module-id"):modalLinkId,modalName,!1,modalElement)}else modalTarget&&modalTarget.hasAttribute("data-modal-name")?(dataModalName=modalTarget.getAttribute("data-modal-name"),modalNameForAnalytics=dataModalName,analyticsUtils.trackModal(modalUrl,dataModalName)):$(html).find("h2:first").length?(modalNameForAnalytics=$(html).find("h2:first").text(),analyticsUtils.trackModal(modalUrl,modalNameForAnalytics)):$(html).find("h3:first").length?(modalNameForAnalytics=$(html).find("h3:first").text(),analyticsUtils.trackModal(modalUrl,modalNameForAnalytics)):(modalNameForAnalytics="pageModal",analyticsUtils.trackModal(modalUrl,modalNameForAnalytics));var modalObj={controller:modalWindowController,template:'<button type="button" class="close" aria-label="Close" ng-click="$close()"><span aria-hidden="true" class="close-icon"></span></button><div id="modal-container-window" data-modal-name='+dataModalName+"></div>",resolve:{html:function(){return html}}};modalObj.backdropClass=modalElement?modalElement.data("backdrop-class"):"",modalObj.windowClass=modalElement?modalElement.data("window-class"):"page-modal",modalInstance=$modal.open(modalObj),modalInstance.target=modalTarget}function onSuccessRequestModalContent(response){var responseElement=angular.element(response.data);openModal(responseElement)}function onErrorRequestModalContent(response){$log.error("There was a problem loading modal content.")}function cleanup(){element.off("click",openModal)}var modalUrl,modalTarget,modalElement,modalInstance,dataModalName,attrHref=attr.href||attr.ngHref,modalLinkId=attr.modal||attrHref.replace("#",""),content=angular.element(".content"),nav=angular.element(".global-header");return modalLinkId.length?(element.on("click",prepareModal),scope.$on("$destroy",cleanup),1):!1}}}function modalWindow($timeout,$window,$document,utils,analyticsUtils,$compile){return{restrict:"A",link:function(scope,element,attr){function trapTab(e){var focusedItem=angular.element($document[0].activeElement);9!==e.keyCode||focusedItem.closest(".modal-dialog").length||element.find("button.close").focus()}function cleanup(){angular.element("body").off("keyup",trapTab),nav.attr("aria-hidden","false"),content.attr("aria-hidden","false"),scope.modalTarget&&(scope.modalTarget.setAttribute("tabindex","0"),scope.modalTarget.focus())}function onClickActionableElement(e){analyticsUtils.trackActionableElementClick(e.currentTarget,utils.getPageReach(win,html),modalNameForAnalytics)}var content=angular.element(".content"),nav=angular.element(".global-header"),win=angular.element($window),html=angular.element("html");scope.$on("$destroy",cleanup),angular.element("body").on("keyup",trapTab),element.find("#modal-container-window").append(scope.html),element.on("click","button[data-analytics-id], a[data-analytics-id], [role=button][data-analytics-id]",onClickActionableElement),scope.html&&(scope.html.hasClass("legal-modal")||$compile(element.contents())(scope));var marketingPage=$document[0].body.className.match("marketing-page");if(!marketingPage){var marketingContainer=element[0].querySelector(".marketing-section"),legalModal=element[0].querySelector(".legal-modal");if(marketingContainer||legalModal){var wrapper=angular.element('<div class="marketing-page" ></div>');element.wrap(wrapper)}}scope.opened&&scope.opened.then(function(){element.focus(),$timeout(function(){var height=element.find(".modal-content").height();height<=angular.element($window).height()/2&&element.css({top:"25%",bottom:"auto"}),utils.isTouch()&&element.addClass("modal-touch").css({top:"20px",bottom:"auto",height:angular.element($window).height()}),$timeout(function(){angular.element(".modal").attr("role","document").find("button.close").attr("tabindex","-1").focus().attr("tabindex","0")},500),scope.$broadcast("modalOpen")},100)}),scope.result&&scope.result["finally"](function(){(marketingContainer||legalModal)&&element.parent().remove();var modalName=element.find("h2").length?element.find("h2:first").text():element.find("h3:first").text(),dataModalElement=element.find("#modal-container-window")[0];if(dataModalElement&&"undefined"!=dataModalElement&&dataModalElement.hasAttribute("data-modal-name")){var dataModalAttributeElement=dataModalElement.getAttribute("data-modal-name");"undefined"!=dataModalAttributeElement&&(modalName=dataModalAttributeElement.trim())}analyticsUtils.trackModal(element.find("[data-modal-id]").attr("data-modal-id"),modalName,!0),scope.$broadcast("modalClosed")})}}}function modalBackdrop(){return{restrict:"A",link:function(scope,element,attr){var content=angular.element(".content"),nav=angular.element(".global-header");element.on("click",function(){return scope.$$nextSibling&&"function"==typeof scope.$$nextSibling.$close?void scope.$$nextSibling.$close():(scope.$$prevSibling.$close(),nav.attr("aria-hidden","false"),void content.attr("aria-hidden","false"))})}}}modalContent.$inject=["$modal","$http","$log","analyticsUtils"],modalWindow.$inject=["$timeout","$window","$document","utils","analyticsUtils","$compile"];var modalNameForAnalytics;angular.module("marketingCore").directive("modalContent",modalContent),angular.module("marketingCore").directive("modalWindow",modalWindow),angular.module("marketingCore").directive("modalBackdrop",modalBackdrop)}(angular,_),function(angular,lodash){"use strict";function checkOutHeaderModalController($modalInstance,$location,commonServices,authorValues){function close(){$modalInstance.close(),lodash.isEmpty(vm.checkoutHeader.goToHomeLink)?$location.url("/"):$window.location.href=vm.checkoutHeader.goToHomeLink}function dismiss(){$modalInstance.dismiss()}var vm=this,$window=commonServices.$window;vm.checkoutHeader=lodash.get(authorValues,"checkout.checkoutHeader",{}),vm.close=close,vm.dismiss=dismiss}checkOutHeaderModalController.$inject=["$modalInstance","$location","commonServices","authorValues"],angular.module("tmobileApp").controller("CheckOutHeaderModalController",checkOutHeaderModalController)}(window.angular,window._),function(angular,lodash){"use strict";function modulePicker($document,$window,$compile,$interval,$log,analyticsUtils,personalizedAnchorLinks,personalizedPickerService,analyticsFactory){return{restrict:"A",link:function(scope,element,attr){function cancelInterval(){$interval.cancel(interval),interval=null}function updatedSelectedLink(id){element.find(".content-picker-nav a").removeClass("selected"),element.find(".content-picker-nav a[data-id="+id+"]").addClass("selected")}function loadContent(url){var allModules=$document[0].querySelectorAll("[data-module-picker-id]");url?(personalizedPickerService.getPersonalizedContent(url).then(onSuccess,onError),personalizedPickerService.addModules(allModules)):(personalizedPickerService.addModules(allModules),personalizedPickerService.modulePickerLoaded(modulePickerId),element.remove())}function onSuccess(response){var htmlContent=$compile(response.data)(scope),module=htmlContent.find("[data-module-id]:first");window.modPickerCount++,"true"===window.marketingConfig.isWcm?(element.find(".module-picker-content").html(htmlContent),element.find(".content-picker-nav-overlay").removeClass("active")):element.parent().replaceWith(htmlContent),scope.$broadcast("domContentReplaced"),analyticsUtils.trackAsyncModule("Module Picker",defaultModule.path,module.attr("data-analytics-id"),module.attr("data-module-id"),defaultModule.id,moduleId),personalizedPickerService.modulePickerLoaded(modulePickerId),personalizedAnchorLinks.onloadAjaxScrollTo()}function onError(response){$log.error("There was a problem loading personalized content.")}function onClickNav(e){e.preventDefault(),e.currentTarget.href?(element.find(".content-picker-nav-overlay").addClass("active"),updatedSelectedLink(angular.element(e.currentTarget).attr("data-id")),loadContent(e.currentTarget.href)):alert("Content path is blank for this ID. Module picker will be hidden on published page.")}$window.hasModulePicker=!0;var modules=angular.fromJson(attr.pages).modules,moduleId=element.attr("data-module-id"),modulePickerId=element.attr("data-module-picker-id");if(!modules)return!1;var defaultModule;if("false"===window.marketingConfig.isWcm)if(defaultModule=lodash.find(modules,function(module){return module.id===attr.defaultId}),window.TMOPersonalize&&window.TMOPersonalize.modules){var definedModule=lodash.find(window.TMOPersonalize.modules,function(module){return module.moduleId===element.attr("data-module-id")});definedModule&&(defaultModule=lodash.find(modules,function(module){return module.id===definedModule.contentId})),loadContent(defaultModule.path)}else var elapsed=0,timeout=1e3,interval=$interval(function(){if(window.TMOPersonalize){if(cancelInterval(),window.TMOPersonalize.modules){var definedModule=lodash.find(window.TMOPersonalize.modules,function(module){return module.moduleId===element.attr("data-module-id")});definedModule&&(defaultModule=lodash.find(modules,function(module){return module.id===definedModule.contentId}))}loadContent(defaultModule.path)}else elapsed>=timeout&&(cancelInterval(),loadContent(defaultModule.path));elapsed+=10},10);else defaultModule=lodash.find(modules,function(module){return module.id===attr.defaultId}),loadContent(defaultModule.path);element.find(".content-picker-nav").on("click","a",onClickNav)}}}modulePicker.$inject=["$document","$window","$compile","$interval","$log","analyticsUtils","personalizedAnchorLinks","personalizedPickerService","analyticsFactory"],angular.module("marketingCore").directive("modulePicker",modulePicker)}(window.angular,window._),function(angular,lodash){"use strict";function cancelCtaModalController($modalInstance,modalDialogFactory,globalValue,commonServices,checkOutHttpDataUtil){function close(){$modalInstance.close()}function cancelCloseCta(redirectUrl){vm.close(),checkOutHttpDataUtil.cancelOrder().then(function(){angular.isDefined(redirectUrl)?commonServices.$window.location.href=redirectUrl:commonServices.$window.location.href="/cart"})["catch"](function(errorMessage){$log.log("cancelCloseCta :: Error occurred while cancelling order",errorMessage)})}function openquestionModal(){vm.close(),modalDialogFactory.openFraudQuestionModal()}var vm=this,$log=commonServices.$log;vm.close=close,vm.cancelCloseCta=cancelCloseCta,vm.openquestionModal=openquestionModal,vm.fraudCheckAuthorValues=lodash.get(globalValue.authorValue,"checkout.fraudCheck",{})}var controllerName="cancelCtaModalController";angular.module("tmobileApp").controller(controllerName,cancelCtaModalController)}(angular,_),function(angular,lodash){"use strict";function navigation($window,$document,$location,$timeout,$cookies,viewport,analyticsUtils,utils){return{restrict:"A",link:function(scope,element){function attachHover(){viewport.breakpointUp("desktop")?hoverContainer.addEventListener("mouseenter",megaHover):hoverContainer.removeEventListener("mouseenter",megaHover)}function skipFocus(){var skipTo="#"+this.href.split("#")[1];angular.element(skipTo).attr("tabindex",-1).on("blur focusout",function(){this.removeAttr("tabindex")}).focus()}function onClick_navigationElement(e){analyticsUtils.trackGlobalNavigationClick(e.currentTarget)}function onScroll_window(e){var searchId=lodash.get(e.currentTarget,"activeElement",{});!megaNav||"iOS"===isIOS&&"searchText"===searchId.getAttribute("id")||megaOut(),toggleStickyHeader()}function toggleStickyHeader(){var contentContainer=angular.element(".marketing-page > .content"),storeLocator=-1!==$location.absUrl().indexOf("store-locator");if(win.scrollTop()>70||storeLocator||element.hasClass("small-nav")){if(element.addClass("sticky"),element.hasClass("static")&&contentContainer.addClass("sticky-nav-top-padding"),storeLocator){var stickyClassContainer=angular.element(".sticky");stickyClassContainer.addClass("storelocator-white-bg")}}else element.removeClass("sticky"),contentContainer.removeClass("sticky-nav-top-padding")}function megaHover(e){e.currentTarget.classList.contains(".logo")||(megaNav.classList.remove("closed"),megaNav.classList.add("open"),hoverContainer.addEventListener("mouseleave",megaOut),closeSearch())}function megaOut(){megaNav.classList.remove("open"),megaNav.classList.add("closed"),closeSearch()}function expandCorpSearch(e){megaNav.classList.remove("open"),megaNav.classList.add("closed"),search.removeEventListener("mouseup",expandCorpSearch),hoverContainer.removeEventListener("mouseenter",megaHover),hoverContainer.removeEventListener("mouseleave",megaOut),element[0].querySelector(".search-bar").classList.remove("closed"),element[0].querySelector(".search-bar").setAttribute("aria-hidden","false"),element[0].querySelector(".corp-search .icon").classList.add("close"),search.addEventListener("mouseup",closeSearch),element[0].querySelector(".search-bar .form-group").setAttribute("aria-hidden","false"),element[0].querySelector(".search-bar .form-group #searchText").focus(),element[0].querySelector(".search-bar .search-submit").setAttribute("aria-hidden","false"),angular.element("body").on("keyup",trapTab),angular.element("body").on("click",onClick_body),e.stopPropagation(),e.preventDefault()}function expandSearch(e){viewport.breakpointUp("desktop")?(element.find(".search").addClass("open"),element.find("#searchText").focus(),body.on("click.closeSearch",onClick_body),searchForm.attr("aria-hidden","false"),searchSubmit.attr("aria-hidden","false"),e.stopPropagation()):(element.find(".overlay-search").addClass("open").attr("aria-hidden","false"),element.find(".mute-screen").addClass("on"),element.find(".overlay-search button.close").on("click tap",closeSearch),overlaySearchForm.attr("aria-hidden","false"),overlaySearchSubmit.attr("aria-hidden","false"),nav.attr("aria-hidden","true"),content.attr("aria-hidden","true"),angular.element("body").on("keyup",trapTab),overlaySearchInput.focus(),e.stopPropagation())}function onClick_body(e){var target=angular.element(e.target);if(target.hasClass("search-submit")&&""===angular.element.trim(element.find(".form-control").val()))e.preventDefault(),closeSearch();else{if(target.hasClass("form-control")||target.hasClass("slide"))return!1;closeSearch()}}function onSubmit_overlaySearch(e){""===angular.element.trim(angular.element(e.currentTarget).find(".form-control").val())&&e.preventDefault()}function closeSearch(){body.off("click.closeSearch"),viewport.breakpointUp("desktop")?(element.find(".search").removeClass("open"),searchForm.attr("aria-hidden","true"),searchSubmit.attr("aria-hidden","true")):(element.find(".overlay-search").removeClass("open").attr("aria-hidden","true"),element.find(".mute-screen").removeClass("on"),overlaySearchForm.attr("aria-hidden","true"),overlaySearchSubmit.attr("aria-hidden","true"),nav.attr("aria-hidden","false"),content.attr("aria-hidden","false"),angular.element("body").off("keyup",trapTab)),megaNav&&(search.removeEventListener("mouseup",closeSearch),element[0].querySelector(".search-bar").classList.add("closed"),element[0].querySelector(".search-bar").setAttribute("aria-hidden","true"),element[0].querySelector(".search-bar .form-group").setAttribute("aria-hidden","true"),element[0].querySelector(".search-bar .search-submit").setAttribute("aria-hidden","true"),element[0].querySelector(".corp-search .icon").classList.remove("close"),attachHover(),search.addEventListener("mouseup",expandCorpSearch))}function trapTab(){var focusedItem=angular.element(document.activeElement),inModal=focusedItem.closest(".trap").length?!0:!1;inModal||element.find(".trap button.close").focus()}function expandMenu(){body.addClass("no-scroll"),element.find(".mute-screen").addClass("on"),element.find(".overlay-menu").css("display","block").css("visibility","visible").attr("aria-hidden","false"),$timeout(function(){element.find(".overlay-menu").addClass("open"),$window.addEventListener("click",watchClickOutside)},20),element.find(".hamburger").attr("aria-expanded",!0),angular.element(".overlay-menu button.close").focus(),nav.attr("aria-hidden","true"),content.attr("aria-hidden","true"),angular.element("body").on("keyup",trapTab),closeSearch()}function watchClickOutside(){element[0].querySelector(".overlay-menu").contains(event.target)===!1&&closeMenu()}function closeMenu(){$window.removeEventListener("click",watchClickOutside),nav.attr("aria-hidden","false"),content.attr("aria-hidden","false"),angular.element("body").off("keyup",trapTab),element.find(".overlay-menu").removeClass("open").css("display","none").css("visibility","hidden").attr("aria-hidden","true"),element.find(".mute-screen").removeClass("on"),element.find(".hamburger").attr("aria-expanded",!1),body.removeClass("no-scroll"),hamburger.focus()}function megaA11y(e){var nextItem;if(-1!==[9,13,32,37,38,39,40].indexOf(e.which))switch(e.which){case 9:break;case 13:e.preventDefault(),e.stopPropagation(),e.currentTarget.classList.toggle("active"),e.currentTarget.setAttribute("aria-expanded","true"),megaNav.classList.add("open"),megaNav.classList.remove("closed");break;case 32:break;case 37:nextItem=primaryLinksArray.indexOf(e.currentTarget),primaryLinks[nextItem-1].focus();break;case 39:nextItem=primaryLinksArray.indexOf(e.currentTarget),primaryLinks[nextItem+1].focus()}}function cleanup(){closeMenu(),closeSearch(),$document.off("scroll",onScroll_window),megaNav||search.off("click tap keyup",expandSearch),hamburger.off("click tap",expandMenu),element.find(".overlay-menu button.close").off("click tap",closeMenu),element.find(".overlay-search .search-form").off("submit",onSubmit_overlaySearch)}var search,primaryLinks,primaryLinksArray,hoverContainer,win=angular.element($window),body=angular.element("body"),megaNav=element[0].querySelector("nav.mega-nav"),hamburger=element.find(".hamburger"),searchForm=element.find(".search .form-group"),searchSubmit=element.find(".search .search-submit"),overlaySearchForm=element.find(".overlay-search .form-group"),overlaySearchInput=element.find(".overlay-search .form-group #searchText"),overlaySearchSubmit=element.find(".overlay-search .search-submit"),nav=element.find("nav.main-nav"),skip=angular.element(".skip-link"),content=angular.element(".content"),wcmMode=$cookies.get("wcmmode"),isIOS=utils.getOS();skip.on("click tap",skipFocus),$document.on("scroll",_.throttle(onScroll_window,100)),hamburger.on("click tap",expandMenu),$timeout(function(){element.find(".overlay-menu").css("display","none"),element.find(".overlay-menu button.close").on("click tap",closeMenu)},0),element.find(".overlay-search .search-form").on("submit",onSubmit_overlaySearch),element.find("[data-analytics-id]").on("click",onClick_navigationElement),megaNav?(hoverContainer=element[0].querySelector(".hover-cont"),primaryLinks=element[0].querySelectorAll(".primary-link"),primaryLinksArray=Array.prototype.slice.call(element[0].querySelectorAll(".primary-link")),search=element[0].querySelector(".corp-search .icon.slide"),search.addEventListener("mouseup",expandCorpSearch),lodash.forEach(primaryLinks,function(el){el.addEventListener("keyup",megaA11y),el.addEventListener("mouseup",function(e){lodash.forEach(primaryLinks,function(ell){ell.classList.remove("active")}),e.currentTarget.classList.add("active"),e.currentTarget.setAttribute("aria-expanded","true"),megaNav.classList.add("open"),megaNav.classList.remove("closed")})}),"edit"!==wcmMode&&(search.addEventListener("mouseup",expandCorpSearch),search.addEventListener("mouseup",expandCorpSearch),attachHover(),viewport.onBreakpointChange(attachHover))):(search=element.find(".search .icon.slide"),search.on("click tap",expandSearch)),scope.$on("$destroy",cleanup),toggleStickyHeader()}}}navigation.$inject=["$window","$document","$location","$timeout","$cookies","viewport","analyticsUtils","utils"],angular.module("marketingCore").directive("navigation",navigation)}(angular,window._),function(angular){"use strict";function validateFilter(){return function(ccnumber,isNameRequired){if(!ccnumber)return"";ccnumber=ccnumber.toString().replace(/\s+/g,"");for(var cardType,cardName,valid,len=ccnumber.length,mul=0,prodArr=[[0,1,2,3,4,5,6,7,8,9],[0,2,4,6,8,1,3,5,7,9]],sum=0;len--;)sum+=prodArr[mul][parseInt(ccnumber.charAt(len),10)],mul^=1;return valid=sum%10===0&&sum>0?"valid":"not valid",/^(34)|^(37)/.test(ccnumber)?(cardType="cc-image amex-image",cardName="American Express"):/^(62)|^(88)/.test(ccnumber)?(cardType="cc-image default-image",cardName="China UnionPay"):/^30[0-5]/.test(ccnumber)?(cardType="cc-image default-image",cardName="Diners Club Carte Blanche"):/^(2014)|^(2149)/.test(ccnumber)?(cardType="cc-image default-image",cardName="Diners Club enRoute"):/^36/.test(ccnumber)?(cardType="cc-image default-image",cardName="Diners Club International"):/^(6011)|^(622(1(2[6-9]|[3-9][0-9])|[2-8][0-9]{2}|9([01][0-9]|2[0-5])))|^(64[4-9])|^65/.test(ccnumber)?(cardType="cc-image disc-image",cardName="Discover Card"):/^35(2[89]|[3-8][0-9])/.test(ccnumber)?(cardType="cc-image default-image",cardName="JCB"):/^(6304)|^(6706)|^(6771)|^(6709)/.test(ccnumber)?(cardType="cc-image default-image",cardName="Laser"):/^(5018)|^(5020)|^(5038)|^(5893)|^(6304)|^(6759)|^(6761)|^(6762)|^(6763)|^(0604)/.test(ccnumber)?(cardType="cc-image default-image",cardName="Maestro"):/^5[1-5]|^2/.test(ccnumber)?(cardType="cc-image mc-image",cardName="MasterCard"):/^(4026)|^(417500)|^(4405)|^(4508)|^(4844)|^(4913)|^(4917)/.test(ccnumber)?(cardType="cc-image visa-image",cardName="Visa-Electron"):/^4/.test(ccnumber)?(cardType="cc-image visa-image",cardName="Visa"):(cardType="",cardName=""),isNameRequired?cardName:cardType}}angular.module("tmobileCheckOut").filter("validate",validateFilter)}(window.angular),function(angular){"use strict";function newsroomContentCarousel($window,$compile,utils,analyticsUtils,viewport,$timeout){return{restrict:"A",link:function(scope,element,attr){function onInit(e,slick){!viewport.breakpointUp("desktop")&&utils.isTouch()&&(element[0].className+=" touch-device");var slickCloned=element[0].querySelectorAll(".slick-cloned");angular.forEach(slickCloned,function(slickClone){$compile(angular.element(slickClone))(scope)}),element.one("click",scope.slickConfig.method.slickPause),slick.$slider[0].style.opacity="1",angular.element($window).triggerHandler("resize")}function navOnInit(e,slick){function bindEvent(t){var td=pips[t];angular.isFunction(window.addEventListener)&&td.addEventListener("click",function(event){event.preventDefault(),event.stopPropagation();var slide=utils.getClosest(event.target,".pip-link");_.forEach(element[0].querySelectorAll(".pip-link"),function(slideElem){slideElem.classList.remove("navCurrent")}),slide.classList.add("navCurrent"),scope.slickConfig.method.slickGoTo(t),$timeout(function(){analyticsUtils.trackCarousel(next>prevSlide,element)},500)})}for(var i=0;i<pips.length;i++)pips[i].classList.contains("slick-current")&&pips[i].classList.add("navCurrent"),bindEvent(i)}function onSwipe(e,slick,direction){var trackingNav;trackingNav="left"===direction?!0:!1;var currentSlide=element[0].querySelector(".content-slick-carousel .slick-current").getAttribute("data-slick-index");_.forEach(element[0].querySelectorAll(".pip-link"),function(slideElem){slideElem.classList.remove("navCurrent")}),element[0].querySelector('.pip-link[data-slick-index="'+currentSlide+'"]').classList.add("navCurrent"),analyticsUtils.trackCarousel(trackingNav,element)}function onBeforeChange(e,slick,currentSlide,nextSlide){prevSlide=currentSlide,next=nextSlide,_.forEach(element[0].querySelectorAll(".pip-link"),function(slideElem){slideElem.classList.remove("navCurrent")}),element[0].querySelector('.pip-link[data-slick-index="'+next+'"]').classList.add("navCurrent")}function disableAutoPlay(){scope.slickConfig.autoplay=!1,scope.slickNav.autoplay=!1}function cleanup(){scope.slickConfig&&(scope.slickConfig.method.unslick(),scope.slickNav.method.unslick())}var prevSlide,next,disablePlay=element[0].getAttribute("data-disableautorotate"),pips=element[0].querySelectorAll(".pip-link");"true"===disablePlay&&disableAutoPlay(),scope.slickConfig&&(scope.slickConfig.event.init=onInit,scope.slickConfig.event.beforeChange=onBeforeChange,scope.slickConfig.event.swipe=onSwipe),scope.slickNav&&(scope.slickNav.event.init=navOnInit,scope.slickNav.event.beforeChange=onBeforeChange,scope.slickConfig.event.swipe=onSwipe),scope.$on("$destroy",cleanup)}}}newsroomContentCarousel.$inject=["$window","$compile","utils","analyticsUtils","viewport","$timeout"],angular.module("marketingCore").directive("newsroomContentCarousel",newsroomContentCarousel)}(angular),function(angular){"use strict";function maskFilterFn(){return function(inputValue,filterType){var crNumber;return angular.equals(filterType,"creditCard")&&angular.isDefined(inputValue)?crNumber=inputValue.replace(/.(?=.{4})/g,"#"):angular.equals(filterType,"cvvNumber")&&angular.isDefined(inputValue)&&(crNumber=inputValue.replace(/.(?=)/g,"#")),crNumber}}angular.module("tmobileCheckOut").filter("maskFilter",maskFilterFn)}(angular),function(angular,lodash){"use strict";function offersCarousel(utils,$compile,analyticsUtils,viewport,$timeout){return{restrict:"A",link:function(scope,element,attr){function onInit(e,slick){var disablePlay=element[0].getAttribute("data-disableautorotate"),clonedCard=element[0].querySelectorAll(".slick-cloned"),cardHeight=element[0].querySelector(".slick-track").clientHeight,offerCard=element[0].querySelectorAll(".offers-component");"true"===disablePlay&&disableAutoPlay(),!viewport.breakpointUp("desktop")&&utils.isTouch()&&(element[0].className+=" touch-device"),lodash.forEach(offerCard,function(card){card.addEventListener("click",scope.slickConfig.method.slickPause),card.style.height=cardHeight+"px"});var btnPrev=element[0].querySelector(".slick-prev");$compile(btnPrev)(scope);var invisibleCards=element[0].querySelectorAll('[data-slick-index^="-"]');lodash.forEach(invisibleCards,function(invisibleCard){invisibleCard.style.visibility="hidden"}),$timeout(function(){clickItems=element[0].querySelectorAll(".slick-dots button, .slick-arrow"),lodash.forEach(clickItems,function(item){item.addEventListener("click",slickTrackCarouselClick())})},500),lodash.forEach(clonedCard,function(el,i){null!==el.querySelector("[modal-content]")&&(el.querySelector("[modal-content]").removeAttribute("data-modal"),el.querySelector("[modal-content]").removeAttribute("modal-content")),null!==el.querySelector(".legal-modal")&&el.querySelector(".legal-modal").removeAttribute("data-modal-id"),$compile(angular.element(el))(scope)}),slick.$slider[0].style.opacity="1"}function slickTrackCarouselClick(){return function(){$timeout(function(){scope.slickConfig.method.slickPause(),analyticsUtils.trackCarousel(next>prevSlide,element)},500)}}function onAfterChange(e,slick,currentSlide){var invisibleCards=element[0].querySelectorAll('[data-slick-index^="-"]');lodash.forEach(invisibleCards,function(invisibleCard){
invisibleCard.style.visibility="visible"}),scope.isOnFirst=!1}function onBeforeChange(e,slick,currentSlide,nextSlide){next=nextSlide,prevSlide=currentSlide}function disableAutoPlay(){scope.slickConfig.autoplay=!1}function cleanup(){scope.slickConfig&&(clickItems.forEach(function(item){item.removeEventListener("click",slickTrackCarouselClick(),!1)}),scope.slickConfig.method.unslick())}function onSwipe(e,slick,direction){var trackingNav;trackingNav="left"===direction?!0:!1,analyticsUtils.trackCarousel(trackingNav,element)}var prevSlide,next,clickItems;scope.slickConfig&&(scope.slickConfig.event.init=onInit,scope.slickConfig.event.afterChange=onAfterChange,scope.slickConfig.event.beforeChange=onBeforeChange,scope.slickConfig.event.swipe=onSwipe),scope.$on("$destroy",cleanup)}}}offersCarousel.$inject=["utils","$compile","analyticsUtils","viewport","$timeout"],angular.module("marketingCore").directive("offersCarousel",offersCarousel)}(window.angular,window._),function(angular){"use strict";function toolTipFn($window,$timeout,$log){return{restrict:"A",link:function($scope,$element){function setToolTipPosition(){var y=$window.innerHeight,y1=$element.offset().top-$window.pageYOffset,ypercent=y1/y*100;ypercent>=0&&50>=ypercent?$scope.placement="bottom":$scope.placement="top",counter++,$timeout(function(){$window.innerWidth<=768&&(leftShift=23),$window.innerWidth>=1024&&(leftShift=80),$log.log(angular.element(".popover.fade.in")),parseInt(angular.element(".popover.fade.in").css("left",parseInt(angular.element(".popover.fade.in").css("left"))+leftShift))},10)}function triggerClickEvent(){counter++,counter>2&&($element.blur(),counter=0)}var counter=0,leftShift=80;$element.bind("click",triggerClickEvent),$element.bind("focus",setToolTipPosition),$element.bind("blur",function(){counter=0})}}}toolTipFn.$inject=["$window","$timeout","$log"];var moduleName="tmobileApp",directiveName="toolTip";angular.module(moduleName).directive(directiveName,toolTipFn)}(window.angular),function(angular,lodash){"use strict";function offersFilter($window,$location,$timeout,viewport,analyticsUtils){return{restrict:"A",link:function(scope,element,attr){function onBreakpointChange(){headerHeight="true"===$window.isOsNav?angular.element("#header_navbar").outerHeight():angular.element(".global-header").outerHeight()}function onClickFilter(e){hasClicked=!0;var filterName=e.currentTarget.getAttribute("data-filter-name");$location.search({filter:filterName}),performDeepLink(),$timeout(function(){win.scroll()},500)}function onScrollWindow(){toggleStickyFilter()}function performDeepLink(){($location.search().filter||$location.search().section)&&filter($location.search().filter,$location.search().section)}function filter(filterName,moduleId){var name=filterName||"view-all";if(includedAnalyticsIds=[],filterButtons.removeClass("active").filter('[data-filter-name="'+name+'"]').addClass("active").focus(),moduleId||angular.element("html, body").animate({scrollTop:elementTop-(viewport.breakpointUp("desktop")?55:49)},500),"view-all"===name)includedModules=filterData.modules,excludedModules=[];else{var selectedFilter=lodash.find(filterData.filters,function(filter){return filter.name===name}),filterTags=selectedFilter.tags;includedModules=lodash.filter(filterData.modules,function(module){return 0===module.tags.length||lodash.find(filterTags,function(filterTag){return lodash.find(module.tags,function(moduleTag){return moduleTag===filterTag})})}),excludedModules=lodash.filter(filterData.modules,function(module){return module.tags.length>0&&!lodash.find(filterTags,function(filterTag){return lodash.find(module.tags,function(moduleTag){return moduleTag===filterTag})})})}lodash.each(excludedModules,function(module){var section=angular.element('[data-module-id="'+module.id+'"]');section.length&&(section.attr("aria-hidden",!0).addClass("filter-section filter-excluded"),section.find(".slick-slide").addClass("filter-excluded"))}),lodash.each(includedModules,function(module){var section=angular.element('[data-module-id="'+module.id+'"]');section.length&&(includedAnalyticsIds.push(section.attr("data-analytics-id")),section.is(".offers-carousel")&&section.find('.offers-component[data-analytics-id]:not(".slick-cloned")').each(function(i,el){includedAnalyticsIds.push(el.getAttribute("data-analytics-id"))}),section.attr("aria-hidden",!1).removeClass("filter-excluded"),section.find(".slick-slide").removeClass("filter-excluded"))}),moduleId&&$timeout(function(){scrollToModule(moduleId)},500),isAnalyticsLoaded?track(name):$timeout(function(){track(name),analyticsUtils.getAnalytics().then(function(){isAnalyticsLoaded=!0})},500)}function track(name){var evt={eventInfo:{eventAction:"filter",eventType:hasClicked?"click":"load"},eventDescription:{filterName:element.find('[data-filter-name="'+name+'"]').attr("data-filter-text"),moduleArray:"view-all"===name?[element.find('[data-filter-name="view-all"]').attr("data-filter-text")]:includedAnalyticsIds}};analyticsUtils.pushEvent("CLICK_EVENT",evt)}function scrollToModule(moduleId){var section=angular.element('[data-module-id="'+moduleId+'"]');$window.scrollTo(0,section.offset().top-(viewport.breakpointUp("desktop")?61:49)-angular.element(".offers-filter-component").outerHeight())}function toggleStickyFilter(){var scrollTop=win.scrollTop();scrollTop>elementTop-headerHeight?("true"===$window.isOsNav?element.addClass("ntm-sticky-filter"):element.addClass("sticky-filter"),contentContainer.addClass("sticky-filter-top-padding")):("true"===$window.isOsNav?element.removeClass("ntm-sticky-filter"):element.removeClass("sticky-filter"),contentContainer.removeClass("sticky-filter-top-padding"))}function cleanup(){win.off("scroll.offersFilter")}var elementTop,win=angular.element($window),filterButtons=element.find("li button"),contentContainer=angular.element(".marketing-page > .content"),headerHeight="true"===$window.isOsNav?angular.element("#header_navbar").outerHeight():angular.element(".global-header").outerHeight(),hasClicked=!1,isAnalyticsLoaded=!1,filterData=angular.fromJson(attr.filters),includedModules=[],includedAnalyticsIds=[],excludedModules=[];element.on("click","button",onClickFilter),win.on("scroll.offersFilter",lodash.throttle(onScrollWindow,100)),viewport.onBreakpointChange(onBreakpointChange,!0),scope.$on("$destroy",cleanup),$timeout(function(){elementTop=element.offset().top,toggleStickyFilter(),angular.isDefined($window.hasModulePicker)?scope.$on("modulePickersCompleted",function(){performDeepLink()}):$timeout(function(){performDeepLink()},500)},0)}}}offersFilter.$inject=["$window","$location","$timeout","viewport","analyticsUtils"],angular.module("marketingCore").directive("offersFilter",offersFilter)}(window.angular,window._),function(angular){"use strict";function scrollToTopFn($timeout,$anchorScroll){return{link:function(scope,element,attrs){"false"!==attrs.scrollToTop?$timeout(function(){angular.element("html,body").animate({scrollTop:0},0)}):$anchorScroll("billing")}}}var moduleName="tmobileCheckOut",directiveName="scrollToTop";angular.module(moduleName).directive(directiveName,scrollToTopFn)}(angular),function(angular){"use strict";function onTouchstart(){return{restrict:"A",link:function($scope,$element){function onTouchStart(event){var method=$element.attr("on-touchstart");$scope.$event=event,$scope.$apply(method)}$element.bind("touchstart",onTouchStart)}}}function onTouchmove(){return{restrict:"A",link:function($scope,$element){function onTouchMove(event){var method=$element.attr("on-touchmove");$scope.$event=event,$scope.$apply(method)}$element.bind("touchmove",onTouchMove)}}}function onTouchend(){return{restrict:"A",link:function($scope,$element){function onTouchEnd(event){var method=$element.attr("on-touchend");$scope.$event=event,$scope.$apply(method)}$element.bind("touchend",onTouchEnd)}}}angular.module("marketingCore").directive("onTouchstart",onTouchstart).directive("onTouchmove",onTouchmove).directive("onTouchend",onTouchend)}(angular),function(angular,lodash){"use strict";function poBoxValidatorFn(checkOutValidationUtil){return{require:"ngModel",link:function(scope,element,attrs,ngModelCtrl){function listener(){checkOutValidationUtil.poBoxValidator(element.val(),ngModelCtrl)}scope.vm.formData&&("ship"===scope.vm.addressType.type||_.isUndefined(scope.vm.formData.disclaimer))&&(lodash.includes(ngModelCtrl.$name,"Address2")&&checkOutValidationUtil.poBoxValidator(scope.vm.formData.address2,ngModelCtrl),lodash.includes(ngModelCtrl.$name,"Address1")&&checkOutValidationUtil.poBoxValidator(scope.vm.formData.address1,ngModelCtrl)),element.bind("blur",listener)}}}poBoxValidatorFn.$inject=["checkOutValidationUtil"],angular.module("tmobileApp").directive("poBoxValidator",poBoxValidatorFn)}(window.angular,window._),function(angular){"use strict";function pageContent($timeout,$anchorScroll,$window,utils,analyticsUtils,$document){return{restrict:"A",link:function(scope,element,attr){function onClickActionableElement(e){analyticsUtils.trackActionableElementClick(e.currentTarget,utils.getPageReach(win,html))}function isViewed(section){return section.offset().top+section.height()<=win.scrollTop()+win.height()&&section.offset().top+section.height()/2>=win.scrollTop()?!0:!1}function trackModuleVisibility(){modules.each(function(i,el){var excludedModules=el.classList.contains("filter-excluded");if(isViewed(angular.element(el))===!0&&!angular.element(el).hasClass("display-dialog")&&!excludedModules){var moduleId=angular.element(el).attr("data-module-id");-1===trackedModuleIds.indexOf(moduleId)&&(trackedModuleIds.push(moduleId),analyticsUtils.trackModuleView(angular.element(el)))}})}function updateMaxScrollTop(){htmlCurrentHeight!==html.height()&&(maxScrollTop=win.scrollTop(),htmlCurrentHeight=html.height()),maxScrollTop=Math.max(win.scrollTop(),maxScrollTop)}function cleanup(){win.off("scroll.pageReach scroll.moduleVisibility")}var win=angular.element($window),modules=element.find("[data-module-id][data-analytics-id]"),trackedModuleIds=[],html=angular.element("html"),htmlCurrentHeight=html.height(),maxScrollTop=0;win.on("scroll.pageReach",_.throttle(updateMaxScrollTop,100)),win.on("scroll.moduleVisibility",_.throttle(trackModuleVisibility,10)),element.on("click","button[data-analytics-id], a[data-analytics-id], [role=button][data-analytics-id]",onClickActionableElement),element.on("click",".section-legal a.tmo-modal-link",function(a){analyticsUtils.trackGenericClick(a.currentTarget)}),scope.$on("domContentReplaced",function(){modules=element.find("[data-module-id][data-analytics-id]")}),scope.$on("modulePickersCompleted",function(){$window.isPagePicker||analyticsUtils.trackAsyncPage("Module Picker","","")}),scope.$on("$destroy",cleanup),$timeout(function(){var head=angular.element(".global-header").height(),filter=angular.element(".offers-filter-component").height()||0,offset=head+filter;$anchorScroll.yOffset=offset,$anchorScroll()},0)}}}pageContent.$inject=["$timeout","$anchorScroll","$window","utils","analyticsUtils","$document"],angular.module("marketingCore").directive("pageContent",pageContent)}(angular),function(angular){"use strict";function onlyCharInputFn($browser){return{require:"ngModel",link:function($scope,$element,$attrs,ngModelCtrl){var listener;listener=function(){if("city"!==$attrs.onlyCharInput&&"address"!==$attrs.onlyCharInput&&"email"!==$attrs.onlyCharInput&&"idNumber"!==$attrs.onlyCharInput){var cursorPos=$element[0].selectionStart,accentedCharacters="ÀàÁáÂâẦầẤấẪẫẨẩÃãÃ̀ã̀Ã́ã́Ã̂ã̂Ã̌ã̌Ã̍ã̍Ã̎ã̎ĀāĀ̀ā̀Ā́ā́Ā̂ā̂Ā̃ā̃Ā̃́ā̃́Ā̄ā̄Ā̆ā̆Ā̆́ā̆́Ā̈ā̈Ā̊ā̊Ā̌ā̌ĂăẰằẮắẴẵẲẳȦȧȦ́ȧ́ǠǡÄäÄ́ä́Ä̀ä̀Ä̂ä̂Ä̃ä̃ǞǟǞ̆ǟ̆Ä̆ä̆Ä̌ä̌ẢảÅåǺǻÅ̂å̂Å̃å̃Å̄å̄Å̄̆å̄̆Å̆å̆A̋a̋ǍǎA̍a̍A̎a̎ȀȁȂȃA̐a̐A̓a̓A̧a̧À̧à̧Á̧á̧Â̧â̧Ǎ̧ǎ̧A̭a̭A̰a̰À̰à̰Á̰á̰Ā̰ā̰Ä̰ä̰Ä̰́ä̰́ĄąĄ̀ą̀Ą́ą́Ą̂ą̂Ą̃ą̃Ą̄ą̄Ą̄̀ą̄̀Ą̄́ą̄́Ą̄̂ą̄̂Ą̄̌ą̄̌Ą̇ą̇Ą̈ą̈Ą̈̀ą̈̀Ą̈́ą̈́Ą̈̂ą̈̂Ą̈̌ą̈̌Ą̈̄ą̈̄Ą̊ą̊Ą̌ą̌Ą̋ą̋Ą̱ą̱Ą̱̀ą̱̀Ą̱̀ą̱̀A᷎a᷎A̱a̱À̱à̱Á̱á̱Â̱â̱Ã̱ã̱Ā̱ā̱Ā̱̀ā̱̀Ā̱́ā̱́Ā̱̂ā̱̂Ä̱ä̱Ä̱̀ä̱̀Ä̱́ä̱́Ä̱̂ä̱̂Ä̱̌ä̱̌Å̱å̱Ǎ̱ǎ̱A̱̥a̱̥ẠạẠ́ạ́Ạ̀ạ̀ẬậẠ̃ạ̃Ạ̄ạ̄ẶặẠ̈ạ̈Ạ̈̀ạ̈̀Ạ̈́ạ̈́Ạ̈̂ạ̈̂Ạ̈̌ạ̈̌Ạ̌ạ̌Ạ̍ạ̍A̤a̤À̤à̤Á̤á̤Â̤â̤Ä̤ä̤ḀḁḀ̂ḁ̂Ḁ̈ḁ̈A̯a̯A̩a̩À̩à̩Á̩á̩Â̩â̩Ã̩ã̩Ā̩ā̩Ǎ̩ǎ̩A̩̍a̩̍A̩̓a̩̓A͔a͔Ā͔ā͔ȺⱥȺ̀ⱥ̀Ⱥ́ⱥ́ᶏⱭ̀ɑ̀Ɑ́ɑ́Ɑ̂ɑ̂Ɑ̃ɑ̃Ɑ̄ɑ̄Ɑ̆ɑ̆Ɑ̇ɑ̇Ɑ̈ɑ̈Ɑ̊ɑ̊Ɑ̌ɑ̌ᶐB̀b̀B́b́B̂b̂B̃b̃B̄b̄ḂḃB̈b̈B̕b̕ḆḇḆ̂ḇ̂ḄḅB̤b̤B̥b̥B̬b̬ɃƀᵬᶀƁɓƂƃʙ̇ʙ̣C̀c̀ĆćĈĉC̃c̃C̄c̄C̄́c̄́C̆c̆ĊċC̈c̈ČčČ́č́Č͑č͑Č̓č̓Č̕č̕Č͑č͑C̋c̋C̓c̓C̕c̕C̔c̔C͑c͑ÇçḈḉÇ̆ç̆Ç̇ç̇Ç̌ç̌C̦c̦C̭c̭C̱c̱C̮c̮C̣c̣Ć̣ć̣Č̣č̣C̥c̥C̬c̬C̯c̯C̨c̨ȻȼȻ̓ȼ̓ꞒꞓƇƈɕꜾꜿD́d́D̂d̂D̃d̃D̄d̄ḊḋD̊d̊ĎďD̑d̑D̓d̓D̕d̕ḐḑD̦d̦ḒḓḎḏD̮d̮ḌḍḌ́ḍ́D̤d̤D̥d̥D̬d̬D̪d̪ĐđĐ̱đ̱ᵭᶁƉɖƊɗᶑƋƌȡꝹ́ꝺ́Ꝺ̇ꝺ̇ᴅ̇ᴅ̣Ð́ð́Ð̣ð̣ÈèÉéÊêỀềẾếỄễÊ̄ê̄Ê̆ê̆Ê̌ê̌ỂểẼẽẼ̀ẽ̀Ẽ́ẽ́Ẽ̂ẽ̂Ẽ̌ẽ̌Ẽ̍ẽ̍Ẽ̎ẽ̎ĒēḔḕḖḗĒ̂ē̂Ē̃ē̃Ē̃́ē̃́Ē̄ē̄Ē̆ē̆Ē̆́ē̆́Ē̌ē̌Ē̑ē̑ĔĕĔ̀ĕ̀Ĕ́ĕ́Ĕ̄ĕ̄ĖėĖ́ė́Ė̃ė̃Ė̄ė̄ËëË̀ë̀Ë́ë́Ë̂ë̂Ë̃ë̃Ë̄ë̄Ë̌ë̌ẺẻE̊e̊E̊̄e̊̄E̋e̋ĚěĚ́ě́Ě̃ě̃Ě̋ě̋Ě̑ě̑E̍e̍E̎e̎ȄȅȆȇE̓e̓E᷎e᷎ȨȩȨ̀ȩ̀Ȩ́ȩ́Ȩ̂ȩ̂ḜḝȨ̌ȩ̌Ẽ̦ẽ̦ĘęĘ̀ę̀Ę́ę́Ę̂ę̂Ę̃ę̃Ę̃́ę̃́Ę̄ę̄Ę̄̀ę̄̀Ę̄́ę̄́Ę̄̂ę̄̂Ę̄̃ę̄̃Ę̄̌ę̄̌Ę̆ę̆Ę̇ę̇Ę̇́ę̇́Ę̈ę̈Ę̈̀ę̈̀Ę̈́ę̈́Ę̈̂ę̈̂Ę̈̌ę̈̌Ę̈̄ę̈̄Ę̋ę̋Ę̌ę̌Ę̑ę̑Ę̱ę̱Ę̱̀ę̱̀Ę̱́ę̱́Ę̣ę̣Ę᷎ę᷎ḘḙḚḛE̱e̱È̱è̱É̱é̱Ê̱ê̱Ẽ̱ẽ̱Ē̱ē̱Ḕ̱ḕ̱Ḗ̱ḗ̱Ē̱̂ē̱̂Ë̱ë̱Ë̱̀ë̱̀Ë̱́ë̱́Ë̱̂ë̱̂Ë̱̌ë̱̌Ě̱ě̱E̮e̮Ē̮ē̮ẸẹẸ̀ẹ̀Ẹ́ẹ́ỆệẸ̃ẹ̃Ẹ̄ẹ̄Ẹ̄̀ẹ̄̀Ẹ̄́ẹ̄́Ẹ̄̃ẹ̄̃Ẹ̆ẹ̆Ẹ̆̀ẹ̆̀Ẹ̆́ẹ̆́Ẹ̈ẹ̈Ẹ̈̀ẹ̈̀Ẹ̈́ẹ̈́Ẹ̈̂ẹ̈̂Ẹ̈̌ẹ̈̌Ẹ̍ẹ̍Ẹ̌ẹ̌Ẹ̑ẹ̑E̤e̤È̤è̤É̤é̤Ê̤ê̤Ë̤ë̤E̥e̥E̯e̯E̩e̩È̩è̩É̩é̩Ê̩ê̩Ẽ̩ẽ̩Ē̩ē̩Ě̩ě̩E̩̍e̩̍E̩̓e̩̓È͕è͕Ê͕ê͕Ẽ͕ẽ͕Ē͕ē͕Ḕ͕ḕ͕E̜e̜E̹e̹È̹è̹É̹é̹Ê̹ê̹Ẽ̹ẽ̹Ē̹ē̹Ḕ̹ḕ̹ɆɇᶒⱸᶕᶓɚᶔɝƐ̀ɛ̀Ɛ́ɛ́Ɛ̂ɛ̂Ɛ̃ɛ̃Ɛ̃̀ɛ̃̀Ɛ̃́ɛ̃́Ɛ̃̂ɛ̃̂Ɛ̃̌ɛ̃̌Ɛ̃̍ɛ̃̍Ɛ̃̎ɛ̃̎Ɛ̄ɛ̄Ɛ̆ɛ̆Ɛ̇ɛ̇Ɛ̈ɛ̈Ɛ̈̀ɛ̈̀Ɛ̈́ɛ̈́Ɛ̈̂ɛ̈̂Ɛ̈̌ɛ̈̌Ɛ̌ɛ̌Ɛ̍ɛ̍Ɛ̎ɛ̎Ɛ̣ɛ̣Ɛ̣̀ɛ̣̀Ɛ̣́ɛ̣́Ɛ̣̂ɛ̣̂Ɛ̣̃ɛ̣̃Ɛ̣̈ɛ̣̈Ɛ̣̈̀ɛ̣̈̀Ɛ̣̈́ɛ̣̈́Ɛ̣̈̂ɛ̣̈̂Ɛ̣̈̌ɛ̣̈̌Ɛ̣̌ɛ̣̌Ɛ̤ɛ̤Ɛ̤̀ɛ̤̀Ɛ̤́ɛ̤́Ɛ̤̂ɛ̤̂Ɛ̤̈ɛ̤̈Ɛ̧ɛ̧Ɛ̧̀ɛ̧̀Ɛ̧́ɛ̧́Ɛ̧̂ɛ̧̂Ɛ̧̌ɛ̧̌Ɛ̨ɛ̨Ɛ̨̀ɛ̨̀Ɛ̨́ɛ̨́Ɛ̨̂ɛ̨̂Ɛ̨̄ɛ̨̄Ɛ̨̆ɛ̨̆Ɛ̨̈ɛ̨̈Ɛ̨̌ɛ̨̌Ɛ̰ɛ̰Ɛ̰̀ɛ̰̀Ɛ̰́ɛ̰́Ɛ̰̄ɛ̰̄Ɛ̱ɛ̱Ɛ̱̀ɛ̱̀Ɛ̱́ɛ̱́Ɛ̱̂ɛ̱̂Ɛ̱̃ɛ̱̃Ɛ̱̈ɛ̱̈Ɛ̱̈̀ɛ̱̈̀Ɛ̱̈́ɛ̱̈́Ɛ̱̌ɛ̱̌Ə̀ə̀Ə́ə́Ə̂ə̂Ə̄ə̄Ə̌ə̌F̀f̀F́f́F̃f̃F̄f̄ḞḟF̓f̓F̧f̧ᵮᶂƑƒF̱f̱F̣f̣ꜰ̇Ꝼ́ꝼ́Ꝼ̇ꝼ̇Ꝼ̣ꝼ̣G̀g̀ǴǵǴ̄ǵ̄ĜĝG̃g̃G̃́g̃́ḠḡḠ́ḡ́ĞğĠġG̈g̈G̈̇g̈̇G̊g̊G̋g̋ǦǧǦ̈ǧ̈G̑g̑G̒g̒G̓g̓G̕g̕G̔g̔ĢģG̦g̦G̱g̱G̱̓g̱̓G̮g̮G̣g̣G̤g̤G̥g̥G̫g̫ꞠꞡǤǥᶃƓɠɢ̇ɢ̣ʛƔ̓ɣ̓H̀h̀H́h́ĤĥH̄h̄ḢḣḦḧȞȟH̐h̐H̓h̓H̕h̕ḨḩH̨h̨H̭h̭H̱ẖḪḫḤḥḤ̣ḥ̣H̤h̤H̥h̥H̬h̬H̯h̯ĦħĦ̥ħ̥ꞪɦⱧⱨh̢ʜ̇ɧÌìÍíÎîÎ́î́ĨĩĨ́ĩ́Ĩ̀ĩ̀Ĩ̂ĩ̂Ĩ̌ĩ̌Ĩ̍ĩ̍Ĩ̎ĩ̎ĪīĪ́ī́Ī̀ī̀Ī̂ī̂Ī̌ī̌Ī̃ī̃Ī̄ī̄Ī̆ī̆Ī̆́ī̆́ĬĭĬ̀ĭ̀Ĭ́ĭ́İiIıİ́i̇́ÏïÏ̀ï̀ḮḯÏ̂ï̂Ï̃ï̃Ï̄ï̄Ï̌ï̌Ï̑ï̑I̊i̊I̋i̋ǏǐỈỉI̍i̍I̎i̎ȈȉI̐i̐ȊȋI᷎i᷎ĮįĮ̀į̀Į́į́į̇́Į̂į̂Į̃į̃į̇̃Į̄į̄Į̄̀į̄̀Į̄́į̄́Į̄̂į̄̂Į̄̆į̄̆Į̄̌į̄̌Į̈į̈Į̈̀į̈̀Į̈́į̈́Į̈̂į̈̂Į̈̌į̈̌Į̈̄į̈̄Į̋į̋Į̌į̌Į̱į̱Į̱́į̱́Į̱̀į̱̀I̓i̓I̧i̧Í̧í̧Ì̧ì̧Î̧î̧I̭i̭Ī̭ī̭ḬḭḬ̀ḭ̀Ḭ́ḭ́Ḭ̄ḭ̄Ḭ̈ḭ̈Ḭ̈́ḭ̈́I̱i̱Ì̱ì̱Í̱í̱Î̱î̱Ǐ̱ǐ̱Ĩ̱ĩ̱Ï̱ï̱Ḯ̱ḯ̱Ï̱̀ï̱̀Ï̱̂ï̱̂Ï̱̌ï̱̌Ī̱ī̱Ī̱́ī̱́Ī̱̀ī̱̀Ī̱̂ī̱̂I̮i̮ỊịỊ̀ị̀Ị́ị́Ị̂ị̂Ị̃ị̃Ị̄ị̄Ị̈ị̈Ị̈̀ị̈̀Ị̈́ị̈́Ị̈̂ị̈̂Ị̈̌ị̈̌Ị̌ị̌Ị̍ị̍I̤i̤Ì̤ì̤Í̤í̤Î̤î̤Ï̤ï̤I̥i̥Í̥í̥Ï̥ï̥I̯i̯Í̯í̯Ĩ̯ĩ̯I̩i̩I͔i͔Ī͔ī͔ƗɨƗ̀ɨ̀Ɨ́ɨ́Ɨ̂ɨ̂Ɨ̌ɨ̌Ɨ̃ɨ̃Ɨ̄ɨ̄Ɨ̈ɨ̈Ɨ̧ɨ̧Ɨ̧̀ɨ̧̀Ɨ̧̂ɨ̧̂Ɨ̧̌ɨ̧̌Ɨ̱ɨ̱Ɨ̱̀ɨ̱̀Ɨ̱́ɨ̱́Ɨ̱̂ɨ̱̂Ɨ̱̈ɨ̱̈Ɨ̱̌ɨ̱̌Ɨ̯ɨ̯ᶖı̣ı̥Ɩ̀ɩ̀Ɩ́ɩ́Ɩ̃ɩ̃ᵼJ́j́ĴĵJ̃j̃j̇̃J̄j̄J̇J̈j̈J̈̇j̈̇J̊j̊J̋j̋J̌ǰJ̌́ǰ́J̓j̓J᷎j᷎J̱j̱J̣j̣J̣̌ǰ̣J̥j̥ɈɉɈ̱ɉ̱ʝȷɟʄK̀k̀ḰḱK̂k̂K̃k̃K̄k̄K̆k̆K̇k̇K̈k̈ǨǩK̑k̑K̓k̓K̕k̕K̔k̔K͑k͑ĶķK̦k̦K̨k̨ḴḵḴ̓ḵ̓ḲḳK̮k̮K̥k̥K̬k̬K̫k̫ᶄƘƙⱩⱪꝀꝁꝂꝃꝄꝅꞢꞣᴋ̇L̀l̀ĹĺL̂l̂L̃l̃L̄l̄L̇l̇L̈l̈L̋l̋ĽľL̐l̐L̑l̑L̓l̓L̕l̕ĻļĻ̂ļ̂Ļ̃ļ̃L̦l̦ḼḽḺḻḺ̓ḻ̓L̮l̮ḶḷḶ̀ḷ̀Ḷ́ḷ́ḸḹḸ́ḹ́Ḹ̆ḹ̆Ḷ̓ḷ̓Ḷ̕ḷ̕Ḷ̣ḷ̣L̤l̤L̤̄l̤̄L̥l̥L̥̀l̥̀Ĺ̥ĺ̥L̥̄l̥̄L̥̄́l̥̄́L̥̄̆l̥̄̆L̥̕l̥̕L̩l̩L̩̀l̩̀L̩̓l̩̓L̯l̯ŁłŁ̇ł̇Ł̓ł̓Ł̣ł̣Ł̱ł̱ꝈꝉȽƚⱠⱡⱢɫɬᶅɭꞎȴʟ̇ʟ̣ƛƛ̓λ̴λ̴̓M̀m̀ḾḿM̂m̂M̃m̃M̄m̄M̆m̆ṀṁṀ̇ṁ̇M̈m̈M̋m̋M̍m̍M̌m̌M̐m̐M̑m̑M̓m̓M̕̕m̕M͑m͑ᵯM̧m̧M̨m̨M̦m̦M̱m̱Ḿ̱ḿ̱M̮m̮ṂṃṂ́ṃ́Ṃ̄ṃ̄Ṃ̓ṃ̓M̥m̥Ḿ̥ḿ̥M̥̄m̥̄M̥̄́m̥̄́M̥̄̆m̥̄̆M̬m̬M̩m̩M̩̀m̩̀M̩̓m̩̓M̯m̯ᶆm̢Ɱɱᴍ̇ᴍ̣ǸǹŃńN̂n̂ÑñÑ̈ñ̈N̄n̄N̆n̆ṄṅṄ̇ṅ̇N̈n̈N̋n̋ŇňN̐n̐N̑n̑N̍n̍N̓n̓N̕n̕ꞤꞥᵰŅņŅ̂ņ̂Ņ̃ņ̃N̦n̦N̨n̨ṊṋN̰n̰ṈṉṈ́ṉ́N̮n̮ṆṇṆ́ṇ́Ṇ̄ṇ̄Ṇ̄́ṇ̄́Ṇ̓ṇ̓N̤n̤N̥n̥Ǹ̥ǹ̥Ń̥ń̥Ñ̥ñ̥Ñ̥́ñ̥́N̥̄n̥̄N̥̄́n̥̄́N̥̄̆n̥̄̆N̥̄̑n̥̄̑Ṅ̥ṅ̥N̥̑n̥̑N̥̑́n̥̑́N̥̑̄n̥̑̄N̯n̯N̩n̩Ǹ̩ǹ̩N̩̓n̩̓N̲n̲ƝɲȠƞꞐꞑŊ̀ŋ̀Ŋ́ŋ́Ŋ̂ŋ̂Ŋ̄ŋ̄Ŋ̈ŋ̈Ŋ̈̇ŋ̈̇Ŋ̊ŋ̊Ŋ̑ŋ̑Ŋ̨ŋ̨Ŋ̥ŋ̥Ŋ̥́ŋ̥́Ŋ̥̄ŋ̥̄Ŋ̥̄́ŋ̥̄́ᶇɳȵɴ̇ɴ̣ÒòÓóÔôỐốỒồỖỗÔ̆ô̆ỔổÕõÕ̍õ̍Õ̎õ̎Õ̀õ̀ṌṍÕ̂õ̂Õ̌õ̌ṎṏȬȭŌōṒṓṐṑŌ̂ō̂Ō̃ō̃Ō̃́ō̃́Ō̄ō̄Ō̆ō̆Ō̆́ō̆́Ō̈ō̈Ō̌ō̌ŎŏŎ̀ŏ̀Ŏ́ŏ́Ŏ̈ŏ̈ȮȯȮ́ȯ́ȰȱO͘o͘Ó͘ó͘Ò͘ò͘Ō͘ō͘O̍͘o̍͘ÖöÖ́ö́Ö̀ö̀Ö̂ö̂Ö̌ö̌Ö̃ö̃ȪȫȪ̆ȫ̆Ö̆ö̆ỎỏO̊o̊ŐőǑǒO̍o̍O̎o̎ȌȍO̐o̐ȎȏO̓o̓ØøØ̀ø̀ǾǿØ̂ø̂Ø̃ø̃Ø̄ø̄Ø̄́ø̄́Ø̄̆ø̄̆Ø̆ø̆Ø̇ø̇Ø̇́ø̇́Ø̈ø̈Ø̋ø̋Ø̌ø̌Ø᷎ø᷎Ø̨ø̨Ǿ̨ǿ̨Ø̨̄ø̨̄Ø̣ø̣Ø̥ø̥Ø̰ø̰Ǿ̰ǿ̰ƟɵƠơỚớỜờỠỡƠ̆ơ̆ỞởO᷎o᷎Ó᷎ó᷎O̧o̧Ó̧ó̧Ò̧ò̧Ô̧ô̧Ǒ̧ǒ̧ǪǫǪ̀ǫ̀Ǫ́ǫ́Ǫ̂ǫ̂Ǫ̃ǫ̃ǬǭǬ̀ǭ̀Ǭ́ǭ́Ǭ̂ǭ̂Ǭ̃ǭ̃Ǭ̆ǭ̆Ǭ̌ǭ̌Ǫ̆ǫ̆Ǫ̆́ǫ̆́Ǫ̇ǫ̇Ǫ̇́ǫ̇́Ǫ̈ǫ̈Ǫ̈̀ǫ̈̀Ǫ̈́ǫ̈́Ǫ̈̂ǫ̈̂Ǫ̈̄ǫ̈̄Ǫ̈̌ǫ̈̌Ǫ̋ǫ̋Ǫ̌ǫ̌Ǫ̑ǫ̑Ǫ̣ǫ̣Ǫ̱ǫ̱Ǫ̱́ǫ̱́Ǫ̱̀ǫ̱̀Ǫ᷎ǫ᷎O̭o̭O̰o̰Ó̰ó̰O̱o̱Ò̱ò̱Ó̱ó̱Ô̱ô̱Ǒ̱ǒ̱Õ̱õ̱Ō̱ō̱Ṓ̱ṓ̱Ṑ̱ṑ̱Ō̱̂ō̱̂Ö̱ö̱Ö̱́ö̱́Ö̱̀ö̱̀Ö̱̂ö̱̂Ö̱̌ö̱̌O̮o̮ỌọỌ̀ọ̀Ọ́ọ́ỘộỌ̃ọ̃Ọ̄ọ̄Ọ̄̀ọ̄̀Ọ̄́ọ̄́Ọ̄̃ọ̄̃Ọ̄̆ọ̄̆Ọ̆ọ̆Ọ̈ọ̈Ọ̈̀ọ̈̀Ọ̈́ọ̈́Ọ̈̂ọ̈̂Ọ̈̄ọ̈̄Ọ̈̌ọ̈̌Ọ̌ọ̌Ọ̑ọ̑ỢợỌọO̤o̤Ò̤ò̤Ó̤ó̤Ô̤ô̤Ö̤ö̤O̥o̥Ō̥ō̥O̬o̬O̯o̯O̩o̩Õ͔õ͔Ō͔ō͔O̜o̜O̹o̹Ó̹ó̹O̲o̲ᴓᶗꝌꝍⱺꝊꝋƆ́ɔ́Ɔ̀ɔ̀Ɔ̂ɔ̂Ɔ̌ɔ̌Ɔ̃ɔ̃Ɔ̃́ɔ̃́Ɔ̃̀ɔ̃̀Ɔ̃̂ɔ̃̂Ɔ̃̌ɔ̃̌Ɔ̃̍ɔ̃̍Ɔ̃̎ɔ̃̎Ɔ̄ɔ̄Ɔ̆ɔ̆Ɔ̇ɔ̇Ɔ̈ɔ̈Ɔ̈̀ɔ̈̀Ɔ̈́ɔ̈́Ɔ̈̂ɔ̈̂Ɔ̈̌ɔ̈̌Ɔ̌ɔ̌Ɔ̍ɔ̍Ɔ̎ɔ̎Ɔ̣ɔ̣Ɔ̣̀ɔ̣̀Ɔ̣́ɔ̣́Ɔ̣̂ɔ̣̂Ɔ̣̃ɔ̣̃Ɔ̣̈ɔ̣̈Ɔ̣̈̀ɔ̣̈̀Ɔ̣̈́ɔ̣̈́Ɔ̣̈̂ɔ̣̈̂Ɔ̣̈̌ɔ̣̈̌Ɔ̣̌ɔ̣̌Ɔ̤ɔ̤Ɔ̤̀ɔ̤̀Ɔ̤́ɔ̤́Ɔ̤̂ɔ̤̂Ɔ̤̈ɔ̤̈Ɔ̱ɔ̱Ɔ̱̀ɔ̱̀Ɔ̱́ɔ̱́Ɔ̱̂ɔ̱̂Ɔ̱̌ɔ̱̌Ɔ̱̃ɔ̱̃Ɔ̱̈ɔ̱̈Ɔ̱̈̀ɔ̱̈̀Ɔ̱̈́ɔ̱̈́Ɔ̧ɔ̧Ɔ̧̀ɔ̧̀Ɔ̧́ɔ̧́Ɔ̧̂ɔ̧̂Ɔ̧̌ɔ̧̌Ɔ̨ɔ̨Ɔ̨́ɔ̨́Ɔ̨̀ɔ̨̀Ɔ̨̂ɔ̨̂Ɔ̨̌ɔ̨̌Ɔ̨̄ɔ̨̄Ɔ̨̆ɔ̨̆Ɔ̨̈ɔ̨̈Ɔ̨̱ɔ̨̱Ɔ̰ɔ̰Ɔ̰̀ɔ̰̀Ɔ̰́ɔ̰́Ɔ̰̄ɔ̰̄P̀p̀ṔṕP̃p̃P̄p̄P̆p̆ṖṗP̈p̈P̋p̋P̑p̑P̓p̓P̕p̕P̔p̔P͑p͑P̱p̱P̣p̣P̤p̤P̬p̬ⱣᵽꝐꝑᵱᶈƤƥꝒꝓꝔꝕᴘ̇Q́q́Q̃q̃Q̄q̄Q̇q̇Q̈q̈Q̋q̋Q̓q̓Q̕q̕Q̧q̧Q̣q̣Q̣̇q̣̇Q̣̈q̣̈Q̱q̱ꝖꝗꝖ̃ꝗ̃ꝘꝙʠɊɋR̀r̀ŔŕR̂r̂R̃r̃R̄r̄R̆r̆ṘṙR̋r̋ŘřR̍r̍ȐȑȒȓR̓r̓R̕r̕ŖŗR̦r̦R̨r̨R̨̄r̨̄ꞦꞧR̭r̭ṞṟṚṛṚ̀ṛ̀Ṛ́ṛ́ṜṝṜ́ṝ́Ṝ̃ṝ̃Ṝ̆ṝ̆R̤r̤R̥r̥R̥̀r̥̀Ŕ̥ŕ̥R̥̂r̥̂R̥̃r̥̃R̥̄r̥̄R̥̄́r̥̄́R̥̄̆r̥̄̆Ř̥ř̥R̬r̬R̩r̩R̯r̯ɌɍᵲɺᶉɻⱹɼⱤɽɾᵳɿʀ̇ʀ̣Ꝛ́ꝛ́Ꝛ̣ꝛ̣S̀s̀ŚśŚ̀ś̀ŚśṤṥŜŝS̃s̃S̄s̄S̆s̆ṠṡṠ̃ṡ̃S̈s̈S̋s̋ŠšŠ̀š̀Š́š́ṦṧŠ̓š̓S̑s̑S̓s̓S̕s̕ŞşȘșS̨s̨Š̨š̨ꞨꞩS̱s̱Ś̱ś̱S̮s̮ṢṣṢ́ṣ́Ṣ̄ṣ̄ṨṩṢ̌ṣ̌Ṣ̕ṣ̕Ṣ̱ṣ̱S̤s̤Š̤š̤S̥s̥Ś̥ś̥S̬s̬S̩s̩S̪s̪ꜱ̇ꜱ̣ſ́ẛſ̣ᵴᶊʂⱾȿẜẝᶋᶘʆT̀t̀T́t́T̃t̃T̄t̄T̆t̆T̆̀t̆̀ṪṫT̈ẗŤťT̑t̑T̓t̓T̕t̕T̔t̔T͑t͑ŢţȚțT̨t̨T̗t̗ṰṱT̰t̰ṮṯT̮t̮ṬṭṬ́ṭ́T̤t̤T̥t̥T̬t̬T̯t̯T̪t̪ƾŦŧȾⱦᵵƫƬƭƮʈȶᴛ̇ᴛ̣ÙùÚúÛûŨũŨ̀ũ̀ṸṹŨ̂ũ̂Ũ̊ũ̊Ũ̌ũ̌Ũ̍ũ̍Ũ̎ũ̎ŪūŪ̀ū̀Ū́ū́Ū̂ū̂Ū̌ū̌Ū̃ū̃Ū̄ū̄Ū̆ū̆Ū̆́ū̆́ṺṻŪ̊ū̊ŬŭŬ̀ŭ̀Ŭ́ŭ́U̇u̇U̇́u̇́U̇̄u̇̄ÜüǛǜǗǘÜ̂ü̂Ü̃ü̃ǕǖǕ̆ǖ̆Ü̆ü̆ǙǚỦủŮůŮ́ů́Ů̃ů̃ŰűǓǔU̍u̍U̎u̎ȔȕȖȗU̓u̓U᷎u᷎ỦủƯưỨứỪừỮữƯ̆ư̆ỬửỰựU̧u̧Ú̧ú̧Ù̧ù̧Û̧û̧Ǔ̧ǔ̧ŲųŲ̀ų̀Ų́ų́Ų̂ų̂Ų̌ų̌Ų̄ų̄Ų̄́ų̄́Ų̄̀ų̄̀Ų̄̂ų̄̂Ų̄̌ų̄̌Ų̄̌ų̄̌Ų̈ų̈Ų̈́ų̈́Ų̈̀ų̈̀Ų̈̂ų̈̂Ų̈̌ų̈̌Ų̈̄ų̈̄Ų̋ų̋Ų̱ų̱Ų̱́ų̱́Ų̱̀ų̱̀ṶṷṴṵṴ̀ṵ̀Ṵ́ṵ́Ṵ̄ṵ̄Ṵ̈ṵ̈U̱u̱Ù̱ù̱Ú̱ú̱Û̱û̱Ũ̱ũ̱Ū̱ū̱Ū̱́ū̱́Ū̱̀ū̱̀Ū̱̂ū̱̂Ü̱ü̱Ǘ̱ǘ̱Ǜ̱ǜ̱Ü̱̂ü̱̂Ǚ̱ǚ̱Ǔ̱ǔ̱ỤụỤ̀ụ̀Ụ́ụ́Ụ̂ụ̂Ụ̃ụ̃Ụ̄ụ̄Ụ̈ụ̈Ụ̈̀ụ̈̀Ụ̈́ụ̈́Ụ̈̂ụ̈̂Ụ̈̌ụ̈̌Ụ̌ụ̌Ụ̍ụ̍ṲṳṲ̀ṳ̀Ṳ́ṳ́Ṳ̂ṳ̂Ṳ̈ṳ̈U̥u̥Ü̥ü̥U̯u̯Ũ̯ũ̯Ü̯ü̯U̩u̩U͔u͔Ũ͔ũ͔Ū͔ū͔ɄʉɄ̀ʉ̀Ʉ́ʉ́Ʉ̂ʉ̂Ʉ̃ʉ̃Ʉ̄ʉ̄Ʉ̈ʉ̈Ʉ̌ʉ̌Ʉ̧ʉ̧Ʉ̰ʉ̰Ʉ̰́ʉ̰́Ʉ̱ʉ̱Ʉ̱́ʉ̱́Ʉ̱̀ʉ̱̀Ʉ̱̂ʉ̱̂Ʉ̱̈ʉ̱̈Ʉ̱̌ʉ̱̌Ʉ̥ʉ̥ᵾᶙʮʯɰƱ̀ʊ̀Ʊ́ʊ́Ʊ̃ʊ̃ᵿV̀v̀V́v́V̂v̂ṼṽṼ̀ṽ̀Ṽ́ṽ́Ṽ̂ṽ̂Ṽ̌ṽ̌V̄v̄V̄̀v̄̀V̄́v̄́V̄̂v̄̂V̄̃v̄̃V̄̄v̄̄V̄̆v̄̆V̄̌v̄̌V̆v̆V̆́v̆́V̇v̇V̈v̈V̈̀v̈̀V̈́v̈́V̈̂v̈̂V̈̄v̈̄V̈̌v̈̌V̊v̊V̋v̋V̌v̌V̍v̍V̏v̏V̐v̐V̓v̓V̧v̧V̨v̨V̨̀v̨̀V̨́v̨́V̨̂v̨̂V̨̌v̨̌V̨̄v̨̄V̨̄́v̨̄́V̨̄̀v̨̄̀V̨̄̂v̨̄̂V̨̄̌v̨̄̌V̨̈v̨̈V̨̈́v̨̈́V̨̈̀v̨̈̀V̨̈̂v̨̈̂V̨̈̌v̨̈̌V̨̈̄v̨̈̄V̨̋v̨̋V̨̱v̨̱V̨̱́v̨̱́V̨̱̀v̨̱̀V̨̱̂v̨̱̂V̨̱̌v̨̱̌V̱v̱V̱̀v̱̀V̱́v̱́V̱̂v̱̂V̱̌v̱̌Ṽ̱ṽ̱V̱̈v̱̈V̱̈́v̱̈́V̱̈̀v̱̈̀V̱̈̂v̱̈̂V̱̈̌v̱̈̌ṾṿV̥v̥ꝞꝟᶌƲʋƲ̀ʋ̀Ʋ́ʋ́Ʋ̃ʋ̃ⱱⱴꝨ́ꝩ́Ꝩ̇ꝩ̇Ꝩ̣ꝩ̣ẀẁẂẃŴŵW̃w̃W̄w̄W̆w̆ẆẇẄẅW̊ẘW̋w̋W̌w̌W̍w̍W̓w̓W̱w̱ẈẉW̥w̥W̬w̬ⱲⱳX̀x̀X́x́X̂x̂X̃x̃X̄x̄X̆x̆X̆́x̆́ẊẋẌẍX̊x̊X̌x̌X̓x̓X̕x̕X̱x̱X̱̓x̱̓X̣x̣X̣̓x̣̓X̥x̥ᶍỲỳÝýŶŷỸỹȲȳȲ̀ȳ̀Ȳ́ȳ́Ȳ̃ȳ̃Ȳ̆ȳ̆Y̆y̆Y̆̀y̆̀Y̆́y̆́ẎẏẎ́ẏ́ŸÿŸ́ÿ́Y̊ẙY̋y̋Y̌y̌Y̍y̍Y̎y̎Y̐y̐Y̓y̓ỶỷY᷎y᷎Y̱y̱ỴỵỴ̣ỵ̣Y̥y̥Y̯y̯ɎɏƳƴỾỿZ̀z̀ŹźẐẑZ̃z̃Z̄z̄ŻżZ̈z̈Z̋z̋ŽžŽ́ž́Ž̏ž̏Z̑z̑Z̓z̓Z̕z̕Z̨z̨Z̗z̗ẔẕZ̮z̮ẒẓẒ́ẓ́Ẓ̌ẓ̌Ẓ̣ẓ̣Z̤z̤Z̥z̥ƵƶᵶᶎȤȥʐʑⱿɀⱫⱬƷ́ʒ́Ʒ̇ʒ̇ǮǯǮ́ǯ́Ʒ̥ʒ̥ᶚƺʓÞ́þ́Þ̣þ̣ꝤꝥꝦꝧƻꜮꜯʡʢœßæ",charecterRegex="^[a-zA-Z"+accentedCharacters+"]$",decimalRegex="^[-a-zA-Z' "+accentedCharacters+"]$",compiledCharecterRegex=new RegExp(charecterRegex),compiledDecimalRegex=new RegExp(decimalRegex),value=$element.val();value=value.replace(/\s+/g," ");var tempVar="",finalVar=value.charAt(0),inputSubString=angular.copy(value.substr(1,value.length-1));if(""!==value.charAt(0).replace(compiledCharecterRegex,"")&&(finalVar="",cursorPos-=1),value.length>1){value=finalVar+value.substr(1,value.length-1),finalVar=value.charAt(0),inputSubString=angular.copy(value.substr(1,value.length-1));for(var i=0;i<inputSubString.length;i++){var temp=inputSubString.charAt(i);""===temp.replace(compiledDecimalRegex,"")?tempVar=inputSubString.charAt(i):cursorPos-=1,finalVar+=tempVar,tempVar=""}}value=finalVar,$element.val(value),ngModelCtrl.$setViewValue(value),$element[0].setSelectionRange(cursorPos,cursorPos)}else if("city"===$attrs.onlyCharInput){for(var cursorPos=$element[0].selectionStart,value=$element.val(),tempValue=value,finalValue="",i=0;i<tempValue.length;i++){var character=tempValue.charAt(i);character=character.replace(/[^a-zA-Z\-\'\.\ \u00E0-\u00FC\u00C0-\u00DC][a-zA-Z\u00E0-\u00FC\u00C0-\u00DC\-\'\.\ ]*$/g,""),finalValue+=character}$element.val(finalValue),ngModelCtrl.$setViewValue(finalValue),$element[0].setSelectionRange(cursorPos,cursorPos)}else if("email"===$attrs.onlyCharInput||"idNumber"===$attrs.onlyCharInput){for(var cursorPos=$element[0].selectionStart,value=$element.val(),tempValue=value,finalValue="",i=0;i<tempValue.length;i++){var character=tempValue.charAt(i);character=character.replace(/[^\w\-\+\_\@\.\!\#\$\%\&\'\*\+\-\/\=\?\^\_\`\{\|\}\~\\]*$/g,""),finalValue+=character}$element.val(finalValue),ngModelCtrl.$setViewValue(finalValue),$element[0].setSelectionRange(cursorPos,cursorPos)}else{for(var cursorPos=$element[0].selectionStart,value=$element.val(),i=0;i<value.length;i++)" "===value.charAt(0)&&(value=value.substr(1,value.length-1));$element.val(value),ngModelCtrl.$setViewValue(value),$element[0].setSelectionRange(cursorPos,cursorPos)}},ngModelCtrl.$render=function(){$element.val(ngModelCtrl.$viewValue,!1)},$element.bind("touchend",listener),$element.bind("keydown",function(event){var key=event.keyCode;if(!(9===key||91===key||key>15&&19>key||key>=36&&40>=key||46===key))return event.ctrlKey===!0&&65===key||8===key?!0:void $browser.defer(listener)}),$element.bind("paste cut",function(){$browser.defer(listener)})}}}var moduleName="marketingCore",directiveName="onlyCharInput";angular.module(moduleName).directive(directiveName,onlyCharInputFn)}(angular),function(angular,lodash){"use strict";function pagePicker($document,$window,$compile,$timeout,$interval,$log,analyticsUtils,personalizedAnchorLinks,personalizedPickerService,analyticsFactory){return{restrict:"A",link:function(scope,element,attr){function cancelInterval(){$interval.cancel(interval),interval=null}function updatedSelectedLink(id){element.find(".content-picker-nav a").removeClass("selected"),element.find(".content-picker-nav a[data-id="+id+"]").addClass("selected")}function loadContent(url){personalizedPickerService.getPersonalizedContent(url).then(onSuccess,onError)}function onSuccess(response){var htmlContent=$compile(response.data)(scope),pageContent=element.find(".page-picker-content");"true"===window.marketingConfig.isWcm?(pageContent.html(htmlContent),element.find(".content-picker-nav-overlay").removeClass("active")):(pageContent.prepend(htmlContent),element.parent().replaceWith(pageContent.children()),$timeout(function(){spinner.classList.add("loaded")},500),$timeout(function(){spinner.parentNode.removeChild(spinner)},1500),lodash.forEach(htmlContent,function(htmlContentModule){if(htmlContentModule.classList){var modulePickers=htmlContentModule.classList.contains("modulePicker");modulePickers&&totalModulePickers.push(modulePickers)}})),0===totalModulePickers.length&&analyticsUtils.trackAsyncPage("Page Picker",defaultPage.id,defaultPage.path),scope.$broadcast("domContentReplaced"),personalizedAnchorLinks.onloadAjaxScrollTo()}function onModulePickerSuccess(){scope.$broadcast("domContentReplaced"),analyticsUtils.trackAsyncPage("Page Picker",defaultPage.id,defaultPage.path),personalizedAnchorLinks.onloadAjaxScrollTo()}function onError(response){$log.error("There was a problem loading personalized content.")}function onClickNav(e){e.preventDefault(),element.find(".content-picker-nav-overlay").addClass("active"),updatedSelectedLink(angular.element(e.currentTarget).attr("data-id")),loadContent(e.currentTarget.href)}var pages=angular.fromJson(attr.pages).pages,totalModulePickers=[],spinner=$document[0].querySelector("#page-picker-spinner");if($window.isPagePicker=!0,!pages)return!1;scope.$on("modulePickersCompleted",function(){onModulePickerSuccess()});var defaultPage;if("false"===$window.marketingConfig.isWcm)if(defaultPage=lodash.find(pages,function(page){return page.id===attr.defaultId}),$window.TMOPersonalize&&$window.TMOPersonalize.page)defaultPage=lodash.find(pages,function(page){return page.id===$window.TMOPersonalize.page}),loadContent(defaultPage.path);else var elapsed=0,timeout=1e3,interval=$interval(function(){$window.TMOPersonalize?(cancelInterval(),$window.TMOPersonalize.page&&(defaultPage=lodash.find(pages,function(page){return page.id===$window.TMOPersonalize.page})),loadContent(defaultPage.path)):elapsed>=timeout&&(cancelInterval(),loadContent(defaultPage.path)),elapsed+=10},10);else defaultPage=lodash.find(pages,function(page){return page.id===attr.defaultId}),loadContent(defaultPage.path);element.find(".content-picker-nav").on("click","a",onClickNav)}}}pagePicker.$inject=["$document","$window","$compile","$timeout","$interval","$log","analyticsUtils","personalizedAnchorLinks","personalizedPickerService","analyticsFactory"],angular.module("marketingCore").directive("pagePicker",pagePicker)}(window.angular,window._),function(angular){"use strict";function formFocusFn(){return{restrict:"A",link:function($scope,$element,$attrs){$element.on("submit",function(){$element.find(".ng-invalid:first").focus()})}}}var moduleName="tmobileCheckOut",directiveName="formFocus";angular.module(moduleName).directive(directiveName,formFocusFn)}(angular),function(angular){"use strict";function parallaxContent($window,utils,viewport){return{restrict:"A",link:function(scope,element,attr){function onBreakpointChange(bp){viewport.breakpointUp("desktop")&&!navigator.userAgent.match(/iPhone|iPad|iPod|Android|Windows Phone/i)?initParallaxBehavior():destroyParallaxBehavior()}function initParallaxBehavior(){disableParallax||(updateContentPosition(),win.on("scroll.parallax",onScroll_window))}function destroyParallaxBehavior(){resetContentPosition(),win.off("scroll.parallax",onScroll_window)}function resetContentPosition(){angular.element(contentWrap).css({transform:"translateY(0)"})}function updateContentPosition(){var offsetTop=element[0].getBoundingClientRect().top+element[0].ownerDocument.defaultView.pageYOffset;utils.isInView(element[0])===!0&&element[0].hasAttribute("data-parallax")&&angular.element(contentWrap).css({transform:"translateY("+($window.pageYOffset-offsetTop)*-.15+"px)"})}function onScroll_window(){updateContentPosition()}function cleanup(){destroyParallaxBehavior()}var win=angular.element($window),contentWrap=element[0].querySelector(".content-wrap"),disableParallax=utils.getClosest(element[0],".disable-parallax-content");return viewport.onBreakpointChange(onBreakpointChange,!0),scope.$on("$destroy",cleanup),disableParallax?!1:void 0}}}parallaxContent.$inject=["$window","utils","viewport"],angular.module("marketingCore").directive("parallaxContent",parallaxContent)}(window.angular),function(angular){"use strict";function creditCardTypeFn(){return{require:"ngModel",restrict:"A",link:function($scope,$element,$attrs,ngModelCtrl){ngModelCtrl.$validators.validCardNumber=function(ccnumber){if(ccnumber&&ccnumber.length>0){for(var creditCardTypeNumber=ccnumber.length,mul=0,prodArr=[[0,1,2,3,4,5,6,7,8,9],[0,2,4,6,8,1,3,5,7,9]],sum=0;creditCardTypeNumber--;)sum+=prodArr[mul][parseInt(ccnumber.charAt(creditCardTypeNumber),10)],mul^=1;return sum%10===0&&sum>0}return!1}}}}angular.module("tmobileCheckOut").directive("creditCardType",creditCardTypeFn)}(window.angular),function(angular){"use strict";function phoneBanner($window){return{restrict:"A",scope:!0,link:function(scope,element,attr){var elementHeight=Math.round(element[0].offsetHeight);element[0].style.height=elementHeight+"px"}}}phoneBanner.$inject=["$window"],angular.module("marketingCore").directive("phoneBanner",phoneBanner)}(angular),function(angular){"use strict";function checkDateFn($filter,$browser){return{require:"ngModel",link:function($scope,$element,$attrs,ngModelCtrl){var listener=function(){var cursorPos=$element[0].selectionStart,value=$element.val().replace(/[^0-9]/g,"");$element.val($filter("dateFilter")(value,"expiryDate")),5!==$element.val().length&&(3===cursorPos?$element[0].setSelectionRange(cursorPos+1,cursorPos+1):$element[0].setSelectionRange(cursorPos,cursorPos))};ngModelCtrl.$parsers.push(function(viewValue){return viewValue.replace(/[^0-9]/g,"").slice(0,4)}),ngModelCtrl.$render=function(){$element.val($filter("dateFilter")(ngModelCtrl.$viewValue,"expiryDate"))},$element.bind("change",listener),$element.bind("keydown",function(event){var key=event.keyCode;if(!(9===key||46===key||91===key||key>15&&19>key||key>=35&&40>=key))return event.ctrlKey===!0&&65===key||8===key?!0:void $browser.defer(listener)}),$element.bind("paste cut",function(){$browser.defer(listener)}),ngModelCtrl.$validators.checkExp=function(modelValue,viewValue){if(modelValue||viewValue){var value=modelValue||viewValue,date=new Date,year=date.getFullYear(),currentMonth=date.getMonth(),numYear=value.toString().slice(2),monthEntered=value.toString().slice(0,2);if(2===numYear.toString().length){var curYear=year.toString().slice(2);return numYear>curYear?!0:numYear===curYear?!(currentMonth+1>monthEntered):!1}return!1}return!1},ngModelCtrl.$validators.checkMonth=function(modelValue,viewValue){if(modelValue||viewValue){var value=modelValue||viewValue,monthEntered=value.toString().slice(0,2);if(2===value.toString().slice(2).length)return!(monthEntered>12||1>monthEntered)}return!1}}}}var moduleName="tmobileCheckOut",directiveName="checkDate";angular.module(moduleName).directive(directiveName,checkDateFn)}(window.angular),function(angular){"use strict";function portabilityDirective($window,$timeout,utils,analyticsUtils){return{restrict:"A",link:function(scope,element,attr){scope.$on("renderGrecaptcha",function(){utils.pollForGlobal("grecaptcha").then(function(){scope.grecaptchaId=grecaptcha.render(element.find("#grecaptcha-"+scope.vm.settings.moduleId)[0],{size:"invisible",badge:"inline",sitekey:scope.vm.settings.siteId,callback:scope.vm.onExecuteGrecaptcha,"expired-callback":scope.vm.onExpireGrecaptcha})})})}}}portabilityDirective.$inject=["$window","$timeout","utils","analyticsUtils"],angular.module("marketingCore").directive("portabilityDirective",portabilityDirective)}(window.angular),function(angular){"use strict";function allowPatternFn(){return{require:"ngModel",restrict:"A",compile:function(){return function(scope,element,attrs){element.bind("keypress",function(event){var keyCode=event.which||event.keyCode,keyCodeChar=String.fromCharCode(keyCode);return keyCodeChar.match(new RegExp(attrs.allowPattern,"i"))?void 0:(event.preventDefault(),!1)})}}}}var moduleName="tmobileCheckOut",directiveName="allowPattern";angular.module(moduleName).directive(directiveName,allowPatternFn)}(angular),function(angular,lodash){"use strict";function priceSlider($timeout,utils,analyticsUtils){return{restrict:"A",link:function(scope,element){function updateSlider(event,selector){if($timeout(function(){var item=element[0].querySelector(".price-container.active").textContent,itemAlt=element[0].querySelector(selector).textContent,voiceContent=lodash.join([itemAlt,item]),voice=element[0].querySelector("#announce");utils.announce(voice,voiceContent,"assertive")},0),scope.vm.oldSlider){var analyticsString=element[0].querySelector(selector).textContent;analyticsUtils.trackSlider(analyticsString.match(/\d+/)[0],element[0])}}function cleanup(){slider.removeEventListener("change",scope.vm.sliderClick)}scope.$on("updateSlider",updateSlider),scope.$on("$destroy",cleanup);var slider=element[0].querySelector("input.slider-range"),event=new Event("change");slider.dispatchEvent(event)}}}priceSlider.$inject=["$timeout","utils","analyticsUtils"],angular.module("marketingCore").directive("priceSlider",priceSlider)}(window.angular,window._),function(angular){"use strict";var whatsNextSection={templateUrl:"app/checkOut/components/whatsNextSection/whatsNextSection.tpl.html",controller:"WhatsNextSectionController as vm"};angular.module("tmobileApp").component("whatsNextSection",whatsNextSection)}(window.angular),function(angular){"use strict";function productCarousel(utils,$compile,analyticsUtils,viewport){return{restrict:"A",link:function(scope,element,attr){function onInit(e,slick){var clonedCard=element[0].querySelectorAll(".product-grids.slick-cloned");!viewport.breakpointUp("desktop")&&utils.isTouch()&&(element[0].className+=" touch-device");var btnPrev=element[0].querySelector(".slick-prev");if($compile(btnPrev)(scope),!active&&btnPrev.className.indexOf("slick-disabled")<0){btnPrev.className+=" slick-disabled";for(var invisibleCards=element[0].querySelectorAll('[data-slick-index^="-"]'),i=0;i<invisibleCards.length;i++)invisibleCards[i].style.visibility="hidden"}angular.forEach(clonedCard,function(el,i){null!==el.querySelector("[modal-content]")&&(el.querySelector("[modal-content]").removeAttribute("data-modal"),
el.querySelector("[modal-content]").removeAttribute("modal-content")),null!==el.querySelector(".legal-modal")&&el.querySelector(".legal-modal").removeAttribute("data-modal-id"),$compile(angular.element(el))(scope)}),slick.$slider[0].style.opacity="1"}function onAfterChange(e,slick,currentSlide){var invisibleCards=element[0].querySelectorAll('[data-slick-index^="-"]');angular.forEach(invisibleCards,function(invisibleCard){invisibleCard.style.visibility="visible"}),scope.isOnFirst=!1,active=!0;var direction;direction=1===Math.abs(prevSlide-currentSlide)?prevSlide-currentSlide>0?"prev":"next":prevSlide-currentSlide>0?"next":"prev","prev"===direction?analyticsUtils.trackCarousel(!1,element):analyticsUtils.trackCarousel(!0,element)}function onBeforeChange(e,slick,currentSlide,nextSlide){prevSlide=currentSlide}function cleanup(){scope.slickConfig.method.unslick()}var active,prevSlide;scope.slickConfig.event.init=onInit,scope.slickConfig.event.setPosition=onInit,scope.slickConfig.event.afterChange=onAfterChange,scope.slickConfig.event.beforeChange=onBeforeChange,scope.$on("$destroy",cleanup)}}}productCarousel.$inject=["utils","$compile","analyticsUtils","viewport"],angular.module("marketingCore").directive("productCarousel",productCarousel)}(angular),function(angular){"use strict";var userAddress={templateUrl:"app/checkOut/components/userAddress/userAddress.component.tpl.html",controller:"UserAddressController as vm",bindings:{userForm:"=",formName:"<"}};angular.module("tmobileApp").component("userAddress",userAddress)}(window.angular),function(angular){"use strict";function productPreRegister($window,$timeout,analyticsUtils){return{restrict:"A",link:function(scope,element,attr){function cleanup(){}element.find("input, select").on("focus",function(e){angular.element(e.currentTarget).closest(".input-wrapper").addClass("active"),scope.vm.productPreRegisterForm.$pristine&&!isFormStarted&&(analyticsUtils.trackForm({eventType:"form start",analyticsID:scope.vm.analyticsID,submitText:submitCTA}),isFormStarted=!0)}),element.find("input, select").on("blur",function(e){angular.element(e.currentTarget).closest(".input-wrapper").removeClass("active")}),scope.$on("valid",function(e,isValid){var attributes={},timeRemaining=element.data("timeRemaining"),headerHeight=(scope.vm.formData.optInText||"Opt in to T-Mobile emails",angular.element(".global-header.sticky").height()),filterHeight=angular.element(".offers-filter-component").height(),scrollTop=element.offset().top-headerHeight-filterHeight;timeRemaining&&(attributes.dynamicContent=("0"+timeRemaining.days).slice(-2)+":"+("0"+timeRemaining.hours).slice(-2)+":"+("0"+timeRemaining.minutes).slice(-2)+":"+("0"+timeRemaining.seconds).slice(-2)),isValid===!1?($window.scrollTo(0,scrollTop),$timeout(function(){element.find(".input-wrapper.error:first input").focus()},100)):isValid===!0&&($window.scrollTo(0,scrollTop),analyticsUtils.trackForm({eventType:"form complete",analyticsID:scope.vm.analyticsID,submitText:submitCTA}))});var isFormStarted=!1,preRegForm=element[0].querySelector("form"),submitCTA=(preRegForm.querySelector('[type="submit"]').getAttribute("data-icid"),preRegForm.querySelector('[type="submit"]').innerText);scope.$on("$destroy",cleanup)}}}productPreRegister.$inject=["$window","$timeout","analyticsUtils"],angular.module("marketingCore").directive("productPreRegister",productPreRegister)}(window.angular),function(angular){"use strict";var reviewOrder={templateUrl:"app/checkOut/components/reviewOrder/reviewOrder.component.tpl.html",controller:"ReviewOrderController as vm"};angular.module("tmobileApp").component("reviewOrder",reviewOrder)}(angular),function(angular){"use strict";function preRegisterNtm($window,$timeout,analyticsUtils){return{restrict:"A",link:function(scope,element,attr){function cleanup(){}element.find("input, select").on("focus",function(e){angular.element(e.currentTarget).closest(".mat-form-field-wrapper").addClass("active"),scope.vm.productPreRegisterForm.$pristine&&!isFormStarted&&(analyticsUtils.trackForm({eventType:"form start",analyticsID:scope.vm.analyticsID,submitText:submitCTA}),isFormStarted=!0)}),element.find("input, select").on("blur",function(e){angular.element(e.currentTarget).closest(".mat-form-field-wrapper").removeClass("active")}),scope.$on("valid",function(e,isValid){var attributes={},timeRemaining=element.data("timeRemaining"),headerHeight=(scope.vm.settings.formFields.optInText?scope.vm.settings.formFields.optInText:"Opt in to T-Mobile emails",angular.element(".global-header.sticky").height()),filterHeight=angular.element(".offers-filter-component").height(),scrollTop=element.offset().top-headerHeight-filterHeight;timeRemaining&&(attributes.dynamicContent=("0"+timeRemaining.days).slice(-2)+":"+("0"+timeRemaining.hours).slice(-2)+":"+("0"+timeRemaining.minutes).slice(-2)+":"+("0"+timeRemaining.seconds).slice(-2)),isValid===!0&&($window.scrollTo(0,scrollTop),analyticsUtils.trackForm({eventType:"form complete",analyticsID:scope.vm.analyticsID,submitText:submitCTA}))});var isFormStarted=!1,submitCTA=(scope.vm.settings.formFields.submitButtonIcid,scope.vm.settings.formFields.submitButtonText?scope.vm.settings.formFields.submitButtonText:"Submit");scope.$on("$destroy",cleanup)}}}preRegisterNtm.$inject=["$window","$timeout","analyticsUtils"],angular.module("marketingCore").directive("preRegisterNtm",preRegisterNtm)}(window.angular),function(angular){"use strict";var portOutPin={templateUrl:"app/checkOut/components/portOutPin/portOutPin.component.tpl.html",controller:"PortOutPinController as vm",bindings:{userForm:"<",checkOutInfo:"<",formName:"<"}};angular.module("tmobileApp").component("portOutPin",portOutPin)}(angular),function(angular,lodash){"use strict";function responsiveBackgroundImg($window,$timeout,viewport,backgroundVideo,scene7,utils,analyticsUtils){return{restrict:"A",scope:!0,link:function(scope,element,attr){function onClickBackground(e){if("a"!==e.target.tagName.toLowerCase()&&"button"!==e.target.tagName.toLowerCase()){analyticsUtils.trackGenericClick(element[0].querySelectorAll(".background-cta")[0]);var target="_self";attr.backgroundCtaTarget&&(target=attr.backgroundCtaTarget),$window.open(attr.backgroundCta,target)}}function onResize(){attr.maintainAspectRatio&&"false"!==attr.maintainAspectRatio&&updateHeight(),getElements(),updateImageSource()}function getElements(){images=Array.prototype.slice.call(element[0].querySelectorAll("img[data-src]")),videos=Array.prototype.slice.call(element[0].querySelectorAll("source[data-src]")),$timeout(loadMedia,100)}function loadMedia(){utils.isInView(element[0])===!0&&(lodash.forEachRight(images,function(el,i){el.src=el.getAttribute("data-src"),images.splice(i,1)}),lodash.forEachRight(videos,function(el,i){!viewport.breakpointUp("desktop")||"iOS"===utils.getOS()&&"Android"===utils.getOS()?el.src="data:":el.src=el.getAttribute("data-src"),el.parentElement&&el.parentElement.load&&el.parentElement.load(),videos.splice(i,1)}),updateImageSource())}function setBackgroundVideoSrc(src){function setSrc(){!viewport.breakpointUp("desktop")||"iOS"===utils.getOS()&&"Android"===utils.getOS()?lodash.forEach(videos,function(el){el.setAttribute("data-src","data:")}):lodash.forEach(videos,function(el){el.setAttribute("data-src",src)}),getElements()}videos=Array.prototype.slice.call(element[0].querySelectorAll("source[data-src]")),setSrc(),viewport.onBreakpointChange(setSrc)}function updateImageSource(){if(null===element[0].querySelector(".picture-background-img")){var image=getImageForBreakpoint();image&&(element[0].style.backgroundImage="url("+image+")")}else getPictureForBreakpoint()}function getPictureForBreakpoint(){tabletImage&&null===mobileImage&&(targetImage=element[0].querySelector(".picture-background-img img").getAttribute("src"),element[0].querySelector(".picture-background-img img").setAttribute("srcset",targetImage),desktopImage=element[0].querySelector(".picture-background-img img").getAttribute("src"),array=desktopImage.split(/\.desktop\./),tabletImage=array.join(".tablet."),mobileImage=array.join(".mobile."),element[0].querySelector(".picture-background-img-tablet").setAttribute("srcset",tabletImage),element[0].querySelector(".picture-background-img-mobile").setAttribute("srcset",mobileImage))}function getImageForBreakpoint(){return desktopImage=attr.desktopRendition||attr.tabletRendition||attr.mobileRendition,tabletImage=attr.tabletRendition||attr.desktopRendition||attr.mobileRendition,mobileImage=attr.mobileRendition||attr.tabletRendition||attr.desktopRendition,viewport.breakpointUp("desktop")?desktopImage:viewport.breakpointUp("tablet")?tabletImage:mobileImage}function isRatio(ratio){if(ratio&&angular.isString(ratio)&&ratio.indexOf(":")){var ratioParts=ratio.split(":");if(2===ratioParts.length&&Number(ratioParts[0])&&Number(ratioParts[1]))return!0}return!1}function getAspectRatio(maintainAspectRatioProperty){return isRatio(maintainAspectRatioProperty)?maintainAspectRatioProperty:"16:9"}function getRatioAsDecimalFraction(ratio){var ratioParts=ratio.split(":"),width=Number(ratioParts[0]),height=Number(ratioParts[1]);return height/width}function updateHeight(){viewport.breakpointUp(specifiedBreakpoint)?element[0].style.height=Math.round(element.outerWidth()*aspectRatioDecimalFraction)+"px":element[0].style.height="auto"}function cleanup(){win.off("resize scroll")}var images,videos,s7Player,targetImage,desktopImage,array,tabletImage,mobileImage,win=angular.element($window),videoId=String(attr.backgroundVideoId),scene7Video=element[0].querySelector(".s7-background"),specifiedBreakpoint=attr.maintainAspectRatioFrom?attr.maintainAspectRatioFrom:"desktop",aspectRatio=getAspectRatio(attr.maintainAspectRatio),aspectRatioDecimalFraction=getRatioAsDecimalFraction(aspectRatio),onDynamicMediaPlayerInit=function(viewer){s7Player=viewer};if(win.on("resize",lodash.throttle(onResize,100)),win.on("scroll",lodash.throttle(function(){$timeout(loadMedia,0)},100)),scope.$on("$destroy",cleanup),scope.$on("domContentReplaced",onResize),scope.$on("expandableContentRevealed",onResize),attr.backgroundCta&&(element[0].style.cursor="pointer",element.on("click",onClickBackground)),scene7Video){var config=angular.fromJson(attr.backgroundVideoConfig);scene7.backgroundVid(attr.moduleId,attr.backgroundVideoId,config,onDynamicMediaPlayerInit)}videoId.match(/^[0-9]+$/)?backgroundVideo.getVideoSrc(videoId).then(setBackgroundVideoSrc):getElements(),onResize()}}}responsiveBackgroundImg.$inject=["$window","$timeout","viewport","backgroundVideo","scene7","utils","analyticsUtils"],angular.module("marketingCore").directive("responsiveBackgroundImg",responsiveBackgroundImg)}(angular,_),function(angular){"use strict";var paymentInfo={templateUrl:"app/checkOut/components/paymentInfo/paymentInfo.component.tpl.html",controller:"PaymentInfoController as vm",bindings:{userForm:"=",submitAction:"="}};angular.module("tmobileApp").component("paymentInfo",paymentInfo)}(angular),function(angular,lodash){"use strict";function responsiveImageSource($window,viewport){return{restrict:"A",scope:{responsiveImageSource:"<"},link:function(scope,element){function updateImageSource(){var image=getImageForBreakpoint();element[0].setAttribute("src",image)}function getImageForBreakpoint(){return viewport.breakpointUp("desktop")?desktopImage:viewport.breakpointUp("tablet")?tabletImage:mobileImage}function cleanup(){win.off("resize")}var win=angular.element($window),images=scope.responsiveImageSource,desktop=images.desktop,tablet=images.tablet,mobile=images.mobile,desktopImage=desktop||tablet||mobile,tabletImage=tablet||desktop||mobile,mobileImage=mobile||tablet||desktop;win.on("resize",lodash.throttle(updateImageSource,100)),scope.$on("$destroy",cleanup),updateImageSource()}}}responsiveImageSource.$inject=["$window","viewport"],angular.module("marketingCore").directive("responsiveImageSource",responsiveImageSource)}(angular,_),function(angular){"use strict";var expertBar={templateUrl:"app/checkOut/components/expertBar/expertBar.tpl.html",controller:"ExpertBarController as vm"};angular.module("tmobileApp").component("expertBar",expertBar)}(window.angular),function(angular,lodash){"use strict";function scrollPrompt($window,$document,$timeout){return{restrict:"A",link:function(scope,element,attr){function onScroll(){scope.showPrompt=!1,win.scrollTop()+screen.height>$document[0].body.offsetHeight?element.css("opacity","0"):element.css("opacity","1")}function scrollEnd(){var timeout=null;win.on("scroll",lodash.throttle(function(){$timeout.cancel(timeout),timeout=$timeout(function(){var bodyPlayVideo=angular.element("body").hasClass("video-play");bodyPlayVideo?scope.showPrompt=!1:scope.showPrompt=!0},1e3)},100))}function cleanup(){win.off("scroll.scrollPrompt")}var win=angular.element($window);angular.element("body").hasClass("video-play");win.on("scroll.scrollPrompt",lodash.throttle(onScroll,100)),scrollEnd(),scope.showPrompt=!0,scope.$on("$destroy",cleanup)}}}scrollPrompt.$inject=["$window","$document","$timeout"],angular.module("marketingCore").directive("scrollPrompt",scrollPrompt)}(window.angular,window._),function(angular){"use strict";var deviceConfirmation={templateUrl:"app/checkOut/components/deviceConfirmation/deviceConfirmation.tpl.html",controller:"DeviceConfirmationController as vm",bindToController:!0};angular.module("tmobileApp").component("deviceConfirmation",deviceConfirmation)}(window.angular),function(angular){"use strict";function scrollTop($window){return{restrict:"A",link:function(scope,element,attr){function onScroll(){$window.pageYOffset>400?scope.showUpArrow=!0:scope.showUpArrow=!1}function cleanup(){win.off("scroll.scrollTop")}var win=angular.element($window);win.on("scroll.scrollTop",_.throttle(onScroll,100)),scope.showUpArrow=!1,scope.$on("$destroy",cleanup),scope.scrollToTop=function(){var scrollDuration=500,scrollStep=-$window.scrollY/(scrollDuration/15),scrollInterval=setInterval(function(){0!=$window.scrollY?$window.scrollBy(0,scrollStep):clearInterval(scrollInterval)},15)}}}}scrollTop.$inject=["$window"],angular.module("marketingCore").directive("scrollTop",scrollTop)}(window.angular),function(angular){"use strict";var creditCheckTpp={templateUrl:"app/checkOut/components/creditCheckTpp/creditCheckTpp.component.tpl.html",controller:"CreditCheckTppController as vm",bindings:{userForm:"=",submitAction:"=",verifyIdentity:"<",errors:"="}};angular.module("tmobileApp").component("creditCheckTpp",creditCheckTpp)}(window.angular),function(angular,lodash){"use strict";function smoothScroll($window,$document,$timeout,utils){return{restrict:"A",link:function(scope,element,attr){function scroller(e){e.preventDefault(),closeMenu();var i,startY=currentYPosition(),elmY=elmYPosition(moduleID),distance=elmY>startY?elmY+startY:startY-elmY,stopY=elmY,speed=Math.round(distance/100),step=Math.round(distance/25),leapY=stopY>startY?startY+step:startY-step,timer=0;if(100>distance)return void scrollTo(0,elmY);if(speed>=20&&(speed=20),stopY>startY)for(i=startY;stopY>i;i+=step)setTimeout("window.scrollTo(0, "+leapY+")",timer*speed),leapY+=step,leapY>stopY&&(leapY=stopY),timer++;else for(i=startY;i>stopY;i-=step)setTimeout("window.scrollTo(0, "+leapY+")",timer*speed),leapY-=step,stopY>leapY&&(leapY=stopY),timer++}function currentYPosition(){return $window.pageYOffset}function elmYPosition(moduleId){var mod=$document[0].querySelectorAll("[data-module-id="+moduleId+"]");mod.length||(mod=element);var positions=lodash.flatMap(mod,function(value){return value.getBoundingClientRect().top+$window.pageYOffset-62});return positions[0]}function closeMenu(){angular.element(".overlay-menu").removeClass("open").css("display","none").css("visibility","hidden").attr("aria-hidden","true"),angular.element(".mute-screen").removeClass("on"),angular.element(".hamburger").attr("aria-expanded",!1),angular.element("body").removeClass("no-scroll")}function cleanup(){scrollLink.off("click",scroller)}var moduleID="";attr.href&&(moduleID=attr.href.replace("#","").split("?")[0]),attr.ngHref&&(moduleID=attr.ngHref.replace("#","").split("?")[0]);var scrollLink=element;scrollLink.on("click",scroller),scope.$on("$destroy",cleanup)}}}smoothScroll.$inject=["$window","$document","$timeout","utils"],angular.module("marketingCore").directive("smoothScroll",smoothScroll)}(window.angular,window._),function(angular){"use strict";var creditCheck={templateUrl:"app/checkOut/components/creditCheck/creditCheck.component.tpl.html",controller:"CreditCheckController as vm",bindings:{sourceType:"<",userForm:"=",authorValue:"<"}};angular.module("tmobileApp").component("creditCheck",creditCheck)}(angular),function(angular){"use strict";function socialMediaCarousel($window,analyticsUtils,$timeout){return{restrict:"A",link:function(scope,element,attr){function onInit(e,slick){element[0].querySelector(".slick-current").classList.add("add-highlight"),slick.$slider[0].style.opacity="1",$timeout(function(){clickItems=element[0].querySelectorAll(".slick-dots button"),clickItems.forEach(function(item){item.onclick=slickDotClick()})},500),angular.element($window).triggerHandler("resize")}function slickDotClick(){return function(){$timeout(function(){analyticsUtils.trackCarousel(next>prevSlide,element)},500)}}function onAfterChange(e,slick,currentSlide,nextSlide){element[0].querySelector('[data-slick-index="'+prevSlide+'"]').classList.remove("add-highlight"),element[0].querySelector(".slick-current").classList.add("add-highlight")}function onBeforeChange(e,slick,currentSlide,nextSlide){prevSlide=currentSlide,next=nextSlide}function cleanup(){scope.vm.slickConfig&&scope.vm.slickConfig.method.unslick()}function onSwipe(e,slick,direction){var trackingNav;trackingNav="left"===direction?!0:!1,analyticsUtils.trackCarousel(trackingNav,element)}var prevSlide,next,clickItems;scope.vm.slickConfig&&(scope.vm.slickConfig.event.init=onInit,scope.vm.slickConfig.event.afterChange=onAfterChange,scope.vm.slickConfig.event.beforeChange=onBeforeChange,scope.vm.slickConfig.event.swipe=onSwipe),scope.$on("$destroy",cleanup)}}}socialMediaCarousel.$inject=["$window","analyticsUtils","$timeout"],angular.module("marketingCore").directive("socialMediaCarousel",socialMediaCarousel)}(angular),function(angular){"use strict";var checkOutProgress={templateUrl:"app/checkOut/components/checkOutProgress/checkOutProgress.component.tpl.html",controller:"CheckOutProgressController as vm",bindings:{arrayOfSections:"<",sectionToBeDisplayed:"=",setSectionToBeDisplayed:"=",enableSection:"="}};angular.module("tmobileApp").component("checkOutProgress",checkOutProgress)}(angular),function(angular){"use strict";function socialMediaWall($window,utils,viewport,$interval){return{restrict:"A",link:function(scope,element,attr){function initMediaWall(LiveMediaWall){WallConstructor=LiveMediaWall,loadedInterval=$interval(function(){element.find("a.hub-list-more").length&&(element.find("a.hub-list-more").attr("data-analytics-id",element.attr("data-analytics-id")+"-loadMore"),$interval.cancel(loadedInterval),loadedInterval=null)},100),viewport.onBreakpointChange(onBreakpointChange,!0)}function onSuccess(){$window.Livefyre.require(["streamhub-wall#6"],initMediaWall)}function onBreakpointChange(bp){viewport.breakpointUp("desktop")&&!isDesktop?(config.initial=6,config.showMore=6,wallInstance&&(wallInstance.destroy(),wallInstance=null),wallInstance=new WallConstructor(config)):viewport.breakpointUp("desktop")||!isDesktop&&isDesktop||(config.initial=2,config.showMore=2,wallInstance&&(wallInstance.destroy(),wallInstance=null),wallInstance=new WallConstructor(config)),isDesktop="desktop"===bp}function cleanup(){wallInstance&&(wallInstance.destroy(),wallInstance=null)}var WallConstructor,wallInstance,loadedInterval,isDesktop,network=attr.network,siteId=attr.siteId,articleId=attr.articleId,showMore=attr.showMore,config={el:element.find("#social-media-wall-"+attr.moduleId)[0],collection:{network:network,siteId:siteId,articleId:articleId},postButton:!0,initial:6,showMore:6,cardBackgroundColor:"#ffffff",textColor:"#000000",bodyFontSize:"22px",bodyLineHeight:"28px",linkColor:"#e20074",footerTextColor:"#5a5a5a",displayNameColor:"#5a5a5a",usernameColor:"#5a5a5a",fontFamily:"tele-nor, sans-serif",showMoreButtonText:showMore};scope.$on("$destroy",cleanup),utils.loadScript("https://cdn.livefyre.com/Livefyre.js",onSuccess)}}}socialMediaWall.$inject=["$window","utils","viewport","$interval"],angular.module("marketingCore").directive("socialMediaWall",socialMediaWall)}(angular),function(angular){"use strict";var addressFields={templateUrl:"app/checkOut/components/addressFields/addressFields.component.tpl.html",controller:"AddressFieldsController as vm",bindings:{sourceType:"<",addressAuthorValue:"<",formData:"=",addressForm:"<",addressType:"<",sameAsAbove:"=",authorValue:"<",formName:"<",errors:"="}};angular.module("tmobileApp").component("addressFields",addressFields)}(angular),function(angular){"use strict";function stickyTabNav($document,$window,utils,$timeout){return{restrict:"A",link:function(scope,element,attr){function toggleStickyTabNav(){var scrollTop=win.scrollTop(),containerDimensions=utils.getElementOffset(stickyHeader.parentElement),navHeader=$document[0].querySelector(".global-header"),navHeaderHeight=navHeader?navHeader.offsetHeight:0;elementTop=containerDimensions.top,elementBottom=containerDimensions.bottom,scrollTop>elementTop-navHeaderHeight?(scope.toggleSticky=!0,stickyHeader.style.top=navHeaderHeight+"px"):(scope.toggleSticky=!1,stickyHeader.style.top="inherit"),scrollTop>elementBottom-headerHeight?scope.stickyOutBottom=!0:scope.stickyOutBottom=!1,scope.$apply()}function cleanup(){win.off("scroll.stickyTabNav")}var elementTop,elementBottom,win=angular.element($window),stickyHeader=element[0].querySelector(".tablist"),headerHeight=stickyHeader.offsetHeight;$timeout(function(){toggleStickyTabNav()},0),win.on("scroll.stickyTabNav",_.throttle(toggleStickyTabNav,100)),scope.$on("$destroy",cleanup)}}}stickyTabNav.$inject=["$document","$window","utils","$timeout"],angular.module("marketingCore").directive("stickyTabNav",stickyTabNav)}(window.angular),function(angular,lodash){"use strict";function checkOutControllerConstructor(commonServices,coreServices,checkOutProgressService,checkOutModelService,modalDialogFactory,paymentAndCreditCheckUtil,checkOutControllerHelperUtil,personalInfoUtil,shippingUtil,checkOutConstants,globalValue,checkOutValidationUtil,dataFactory,cartHttpDataService,cartStorage,commonUtils,responseTransformationServiceV3,commonStorage,checkOutHttpDataUtil,$q,checkout,cartCommonOperationsService,pdlService,pdlConstant,$window){function errorHandler(error){return $log.log("Something went wrong: ",error),lodash.get(toggleService.model,"toggles.isEclaEnabled",!1)&&(checkOutModelService.model.errors.displayErrorMessage=!0),closeProgressModal(),error}function submitUserInfoForm(userForm){!userForm||userForm.$invalid||userForm.$pending||(checkOutModelService.model.errors.displayErrorMessage=!1,personalInfoUtil.setPersonalInfo().then(function(status){angular.equals(status,200)?(shippingUtil.submitShippingData(),vm.model.sectionToBeDisplayed=checkOutConstants.SECTIONS.PAYMENTANDCREDIT,checkOutModelService.model.errors.displayErrorMessage=!1,$log.log("status personalInfo ",status)):(checkOutModelService.model.errors.displayErrorMessage=!0,coreServices.logger.error("We have an error in submitting personal information.",null))})["catch"](errorHandler))}function submitUserInfoFormV3(userForm){if(userForm&&!userForm.$invalid&&!userForm.$pending){checkOutModelService.model.errors.displayErrorMessage=!1;var isPromiseSuccess,promiseArray=[],personalInfoV3=personalInfoUtil.setPersonalInfoV3();if(promiseArray.push(personalInfoV3),lodash.get(toggleService.model,"toggles.enableBVPIE",!1)){var getBvEncryptionKey=cartHttpDataService.getBvEncryptionKey();promiseArray.push(getBvEncryptionKey)}$q.all(promiseArray).then(function(response){isPromiseSuccess=vm.validateResponseStatus(response),isPromiseSuccess?(pdlService.setFormCompleteEvent(pdlConstant.FORM_NAME.PERSONAL_INFO,"","","","",""),lodash.get(toggleService.model,"toggles.enableBVPIE",!1)&&response[1].data&&getEncryptedBvObject(response[1].data),redirectToScreen(),$log.log("status personalInfo ",status)):(checkOutModelService.model.errors.displayErrorMessage=!0,pdlService.setCheckoutErrorEvent(setCheckoutErrorEvent(vm.authorValue.checkout.personalInfoAndShipping.personalInfoError,response.status,pdlConstant.FORM_NAME.PERSONAL_INFO)),$log.log("We have an error in submitting personal information.",null))})["catch"](errorHandler)}}function getEncryptedBvObject(response){var publicKey,emailId=lodash.get(checkOutModelService.model.checkOutInfo.personalInfo,"email");if(response&&response.publicKey&&response.encryptionKeyId&&emailId){publicKey=response.publicKey,checkOutModelService.model.checkOutInfo.encryptionKeyId=response.encryptionKeyId;var JSEncrypt=new $window.JSEncrypt;JSEncrypt.setPublicKey(publicKey),checkOutModelService.model.checkOutInfo.encryptedEmailId=JSEncrypt.encrypt(emailId)}}function redirectToScreen(){var cartData=cartStorage.getGlobalSmartCartInfo();vm.isOnlyAccessoryFlow=cartData.flags.isOnlyAccessory,angular.isDefined(vm.scc)||angular.isDefined(vm.hcc)||angular.isDefined(vm.isOnlyAccessoryFlow)?angular.equals(vm.hcc,checkOutConstants.TRUE)||vm.isOnlyAccessoryFlow?cartHttpDataService.getShippingOptions().then(function(shippingOptionsResponse){angular.equals(checkOutConstants.HTTP_CODES.STATUS_SUCCESS,shippingOptionsResponse.status)?vm.redirectToShippingAndPayment(shippingOptionsResponse.data):(checkOutModelService.model.errors.displayErrorMessage=!0,pdlService.setCheckoutErrorEvent(setCheckoutErrorEvent(vm.authorValue.checkout.personalInfoAndShipping.personalInfoError,shippingOptionsResponse.status,pdlConstant.FORM_NAME.PERSONAL_INFO)),$log.log("We have an error in get Shipping options response",null))})["catch"](errorHandler):angular.equals(vm.scc,checkOutConstants.TRUE)?(vm.isVerifyIdentity=!0,vm.model.sectionToBeDisplayed=checkOutConstants.SECTIONS.VERIFY_CREDIT,checkOutModelService.setSectionToBeDisplayed(checkOutConstants.SECTIONS.VERIFY_CREDIT)):(vm.isVerifyIdentity=!1,vm.model.sectionToBeDisplayed=checkOutConstants.SECTIONS.VERIFY_CREDIT,checkOutModelService.setSectionToBeDisplayed(checkOutConstants.SECTIONS.VERIFY_CREDIT)):(vm.isVerifyIdentity=!1,vm.model.sectionToBeDisplayed=checkOutConstants.SECTIONS.VERIFY_CREDIT,checkOutModelService.setSectionToBeDisplayed(checkOutConstants.SECTIONS.VERIFY_CREDIT))}function submitPaymentAndCreditCheckForm(paymentAndCreditCheckForm){paymentAndCreditCheckForm&&(paymentAndCreditCheckForm.ssn&&vm.validateSsnOnChange(paymentAndCreditCheckForm.ssn,vm.checkOutInfo.personalInfo.creditClass),paymentAndCreditCheckForm.$invalid||(paymentAndCreditCheckUtil.submitPaymentAndCreditCheck(),vm.model.sectionToBeDisplayed=checkOutConstants.SECTIONS.REVIEW))}function submitPaymentAndShippingFormV3(paymentAndCreditCheckForm){if(paymentAndCreditCheckForm&&!paymentAndCreditCheckForm.$invalid){var billingAddressId,isPromiseSuccess,addressIdList=[],operations=shippingUtil.profileAddressOperation(),deleteRequestList=shippingUtil.generateDeleteAddressrequest(operations["delete"]),generatePostAddressRequest=shippingUtil.generatePostAddressRequest(operations.post),generatePatchAddressRequest=shippingUtil.generatePatchAddressRequest(operations.patch),profileData=personalInfoUtil.getPersonalInfoAndIdentifierV3(),getPublicKeyPromise=paymentAndCreditCheckUtil.getPublicKey(),isAccessoryFlow=cartStorage.getGlobalSmartCartInfo().flags.isOnlyAccessory;if(operations.patch.length>0){var billindAddressObj=lodash.find(operations.patch,function(address){return address.type===checkOutConstants.ADDRESS_TYPE.BILLING});angular.isUndefined(billindAddressObj)||(billingAddressId=billindAddressObj.addressId)}var promiseArray=lodash.concat(deleteRequestList,generatePostAddressRequest,generatePatchAddressRequest,getPublicKeyPromise);if(!isAccessoryFlow){var updateprofieSetPinRequest=cartHttpDataService.updateProfileInfoV3(profileData);promiseArray.push(updateprofieSetPinRequest)}if(lodash.get(toggleService.model,"toggles.isEclaEnabled",!1)&&cartStorage.getIsEIPReservationRequired()){var postFinanceEstimate=cartHttpDataService.postFinanceEstimates(!1);promiseArray.push(postFinanceEstimate)}$q.all(promiseArray).then(function(data){isPromiseSuccess=vm.validateResponseStatus(data),isPromiseSuccess?(addressIdList=shippingUtil.getAddressIdFromAddressAPIResponse(data),commonStorage.assignIntoSharedLS(checkOutConstants.PROFILE_ADDRESS_LIST,addressIdList),billingAddressId||(billingAddressId=shippingUtil.getBillingAddressId(data)),$q.all([shippingUtil.postShippingOptionRequest(),shippingUtil.auditRecordsRequest()]).then(function(response){isPromiseSuccess=vm.validateResponseStatus(response),isPromiseSuccess?encrypt(checkOutModelService.model.checkOutInfo.cardInfo.publicKey,checkOutModelService.model.checkOutInfo.cardInfo.creditCardNumber,function(encryptedCardNumber){paymentAndCreditCheckUtil.setPaymentInfoV3(checkOutModelService.model.checkOutInfo,billingAddressId,encryptedCardNumber).then(paymentSuccessHandler)},function(errorData){commonServices.$log.log("Something went wrong: ",errorData)}):(commonServices.$log.log("We have an error while posting shipping option or audit records"),checkOutModelService.model.errors.displayErrorMessage=!0,pdlService.setCheckoutErrorEvent(setCheckoutErrorEvent(pdlConstant.SHIPPING_PAYMENT_ERROR,_.get(vm.failureResponse,"status",""),pdlConstant.FORM_NAME.SHIPPING_PAYMENT)))})):(commonServices.$log.log("We have an error while calling any one of this api - Address/Profile/PublicKey"),checkOutModelService.model.errors.displayErrorMessage=!0,pdlService.setCheckoutErrorEvent(setCheckoutErrorEvent(pdlConstant.SHIPPING_PAYMENT_ERROR,_.get(vm.failureResponse,"status",""),pdlConstant.FORM_NAME.SHIPPING_PAYMENT)))})["catch"](function(){$log.error("We have an error in submitting shipping and payment information."),checkOutModelService.model.errors.displayErrorMessage=!0,pdlService.setCheckoutErrorEvent(setCheckoutErrorEvent(pdlConstant.SHIPPING_PAYMENT_ERROR,"",pdlConstant.FORM_NAME.SHIPPING_PAYMENT))})}else checkOutModelService.model.errors.displayErrorMessage=!0,$log.error("We have an error in submitting shipping and payment information.",null),pdlService.setCheckoutErrorEvent(setCheckoutErrorEvent(pdlConstant.SHIPPING_PAYMENT_ERROR,"",pdlConstant.FORM_NAME.SHIPPING_PAYMENT))}function paymentSuccessHandler(isRedirectionSuccess){isRedirectionSuccess?cartHttpDataService.getQuotes(checkOutModelService.model.checkOutInfo).then(function(response){angular.isDefined(response)&&200===response.status?(vm.model.sectionToBeDisplayed=checkOutConstants.SECTIONS.REVIEW,checkOutModelService.setSectionToBeDisplayed(checkOutConstants.SECTIONS.REVIEW),lodash.get(toggleService.model,"toggles.isFormStartAnalyticsOn",!1)&&pdlService.setFormCompleteEvent(pdlConstant.FORM_NAME.SHIPPING_PAYMENT,"","","","","")):$log.error("We have an error in getting quotes detail")})["catch"](errorHandler):$log.error("We have an error in posting payment detail")}function getCreditProfileInfo(eosResponse){var creditProfileData={};return creditProfileData.creditAppRefId=eosResponse.creditReferenceNumber,creditProfileData.creditClass=eosResponse.creditClass,creditProfileData.creditCheckDate=eosResponse.creditDate,creditProfileData.applicationStatus=eosResponse.applicationStatus,creditProfileData.decisionCriteria=checkOutConstants.DECISION_CRITERIA,creditProfileData}function openModalPopup(creditCheckDataOption){vm.cartManualReview=lodash.get(globalValue.authorValue,"rootPage.cartManualReview",{});var applicationStatus=creditCheckDataOption.applicationStatus;if(creditCheckDataOption.isExistingCustomer===!0)localStorage.setItem("isCheckoutModalOpenFlow","true"),lodash.get(toggleService.model,"toggles.handleTMOorSprintCustomer",!1)&&creditCheckDataOption.billingApplication&&(checkOutModelService.billingApplication=creditCheckDataOption.billingApplication),
cartCommonOperationsService.openAuthenticationModal();else if(creditCheckDataOption.isExistingCustomer||applicationStatus!==checkOutConstants.APPLICATION_STATUS_REVIEW)creditCheckDataOption.isExistingCustomer||creditCheckDataOption.applicationStatus!==checkOutConstants.APPLICATION_STATUS_COMPLETE||(localStorage.setItem("isCheckoutModalOpenFlow","true"),modalDialogFactory.openOrderDetailsModal());else{localStorage.setItem("isCheckoutModalOpenFlow","true");var modalInstance=modalDialogFactory.openCartManualReviewModal();modalInstance.then(function(){},function(){angular.isDefined(vm.cartManualReview.ctaToCartLink)&&(commonServices.$window.location.href=vm.cartManualReview.ctaToCartLink)})}}function getEOSCreditCheckData(profileId,creditProfileId){var profileData={customerInfo:{address:[{}],phoneDetails:[{}],identificationDetails:{}}};lodash.get(toggleService.model,"toggles.isValidateAddressAPI",!1)?profileData.validateAddress=!0:profileData.validateAddress=!1,profileData.creditCheckType=checkOutConstants.CREDIT_CHECK_TYPE,profileData.customerInfo.profileId=profileId,profileData.customerInfo.creditProfileId=creditProfileId,profileData.customerInfo.ssn=lodash.get(checkOutModelService.model.checkOutInfo.verifyId,checkOutConstants.VERIFY_ID.SSN),profileData.customerInfo.firstName=lodash.get(checkOutModelService.model.checkOutInfo.personalInfo,checkOutConstants.VERIFY_ID.FIRSTNAME),profileData.customerInfo.middleName=lodash.get(checkOutModelService.model.checkOutInfo.personalInfo,checkOutConstants.VERIFY_ID.MIDDLENAME),profileData.customerInfo.lastName=lodash.get(checkOutModelService.model.checkOutInfo.personalInfo,checkOutConstants.VERIFY_ID.LASTNAME),profileData.customerInfo.dateOfBirth=lodash.get(checkOutModelService.model.checkOutInfo.verifyId,checkOutConstants.VERIFY_ID.DOB),profileData.customerInfo.address[0].cityName=lodash.get(checkOutModelService.model.checkOutInfo.residentialInfo,checkOutConstants.VERIFY_ID.CITY),profileData.customerInfo.address[0].postalCode=lodash.get(checkOutModelService.model.checkOutInfo.residentialInfo,checkOutConstants.VERIFY_ID.ZIP),lodash.get(toggleService.model,"toggles.handleTMOorSprintCustomer",!1)?profileData.customerInfo.address[0].addressLine1=lodash.get(checkOutModelService.model.checkOutInfo.newResidentialInfo,checkOutConstants.VERIFY_ID.ADDRESS1):profileData.customerInfo.address[0].addressLine1=lodash.get(checkOutModelService.model.checkOutInfo.residentialInfo,checkOutConstants.VERIFY_ID.ADDRESS1),profileData.customerInfo.address[0].addressLine2=lodash.get(checkOutModelService.model.checkOutInfo.residentialInfo,checkOutConstants.VERIFY_ID.ADDRESS2),profileData.customerInfo.address[0].stateCode=lodash.get(checkOutModelService.model.checkOutInfo.residentialInfo,checkOutConstants.VERIFY_ID.STATE),profileData.customerInfo.phoneDetails[0].phoneNumber=lodash.get(checkOutModelService.model.checkOutInfo.personalInfo,checkOutConstants.VERIFY_ID.PHONENUMBER),profileData.customerInfo.emailAddress=lodash.get(checkOutModelService.model.checkOutInfo.personalInfo,checkOutConstants.VERIFY_ID.EMAIL),profileData.customerInfo.identificationDetails.identityDocumentId=lodash.get(checkOutModelService.model.checkOutInfo.verifyId,checkOutConstants.VERIFY_ID.ID_NUMBER),profileData.customerInfo.identificationDetails.identityDocumentType=lodash.get(checkOutModelService.model.checkOutInfo.creditcheckTpp,checkOutConstants.VERIFY_ID.IDENTITY_DOCUMENT_ID),profileData.customerInfo.identificationDetails.issuingState=lodash.get(checkOutModelService.model.checkOutInfo.creditcheckTpp,checkOutConstants.VERIFY_ID.STATE);var expirationDate=lodash.get(checkOutModelService.model.checkOutInfo.creditcheckTpp,checkOutConstants.VERIFY_ID.EXPIRY_DATE),expiryDate=expirationDate.slice(0,2)+checkOutConstants.EXPIRATION_DATE_DAY+expirationDate.slice(2,4);return profileData.customerInfo.identificationDetails.expirationDate=expiryDate,profileData}function encryptData(publicKey){var encryptDataDeferred=$q.defer(),SSNValue=lodash.get(checkOutModelService.model.checkOutInfo.creditcheckTpp,checkOutConstants.VERIFY_ID.SSN),idNumberValue=lodash.get(checkOutModelService.model.checkOutInfo.creditcheckTpp,checkOutConstants.VERIFY_ID.ID_NUMBER),dateOfBirth=lodash.get(checkOutModelService.model.checkOutInfo.creditcheckTpp,checkOutConstants.VERIFY_ID.DOB),addressLine1=lodash.get(checkOutModelService.model.checkOutInfo.residentialInfo,checkOutConstants.VERIFY_ID.ADDRESS1),dob=dateOfBirth.slice(0,2)+"-"+dateOfBirth.slice(2,4)+"-"+dateOfBirth.slice(4);return encrypt(publicKey,SSNValue,function(encryptedSSN){checkOutModelService.model.checkOutInfo.verifyId[checkOutConstants.VERIFY_ID.SSN]=encryptedSSN,encrypt(publicKey,idNumberValue,function(encryptedIdNumber){checkOutModelService.model.checkOutInfo.verifyId[checkOutConstants.VERIFY_ID.ID_NUMBER]=encryptedIdNumber,encrypt(publicKey,dob,function(encryptedDob){checkOutModelService.model.checkOutInfo.verifyId[checkOutConstants.VERIFY_ID.DOB]=encryptedDob,lodash.get(toggleService.model,"toggles.handleTMOorSprintCustomer",!1)?encrypt(publicKey,addressLine1,function(encryptedAddresseLine1){checkOutModelService.model.checkOutInfo.newResidentialInfo={},checkOutModelService.model.checkOutInfo.newResidentialInfo[checkOutConstants.VERIFY_ID.ADDRESS1]=encryptedAddresseLine1,encryptDataDeferred.resolve()},function(error){encryptDataDeferred.reject({error:checkOutConstants.ECRYPTION_ERROR})}):encryptDataDeferred.resolve()},function(error){encryptDataDeferred.reject({error:checkOutConstants.ECRYPTION_ERROR})})},function(error){encryptDataDeferred.reject({error:checkOutConstants.ECRYPTION_ERROR})})},function(error){encryptDataDeferred.reject({error:checkOutConstants.ECRYPTION_ERROR})}),encryptDataDeferred.promise}function encryptDataForVerifyID(publicKey){var encryptDataDeferred=$q.defer(),SSNValue=lodash.get(checkOutModelService.model.checkOutInfo.creditcheckTpp,checkOutConstants.VERIFY_ID.SSN),idNumberValue=lodash.get(checkOutModelService.model.checkOutInfo.creditcheckTpp,checkOutConstants.VERIFY_ID.ID_NUMBER);return encrypt(publicKey,SSNValue,function(encryptedSSN){checkOutModelService.model.checkOutInfo.verifyId[checkOutConstants.VERIFY_ID.SSN]=encryptedSSN,encrypt(publicKey,idNumberValue,function(encryptedIdNumber){checkOutModelService.model.checkOutInfo.verifyId[checkOutConstants.VERIFY_ID.ID_NUMBER]=encryptedIdNumber,encryptDataDeferred.resolve()},function(error){encryptDataDeferred.reject({error:checkOutConstants.ECRYPTION_ERROR})})},function(error){encryptDataDeferred.reject({error:checkOutConstants.ECRYPTION_ERROR})}),encryptDataDeferred.promise}function submitVerifyIdForm(verifyIdForm){verifyIdForm&&!verifyIdForm.$invalid&&cartHttpDataService.getPublicKey(checkOutConstants.GET_PUBLIC_KEY_VERIFY_IDENTITY).then(function(response){if(angular.equals(checkOutConstants.HTTP_CODES.STATUS_SUCCESS,response.status)){var apiResponse=response.data.publicKey,publicKey=JSON.parse(apiResponse.trim());vm.encryptDataForVerifyID(publicKey).then(function(){vm.verifyProfileIdentifierInfo().then(function(response){angular.equals(checkOutConstants.HTTP_CODES.STATUS_SUCCESS,response.status)?(pdlService.setFormCompleteEvent(pdlConstant.FORM_NAME.VERIFY_ID,"","","","",""),cartStorage.setHardCreditCheck(checkOutConstants.TRUE),fetchShippingOptions()):angular.equals(checkOutConstants.HTTP_CODES.STATUS_REJECT,response.status)?checkOutModelService.model.errors.displaySSNMismatchError=!0:(checkOutModelService.model.errors.displayErrorMessage=!0,pdlService.setCheckoutErrorEvent(setCheckoutErrorEvent(vm.authorValue.checkout.creditCheckTpp.verifyIdentityErrorMessage,response.status,pdlConstant.FORM_NAME.VERIFY_ID)))})["catch"](errorHandler)})["catch"](errorHandler)}else checkOutModelService.model.errors.displayErrorMessage=!0,pdlService.setCheckoutErrorEvent(setCheckoutErrorEvent(vm.authorValue.checkout.creditCheckTpp.verifyIdentityErrorMessage,response.status,pdlConstant.FORM_NAME.VERIFY_ID)),$log.log("We have an error in get public key api call",null)})}function verifyProfileIdentifierInfo(){return cartHttpDataService.getProfileId().then(function(profileId){var expirationDate=lodash.get(checkOutModelService.model.checkOutInfo.creditcheckTpp,checkOutConstants.VERIFY_ID.EXPIRY_DATE),expiryDate=expirationDate.slice(0,2)+checkOutConstants.EXPIRATION_DATE_DAY+expirationDate.slice(2,4),body={profileId:profileId,ssn:lodash.get(checkOutModelService.model.checkOutInfo.verifyId,checkOutConstants.VERIFY_ID.SSN),identification:{identityDocumentId:lodash.get(checkOutModelService.model.checkOutInfo.verifyId,checkOutConstants.VERIFY_ID.ID_NUMBER),identityDocumentType:lodash.get(checkOutModelService.model.checkOutInfo.creditcheckTpp,checkOutConstants.VERIFY_ID.IDENTITY_DOCUMENT_ID),expirationDate:expiryDate,issuingState:lodash.get(checkOutModelService.model.checkOutInfo.creditcheckTpp,checkOutConstants.VERIFY_ID.STATE)}};return cartHttpDataService.onVerifyIdentity(body)})["catch"](errorHandler)}function submitCreditCheckForm(creditCheckForm){if(checkOutModelService.model.errors.displayInProgressErrorMessage=!1,checkOutModelService.model.errors.displayTimedOutErrorMessage=!1,checkOutModelService.model.errors.displayInvalidAddressError=!1,creditCheckForm&&!creditCheckForm.$invalid){var ignoreLoadingBar;angular.equals(vm.hcc,checkOutConstants.TRUE)||angular.equals(vm.scc,checkOutConstants.TRUE)||!vm.toggles.isCDHCCEnabled||(vm.openCCProgressModal(),ignoreLoadingBar=!0),cartHttpDataService.getPublicKey(checkOutConstants.GET_PUBLIC_KEY_CREDIT_CHECK,ignoreLoadingBar).then(function(response){if(angular.equals(checkOutConstants.HTTP_CODES.STATUS_SUCCESS,response.status)){var apiResponse=response.data.publicKey,publicKey=JSON.parse(apiResponse.trim());vm.encryptData(publicKey).then(function(){cartHttpDataService.getProfileId(ignoreLoadingBar).then(function(profileId){var creditProfileId=cartStorage.getCreditProfileId(),creditCheckInputData=getEOSCreditCheckData(profileId,creditProfileId);cartHttpDataService.eosCreditCheck(creditCheckInputData,ignoreLoadingBar).then(function(eosResponse){if(angular.equals(checkOutConstants.HTTP_CODES.STATUS_SUCCESS,eosResponse.status)&&vm.toggles.isCDHCCEnabled)if(eosResponse.data&&eosResponse.data.applicationStatus&&angular.equals(checkOutConstants.APPLICATION_STATUS_INPROGRESS,eosResponse.data.applicationStatus))checkOutModelService.model.errors.displayInProgressErrorMessage=!0,pdlService.setCheckoutErrorEvent(setCheckoutErrorEvent(vm.authorValue.checkout.creditCheckTpp.ccInProgressErrorMessage,eosResponse.status,pdlConstant.FORM_NAME.CREDIT_CHECK)),$log.log("Credit check is in progress",null),closeProgressModal();else{pdlService.setFormCompleteEvent(pdlConstant.FORM_NAME.CREDIT_CHECK,"","","","","");var creditClass=eosResponse.data.creditClass;if(vm.creditCheckData={creditClass:eosResponse.data.creditClass,applicationStatus:eosResponse.data.applicationStatus,isExistingCustomer:eosResponse.data.isExistingCustomer,creditRefId:eosResponse.data.creditReferenceNumber,billingApplication:eosResponse.data.billingApplication},eosResponse.data&&eosResponse.data.applicationStatus===checkOutConstants.APPLICATION_STATUS_COMPLETE&&!eosResponse.data.isExistingCustomer)if(cartStorage.setPriceIndicator(creditClass),cartStorage.setHardCreditCheck(checkOutConstants.TRUE),creditProfileId){var creditProfileInfo=getCreditProfileInfo(eosResponse.data);vm.toggles.isPatchCreditProfileSuppressed?vm.toggles.isEclaEnabled&&cartStorage.getIsEIPReservationRequired()?postFinanceEstimates(ignoreLoadingBar):fetchCartV3(ignoreLoadingBar):cartHttpDataService.updateCreditProfileV3(creditProfileInfo,profileId,creditProfileId,ignoreLoadingBar).then(function(creditProfileV3){angular.equals(checkOutConstants.HTTP_CODES.STATUS_UPDATE,creditProfileV3.status)||angular.equals(checkOutConstants.HTTP_CODES.STATUS_SUCCESS,creditProfileV3.status)?fetchCartV3(ignoreLoadingBar):(checkOutModelService.model.errors.displayErrorMessage=!0,pdlService.setCheckoutErrorEvent(setCheckoutErrorEvent(vm.authorValue.checkout.creditCheckTpp.ccErrorMessage,creditProfileV3.status,pdlConstant.FORM_NAME.CREDIT_CHECK)),$log.log("We have an error in get cart response",null),closeProgressModal())})["catch"](errorHandler)}else checkOutModelService.model.errors.displayErrorMessage=!0,pdlService.setCheckoutErrorEvent(setCheckoutErrorEvent(vm.authorValue.checkout.creditCheckTpp.ccErrorMessage,eosResponse.status,pdlConstant.FORM_NAME.CREDIT_CHECK)),$log.log("We have an error in credit profile id",null),closeProgressModal();else fetchShippingOptions(ignoreLoadingBar)}else angular.equals(checkOutConstants.HTTP_CODES.STATUS_SUCCESS,eosResponse.status)&&!vm.toggles.isCDHCCEnabled?(pdlService.setFormCompleteEvent(pdlConstant.FORM_NAME.CREDIT_CHECK,"","","","",""),fetchShippingOptions(ignoreLoadingBar)):angular.equals(checkOutConstants.HTTP_CODES.STATUS_TIMEDOUT,eosResponse.status)&&angular.equals(checkOutConstants.HTTP_CODES.STATUS_TIMEDOUT,parseInt(eosResponse.data.code))?(checkOutModelService.model.errors.displayTimedOutErrorMessage=!0,pdlService.setCheckoutErrorEvent(setCheckoutErrorEvent(vm.authorValue.checkout.creditCheckTpp.ccTimedOutErrorMessage,eosResponse.status,pdlConstant.FORM_NAME.CREDIT_CHECK)),$log.log("Credit check api timed out",null),closeProgressModal()):eosResponse.data&&angular.equals(checkOutConstants.HTTP_CODES.STATUS_ERROR,eosResponse.status)&&angular.equals(checkOutConstants.INVALID_ADDRESS,eosResponse.data.message)?(checkOutModelService.model.errors.displayInvalidAddressError=!0,closeProgressModal()):(checkOutModelService.model.errors.displayErrorMessage=!0,pdlService.setCheckoutErrorEvent(setCheckoutErrorEvent(vm.authorValue.checkout.creditCheckTpp.ccErrorMessage,eosResponse.status,pdlConstant.FORM_NAME.CREDIT_CHECK)),$log.log("We have an error in eos credit response",null),closeProgressModal())})["catch"](errorHandler)})})["catch"](errorHandler)}else checkOutModelService.model.errors.displayErrorMessage=!0,pdlService.setCheckoutErrorEvent(setCheckoutErrorEvent(vm.authorValue.checkout.creditCheckTpp.ccErrorMessage,response.status,pdlConstant.FORM_NAME.CREDIT_CHECK)),$log.log("We have an error in public key response",null),closeProgressModal()})["catch"](errorHandler)}}function fetchCartV3(ignoreLoadingBarParam){cartHttpDataService.getCartV3(ignoreLoadingBarParam).then(function(cartResponse){angular.equals(checkOutConstants.HTTP_CODES.STATUS_SUCCESS,cartResponse.status)?fetchShippingOptions(ignoreLoadingBarParam):(checkOutModelService.model.errors.displayErrorMessage=!0,pdlService.setCheckoutErrorEvent(setCheckoutErrorEvent(vm.authorValue.checkout.creditCheckTpp.ccErrorMessage,cartResponse.status,pdlConstant.FORM_NAME.CREDIT_CHECK)),$log.log("We have an error in patch api calls",null),closeProgressModal())})["catch"](errorHandler)}function postFinanceEstimates(ignoreLoadingBarParam){cartHttpDataService.postFinanceEstimates(!0).then(function(cartResponse){angular.equals(checkOutConstants.HTTP_CODES.STATUS_SUCCESS,cartResponse.status)?(cartStorage.setIsEIPReservationRequired(!1),cartStorage.raisePdlEvent(cartStorage.getGlobalSmartCartInfo()),fetchShippingOptions(ignoreLoadingBarParam)):(checkOutModelService.model.errors.displayErrorMessage=!0,pdlService.setCheckoutErrorEvent(setCheckoutErrorEvent(vm.authorValue.checkout.creditCheckTpp.ccErrorMessage,cartResponse.status,pdlConstant.FORM_NAME.CREDIT_CHECK)),$log.log("We have an error in patch api calls",null),closeProgressModal())})["catch"](errorHandler)}function fetchShippingOptions(ignoreLoadingBarParam){cartHttpDataService.getShippingOptions(ignoreLoadingBarParam).then(function(shippingOptionsResponse){if(angular.equals(checkOutConstants.HTTP_CODES.STATUS_SUCCESS,shippingOptionsResponse.status))vm.redirectToShippingAndPayment(shippingOptionsResponse.data,ignoreLoadingBarParam);else{checkOutModelService.model.errors.displayErrorMessage=!0;var errorMessage=ignoreLoadingBarParam?vm.authorValue.checkout.creditCheckTpp.ccErrorMessage:vm.authorValue.checkout.creditCheckTpp.verifyIdentityErrorMessage,formName=ignoreLoadingBarParam?pdlConstant.FORM_NAME.CREDIT_CHECK:pdlConstant.FORM_NAME.VERIFY_ID;pdlService.setCheckoutErrorEvent(setCheckoutErrorEvent(errorMessage,shippingOptionsResponse.status,formName)),$log.log("We have an error in get Shipping options response",null),closeProgressModal()}})["catch"](errorHandler)}function validateResponseStatus(responseArray){return vm.failureResponse=lodash.find(responseArray,function(res){return null===res.data||-1===checkOutConstants.SUCCESS_STATUS_CODES.indexOf(res.status)}),angular.isUndefined(vm.failureResponse)}function initialize(){$log.log("Initialization of the checkout controller started."),checkOutProgressService.init(),vm.checkOutProgressData=checkOutProgressService.model,vm.arrayOfSections=angular.copy(checkOutProgressService.model.arrayOfSections),vm.SECTIONS={INFOANDSHIPPING:checkOutConstants.SECTIONS.INFOANDSHIPPING,VERIFY_CREDIT:checkOutConstants.SECTIONS.VERIFY_CREDIT,PAYMENTANDCREDIT:checkOutConstants.SECTIONS.PAYMENTANDCREDIT,REVIEW:checkOutConstants.SECTIONS.REVIEW,CONFIRMATION:checkOutConstants.SECTIONS.CONFIRMATION},checkOutModelService.initCheckout();var cartFormModel=angular.fromJson(sessionStorage.getItem("cartForm"));cartFormModel&&(checkOutModelService.model=cartFormModel);var dataCache=dataFactory.getCacheObject(checkOutConstants.CACHE.NAME),dataObject=dataCache.get(checkOutConstants.CACHE.DATA_KEY);if(dataObject&&(checkOutModelService.model.checkOutInfo.personalInfo=dataObject.personalInfo,checkOutModelService.model.checkOutInfo.shipInfo=dataObject.shipInfo,checkOutModelService.model.checkOutInfo.billInfo=dataObject.billInfo,checkOutModelService.model.checkOutInfo.e911Info=dataObject.e911Info,checkOutModelService.model.checkOutInfo.billSameAsShip=dataObject.billSameAsShip,checkOutModelService.model.checkOutInfo.e911SameAsShip=dataObject.e911SameAsShip,checkOutModelService.model.checkOutInfo.chosenShipping=dataObject.chosenShipping),lodash.get(toggleService.model,"toggles.isTPPON",!1)){var personalInfoObject=dataCache.get(checkOutConstants.CACHE.PERSONAL_INFO_KEY);personalInfoObject&&(checkOutModelService.model.checkOutInfo.personalInfo=personalInfoObject.personalInfo)}vm.model=checkOutModelService.model,vm.checkOutInfo=checkOutModelService.model.checkOutInfo,vm.checkoutInitData=checkOutModelService.model.checkoutInitData,vm.errors=checkOutModelService.model.errors,vm.model.sectionToBeDisplayed=checkOutConstants.SECTIONS.INFOANDSHIPPING,vm.checkOutInfo.reviewCart=globalCheckoutInfo.reviewCart,checkOutModelService.setSectionToBeDisplayed(checkOutConstants.SECTIONS.INFOANDSHIPPING),vm.authorValue=globalValue.authorValue,$log.log("vm.authorValue : : ",vm.authorValue),checkOutControllerHelperUtil.setAuthorData(vm.authorValue),vm.conditionalAuthorValue=checkOutControllerHelperUtil.setConditionalAuthorData(vm.authorValue);var dcpSelectedShippingOption=lodash.find(vm.checkOutInfo.initData.selectedShippingOptions,function(option){return option.selected});coreServices.cartStorage.setShippingOption(dcpSelectedShippingOption),vm.checkOutInfo.initData.overnightOptionSelected=!1,lodash.get(toggleService.model,"toggles.isDcpV3ApiEnabled",!1)&&(checkOutModelService.model.checkOutInfo.flags.isAutoPay=vm.checkOutInfo.flags.isAutoPayOn)}function bindShippingAddress(){var shipAddDetails,billAddDetails,e911AddDetails;shippingUtil.isAddressAvailable(checkOutConstants.ADDRESS_TYPE.SHIPPING)?(checkOutModelService.model.checkOutInfo.shipInfo={},shipAddDetails=shippingUtil.getAddress(checkOutConstants.ADDRESS_TYPE.SHIPPING),checkOutModelService.model.checkOutInfo.shipInfo.address1=shipAddDetails.address1,checkOutModelService.model.checkOutInfo.shipInfo.address2=shipAddDetails.address2,checkOutModelService.model.checkOutInfo.shipInfo.zip=shipAddDetails.zipCode,checkOutModelService.model.checkOutInfo.shipInfo.state=shipAddDetails.state,checkOutModelService.model.checkOutInfo.shipInfo.city=shipAddDetails.city,checkOutModelService.model.checkOutInfo.billSameAsShip=!1,checkOutModelService.model.checkOutInfo.e911SameAsShip=!1,shippingUtil.isAddressAvailable(checkOutConstants.ADDRESS_TYPE.BILLING)&&(shippingUtil.isBillingSameAsShippingAddress()?(checkOutModelService.model.checkOutInfo.billSameAsShip=!0,checkOutModelService.model.checkOutInfo.billInfo=checkOutModelService.model.checkOutInfo.shipInfo):(checkOutModelService.model.checkOutInfo.billInfo={},billAddDetails=shippingUtil.getAddress(checkOutConstants.ADDRESS_TYPE.BILLING),checkOutModelService.model.checkOutInfo.billInfo.address1=billAddDetails.address1,checkOutModelService.model.checkOutInfo.billInfo.address2=billAddDetails.address2,checkOutModelService.model.checkOutInfo.billInfo.zip=billAddDetails.zipCode,checkOutModelService.model.checkOutInfo.billInfo.state=billAddDetails.state,checkOutModelService.model.checkOutInfo.billInfo.city=billAddDetails.city,checkOutModelService.model.checkOutInfo.billSameAsShip=!1)),shippingUtil.isAddressAvailable(checkOutConstants.ADDRESS_TYPE.E911)&&(shippingUtil.isE911SameAsShippingAddress()?(checkOutModelService.model.checkOutInfo.e911SameAsShip=!0,checkOutModelService.model.checkOutInfo.e911Info=checkOutModelService.model.checkOutInfo.shipInfo):(checkOutModelService.model.checkOutInfo.e911Info={},e911AddDetails=shippingUtil.getAddress(checkOutConstants.ADDRESS_TYPE.E911),checkOutModelService.model.checkOutInfo.e911Info.address1=e911AddDetails.address1,checkOutModelService.model.checkOutInfo.e911Info.address2=e911AddDetails.address2,checkOutModelService.model.checkOutInfo.e911Info.zip=e911AddDetails.zipCode,checkOutModelService.model.checkOutInfo.e911Info.state=e911AddDetails.state,checkOutModelService.model.checkOutInfo.e911Info.city=e911AddDetails.city,checkOutModelService.model.checkOutInfo.e911SameAsShip=!1))):(checkOutModelService.model.checkOutInfo.billSameAsShip=!0,checkOutModelService.model.checkOutInfo.e911SameAsShip=!0),$log.log(checkOutModelService.model.checkOutInfo)}function redirectToShippingAndPayment(shippingOptionsData,ignoreLoadingBarParam){vm.checkOutInfo.initData.selectedShippingOptions=responseTransformationServiceV3.transformShippingOptionsResponse(shippingOptionsData),vm.checkOutInfo.initData.addresses=[];var cartData=cartStorage.getGlobalSmartCartInfo();vm.checkOutInfo.flags.isAutoPay=cartData.flags.isAutoPayOn,vm.checkOutInfo.flags.isStorePayment=!0,shippingUtil.getProfileAddressList(ignoreLoadingBarParam).then(function(response){var addressIdList=commonStorage.getFromSharedSLS(checkOutConstants.PROFILE_ADDRESS_LIST)||[];angular.isDefined(addressIdList)&&lodash.isObject(addressIdList)&&(vm.checkOutInfo.initData.addresses=lodash.filter(response.data.addresses,function(address){return addressIdList.indexOf(address.addressId)>-1})),vm.bindShippingAddress(),vm.isVerifyIdentity=!1,vm.model.sectionToBeDisplayed=checkOutConstants.SECTIONS.PAYMENTANDCREDIT,checkOutModelService.setSectionToBeDisplayed(checkOutConstants.SECTIONS.PAYMENTANDCREDIT),closeProgressModal(),vm.toggles.isCDHCCEnabled&&(pdlService.setCheckOutIntoDigitalData(),openModalPopup(vm.creditCheckData))})["catch"](function(error){checkOutModelService.model.errors.displayErrorMessage=!0,pdlService.setCheckoutErrorEvent(setCheckoutErrorEvent(vm.authorValue.checkout.creditCheckTpp.ccErrorMessage,"",pdlConstant.FORM_NAME.CREDIT_CHECK)),$log.error("We have an error in get Address List",null),closeProgressModal()})}function closeProgressModal(){angular.isDefined(modalDialogFactory.getModalInstance())&&modalDialogFactory.closeCCProgressModal()}function setCheckoutErrorEvent(errorText,errorCode,formName){return{errorText:errorText||"",errorCode:errorCode||"",formName:formName||""}}var vm=this,toggleService=coreServices.toggleService,$log=commonServices.$log,globalCheckoutInfo=coreServices.cartStorage.getGlobalCheckOutInfo();commonUtils.searchJson(globalValue,"progressBar.verifyId");vm.creditCheckData={},vm.submitUserInfoForm=submitUserInfoForm,vm.submitUserInfoFormV3=submitUserInfoFormV3,vm.submitPaymentAndCreditCheckForm=submitPaymentAndCreditCheckForm,vm.submitPaymentAndShippingFormV3=submitPaymentAndShippingFormV3,vm.submitCreditCheckForm=submitCreditCheckForm,vm.submitVerifyIdForm=submitVerifyIdForm,vm.openHeaderModal=modalDialogFactory.openCheckOutHeaderModal,vm.toggles=toggleService.model.toggles,vm.validateSsnOnChange=checkOutValidationUtil.validateSsnOnChange,vm.bindShippingAddress=bindShippingAddress,vm.redirectToShippingAndPayment=redirectToShippingAndPayment,vm.openCCProgressModal=modalDialogFactory.openCCProgressModal,vm.closeProgressModal=modalDialogFactory.closeCCProgressModal,vm.verifyProfileIdentifierInfo=verifyProfileIdentifierInfo,vm.encryptData=encryptData,vm.encryptDataForVerifyID=encryptDataForVerifyID,vm.scc=cartStorage.getSoftCreditCheck(),vm.hcc=cartStorage.getHardCreditCheck(),vm.validateResponseStatus=validateResponseStatus,initialize()}checkOutControllerConstructor.$inject=["commonServices","coreServices","checkOutProgressService","checkOutModelService","modalDialogFactory","paymentAndCreditCheckUtil","checkOutControllerHelperUtil","personalInfoUtil","shippingUtil","checkOutConstants","globalValue","checkOutValidationUtil","dataFactory","cartHttpDataService","cartStorage","commonUtils","responseTransformationServiceV3","commonStorage","checkOutHttpDataUtil","$q","checkout","cartCommonOperationsService","pdlService","pdlConstant","$window"],angular.module("tmobileApp").controller("CheckOutCtrl",checkOutControllerConstructor)}(window.angular,window._),function(angular,lodash){"use strict";function modalWindowController($scope,$modalInstance){$scope.opened=$modalInstance.opened,$scope.result=$modalInstance.result}function switcher($window,$document,$timeout,$location,$rootScope,$modal,analyticsUtils,utils,viewport){return{restrict:"A",scope:!0,link:function(scope,element,attr){function initChartClick(){$timeout(function(){var scrubCont=$document[0].getElementById("scrubCont"),interactHandler=function(e){return lodash.includes(scrubCont.childNodes,e.target)?!0:(analyticsUtils.trackEvent("CLICK_EVENT",element[0].dataset.analyticsId,{eventInfo:{eventAction:"click",eventType:"clickToNavigate"},eventDescription:{dataAnalyticsID:element[0].dataset.analyticsId,parentComponent:"Switcher",ctaName:"See a year of great benefits",assetType:"link",targetUrl:"timeline"}}),showTimeline(),e.preventDefault(),!1)},timelineLink=$document[0].querySelectorAll("#click-or-tap, #tapIcon");lodash.forEach(timelineLink,function(link){["mousedown","pointerdown"].forEach(function(e){link.addEventListener(e,interactHandler,!1)})})},1e3)}function showOne(){var fades=element[0].querySelectorAll(".backgrounds .bg-fade"),activeContentContainer=element[0].querySelectorAll(".q-headers, .q-contents"),activeContent=element[0].querySelectorAll(".q-header, .q-content"),questionHeaderOne=element[0].querySelectorAll(".qh-one"),questionHeaderTwo=element[0].querySelectorAll(".qh-two"),questionContentOne=element[0].querySelector(".qc-one"),questionContentTwo=element[0].querySelector(".qc-two");lodash.forEach(fades,function(screens){screens.classList.remove("bg-fade")}),element[0].querySelector(".bg-one").classList.add("bg-fade"),lodash.forEach(activeContent,function(activeContainer){activeContainer.classList.remove("active")}),lodash.forEach(activeContentContainer,function(activeContContainer){activeContContainer.classList.remove("scrn-one","scrn-two","scrn-three"),activeContContainer.classList.toggle("scrn-one")}),lodash.forEach(questionHeaderOne,function(headerOne){headerOne.classList.toggle("active"),headerOne.setAttribute("aria-hidden","false")}),lodash.forEach(questionHeaderTwo,function(headerTwo){headerTwo.setAttribute("aria-hidden","true")}),question.classList.remove(qTwoTheme,qThreeTheme),question.classList.add(qOneTheme),questionContentOne.classList.toggle("active"),setVoiceOverFocus(qOneHeader),questionContentOne.setAttribute("aria-hidden","false"),questionContentTwo.setAttribute("aria-hidden","true"),$location.search().carrier&&(scope.$apply(function(){$location.search("carrier",null)}),lodash.forEach(buttonOne,function(carrier){carrier.classList.remove("focused")}),lodash.forEach(questionHeaderOne,function(headerOne){headerOne.setAttribute("aria-hidden","false")}),lodash.forEach(questionHeaderTwo,function(headerTwo){headerTwo.setAttribute("aria-hidden","true")}),questionContentOne.setAttribute("aria-hidden","false"),questionContentTwo.setAttribute("aria-hidden","true")),analyticsUtils.trackPageLoad("SwitcherPageLoad","Switch-to-t-mobile","Carrier","Carrier")}function showTwo(){$timeout(function(){var fades=element[0].querySelectorAll(".backgrounds .bg-fade"),activeContentContainer=element[0].querySelectorAll(".q-headers, .q-contents"),activeContent=element[0].querySelectorAll(".q-header, .q-content"),questionHeaderOne=element[0].querySelectorAll(".qh-one"),questionHeaderTwo=element[0].querySelectorAll(".qh-two"),questionHeaderThree=element[0].querySelectorAll(".qh-three"),questionContentOne=element[0].querySelector(".qc-one"),questionContentTwo=element[0].querySelector(".qc-two"),questionContentThree=element[0].querySelector(".qc-three");lodash.forEach(fades,function(screens){screens.classList.remove("bg-fade")}),element[0].querySelector(".bg-two").classList.add("bg-fade"),lodash.forEach(activeContent,function(activeContainer){activeContainer.classList.remove("active")}),lodash.forEach(activeContentContainer,function(activeContContainer){activeContContainer.classList.remove("scrn-one","scrn-two","scrn-three"),activeContContainer.classList.toggle("scrn-two")}),lodash.forEach(questionHeaderTwo,function(headerTwo){headerTwo.classList.toggle("active")}),question.classList.remove(qOneTheme,qThreeTheme),question.classList.add(qTwoTheme),questionContentTwo.classList.toggle("active"),setVoiceOverFocus(qTwoHeader),lodash.forEach(questionHeaderOne,function(headerOne){headerOne.setAttribute("aria-hidden","true")}),questionContentOne.setAttribute("aria-hidden","true"),lodash.forEach(questionHeaderTwo,function(headerTwo){headerTwo.setAttribute("aria-hidden","false")}),questionContentTwo.setAttribute("aria-hidden","false"),$location.search().lines&&(scope.$apply(function(){$location.search("lines",null)}),lodash.forEach(buttonTwo,function(line){line.classList.remove("focused")}),lodash.forEach(questionHeaderThree,function(headerThree){headerThree.setAttribute("aria-hidden","true")}),questionContentThree.setAttribute("aria-hidden","true"),lodash.forEach(questionHeaderTwo,function(headerTwo){headerTwo.setAttribute("aria-hidden","false")}),questionContentTwo.setAttribute("aria-hidden","false")),analyticsUtils.trackPageLoad("SwitcherPageLoad","Switch-to-t-mobile","Lines","Lines")},300)}function showThree(){$timeout(function(){var fades=element[0].querySelectorAll(".backgrounds .bg-fade"),activeContentContainer=element[0].querySelectorAll(".q-headers, .q-contents"),activeContent=element[0].querySelectorAll(".q-header, .q-content"),questionHeaderTwo=element[0].querySelectorAll(".qh-two"),questionHeaderThree=element[0].querySelectorAll(".qh-three"),questionContentTwo=element[0].querySelector(".qc-two"),questionContentThree=element[0].querySelector(".qc-three");lodash.forEach(fades,function(screens){screens.classList.remove("bg-fade")}),element[0].querySelector(".bg-three").classList.add("bg-fade"),lodash.forEach(activeContent,function(activeContainer){activeContainer.classList.remove("active")}),lodash.forEach(activeContentContainer,function(activeContContainer){activeContContainer.classList.remove("scrn-one","scrn-two","scrn-three"),activeContContainer.classList.toggle("scrn-three")}),lodash.forEach(questionHeaderThree,function(headerThree){headerThree.classList.toggle("active")}),question.classList.remove(qTwoTheme,qOneTheme),question.classList.add(qThreeTheme),questionContentThree.classList.toggle("active"),utils.isTouch()?setVoiceOverFocus(qThreeHeader):$timeout(function(){$document[0].getElementById("carrierCost").focus()},200),lodash.forEach(questionHeaderTwo,function(headerTwo){headerTwo.setAttribute("aria-hidden","true");
}),questionContentTwo.setAttribute("aria-hidden","true"),lodash.forEach(questionHeaderThree,function(headerThree){headerThree.setAttribute("aria-hidden","false")}),questionContentThree.setAttribute("aria-hidden","false"),analyticsUtils.trackPageLoad("SwitcherPageLoad","Switch-to-t-mobile","Cost","Cost")},300)}function showResult(){utils.pollForGlobal("d3").then(initChartClick);var headerContent=element[0].querySelectorAll(".qh-one, .qh-two, .qh-three");angular.element("html").css("position","static").css("overflow","visible"),$document[0].body.style.position="static",$document[0].body.style.removeProperty("overflow"),element[0].classList.add("results"),lodash.forEach(headerContent,function(questionHeaders){questionHeaders.setAttribute("aria-hidden","true")}),element[0].querySelector(".qc-one, .qc-two, .qc-three, .timeline-component").setAttribute("aria-hidden","true"),element[0].querySelector(".results-control").setAttribute("aria-hidden","false"),element[0].querySelector(".results, .results-first-page").setAttribute("aria-hidden","false"),element[0].querySelector("div.results").classList.remove("scrn-two"),element[0].querySelector("div.results").classList.add("scrn-one"),element[0].querySelector(".question, .timeline-component").classList.remove("active"),element[0].querySelector("div.results, .results-first-page").classList.add("active")}function showTimeline(){var modalElement=element[0].querySelector(".timeline-component"),modalName=modalElement.querySelector("h2").innerText;$modal.open({controller:modalWindowController,backdropClass:"modal-backdrop-timeline",windowClass:"modal-timeline"+(scope.vm.switcher.hasSavings?" has-savings":""),template:'<button type="button" class="close" aria-label="Close" ng-click="$close()"><span aria-hidden="true" class="close-icon"></span></button>'+modalElement.outerHTML});analyticsUtils.trackModal("timeline",modalName)}function setVoiceOverFocus(el){var focusInterval=10,focusTotalRepetitions=10;el.setAttribute("tabindex","0"),el.blur();var focusRepetitions=0,interval=window.setInterval(function(){el.focus(),focusRepetitions++,focusRepetitions>=focusTotalRepetitions&&window.clearInterval(interval)},focusInterval)}scope.$on("stepChange",function(e,step){switch(step){case 2:showTwo();break;case 3:showThree();break;case 4:showResult();break;default:analyticsUtils.trackPageLoad("SwitcherPageLoad","Switch-to-t-mobile","Carrier","Carrier")}}),element[0].querySelector("#switcherCostForm").addEventListener("focus",function(e){$document[0].body.style.overflow="auto",element[0].querySelector(".bg-three").style.position="fixed"},!0);var question=element[0].querySelector(".question"),qOneTheme=question.getAttribute("data-qone-theme"),qTwoTheme=question.getAttribute("data-qtwo-theme"),qThreeTheme=question.getAttribute("data-qthree-theme"),buttonOne=element[0].querySelectorAll(".carriers .button"),buttonTwo=element[0].querySelectorAll(".lines .button"),backToOne=element[0].querySelector(".qh-two .btn-back"),backToTwo=element[0].querySelector(".qh-three .btn-back"),qOneHeader=element[0].querySelector(".qh-one h2"),qTwoHeader=element[0].querySelector(".qh-two h2"),qThreeHeader=element[0].querySelector(".qh-three h2");angular.element("html").css("position","fixed").css("overflow","hidden"),angular.element("body").css("position","fixed"),angular.element(".global-header").css("position","fixed"),backToOne.addEventListener("click",showOne),backToTwo.addEventListener("click",showTwo)}}}modalWindowController.$inject=["$scope","$modalInstance"],switcher.$inject=["$window","$document","$timeout","$location","$rootScope","$modal","analyticsUtils","utils","viewport"],angular.module("marketingCore").directive("switcher",switcher)}(window.angular,window._),function(angular,lodash){"use strict";function salesForceUtilConstructor(cartHttpDataService,commonServices){function createAndSaveRetailCart(inputData){var inputForSaveLead,deferred=$q.defer();return cartHttpDataService.createLead(inputData).then(function(createLeadResponse){var returnCode=angular.isDefined(createLeadResponse.data.result.returnCode)?createLeadResponse.data.result.returnCode:createLeadResponse.data.returnCode;angular.equals(createLeadResponse.status,200)&&angular.equals(returnCode,0)&&angular.isDefined(createLeadResponse.data.leadId)?(inputForSaveLead={leadId:createLeadResponse.data.leadId,cartType:inputData.cartType,transId:inputData.transactionId},cartHttpDataService.saveLead(inputForSaveLead).then(function(saveLeadResponse){var saveLeadRetCode=angular.isDefined(saveLeadResponse.data.result.returnCode)?saveLeadResponse.data.result.returnCode:saveLeadResponse.data.returnCode;angular.equals(createLeadResponse.status,200)&&angular.equals(saveLeadRetCode,0)?($log.log("Cart Successfully send to retail"),deferred.resolve(saveLeadResponse)):($log.error("Error in saveLead API :"+saveLeadResponse),deferred.reject(saveLeadResponse))})["catch"](function(errorResponse){$log.error("Error in saveLead API :"+errorResponse),deferred.reject(errorResponse)})):($log.error("Error in createLead API"),deferred.reject(createLeadResponse))})["catch"](function(errorResponse){$log.error("Error in createLead API :"+errorResponse),deferred.reject(errorResponse)}),deferred.promise}var $log=commonServices.$log,$q=commonServices.$q;return{createAndSaveRetailCart:createAndSaveRetailCart}}salesForceUtilConstructor.$inject=["cartHttpDataService","commonServices"],angular.module("tmobileApp").factory("salesForceUtil",salesForceUtilConstructor)}(window.angular,window._),function(angular){"use strict";function switcherObAnalytics(analyticsUtils){return{restrict:"A",scope:!0,link:function(scope,element,attr){scope.$on("OBFormStart",function(){switcherForm=element[0].querySelector("#switcherOBCall"),switcherFormName=switcherForm.getAttribute("data-form-name"),isFormStarted||(analyticsUtils.trackForm({eventType:"form start",analyticsID:scope.vm.analyticsID,formName:switcherFormName,modal:switcherFormName}),isFormStarted=!0)}),scope.$on("OBCallConfirmed",function(){switcherForm=element[0].querySelector("#switcherOBCall"),switcherFormName=switcherForm.getAttribute("data-form-name"),analyticsUtils.trackForm({eventType:"form complete",analyticsID:scope.vm.analyticsID,formName:switcherFormName,modal:switcherFormName})}),scope.$on("OBValid",function(e,isValid){switcherForm=element[0].querySelector("#switcherOBCall"),switcherFormIcid=switcherForm.querySelector('[type="submit"]').getAttribute("data-icid"),switcherFormName=switcherForm.getAttribute("data-form-name"),submitCTA=switcherForm.querySelector('[type="submit"]').innerText,isValid&&analyticsUtils.trackFormSubmit({eventType:"clickToAction",analyticsID:scope.vm.analyticsID,submitText:submitCTA,formName:switcherFormName,targetUrl:"#",icid:switcherFormIcid,modal:switcherFormName,assetType:"button",attributes:{type:"navigation"}})});var switcherForm,switcherFormIcid,switcherFormName,submitCTA,isFormStarted=!1}}}switcherObAnalytics.$inject=["analyticsUtils"],angular.module("marketingCore").directive("switcherObAnalytics",switcherObAnalytics)}(window.angular),function(angular){"use strict";function saveCartThankYouModalControllerFunction($modalInstance,toggleService,globalValue,cartSaveOption,userName,commonServices){function close(){$modalInstance.close()}function findStore(){window.location.href=vm.authorValue.findStoreCtaLink}var vm=this,window=commonServices.$window;vm.close=close,vm.findStore=findStore,vm.cartSaveOption=cartSaveOption,vm.toggles=toggleService.model.toggles,vm.authorValue="saveLater"===vm.cartSaveOption?globalValue.authorValue.rootPage.saveCartModal.thankYouModal.saveForLater:globalValue.authorValue.rootPage.saveCartModal.thankYouModal.finalize,userName?vm.header=vm.authorValue.header?vm.authorValue.header.replace("@user",userName):"Thank you "+userName+"!":vm.header=vm.authorValue.header?vm.authorValue.header.replace("@user",""):"Thank you !"}saveCartThankYouModalControllerFunction.$inject=["$modalInstance","toggleService","globalValue","cartSaveOption","userName","commonServices"],angular.module("tmobileApp").controller("saveCartThankYouModalController",saveCartThankYouModalControllerFunction)}(window.angular),function(angular){"use strict";function switcherPinAnalytics(analyticsUtils){return{restrict:"A",scope:!0,link:function(scope,element,attr){scope.$on("sendPinStart",function(){isFormStarted||(switcherFormPin=element[0].querySelector("#switcherEmailCaptureForm"),switcherFormPinName=switcherFormPin.getAttribute("data-form-name"),submitCTAPIN=switcherFormPin.querySelector('[type="submit"]').innerText,analyticsUtils.trackForm({eventType:"form start",analyticsID:scope.vm.analyticsID,submitText:submitCTAPIN,formName:switcherFormPinName,modal:switcherFormPinName}),isFormStarted=!0)}),scope.$on("emailSent",function(){switcherFormPin=element[0].querySelector("#switcherEmailCaptureForm"),switcherFormPinName=switcherFormPin.getAttribute("data-form-name"),submitCTAPIN=switcherFormPin.querySelector('[type="submit"]').innerText,analyticsUtils.trackForm({eventType:"form complete",analyticsID:scope.vm.analyticsID,submitText:submitCTAPIN,formName:switcherFormPinName,modal:switcherFormPinName})}),scope.$on("submitEmailCaptureValid",function(e,isValid){switcherFormPin=element[0].querySelector("#switcherEmailCaptureForm"),switcherFormPinName=switcherFormPin.getAttribute("data-form-name"),submitCTAPIN=switcherFormPin.querySelector('[type="submit"]').innerText,switcherFormPinIcid=switcherFormPin.querySelector('[type="submit"]').getAttribute("data-icid"),isValid&&analyticsUtils.trackFormSubmit({eventType:"clickToAction",analyticsID:scope.vm.analyticsID,submitText:submitCTAPIN,formName:switcherFormPinName,targetUrl:"#",icid:switcherFormPinIcid,modal:switcherFormPinName,assetType:"button",attributes:{type:"navigation"}})});var switcherFormPin,switcherFormPinIcid,switcherFormPinName,submitCTAPIN,isFormStarted=!1}}}switcherPinAnalytics.$inject=["analyticsUtils"],angular.module("marketingCore").directive("switcherPinAnalytics",switcherPinAnalytics)}(window.angular),function(angular,lodash){"use strict";function responseTransformationServiceV3Fn(jsonPath,$log,aemRoutingService,toggleService,globalAssetRepositoryConstants,checkOutConstants,globalValue,creditClassConstant){function getJsonPath(jsonData,jPath){var value,_val=jsonPath(jsonData,"$.."+jPath);return angular.isDefined(_val)&&_val.length>0&&(value=_val[0]),value}function getGARImagePathForOfferModal(longDes){var longDescription=longDes;return toggleService.model.toggles.enableGar&&_.includes(longDes,"/content/dam")&&(longDescription=longDes.replace("/content/dam",globalAssetRepositoryConstants.url+"/content/dam")),longDescription}function getGARImagePath(imgPath){var imagePath=imgPath;return toggleService.model.toggles.enableGar&&_.includes(imgPath,"/content/dam")&&(imagePath=globalAssetRepositoryConstants.url+imgPath),imagePath}function _getFormattedDate(dateValue){if(angular.isDefined(dateValue)){var myDate=new Date(dateValue);if(myDate=moment(myDate),myDate.isValid())return myDate.format("M/D")}return""}function getAEMData(){service.aemValues||aemRoutingService.loadRoutingStates().then(function(resp){service.aemValues=resp,angular.forEach(resp,function(val,key){val.data&&val.data.defaultsku&&service.aemDefaultSku.push(val)})})}function mostPopularDevicesTransformation(oldResponse){$log.log("oldResponse",service.aemDefaultSku,oldResponse);var newResponse=[],override=lodash.get(globalValue,"authorValue.rootPage.overrideInvStatus.invStatusDetails",[]);if(override=lodash.isArray(override)?override:[override],oldResponse){if(oldResponse.values)return oldResponse.values.products.forEach(function(product){var prefIndex=0,chkBoolForPrefIndAuthor=!1,chkBoolForPrefIndSku=!1,chkBoolForPrefIndColor=!1,newProduct={};newProduct.offerId=product.offerId,newProduct.Family=product.familyName,newProduct.ProductName=product.productName,newProduct.productSubtype=product.productSubtype;var priceTypes=["listPriceSku","payNowGoodCredit_s","monthlyPriceGCS","payNowBuildCredit_s","monthlyPriceBCS"];if(priceTypes.forEach(function(priceType,priceIndex){("0"===product[priceType]||""===product[priceType]||"|"===product[priceType]||"||"===product[priceType]||"|||"===product[priceType])&&(product[priceType]="0.00|0.00|0.00|0.00")}),product.listPriceSku=product.listPriceSku?product.listPriceSku.split("|"):void 0,product.payNowGoodCredit_s=product.payNowGoodCredit_s?product.payNowGoodCredit_s.split("|"):void 0,product.monthlyPriceGCS=product.monthlyPriceGCS?product.monthlyPriceGCS.split("|"):void 0,product.payNowBuildCredit_s=product.payNowBuildCredit_s?product.payNowBuildCredit_s.split("|"):void 0,product.monthlyPriceBCS=product.monthlyPriceBCS?product.monthlyPriceBCS.split("|"):void 0,product.skuCode=product.skuCode?product.skuCode.split("|"):void 0,product.salePriceSku=product.salePriceSku?product.salePriceSku.split("|"):void 0,product.internalMemorySizes=product.internalMemorySizes?product.internalMemorySizes.replace(/SIZE_|GB/g,"").split("|"):void 0,product.deviceColorSKU=product.deviceColorSKU?product.deviceColorSKU.split("|"):void 0,product.deviceMemorySKU=product.deviceMemorySKU?product.deviceMemorySKU.split("|"):void 0,product.bogoSku=product.bogoSku?product.bogoSku.split("|"):void 0,product.onSaleSku=product.onSaleSku?product.onSaleSku.split("|"):void 0,product.specialOfferSku=product.specialOfferSku?product.specialOfferSku.split("|"):void 0,product.webOnlySku=product.webOnlySku?product.webOnlySku.split("|"):void 0,product.thumbNail=product.thumbNail?product.thumbNail.split("|"):void 0,product.priceTypeAvailableEIP=product.priceTypeAvailableEIP?product.priceTypeAvailableEIP.split("|"):void 0,product.priceTypeAvailableFRP=product.priceTypeAvailableFRP?product.priceTypeAvailableFRP.split("|"):void 0,product.memorySKU=[],"Wearable"!==product.productSubtype)for(var m=0;product.deviceMemorySKU&&m<product.deviceMemorySKU.length;m++)product.memorySKU.push(product.deviceMemorySKU[m].split("_")[1]);for(var productsWithPricesAndMemory=[],i=0;product.salePriceSku&&i<product.salePriceSku.length;i++){var productToPush={};productToPush.listPriceSku=product.listPriceSku[i],productToPush.payNowGoodCredit_s=product.payNowGoodCredit_s[i],productToPush.monthlyPriceGCS=product.monthlyPriceGCS[i],productToPush.payNowBuildCredit_s=product.payNowBuildCredit_s[i],productToPush.monthlyPriceBCS=product.monthlyPriceBCS[i],productToPush.skuCode=product.skuCode[i],productToPush.salePriceSku=product.salePriceSku[i],productToPush.deviceColorSKU=product.deviceColorSKU?product.deviceColorSKU[i]:void 0,productToPush.deviceMemorySKU=product.deviceMemorySKU?product.deviceMemorySKU[i]:void 0,productToPush.bogoSku=product.bogoSku?product.bogoSku[i]:void 0,productToPush.onSaleSku=product.onSaleSku?product.onSaleSku[i]:void 0,productToPush.specialOfferSku=product.specialOfferSku?product.specialOfferSku[i]:void 0,productToPush.webOnlySku=product.webOnlySku?product.webOnlySku[i]:void 0,productToPush.thumbNail=product.thumbNail?product.thumbNail[i]:void 0,productToPush.priceTypeAvailableEIP=product.priceTypeAvailableEIP?product.priceTypeAvailableEIP[i]:void 0,productToPush.priceTypeAvailableFRP=product.priceTypeAvailableFRP?product.priceTypeAvailableFRP[i]:void 0,productsWithPricesAndMemory.push(productToPush),productToPush.memorySKU=_.isEmpty(product.memorySKU)?void 0:product.memorySKU[i]}if(service.aemDefaultSku.forEach(function(aemSku,index){productsWithPricesAndMemory.forEach(function(productDetails,prodIndex){productDetails.skuCode===aemSku.data.defaultsku&&(prefIndex=prodIndex,chkBoolForPrefIndAuthor=!0)})}),0===prefIndex&&(productsWithPricesAndMemory.sort(function(a,b){return parseFloat(a.memorySKU)-parseFloat(b.memorySKU)}),productsWithPricesAndMemory.sort(function(a,b){return parseFloat(a.salePriceSku)-parseFloat(b.salePriceSku)})),chkBoolForPrefIndAuthor||chkBoolForPrefIndSku||chkBoolForPrefIndColor||(prefIndex=0),productsWithPricesAndMemory.length>0){newProduct.CreditClass=[{CreditClass1:{Upfront:"$"+productsWithPricesAndMemory[prefIndex].payNowGoodCredit_s,Monthly:"$"+productsWithPricesAndMemory[prefIndex].monthlyPriceGCS,DiscountedPrice:"$"+productsWithPricesAndMemory[prefIndex].listPriceSku},CreditClass2:{Upfront:"$"+productsWithPricesAndMemory[prefIndex].payNowBuildCredit_s,Monthly:"$"+productsWithPricesAndMemory[prefIndex].monthlyPriceBCS,DiscountedPrice:"$"+productsWithPricesAndMemory[prefIndex].listPriceSku},CreditClass3:{Upfront:"$"+productsWithPricesAndMemory[prefIndex].listPriceSku,Monthly:"$0.00",DiscountedPrice:"$"+productsWithPricesAndMemory[prefIndex].salePriceSku}}],newProduct.sku=productsWithPricesAndMemory[prefIndex].skuCode,newProduct.bogoSku=productsWithPricesAndMemory[prefIndex].bogoSku,newProduct.onSaleSku=productsWithPricesAndMemory[prefIndex].onSaleSku,newProduct.specialOfferSku=productsWithPricesAndMemory[prefIndex].specialOfferSku,newProduct.webOnlySku=productsWithPricesAndMemory[prefIndex].webOnlySku,newProduct.FrontImage=getGARImagePath(productsWithPricesAndMemory[prefIndex].thumbNail),newProduct.priceTypeAvailableEIP=productsWithPricesAndMemory[prefIndex].priceTypeAvailableEIP,newProduct.priceTypeAvailableFRP=productsWithPricesAndMemory[prefIndex].priceTypeAvailableFRP,newProduct.availabilityRule=product.availabilityRule,lodash.forEach(override,function(item){angular.isString(item)&&(item=angular.fromJson(item)),newProduct.sku==item.sku&&item.status&&(newProduct.availabilityRule=item.status)}),newProduct.offer=getProductOffer(product,prefIndex),"true"===newProduct.onSaleSku?(newProduct.bogoSku="false",newProduct.specialOfferSku="false",newProduct.webOnlySku="false"):"true"===newProduct.webOnlySku?(newProduct.bogoSku="false",newProduct.onSaleSku="false",newProduct.specialOfferSku="false"):"true"===newProduct.specialOfferSku?(newProduct.bogoSku="false",newProduct.onSaleSku="false",newProduct.webOnlySku="false"):"true"===newProduct.bogoSku&&(newProduct.onSaleSku="false",newProduct.specialOfferSku="false",newProduct.webOnlySku="false");var prefColor=productsWithPricesAndMemory[prefIndex].deviceColorSKU;if(angular.isDefined(prefColor)){var arrSearchableColors=_.isEmpty(product.searchableColors)?void 0:product.searchableColors.split("|");if(arrSearchableColors&&arrSearchableColors.length>0){var selectedColorIndex=arrSearchableColors.indexOf(prefColor);(_.isEmpty(newProduct.FrontImage)||angular.isUndefined(newProduct.FrontImage))&&(newProduct.FrontImage=angular.isDefined(product.thumbNail)?product.thumbNail[selectedColorIndex]:newProduct.FrontImage)}}newResponse.push(newProduct)}}),$log.log("newResponse",newResponse),newResponse;$log.log("Error: Response didnt come through.")}}function getProductOffer(prodObj,prefIndex){var offer={},skuOfferName=prodObj.skuOfferDisplayName.split("|")[prefIndex],skuOfferDescription=prodObj.skuOfferDescription.split("|")[prefIndex],skuOfferDisplayName=prodObj.skuOfferDisplayName.split("|")[prefIndex];return _.isEmpty(prodObj.skuOfferDisplayName)?(offer.name=_.isEmpty(prodObj.offerShortDescription)?"":prodObj.offerShortDescription,offer.description=_.isEmpty(prodObj.offerDescription)?"":getGARImagePathForOfferModal(prodObj.offerDescription),offer.displayname=_.isEmpty(prodObj.offerDisplayName)?"":prodObj.offerDisplayName):(offer.name=skuOfferName,offer.description=_.isEmpty(skuOfferDescription)?"":getGARImagePathForOfferModal(skuOfferDescription),offer.displayname=_.isEmpty(skuOfferDisplayName)?"":skuOfferDisplayName),offer}function getTransformedCreditClassPricingDetails(oldResponse,isPreviewcartAPIV2){if($log.log("Old Response : ",oldResponse),oldResponse&&(oldResponse.cart||oldResponse.creditPrice)){var creditClass,cartPricing={},creditClass1={},creditClass2={},creditClass3={};return isPreviewcartAPIV2?(creditClass=oldResponse.creditPrice,angular.forEach(creditClass,function(value,key){value.creditLevel===creditClassConstant.creditClasses.GOOD?cartPricing.creditClass1=getCreditClass(value):value.creditLevel===creditClassConstant.creditClasses.BUILDING?cartPricing.creditClass2=getCreditClass(value):value.creditLevel===creditClassConstant.creditClasses.NONE&&(cartPricing.creditClass3=getCreditClass(value))})):(creditClass=oldResponse.cart.creditClass,creditClass1.payNowPrice=getJsonPath(creditClass.creditClass1,"paynowprice.display"),creditClass1.payNowPriceAmount=getJsonPath(creditClass.creditClass1,"paynowprice.display"),creditClass1.monthlyPrice=getJsonPath(creditClass.creditClass1,"monthlyprice.display"),creditClass1.monthlyPriceAmount=getJsonPath(creditClass.creditClass1,"monthlyprice.amount"),creditClass1.creditLevel=getJsonPath(creditClass.creditClass1,"creditLevel"),creditClass2.payNowPrice=getJsonPath(creditClass.creditClass2,"paynowprice.display"),creditClass2.payNowPriceAmount=getJsonPath(creditClass.creditClass2,"paynowprice.display"),creditClass2.monthlyPrice=getJsonPath(creditClass.creditClass2,"monthlyprice.display"),creditClass2.monthlyPriceAmount=getJsonPath(creditClass.creditClass2,"monthlyprice.amount"),creditClass2.creditLevel=getJsonPath(creditClass.creditClass2,"creditLevel"),creditClass3.payNowPrice=getJsonPath(creditClass.creditClass3,"paynowprice.display"),creditClass3.payNowPriceAmount=getJsonPath(creditClass.creditClass3,"paynowprice.display"),creditClass3.monthlyPrice=getJsonPath(creditClass.creditClass3,"monthlyprice.display"),creditClass3.monthlyPriceAmount=getJsonPath(creditClass.creditClass3,"monthlyprice.amount"),creditClass3.creditLevel=getJsonPath(creditClass.creditClass3,"creditLevel"),cartPricing.creditClass1=creditClass1,cartPricing.creditClass2=creditClass2,cartPricing.creditClass3=creditClass3),cartPricing}}function getCreditClass(inValue){var creditClass={};return creditClass.payNowPrice=getJsonPath(inValue,creditClassConstant.creditClasses.PAYNOWPRICE),creditClass.payNowPriceAmount=getJsonPath(inValue,creditClassConstant.creditClasses.PAYNOWPRICE),creditClass.monthlyPrice=getJsonPath(inValue,creditClassConstant.creditClasses.MONTHLYPRICE),creditClass.monthlyPriceAmount=getJsonPath(inValue,creditClassConstant.creditClasses.MONTHLYPRICEAMOUNT),creditClass.creditLevel=getJsonPath(inValue,creditClassConstant.creditClasses.CREDITLEVEL),creditClass}function getServices(servicesResponse,serviceDefintion){var itemArray,constituentsArray,partialServiceItems=[],partialServiceConstituents=[],serviceData={},services=[];servicesResponse&&servicesResponse["configuration-state"]?(itemArray=servicesResponse._item,constituentsArray=servicesResponse["configuration-state"].constituents):servicesResponse&&servicesResponse._itemconfiguration&&(itemArray=servicesResponse._itemconfiguration[0]._item,constituentsArray=servicesResponse._itemconfiguration[0]["configuration-state"].constituents),serviceDefintion?partialServiceItems=serviceDefintion.services:angular.forEach(itemArray,function(item,itemKey){var serviceToPush={code:getJsonPath(item,"_code[0].code"),name:getJsonPath(item,"_definition[0].display-name"),description:getJsonPath(item,'_definition[0].details[?(@.name=="Description")].display-value'),recommended:getJsonPath(item,'_definition[0].details[?(@.name=="recommendedFlag")].display-value'),monthlyPrice:getJsonPath(item,"price.priceSummary.monthlyPrice.salePrice.display"),serviceCategory:getJsonPath(item,'_definition[0].details[?(@.name=="ServiceCat")].display-value')};serviceToPush.recommended?serviceToPush.orderGroup=0:serviceToPush.orderGroup=10,"SERVICES"!==serviceToPush.code&&partialServiceItems.push(serviceToPush)}),angular.forEach(constituentsArray,function(constituent,constituentKey){var constituentToPush={constituentId:getJsonPath(constituent,"constituent-id"),constituentUri:getJsonPath(constituent,"constituent-uri"),enabled:getJsonPath(constituent,"enabled"),selected:getJsonPath(constituent,"selected"),code:getJsonPath(constituent,"sku-code")};partialServiceConstituents.push(constituentToPush)}),angular.forEach(partialServiceConstituents,function(partialServiceItem,itemKey){services.push(_.extend(partialServiceItem,_.find(partialServiceItems,{code:partialServiceItem.code})))});var _addtolineaction=getJsonPath(servicesResponse,'_addtolineform..[?(@.rel =="addtolineaction")].href'),_constituentActionUrl=getJsonPath(servicesResponse,'_constituentselectorform..[?(@.rel =="selectconstituentaction")].href');return serviceData={services:services,addtolineaction:_addtolineaction,constituentActionUrl:_constituentActionUrl}}function getTransformedServies(servicesResponse){var serviceData=[];return serviceData=lodash.map(servicesResponse.services,function(value){var description=lodash.get(value,"description");description=lodash.isArray(description)?description[0]:description;var category;toggleService.model.toggles.enableServiceGroup?category=angular.equals(lodash.get(value,"serviceGroup"),checkOutConstants.RECOMMENDED_SERVICE_GROUP)?checkOutConstants.RECOMMENDED_CATEGORY:lodash.get(value,"serviceGroup"):(category=lodash.get(value,"category"),category=lodash.isArray(category)?category[0]:category);var transformedServieObj={code:lodash.get(value,"offerId"),id:lodash.get(value,"id",""),name:lodash.get(value,"offerName"),description:description,enabled:lodash.get(value,"enabled",!0),selected:lodash.get(value,"currentSelection"),serviceCategory:category,recommended:lodash.get(value,"isRecommended",!1),monthlyPrice:lodash.get(value,"price.priceSummary.monthlyPrice.salePrice.display"),pricing:lodash.get(value,"price.priceSummary.monthlyPrice.salePrice.display"),price:lodash.get(value,"price.priceSummary.monthlyPrice.salePrice.amount"),conflictSkus:lodash.get(value,"conflictSkus",void 0)};if(toggleService.model.toggles.isTaxesEnabled){var taxInclusive=lodash.get(value,"taxInclusive");transformedServieObj.isTaxInclusive=0==taxInclusive?!1:!0}return transformedServieObj})}function getTransformedProductDetails(product){for(var bulkProudctData=[],i=0;i<product.data.productdetails.length;i++)product.data.productdetails[i].AvailableFromDate=_getFormattedDate(product.data.productdetails[i].AvailableFromDate),product.data.productdetails[i].AvailableToDate=_getFormattedDate(product.data.productdetails[i].AvailableToDate);for(var responseUniqueColors=_.uniq(_.map(product.data.productdetails,"Color")),idx=0;idx<responseUniqueColors.length;idx++){var colorFilteredProducts=_.filter(product.data.productdetails,{Color:responseUniqueColors[idx]});colorFilteredProducts=_.sortBy(colorFilteredProducts,function(d){return parseInt(d.Memory,10)});for(var index=0;index<colorFilteredProducts.length;index++)bulkProudctData.push(colorFilteredProducts[index])}bulkProudctData=_.sortBy(bulkProudctData,function(d){return parseInt(d.Memory,10)});var miniPDPData={bulkProudctData:bulkProudctData};return miniPDPData}function getCarrierName(name){switch(name){case checkOutConstants.SHIPPING_OPTIONS_V4.STANDARD:return checkOutConstants.SHIPPING_OPTIONS_V3.STANDARD;case checkOutConstants.SHIPPING_OPTIONS_V4.OVERNIGHT:return checkOutConstants.SHIPPING_OPTIONS_V3.OVERNIGHT;case checkOutConstants.SHIPPING_OPTIONS_V4.GROUND:return checkOutConstants.SHIPPING_OPTIONS_V3.GROUND;default:return""}}function transformShippingOptionsResponse(shippingOptionResponse){return lodash.get(toggleService.model,"toggles.isMytmoShippingResponseEnabled",!1)?lodash.map(shippingOptionResponse.shippingOptions,function(option){var obj={displayName:getCarrierName(option.carrier),selected:option.selected,cost:option.cost.display,actionUrl:"",costValue:option.cost.amount,shipmentDetailsId:option.shipmentDetailsId,optionsId:option.optionsId,shippingType:option.carrier},shipData=_.split(option.displayName,"-",2);obj.name=shipData[0].trim(),obj.deliveryTime=shipData[1].trim();var orderNumber=3;return angular.equals(option.carrier,checkOutConstants.SHIPPING_OPTIONS_V4.STANDARD)?orderNumber=1:angular.equals(option.carrier,checkOutConstants.SHIPPING_OPTIONS_V4.OVERNIGHT)&&(orderNumber=2),obj.orderNumber=orderNumber,obj}):lodash.map(shippingOptionResponse.shippingOptions,function(option){var obj={deliveryTime:option.carrier,name:option.displayName,displayName:option.tax.display,selected:option.selected,cost:option.cost.display,actionUrl:"",costValue:option.cost.amount,shipmentDetailsId:option.shipmentDetailsId,optionsId:option.optionsId,shippingType:option.tax.display},orderNumber=3;return angular.equals(option.tax.display,checkOutConstants.SHIPPING_OPTIONS_V3.STANDARD)?orderNumber=1:angular.equals(option.tax.display,checkOutConstants.SHIPPING_OPTIONS_V3.OVERNIGHT)&&(orderNumber=2),obj.orderNumber=orderNumber,obj})}var service=this;return getAEMData(),service.aemValues=null,service.aemDefaultSku=[],service.getAEMData=getAEMData,service.mostPopularDevicesTransformation=mostPopularDevicesTransformation,service.getTransformedServies=getTransformedServies,service.getTransformedProductDetails=getTransformedProductDetails,service.getTransformedCreditClassPricingDetails=getTransformedCreditClassPricingDetails,service.getServices=getServices,service.transformShippingOptionsResponse=transformShippingOptionsResponse,service.getCreditClass=getCreditClass,service}responseTransformationServiceV3Fn.$inject=["jsonPath","$log","aemRoutingService","toggleService","globalAssetRepositoryConstants","checkOutConstants","globalValue","creditClassConstant"],angular.module("tmobileApp").service("responseTransformationServiceV3",responseTransformationServiceV3Fn)}(window.angular,_),function(angular){"use strict";function switcherTimeline($window,utils,analyticsUtils){return{restrict:"A",scope:!0,link:function(scope,element,attr){function animateTimelineStep(){var timelineEvents=angular.element(".modal .timeline-event");timelineEvents.each(function(i,el){isItInView(el)?angular.element(el).addClass("animated"):angular.element(el).removeClass("animated")})}function isItInView(el){return modal.scrollTop()+win.scrollTop()+win.height()>=angular.element(el).offset().top?!0:!1}function cleanup(){angular.element(".modal").off("scroll.animateTimelineStep",animateTimelineStep)}var win=angular.element($window),html=angular.element("html"),modal=angular.element(".modal"),ctaString="button[data-analytics-id], a[data-analytics-id], [role=button][data-analytics-id]";element.on("click",ctaString,function(e){analyticsUtils.trackActionableElementClick(e.currentTarget,utils.getPageReach(win,html))}),scope.$on("modalOpen",function(){animateTimelineStep(),modal=angular.element(".modal").on("scroll.animateTimelineStep",animateTimelineStep)}),scope.$on("$destroy",cleanup)}}}switcherTimeline.$inject=["$window","utils","analyticsUtils"],angular.module("marketingCore").directive("switcherTimeline",switcherTimeline)}(angular),function(angular){"use strict";function responseTransformationServiceFn(jsonPath,$log,aemRoutingService,checkOutConstants,creditClassConstant){function getJsonPath(jsonData,jPath){var value,_val=jsonPath(jsonData,"$.."+jPath);return angular.isDefined(_val)&&_val.length>0&&(value=_val[0]),value}function getAEMData(){service.aemValues||aemRoutingService.loadRoutingStates().then(function(resp){service.aemValues=resp,angular.forEach(resp,function(val,key){val.data&&val.data.defaultsku&&service.aemDefaultSku.push(val)})})}function mostPopularDevicesTransformation(oldResponse){$log.log("oldResponse",service.aemDefaultSku,oldResponse);var newResponse=[];if(oldResponse){if(oldResponse.values)return oldResponse.values.products.forEach(function(product){var prefIndex=0,chkBoolForPrefIndAuthor=!1,chkBoolForPrefIndSku=!1,chkBoolForPrefIndColor=!1,newProduct={};newProduct.offerId=product.offerId,newProduct.Family=product.familyName,newProduct.ProductName=product.productName,newProduct.productSubtype=product.productSubtype;var priceTypes=["listPriceSku","payNowGoodCredit_s","monthlyPriceGCS","payNowBuildCredit_s","monthlyPriceBCS"];if(priceTypes.forEach(function(priceType,priceIndex){("0"===product[priceType]||""===product[priceType]||"|"===product[priceType]||"||"===product[priceType]||"|||"===product[priceType])&&(product[priceType]="0.00|0.00|0.00|0.00")}),product.listPriceSku=product.listPriceSku?product.listPriceSku.split("|"):void 0,
product.payNowGoodCredit_s=product.payNowGoodCredit_s?product.payNowGoodCredit_s.split("|"):void 0,product.monthlyPriceGCS=product.monthlyPriceGCS?product.monthlyPriceGCS.split("|"):void 0,product.payNowBuildCredit_s=product.payNowBuildCredit_s?product.payNowBuildCredit_s.split("|"):void 0,product.monthlyPriceBCS=product.monthlyPriceBCS?product.monthlyPriceBCS.split("|"):void 0,product.skuCode=product.skuCode?product.skuCode.split("|"):void 0,product.salePriceSku=product.salePriceSku?product.salePriceSku.split("|"):void 0,product.internalMemorySizes=product.internalMemorySizes?product.internalMemorySizes.replace(/SIZE_|GB/g,"").split("|"):void 0,product.deviceColorSKU=product.deviceColorSKU?product.deviceColorSKU.split("|"):void 0,product.deviceMemorySKU=product.deviceMemorySKU?product.deviceMemorySKU.split("|"):void 0,product.bogoSku=product.bogoSku?product.bogoSku.split("|"):void 0,product.onSaleSku=product.onSaleSku?product.onSaleSku.split("|"):void 0,product.specialOfferSku=product.specialOfferSku?product.specialOfferSku.split("|"):void 0,product.webOnlySku=product.webOnlySku?product.webOnlySku.split("|"):void 0,product.thumbNail=_.isEmpty(product.thumbNail)?void 0:product.thumbNail.split("|"),product.priceTypeAvailableEIP=product.priceTypeAvailableEIP?product.priceTypeAvailableEIP.split("|"):void 0,product.priceTypeAvailableFRP=product.priceTypeAvailableFRP?product.priceTypeAvailableFRP.split("|"):void 0,product.memorySKU=[],"Wearable"!==product.productSubtype)for(var m=0;product.deviceMemorySKU&&m<product.deviceMemorySKU.length;m++)product.memorySKU.push(product.deviceMemorySKU[m].split("_")[1]);for(var productsWithPricesAndMemory=[],i=0;product.salePriceSku&&i<product.salePriceSku.length;i++){var productToPush={};productToPush.listPriceSku=product.listPriceSku[i],productToPush.payNowGoodCredit_s=product.payNowGoodCredit_s[i],productToPush.monthlyPriceGCS=product.monthlyPriceGCS[i],productToPush.payNowBuildCredit_s=product.payNowBuildCredit_s[i],productToPush.monthlyPriceBCS=product.monthlyPriceBCS[i],productToPush.skuCode=product.skuCode[i],productToPush.salePriceSku=product.salePriceSku[i],productToPush.deviceColorSKU=product.deviceColorSKU?product.deviceColorSKU[i]:void 0,productToPush.deviceMemorySKU=product.deviceMemorySKU?product.deviceMemorySKU[i]:void 0,productToPush.bogoSku=product.bogoSku?product.bogoSku[i]:void 0,productToPush.onSaleSku=product.onSaleSku?product.onSaleSku[i]:void 0,productToPush.specialOfferSku=product.specialOfferSku?product.specialOfferSku[i]:void 0,productToPush.webOnlySku=product.webOnlySku?product.webOnlySku[i]:void 0,productToPush.thumbNail=product.thumbNail?product.thumbNail[i]:void 0,productToPush.priceTypeAvailableEIP=product.priceTypeAvailableEIP?product.priceTypeAvailableEIP[i]:void 0,productToPush.priceTypeAvailableFRP=product.priceTypeAvailableFRP?product.priceTypeAvailableFRP[i]:void 0,productsWithPricesAndMemory.push(productToPush),productToPush.memorySKU=_.isEmpty(product.memorySKU)?void 0:product.memorySKU[i]}if(productsWithPricesAndMemory.sort(function(a,b){return parseFloat(a.memorySKU)-parseFloat(b.memorySKU)}),productsWithPricesAndMemory.sort(function(a,b){return parseFloat(a.salePriceSku)-parseFloat(b.salePriceSku)}),service.aemDefaultSku.forEach(function(aemSku,index){productsWithPricesAndMemory.forEach(function(productDetails,prodIndex){productDetails.skuCode===aemSku.data.defaultsku&&(prefIndex=prodIndex,chkBoolForPrefIndAuthor=!0)})}),chkBoolForPrefIndAuthor||chkBoolForPrefIndSku||chkBoolForPrefIndColor||(prefIndex=0),productsWithPricesAndMemory.length>0){newProduct.CreditClass=[{CreditClass1:{Upfront:"$"+productsWithPricesAndMemory[prefIndex].payNowGoodCredit_s,Monthly:"$"+productsWithPricesAndMemory[prefIndex].monthlyPriceGCS,DiscountedPrice:"$"+productsWithPricesAndMemory[prefIndex].listPriceSku},CreditClass2:{Upfront:"$"+productsWithPricesAndMemory[prefIndex].payNowBuildCredit_s,Monthly:"$"+productsWithPricesAndMemory[prefIndex].monthlyPriceBCS,DiscountedPrice:"$"+productsWithPricesAndMemory[prefIndex].listPriceSku},CreditClass3:{Upfront:"$"+productsWithPricesAndMemory[prefIndex].listPriceSku,Monthly:"$0.00",DiscountedPrice:"$"+productsWithPricesAndMemory[prefIndex].salePriceSku}}],newProduct.sku=productsWithPricesAndMemory[prefIndex].skuCode,newProduct.bogoSku=productsWithPricesAndMemory[prefIndex].bogoSku,newProduct.onSaleSku=productsWithPricesAndMemory[prefIndex].onSaleSku,newProduct.specialOfferSku=productsWithPricesAndMemory[prefIndex].specialOfferSku,newProduct.webOnlySku=productsWithPricesAndMemory[prefIndex].webOnlySku,newProduct.FrontImage=productsWithPricesAndMemory[prefIndex].thumbNail,newProduct.priceTypeAvailableEIP=productsWithPricesAndMemory[prefIndex].priceTypeAvailableEIP,newProduct.priceTypeAvailableFRP=productsWithPricesAndMemory[prefIndex].priceTypeAvailableFRP,newProduct.availabilityRule=product.availabilityRule,newProduct.offer=getProductOffer(product,prefIndex),"true"===newProduct.onSaleSku?(newProduct.bogoSku="false",newProduct.specialOfferSku="false",newProduct.webOnlySku="false"):"true"===newProduct.webOnlySku?(newProduct.bogoSku="false",newProduct.onSaleSku="false",newProduct.specialOfferSku="false"):"true"===newProduct.specialOfferSku?(newProduct.bogoSku="false",newProduct.onSaleSku="false",newProduct.webOnlySku="false"):"true"===newProduct.bogoSku&&(newProduct.onSaleSku="false",newProduct.specialOfferSku="false",newProduct.webOnlySku="false");var prefColor=productsWithPricesAndMemory[prefIndex].deviceColorSKU;if(angular.isDefined(prefColor)){var arrSearchableColors=_.isEmpty(product.searchableColors)?void 0:product.searchableColors.split("|");if(arrSearchableColors&&arrSearchableColors.length>0){var selectedColorIndex=arrSearchableColors.indexOf(prefColor);(_.isEmpty(newProduct.FrontImage)||angular.isUndefined(newProduct.FrontImage))&&(newProduct.FrontImage=angular.isDefined(product.thumbNail)?product.thumbNail[selectedColorIndex]:newProduct.FrontImage)}}newResponse.push(newProduct)}}),$log.log("newResponse",newResponse),newResponse;$log.log("Error: Response didnt come through.")}}function getProductOffer(prodObj,prefIndex){var offer={},skuOfferName=prodObj.skuOfferName.split("|")[prefIndex],skuOfferDescription=prodObj.skuOfferDescription.split("|")[prefIndex],skuOfferDisplayName=prodObj.skuOfferDisplayName.split("|")[prefIndex];return _.isEmpty(skuOfferName)?(offer.name=_.isEmpty(prodObj.offerName)?prodObj.offerName:"",offer.description=_.isEmpty(prodObj.offerDescription)?prodObj.offerDescription:"",offer.displayname=_.isEmpty(prodObj.offerDisplayName)?prodObj.offerDisplayName:""):(offer.name=skuOfferName,offer.description=_.isEmpty(skuOfferDescription)?skuOfferDescription:"",offer.displayname=_.isEmpty(skuOfferDisplayName)?skuOfferDisplayName:""),offer}function getTransformedCreditClassPricingDetails(oldResponse,isPreviewcartAPIV2){if(oldResponse&&(oldResponse.cart||oldResponse.creditPrice)){var creditClass,cartPricing={},creditClass1={},creditClass2={},creditClass3={};return isPreviewcartAPIV2?(creditClass=oldResponse.creditPrice,angular.forEach(creditClass,function(value,key){value.creditLevel===creditClassConstant.creditClasses.GOOD?cartPricing.creditClass1=getCreditClass(value):value.creditLevel===creditClassConstant.creditClasses.BUILDING?cartPricing.creditClass2=getCreditClass(value):value.creditLevel===creditClassConstant.creditClasses.NONE&&(cartPricing.creditClass3=getCreditClass(value))})):(creditClass=oldResponse.cart.creditClass,creditClass1.payNowPrice=getJsonPath(creditClass.creditClass1,"paynowprice.display"),creditClass1.payNowPriceAmount=getJsonPath(creditClass.creditClass1,"paynowprice.display"),creditClass1.monthlyPrice=getJsonPath(creditClass.creditClass1,"monthlyprice.display"),creditClass1.monthlyPriceAmount=getJsonPath(creditClass.creditClass1,"monthlyprice.amount"),creditClass1.creditLevel=getJsonPath(creditClass.creditClass1,"creditLevel"),creditClass2.payNowPrice=getJsonPath(creditClass.creditClass2,"paynowprice.display"),creditClass2.payNowPriceAmount=getJsonPath(creditClass.creditClass2,"paynowprice.display"),creditClass2.monthlyPrice=getJsonPath(creditClass.creditClass2,"monthlyprice.display"),creditClass2.monthlyPriceAmount=getJsonPath(creditClass.creditClass2,"monthlyprice.amount"),creditClass2.creditLevel=getJsonPath(creditClass.creditClass2,"creditLevel"),creditClass3.payNowPrice=getJsonPath(creditClass.creditClass3,"paynowprice.display"),creditClass3.payNowPriceAmount=getJsonPath(creditClass.creditClass3,"paynowprice.display"),creditClass3.monthlyPrice=getJsonPath(creditClass.creditClass3,"monthlyprice.display"),creditClass3.monthlyPriceAmount=getJsonPath(creditClass.creditClass3,"monthlyprice.amount"),creditClass3.creditLevel=getJsonPath(creditClass.creditClass3,"creditLevel"),cartPricing.creditClass1=creditClass1,cartPricing.creditClass2=creditClass2,cartPricing.creditClass3=creditClass3),cartPricing}}function getCreditClass(inValue){var creditClass={};return creditClass.payNowPrice=getJsonPath(inValue,creditClassConstant.creditClasses.PAYNOWPRICE),creditClass.payNowPriceAmount=getJsonPath(inValue,creditClassConstant.creditClasses.PAYNOWPRICE),creditClass.monthlyPrice=getJsonPath(inValue,creditClassConstant.creditClasses.MONTHLYPRICE),creditClass.monthlyPriceAmount=getJsonPath(inValue,creditClassConstant.creditClasses.MONTHLYPRICEAMOUNT),creditClass.creditLevel=getJsonPath(inValue,creditClassConstant.creditClasses.CREDITLEVEL),creditClass}function getServices(servicesResponse,serviceDefintion){var itemArray,constituentsArray,partialServiceItems=[],partialServiceConstituents=[],serviceData={},services=[];servicesResponse&&servicesResponse["configuration-state"]?(itemArray=servicesResponse._item,constituentsArray=servicesResponse["configuration-state"].constituents):servicesResponse&&servicesResponse._itemconfiguration&&(itemArray=servicesResponse._itemconfiguration[0]._item,constituentsArray=servicesResponse._itemconfiguration[0]["configuration-state"].constituents),serviceDefintion?partialServiceItems=serviceDefintion.services:angular.forEach(itemArray,function(item,itemKey){var serviceToPush={code:getJsonPath(item,"_code[0].code"),name:getJsonPath(item,"_definition[0].display-name"),description:getJsonPath(item,'_definition[0].details[?(@.name=="Description")].display-value'),recommended:getJsonPath(item,'_definition[0].details[?(@.name=="recommendedFlag")].display-value'),monthlyPrice:getJsonPath(item,"_monthlyprice[0].monthly-payment-price[0].display"),serviceCategory:getJsonPath(item,'_definition[0].details[?(@.name=="ServiceCat")].display-value')};serviceToPush.recommended?serviceToPush.orderGroup=0:serviceToPush.orderGroup=10,"SERVICES"!==serviceToPush.code&&partialServiceItems.push(serviceToPush)}),angular.forEach(constituentsArray,function(constituent,constituentKey){var constituentToPush={constituentId:getJsonPath(constituent,"constituent-id"),constituentUri:getJsonPath(constituent,"constituent-uri"),enabled:getJsonPath(constituent,"enabled"),selected:getJsonPath(constituent,"selected"),code:getJsonPath(constituent,"sku-code")};partialServiceConstituents.push(constituentToPush)}),angular.forEach(partialServiceConstituents,function(partialServiceItem,itemKey){services.push(_.extend(partialServiceItem,_.find(partialServiceItems,{code:partialServiceItem.code})))});var _addtolineaction=getJsonPath(servicesResponse,'_addtolineform..[?(@.rel =="addtolineaction")].href'),_constituentActionUrl=getJsonPath(servicesResponse,'_constituentselectorform..[?(@.rel =="selectconstituentaction")].href');return serviceData={services:services,addtolineaction:_addtolineaction,constituentActionUrl:_constituentActionUrl}}function getTransformedServies(servicesResponse){var serviceData=[];return angular.forEach(servicesResponse.services.details,function(value,key){var serviceToPush={code:getJsonPath(value,"sku"),id:getJsonPath(value,"id"),name:getJsonPath(value,"socName"),description:getJsonPath(value,"description")?getJsonPath(value,"description")[0]:void 0,enabled:getJsonPath(value,"enabled"),selected:getJsonPath(value,"selected"),serviceCategory:getJsonPath(value,"category")?getJsonPath(value,"category")[0]:void 0,recommended:getJsonPath(value,"isRecommended")?"isRecommended":!1,monthlyPrice:getJsonPath(value,"pricing.monthlyPrice.display"),pricing:getJsonPath(value,"pricing.monthlyPrice")};serviceData.push(serviceToPush)}),serviceData}function getTransformedProductDetails(product){for(var bulkProudctData=[],responseUniqueColors=_.uniq(_.map(product.data.productdetails,"Color")),idx=0;idx<responseUniqueColors.length;idx++){var colorFilteredProducts=_.filter(product.data.productdetails,{Color:responseUniqueColors[idx]});colorFilteredProducts=_.sortBy(colorFilteredProducts,function(d){return parseInt(d.Memory,10)});for(var index=0;index<colorFilteredProducts.length;index++)bulkProudctData.push(colorFilteredProducts[index])}bulkProudctData=_.sortBy(bulkProudctData,function(d){return parseInt(d.Memory,10)});var miniPDPData={bulkProudctData:bulkProudctData};return miniPDPData}function transformShippingOptionsResponse(shippingOptionResponse){if(shippingOptionResponse){var jsonData=shippingOptionResponse.shippingOptions,selectedShippingOptions=[];return angular.forEach(jsonData,function(value,key){var option={deliveryTime:value.deliveryTime,name:value.displayName,displayName:value.name,selected:value.selected,cost:value.cost,actionUrl:value.actionURL,costValue:parseFloat(value.cost.substring(1))};angular.equals(option.name,checkOutConstants.STANDARD_SHIPPING)?option.orderNumber=1:angular.equals(option.name,checkOutConstants.SHIPPING_OVERNIGHT)?option.orderNumber=2:option.orderNumber=3,selectedShippingOptions.push(option)}),selectedShippingOptions}}var service=this;return getAEMData(),service.aemValues=null,service.aemDefaultSku=[],service.getAEMData=getAEMData,service.mostPopularDevicesTransformation=mostPopularDevicesTransformation,service.getTransformedServies=getTransformedServies,service.getTransformedProductDetails=getTransformedProductDetails,service.getTransformedCreditClassPricingDetails=getTransformedCreditClassPricingDetails,service.getServices=getServices,service.transformShippingOptionsResponse=transformShippingOptionsResponse,service.getCreditClass=getCreditClass,service}responseTransformationServiceFn.$inject=["jsonPath","$log","aemRoutingService","checkOutConstants","creditClassConstant"],angular.module("tmobileApp").service("responseTransformationServiceV1",responseTransformationServiceFn)}(angular),function(angular){"use strict";function switcherGraph($window,$rootScope,viewport,utils,$interval,$timeout){return{restrict:"A",scope:!0,link:function(scope,element,attr){function initGraph(){utils.pollForGlobal("d3").then(displayGraph)}function displayGraph(){function setPointDataAndPredefinedPaths(){viewport.breakpointUp("tablet")?(endpoints=[[0,700],[140,660],[256,625],[372,590],[488,553],[604,550],[720,546],[836,543],[952,539],[1068,536],[1184,534],[1300,487],[1416,445],[1532,400]],scrubpoints=[[140,660],[256,625],[372,590],[488,553],[604,550],[720,546],[836,543],[952,539],[1068,536],[1184,534],[1300,487],[1416,445],[1532,400]],balloonpoints=[[0,605],[140,565],[256,530],[372,495],[488,458],[604,455],[720,451],[836,448],[952,444],[1068,441],[1184,439],[1300,392],[1416,350],[1562,305]],scrubpoints1=[[0,684],[140,684],[256,684],[372,684],[488,684],[604,684],[720,684],[836,684],[952,684],[1068,684],[1184,684],[1300,684],[1416,684],[1527,684]],xCoordinatesSave=[140,256,372,488,604,720,836,952,1068,1184,1300,1416,1532],xCoordinatesMonthsBoundary=[140,198,314,430,546,662,778,894,1010,1126,1242,1358,1474,1532],scrubpointsInitialload=[[0,700],[140,660],[256,625],[372,590],[488,553],[604,550],[720,546],[836,543],[952,539],[1068,536],[1184,534],[1300,487],[1416,445],[1527,400]],linePoints=[[0,500],[140,460],[256,425],[372,390],[488,353],[604,350],[720,346],[836,343],[952,339],[1068,336],[1184,334],[1300,287],[1416,245],[1527,200]],particleSizes=[25,45,65,75,90],points=[[140,715],[256,710],[372,705],[488,684],[604,684],[720,684],[836,684],[952,684],[1068,684],[1184,684],[1300,684],[1416,684],[1532,684]],start=[[0,840],[604,840],[1068,840],[1680,840],[1680,840],[0,840]],two=[[0,700],[604,840],[1068,840],[1680,840],[1680,840],[0,840]],three=[[0,700],[604,550],[1068,840],[1680,840],[1680,840],[0,840]],four=[[0,700],[604,550],[1068,530],[1680,840],[1680,840],[0,840]],five=[[0,700],[488,550],[1184,530],[1680,340],[1680,840],[0,840]]):(endpoints=[[0,605],[86,582],[154,561],[222,540],[290,518],[360,516],[430,512],[500,507],[570,505],[640,503],[710,498],[778,477],[846,458],[914,438],[1e3,411]],scrubpoints=[[86,582],[154,561],[222,540],[290,518],[360,516],[430,512],[500,507],[570,505],[640,503],[710,498],[778,477],[846,458],[914,438]],balloonpoints=[[0,520],[124,493],[192,474],[260,452],[327,431],[397,431],[467,429],[538,426],[608,424],[678,420],[748,414],[815,394],[885,376],[951,357]],scrubpoints1=[[0,649],[86,625],[154,609],[222,587],[290,581],[360,588],[430,588],[500,588],[570,588],[640,588],[710,588],[778,588],[846,588],[914,588]],points=[[86,625],[154,609],[222,587],[290,581],[360,588],[430,588],[500,588],[570,588],[640,588],[710,588],[778,588],[846,588],[914,588]],start=[[0,740],[290,740],[710,740],[914,740],[1e3,740],[0,740]],two=[[0,605],[290,740],[710,740],[914,740],[1e3,740],[1e3,740],[0,740]],three=[[0,605],[290,518],[710,740],[914,740],[1e3,740],[1e3,740],[0,740]],four=[[0,605],[290,518],[710,498],[914,740],[1e3,740],[1e3,740],[0,740]],five=[[0,605],[290,518],[710,498],[914,438],[1e3,411],[1e3,740],[0,740]],particleSizes=[15,30,45,60,70],xCoordinatesSave=[86,154,222,290,360,430,500,570,640,710,778,846,914],xCoordinatesMonthsBoundary=[86,120,188,256,325,395,465,535,605,675,744,812,880,914],scrubpointsInitialload=[[0,605],[86,582],[154,561],[222,540],[290,518],[360,516],[430,512],[500,507],[570,505],[640,503],[710,498],[778,477],[846,458],[914,438]],linePoints=[[0,605],[86,582],[154,561],[222,540],[290,518],[360,516],[430,512],[500,507],[570,505],[640,503],[710,498],[778,477],[846,458],[914,438],[1e3,411]])}function setSvgForHeaderCopy(){viewport.breakpointUp("tablet")?(svgCopy=d3.select("#chartArea").append("svg").attr("id","switcherCopy").attr("viewBox","0 0 1680 840"),priceGroup=svgCopy.append("g").attr("id","priceGroup"),priceGroup.append("text").attr("x",60).attr("y",65).text(savingsEyebrow).attr("class","intro"),price=priceGroup.append("text").attr("x",58).attr("y",206).text("$0").attr("class","price"),priceGroup.append("text").attr("x",66).attr("y",250).text(savingsDisclaimer).attr("class","est"),priceGroup.append("text").attr("x",346).attr("y",206).text("/yr").style("opacity",0).attr("class","per")):(svgCopy=d3.select("#chartArea").append("svg").attr("id","switcherCopy").attr("viewBox","0 50 1000 405"),priceGroup=svgCopy.append("g").attr("id","priceGroup"),priceGroup.append("text").attr("x",60).attr("y",65).text(savingsEyebrow).attr("class","intro-mobile"),price=priceGroup.append("text").attr("x",58).attr("y",192).text("$0").attr("class","price-mobile"),priceGroup.append("text").attr("x",66).attr("y",228).text(savingsDisclaimer).attr("class","est"),priceGroup.append("text").attr("x",346).attr("y",192).text("/yr").style("opacity",0).attr("class","per"))}function attachGraphLegendCopy(){viewport.breakpointUp("tablet")?(svg.append("text").attr("x",113).attr("y",642).attr("id","today").text("Today").attr("class","legend"),months.month1=svg.append("text").attr("x",217).attr("y",604).attr("id","month1").attr("selected",0).text("1 month").attr("class","legend monthlySaving").style("opacity",0),months.month2=svg.append("text").attr("x",326).attr("y",569).attr("id","month2").attr("selected",0).text("2 months").attr("class","legend monthlySaving").style("opacity",0),months.month3=svg.append("text").attr("x",445).attr("y",535).attr("id","month3").attr("selected",0).text("3 months").attr("class","legend monthlySaving").style("opacity",0),months.month4=svg.append("text").attr("x",556).attr("y",530).attr("id","month4").attr("selected",0).text("4 months").attr("class","legend monthlySaving").style("opacity",0),months.month5=svg.append("text").attr("x",674).attr("y",527).attr("id","month5").attr("selected",0).text("5 months").attr("class","legend monthlySaving").style("opacity",0),months.month6=svg.append("text").attr("x",790).attr("y",525).attr("id","month6").attr("selected",0).text("6 months").attr("class","legend monthlySaving").style("opacity",0),months.month7=svg.append("text").attr("x",907).attr("y",520).attr("id","month7").attr("selected",0).text("7 months").attr("class","legend monthlySaving").style("opacity",0),months.month8=svg.append("text").attr("x",1023).attr("y",518).attr("id","month8").attr("selected",0).text("8 months").attr("class","legend monthlySaving").style("opacity",0),months.month9=svg.append("text").attr("x",1136).attr("y",513).attr("id","month9").attr("selected",0).text("9 months").attr("class","legend monthlySaving").style("opacity",0),months.month10=svg.append("text").attr("x",1248).attr("y",466).attr("id","month10").attr("selected",0).text("10 months").attr("class","legend").style("opacity",0),months.month11=svg.append("text").attr("x",1360).attr("y",425).attr("id","month11").attr("selected",0).text("11 months").attr("class","legend").style("opacity",0),svg.append("text").attr("x",1498).attr("y",380).attr("id","year").text("1 Year").attr("class","legend"),svg.append("text").attr("x",702).attr("y",755).text("See a year of great benefits").attr("id","click-or-tap").attr("class","legendCTA"),svg.append("path").attr("d",tapIcon).attr("transform","translate(625, 660) scale(.2)").attr("id","tapIcon")):(svg.append("text").attr("x",62).attr("y",566).attr("id","today").text("Today").attr("class","legend font-size-sm"),months.month1=svg.append("text").attr("x",120).attr("y",547).attr("id","month1").attr("selected",0).text("1 month").attr("class","legend font-size-sm").style("opacity",0),months.month2=svg.append("text").attr("x",182).attr("y",525).attr("id","month2").attr("selected",0).text("2 months").attr("class","legend font-size-sm").style("opacity",0),months.month3=svg.append("text").attr("x",246).attr("y",504).attr("id","month3").attr("selected",0).text("3 months").attr("class","legend font-size-sm").style("opacity",0),months.month4=svg.append("text").attr("x",318).attr("y",502).attr("id","month4").attr("selected",0).text("4 months").attr("class","legend font-size-sm").style("opacity",0),months.month5=svg.append("text").attr("x",390).attr("y",499).attr("id","month5").attr("selected",0).text("5 months").attr("class","legend font-size-sm").style("opacity",0),months.month6=svg.append("text").attr("x",464).attr("y",494).attr("id","month6").attr("selected",0).text("6 months").attr("class","legend font-size-sm").style("opacity",0),months.month7=svg.append("text").attr("x",536).attr("y",493).attr("id","month7").attr("selected",0).text("7 months").attr("class","legend font-size-sm").style("opacity",0),months.month8=svg.append("text").attr("x",608).attr("y",489).attr("id","month8").attr("selected",0).text("8 months").attr("class","legend font-size-sm").style("opacity",0),months.month9=svg.append("text").attr("x",680).attr("y",484).attr("id","month9").attr("selected",0).text("9 months").attr("class","legend font-size-sm").style("opacity",0),months.month10=svg.append("text").attr("x",738).attr("y",463).attr("id","month10").attr("selected",0).text("10 months").attr("class","legend font-size-sm").style("opacity",0),months.month11=svg.append("text").attr("x",807).attr("y",445).attr("id","month11").attr("selected",0).text("11 months").attr("class","legend font-size-sm").style("opacity",0),svg.append("text").attr("x",865).attr("y",426).attr("id","year").text("1 Year").attr("class","legend font-size-sm"),svg.append("text").attr("x",368).attr("y",647).attr("id","click-or-tap").text("See a year of great benefits").attr("class","legendCTA timeline button font-size-md"),svg.append("path").attr("d",tapIcon).attr("transform","translate(291, 556) scale(.2)").attr("id","tapIcon"))}function attachImagesToBallonForTablet(){emoji.faceMoji=d3.select("#balloon").append("svg:image").attr("xlink:href","/etc/clientlibs/t-mobile/publish/app/angular_app/assets/images/marketing/switcher/emo-money_face.png").attr("id","faceMoji").attr("width",60).attr("height",60).style("opacity",1).transition().attr("transform","translate(-66,-40)")}function attachImagesToBallon(){emoji.faceMoji=d3.select("#balloon").append("svg:image").attr("xlink:href","/etc/clientlibs/t-mobile/publish/app/angular_app/assets/images/marketing/switcher/emo-money_face.png").attr("id","faceMoji").attr("width",55).attr("height",55).style("opacity",1).transition().attr("transform","translate(-64,-38)")}function centerPath(){var activePath=d3.select("#balloon").selectAll("path"),activePathBalloon=d3.select("#balloon");nib=d3.select("#balloon").select("#nib");var bbox=activePath.node().getBBox(),center=[-1*(bbox.x+bbox.width/2),-1*(bbox.y+bbox.height/2)];activePath.attr("transform","translate("+center+")"),activePathGroup=d3.select(activePathBalloon.node())}function centerScrubPath(){var holder=d3.select("#scrubCont").select("#scrub"),activePath=d3.select("#scrubCont").select("#arrows"),bbox=holder.node().getBBox(),center=[-1*(bbox.x+bbox.width/2),-1*(bbox.y+bbox.height/2)];holder.attr("transform","translate("+center+")"),activePath.attr("transform","translate(-27, -10)"),activeScrubGroup=d3.select(holder.node().parentNode)}function filterForBackgroundAndDropShadow(){var defs=svg.append("svg:defs");defs.append("svg:pattern").attr("id","tile-ww").attr("patternUnits","userSpaceOnUse").attr("width","750").attr("height","382").append("svg:image").attr("xlink:href","/etc/clientlibs/t-mobile/publish/app/angular_app/assets/images/marketing/switcher/graph-fill.jpg").attr("x",0).attr("y",0).attr("width",750).attr("height",382),filter=defs.append("filter").attr("id","drop-shadow").attr("height","200%"),filter.append("feGaussianBlur").attr("in","SourceAlpha").attr("stdDeviation",30).attr("result","blur"),filter.append("feOffset").attr("in","blur").attr("dx",30).attr("dy",30).attr("result","offsetBlur");var feMerge=filter.append("feMerge");feMerge.append("feMergeNode").attr("in","offsetBlur"),feMerge.append("feMergeNode").attr("in","SourceGraphic");var filter2=defs.append("filter").attr("id","drop-shadow2").attr("filterUnits","userSpaceOnUse").attr("width","250%").attr("height","250%");filter2.append("feGaussianBlur").attr("in","SourceAlpha").attr("stdDeviation",10).attr("result","blur"),filter2.append("feOffset").attr("in","blur").attr("dx",0).attr("dy",10).attr("result","offsetBlur"),filter2.append("feFlood").attr("in","offsetBlur").attr("flood-color","#000").attr("flood-opacity","0.3").attr("result","offsetColor"),filter2.append("feComposite").attr("in","offsetColor").attr("in2","offsetBlur").attr("operator","in").attr("result","offsetBlur");var feMerge2=filter2.append("feMerge");feMerge2.append("feMergeNode").attr("in","offsetBlur"),feMerge2.append("feMergeNode").attr("in","SourceGraphic")}function startIntBalloon(){$timeout(function(){d3.selectAll(".fadeout-Image").remove()},2e3)}function startInt(){element.find(".verticalLine").hide(),viewport.breakpointUp("tablet")?gLine.attr("x1",1527).attr("y1",718).attr("x2",1527).attr("y2",405):gLine.attr("x1",914).attr("y1",588).attr("x2",914).attr("y2",438);var priceNode=price.node().getBBox();d3.selectAll(".per").attr("x",priceNode.width+80).transition().delay(100).duration(500).ease("bounce").style("opacity",1)}function dragstarted(d){previousx=currentx,currentx=d3.transform(circle.attr("transform")).translate[0],currenty=d3.transform(circle.attr("transform")).translate[1],draggingDirection=currentx>previousx?"right":previousx>currentx?"left":"right"}function dragged(d){function moveScrubBarAndIndicator(){activeScrubGroup.attr("transform","translate("+p1[0]+","+p2[1]+")"),viewport.breakpointUp("tablet")?(gLine.attr("x1",p1[0]).attr("y1",718).attr("x2",p1[0]).attr("y2",p1[1]+10),clickBox.attr("height",p1[1]+20).attr("transform","translate(-55, -"+(p1[1]-20)+")")):gLine.attr("x1",p1[0]).attr("y1",563).attr("x2",p1[0]).attr("y2",p1[1]+10),previousx=currentx,currentx=d3.transform(circle.attr("transform")).translate[0],currenty=d3.transform(circle.attr("transform")).translate[1]}var m=d3.mouse(svg.node());p1=closestPoint(scrubPath.node(),m),p2=closestPoint(base.node(),m),d3.select(".scrub-indicator").attr("transform","translate("+p1[0]+","+p1[1]+")"),rotateAndMove(),moveScrubBarAndIndicator(),getCoordinatesToAnimateScrubber1(xCoordinatesSave,"months"),getCoordinatesToAnimateScrubber1(xCoordinatesSave,"save"),currentx>previousx?draggingDirection="right":previousx>currentx&&(draggingDirection="left"),getCoordinatesToAnimateScrubber1(xCoordinatesSave,"image")}function generateImage(xCoord,count){var images=["/etc/clientlibs/t-mobile/publish/app/angular_app/assets/images/marketing/switcher/dollar-banknote.png","/etc/clientlibs/t-mobile/publish/app/angular_app/assets/images/marketing/switcher/money-bag.png","/etc/clientlibs/t-mobile/publish/app/angular_app/assets/images/marketing/switcher/unlimited.png","/etc/clientlibs/t-mobile/publish/app/angular_app/assets/images/marketing/switcher/unlimited-01.png","/etc/clientlibs/t-mobile/publish/app/angular_app/assets/images/marketing/switcher/unlimited-02.png"],divisor=3*count,modulus=xCoord%divisor;0===modulus&&createParticle(images[0],""),modulus===count&&createParticle(images[1],""),modulus===1+count&&createParticle(images[0],""),modulus===2+count&&createParticle(images[1],""),modulus===11+count&&createParticle(images[0],""),modulus===15+count&&createParticle(images[1],""),modulus===4+count&&createParticle(images[2],"text"),modulus===7+count&&createParticle(images[3],"text"),modulus===17+count&&createParticle(images[4],"text")}function createParticle(image,type){var array=new Uint8Array(1),size=particleSizes[Math.floor(window.crypto.getRandomValues(array)/(Math.pow(2,8)-1)*particleSizes.length)],negative=size/2;"text"===type&&(size*=2);var otime,speedHorz=window.crypto.getRandomValues(array)/(Math.pow(2,8)-1)*10,speedUp=window.crypto.getRandomValues(array)/(Math.pow(2,8)-1)*25,time=otime=100*(1+.5*(window.crypto.getRandomValues(array)/(Math.pow(2,8)-1))),top=currenty+100+size,left=currentx-negative,direction=window.crypto.getRandomValues(array)/(Math.pow(2,8)-1)<=.5?-1:1,life=10,x=0,y=0,angle=-360;"left"===draggingDirection&&(x=3e3+window.crypto.getRandomValues(array)/(Math.pow(2,8)-1)*1e3,y=-600+window.crypto.getRandomValues(array)/(Math.pow(2,8)-1)*1e3,angle=360),"right"===draggingDirection&&(x=-3e3+window.crypto.getRandomValues(array)/(Math.pow(2,8)-1)*1e3,y=-600+window.crypto.getRandomValues(array)/(Math.pow(2,8)-1)*1e3,angle=-360);var particle=d3.select("#balloon").insert("svg:image",":first-child").attr("xlink:href",image).attr("width",size).attr("height",size).attr("top",top+100).attr("left",left+100).transition().duration(4e3).ease("linear").attrTween("transform",function(d){return d3.interpolateString("translate( -80, -70) rotate(0)","translate("+x+","+y+") rotate("+angle+", 0, 0)")}).attr("class","fadeout-Image");particleCount++;var particleTimer=$timeout(function(){var particleOpacity=time/otime/2-.48;0>particleOpacity&&(particleOpacity=0),time-=life,left-=speedHorz*direction,top-=speedUp,speedUp=Math.min(size,speedUp-1),particle.attr("width",size).attr("height",size).attr("top",size).attr("left",size).transition().duration(4e3).ease("linear").attrTween("transform",function(d){return d3.interpolateString("translate( -80, -70) rotate(0)","translate("+x+","+y+") rotate(360, 30, 50)")}),particleCount>4e3&&($timeout(function(){d3.selectAll(".fadeout-Image").remove()},1e3),particleCount--,clearInterval(particleTimer))},6)}function createParticle2(image,type,delay){var array=new Uint8Array(1),size=particleSizes[Math.floor(window.crypto.getRandomValues(array)/(Math.pow(2,8)-1)*particleSizes.length)];"text"===type&&(size*=2);var otime,speedUp=window.crypto.getRandomValues(array)/(Math.pow(2,8)-1)*25,time=otime=100*(1+.5*(window.crypto.getRandomValues(array)/(Math.pow(2,8)-1))),life=10,x=0,y=0;
x=-3e3+window.crypto.getRandomValues(array)/(Math.pow(2,8)-1)*1e3,y=-600+window.crypto.getRandomValues(array)/(Math.pow(2,8)-1)*1e3,d3.select("#balloon").insert("svg:image",":first-child").attr("xlink:href",image).attr("width",size).attr("height",size).attr("x",-90).attr("y",-60).transition().delay(delay).duration(3e3).ease("linear").attrTween("transform",function(d){return d3.interpolateString("translate( -30, -10) rotate(0)","translate("+x+","+y+") rotate(-360, 30, 50)")}).attr("class","fadeout-Image"),particleCount++;var particleTimer=$timeout(function(){var particleOpacity=time/otime/2-.48;0>particleOpacity&&(particleOpacity=0),time-=life,speedUp=Math.min(size,speedUp-1),particleCount>4e3&&($timeout(function(){d3.selectAll(".fadeout-Image").remove()},1e3),particleCount--,clearInterval(particleTimer))},6)}function getCoordinatesToAnimateScrubber(xCoordinates,breakpoint){var currentxInteger=Math.round(currentx),text="show one month";currentxInteger>=xCoordinates[0]&&currentx<xCoordinates[1]?(getClosestPoint(breakpoint[0][0],breakpoint[0][1]),monthlySave=0*monthly,hideMonths1("","",0,0,text)):currentxInteger>=xCoordinates[1]&&currentx<xCoordinates[2]?(getClosestPoint(breakpoint[1][0],breakpoint[1][1]),monthlySave=1*monthly,hideMonths1("","month1",xCoordinates[1],xCoordinates[2],text)):currentxInteger>=xCoordinates[2]&&currentx<xCoordinates[3]?(getClosestPoint(breakpoint[2][0],breakpoint[2][1]),monthlySave=2*monthly,hideMonths1("","month2",xCoordinates[2],xCoordinates[3],text)):currentxInteger>=xCoordinates[3]&&currentx<xCoordinates[4]?(getClosestPoint(breakpoint[3][0],breakpoint[3][1]),monthlySave=3*monthly,hideMonths1("","month3",xCoordinates[3],xCoordinates[4],text)):currentxInteger>=xCoordinates[4]&&currentx<xCoordinates[5]?(getClosestPoint(breakpoint[4][0],breakpoint[4][1]),monthlySave=4*monthly,hideMonths1("","month4",xCoordinates[4],xCoordinates[5],text)):currentxInteger>=xCoordinates[5]&&currentx<xCoordinates[6]?(getClosestPoint(breakpoint[5][0],breakpoint[5][1]),monthlySave=5*monthly,hideMonths1("","month5",xCoordinates[5],xCoordinates[6],text)):currentxInteger>=xCoordinates[6]&&currentx<xCoordinates[7]?(getClosestPoint(breakpoint[6][0],breakpoint[6][1]),monthlySave=6*monthly,hideMonths1("","month6",xCoordinates[6],xCoordinates[7],text)):currentxInteger>=xCoordinates[7]&&currentx<xCoordinates[8]?(getClosestPoint(breakpoint[7][0],breakpoint[7][1]),monthlySave=7*monthly,hideMonths1("","month7",xCoordinates[7],xCoordinates[8],text)):currentxInteger>=xCoordinates[8]&&currentx<xCoordinates[9]?(getClosestPoint(breakpoint[8][0],breakpoint[8][1]),monthlySave=8*monthly,hideMonths1("","month8",xCoordinates[8],xCoordinates[9],text)):currentxInteger>=xCoordinates[9]&&currentx<xCoordinates[10]?(getClosestPoint(breakpoint[9][0],breakpoint[9][1]),monthlySave=9*monthly,hideMonths1("","month9",xCoordinates[9],xCoordinates[10],text)):currentxInteger>=xCoordinates[10]&&currentx<xCoordinates[11]?(getClosestPoint(breakpoint[10][0],breakpoint[10][1]),monthlySave=10*monthly,hideMonths1("","month10",xCoordinates[10],xCoordinates[11],text)):currentxInteger>=xCoordinates[11]&&currentx<xCoordinates[12]?(getClosestPoint(breakpoint[11][0],breakpoint[11][1]),monthlySave=11*monthly,hideMonths1("","month11",xCoordinates[11],xCoordinates[12],text)):currentxInteger>=xCoordinates[12]&&currentxInteger<=xCoordinates[13]&&(getClosestPoint(breakpoint[12][0],breakpoint[12][1]),monthlySave=12*monthly,hideMonths1("","",xCoordinates[12],xCoordinates[13],text))}function getCoordinatesToAnimateScrubber1(xCoordinates,text){var currentxInteger=Math.round(currentx);currentxInteger<=xCoordinates[0]?"months"===text&&hideMonths("","",0,0,text):currentx>xCoordinates[0]&&currentxInteger<=xCoordinates[1]?"months"===text||("image"===text?generateImage(currentxInteger,12):interPolateSaving(0,monthly,xCoordinates[0])):currentx>xCoordinates[1]&&currentxInteger<=xCoordinates[2]?"months"===text||("image"===text?generateImage(currentxInteger,11):interPolateSaving(monthly,2*monthly,xCoordinates[1])):currentx>xCoordinates[2]&&currentxInteger<=xCoordinates[3]?"months"===text?hideMonths("","month3",xCoordinates[2],xCoordinates[3],text):"image"===text?generateImage(currentxInteger,10):interPolateSaving(2*monthly,3*monthly,xCoordinates[2]):currentx>xCoordinates[3]&&currentxInteger<=xCoordinates[4]?"months"===text?hideMonths("month3","",xCoordinates[3],xCoordinates[4],text):"image"===text?generateImage(currentxInteger,9):interPolateSaving(3*monthly,4*monthly,xCoordinates[3]):currentx>xCoordinates[4]&&currentxInteger<=xCoordinates[5]?"months"===text||("image"===text?generateImage(currentxInteger,8):interPolateSaving(4*monthly,5*monthly,xCoordinates[4])):currentx>xCoordinates[5]&&currentxInteger<=xCoordinates[6]?"months"===text?hideMonths("","month6",xCoordinates[5],xCoordinates[6],text):"image"===text?generateImage(currentxInteger,7):interPolateSaving(5*monthly,6*monthly,xCoordinates[5]):currentx>xCoordinates[6]&&currentxInteger<=xCoordinates[7]?"months"===text?hideMonths("month6","",xCoordinates[6],xCoordinates[7],text):"image"===text?generateImage(currentxInteger,6):interPolateSaving(6*monthly,7*monthly,xCoordinates[6]):currentx>xCoordinates[7]&&currentxInteger<=xCoordinates[8]?"months"===text||("image"===text?generateImage(currentxInteger,5):interPolateSaving(7*monthly,8*monthly,xCoordinates[7])):currentx>xCoordinates[8]&&currentxInteger<=xCoordinates[9]?"months"===text?hideMonths("","month9",xCoordinates[8],xCoordinates[9],text):"image"===text?generateImage(currentxInteger,4):interPolateSaving(8*monthly,9*monthly,xCoordinates[8]):currentx>xCoordinates[9]&&currentxInteger<=xCoordinates[10]?"months"===text?hideMonths("month9","",xCoordinates[9],xCoordinates[10],text):"image"===text?generateImage(currentxInteger,3):interPolateSaving(9*monthly,10*monthly,xCoordinates[9]):currentx>xCoordinates[10]&&currentxInteger<=xCoordinates[11]?"months"===text||("image"===text?generateImage(currentxInteger,2):interPolateSaving(10*monthly,11*monthly,xCoordinates[10])):currentx>xCoordinates[11]&&currentxInteger<=xCoordinates[12]?"save"===text?interPolateSaving(11*monthly,12*monthly,xCoordinates[11]):"image"===text&&generateImage(currentxInteger,1):currentxInteger>=xCoordinates[12]&&"months"===text&&hideMonths("","",0,0,text)}function interPolateSaving(monthly1,monthly2,coordinate){var range,savingsText="$"+12*monthly;"left"===draggingDirection&&(range=d3.interpolateNumber(monthly2,monthly1)),"right"===draggingDirection&&(range=d3.interpolateNumber(monthly1,monthly2));var breakpoint=1e12*currentx,xcoordinate=1e12*coordinate;price.transition().ease("quad-out").tween("textTween",function(d){return function(t){breakpoint===xcoordinate?d3.select(this).text("$"+monthly*monthly1):d3.select(this).text("$"+format(range(t))),d3.select(this).text()===savingsText&&breakpoint===xcoordinate&&d3.select("text.per").style("opacity",1),d3.select(this).text()!==savingsText&&d3.select("text.per").style("opacity",0),boundRight=d3.transform(circle.attr("transform")).translate[0]}})}function hideMonths1(prevMonth,currentMonth,xcoord1,xcoord2,text){d3.select("#switcherGraph").selectAll("text").style("opacity",0),d3.select("#switcherGraph").select("#today").style("opacity",1),d3.select("#switcherGraph").select("#year").style("opacity",1),d3.select("#switcherGraph").select("#click-or-tap").style("opacity",1),viewport.breakpointUp("tablet")?(d3.selectAll("text.fadeout-month")&&d3.selectAll("text.fadeout-month").attr("class","legend"),d3.selectAll("text.fadein-month")&&d3.selectAll("text.fadein-month").attr("class","legend"),"show one month"===text&&""!==currentMonth&&d3.select("#"+currentMonth).attr("class","legend").style("opacity",1)):(d3.selectAll("text.fadeout-month")&&d3.selectAll("text.fadeout-month").attr("class","legend font-size-sm"),d3.selectAll("text.fadein-month")&&d3.selectAll("text.fadein-month").attr("class","legend font-size-sm"),"show one month"===text&&""!==currentMonth&&d3.select("#"+currentMonth).attr("class","legend font-size-sm").style("opacity",1))}function hideMonths(prevMonth,currentMonth,xcoord1,xcoord2,text){d3.select("#switcherGraph").selectAll("text").style("opacity",0),d3.select("#switcherGraph").select("#today").style("opacity",1),d3.select("#switcherGraph").select("#year").style("opacity",1),d3.select("#switcherGraph").select("#click-or-tap").style("opacity",1),"months"===text&&viewport.breakpointUp("tablet")&&(""!==prevMonth&&""!==currentMonth&&("right"===draggingDirection&&d3.select("#"+currentMonth).attr("class","legend fadein-month"),"left"===draggingDirection&&d3.select("#"+currentMonth).attr("class","legend fadeout-month"),"right"===draggingDirection&&d3.select("#"+prevMonth).attr("class","legend fadeout-month"),"left"===draggingDirection&&d3.select("#"+prevMonth).attr("class","legend fadein-month")),""!==currentMonth&&""===prevMonth&&("right"===draggingDirection&&d3.select("#"+currentMonth).attr("class","legend fadein-month"),"left"===draggingDirection&&d3.select("#"+currentMonth).attr("class","legend fadeout-month")),""!==prevMonth&&""===currentMonth&&("right"===draggingDirection&&d3.select("#"+prevMonth).attr("class","legend fadeout-month"),"left"===draggingDirection&&d3.select("#"+prevMonth).attr("class","legend fadein-month"))),"months"!==text||viewport.breakpointUp("tablet")||(""!==prevMonth&&""!==currentMonth&&("right"===draggingDirection&&d3.select("#"+currentMonth).attr("class","legend font-size-sm fadein-month"),"left"===draggingDirection&&d3.select("#"+currentMonth).attr("class","legend font-size-sm fadeout-month"),"right"===draggingDirection&&d3.select("#"+prevMonth).attr("class","legend font-size-sm fadeout-month"),"left"===draggingDirection&&d3.select("#"+prevMonth).attr("class","legend font-size-sm fadein-month")),""!==currentMonth&&""===prevMonth&&("right"===draggingDirection&&d3.select("#"+currentMonth).attr("class","legend font-size-sm fadein-month"),"left"===draggingDirection&&d3.select("#"+currentMonth).attr("class","legend font-size-sm fadeout-month")),""!==prevMonth&&""===currentMonth&&("right"===draggingDirection&&d3.select("#"+prevMonth).attr("class","legend font-size-sm fadeout-month"),"left"===draggingDirection&&d3.select("#"+prevMonth).attr("class","legend font-size-sm fadein-month")))}function rotateAndMove(){viewport.breakpointUp("tablet")?activePathGroup.transition().ease("easeIn").attr("transform","translate("+(p1[0]+38)+","+(p1[1]-95)+")"):activePathGroup.transition().ease("easeIn").attr("transform","translate("+(p1[0]+38)+","+(p1[1]-82)+")")}function dragend(d){snap(d),viewport.breakpointUp("tablet")?activePathGroup.transition().ease("easeOut").attr("transform","translate("+(p1[0]+38)+","+(p1[1]-95)+")"):activePathGroup.transition().ease("easeOut").attr("transform","translate("+(p1[0]+38)+","+(p1[1]-82)+")"),$timeout(function(){d3.selectAll(".fadeout-Image").remove()},1500),$timeout(function(){viewport.breakpointUp("tablet")?d3.select("text.price").text("$"+monthlySave):d3.select("text.price-mobile").text("$"+monthlySave),monthlySave===12*monthly?d3.select("text.per").style("opacity",1):d3.select("text.per").style("opacity",0)},300)}function snap(d){getCoordinatesToAnimateScrubber(xCoordinatesMonthsBoundary,scrubpoints),rotateMoveBallon(),activeScrubGroup.transition().ease("easeOut").attr("transform","translate("+p1[0]+","+p2[1]+")"),lineIndicator(),currentx=d3.transform(circle.attr("transform")).translate[0],currenty=d3.transform(circle.attr("transform")).translate[1]}function getClosestPoint(a,b){var coordinates=[a,b];p1=closestPoint(scrubPath.node(),coordinates),p2=closestPoint(base.node(),coordinates)}function rotateMoveBallon(){d3.select(".scrub-indicator").transition().ease("easeOut").attr("transform","translate("+p1[0]+","+p1[1]+")"),boundLeft>=currentx||currentx>=boundRight?activePathGroup.transition().ease("easeOut").attr("transform","translate("+(p1[0]+38)+","+(p1[1]-95)+")"):currentx>p1[0]?activePathGroup.transition().ease("easeOut").attr("transform","translate("+(p1[0]+38)+","+(p1[1]-95)+")"):activePathGroup.transition().ease("easeOut").attr("transform","translate("+(p1[0]+38)+","+(p1[1]-95)+")")}function lineIndicator(){viewport.breakpointUp("tablet")?gLine.transition().ease("easeOut").attr("x1",p1[0]).attr("y1",718).attr("x2",p1[0]).attr("y2",p1[1]+10):gLine.transition().ease("easeOut").attr("x1",p1[0]).attr("y1",565).attr("x2",p1[0]).attr("y2",p1[1]+10)}function closestPoint(pathNode,point){function distance2(p){var dx=p.x-point[0],dy=p.y-point[1];return dx*dx+dy*dy}for(var scan,pathLength=pathNode.getTotalLength(),precision=8,best={},bestLength=0,bestDistance=1/0,scanLength=0,scanDistance=0;pathLength>=scanLength;scanLength+=precision)(scanDistance=distance2(scan=pathNode.getPointAtLength(scanLength)))<bestDistance&&(best=scan,bestLength=scanLength,bestDistance=scanDistance);for(precision/=2;precision>.5;){var before={},after={},beforeLength=0,afterLength=0,beforeDistance=0,afterDistance=0;(beforeLength=bestLength-precision)>=0&&(beforeDistance=distance2(before=pathNode.getPointAtLength(beforeLength)))<bestDistance?(best=before,bestLength=beforeLength,bestDistance=beforeDistance):(afterLength=bestLength+precision)<=pathLength&&(afterDistance=distance2(after=pathNode.getPointAtLength(afterLength)))<bestDistance?(best=after,bestLength=afterLength,bestDistance=afterDistance):precision/=2}return best=[best.x,best.y],best.distance=Math.sqrt(bestDistance),best}function transitionGraph(){hasSave?path.transition().duration(300).attr("d",line(two)).transition().duration(300).attr("d",line(three)).transition().duration(300).attr("d",line(four)).transition().duration(300).attr("d",line(five)):path.transition().duration(300).attr("d",line(flat)),transitionCircle()}function animateParticles(){for(var delay=1800,i=0;3500>delay;i++)delay+=35,i>4&&(i=0),createParticle2(imageAnimate[i],"",delay)}function transitionCircle(){function scaleLineDesktop(d,i,a){return d3.interpolate(a,250)}function scaleLineMobile(d,i,a){return d3.interpolate(a,130)}var monthsDuration=[2050,2200,2500,2700],index=0;if(circle.transition().delay(1500).duration(3100).attrTween("transform",translateAlong(scrubPathInitialLoad.node())),activeScrubGroup.style("opacity",0).transition().duration(200).style("opacity",1).attrTween("transform",translateAlong(baseScrub.node())).delay(1500).duration(3100).each("end",function(){startInt()}),activePathGroup.style("opacity",0).transition().duration(100).style("opacity",1).transition().delay(1500).duration(3100).attrTween("transform",translateAlong1(balloonPath.node())).each("end",function(){startIntBalloon()}),viewport.breakpointUp("tablet")?(svg.append("line").attr({x1:0,y1:0,x2:0,y2:20}).attr("class","verticalLine"),d3.select(".verticalLine").style("opacity",0).transition().duration(100).style("opacity",1).delay(1500).duration(3100).attrTween("transform",translateAlongX(scrubPathInitialLoad.node(),baseScrub.node())).delay(1500).duration(3100).attrTween("y2",scaleLineDesktop)):(svg.append("line").attr({x1:0,y1:-10,x2:0,y2:20}).attr("class","verticalLine"),d3.select(".verticalLine").style("opacity",0).transition().duration(100).style("opacity",1).delay(1500).duration(3100).attrTween("transform",translateAlongX(scrubPathInitialLoad.node(),baseScrub.node())).delay(1500).duration(3100).attrTween("y2",scaleLineMobile)),hasSave){var range=d3.interpolateNumber(monthly,annual);price.transition().ease("quad-out").delay(1500).duration(3100).tween("text",function(d){return function(t){d3.select(this).text("$"+format(range(t))),boundRight=d3.transform(circle.attr("transform")).translate[0]}})}animateParticles();var introMonths={month1:months.month3,month2:months.month6,month3:months.month9,month4:months.month12};for(var key in introMonths)introMonths.hasOwnProperty(key)&&(introMonths[key].style("opacity",0).transition().delay(monthsDuration[index]).duration(1400).style("opacity",1).transition().duration(300).style("opacity",0),index++);graph.faceMojiGraph.attr("transform","translate(1507, 330) scale(.4)").style("opacity",1)}function translateAlong(elementPath){var l=elementPath.getTotalLength();return function(d,i,a){return function(t){var p=elementPath.getPointAtLength(t*l);return"translate("+p.x+","+p.y+")"}}}function translateAlong1(elementPath){var l=elementPath.getTotalLength();return function(d,i,a){return function(t){var p=elementPath.getPointAtLength(t*l);return"translate("+p.x+","+p.y+")"}}}function translateAlongX(elementPath,elementPath2){var l=elementPath.getTotalLength();return function(d,i,a){return function(t){var p=elementPath.getPointAtLength(t*l);elementPath2.getPointAtLength(t*l);return"translate("+p.x+","+p.y+")"}}}function scaleSvg(){var width=win.width();viewport.breakpointUp("tablet")?(angular.element("#switcherCopy").attr({width:win.width()+15,height:.5*win.width()+8}),angular.element("#switcherGraph").attr({width:win.width()+15,height:.5*win.width()+80})):(413>width&&angular.element("#switcherGraph").attr({width:win.width()+15,height:.5*win.width()+20}),321>width&&angular.element("#switcherGraph").attr({width:win.width()+15,height:.5*win.width()+56}),angular.element("#switcherCopy").attr({width:win.width()+15,height:.5*win.width()+40}))}var balloonpoints,d3=$window.window.d3,win=angular.element($window),monthly=scope.vm.switcher.monthlySavings,annual=scope.vm.switcher.annualSavings,monthlySave=0,hasSave=scope.vm.switcher.hasSavings,xCoordinatesSave=[],xCoordinatesMonthsBoundary=[],scrubpointsInitialload=[],linePoints=[],imageAnimate=["/etc/clientlibs/t-mobile/publish/app/angular_app/assets/images/marketing/switcher/dollar-banknote.png","/etc/clientlibs/t-mobile/publish/app/angular_app/assets/images/marketing/switcher/money-bag.png","/etc/clientlibs/t-mobile/publish/app/angular_app/assets/images/marketing/switcher/unlimited.png","/etc/clientlibs/t-mobile/publish/app/angular_app/assets/images/marketing/switcher/unlimited-01.png","/etc/clientlibs/t-mobile/publish/app/angular_app/assets/images/marketing/switcher/unlimited-02.png"],savingsEyebrow=element.attr("data-hs-eyebrow"),savingsDisclaimer=element.attr("data-hs-disclaimer"),particleSizes=[],graph={faceMojiGraph:[],shadesMojiGraph:[]},months={month1:[],month2:[],month3:[],month4:[],month5:[],month6:[],month7:[],month8:[],month9:[],month10:[],month11:[]},emoji={faceMoji:[],shadesMoji:[],moneyMoji:[],planeMoji:[],phoneMoji:[],partyMoji:[],tuesMoji:[],filmMoji:[]},svg=[],endpoints=[],scrubpoints=[],scrubpoints1=[],flat=[],points=[],start=[],two=[],three=[],four=[],five=[],filter=[];win.on("resize",_.throttle(scaleSvg,200)),setPointDataAndPredefinedPaths();var bubble="M55,0L55,0c30.4,0,55,24.6,55,55l0,0c0,30.4-24.6,55-55,55l0,0C24.6,110,0,85.4,0,55l0,0C0,24.6,24.6,0,55,0z",nib="M91.9,73c-3.8,0-1.5-9.4-11.4-12.1s33.3-2.5,22.9,0S95.9,73,91.9,73z",scrub="M43,5h22c18.8,0,34,15.2,34,34l0,0c0,18.8-15.2,34-34,34H43C24.2,73,9,57.8,9,39l0,0C9,20.2,24.2,5,43,5z",arrow="M0,10L10,0v20L0,10z M52,10L42,20V0L52,10z",tapIcon="M238.5,324.25a80.5,80.5,0,1,0,80.5,80.5A80.5,80.5,0,0,0,238.5,324.25Zm32,85.5h-27v27h-10v-27h-27v-10h27v-27h10v27h27Z",format=d3.format(".0f"),line=d3.svg.line(),drag=d3.behavior.drag().on("dragstart",dragstarted).on("drag",dragged).on("dragend",dragend),svgCopy=[],priceGroup=[],price=[];setSvgForHeaderCopy(),svg=viewport.breakpointUp("tablet")?d3.select("#chartArea").append("svg").attr("id","switcherGraph").attr("viewBox","0 0 1680 840"):d3.select("#chartArea").append("svg").attr("id","switcherGraph").attr("viewBox","0 225 1000 490");var path=svg.append("path").attr("d",line(start)).attr("class","start");attachGraphLegendCopy();var base=path.append("path").attr("d",line(points)).attr("class","base"),baseScrub=path.append("path").attr("d",line(scrubpoints1)).attr("class","baseScrub").style("opacity",0);path.append("path").attr("d",line(linePoints)).attr("class","baseLine");svg.append("g").attr("id","balloon").append("path").attr("d",nib).attr("id","nib").attr("x",70).attr("y",690).style("opacity",1).transition().attr("transform","translate(-129,-18)"),d3.select("#balloon").append("path").attr("id","bubble").attr("d",bubble).attr("x",70).attr("y",680),viewport.breakpointUp("tablet")?attachImagesToBallonForTablet():attachImagesToBallon(),svg.append("g").attr("id","scrubCont").append("path").attr("transform","translate("+points[3]+")").attr("d",scrub).attr("id","scrub");var clickBox=d3.select("#scrubCont").append("rect").attr("id","clickBox").attr("width",110).attr("height",242).attr("transform","translate(-55, -210)").call(drag),gLine=svg.append("line").attr("id","gline").style("stroke","black").attr("x1",1700).attr("y1",500).attr("x2",1700).attr("y2",150);d3.select("#scrubCont").append("path").attr("d",arrow).attr("id","arrows"),path.append("g").attr("filter","url(#drop-shadow)");var circle=svg.append("circle").attr("transform","translate("+endpoints[0]+")").attr("r",10).attr("class","scrub-indicator").call(drag);svg.append("path").attr("d",line(endpoints)).attr("id","graphLine");var activePathGroup,scrubPath=svg.append("path").attr("d",line(scrubpoints)).attr("id","scrubPath"),scrubPathInitialLoad=svg.append("path").attr("d",line(scrubpointsInitialload)).attr("id","scrubPath1").style("opacity",0),balloonPath=svg.append("path").attr("d",line(balloonpoints)).attr("id","balloonPath").style("opacity",0);centerPath();var activeScrubGroup;centerScrubPath(),filterForBackgroundAndDropShadow();var draggingDirection="",previousx=0,currentx=0,currenty=0,boundLeft=scrubPath.node().getBBox().x,boundRight=0,p1=[],p2=[];scaleSvg(),transitionGraph()}scope.$on("initGraph",initGraph);var particleCount=0}}}switcherGraph.$inject=["$window","$rootScope","viewport","utils","$interval","$timeout"],angular.module("marketingCore").directive("switcherGraph",switcherGraph)}(angular),function(angular,lodash){"use strict";function responseTransformServiceMiniPLPFn(jsonPath,$log,globalValue,aemRoutingService,dcpProductUtil,toggleService,globalAssetRepositoryConstants,cartConstants){function getGARImagePath(imgPath){var imagePath1=imgPath;return toggleService.model.toggles.enableGar&&(imagePath1=angular.isDefined(imagePath1)&&!angular.equals(imagePath1,"")?globalAssetRepositoryConstants.url+imagePath1:""),imagePath1}function getAEMData(){service.aemValues||aemRoutingService.loadRoutingStates().then(function(resp){service.aemValues=resp,angular.forEach(resp,function(val,key){val.data&&val.data.defaultsku&&service.aemDefaultSku.push(val)})})}function getCreditClassProdPriceMap(skuPrice){var creditClass=[],dataToPush={};return _.isEmpty(skuPrice)||angular.forEach(skuPrice,function(priceData){if(!_.isEmpty(priceData)){var pricingDataToPush={},creditClassName=epToAppMapping[dcpProductUtil.getCreditName(priceData.pricingOptionName)];_.isEmpty(creditClassName)||(pricingDataToPush.creditLevel=dcpProductUtil.getCreditName(priceData.pricingOptionName),pricingDataToPush.Upfront=dcpProductUtil.getCCPayNowAmount(priceData),pricingDataToPush.Monthly=_.get(priceData,"skuPrice.priceSummary.monthlyPrice.salePrice.display",""),pricingDataToPush.TermMonth=_.get(priceData,"skuPrice.priceSummary.monthlyPrice.salePrice.contractTerm",""),pricingDataToPush.DiscountedPrice=dcpProductUtil.getCCDiscountAmount(priceData),dataToPush[creditClassName]=pricingDataToPush)}}),creditClass.push(dataToPush),creditClass}function getTransformedDeviceV2APIResponse(response,isMainPlp){$log.log("Device Mini PLP Response :",service.aemDefaultSku,response);var deviceMiniplpResponse=[],override=_.get(globalValue,"authorValue.rootPage.overrideInvStatus.invStatusDetails",[]);return override=lodash.isArray(override)?override:[override],response&&response.data&&response.data.products&&0!==response.data.products.length&&(angular.forEach(response.data.products,function(product){var prefIndex=1,chkBoolForPrefIndAuthor=!1,productData={};productData.Family=product.familyName,productData.offerId=product.familyCode,productData.productFamilyId=product.familyCode,productData.ProductName=product.familyName,productData.productSubtype=product.subType,productData.productName=product.familyName,productData.reviews={aggregateRating:product.averageStarRating,noOfReviews:product.ratingsCount};var productsWithPricesAndMemory=[];if(angular.forEach(product.skus,function(sku,index){var dataToPush=updateSkuInformation(sku,!0);if(toggleService.model.toggles.mainPLPV2&&isMainPlp){dataToPush.thumbNail=getGARImagePath(sku.thumbNail),dataToPush.badges=getBadgeInformation(dataToPush);var offerData=getOfferInformation(sku.skuPrices);lodash.isEmpty(offerData)||(dataToPush.offerTitle=offerData.promoName,dataToPush.offerDescription=offerData.promoDescription),dataToPush.pricing=getPricingInfo(dataToPush,epToAppMapping.GOOD,!1,cartConstants.DEVICE_TYPE.ACCESSORY)}productsWithPricesAndMemory.push(dataToPush)}),toggleService.model.toggles.mainPLPV2&&isMainPlp){productData.skus=productsWithPricesAndMemory;var colorArray=setupColorSwatches(product);lodash.isEmpty(colorArray)||(productData.colors=colorArray)}service.aemDefaultSku.forEach(function(aemSku,index){productsWithPricesAndMemory.forEach(function(productDetails,prodIndex){productDetails.skuCode===aemSku.data.defaultsku&&(prefIndex=prodIndex,chkBoolForPrefIndAuthor=!0)})}),(!chkBoolForPrefIndAuthor||angular.isUndefined(productsWithPricesAndMemory[prefIndex]))&&(prefIndex=0),toggleService.model.toggles.mainPLPV2&&isMainPlp&&!lodash.isEmpty(productsWithPricesAndMemory)&&(prefIndex=getPreferredIndex(productsWithPricesAndMemory)),0>prefIndex&&(prefIndex=0),productsWithPricesAndMemory.length>0&&(productData.sku=productsWithPricesAndMemory[prefIndex].skuCode,productData.FrontImage=getGARImagePath(productsWithPricesAndMemory[prefIndex].thumbNail),productData.bogoSku=productsWithPricesAndMemory[prefIndex].bogoSku,productData.onSaleSku=productsWithPricesAndMemory[prefIndex].onSaleSku,productData.specialOfferSku=productsWithPricesAndMemory[prefIndex].specialOfferSku,productData.webOnlySku=productsWithPricesAndMemory[prefIndex].webOnlySku,productData.hotItemSku=productsWithPricesAndMemory[prefIndex].hotItemSku,productData.availabilityRule=productsWithPricesAndMemory[prefIndex].availabilityRule,lodash.forEach(override,function(item){angular.isString(item)&&(item=angular.fromJson(item)),productData.sku==item.sku&&item.status&&(productData.availabilityRule=item.status)}),productData.priceTypeAvailableEIP=productsWithPricesAndMemory[prefIndex].itemEipPriceAvailable,productData.skuPricing=productsWithPricesAndMemory[prefIndex].skuPricing,productData.offer=productsWithPricesAndMemory[prefIndex].offers[0],productData.CreditClass=getCreditClassProdPriceMap(productsWithPricesAndMemory[prefIndex].skuPrice),deviceMiniplpResponse.push(productData))}),$log.log("mini PLP Transformed Response  :",deviceMiniplpResponse)),deviceMiniplpResponse}function getTransformedAccesoryV2APIResponse(response,selectedCreditClass,isMainPlp){$log.log("Accessory Mini PLP Response :",selectedCreditClass,response);var eipSelected=angular.equals(selectedCreditClass,"creditClass1")||angular.equals(selectedCreditClass,"creditClass2"),accessoryMiniplpResponse=[];return response&&0!==response.length?(angular.forEach(response,function(product){var prefIndex=0,productData={},uiPrice={};productData.Family=product.familyName,productData.offerId=product.familyCode,productData.productName=product.familyName,productData.productSubtype=product.subType,productData.reviews={aggregateRating:product.averageStarRating,noOfReviews:product.ratingsCount};var accessoryProdWithPrice=[];if(angular.forEach(product.skus,function(sku,index){var dataToPush=updateSkuInformation(sku);if(toggleService.model.toggles.mainPLPV2&&isMainPlp){dataToPush.thumbNail=getGARImagePath(sku.thumbNail),dataToPush.badges=getBadgeInformation(dataToPush);var offerData=getOfferInformation(sku.skuPrices);lodash.isEmpty(offerData)||(dataToPush.offerTitle=offerData.promoName,dataToPush.offerDescription=offerData.promoDescription),dataToPush.pricing=getPricingInfo(dataToPush,selectedCreditClass,eipSelected,cartConstants.DEVICE_TYPE.ACCESSORY)}accessoryProdWithPrice.push(dataToPush)}),toggleService.model.toggles.mainPLPV2&&isMainPlp){productData.skus=accessoryProdWithPrice;var colorArray=setupColorSwatches(product);lodash.isEmpty(colorArray)||(productData.colors=colorArray)}accessoryProdWithPrice.length>0&&(productData.sku=accessoryProdWithPrice[prefIndex].skuCode,productData.thumbNail=getGARImagePath(accessoryProdWithPrice[prefIndex].thumbNail),productData.bogoSku=accessoryProdWithPrice[prefIndex].bogoSku,productData.onSaleSku=accessoryProdWithPrice[prefIndex].onSaleSku,productData.specialOfferSku=accessoryProdWithPrice[prefIndex].specialOfferSku,productData.webOnlySku=accessoryProdWithPrice[prefIndex].webOnlySku,productData.availabilityRule=accessoryProdWithPrice[prefIndex].availabilityRule,productData.priceTypeAvailableEIP=accessoryProdWithPrice[prefIndex].itemEipPriceAvailable,productData.skuPricing=accessoryProdWithPrice[prefIndex].skuPricing,productData.offer=accessoryProdWithPrice[prefIndex].offers[0],productData.CreditClass=getCreditClassProdPriceMap(accessoryProdWithPrice[prefIndex].skuPrice),productData.isNewSku=accessoryProdWithPrice[prefIndex].isNewSku,productData.hotItemSku=accessoryProdWithPrice[prefIndex].hotItemSku,productData.listPriceSku=accessoryProdWithPrice[prefIndex].frpFullPrice,uiPrice.FRP=accessoryProdWithPrice[prefIndex].frpFullPrice,uiPrice.FSP=accessoryProdWithPrice[prefIndex].frpPurchasePrice),angular.isDefined(accessoryProdWithPrice[prefIndex].offers[0])&&(productData.skuOfferDescription=accessoryProdWithPrice[prefIndex].offers[0].description,productData.skuOfferDisplayName=accessoryProdWithPrice[prefIndex].offers[0].name),angular.isDefined(selectedCreditClass)&&angular.isDefined(productData.CreditClass[0][selectedCreditClass])&&eipSelected?(uiPrice.todayPrice=productData.CreditClass[0][selectedCreditClass].Upfront,uiPrice.monthlyPrice=productData.CreditClass[0][selectedCreditClass].Monthly,uiPrice.termMonth=productData.CreditClass[0][selectedCreditClass].TermMonth):productData.priceTypeAvailableEIP=!1,productData.uiPrice=uiPrice,accessoryMiniplpResponse.push(productData)}),$log.log("Accessory mini PLP Transformed Response  :",accessoryMiniplpResponse),accessoryMiniplpResponse):void 0}function updateSkuInformation(sku,isDevice){var dataToPush={};return dataToPush.skuCode=sku.skuCode,dataToPush.frpFullPrice=dcpProductUtil.getFullPrice(sku.skuPrices),dataToPush.frpPurchasePrice=dcpProductUtil.getPurchasePrice(sku.skuPrices),dataToPush.thumbNail=dcpProductUtil.getSkuImage(sku.images,"ThumbNail"),dataToPush.bogoSku=dcpProductUtil.getBadgesAndPromotions(sku.badgesAndPromotions,"BOGO"),dataToPush.onSaleSku=dcpProductUtil.getBadgesAndPromotions(sku.badgesAndPromotions,"ON SALE"),dataToPush.specialOfferSku=dcpProductUtil.getBadgesAndPromotions(sku.badgesAndPromotions,"SPECIAL OFFER"),dataToPush.webOnlySku=dcpProductUtil.getBadgesAndPromotions(sku.badgesAndPromotions,"WEB ONLY"),isDevice?(dataToPush.hotItemSku=dcpProductUtil.getBadgesAndPromotions(sku.badgesAndPromotions,"HOT ITEM"),dataToPush.itemEipPriceAvailable=dcpProductUtil.getItemEipPriceAvailable(sku.skuPrices)):(dataToPush.isNewSku=dcpProductUtil.getBadgesAndPromotions(sku.badgesAndPromotions,"NEW!"),dataToPush.hotItemSku=dcpProductUtil.getBadgesAndPromotions(sku.badgesAndPromotions,"HOT ITEM"),dataToPush.itemEipPriceAvailable=dcpProductUtil.getItemEipPriceAvailableFlag(sku.skuPrices)),dataToPush.availabilityRule=dcpProductUtil.getInvStatus(sku.availability),dataToPush.skuPricing=dcpProductUtil.getPricingData(sku.skuPrices),dataToPush.skuPrice=sku.skuPrices,dataToPush.colorName=sku.color,dataToPush.offers=dcpProductUtil.getOfferData(sku.skuPrices),dataToPush.isDefaultSku=sku.isDefaultSku,dataToPush.memory=sku.memory,dataToPush}function getBadgeInformation(skuInfo){var productBadges=[],globalAuthoring=lodash.get(globalValue,"authorValue.rootPage.globalAuthoring",{});return lodash.isEmpty(globalAuthoring)||("true"===skuInfo.isNewSku?productBadges.push({"new":!0,authorText:globalAuthoring.newtxt}):"true"===skuInfo.hotItemSku?productBadges.push({
hotitem:!0,authorText:globalAuthoring.hotitemtxt}):"true"===skuInfo.webOnlySku?productBadges.push({webonly:!0,authorText:globalAuthoring.webonlytxt}):"true"===skuInfo.specialOfferSku?productBadges.push({specialoffer:!0,authorText:globalAuthoring.specialtxt}):"true"===skuInfo.onSaleSku?productBadges.push({onsale:!0,authorText:globalAuthoring.onsaletxt}):"true"===skuInfo.bogoSku&&productBadges.push({bogo:!0,authorText:globalAuthoring.bogotxt})),productBadges}function getOfferInformation(skuPriceArray){var offerObject={};return lodash.isEmpty(skuPriceArray)||skuPriceArray.forEach(function(skuPriceObject){skuPriceObject.skuPrice&&skuPriceObject.skuPrice.promotions&&skuPriceObject.skuPrice.promotions.length&&(offerObject={promoName:skuPriceObject.skuPrice.promotions[0].promoName,promoDescription:skuPriceObject.skuPrice.promotions[0].longDescription})}),offerObject}function getPricingInfo(updatedSkuData,selectedCreditClass,eipSelected,categoryType){var pricing={},goodPricing={},averagePricing={},fullretailPricing={},deviceAuthoring=lodash.get(globalValue,"authorValue.rootPage.deviceBrowse",{}),priceTypeAvailableForEIP=getEipEligibility(updatedSkuData.skuPrice),priceData=getCreditClassProdPriceMap(updatedSkuData.skuPrice),showEIPSKUPricingforGoodCredit="true"===dcpProductUtil.isEIPPricingDisplayEligible(categoryType,deviceAuthoring.enableeipaccessories,toggleService.model.toggles.NonEipToggle,priceTypeAvailableForEIP.good).toString(),showEIPSKUPRicingforAverageCredit="true"===dcpProductUtil.isEIPPricingDisplayEligible(categoryType,deviceAuthoring.enableeipaccessories,toggleService.model.toggles.NonEipToggle,priceTypeAvailableForEIP.average).toString();return goodPricing.fullPrice=averagePricing.fullPrice=fullretailPricing.fullPrice=updatedSkuData.frpFullPrice,goodPricing.purchasePrice=averagePricing.purchasePrice=fullretailPricing.purchasePrice=updatedSkuData.frpPurchasePrice,lodash.isEmpty(priceData)||lodash.isEmpty(priceData[0][selectedCreditClass])||(showEIPSKUPricingforGoodCredit&&(goodPricing.today=priceData[0][epToAppMapping.GOOD].Upfront,goodPricing.monthly=priceData[0][epToAppMapping.GOOD].Monthly,goodPricing.contractTermGcs=priceData[0][epToAppMapping.GOOD].TermMonth),showEIPSKUPRicingforAverageCredit&&(averagePricing.today=priceData[0][epToAppMapping.BUILDING].Upfront,averagePricing.monthly=priceData[0][epToAppMapping.BUILDING].Monthly,averagePricing.contractTermBcs=priceData[0][epToAppMapping.BUILDING].TermMonth)),pricing.good=goodPricing,pricing.average=averagePricing,pricing.nocredit=fullretailPricing,pricing}function setupColorSwatches(product){var imagePath,defaultSkuObject,colors=[];return product.colorOptions&&product.colorOptions.length?product.colorOptions.forEach(function(swatch){if(product.skus&&product.skus.length){var selectedSkuArray=product.skus.filter(function(sku){return swatch.name.toLowerCase()===(sku.color&&sku.color.toLowerCase())});lodash.isEmpty(selectedSkuArray)?(imagePath=getFrontImageUrl(product.skus[0].images),colors.push({isDefault:!0,defaultSKU:product.defaultSku,imageURL:imagePath})):(imagePath=getFrontImageUrl(selectedSkuArray[0].images),defaultSkuObject=getDefaultSkuObject(selectedSkuArray,product.type),colors.push({name:swatch.name,colorSwatchURL:getGARImagePath(swatch.imagePath),defaultSKU:defaultSkuObject.skuCode,isDefault:defaultSkuObject.isDefaultSku,imageURL:imagePath}))}}):product.skus&&product.skus.length&&(imagePath=getFrontImageUrl(product.skus[0].images),colors.push({isDefault:!0,defaultSKU:product.defaultSku,imageURL:imagePath})),colors}function getEipEligibility(skuPrices){return{good:lodash.filter(skuPrices,{pricingOptionName:"CRP8"},[]).length>0,average:lodash.filter(skuPrices,{pricingOptionName:"CRP8"},[]).length>0}}function getFrontImageUrl(images){var imagePath="",imageArray=lodash.filter(images,{imgtype:"FrontImage"});return imageArray.length&&(imagePath=imageArray[0].url),getGARImagePath(imagePath)}function getDefaultSkuObject(skusArray,productType){var defaultDcpSku=lodash.find(skusArray,function(sku){return sku.isDefaultSku===!0});return lodash.isEmpty(defaultDcpSku)&&"accessory"!==productType.toLowerCase()?getLowestMemoryVariant(skusArray):lodash.isEmpty(defaultDcpSku)&&"accessory"===productType.toLowerCase()?skusArray[0]:defaultDcpSku}function getLowestMemoryVariant(skusArray){return _.minBy(skusArray,function(sku){return _.parseInt(sku.memory)})}function getPreferredIndex(skusArray){return lodash.findIndex(skusArray,function(sku){return sku.isDefaultSku===!0})}var service=this,epToAppMapping={GOOD:"creditClass1",BUILDING:"creditClass2",NONE:"creditClass3"};return getAEMData(),service.aemValues=null,service.aemDefaultSku=[],service.getAEMData=getAEMData,service.getTransformedDeviceV2APIResponse=getTransformedDeviceV2APIResponse,service.getTransformedAccesoryV2APIResponse=getTransformedAccesoryV2APIResponse,service.getCreditClassProdPriceMap=getCreditClassProdPriceMap,service.getBadgeInformation=getBadgeInformation,service.getOfferInformation=getOfferInformation,service.getPricingInfo=getPricingInfo,service.setupColorSwatches=setupColorSwatches,service.getFrontImageUrl=getFrontImageUrl,service.getLowestMemoryVariant=getLowestMemoryVariant,service}responseTransformServiceMiniPLPFn.$inject=["jsonPath","$log","globalValue","aemRoutingService","dcpProductUtil","toggleService","globalAssetRepositoryConstants","cartConstants"],angular.module("tmobileCore").service("responseTransformServiceDCPV2",responseTransformServiceMiniPLPFn)}(window.angular,window._),function(angular){"use strict";function switcherTeaser(utils,analyticsUtils){return{restrict:"A",link:function(scope,element,attr){function cleanup(){}scope.$on("$destroy",cleanup)}}}switcherTeaser.$inject=["utils","analyticsUtils"],angular.module("marketingCore").directive("switcherTeaser",switcherTeaser)}(angular),function(angular,lodash){"use strict";function preConfiguredCartModalControllerFunction($log,$scope,$location,globalConfig,$stateParams,$state,extantCartService,authTokenManager,commonServices,cartCommonOperationsService,cartStorage,creditClassService,tmobNotificationService,httpRequest,CART_STATE_NAME,globalValue,productDetailsService,cartHttpDataService){function handlePreConfiguredCartOpenEvent(){var loadCartId=vm.preConfiguredCartId,cartId=cartStorage.getCartId();vm.cartId=cartId,vm.loadCartId=loadCartId,vm.displayModal=!1,""!=loadCartId&&0==vm.cartExist?(sessionStorage.setItem("preConfiguredModalDisplayed",!0),commonServices.$window.location.href="/cart/SC?id="+vm.loadCartId):vm.displayModal=!0}function showZipCodeModalPopup(){var loadCartId=vm.preConfiguredCartId,loadCartIdNonNy=vm.preConfiguredCartIdNonNy,cartId=cartStorage.getCartId();vm.cartId=cartId,vm.loadCartId=loadCartId,vm.loadCartIdNonNy=loadCartIdNonNy,vm.displayModal=!0}var vm=this;if(globalValue.authorValue&&globalValue.authorValue.rootPage)vm.authorValue=globalValue.authorValue.rootPage;else{var authorUrl=$location.url();productDetailsService.getAuthorData(authorUrl).then(function(){vm.authorValue=productDetailsService.model.authorValue.rootPage})}vm.cartExist=!1,cartHttpDataService.getCart().then(function(cartResponse){$log.log(cartResponse),(cartResponse.lineItems.length>0||cartResponse.accessories.accessoryDetails.length>0)&&(vm.cartExist=!0)}),vm.handlePreConfiguredCartOpenEvent=handlePreConfiguredCartOpenEvent,vm.showZipCodeModalPopup=showZipCodeModalPopup}var controllerName="preConfiguredCartModalController";angular.module("tmobileApp").controller(controllerName,preConfiguredCartModalControllerFunction)}(angular),function(angular){"use strict";function richTable($window){return{restrict:"A",scope:!0,link:function(scope,element){function toggleShadow(){table[0].clientWidth>tableContainer[0].clientWidth?angular.element(tableContainer[0]).addClass("table--shadow"):angular.element(tableContainer[0]).removeClass("table--shadow")}var container=angular.element(element),tableContainer=angular.element(container.find(".table__container")[0]),table=angular.element(container.find("table")[0]);toggleShadow(),angular.element($window).bind("resize",function(){toggleShadow(),scope.$digest()})}}}richTable.$inject=["$window"],angular.module("marketingCore").directive("richTable",richTable)}(angular),function(angular){"use strict";function timelineCarousel(utils,$compile,analyticsUtils,$window){return{restrict:"A",link:function(scope,element,attr){function onAfterChange(e,slick,currentSlide){var currentTimeline=element[0].querySelector(".slick-track").childNodes[currentSlide],parentTimeline=currentTimeline.parentNode,activeTimeline=parentTimeline.querySelector(".active"),activeBackground=element[0].querySelector(".carousel-background").querySelector(".active-bg"),nodes=Array.prototype.slice.call(parentTimeline.children),activeTimelineIndex=nodes.indexOf(activeTimeline),currentTimelineIndex=nodes.indexOf(currentTimeline),slot=nodes.indexOf(currentTimeline)+1;(utils.isTouch()&&$window.window.innerWidth<1025||$window.innerWidth<641)&&(activeTimeline.className=activeTimeline.className.replace(reg," "),currentTimeline.className+=" active",activeBackground.className=activeBackground.className.replace(reg1," "),element[0].querySelector(".carousel-background").childNodes[2*currentSlide+1].className+=" active-bg"),utils.isTouch()&&$window.window.innerWidth<1025&&(currentTimelineIndex>activeTimelineIndex?analyticsUtils.trackCarousel(!0,element,slot,currentTimeline):activeTimelineIndex>currentTimelineIndex&&analyticsUtils.trackCarousel(!1,element,slot,currentTimeline))}function cleanup(){scope.slickConfigForegroundCarousel&&scope.slickConfigForegroundCarousel.method.unslick()}var reg=new RegExp("(\\s|^)active(\\s|$)"),reg1=new RegExp("(\\s|^)active-bg(\\s|$)");scope.onclick_showForegroundImg=function($event){var currentTimeline=$event.currentTarget,parentTimeline=currentTimeline.parentNode,activeTimeline=parentTimeline.querySelector(".active"),nodes=Array.prototype.slice.call(parentTimeline.children),activeTimelineIndex=nodes.indexOf(activeTimeline),currentTimelineIndex=nodes.indexOf(currentTimeline),slot=nodes.indexOf(currentTimeline)+1;"tmo-modal-link"===$event.target.className&&analyticsUtils.trackCarouselModalLink(element,$event.target,slot,currentTimeline),activeTimeline.className=activeTimeline.className.replace(reg," "),currentTimeline.className+=" active";var currentIndex=parseInt(currentTimeline.getAttribute("data-slick-index"),10),left=currentTimeline.getBoundingClientRect().left,right=$window.window.innerWidth-left;$window.window.innerWidth>=1024&&(currentIndex>3&&left>=right&&scope.slickConfigForegroundCarousel.method.slickNext(),0>left&&scope.slickConfigForegroundCarousel.method.slickPrev(),currentTimelineIndex>activeTimelineIndex?analyticsUtils.trackCarousel(!0,element,slot,currentTimeline):activeTimelineIndex>currentTimelineIndex&&analyticsUtils.trackCarousel(!1,element,slot,currentTimeline));var activeBackground=element[0].querySelector(".carousel-background").querySelector(".active-bg");activeBackground.className=activeBackground.className.replace(reg1," "),element[0].querySelector(".carousel-background").childNodes[2*currentIndex+1].className+=" active-bg"},scope.slickConfigForegroundCarousel&&(scope.slickConfigForegroundCarousel.event.afterChange=onAfterChange),scope.$on("$destroy",cleanup)}}}timelineCarousel.$inject=["utils","$compile","analyticsUtils","$window"],angular.module("marketingCore").directive("timelineCarousel",timelineCarousel)}(angular),function(angular){"use strict";function globalCartServiceConstructor($rootScope,$log,httpRequestWrapper,globalConfig,globalValue,$q,apiService,apiURLs,tokenTtl,authorization,authTokenManager,cartHttpDataService,checkOutHttpDataUtil,cartStorage,creditClassService,transformCart){function generateAccessToken(){return authorization.generateToken().then(function(accessTokenResponse){return angular.equals(accessTokenResponse.status,200)&&($rootScope.cookiesExpiresIn=moment().add(accessTokenResponse.data.expires_in,"seconds").toDate(),authTokenManager.setTokenCookies(accessTokenResponse.data,"token",angular.equals(apiURLs.storage,"localStorage"),tokenTtl.token.timetolive)),accessTokenResponse})}function createDefaultCart(){var token=authTokenManager.getTokenCookies();if(token){var responsestatus={status:"success"};return defer.resolve(responsestatus),defer.promise}return generateAccessToken().then(function(accessTokenResponse){if(angular.equals(accessTokenResponse.status,200)){var urlObject=apiService.getURL("getDefaultCart"),apiURL=urlObject.url,query={creditLevel:creditClassService.getEPCreditClass()||"GOOD"};return httpRequestWrapper.get(apiURL,query,null,!0,"getDefaultCart")}return accessTokenResponse})}function addLineToCart(lineType){lineType||(lineType="HANDSET");var requestBody,itemCode;return itemCode=globalConfig.cartSettings.constants.mockSKUs.addNewLine,requestBody={itemCode:itemCode,selectedCreditLevel:creditClassService.getEPCreditClass()||"GOOD",financeOption:"",subType:lineType},cartHttpDataService.addNewLine(requestBody).then(function(cartResponse){return cartResponse.status})}function addProductToLine(lineType,sku){var GCAResponse={};return createDefaultCart().then(function(defaultCartResponse){return angular.equals(defaultCartResponse.status,200)?(cartStorage.setCartId(defaultCartResponse.data.cart.cartId),cartStorage.setOrderId(defaultCartResponse.data.cart.orderId),checkOutHttpDataUtil.createAuditRecords(!0,!1).then(function(auditRecordsResponse){return angular.equals(auditRecordsResponse.status,200)?addLineToCart(lineType).then(function(cartResponseStatus){if(angular.equals(cartResponseStatus,200)){var requestBody={sku:sku,pricingOption:""},selectedLine=cartStorage.getGlobalSmartCartInfo().lineItems[0];return cartHttpDataService.addToLine(requestBody,selectedLine.lineId).then(function(cartResponse){return GCAResponse={status:cartResponse.status,message:"Line added successfully to cart",code:"GCA0001",data:cartResponse.data},defer.resolve(GCAResponse),defer.promise})}return GCAResponse={status:cartResponseStatus,message:"Error adding line to cart",code:"GCA0002",data:""},defer.reject(GCAResponse),defer.promise}):(GCAResponse={status:auditRecordsResponse.status,message:"Error in the audit-records call",code:"GCA0003",data:auditRecordsResponse.data},defer.reject(GCAResponse),defer.promise)})):angular.equals(defaultCartResponse.status,"success")?addLineToCart(lineType).then(function(cartResponseStatus){if(angular.equals(cartResponseStatus,200)){var requestBody={sku:sku,pricingOption:""},cartLength=cartStorage.getGlobalSmartCartInfo().lineItems.length,selectedLine=cartStorage.getGlobalSmartCartInfo().lineItems[cartLength-1];return cartHttpDataService.addToLine(requestBody,selectedLine.lineId).then(function(cartResponse){return GCAResponse={status:cartResponse.status,message:"Line added successfully to cart",code:"GCA0001",data:cartResponse.data},defer.resolve(GCAResponse),defer.promise})}return GCAResponse={status:cartResponseStatus,message:" Error adding line to cart",code:"GCA0002",data:""},defer.reject(GCAResponse),defer.promise}):(GCAResponse={status:defaultCartResponse.status,message:" Error in the create default cart call",code:"GCA0004",data:defaultCartResponse.data},defer.reject(GCAResponse),defer.promise)})}function globalAddToCart(deviceData){var creditSelector,creditClass,creditClassObject,deviceLimitResponse;return"ACCESSORY"===deviceData.deviceType?(deviceData.creditLevel=encodeURI(angular.isDefined(creditClassService.getEPCreditClass())?creditClassService.getEPCreditClass():"GOOD"),deviceData.cartParams={sku:deviceData.deviceSku,quantity:deviceData.quantity,pricingOption:deviceData.pricingOption},cartHttpDataService.addAccessoryToCart(deviceData).then(function(selectedCart){return processCartOperationSuccessResponse(selectedCart,"addAccessoryToCart")})):(angular.isDefined(deviceData.deviceCredit)?(creditSelector=globalValue.authorValue.rootPage.creditClassSelector["class"],creditClass=vm.epToAppMapping[deviceData.deviceCredit],creditClassObject=_.find(creditSelector,{"class":creditClass}),creditClassService.setCreditClass(creditClassObject)):(creditClassObject=creditClassService.getCreditClass(),creditClass=creditClassObject["class"],angular.isUndefined(creditClass)&&(creditClass="creditClass1")),deviceLimitResponse=deviceLimitReached(deviceData.deviceType,creditClass),"ECA0004"===deviceLimitResponse.code?addProductToLine(deviceData.deviceType,deviceData.deviceSku):(defer.reject(deviceLimitResponse),defer.promise))}function processCartOperationSuccessResponse(selectedCart,apiKey){var accessoryResponse={};if(null!==selectedCart.data&&_.isEmpty(selectedCart.data.errors)){var transformCartFactory=transformCart.getFactory(apiKey),selectedAccessoryFromBrowse=transformCartFactory.transformCartData(selectedCart.data);return cartStorage.setGlobalSmartCartInfo(selectedAccessoryFromBrowse),accessoryResponse={code:"AAC0001",message:"Accessory Added Successfully",data:""},defer.resolve(accessoryResponse),defer.promise}return accessoryResponse={code:"AAC0002",message:"Error in adding Accessory",data:""},defer.reject(accessoryResponse),defer.promise}function deviceLimitReached(lineType,creditClass){var deviceResponse={},cartData=cartStorage.getGlobalSmartCartInfo(),totalCount=cartData.lineItems.length,handSetCount=0,tabletCount=0;return angular.forEach(cartData.lineItems,function(lineItem,index){"TABLET"===lineItem.lineType?tabletCount++:"HANDSET"===lineItem.lineType&&handSetCount++}),deviceResponse=globalConfig.cartSettings.maxLineLimit[creditClass].maxTotalLine===totalCount?{message:" Maximum Cart limit reached...",code:"ECA0001"}:globalConfig.cartSettings.maxLineLimit[creditClass].maxHandsetLine===handSetCount&&"HANDSET"===lineType?{message:" Maximum Handset limit reached...",code:"ECA0002"}:globalConfig.cartSettings.maxLineLimit[creditClass].maxTabletLine===tabletCount&&"TABLET"===lineType?{message:" Maximum Tablet limit reached...",code:"ECA0003"}:{message:"Device can be added",code:"ECA0004"}}var defer=$q.defer(),vm=this;return vm.epToAppMapping=globalConfig.cartSettings.epToAppMapping,vm.addProductToLine=addProductToLine,vm.globalAddToCart=globalAddToCart,vm.deviceLimitReached=deviceLimitReached,vm}globalCartServiceConstructor.$inject=["$rootScope","$log","httpRequestWrapper","globalConfig","globalValue","$q","apiService","apiURLs","tokenTtl","authorization","authTokenManager","cartHttpDataService","checkOutHttpDataUtil","cartStorage","creditClassService","transformCart"],angular.module("tmobileApp").service("globalCartService",globalCartServiceConstructor)}(angular),function(angular,lodash){"use strict";function tmoBlasterGame($window,$timeout,utils,analyticsUtils){return{restrict:"A",link:function(scope,element,attr){function modalOpen(){gameOverHasFired=!1,fromModalClose=!1,$window.addEventListener("resize",lodash.throttle(mobileResize,100)),element[0].addEventListener("touchmove",disablePinchZoom),element[0].addEventListener("blasterGameOver",setUpGameOver)}function modalClosed(){gameOverHasFired||(fromModalClose=!0,$window.myTmoGame.closeGame()),$window.addEventListener("resize",mobileResize),element[0].removeEventListener("touchmove",disablePinchZoom),element[0].removeEventListener("blasterGameOver",setUpGameOver)}function setUpGameOver(e){gameOverHasFired=!0,blasterScore=e.detail.blasterScore,blasterTime=e.detail.blasterTime,blasterShots=e.detail.blasterShots,blasterLevel=e.detail.blasterLevel,canvasContainer=element[0].querySelector(".canvas-container"),gameOverContainer=element[0].querySelector(".game-over-container"),displayFinalScore=element[0].querySelector(".player-score"),fromModalClose||(canvasContainer.classList.add("ng-hide"),gameOverContainer.classList.remove("ng-hide"),displayFinalScore.innerHTML=blasterScore),trackBlasterEnd(blasterTime,blasterLevel,blasterShots,blasterScore)}function trackBlasterEnd(time,level,shots,score){var evt={eventInfo:{eventAction:"click",eventType:"clickToAction"},category:{eventCategory:"game_scrn_click"},attributes:{dynamicContent:time+":"+level+":"+shots+":"+score},eventDescription:{dataAnalyticsID:gameAnalyticsId,screen:fromModalClose?"screen4":"screen5",modalName:"Vertical Shmup Game",ctaName:fromModalClose?"Close":"Game over"},tool:{stage:"complete",name:"Vertical Shmup"}};analyticsUtils.trackEvent("CLICK_EVENT",gameAnalyticsId,evt)}function updateCanvasPosition(){blasterContainer=element[0],gameContainer=blasterContainer.querySelector(".tmo-blaster-wrapper"),blasterContainer.clientHeight<=622?gameContainer.classList.add("tmo-game-short-view"):gameContainer.classList.remove("tmo-game-short-view")}function disablePinchZoom(e){e.preventDefault()}function mobileResize(e){updateCanvasPosition()}var modal=utils.getClosest(element[0],".modal");scope.$on("modalOpen",modalOpen),scope.$on("modalClosed",modalClosed),$timeout(function(){modal.classList.add("tmo-blaster-modal"),modal.style.top=0,utils.isTouch()&&(modal.style.top=0,modal.style.height="100%"),updateCanvasPosition()},100);var blasterContainer,gameContainer,gameOverHasFired,canvasContainer,gameOverContainer,displayFinalScore,blasterScore,blasterTime,blasterShots,blasterLevel,fromModalClose,gameAnalyticsId=element[0].getAttribute("data-analytics-id");return scope.modalOpen=modalOpen,scope.modalClosed=modalClosed,scope.disablePinchZoom=disablePinchZoom,scope.setUpGameOver=setUpGameOver,scope.updateCanvasPosition=updateCanvasPosition,scope.mobileResize=mobileResize,!0}}}tmoBlasterGame.$inject=["$window","$timeout","utils","analyticsUtils"],angular.module("marketingCore").directive("tmoBlasterGame",tmoBlasterGame)}(angular,_),function(angular,lodash){"use strict";function finalizeInStoreThankYouControllerFunction($modalInstance,$state,$modal,globalValue,orderInStoreData,pdlService,pdlConstant,cartCommonOperationsService,utils,toggleService,storeLocatorModelService,D2RModelManager,storeLocatorUtil,storeLocatorConstants,commonServices,invocaScriptService){function cancel(){$modalInstance.dismiss()}function goToStoreLocator(){$modalInstance.dismiss();var ispfcart=cartCommonOperationsService.model.ispfcart;ispfcart?(cartCommonOperationsService.model.ispfcart=!1,utils.loadScript("//maps.googleapis.com/maps/api/js?libraries=visualization,places&client=gme-tmobileusa3&channel=smartcart&v=3.26",redirectToSL)):redirectToSL()}function redirectToSL(){orderInStoreData.zipCode?$state.go("store-locator",{search:orderInStoreData.zipCode}):$state.go("store-locator")}function getLocation(){return storeLocatorUtil.getUserLocation().then(function(data){vm.location=data},function(){$log.error("abort promise getLocation")})}function getStores(){return storeLocatorUtil.getStoreList(vm.location,storeModel.start,storeModel.d2rResultsCount,storeModel.miles,!0).then(function(storeResults){var getStoreData=(d2rModelManager.setStores(storeResults.data),d2rModelManager.getSelectedStore());vm.selectedStoreVal=getStoreData.name+"("+getStoreData.id+")"},function(){$log.error("abort promise getStores")})}function openStoreLocatorModal(isAppointment){isAppointment?(storeModel.onStoreLocatorModal=!0,storeModel.sectionToDisplay=storeLocatorConstants.SECTIONS.APPOINTMENT_FORM):storeModel.sectionToDisplay=storeLocatorConstants.SECTIONS.SEARCH_RESULTS,storeModel.d2rModelManager=d2rModelManager,$modal.open({windowClass:"store-locator-d2r-modal",controller:"storeLocatorModalController",templateUrl:"app/core/components/digitalToRetail/components/storeLocator/storeLocatorModal.tpl.html",controllerAs:"vm"}).result.then(getSelectedStore)}function openAppointmentFlow(){openStoreLocatorModal(!0),storeLocatorModelService.showOperationSection(storeLocatorConstants.PAGES.ISA,!0)}function getSelectedStore(){return vm.selectedStore=storeModel.store=d2rModelManager.getSelectedStore(),vm.selectedStore}function invocaRun(){invocaScriptService.runPnapi()}function init(){var getStoreData={};if(lodash.isEqual(cartCommonOperationsService.model.storeLocatorFlag,!0))getStoreData=angular.isObject(cartCommonOperationsService.model.storeLocationData)?cartCommonOperationsService.model.storeLocationData:angular.fromJson(cartCommonOperationsService.model.storeLocationData),vm.selectedStoreVal=getStoreData.name+" ("+getStoreData.id+")";else if(lodash.isNil(sessionStorage.getItem("selectedStore")))getLocation().then(getStores);else{var selectedStoreData=sessionStorage.getItem("selectedStore");getStoreData=angular.isObject(selectedStoreData)?selectedStoreData:angular.fromJson(selectedStoreData),vm.selectedStoreVal=getStoreData.name+" ("+getStoreData.id+")"}}var vm=this,$log=commonServices.$log;vm.cancel=cancel,vm.goToStoreLocator=goToStoreLocator,vm.getStores=getStores,vm.getLocation=getLocation,vm.openStoreLocatorModal=openStoreLocatorModal,vm.openAppointmentFlow=openAppointmentFlow,vm.getSelectedStore=getSelectedStore,vm.invocaRun=invocaRun,vm.authorvalue=globalValue.authorValue.rootPage.saveCartModal,vm.cartID=cartCommonOperationsService.model.structCartData.cartId;var cartCISFlag=lodash.get(toggleService.model,"toggles.cartCISFlag",!1);vm.callMeFlag=lodash.get(toggleService.model,"toggles.callMeFlag",!1);var digitalToRetailFlag=lodash.get(toggleService.model,"toggles.digitalToRetail",!1),digitalToRetailCartFlag=lodash.get(toggleService.model,"toggles.digitalToRetailCart",!1),d2rRetailSaveCartFlag=lodash.get(toggleService.model,"toggles.d2rRetailSaveCart",!1);if(cartCISFlag?vm.isSavePage=cartCommonOperationsService.isSavePage:vm.isSavePage=!1,vm.toggles=toggleService.model.toggles,digitalToRetailFlag&&digitalToRetailCartFlag&&d2rRetailSaveCartFlag){var storeModel=storeLocatorModelService.model,d2rModelManager=D2RModelManager.prototype.model();vm.appointmentAvailibilty=storeModel.store.inStoreAppointment,init()}}finalizeInStoreThankYouControllerFunction.$inject=["$modalInstance","$state","$modal","globalValue","orderInStoreData","pdlService","pdlConstant","cartCommonOperationsService","utils","toggleService","storeLocatorModelService","D2RModelManager","storeLocatorUtil","storeLocatorConstants","commonServices","invocaScriptService"],angular.module("tmobileApp").controller("finalizeInStoreThankYouController",finalizeInStoreThankYouControllerFunction)}(window.angular,_),function(angular){"use strict";function tsOfferSignup($window,analyticsUtils){return{restrict:"A",link:function(scope,element,attr){function cleanup(){}element.find("input, select").on("focus",function(e){angular.element(e.currentTarget).closest(".input-wrapper").addClass("active"),scope.tsOfferSignupForm.$pristine&&!isFormStarted&&(analyticsUtils.trackForm({eventType:"form start",analyticsID:scope.analyticsID,submitText:submitCTA}),isFormStarted=!0)}),element.find("input, select").on("blur",function(e){angular.element(e.currentTarget).closest(".input-wrapper").removeClass("active")}),scope.$on("valid",function(e,isValid){var attributes={},timeRemaining=element.data("timeRemaining"),optInText=scope.formData.optInText||"Opt in to T-Mobile emails",headerHeight=angular.element(".global-header.sticky").height(),filterHeight=angular.element(".offers-filter-component").height(),scrollTop=element.offset().top-headerHeight-filterHeight;timeRemaining&&(attributes.dynamicContent=("0"+timeRemaining.days).slice(-2)+":"+("0"+timeRemaining.hours).slice(-2)+":"+("0"+timeRemaining.minutes).slice(-2)+":"+("0"+timeRemaining.seconds).slice(-2)),analyticsUtils.trackFormSubmit({eventType:"clickToAction",analyticsID:scope.analyticsID,submitText:submitCTA,targetUrl:submitCTAIcid,assetType:"button",attributes:{user:(scope.formData.currentCustomer?"Customer":"Prospect")+(scope.formData.optin?" | "+optInText:"")}}),isValid===!1?($window.scrollTo(0,scrollTop),element.find(".input-wrapper.error:first input").focus()):isValid===!0&&($window.scrollTo(0,scrollTop),initial.hide(),confirmation.show(),analyticsUtils.trackForm({eventType:"form complete",analyticsID:scope.analyticsID,submitText:submitCTA}))});var isFormStarted=!1,preRegForm=element[0].querySelector("form"),submitCTAIcid=preRegForm.querySelector('[type="submit"]').getAttribute("data-icid"),submitCTA=preRegForm.querySelector('[type="submit"]').innerText,initial=element.find(".initial-state"),confirmation=element.find(".success-state");scope.$on("$destroy",cleanup)}}}tsOfferSignup.$inject=["$window","analyticsUtils"],angular.module("marketingCore").directive("tsOfferSignup",tsOfferSignup)}(window.angular),function(angular,_){"use strict";function deviceTradeInService(aemRoutingService,creditClassService,globalValue,toggleService){function parseData(n){return"object"!=typeof n?JSON.parse(n):n}function getTradeInOffers(offerIds){if(!angular.isUndefined(toggleService.model.toggles.tradeIn)&&toggleService.model.toggles.tradeIn!==!1){var response=angular.copy(aemRoutingService.aemRoutesData);return _.forEach(response,function(value){value.data&&(value.data.defaultsku&&service.model.authorOverrideSKUs.push({offerId:value.data.offerId,defaultsku:value.data.defaultsku}),value.data.tradeInPromotions&&_.forEach(offerIds,function(offerId){offerId.offerId===value.data.offerId&&service.model.tradeInPromotions.push({offerId:value.data.offerId,tradeInPromotions:_.map(value.data.tradeInPromotions,parseData),skus:value.data.sku,familyOverrideLegal:_.isEmpty(value.data.pdptradeinlegal)?_.isEmpty(globalValue.authorValue.rootPage.generalAuthoring.globaltradeinpdplegal)?"":globalValue.authorValue.rootPage.generalAuthoring.globaltradeinpdplegal:value.data.pdptradeinlegal})}))}),service.model.alltradeInPromotionsOffers=service.model.tradeInPromotions,service.model.alltradeInPromotionsOffers}}function setProductOfferPricing(promotions,pricing){creditClassService.getCreditClass();return pricing.tradeInPromotions=promotions,pricing}var service=this;service.model={},service.model.authorOverrideSKUs=[],service.model.tradeInPromotions=[],service.model.skutradeoffers="",service.model.alltradeInPromotionsOffers=[],service.getTradeInOffers=getTradeInOffers,service.setProductOfferPricing=setProductOfferPricing}deviceTradeInService.$inject=["aemRoutingService","creditClassService","globalValue","toggleService"],angular.module("tmobileApp").service("deviceTradeInService",deviceTradeInService)}(angular,_),function(angular){"use strict";function validate(validationService){return{restrict:"A",require:["ngModel"],link:function(scope,element,attrs,ctrl){var validatorsArray=attrs.validate?attrs.validate.split("|"):[];ctrl[0].$validators.validate=function(modelValue){var failedTests=validatorsArray.filter(function(validationMethod){return validationService.validate(validationMethod,modelValue)===!1});return!failedTests.length}}}}validate.$inject=["validationService"],angular.module("marketingCore").directive("validate",validate)}(angular),function(angular,lodash){"use strict";function miniBrowseDeviceServiceFn($log,httpRequestWrapper,apiURLs,commonUtils,responseTransformationService,apiService,toggleService,$location,responseTransformServiceDCPV2,dataFactory,cartConstants,globalValue){function getMiniPLPDeviceResponse(url,body,query,header,isV2API){return isV2API?httpRequestWrapper.post(url,body,query,header,!0,"plpV2"):httpRequestWrapper.get(url,query,header,!0)}function obtainObject(input,callback){var header={},body={},url="",query=null,miniPLPV2API=_.get(toggleService.model,"toggles.miniPLPATv2",!1),mainPLPV2=_.get(toggleService.model,"toggles.mainPLPV2",!1);if(miniPLPV2API)url=apiURLs.snpMiniBrowse2,body=angular.copy(cartConstants.REQ_DATA_MINI_PLP[input.category]),mainPLPV2?body.productFamilyIds=input.miniBrowseSku:body.productFamilyIds=[input.miniBrowseSku.toString()];else{var qs=queryString.stringify({o:input.familyIds});url=apiURLs.mostPopularDevices+qs,header=apiURLs.nonProdBrowseHeader?{"x-target":"b"}:{}}input.ignoreLoadingBar&&(query={ignoreLoadingBar:input.ignoreLoadingBar}),toggleService.model.toggles.isCircuitBreaker&&!miniPLPV2API&&(header["cb-response"]=apiURLs.product.browse.failSafeParametersMini[input.type]),toggleService.model.toggles.turnSnPOff&&!miniPLPV2API?(url=apiURLs.product.browse.failSafeParametersMini[input.type],httpRequestWrapper.get(url).then(function(response){
200===response.status&&partObtainObject(input,callback,response,miniPLPV2API)})["catch"](function(error,response){$log.error("Call to cart browse aem cache API at:",url+" failed with response "+angular.toJson(response))})):getMiniPLPDeviceResponse(url,body,query,header,miniPLPV2API).then(function(response){$log.log('Call to cart browse SnP api at: "" + url + "" completed successfully'),partObtainObject(input,callback,response,miniPLPV2API)})["catch"](function(error,response){$log.error("Call to cart browse SnP api at:",url+" failed with response "+angular.toJson(response))})}function partObtainObject(input,callback,response,miniPLPV2API){var sortedProducts=[];angular.equals(miniPLPV2API,!0)?(sortedProducts=commonUtils.sortCollection(angular.copy(response.data.products),input.miniBrowseSku,"familyCode"),response.data.products=angular.copy(sortedProducts)):(sortedProducts=commonUtils.sortCollection(angular.copy(response.data.values.products),input.miniBrowseSku,"offerId"),response.data.values.products=angular.copy(sortedProducts));var apiKey=apiService.getURL("bundleService"),transformService=responseTransformationService.getFactory(apiKey.version),_transformedData=miniPLPV2API?responseTransformServiceDCPV2.getTransformedDeviceV2APIResponse(response):transformService.mostPopularDevicesTransformation(response.data);callback&&callback(_transformedData)}function getFamilyIdsFromMiniBrowseAuthor(inputlist){return lodash.map(inputlist,function(item){return item.familyId})}function prefetchInternetDevice(){var dfRequest=new dataFactory.DFRequest,miniBrowseSku=this.getFamilyIdsFromMiniBrowseAuthor(lodash.get(globalValue,"authorValue.rootPage.plpRankOrdering.miniBrowseTablets")),pipedMostPopularDeviceSKUs=commonUtils.pipefyItemsByComma(miniBrowseSku.toString());dfRequest.input={familyIds:pipedMostPopularDeviceSKUs,miniBrowseSku:miniBrowseSku},lodash.get(toggleService.model,"toggles.miniPLPATv2",!1)&&(dfRequest.input.category=cartConstants.DEVICE_TYPE.TABLET),dfRequest.conf.resetCache=!1,dataFactory.getVO("miniBrowseDevice",dfRequest)}return{obtainObject:obtainObject,getFamilyIdsFromMiniBrowseAuthor:getFamilyIdsFromMiniBrowseAuthor,prefetchInternetDevice:prefetchInternetDevice}}miniBrowseDeviceServiceFn.$inject=["$log","httpRequestWrapper","apiURLs","commonUtils","responseTransformationService","apiService","toggleService","$location","responseTransformServiceDCPV2","dataFactory","cartConstants","globalValue"],angular.module("tmobileApp").service("miniBrowseDeviceService",miniBrowseDeviceServiceFn)}(window.angular,window._),function(angular){"use strict";function videoContent($window,$document,$location,$timeout,$log,utils,scene7,analyticsUtils){return{restrict:"A",link:function(scope,element,attr){function playVideo(videoIdParam,s7config){if("modal-content"===element[0].parentNode.className&&(element[0].previousElementSibling.style.display="none"),s7config){var config=s7config;contentWrap.hide(),legalWrap.hide(),vidWrap.hide(),bcVideoContainer.hide(),$document.find('[class*="bc-player"]').hide(),vidOverlay.css({visibility:"visible",display:"flex"}),scrollTo(0,vidOverlay[0].getBoundingClientRect().top+$window.window.pageYOffset-62),vidClose.focus(),angular.element($window).on("scroll.resetVideo",onScrollWindow),scene7.foregroundVid(attr.moduleId,videoIdParam,config,onDynamicMediaPlayerInit,onDynamicMediaPlayerTrackEvent)}else utils.loadScript("//players.brightcove.net/1403111602001/S1FB8oH0_default/index.min.js",onSuccess)}function playBrightCove(){$document.find('[class*="bc-player"]').show(),player.catalog.getVideo(videoId,function(error,video){player.catalog.load(video),videoName=player.mediainfo.name,player.play(),contentWrap.hide(),legalWrap.hide(),vidWrap.hide(),vidOverlay.css({visibility:"visible",display:"flex"}),scrollTo(0,vidOverlay[0].getBoundingClientRect().top+$window.window.pageYOffset-62),vidClose.focus(),angular.element($window).on("scroll.resetVideo",onScrollWindow)})}function resetVideo(scroll){var isScroll=scroll;s7Player?(angular.element($window).off("scroll.resetVideo"),s7Player.dispose(),vidOverlay.css({visibility:"hidden",display:"none"}),vidWrap.show(),contentWrap.show(),legalWrap.show(),bcVideoContainer.show(),isScroll||playButton.focus()):(angular.element($window).off("scroll.resetVideo"),player.pause(),player.isFullscreen()&&player.exitFullscreen(),vidOverlay.css({visibility:"hidden",display:"none"}),vidWrap.show(),contentWrap.show(),legalWrap.show(),isScroll||playButton.focus())}function setPlacementId(){for(var moduleList=$window.window.marketingDigitalData&&$window.window.marketingDigitalData.page&&$window.window.marketingDigitalData.page.modules&&$window.window.marketingDigitalData.page.modules.moduleList?$window.window.marketingDigitalData.page.modules.moduleList:[],i=0;i<moduleList.length;i++)if(moduleList[i].ID===analyticsId){placementId=moduleList[i].placementID;break}}function onSuccess(){$window.window.videojs("video-"+attr.moduleId).ready(onReadyVideo)}function onReadyVideo(){player=this,player.on("play",function(){duration=this.duration(),scrollPrompt.length&&(angular.element("body").addClass("video-play"),scrollPrompt.hide()),analyticsUtils.trackVideoPlay(videoName,moduleName,placementId)}),player.on("pause",function(){scrollPrompt.length&&(angular.element("body").removeClass("video-play"),scrollPrompt.show()),analyticsUtils.trackVideoPause(videoName,moduleName,placementId)}),player.on("seeked",function(){analyticsUtils.trackVideoSeeked(videoName,moduleName,placementId)}),player.on("ended",function(){resetVideo(),analyticsUtils.trackVideoEnded(videoName,moduleName,placementId)}),player.on("timeupdate",function(){duration=duration?duration:this.duration(),this.currentTime()/duration>=.75&&this.currentTime()/duration<1&&"75%"!==milestone?(milestone="75%",analyticsUtils.trackVideoTimeUpdate(videoName,moduleName,placementId,milestone)):this.currentTime()/duration>=.5&&this.currentTime()/duration<.75&&"50%"!==milestone?(milestone="50%",analyticsUtils.trackVideoTimeUpdate(videoName,moduleName,placementId,milestone)):this.currentTime()/duration>=.25&&this.currentTime()/duration<.5&&"25%"!==milestone&&(milestone="25%",analyticsUtils.trackVideoTimeUpdate(videoName,moduleName,placementId,milestone))}),playBrightCove()}function onScrollWindow(){$document.fullscreenElement||$document.webkitFullscreenElement||$document.mozFullScreenElement||$document.msFullscreenElement||(angular.element($window).scrollTop()>element.offset().top+element.innerHeight()&&resetVideo(!0),angular.element($window).scrollTop()<element.offset().top-element.innerHeight()&&resetVideo(!0))}function onClickPlay(e){var s7config;setPlacementId();var val=angular.element(e.currentTarget).attr("data-video-id"),matches=val.match(/\//);null!==matches&&(s7config=angular.fromJson(angular.element(e.currentTarget).attr("data-foreground-video-config"))),playVideo(angular.element(e.currentTarget).attr("data-video-id"),s7config)}function onClickClose(e){e.preventDefault(),resetVideo(),"modal-content"===element[0].parentNode.className&&(element[0].previousElementSibling.style.display="block")}function cleanup(){angular.element($window).off("scroll.resetVideo",onScrollWindow),element.find('[data-action="play-video"]').off("click",onClickPlay),vidClose.off("click",onClickClose)}if(!element.find(".vid-overlay").length||element.closest(".offers-carousel").length||element.closest(".content-carousel").length)return!1;var player,s7Player,placementId,videoName,duration,milestone,vidWrap=element.find(".vid-wrap:not(.vid-overlay)"),vidOverlay=element.find(".vid-wrap.vid-overlay"),vidClose=element.find("button.close"),contentWrap=element.find(".content-wrap"),legalWrap=element.find(".legal"),playButton=element.find('[data-action="play-video"]'),scrollPrompt=angular.element(".scroll-prompt"),bcVideoContainer=element.find("video.video-js"),videoId=playButton.attr("data-video-id"),moduleName=element.find("h2").length?element.find("h2").text():element.find(".background-alt-wrap").attr("aria-label"),analyticsId=element.attr("data-analytics-id"),onDynamicMediaPlayerInit=function(viewer){s7Player=viewer,setPlacementId()},onDynamicMediaPlayerTrackEvent=function(objID,compClass,instName,timeStamp,eventInfo){if(eventInfo){var eventInfoSplit=eventInfo.split(","),eventName=eventInfoSplit[0];switch(eventName){case"LOAD":var videoPath=eventInfoSplit[6];videoPath&&videoPath.length>0&&(videoName=decodeURIComponent(videoPath));break;case"METADATA":var metadataName=eventInfoSplit[1],metadataValue=eventInfoSplit[2];switch(metadataName){case"DURATION":duration=Math.floor(metadataValue/1e3);break;case"SEEK":analyticsUtils.trackVideoSeeked(videoName,moduleName,placementId)}break;case"MILESTONE":milestone=eventInfoSplit[1]+"%",("25%"===milestone||"50%"===milestone||"75%"===milestone)&&analyticsUtils.trackVideoTimeUpdate(videoName,moduleName,placementId,milestone);break;case"PAUSE":analyticsUtils.trackVideoPause(videoName,moduleName,placementId);break;case"PLAY":analyticsUtils.trackVideoPlay(videoName,moduleName,placementId);break;case"STOP":analyticsUtils.trackVideoEnded(videoName,moduleName,placementId)}}};return vidClose.length&&vidClose.on("click",onClickClose),playButton.on("keydown",function(e){13===e.which&&playButton.click()}),playButton.on("click",onClickPlay),scope.$on("$destroy",cleanup),$timeout(function(){if($location.search().section===attr.moduleId&&$location.search().vid){var playButtonReady=angular.element('[data-action="play-video"][data-video-id="'+$location.search().vid+'"]');videoId=$location.search().vid;var s7config,matches=videoId.match(/\//);analyticsId=playButtonReady.closest("section").attr("data-analytics-id"),moduleName=playButtonReady.closest("section").find("h3").text(),setPlacementId(),matches?(s7config=angular.fromJson(playButton.attr("data-foreground-video-config")),playVideo(videoId,s7config)):playButton.click()}},0),!0}}}videoContent.$inject=["$window","$document","$location","$timeout","$log","utils","scene7","analyticsUtils"],angular.module("marketingCore").directive("videoContent",videoContent)}(angular),function(angular,lodash){"use strict";function skuPriceServiceConstructor(cartHttpDataService,cartConstants,toggleService){function getAllSkuPrices(cartObj){vm.cartObj=cartObj,lodash.get(toggleService.model,"toggles.isDcpV3ApiEnabled",!1)?vm.transformSkuPriceFromV3Cart():cartHttpDataService.getSkuPrices().then(function(skuResponse){lodash.get(toggleService.model,"toggles.isSkuPriceFromV2Cart",!1)?vm.transformSkuPriceFromV2Cart(skuResponse):vm.transformSkuPriceFromV1Cart(skuResponse)})}function transformSkuPriceFromV1Cart(skuResponse){lodash.forEach(lodash.get(vm.cartObj,"accessories.accessoryDetails"),function(item,key){lodash.forEach(lodash.get(skuResponse,"data.cart.accessories"),function(accessory,key){accessory.id===item.id&&(item.frp=lodash.get(accessory,"pricing.listPrice.display"),item.fsp=lodash.get(accessory,"pricing.mrp.display"))})}),lodash.forEach(lodash.get(vm.cartObj,"lineItems"),function(item,key){lodash.forEach(lodash.get(skuResponse,"data.cart.lineOfServices"),function(line,key){line.id===item.lineId&&(item.simKitDetails.isBYODAdded?(item.frp=lodash.get(line,"simCard.pricing.listPrice.display"),item.fsp=lodash.get(line,"simCard.pricing.options.payNowPrice.display")):(item.frp=lodash.get(line,"device.pricing.listPrice.display"),item.fsp=lodash.get(line,"device.pricing.mrp.display")))})})}function transformSkuPriceFromV2Cart(skuResponse){lodash.forEach(lodash.get(vm.cartObj,"accessories.accessoryDetails"),function(item,key){lodash.forEach(lodash.get(skuResponse,"data.cart.accessories"),function(accessory,key){accessory.id===item.id&&(item.frp=lodash.get(accessory,"price.priceSummary.catalogPrice.listPrice.display"),item.fsp=lodash.get(accessory,"price.priceSummary.catalogPrice.salePrice.display"))})}),lodash.forEach(lodash.get(vm.cartObj,"lineItems"),function(item,key){lodash.forEach(lodash.get(skuResponse,"data.cart.lines"),function(line,key){line.id===item.lineId&&(item.simKitDetails.isBYODAdded?(item.frp=lodash.get(line,"simKit.pricing.priceSummary.payNowPrice.listPrice.display"),item.fsp=lodash.get(line,"simKit.pricing.priceSummary.payNowPrice.salePrice.display")):(item.frp=lodash.get(line,"device.price.priceSummary.catalogPrice.listPrice.display"),item.fsp=lodash.get(line,"device.price.priceSummary.catalogPrice.salePrice.display")))})})}function transformSkuPriceFromV3Cart(){lodash.forEach(lodash.get(vm.cartObj,"accessories.accessoryDetails"),function(item,key){item.frp=lodash.get(item,"catalogPrice.listPrice.amountDisplay"),item.fsp=lodash.get(item,"catalogPrice.purchasePrice.amountDisplay")}),lodash.forEach(lodash.get(vm.cartObj,"lineItems"),function(item,key){item.simKitDetails.isBYODAdded?(item.frp=lodash.get(item,"simKitDetails.listPrice.amountDisplay"),item.fsp=lodash.get(item,"simKitDetails.payNowPrice.purchasePrice.amountDisplay")):(item.frp=lodash.get(item,"lineItemDetails.deviceDetails.catalogPrice.listPrice.amountDisplay"),item.fsp=lodash.get(item,"lineItemDetails.deviceDetails.catalogPrice.purchasePrice.amountDisplay"))})}var vm=this;vm.transformSkuPriceFromV1Cart=transformSkuPriceFromV1Cart,vm.transformSkuPriceFromV2Cart=transformSkuPriceFromV2Cart,vm.transformSkuPriceFromV3Cart=transformSkuPriceFromV3Cart,vm.getAllSkuPrices=getAllSkuPrices}skuPriceServiceConstructor.$inject=["cartHttpDataService","cartConstants","toggleService"],angular.module("tmobileApp").service("skuPriceService",skuPriceServiceConstructor)}(angular,_),function(angular,lodash){"use strict";function analyticsFactory($window,analyticsUtils){function trackContentLoaded(data){var eventContent={eventInfo:{eventAction:"load",eventType:"content"},eventDescription:{type:getComponentType(),audienceId:getAudienceId(),path:getPersonalizationPagePath()},attributes:{icidList:data.uniqICID}};trackEvent({eventName:$window.AJAX_CONTENT_EVENT,analyticsId:data.analyticsId,eventContent:eventContent})}function trackEvent(eventData){analyticsUtils.trackEvent(eventData.eventName,eventData.analyticsId,eventData.eventContent)}function getAudienceId(){return $window.TMOPersonalize?$window.TMOPersonalize.page:"visitor"}function getComponentType(){var type="default page";return $window.marketingConfig.hasPersonalizedPage?type="page picker":$window.marketingConfig.hasPersonalizedModule&&(type="module picker"),type}function setPersonalizationPagePath(value){personalizationPagePath=value}function getPersonalizationPagePath(){return personalizationPagePath}var personalizationPagePath="";return{trackContentLoaded:trackContentLoaded,setPersonalizationPagePath:setPersonalizationPagePath,getPersonalizationPagePath:getPersonalizationPagePath}}analyticsFactory.$inject=["$window","analyticsUtils"],angular.module("marketingCore").factory("analyticsFactory",analyticsFactory)}(angular,_),function(angular,lodash){"use strict";function inventoryVisibilityService(toggleService,authorValueService,globalValue,$log){function initializeIVComponent(){return lodash.get(toggleService.model,"toggles.digitalToRetailOnCart",!1)?authorValueService.loadAuthorJson("/bin/authorvalue/content/t-mobile/store-authoring.json").then(function(response){globalValue.authorValue.storeauthoring=response.storeauthoring,globalValue.authorValue.storeauthoring.digitalToRetail&&(vm.storeauthoring=!0),vm.isLoading=!1},function(error){$log.log("Error getting store author data for digital to retail: "+error),vm.isLoading=!1}):void 0}var vm=this;vm.initializeIVComponent=initializeIVComponent,vm.storeauthoring=!1,vm.isLoading=!0,vm.toggleService=toggleService,vm.authorValue=globalValue.authorValue}inventoryVisibilityService.$inject=["toggleService","authorValueService","globalValue","$log"],angular.module("tmobileApp").service("inventoryVisibilityService",inventoryVisibilityService)}(window.angular,window._),function(angular,lodash){"use strict";function analyticsUtils($q,$interval,$document,$timeout,utils,$window,$location){function getModule(analyticsID){var moduleList=lodash.get(window,"marketingDigitalData.page.modules.moduleListAll",{});return lodash.find(moduleList,function(module){return module.ID===analyticsID})}function pushEvent(eventName,data){function isAllowedEvent(name){return-1!==allowedEvents.indexOf(name)}var allowedEvents=["PAGE_LOAD_EVENT","AJAX_PERSONALIZED_EVENT","AJAX_CONTENT_EVENT"],hasAnalyticsQueue=analyticsCalls.length,needToQueueEvents=!$window.pageLoadEventHasFired||$window.pageLoadEventHasFired&&hasAnalyticsQueue||$window.pageLoadEventHasFired&&pageNeedsContentLoadEvent&&!hasContentLoadEventPushed&&!isAllowedEvent(eventName)||!$window.triggerEvent;needToQueueEvents?(queueAnalytics(eventName,data),checkPageLoad()):("AJAX_CONTENT_EVENT"===eventName&&(hasContentLoadEventPushed=!0),fireEvent(eventName,data))}function queueAnalytics(eventName,data){for(var analyticsWeights={PAGE_LOAD_EVENT:10,AJAX_PERSONALIZED_EVENT:20,AJAX_CONTENT_EVENT:30,CLICK_EVENT:40},weight=analyticsWeights[eventName],newEventToQueue={eventName:eventName,data:data,weight:weight},len=analyticsCalls.length,hasAddedCall=!1,i=0;len>i;i++){var specificAnalytics=analyticsCalls[i],specificWeight=specificAnalytics.weight;specificWeight>weight&&!hasAddedCall&&(analyticsCalls.splice(i,0,newEventToQueue),hasAddedCall=!0)}hasAddedCall||analyticsCalls.push(newEventToQueue)}function checkPageLoad(){hasPageLoadEventFiredPromise||pollingForPageLoad?hasPageLoadEventFiredPromise&&checkToProcess():(pollingForPageLoad=!0,utils.pollForGlobal("pageLoadEventHasFired").then(function(){hasPageLoadEventFiredPromise=!0,checkToProcess()}))}function checkToProcess(){pageNeedsContentLoadEvent&&!hasContentLoadEventPushed?angular.forEach(analyticsCalls,function(eachEvent){("AJAX_CONTENT_EVENT"===eachEvent.eventName||"CLICK_EVENT"===eachEvent.eventName)&&(hasContentLoadEventPushed=!0,processEvents())}):processEvents()}function processEvents(){for(;analyticsCalls.length>0;){var specificAnalytics=analyticsCalls.shift();specificAnalytics.data.eventInfo.timeStamp&&(specificAnalytics.data.eventInfo.timeStamp=(new Date).toString()),fireEvent(specificAnalytics.eventName,specificAnalytics.data)}}function fireEvent(eventName,data){$window.digitalData.events.push(data),$window.triggerEvent($window[eventName])}function trackPageLoad(type,primaryCategory,subCategory,pageName,dynamicValue,variant){$window.digitalData&&$window.digitalData.page&&$window.digitalData.page.category&&$window.digitalData.page.pageInfo&&($window.digitalData.page.category.primaryCategory=primaryCategory,$window.digitalData.page.category.subCategory=subCategory,$window.digitalData.page.pageInfo.pageName=pageName,dynamicValue&&($window.digitalData.page.pageInfo.dynamicValue=dynamicValue),variant&&($window.digitalData.page.pageInfo.variant=variant));var evt={eventInfo:{eventAction:"load",eventType:"page",timeStamp:(new Date).toString()}};type&&(evt.attributes={},evt.attributes.type=type),pushEvent("PAGE_LOAD_EVENT",evt)}function trackModuleView(element){var icidElements=element[0].querySelectorAll("[data-icid]"),allICID=lodash.map(icidElements,"dataset.icid"),analyticsId=element.attr("data-analytics-id"),moduleItem=lodash.find($window.marketingDigitalData.page.modules.moduleListAll,function(module){return module.ID===analyticsId});if(moduleItem){var evt={eventInfo:{eventAction:"scroll",eventType:"moduleView"},eventDescription:{PlacementID:moduleItem.placementID,dataAnalyticsID:analyticsId,ModuleName:utils.htmlSanitization(moduleItem.titleText),parentComponent:moduleItem.parentComponentType}};icidElements&&(evt.attributes={},evt.attributes.icidList=lodash.uniq(allICID)),pushEvent("CLICK_EVENT",evt)}}function trackAsyncPage(componentType,audienceId,path){$window.marketingDigitalData.page.pageInfo.icidList||($window.marketingDigitalData.page.pageInfo.icidList=[]);var uniqICID,icidElements=$window.document.querySelectorAll("[data-icid]"),allICID=lodash.map(icidElements,"dataset.icid"),pageLoadICID=$window.marketingDigitalData.page.pageInfo.icidList,modPickICID=$window.modPickICID,modals=$window.document.querySelectorAll('[data-ui-mode="dialog"]'),modalIcids=[];_.forEach(modals,function(modalSection){var modalAnalytics=modalSection.querySelector("[data-analytics-config]"),modalData=angular.fromJson(modalAnalytics.getAttribute("data-analytics-config"));_.forEach(modalData.actionableElements,function(actionableElements){var icid=actionableElements.icid;modalIcids.push(icid)})}),allICID=allICID.filter(function(val){return-1===pageLoadICID.indexOf(val)}),allICID=allICID.filter(function(val){return-1===modPickICID.indexOf(val)}),allICID=allICID.filter(function(val){return-1===modalIcids.indexOf(val)}),icidElements&&(uniqICID=_.uniq(allICID)),angular.forEach($window.digitalData.page.modules.moduleListAll,function(module){angular.element('[data-analytics-id="'+module.ID+'"]').attr("data-placement-id",module.placementID)});var contentEvt={eventInfo:{eventAction:"load",eventType:"content"},eventDescription:{type:componentType,audienceId:audienceId,path:path},attributes:{icidList:uniqICID}};angular.merge($window.digitalData,$window.marketingDigitalData),pushEvent("AJAX_CONTENT_EVENT",contentEvt)}function trackAsyncModule(componentType,path,analyticsId,moduleId,optId,pickerId){var uniqICID,icidElements=$window.document.getElementById(""+moduleId).querySelectorAll("[data-icid]"),allICID=lodash.map(icidElements,"dataset.icid");$window.modPickICID||($window.modPickICID=[]),angular.forEach(allICID,function(element){$window.modPickICID.push(element)}),icidElements&&(uniqICID=lodash.uniq(allICID)),$window.marketingDigitalData.page.modules.moduleCount=1,$window.marketingDigitalData.page.modules.moduleList.splice(1),$window.marketingDigitalData.page.modules.moduleListAll.splice(1),angular.element("[data-analytics-config]").each(function(i,el){if(!utils.getClosest(el,".slick-cloned")){var config=angular.element(el).data("analytics-config"),type=angular.element(el).data("component-type");"carousel"===type&&($window.marketingDigitalData.page.modules.slideCount=0),"slide"===type?($window.marketingDigitalData.page.modules.slideCount++,config.placementID="index "+$window.marketingDigitalData.page.modules.moduleCount+" slide "+$window.marketingDigitalData.page.modules.slideCount):($window.marketingDigitalData.page.modules.moduleCount++,config.placementID="index "+$window.marketingDigitalData.page.modules.moduleCount),utils.getClosest(el,".display-dialog")?($window.marketingDigitalData.page.modules.moduleCount--,$window.marketingDigitalData.page.modules.moduleListAll.push(config)):config.ID===$window.marketingDigitalData.page.modules.moduleList[0].ID?$window.marketingDigitalData.page.modules.moduleCount--:($window.marketingDigitalData.page.modules.moduleList.push(config),$window.marketingDigitalData.page.modules.moduleListAll.push(config))}}),angular.forEach($window.digitalData.page.modules.moduleList,function(module){angular.element('[data-analytics-id="'+module.ID+'"]').attr("data-placement-id",module.placementID)}),angular.forEach($window.digitalData.page.modules.moduleListAll,function(module){angular.element('[data-analytics-id="'+module.ID+'"]').attr("data-placement-id",module.placementID)});var personalizedEvt={eventInfo:{eventAction:"load",eventType:"personalizedContent"},eventDescription:{audienceId:optId,type:componentType,path:path,dataAnalyticsId:analyticsId,moduleId:moduleId,modPickId:pickerId},attributes:{icidList:uniqICID}};angular.merge($window.digitalData,$window.marketingDigitalData),pushEvent("AJAX_PERSONALIZED_EVENT",personalizedEvt)}function trackArchiveAngularLoad(elementArray,tag,analyticsId,placementId){var pageTitle=tag,actionableElements=elementArray.map(function(a){return{ID:a.analyticsId,eventType:"click",icid:a.icid||"",targetUrl:a.link,text:a.title.replace(/<\/?[^>]+(>|$)/g,""),type:"Link"}}),moduleUpdates={ID:analyticsId,parentComponentType:"Archive",placementID:placementId,titleText:utils.htmlSanitization(analyticsId),actionableElements:actionableElements};angular.merge(window.digitalData,window.marketingDigitalData),window.digitalData.page.modules.moduleListAll.push(moduleUpdates),$window.pageLoad(actionableElements,pageTitle)}function trackCarousel(isNext,element,slot,currentTimeline){var analyticsId=element.attr("data-analytics-id"),assetType=angular.element(element).data("assetType"),module=lodash.find($window.marketingDigitalData.page.modules.moduleListAll,function(moduleItem){return moduleItem.ID===analyticsId});if(!module)return!1;var evt={eventInfo:{eventAction:"click",eventType:"clickToAction"},attributes:{type:"carousel navigation"},eventDescription:{PlacementID:module.placementID,dataAnalyticsID:analyticsId,ctaName:isNext?"Next":"Previous",ModuleName:module.titleText,parentComponent:module.parentComponentType}};return slot&&(evt.eventDescription.ctaName="Slot "+slot+" : "+currentTimeline.querySelector(".teaser-header").innerText),assetType?evt.eventDescription.assetType=assetType:evt.eventDescription.assetType="carousel navigation",pushEvent("CLICK_EVENT",evt),!0}function trackCarouselModalLink(element,event,slot,currentTimeline){var analyticsId=element.attr("data-analytics-id"),assetType=event.dataset.assetType,module=lodash.find($window.marketingDigitalData.page.modules.moduleListAll,function(moduleItem){return moduleItem.ID===analyticsId});if(!module)return!1;var evt={eventInfo:{eventAction:"click",eventType:"clickToAction"},eventDescription:{PlacementID:module.placementID,dataAnalyticsID:analyticsId,ctaName:"Slot "+slot+" : "+utils.htmlSanitization(currentTimeline.querySelector("h3").innerText)+" : "+event.innerText,ModuleName:module.titleText,parentComponent:module.parentComponentType}};return assetType?evt.eventDescription.assetType=assetType:evt.eventDescription.assetType="button",pushEvent("CLICK_EVENT",evt),!0}function trackAccordion(type,data,action){var module=lodash.find($window.marketingDigitalData.page.modules.moduleListAll,function(moduleItem){return moduleItem.ID===data.analyticsId});if(!module)return!1;var evt={eventInfo:{eventAction:"click",eventType:"clickToAction"},attributes:{type:type},eventDescription:{PlacementID:module.placementID,dataAnalyticsID:data.analyticsId,ctaName:action+": "+utils.htmlSanitization(data.text.trim()),ModuleName:module.titleText,parentComponent:module.parentComponentType}};return data.icid&&(evt.eventDescription.icid=data.icid),pushEvent("CLICK_EVENT",evt),!0}function trackTool(data){var moduleList=lodash.get(window,"marketingDigitalData.page.modules.moduleListAll"),moduleFound=lodash.find(moduleList,function(module){return module.ID===data.analyticsID});if(moduleFound){var evt={eventInfo:{eventAction:"click",eventType:"clickToAction"},eventDescription:{ctaName:"",toolName:data.name,toolStage:data.type}};"Complete"===data.type&&(evt.eventDescription.ctaName=utils.htmlSanitization(data.ctaName),evt.eventDescription.assetType=data.assetType,evt.eventDescription.userInput=data.userInput),data.icid&&(evt.eventDescription.icid=data.icid),pushEvent("CLICK_EVENT",evt)}}function trackToolWithDynamicContent(data){var evt={eventInfo:{eventAction:"click",eventType:data.eventType?data.eventType:"clickToAction"},eventDescription:{},tool:{stage:data.stage,name:data.name}};"complete"===data.stage&&(evt.eventDescription.ctaName=data.ctaName,evt.eventDescription.assetType="Button",evt.tool.dynamicContent=data.dynamicContent),pushEvent("CLICK_EVENT",evt)}function trackForm(data){var moduleList=lodash.get($window,"marketingDigitalData.page.modules.moduleListAll"),module=lodash.find(moduleList,function(moduleItem){return moduleItem.ID===data.analyticsID});if(module){var evt={eventInfo:{eventAction:"click",eventType:data.eventType},attributes:data.attributes||{},eventDescription:{PlacementID:module.placementID,dataAnalyticsID:data.analyticsID,ModuleName:data.formName||module.titleText,formName:data.formName||module.titleText,parentComponent:module.parentComponentType}};if(data.ctaName&&(evt.eventDescription.ctaName=utils.htmlSanitization(data.ctaName),evt.eventDescription.assetType="button"),data.modal){var temp=data.modal||data.formName;evt.eventDescription.modalName=utils.htmlSanitization(temp)}data.promoCode&&(evt.eventDescription.promoCode=data.promoCode),data.userSelection&&(evt.eventDescription.userSelection=data.userSelection),data.assetType&&(evt.eventDescription.assetType=data.assetType),pushEvent("FORM_EVENT",evt)}}function trackFormSubmit(data){var moduleList=lodash.get($window,"marketingDigitalData.page.modules.moduleListAll"),module=lodash.find(moduleList,function(moduleItem){return moduleItem.ID===data.analyticsID});if(module){var evt={eventInfo:{eventAction:"click",eventType:data.eventType},eventDescription:{PlacementID:module.placementID,dataAnalyticsID:data.analyticsID,formName:data.formName||module.titleText,ctaName:utils.htmlSanitization(data.submitText)||null,parentComponent:module.parentComponentType,assetType:"button"}};data.toolName&&(evt.eventDescription.toolName=data.toolName),data.ModuleName&&(evt.eventDescription.ModuleName=data.analyticsID),data.targetUrl&&(evt.eventDescription.targetUrl=data.targetUrl),data.icid&&(evt.eventDescription.icid=data.icid),data.attributes&&(evt.attributes=data.attributes),data.modal&&(evt.eventDescription.modalName=utils.htmlSanitization(data.formName)),pushEvent("FORM_EVENT",evt)}}function trackCheckbox(isChecked,element){var assetType=angular.element(element).data("assetType"),analyticsId=element.attr("data-analytics-id"),module=lodash.find($window.marketingDigitalData.page.modules.moduleListAll,function(moduleItem){return moduleItem.ID===analyticsId});if(module){var evt={eventInfo:{eventAction:"click",eventType:"clickToAction"},attributes:{type:"checkbox"},eventDescription:{PlacementID:module.placementID,dataAnalyticsID:analyticsId,ModuleName:module.titleText,ctaName:isChecked?"checked":"unchecked",parentComponent:module.parentComponentType}};assetType?evt.eventDescription.assetType=assetType:evt.eventDescription.assetType="checkbox",pushEvent("CLICK_EVENT",evt)}}function trackSlider(value,element,icid){var assetType=angular.element(element).data("assetType"),analyticsId=element.getAttribute("data-analytics-id"),module=lodash.find($window.marketingDigitalData.page.modules.moduleListAll,function(moduleItem){return moduleItem.ID===analyticsId});if(module){var evt={eventInfo:{eventAction:"click",eventType:"clickToAction"},attributes:{type:"slider"},eventDescription:{PlacementID:module.placementID,dataAnalyticsID:analyticsId,ModuleName:module.titleText,ctaName:utils.htmlSanitization(value),parentComponent:module.parentComponentType}};icid&&(evt.eventDescription.icid=icid),assetType?evt.eventDescription.assetType=assetType:evt.eventDescription.assetType="slider",pushEvent("CLICK_EVENT",evt)}}function trackModal(modalID,modalName,isClose,element,dynamicContent){var evt;$timeout(function(){var modal=$window.document.querySelector(".modal"),icidElements=modal.querySelectorAll("[data-icid]"),allICID=lodash.map(icidElements,"dataset.icid");evt=icidElements&&!isClose?{eventInfo:{eventAction:"load",eventType:"modal",timeStamp:(new Date).toString()},attributes:{modalID:modalID,modalName:utils.htmlSanitization(modalName),icidlist:lodash.uniq(allICID)}}:{eventInfo:{eventAction:isClose?"close":"load",eventType:"modal",timeStamp:(new Date).toString()},attributes:{modalID:modalID,modalName:utils.htmlSanitization(modalName),dynamicContent:dynamicContent}},pushEvent("MODAL_LOAD_EVENT",evt)},100)}function trackModalEvents(data){var evt={eventInfo:{eventAction:data.eventAction,eventType:"modal",timeStamp:(new Date).toString()},attributes:{modalID:data.modalID||"",modalName:data.modalName||""}};"load"===data.eventAction&&(evt.attributes.icidList=data.icid?[data.icid]:[]),evt.attributes.icidList&&evt.attributes.icidList.length<0&&data.targetUrl&&data.targetUrl.indexOf("icid")>-1&&evt.attributes.icidList.push(data.targetUrl.split("icid=")[1]),pushEvent("MODAL_LOAD_EVENT",evt)}function trackGenericClick(currentTarget,attributes){var moduleElement=angular.element(currentTarget).closest("[data-module-id]"),assetType=angular.element(currentTarget).data("assetType"),isButton=currentTarget.classList.contains("btn"),module=lodash.find($window.marketingDigitalData.page.modules.moduleListAll,function(moduleItem){
return moduleItem.ID===moduleElement.attr("data-analytics-id")});if(module){var href=currentTarget.getAttribute("href")?currentTarget.getAttribute("href"):"",isActionClick=""===href||0===href.indexOf("#")||0===href.indexOf("javascript"),evt={eventInfo:{eventAction:"click",eventType:isActionClick?"clickToAction":"clickToNavigate"},eventDescription:{PlacementID:module.placementID,dataAnalyticsID:module.ID,ctaName:utils.htmlSanitization(angular.element(currentTarget).text()),ModuleName:module.ID,targetUrl:currentTarget.getAttribute("href"),parentComponent:module.parentComponentType}};attributes&&(evt.attributes=attributes),"clickToNavigate"===currentTarget.getAttribute("click-event-type")&&(evt.eventInfo.eventType="clickToNavigate"),isButton?evt.eventDescription.assetType="button":evt.eventDescription.assetType="link",assetType&&(evt.eventDescription.assetType=assetType),pushEvent("CLICK_EVENT",evt)}}function trackClickEvent(data){var evt={eventInfo:{eventAction:"click",eventType:data.isActionClick?"clickToAction":"clickToNavigate"},eventDescription:{ctaName:data.ctaName||"",targetUrl:data.targetUrl||"",icid:data.icid||"",modalName:data.modalName||""}};""===evt.eventDescription.icid&&evt.eventDescription.targetUrl&&evt.eventDescription.targetUrl.indexOf("icid")>-1&&(evt.eventDescription.icid=evt.eventDescription.targetUrl.split("icid=")[1]),data.formName&&(evt.eventDescription.formName=data.formName),data.assetType&&(evt.eventDescription.assetType=data.assetType),pushEvent("CLICK_EVENT",evt)}function trackActionableElementClick(currentTarget,pageReach,dataModalName){var analyticsId=angular.element(currentTarget).attr("data-analytics-id"),moduleElement=angular.element(currentTarget).closest("[data-module-id]"),assetType=angular.element(currentTarget).data("assetType"),isButton=currentTarget.classList.contains("btn"),dataGameScreen=angular.element(currentTarget).data("game-screen"),dataIsModalLink=angular.element(currentTarget).data("is-modal-link"),module=lodash.find($window.marketingDigitalData.page.modules.moduleListAll,function(moduleItem){return lodash.find(moduleItem.actionableElements,function(actionableElement){return actionableElement.ID===analyticsId})});if(module||(module=lodash.find($window.marketingDigitalData.page.modules.moduleListAll,function(moduleItem){return moduleItem.ID===moduleElement.attr("data-analytics-id")})),module){var actionableElement=lodash.find(module.actionableElements,function(actionableElementItem){return actionableElementItem.ID===analyticsId}),href=currentTarget.getAttribute("href")?currentTarget.getAttribute("href"):"",tfnCtaName=utils.htmlSanitization(currentTarget.innerText);if(!actionableElement){var trackClick=currentTarget.getAttribute("data-analytics-track-click");trackClick&&(actionableElement={ID:currentTarget.getAttribute("data-analytics-id"),eventType:"click",targetUrl:href,type:isButton?"Button":"Link",text:tfnCtaName})}var isActionClick=(""===href||0===href.indexOf("#")||0===href.indexOf("javascript"))&&!dataIsModalLink,isClickToCall=0===href.indexOf("tel:");if(actionableElement&&"click"===actionableElement.eventType){var evt={eventInfo:{eventAction:"click",eventType:isActionClick?"clickToAction":isClickToCall?"clickToCall":"clickToNavigate"},eventDescription:{PlacementID:module.placementID,dataAnalyticsID:analyticsId,ModuleName:module.ID,targetUrl:actionableElement.targetUrl,parentComponent:module.parentComponentType},pageReach:{initial:pageReach.initial,maxReach:pageReach.maxReach,exitPoint:pageReach.exitPoint}};dataModalName&&(evt.eventDescription.modalName=utils.htmlSanitization(dataModalName));var analyticsCtaName=actionableElement.text;!analyticsCtaName&&currentTarget.text&&(analyticsCtaName=currentTarget.text);var analyticsText=currentTarget.getAttribute("data-analytics-text");analyticsText&&(analyticsCtaName=analyticsText),analyticsCtaName&&(evt.eventDescription.ctaName=utils.htmlSanitization(analyticsCtaName)),actionableElement.icid&&(evt.eventDescription.icid=actionableElement.icid),currentTarget.getAttribute("data-user-input")&&(evt.eventDescription.userInput=currentTarget.getAttribute("data-user-input")),isActionClick&&(evt.attributes=evt.attributes||{},evt.attributes.type=actionableElement.type),isButton?evt.eventDescription.assetType="button":evt.eventDescription.assetType="link",isClickToCall&&(evt.attributes=evt.attributes||{},/tel:/.test(href)?(evt.eventDescription.ctaName=utils.htmlSanitization(tfnCtaName),evt.eventDescription.targetUrl=href.split("tel:")[1],evt.attributes.tfn=href.split("tel:")[1]):evt.attributes.tfn=actionableElement.targetUrl),assetType&&(evt.eventDescription.assetType=assetType);var timeRemaining=moduleElement.data("timeRemaining");timeRemaining&&(evt.attributes=evt.attributes||{},evt.attributes.type="Timer",evt.attributes.assetType="Timer",evt.attributes.timeRemaining=timeRemaining.total,0===timeRemaining.total?evt.attributes.status="Expired":0===timeRemaining.days?evt.attributes.status="Urgent":evt.attributes.status="Non-urgent"),dataGameScreen&&(evt.eventDescription.screen=dataGameScreen),pushEvent("CLICK_EVENT",evt)}}}function trackArchiveFilterTagClick(data){var evt={eventInfo:{eventAction:"filter",eventType:"clickToAction"},eventDescription:{ctaName:data.ctaName,assetType:data.assetType,icid:data.icid?data.icid:"",filterName:data.filterName}};$window.triggerEvent&&$window.CLICK_EVENT&&($window.digitalData.events.push(evt),$window.triggerEvent($window.CLICK_EVENT))}function trackPaginationClick(pageName){var evt={eventInfo:{eventAction:"click",eventType:"clickToAction"},eventDescription:{assetType:"pagination",ctaName:"pagination click:"+pageName}};pushEvent("CLICK_EVENT",evt)}function trackGlobalNavigationShareClick(currentTarget){var navType=angular.element(currentTarget.target).attr("data-nav-type"),assetType=angular.element(currentTarget.target).attr("data-asset-type"),ctaName=angular.element(currentTarget.target).attr("aria-label"),targetUrl=angular.element(currentTarget.target).attr("href"),evt={eventInfo:{eventAction:"click",eventType:"navigation"},eventDescription:{navType:navType,category:"share",subCategory:"",assetType:assetType,ctaName:ctaName,targetUrl:targetUrl}};pushEvent("CLICK_EVENT",evt)}function trackSideBarClick(currentTarget){var analyticsId=angular.element(currentTarget).attr("data-analytics-id"),navType=(currentTarget.innerText,angular.element(currentTarget).attr("data-nav-type")),category=angular.element(currentTarget).attr("data-category"),subCategory=angular.element(currentTarget).attr("data-sub-category"),assetType=angular.element(currentTarget).attr("data-asset-type"),module=lodash.find($window.marketingDigitalData.page.modules.moduleListAll,function(moduleItem){return"Navigation"===moduleItem.parentComponentType||"Sticky Nav"===module.parentComponentType});if(module){var href=angular.element(currentTarget).attr("href")?angular.element(currentTarget).attr("href"):"",isClickToCall=0===href.indexOf("tel:"),actionableElement=lodash.find(module.actionableElements,function(actionableElementItem){return actionableElementItem.ID===analyticsId});if(actionableElement){var evt={eventInfo:{eventAction:"click",eventType:"navigation"},eventDescription:{category:"",subCategory:"",ctaName:"",targetUrl:actionableElement.targetUrl}};actionableElement.icid&&(evt.eventDescription.icid=actionableElement.icid),isClickToCall&&/tel:/.test(href)&&(evt={eventInfo:{eventAction:"click",eventType:"navigation"},eventDescription:{category:"",subCategory:"",ctaName:href.split("tel:")[1]},subInfo:[{eventType:"clickToCall",eventAction:"click"}]}),navType&&(evt.eventDescription.navType=navType),subCategory&&null!==category&&(evt.eventDescription.subCategory=subCategory),category?evt.eventDescription.category=category:(evt.eventDescription.category=subCategory,evt.eventDescription.subCategory=""),assetType&&(evt.eventDescription.assetType=assetType),pushEvent("CLICK_EVENT",evt)}}}function trackGlobalNavigationClick(currentTarget){var analyticsId=angular.element(currentTarget).attr("data-analytics-id"),tfnCtaName=utils.htmlSanitization(currentTarget.innerText),navType=angular.element(currentTarget).attr("data-nav-type"),category=angular.element(currentTarget).attr("data-category"),assetType=angular.element(currentTarget).attr("data-asset-type"),module=lodash.find($window.marketingDigitalData.page.modules.moduleListAll,function(moduleItem){return"Navigation"===moduleItem.parentComponentType||"Sticky Nav"===module.parentComponentType});if(module){var href=angular.element(currentTarget).attr("href")?angular.element(currentTarget).attr("href"):"",isClickToCall=0===href.indexOf("tel:"),actionableElement=lodash.find(module.actionableElements,function(actionableElementItem){return actionableElementItem.ID===analyticsId});if(actionableElement){var evt={eventInfo:{eventAction:"click",eventType:"navigation"},eventDescription:{category:"",subCategory:"",ctaName:utils.htmlSanitization(actionableElement.text),targetUrl:actionableElement.targetUrl}};actionableElement.icid&&(evt.eventDescription.icid=actionableElement.icid),isClickToCall&&(evt.attributes=evt.attributes||{},evt.eventInfo.eventType="navigation",/tel:/.test(href)?(evt.eventDescription.ctaName=tfnCtaName,evt.eventDescription.targetUrl=href.split("tel:")[1],evt.attributes.tfn=href.split("tel:")[1]):evt.attributes.tfn=actionableElement.targetUrl),navType&&(evt.eventDescription.navType=navType),category&&(evt.eventDescription.category=category,evt.eventDescription.subCategory=""),assetType&&(evt.eventDescription.assetType=assetType),pushEvent("CLICK_EVENT",evt)}}}function trackMixedMediaClick(deviceName,eventDescription){var evt={eventInfo:{eventAction:"click",eventType:"clickToAction"},attributes:{type:"navigation"},eventDescription:{assetType:"navigation",ctaName:deviceName+" | Media Carousel Click | "+eventDescription}};pushEvent("CLICK_EVENT",evt)}function trackMixedMediaPlayClick(deviceName){var evt={eventInfo:{eventAction:"play",eventType:"videoAction"},eventDescription:{videoName:"DONT HAVE VIDEO NAME",ModuleName:deviceName+": PDP"}};pushEvent("CLICK_EVENT",evt)}function trackVideoTimeUpdate(videoName,moduleName,placementId,milestone){var evt={eventInfo:{eventAction:"milestone",eventType:"videoAction"},eventDescription:{videoName:videoName,ModuleName:moduleName,PlacementID:placementId,milestone:milestone}};trackVideoEvent(evt)}function trackVideoEnded(videoName,moduleName,placementId){var evt={eventInfo:{eventAction:"complete",eventType:"videoAction"},eventDescription:{videoName:videoName,ModuleName:moduleName,PlacementID:placementId}};trackVideoEvent(evt)}function trackVideoSeeked(videoName,moduleName,placementId){var evt={eventInfo:{eventAction:"scrub",eventType:"videoAction"},eventDescription:{videoName:videoName,ModuleName:moduleName,PlacementID:placementId}};trackVideoEvent(evt)}function trackVideoPause(videoName,moduleName,placementId){var evt={eventInfo:{eventAction:"pause",eventType:"videoAction"},eventDescription:{videoName:videoName,ModuleName:moduleName,PlacementID:placementId}};trackVideoEvent(evt)}function trackVideoPlay(videoName,moduleName,placementId){var evt={eventInfo:{eventAction:"play",eventType:"videoAction"},eventDescription:{videoName:videoName,ModuleName:moduleName,PlacementID:placementId}};trackVideoEvent(evt)}function trackVideoEvent(evt){pushEvent("CLICK_EVENT",evt)}function trackEvent(eventName,analyticsID,data){var module=getModule(analyticsID);if(module)if(data.eventDescription){var analyticsData=lodash.merge({eventDescription:{ModuleName:module.titleText||"",PlacementID:module.placementID||"",parentComponent:module.parentComponentType||"",dataAnalyticsID:analyticsID}},data);pushEvent(eventName,analyticsData)}else pushEvent(eventName,data)}function trackServiceError(errorData,errorCode){var evt={eventInfo:{eventAction:"click",eventType:"error"},eventDescription:[{errorText:errorData,errorCode:errorCode}]};pushEvent("ERROR_EVENT",evt)}function getAnalytics(){var deferred=$q.defer(),cancelCheck=function(){$interval.cancel(check),check=null},check=$interval(function(){window.triggerEvent&&(deferred.resolve(),cancelCheck())},100);return deferred.promise}var analyticsCalls=[],pageNeedsContentLoadEvent=!1,hasPageLoadEventFiredPromise=!1,hasContentLoadEventPushed=!1,pollingForPageLoad=!1;return $window.marketingConfig&&(pageNeedsContentLoadEvent=$window.marketingConfig.hasPersonalizedModule||$window.marketingConfig.hasPersonalizedPage),{pushEvent:pushEvent,checkPageLoad:checkPageLoad,checkToProcess:checkToProcess,processEvents:processEvents,analyticsCalls:analyticsCalls,trackPageLoad:trackPageLoad,trackModuleView:trackModuleView,trackAsyncPage:trackAsyncPage,trackAsyncModule:trackAsyncModule,trackCarousel:trackCarousel,trackCarouselModalLink:trackCarouselModalLink,trackAccordion:trackAccordion,trackTool:trackTool,trackForm:trackForm,trackFormSubmit:trackFormSubmit,trackCheckbox:trackCheckbox,trackSlider:trackSlider,trackModal:trackModal,trackModalEvents:trackModalEvents,trackGenericClick:trackGenericClick,trackClickEvent:trackClickEvent,trackMixedMediaClick:trackMixedMediaClick,trackMixedMediaPlayClick:trackMixedMediaPlayClick,trackActionableElementClick:trackActionableElementClick,trackGlobalNavigationClick:trackGlobalNavigationClick,trackGlobalNavigationShareClick:trackGlobalNavigationShareClick,trackVideoTimeUpdate:trackVideoTimeUpdate,trackVideoEnded:trackVideoEnded,trackVideoSeeked:trackVideoSeeked,trackVideoPause:trackVideoPause,trackVideoPlay:trackVideoPlay,trackEvent:trackEvent,getAnalytics:getAnalytics,trackArchiveFilterTagClick:trackArchiveFilterTagClick,trackPaginationClick:trackPaginationClick,trackArchiveAngularLoad:trackArchiveAngularLoad,trackServiceError:trackServiceError,trackSideBarClick:trackSideBarClick,trackToolWithDynamicContent:trackToolWithDynamicContent}}analyticsUtils.$inject=["$q","$interval","$document","$timeout","utils","$window","$location"],angular.module("marketingCore").factory("analyticsUtils",analyticsUtils)}(window.angular,window._),function(angular){"use strict";function cartHttpWrapperConstructor($q,httpRequestWrapper,cartStorage,transformCart,loggingService,CART_WRAPPER_ERROR_MAP,toggleService){function post(url,data,query,callName,apiKey,header){var deferred=$q.defer();return httpRequestWrapper.post(url,data,query,header,!0,apiKey).then(function(cartResponse){if(angular.equals(cartResponse.status,200)){var transformCartFactory=transformCart.getFactory(apiKey),transformedCart=transformCartFactory.transformCartData(cartResponse.data);cartStorage.setGlobalSmartCartInfo(transformedCart,!0),transformedCart.status=cartResponse.status,deferred.resolve(transformedCart)}else{var error=CART_WRAPPER_ERROR_MAP[callName];loggingService.error(error.message),deferred.reject({error:"error"})}}),deferred.promise}function put(url,data,query,callName,apiKey){var header,deferred=$q.defer();return httpRequestWrapper.put(url,data,query,header,!0,apiKey).then(function(cartResponse){if(angular.equals(cartResponse.status,200)){var transformCartFactory=transformCart.getFactory(apiKey),transformedCart=transformCartFactory.transformCartData(cartResponse.data);cartStorage.setGlobalSmartCartInfo(transformedCart),transformedCart.status=cartResponse.status,deferred.resolve(transformedCart)}else{var error=CART_WRAPPER_ERROR_MAP[callName];loggingService.error(error.message),deferred.reject({error:"error"})}}),deferred.promise}function get(url,query,callName,apiKey){var header,deferred=$q.defer();return httpRequestWrapper.get(url,query,header,!0,apiKey).then(function(cartResponse){if(angular.equals(cartResponse.status,200)){var transformCartFactory=transformCart.getFactory(apiKey),transformedCart=transformCartFactory.transformCartData(cartResponse.data);cartStorage.setGlobalSmartCartInfo(transformedCart),transformedCart.status=cartResponse.status,deferred.resolve(transformedCart)}else{var error=CART_WRAPPER_ERROR_MAP[callName];loggingService.error(error.message),deferred.reject({error:"error"})}}),deferred.promise}function deleteRequest(url,query,callName,apiKey,header){var deferred=$q.defer(),toggles=toggleService.model.toggles;return toggles.isDcpV3ApiEnabled||(header?header["content-Type"]="application/json":header={"content-Type":"application/json"}),httpRequestWrapper["delete"](url,query,header,!0,apiKey).then(function(cartResponse){if(angular.equals(cartResponse.status,200)){var transformCartFactory=transformCart.getFactory(apiKey),transformedCart=transformCartFactory.transformCartData(cartResponse.data);cartStorage.setGlobalSmartCartInfo(transformedCart,!0),transformedCart.status=cartResponse.status,deferred.resolve(transformedCart)}else if(angular.equals(cartResponse.status,204))deferred.resolve();else{var error=CART_WRAPPER_ERROR_MAP[callName];loggingService.error(error.message),deferred.reject({error:"error"})}}),deferred.promise}function patch(url,data,query,callName,apiKey){var header,deferred=$q.defer();return httpRequestWrapper.patch(url,data,query,header,!0,apiKey).then(function(cartResponse){if(angular.equals(cartResponse.status,200)){var transformCartFactory=transformCart.getFactory(apiKey),transformedCart=transformCartFactory.transformCartData(cartResponse.data);cartStorage.setGlobalSmartCartInfo(transformedCart),transformedCart.status=cartResponse.status,deferred.resolve(transformedCart)}else{var error=CART_WRAPPER_ERROR_MAP[callName];loggingService.error(error.message),deferred.reject({error:"error"})}}),deferred.promise}return{post:post,get:get,put:put,"delete":deleteRequest,patch:patch}}cartHttpWrapperConstructor.$inject=["$q","httpRequestWrapper","cartStorage","transformCart","loggingService","CART_WRAPPER_ERROR_MAP","toggleService"],angular.module("tmobileApp").service("cartHttpWrapper",cartHttpWrapperConstructor).constant("CART_WRAPPER_ERROR_MAP",{addNewLine:{message:"We have an error adding new line to cart."},addToLine:{message:"We have an error adding device to cart."},removeDeviceFromLine:{message:"We have an error adding device to cart."},getCart:{message:"We have an error in getting full cart."},duplicateLine:{message:"We have an error adding new line to cart."},submitSelectedPlan:{message:"We have an error submitting Selected Plan."},deleteAccessoryFromCart:{message:"We have an error removing Accessory from cart."},removeLine:{message:"We have an error removing line from cart."},postPromoCode:{message:"We have an error posting PromoCode."},deletePromoCode:{message:"We have an error removing PromoCode."},addServicesToLine:{message:"We have an error adding Services To Line."},toggleSelectedPlan:{message:"We have an error toggling SelectedPlan."},LoadCart:{message:"We have an error loading saved cart."},deletePlan:{message:"We have an error deleting cart plan."},deleteCart:{message:"We have an error deleting cart."},deleteCreditProfile:{message:"We have an error deleting credit profile."},financeEstimates:{message:"We have an error posting finance estimates."}})}(angular),function(angular){"use strict";function backgroundVideo($q,$cookies,$http,$log){function getVideoSrc(videoId){function onSuccess_http(response){if(response.data&&response.data.sources&&response.data.sources.length>0){var src,greatestWidth=0;_.forEach(response.data.sources,function(source){"H264"===source.codec&&"MP4"===source.container&&parseInt(source.width)>greatestWidth&&(greatestWidth=parseInt(source.width),src=source.src)}),src=src.split("http:").join("https:"),deferred.resolve(src),$cookies.put("tmo_brightcove_"+videoId,src,{expires:new Date((new Date).getTime()+216e5)})}else $log.error("Problem loading Brightcove video"+videoId)}function onError_http(response){$log.error("Problem loading Brightcove video"+videoId)}var deferred=$q.defer();return $cookies.get("tmo_brightcove_"+videoId)?deferred.resolve($cookies.get("tmo_brightcove_"+videoId)):$http({method:"GET",url:"https://edge.api.brightcove.com/playback/v1/accounts/"+accountId+"/videos/"+videoId,headers:{Accept:"application/json;pk="+policyKey}}).then(onSuccess_http,onError_http),deferred.promise}var accountId=window.marketingConfig.brightcoveAccountId||"1403111602001",policyKey=window.marketingConfig.brightcovePolicyKey||"BCpkADawqM3ZkjuvYElR-OetC9CHIOCPtcwNX93tbS2cgsUuA3MwbZHkOt4qxDPUH0UKKEY3eGOeu0y5_6DDCjMF1eVaGRbC4qC2pP9SMCwIWnm93QUlI_ERj_aj3OpR2KO0rPg6ggwbpsJc";return{getVideoSrc:getVideoSrc}}backgroundVideo.$inject=["$q","$cookies","$http","$log"],angular.module("marketingCore").factory("backgroundVideo",backgroundVideo)}(angular),function(angular,lodash){"use strict";function essentialsServiceFn($q,$timeout,apiService,httpRequestWrapper,cartStorage,creditClassService,cartHttpWrapper,cartConstants,dataFactory,globalValue,commonServices,transformCart,cartHttpDataService,$rootScope,globalConfig,coreServices,toggleService,essentialsServiceCart){function httpResponseDataHandling(eligablePlansDeferred,dfRequest,response){angular.equals(response.status,constant.SUCCESS_CODE)?(lodash.get(toggleService.model,"toggles.isCachingDisabledForPlans",!1)||dataFactory.setVO(constant.CACHE.DATA_KEY,dfRequest,response.data),eligablePlansDeferred.resolve(response.data)):eligablePlansDeferred.reject({error:constant.ERROR_TEXT})}function getMatchedPlanData(authoredPlans,planType){return lodash.isArray(authoredPlans)?lodash.find(authoredPlans,function(plan){return plan.planType===planType}):authoredPlans}function getAuthorPlans(lineType,authoredPlanData){switch(lineType){case cartConstants.DEVICE_TYPE.HANDSET:return authoredPlanData.devicePlans;case cartConstants.DEVICE_TYPE.TABLET:return authoredPlanData.tabletPlans;case cartConstants.DEVICE_TYPE.WEARABLE:return authoredPlanData.wearablePlans}}function getDataSocPrice(dataSocObject){_self.flag=!0;var dataSocPrice=0;return dataSocObject.monthlyPrice&&dataSocObject.monthlyPrice.salePrice&&dataSocObject.monthlyPrice.salePrice.amount&&(dataSocPrice+=dataSocObject.monthlyPrice.salePrice.amount),dataSocPrice}function getServicePrice(service){var servicePrice=0;return service.pricing&&service.pricing.amount&&(servicePrice+=service.pricing.amount),servicePrice}function checkIfDataSoc(Socs,eligiblePlans){for(var soc=Socs[0],i=0;i<eligiblePlans.length;i++)if(eligiblePlans[i].planOptions&&eligiblePlans[i].planOptions.length){var dataSocs=eligiblePlans[i].planOptions,addOnObject=lodash.find(dataSocs,function(dataSoc){return dataSoc.soc===soc&&!dataSoc["default"]});if(!lodash.isEmpty(addOnObject))return addOnObject}return!1}var _self=this;$q.defer();_self.authorValue=globalValue.authorValue;var $log=commonServices.$log,constant=cartConstants.ESSENTIALS_CONSTANT;return _self.getApiUrl=function(urlToGet,cartId,lineId){var urlObject=apiService.getURL(urlToGet);return urlObject.url.replace("{{cartID}}",cartId).replace("{{lineID}}",lineId)},_self.getPatchApiUrl=function(urlToGet,cartId,lineId,planId){var urlObject=apiService.getURL(urlToGet);return urlObject.url.replace("{{cartID}}",cartId).replace("{{lineID}}",lineId).replace("{{planID}}",planId)},_self.createEmptyLine=function(requestObject,cartData){var cartId=cartStorage.getCartId();if(!lodash.isEmpty(requestObject)&&!lodash.isEmpty(cartData)&&!lodash.isEmpty(cartId)){var lineType=requestObject.subType,urlObject=apiService.getURL(constant.ADD_NEW_LINE);lodash.isEmpty(urlObject)||(urlObject.url=urlObject.url.replace("{{cartID}}",cartId));var body,query={subType:lineType,creditLevel:creditClassService.getEPCreditClass()||constant.CREDIT_LEVEL_GOOD},header={"x-applicationId":constant.APPLICATION_ID_VALUE};return 2===urlObject.version?(body={lineType:lineType,lineNumber:cartData?cartData.structCartData.totalLines+1:1,transactionCode:constant.TRANSACTION_CODE,lineName:cartData?cartData.structCartData.totalLines+1:1},header.follow=constant.TRUE):body={subType:lineType},0===cartData.structCartData.totalLines?cartHttpWrapper.post(urlObject.url,body,query,constant.ADD_NEW_LINE,constant.ADD_NEW_LINE,header).then(function(response){_self.getEligiblePlansForLineType(response.lineItems[0].lineId,lineType)}):cartHttpWrapper.post(urlObject.url,body,query,constant.ADD_NEW_LINE,constant.ADD_NEW_LINE,header)}},_self.getEligiblePlansForLineType=function(lineId){var lineTypeArray=[cartConstants.DEVICE_TYPE.TABLET,cartConstants.DEVICE_TYPE.WEARABLE,cartConstants.DEVICE_TYPE.HANDSET];lodash.forEach(lineTypeArray,function(type){_self.getEligiblePlans(lineId,type,!1)})},_self.getEligiblePlans=function(lineId,planType,defaultPlan){var eligablePlansDeferred=$q.defer(),cartId=cartStorage.getCartId();if(lodash.isEmpty(cartId))return Promise.reject({error:constant.ERROR_TEXT});var url=_self.getApiUrl(constant.GET_ELIGIBLE_PLANS,cartId,lineId),dfRequest=new dataFactory.DFRequest;if(!lodash.get(toggleService.model,"toggles.isCachingDisabledForPlans",!1)){dfRequest.input={apiKey:constant.GET_ELIGIBLE_PLANS,planType:planType};var cacheKey=constant.CACHE.DATA_KEY+JSON.stringify(dfRequest.input),dataCache=dataFactory.getCacheObject(constant.CACHE.NAME),cachedEligiblePlans=dataCache.get(cacheKey);if(!lodash.isEmpty(cachedEligiblePlans))return $timeout(function(){eligablePlansDeferred.resolve(cachedEligiblePlans)},0),eligablePlansDeferred.promise}if(toggleService.model.toggles.isDcpV3ApiEnabled){var query={"plan-type":planType};httpRequestWrapper.get(url,query,void 0,!0,constant.GET_ELIGIBLE_PLANS).then(function(response){httpResponseDataHandling(eligablePlansDeferred,dfRequest,response)},function(){eligablePlansDeferred.reject({error:constant.ERROR_TEXT})})}else{var inputData={planType:planType,defaultPlan:defaultPlan};httpRequestWrapper.post(url,inputData,"",void 0,!0,constant.GET_ELIGIBLE_PLANS).then(function(response){httpResponseDataHandling(eligablePlansDeferred,dfRequest,response)},function(){eligablePlansDeferred.reject({error:constant.ERROR_TEXT})})}return eligablePlansDeferred.promise},_self.postSelectedPlanToLine=function(lineId,selectedPlan,addFollowHeader){var header,cartId=cartStorage.getCartId(),lineType=_self.getLineType(lineId);if(lodash.isEmpty(cartId))return Promise.reject({error:constant.ERROR_TEXT});var url=_self.getApiUrl(constant.POST_PLAN_TO_LINE,cartId,lineId),inputData=_self.getInputDataForPostPlan(lineType,selectedPlan);return addFollowHeader&&(header={follow:!0}),httpRequestWrapper.post(url,inputData,"",header,!0,constant.POST_PLAN_TO_LINE)},_self.getLineType=function(lineId){var lineType="",cartData=cartStorage.getGlobalSmartCartInfo();if(!lodash.isEmpty(cartData)&&!lodash.isEmpty(cartData.lineItems)){var lineObject=lodash.find(cartData.lineItems,function(lineItem){return lineItem.lineId===lineId});lodash.isEmpty(lineObject)||(lineType=lineObject.lineType)}return lineType},_self.getInputDataForPostPlan=function(lineType,selectedPlan){return lineType.toLowerCase()===cartConstants.DEVICE_TYPE.HANDSET.toLowerCase()?{offerFamilyId:selectedPlan.offerFamilyId,planOptions:[{soc:selectedPlan.planOptions[0].soc}]}:{offerFamilyId:selectedPlan.offerFamilyId}},_self.deletePlan=function(selectedLine){var cartId=cartStorage.getCartId();if(!lodash.isEmpty(cartId)&&lodash.get(selectedLine,"lineId",!1)&&lodash.get(selectedLine,"lineItemDetails.planDetails.id",!1)){var urlObject=apiService.getURL("deletePlan"),apiURL=urlObject.url;apiURL=apiURL.replace("{{cartID}}",cartId).replace("{{lineID}}",selectedLine.lineId).replace("{{planID}}",selectedLine.lineItemDetails.planDetails.id);var header={follow:!0};return cartHttpWrapper["delete"](apiURL,null,"deletePlan","deletePlan",header)}return Promise.reject({error:constant.ERROR_TEXT})},_self.setEligiblePlan=function(planType,ineligibleModalFlag){var deferTest=$q.defer(),carDataGlobal=cartStorage.getGlobalSmartCartInfo(),cartDataCount=carDataGlobal.lineItems.length,itemCount=cartDataCount;return lodash.get(toggleService.model,"toggles.isDcpV3ApiEnabled",!1)?essentialsServiceCart.changePlan(planType):(ineligibleModalFlag?_self.clearPlan(carDataGlobal,planType,itemCount-1).then(function(){deferTest.resolve()}):_self.clearPlan(carDataGlobal,planType,itemCount).then(function(){deferTest.resolve()}),deferTest.promise)},_self.clearPlan=function(cartData,planType,itemCount){function deletePlanFromLine(newCartData,newAuthorValueOfferId,newItemCount){var item=newCartData.lineItems[newItemCount-1];angular.isDefined(item)&&newItemCount>0&&_self.deletePlan(item).then(function(deletePlanResponse){if(angular.equals(deletePlanResponse.status,200)){if(newItemCount-=1,0===newItemCount)return _self.fetchEligiblePlan(newAuthorValueOfferId).then(function(){fetchPlanDefer.resolve()});newItemCount>0&&(newCartData.lineItems[newItemCount-1].lineItemDetails.planDetails.id=deletePlanResponse.lineItems[newItemCount-1].lineItemDetails.planDetails.id,deletePlanFromLine(newCartData,newAuthorValueOfferId,newItemCount))}else $log.log("Default Plan Error")})}var fetchPlanDefer=$q.defer();return deletePlanFromLine(cartData,planType,itemCount),fetchPlanDefer.promise},_self.fetchEligiblePlan=function(planType){function getEligiblePlansAndPostPlan(lineItem){_self.getEligiblePlans(lineItem.lineId,lineItem.lineType,!1).then(function(eligiblePlanResponse){var selectedPlan=_self.getSelectedPlanToPost(lineItem,eligiblePlanResponse.eligiblePlans,planType);_self.postSelectedPlanToLine(lineItem.lineId,selectedPlan).then(function(result){postCount+=1,cartStorage.setServiceOptions(lineItem.lineId,!1),postCount===count?cartHttpDataService.getCart().then(function(response){$log.log("Updated Plan response: "+response),postdefer.resolve()}):getEligiblePlansAndPostPlan(cartData.lineItems[postCount]),$log.log("Post selected Plan response: "+result)})},function(error){$log.log("Error fetching eligible plans data: ",error)})}var postCount=0,postdefer=$q.defer(),cartData=cartStorage.getGlobalSmartCartInfo(),count=cartData.lineItems.length;return getEligiblePlansAndPostPlan(cartData.lineItems[postCount]),postdefer.promise},_self.getSelectedPlanToPost=function(lineItem,eligiblePlanResponse,planType){var essentialsPlanData=globalValue.authorValue.cart.essentials,authoredPlans=getAuthorPlans(lineItem.lineType,essentialsPlanData),matchedPlan=getMatchedPlanData(authoredPlans,planType),planToPost=lodash.find(eligiblePlanResponse,function(plan){return plan.offerFamilyId===matchedPlan.familyOfferId}),defaultPlanOption=lodash.find(planToPost.planOptions,function(option){return option["default"]===!0});return defaultPlanOption?{offerFamilyId:planToPost.offerFamilyId,planOptions:[{soc:defaultPlanOption.soc}]}:{offerFamilyId:planToPost.offerFamilyId}},_self.calculateAddOnsV3=function(lineItems){var addOnsPriceV3=0;return addOnsPriceV3+=lodash.get(lineItems.planDetails,"dataOptionsPrice.salePrice.amount",0),angular.forEach(lineItems.serviceDetails,function(service){addOnsPriceV3+=getServicePrice(service)}),addOnsPriceV3},_self.calculateAddOns=function(services,deviceType,lineId,dataSocs){var addOnsPrice=0,dataSocCheckResult=!1,eligiblePlansResponse={},addOnDeferred=$q.defer();return toggleService.model.toggles.isDcpV3ApiEnabled?addOnDeferred.resolve(addOnsPrice):_self.getEligiblePlans(lineId,deviceType,!1).then(function(response){eligiblePlansResponse=response,!eligiblePlansResponse||lodash.isEmpty(eligiblePlansResponse.eligiblePlans)||lodash.isEmpty(dataSocs)||(dataSocCheckResult=checkIfDataSoc(dataSocs,eligiblePlansResponse.eligiblePlans)),dataSocCheckResult&&(addOnsPrice+=getDataSocPrice(dataSocCheckResult)),angular.forEach(services,function(service){addOnsPrice+=getServicePrice(service)}),addOnDeferred.resolve(addOnsPrice)},function(){addOnDeferred.reject({error:constant.ERROR_TEXT})}),addOnDeferred.promise},_self.calculateDiscount=function(lineItem){var totalDiscount=0;return lineItem.discount&&(totalDiscount=parseFloat(lodash.get(lineItem.discount,"discountValue.amount",0))),lineItem.lineItemDetails.planDetails&&lineItem.lineItemDetails.planDetails.promotions&&angular.forEach(lineItem.lineItemDetails.planDetails.promotions,function(promotion){totalDiscount+=parseFloat(lodash.get(promotion,"discountValue.amount",0))}),lineItem.lineItemDetails.deviceDetails&&lineItem.lineItemDetails.deviceDetails.credits&&angular.forEach(lineItem.lineItemDetails.deviceDetails.credits,function(recurringCredit){
totalDiscount+=parseFloat(lodash.get(recurringCredit,"salePrice.amount",0))}),totalDiscount},_self.calculateLinePrice=function(lineItem){var linePriceDeferred=$q.defer(),eligiblePlanResponse={},linePrice=_.get(lineItem.lineItemDetails,"monthlyPaymentDetails[0].charge",0),planSocs=_.get(lineItem.lineItemDetails,"planDetails.planSOCs",0);if(planSocs&&planSocs.length>0){var socId=planSocs[0];_self.getEligiblePlans(lineItem.lineId,lineItem.lineType,!1).then(function(response){lodash.isEmpty(response)?linePriceDeferred.reject({error:constant.ERROR_TEXT}):(eligiblePlanResponse=response,angular.forEach(eligiblePlanResponse.eligiblePlans,function(eligiblePlan){angular.forEach(eligiblePlan.planOptions,function(planOption){planOption.soc===socId&&(linePrice-=planOption.monthlyPrice.salePrice.amount,linePriceDeferred.resolve(linePrice))})}),linePriceDeferred.resolve(linePrice))},function(){linePriceDeferred.reject({error:constant.ERROR_TEXT})})}else linePriceDeferred.resolve(linePrice);return linePriceDeferred.promise},_self.getNonDefaultDataSocDetails=function(lineItem){var deferred=$q.defer(),eligiblePlanResponse={},dataSocDetails=void 0,planSocs=lodash.get(lineItem.lineItemDetails,"planDetails.planSOCs"),essentialsPlanData=lodash.get(globalValue.authorValue,"rootPage.pricingBreakdown");if(planSocs&&planSocs.length>0){var socId=planSocs[0];_self.getEligiblePlans(lineItem.lineId,lineItem.lineType,!1).then(function(response){eligiblePlanResponse=response,eligiblePlanResponse&&angular.forEach(eligiblePlanResponse.eligiblePlans,function(eligiblePlan){angular.forEach(eligiblePlan.planOptions,function(planOption){planOption.soc!==socId||planOption["default"]||(dataSocDetails={payNowPrice:0,monthlyDisplayPrice:lodash.get(planOption.monthlyPrice,"salePrice.display","$0"),monthlyDisplayAmount:lodash.get(planOption.monthlyPrice,"salePrice.amount","0"),displayName:lodash.get(planOption,"displayName")},dataSocDetails.dataSocMessage=essentialsPlanData.dataSocAmountText?essentialsPlanData.dataSocAmountText.replace("$dataSocPrice",dataSocDetails.monthlyDisplayPrice).replace("$dataSocName",dataSocDetails.displayName):"")})}),deferred.resolve(dataSocDetails)},function(){deferred.reject({error:constant.ERROR_TEXT})})}else deferred.resolve(dataSocDetails);return deferred.promise},_self.patchPlanToLine=function(lineItem,selectedPlan,addFollowHeader){var header,cartId=cartStorage.getCartId(),planId=(_self.getLineType(lineItem.lineId),lodash.get(lineItem,"lineItemDetails.planDetails.id")),lineId=lodash.get(lineItem,"lineId");if(lodash.isEmpty(cartId)||lodash.isEmpty(planId)||lodash.isEmpty(lineId))return Promise.reject({error:constant.ERROR_TEXT});var url=_self.getPatchApiUrl(constant.PATCH_PLAN_TO_LINE,cartId,lineId,planId);return addFollowHeader&&(header={follow:!0}),coreServices.httpRequestWrapper.patch(url,selectedPlan,"",header,!0,constant.PATCH_PLAN_TO_LINE)},_self}essentialsServiceFn.$inject=["$q","$timeout","apiService","httpRequestWrapper","cartStorage","creditClassService","cartHttpWrapper","cartConstants","dataFactory","globalValue","commonServices","transformCart","cartHttpDataService","$rootScope","globalConfig","coreServices","toggleService","essentialsServiceCart"],angular.module("tmobileApp").service("essentialsService",essentialsServiceFn)}(window.angular,_),function(angular){"use strict";function csrfTokenUtils($http,$q,$log){function getCSRF(token){var request={method:"GET",url:"/libs/granite/csrf/token.json",headers:{Authorization:"Basic "+token}};return $http(request).then(function(response){return 200===response.status?$q.resolve(response.data.token):$q.reject("Error response had no token data.")},function(response){return $log.error("error csrf ",response),$q.reject("Error making request for CSRF Token.")})}return{getCSRF:getCSRF}}csrfTokenUtils.$inject=["$http","$q","$log"],angular.module("marketingCore").factory("csrfTokenUtils",csrfTokenUtils)}(angular),function(angular,lodash){"use strict";function DevicePDPServiceFn($injector,httpRequestWrapper,commonUtils,apiURLs,toggleService,pdpResponseTransformationServicePDPV2,globalValue){function getProductResponse(url,body,query,header,isV2API,input){return toggleService.model.toggles.turnPdpCacheOn&&aemCachedPdpUrl&&checkForPdpCacheAuthoring(input.productCategory,input.familyId)?httpRequestWrapper.get(aemCachedPdpUrl).then(function(response){return 200!==response.status||_.isEmpty(response.data)||_.isEmpty(response.data.products)?actualDCPCall(url,body,query,header,isV2API):response}):actualDCPCall(url,body,query,header,isV2API)}function checkForPdpCacheAuthoring(productCategory,offerId){var pdpCBAuthoring=commonUtils.searchJson(globalValue,"rootPage.pdpCircuitBreakerAuthoring"),status=!0;if(pdpCBAuthoring)switch(productCategory){case"phone":status=verifyPdpCacheAuthoring(pdpCBAuthoring.overridePhonePDP,pdpCBAuthoring.phoneOfferIDOverride,offerId);break;case"internet-device":status=verifyPdpCacheAuthoring(pdpCBAuthoring.overrideInternetPDP,pdpCBAuthoring.mbbOfferIDOverride,offerId);break;case"accessory":status=verifyPdpCacheAuthoring(pdpCBAuthoring.overrideAccessoryPDP,pdpCBAuthoring.accessoryOfferIDOverride,offerId)}return status}function verifyPdpCacheAuthoring(isAllPdpSelected,authoredOfferId,offerId){return isAllPdpSelected&&"false"!==isAllPdpSelected?!0:angular.isDefined(authoredOfferId)&&_.isArray(authoredOfferId)?_.includes(authoredOfferId,offerId):offerId===authoredOfferId}function actualDCPCall(url,body,query,header,isV2API){return isV2API?httpRequestWrapper.post(url,body,query,header,!0,"plpV2"):httpRequestWrapper.get(url,query,header,!0)}function obtainObject(input,callback){var header={},body={},url=apiURLs.snpMiniBrowse+input.familyId,V2API=toggleService.model.toggles.toggleV2API;aemCachedPdpUrl=apiURLs.product.detail.pdpCacheData[input.productCategory],aemCachedPdpUrl=aemCachedPdpUrl.replace("{offerId}",input.familyId),toggleService.model.toggles.isCircuitBreaker&&(header["cb-response"]=aemCachedPdpUrl),V2API&&(url=apiURLs.snpMiniBrowse2+input.familyId),vm.familyId=input.familyId,getProductResponse(url,body,null,header,V2API,input).then(function(response){var responeBkp=angular.equals(V2API,!0)?pdpResponseTransformationServicePDPV2.getTransformedV2APIResponse(response,V2API):response;if(lodash.get(responeBkp,"data.productdetails")){var globalValue=$injector.get("globalValue"),override=lodash.get(globalValue,"authorValue.rootPage.overrideInvStatus.invStatusDetails",[]);override=lodash.isArray(override)?override:[override],lodash.forEach(override,function(item){angular.isString(item)&&(item=angular.fromJson(item)),lodash.forEach(responeBkp.data.productdetails,function(pdp,key){pdp.familyId=vm.familyId,angular.equals(pdp.SKU.toString(),item.sku.toString())&&item.status&&(pdp.InvStatus=item.status)})})}callback&&callback(responeBkp)})}var aemCachedPdpUrl,vm=this;vm.obtainObject=obtainObject,vm.checkForPdpCacheAuthoring=checkForPdpCacheAuthoring}DevicePDPServiceFn.$inject=["$injector","httpRequestWrapper","commonUtils","apiURLs","toggleService","pdpResponseTransformationServicePDPV2","globalValue"],angular.module("tmobileApp").service("devicePDPService",DevicePDPServiceFn)}(window.angular,_),function(angular,uuid){"use strict";function JWToken($q,$log,$base64,apiURLs,globalConfig,marketingHttpRequest,authTokenManager){function getJSONWebToken(){var jsonWebToken=authTokenManager.getTokenCookies("JSONWebToken",angular.equals(apiURLs.storage,"localStorage"))||null,deferred=$q.defer();return null===jsonWebToken||moment(new Date(jsonWebToken.timeStamp)).add(jsonWebToken.expires_in,"milliseconds").isBefore(moment())?JSONWebTokenRequest().then(function(tokenResponse){return tokenResponse?(setTokenExpIntervalTime(),tokenResponse.access_token):(deferred.reject(),deferred.promise)}):(deferred.resolve(jsonWebToken.access_token),deferred.promise)}function setTokenExpIntervalTime(){var jsonWebToken=authTokenManager.getTokenCookies("JSONWebToken",angular.equals(apiURLs.storage,"localStorage"))||null;if(null!=jsonWebToken){var delay=moment(new Date(jsonWebToken.timeStamp)).add(jsonWebToken.expires_in,"milliseconds")-moment();setTimeout(function(){getJSONWebToken()},delay)}}function getAuthorizationToken(){var jwtData=globalConfig.credentials.jwt,authorizationCode=jwtData.consumer_key+":"+jwtData.consumer_secret;return authorizationCode=$base64.encode(authorizationCode),authorizationCode="Basic "+authorizationCode}function JSONWebTokenRequest(){var url=apiURLs.JWToken,JSONWebTokenData={},headers={Authorization:getAuthorizationToken()};return marketingHttpRequest.authPost(url,headers).then(function(response){return 200===response.status&&(JSONWebTokenData={timeStamp:(new Date).toString(),access_token:response.data.access_token,expires_in:response.data.expires_in-6e4,usn:uuid.create().toString()},authTokenManager.setTokenCookies(JSONWebTokenData,"JSONWebToken",angular.equals(apiURLs.storage,"localStorage"))),JSONWebTokenData})}return{getJSONWebToken:getJSONWebToken,setTokenExpIntervalTime:setTokenExpIntervalTime}}JWToken.$inject=["$q","$log","$base64","apiURLs","globalConfig","marketingHttpRequest","authTokenManager"],angular.module("marketingCore").factory("JWToken",JWToken)}(angular,window.UUIDjs),function(angular,lodash){"use strict";function cartStateChangeServiceConstructor(commonServices,coreServices,shippingUtil,checkOutHttpDataUtil,apiService,cartHttpDataService,responseTransformationService,FRAUD_FAIL_STATE_NAME,CHECKOUT_STATE_NAME,CART_STATE_NAME,toggleService,commonStorage,$injector,cartConstants){function promiseResolve(){var defer=$q.defer();return defer.resolve(),defer.promise}function checkOutHandoff(toState,cartId){return angular.equals(CHECKOUT_STATE_NAME,toState)?globalConfig.isAuthorMode?promiseResolve():checkOutHttpDataUtil.loadCheckOutHandOffData(cartId).then(function(checkOutInfo){return checkOutInfo?(checkOutInfo.initData||(checkOutInfo.initData={}),cartStorage.setGlobalCheckOutInfo(checkOutInfo),cartStorage.setGlobalSmartCartInfo(checkOutInfo,!0),checkOutInfo):void 0}):promiseResolve()}function workRouterLogic(toState,toParams){coreServices.cartStorage.setCurrentState(toState.name),$log.log("myCart App Setup ::stateChangeStart next url ",toState.url),$log.log("authTokenManager.getTokenCookies()")}var apiKey=apiService.getURL("bundleService"),$log=(responseTransformationService.getFactory(apiKey.version),commonServices.$rootScope,commonServices.$log),$q=(commonServices.$state,commonServices.$timeout,commonServices.$q),cartStorage=(commonServices.$location,coreServices.tokenUtils,coreServices.cartStorage),globalConfig=(coreServices.creditClassService,coreServices.globalConfig);coreServices.authTokenManager;return{workRouterLogic:workRouterLogic,checkOutHandoff:checkOutHandoff}}cartStateChangeServiceConstructor.$inject=["commonServices","coreServices","shippingUtil","checkOutHttpDataUtil","apiService","cartHttpDataService","responseTransformationService","FRAUD_FAIL_STATE_NAME","CHECKOUT_STATE_NAME","CART_STATE_NAME","toggleService","commonStorage","$injector","cartConstants"],angular.module("tmobileApp").service("cartStateChangeService",cartStateChangeServiceConstructor)}(window.angular,window._),function(angular){"use strict";function networkSpeedsFactory($http,$q,$log){function getNetworkSpeedData(url){var request={method:"GET",url:url};return $http(request).then(function(response){return response.data.citySpeedData&&response.data.citySpeedData.city?$q.resolve(response.data.citySpeedData.city):$q.reject("Error response had no city data.")},function(response){return $log.error("error city ",response),$q.reject("Error making request for Network Data.")})}return{getNetworkSpeedData:getNetworkSpeedData}}networkSpeedsFactory.$inject=["$http","$q","$log"],angular.module("marketingCore").factory("networkSpeedsFactory",networkSpeedsFactory)}(window.angular),function(angular,lodash,uuid){"use strict";function cartHttpDataServiceFn(httpRequest,apiURLs,apiURLsV2,apiService,httpRequestWrapper,$q,dataFactory,responseTransformationService,commonStorage,cartHttpWrapper,creditClassService,devicePDPService,session,$cookies,apiZoomLevel,cartStorage,commonUtils,$log,transformCart,globalValue,globalConfig,toggleService,pdpResponseTransformationServicePDPV2,cartConstants,transformCartV3,checkOutConstants){function getCartPreview(){var apiURL=toggleService.model.toggles.cartPreviewAPIV2?apiURLsV2.cartPreview:apiURLs.cartPreview;apiURL=apiURL.replace("{{cartID}}",cartStorage.getCartId());var query={creditLevel:"ALL"};return httpRequestWrapper.get(apiURL,query,null,!0).then(function(cartResponse){if(200===cartResponse.status){var smartCartData=cartStorage.getGlobalSmartCartInfo(),dfRequest=new dataFactory.DFRequest;dfRequest.input={time:smartCartData.modifiedTime};var cartPricingCache=transformService.getTransformedCreditClassPricingDetails(cartResponse.data,toggleService.model.toggles.cartPreviewAPIV2);return dataFactory.setVO("defaultService",dfRequest,cartPricingCache),cartResponse.status}return cartResponse.status})}function removeDeviceFromLine(lineId,deviceId){var urlObject=apiService.getURL("removeDevice"),apiURL=urlObject.url;apiURL=apiURL.replace("{{cartID}}",cartStorage.getCartId()),apiURL=apiURL.replace("{{lineID}}",lineId),apiURL=apiURL.replace("{{deviceID}}",deviceId);var query="";return 3!==urlObject.version&&(query={creditLevel:creditClassService.getEPCreditClass()||"GOOD"}),cartHttpWrapper["delete"](apiURL,query,"removeDeviceFromLine","removeDevice")}function getCart(){var cartId=cartStorage.getCartId();if(cartId){var urlObect=apiService.getURL("getFullCart"),apiURL=urlObect.url;apiURL=apiURL.replace("{{cartID}}",cartStorage.getCartId());var query="";return 3!==urlObect.version&&(query={creditLevel:creditClassService.getEPCreditClass()||"GOOD"}),cartHttpWrapper.get(apiURL,query,"getCart","getFullCart")}}function addNewLine(requestObject,cartData){var cartId=cartStorage.getCartId(),subType=requestObject.subType;if(cartId){var urlObject=apiService.getURL("addNewLine"),apiURL=urlObject.url;apiURL=apiURL.replace("{{cartID}}",cartStorage.getCartId());var body,query={subType:subType,creditLevel:creditClassService.getEPCreditClass()||"GOOD"},header={"x-applicationId":"TMO"};return 2===urlObject.version?(body={lineType:subType,lineNumber:cartData?cartData.structCartData.totalLines+1:1,transactionCode:"ACTIVATION",lineName:cartData?cartData.structCartData.totalLines+1:1},header.follow="TRUE"):body={subType:subType},cartHttpWrapper.post(apiURL,body,query,"addNewLine","addNewLine",header)}}function duplicateLine(lineId){var urlObject=apiService.getURL("duplicateLine"),apiURL=urlObject.url,header={},query=null,body={};return apiURL=apiURL.replace("{{cartID}}",cartStorage.getCartId()),apiURL=apiURL.replace("{{lineID}}",lineId),2===urlObject.version?(body={transactionCode:"ACTIVATION"},header.follow="TRUE",query={creditLevel:creditClassService.getEPCreditClass()||"GOOD"}):3===urlObject.version?header.follow="TRUE":(body=null,header=void 0,query={creditLevel:creditClassService.getEPCreditClass()||"GOOD"}),cartHttpWrapper.post(apiURL,body,query,"duplicateLine","duplicateLine",header)}function removeLine(lineId){var urlObject=apiService.getURL("removeLine"),apiURL=urlObject.url,headers={};2===urlObject.version||3===urlObject.version?headers.follow="TRUE":headers=null,apiURL=apiURL.replace("{{cartID}}",cartStorage.getCartId()),apiURL=apiURL.replace("{{lineID}}",lineId);var query=null;return 3!==urlObject.version&&(query={creditLevel:creditClassService.getEPCreditClass()||"GOOD"}),cartHttpWrapper["delete"](apiURL,query,"removeLine","removeLine",headers)}function addToLine(requestObject,lineId){var blockSKU=[],disableSKU=!1,blockSkuArray=lodash.get(globalValue,"authorValue.rootPage.overrideInvStatus.invStatusDetails",[]);blockSkuArray=lodash.isArray(blockSkuArray)?blockSkuArray:[blockSkuArray];for(var sku in blockSkuArray)("NOT_AVAILABLE_FOR_SALE_ONLINE"===blockSkuArray[sku].status||"NOT_AVAILABLE_COMING_SOON"===blockSkuArray[sku].status)&&blockSKU.push(blockSkuArray[sku].sku),requestObject.sku===JSON.stringify(blockSKU[sku])&&(disableSKU=!0);var urlObject=apiService.getURL("addOrEditToLine"),apiURL=urlObject.url,header={};apiURL=apiURL.replace("{{cartID}}",cartStorage.getCartId()),apiURL=apiURL.replace("{{lineID}}",lineId);var query;return 2===urlObject.version?(requestObject.creditLevel=creditClassService.getEPCreditClass()||"GOOD",requestObject.pricingOption=requestObject.pricingOption?requestObject.pricingOption:"EIP",header.follow="TRUE",query=null):(query={creditLevel:creditClassService.getEPCreditClass()||"GOOD"},header=null),disableSKU?void 0:cartHttpWrapper.post(apiURL,requestObject,query,"addToLine","addOrEditToLine",header)}function getMostPopularDevices(pipeSeperatedDeviceSKUs){return httpRequestWrapper.get(apiURLs.mostPopularDevices+pipeSeperatedDeviceSKUs,null,null,!0)}function getAccessoriesData(input){var header={},body={},miniPLPV2API=_.get(toggleService.model.toggles,"miniPLPATv2",!1),query={},accessoriesUrl="";if(input.ignoreLoadingBar&&(query={ignoreLoadingBar:input.ignoreLoadingBar}),miniPLPV2API)accessoriesUrl=apiURLs.snpMiniBrowse2,body=cartConstants.REQ_DATA_MINI_PLP[input.category],body.productFamilyIds=[input.miniBrowseSku.toString()];else{var pipeSeperatedAccessoriesSKUs=input.familyIds;accessoriesUrl=apiURLs.accessories,angular.isDefined(pipeSeperatedAccessoriesSKUs)&&""!==pipeSeperatedAccessoriesSKUs&&(accessoriesUrl+=pipeSeperatedAccessoriesSKUs),header=apiURLs.nonProdBrowseHeader?{"x-target":"b"}:{}}if(toggleService.model.toggles.isCircuitBreaker&&!miniPLPV2API){var aemCachedBrowseUrl=apiURLs.product.browse.failSafeParametersMini.accessory;header["cb-response"]=aemCachedBrowseUrl}if(toggleService.model.toggles.turnSnPOff&&!miniPLPV2API){var aemCachedBrowseUrl=apiURLs.product.browse.failSafeParametersMini.accessory;return httpRequestWrapper.get(aemCachedBrowseUrl)}return getAccessoryResponse(accessoriesUrl,body,null,header,miniPLPV2API)}function getAccessoryResponse(url,body,query,header,isV2API){return isV2API?httpRequestWrapper.post(url,body,query,header,!0,"plpV2"):httpRequestWrapper.get(url,query,header,!0)}function getSelectedAccessoryData(offerid){var header={},_offerid=angular.isDefined(offerid)&&""!==offerid?offerid:"",V2API=_.get(toggleService.model.toggles,"toggleV2API"),url=apiURLs.snpMiniBrowse+_offerid;V2API&&(url=apiURLs.snpMiniBrowse2+_offerid);var body={};return aemCachedPdpUrl=apiURLs.product.detail.pdpCacheData.accessory,aemCachedPdpUrl=aemCachedPdpUrl.replace("{offerId}",offerid),toggleService.model.toggles.isCircuitBreaker&&(header["cb-response"]=aemCachedPdpUrl),toggleService.model.toggles.turnPdpCacheOn&&devicePDPService.checkForPdpCacheAuthoring("accessory",_offerid)?httpRequestWrapper.get(aemCachedPdpUrl).then(function(response){return 200!==response.status||_.isEmpty(response.data)||_.isEmpty(response.data.products)?getAccessoryResponse(url,body,null,header,V2API):response}):getAccessoryResponse(url,body,null,header,V2API)}function getKeyValuePairs(){return httpRequest.get(apiURLs.keyValuePairs)}function getDataForUseMyPhone(lineId){return"HANDSET"===lineId.lineType?httpRequestWrapper.get(apiURLs.useMyPhone,null,null,!0):httpRequestWrapper.get(apiURLs.useMyTablet,null,null,!0)}function getDataForUseMyPhoneV2(lineId){var body={};return"HANDSET"===lineId.lineType?httpRequestWrapper.post(apiURLs.useMyPhoneV2,body,null,null,!0,"plpV2"):httpRequestWrapper.post(apiURLs.useMyTabletV2,body,null,null,!0,"plpV2")}function saveCreditLevel(creditClass,callback,previousCreditClass,buyNowCheck,addCartBtnAcc){var urlObject=apiService.getURL("updateProfile");2===urlObject.version?getProfileId().then(function(profileId){urlObject.url=urlObject.url.replace("{{profileID}}",profileId),updateProfileAndCreditInfo(creditClass,callback,previousCreditClass,buyNowCheck,addCartBtnAcc,urlObject,profileId)}):updateProfileAndCreditInfo(creditClass,callback,previousCreditClass,buyNowCheck,addCartBtnAcc,urlObject)}function updateProfileAndCreditInfo(creditClass,callback,previousCreditClass,buyNowCheck,addCartBtnAcc,urlObject,profileId){var selectedCreditClass=creditClassService.getEPCreditClassValue(creditClass["class"]),body=angular.copy(cartStorage.PROFILE_DATA);body.creditLevel=selectedCreditClass,body.aggreementVersionId="",body=_.merge(body,cartStorage.getProfileData());var preCrClass=previousCreditClass;if(preCrClass||globalValue.authorValue&&(preCrClass=commonUtils.searchJson(globalValue,"creditClassSelector")["class"][0]),toggleService.model.toggles.noCreditCheck&&!angular.equals(preCrClass["class"],creditClass["class"])){var decision=isAutoPayCallRequired(preCrClass["class"],creditClass["class"]);if(angular.isUndefined(globalConfig.cartSettings.autoPayValue)&&(globalConfig.cartSettings.autoPayValue=!0),decision.isCallRequired&&globalConfig.cartSettings.autoPayValue){var inputData,apiUrl;apiUrl=apiURLs.createAuditRecordsUrl,apiUrl=apiUrl.replace("{{cartID}}",cartStorage.getCartId()),inputData={auditRecords:[{auditKey:"AUTO_PAY",auditValue:decision.autoPayValue}]},inputData.auditRecords.push({auditKey:"STORE_PAYMENT",auditValue:decision.autoPayValue}),httpRequestWrapper.post(apiUrl,inputData,null,null,!0).then(function(auditRecordsResponse){angular.equals(auditRecordsResponse.status,200)&&(2===urlObject.version?httpRequestWrapper.put(urlObject.url,body,null,null,"updateProfile","updateProfile").then(function(result){callback(result)}):httpRequestWrapper.post(urlObject.url,body,null,null,!0).then(function(result){callback(result)}))})}else 2===urlObject.version?httpRequestWrapper.put(urlObject.url,body,null,null,"updateProfile","updateProfile").then(function(result){callback(result)}):httpRequestWrapper.post(urlObject.url,body,null,null,!0).then(function(result){callback(result)})}else 2===urlObject.version?httpRequestWrapper.put(urlObject.url,body,null,null,"updateProfile","updateProfile").then(function(result){callback(result,buyNowCheck,addCartBtnAcc)}):httpRequestWrapper.post(urlObject.url,body,null,null,!0).then(function(result){callback(result,buyNowCheck,addCartBtnAcc)})}function isAutoPayCallRequired(initialCreditClass,currentCreditClass){var decision={};return angular.equals(initialCreditClass,"creditClass3")&&!angular.equals(currentCreditClass,"creditClass3")?(decision.isCallRequired=!0,decision.autoPayValue=!0,decision):!angular.equals(initialCreditClass,"creditClass3")&&angular.equals(currentCreditClass,"creditClass3")?(decision.isCallRequired=!0,decision.autoPayValue=!1,decision):(decision.isCallRequired=!1,decision.autoPayValue=!1,decision)}function getSimKitResponse(url,body,query,header,isV2API){return isV2API?httpRequestWrapper.post(url,body,query,header,!0,"plpV2"):httpRequestWrapper.get(url,query,header,!0)}function getSIMKitDetails(){var V2API=toggleService.model.toggles.toggleV2API,url=apiURLs.simKitDetails;V2API&&(url=apiURLs.simKitDetailsV2);var body={};return getSimKitResponse(url,body,null,null,V2API)}function addAccessoryToCart(accessoryDetails){var addApiKey="addAccessoryToCart",urlObject=apiService.getURL(addApiKey),header={};if(2===urlObject.version||3===urlObject.version){var apiURL=urlObject.url,getAccessories=accessoryDetails.cartParams;return 2===urlObject.version?getAccessories.creditLevel=accessoryDetails.creditLevel:getAccessories.offerId=accessoryDetails.offerId,apiURL=apiURL.replace("{{cartID}}",cartStorage.getCartId()),header.follow="TRUE",httpRequestWrapper.post(apiURL,getAccessories,null,header,!0,addApiKey)}var url=apiURLs.addAccessoryToCart+cartStorage.getCartId()+"/accessories?creditLevel="+accessoryDetails.creditLevel;return httpRequestWrapper.post(url,accessoryDetails.cartParams,null,null,!0,addApiKey)}function deleteAccessoryFromCart(accessoryDetails){var urlObject=apiService.getURL("removeAccessoryFromCart"),headers={};if(headers.follow="TRUE",2===urlObject.version||3===urlObject.version){var apiURL=urlObject.url;return apiURL=apiURL.replace("{{cartID}}",cartStorage.getCartId()),apiURL=apiURL.replace("{{accessoryID}}",accessoryDetails.id),cartHttpWrapper["delete"](apiURL,null,"deleteAccessoryFromCart","removeAccessoryFromCart",headers)}var url=apiURLs.removeAccessoryFromCart+cartStorage.getCartId()+"/accessories/"+accessoryDetails.id,query={creditLevel:creditClassService.getEPCreditClass()||"GOOD"};return cartHttpWrapper["delete"](url,query,"deleteAccessoryFromCart","removeAccessoryFromCart",null)}function editSelectedAccessoryData(offerId){var accessoriesUrl=apiURLs.snpMiniBrowse;return angular.isDefined(offerId)&&""!==offerId&&(accessoriesUrl+=offerId),httpRequestWrapper.get(accessoriesUrl,null,null,!0)}function editAccessoryInCart(accessoryDetails){var editApiKey="editAccessoryInCart",urlObject=apiService.getURL(editApiKey),header={};if(2===urlObject.version){var apiURL=urlObject.url,getAccessories=accessoryDetails.cartParams;return getAccessories.creditLevel=accessoryDetails.creditLevel,header.follow="TRUE",apiURL=apiURL.replace("{{cartID}}",cartStorage.getCartId()),apiURL=apiURL.replace("{{accessoryID}}",accessoryDetails.id),httpRequestWrapper.put(apiURL,getAccessories,null,header,!0,editApiKey)}var url=apiURLs.addAccessoryToCart+cartStorage.getCartId()+"/accessories/"+accessoryDetails.id+"?creditLevel="+accessoryDetails.creditLevel;return httpRequestWrapper.put(url,accessoryDetails.cartParams,null,null,!0,editApiKey)}function showAvailablity(invStatus,authorValue){switch(invStatus){case"AVAILABLE":return authorValue.rootPage.generalAuthoring.alwaysAvailable;case"AVAILABLE_FOR_PRE_ORDER":return authorValue.rootPage.generalAuthoring.preOrder;case"AVAILABLE_FOR_BACK_ORDER":return authorValue.rootPage.generalAuthoring.backOrder;case"NOT_AVAILABLE":return authorValue.rootPage.generalAuthoring.outOfStock;case"NOT_AVAILABLE_FOR_SALE_ONLINE":return authorValue.rootPage.generalAuthoring.notforsale;case"NOT_AVAILABLE_COMING_SOON":return authorValue.rootPage.generalAuthoring.comingSoon;case"COMING_SOON":return authorValue.rootPage.generalAuthoring.comingSoon;default:return authorValue.rootPage.generalAuthoring["default"]}}function getConfiguredPlans(){var apiURL=apiURLs.getDefaultPlans;apiURL=apiURL.replace("{{cartID}}",cartStorage.getCartId());var query={creditLevel:creditClassService.getEPCreditClass()||"GOOD"};return query.ignoreLoadingBar=!0,httpRequestWrapper.get(apiURL,query,null,!0).then(function(planData){if(200===planData.status){var transformCartFactory=transformCart.getFactory("getDefaultPlans"),planConfigData=transformCartFactory.transformPlanConfigData(planData.data);return cartStorage.setPlanConfigData(planConfigData),planConfigData}return planConfigData})}function toggleSelectedPlan(selectedLine){var apiURL=apiURLs.getDefaultPlans;apiURL=apiURL.replace("{{cartID}}",cartStorage.getCartId());var planConfigData=cartStorage.getPlanConfigData();cartStorage.getGlobalSmartCartInfo();var postPlanSelectorID=selectedLine.lineItemDetails.planDetails.addOns.planOptionSelectorId,body={planconfigurationsID:planConfigData.planConfigurationID,planOptionSelectorID:postPlanSelectorID},query="GOOD";return angular.isDefined(selectedLine.lineItemDetails.deviceDetails.id)&&(query={creditLevel:creditClassService.getEPCreditClass()||"GOOD"}),httpRequestWrapper.post(apiURL,body,query,null,!0).then(function(cartResponse){if(200===cartResponse.status){var transformCartFactory=transformCart.getFactory("getDefaultPlans");planConfigData=transformCartFactory.transformPlanConfigData(cartResponse.data),cartStorage.setPlanConfigData(planConfigData);var updateCartURL=apiURLs.getFullCart;updateCartURL=updateCartURL.replace("{{cartID}}",cartStorage.getCartId());var updateCartbody={planconfigurationsID:planConfigData.planConfigurationID};return query={creditLevel:creditClassService.getEPCreditClass()||"GOOD"},cartHttpWrapper.put(updateCartURL,updateCartbody,query,"toggleSelectedPlan","getFullCart")}return cartResponse.status})}function findCart(input){var urlObject=apiService.getURL("saveCart"),apiURL=urlObject.url,query={email:input.email};return httpRequestWrapper.get(apiURL,query,{},"saveCart","saveCart").then(function(cartResponse){return 200===cartResponse.status?cartResponse:404===cartResponse.status?saveCart(input):void 0})}function saveCart(input){var urlObject=apiService.getURL("saveCart"),apiURL=urlObject.url,version=urlObject.version,header={},body={cartId:cartStorage.getCartId(),email:input.email};return 2===version?header.follow="TRUE":header=null,lodash.get(toggleService.model,"toggles.isDcpV3ApiEnabled",!1)?httpRequestWrapper.post(apiURL,body,null,header,"saveCart","saveCart"):lodash.get(toggleService.model,"toggles.v2saveCartByPOST",!1)?httpRequestWrapper.post(apiURL,body,null,header,"saveCart","saveCart"):httpRequestWrapper.put(apiURL,body,null,header,"saveCart","saveCart")}function errorHandler(error){return $log.log("Something went wrong ",error),error.status="failed",error}function loadCart(input,followHeader){var urlObject=apiService.getURL("loadCart"),apiURL=urlObject.url,version=urlObject.version,cartId=cartStorage.getCartId();apiURL=apiURL.replace("{{cartID}}",cartId);var query={},header={};if(input.email&&(query.email=input.email),input.cartId&&(query.cartId=input.cartId),input.ignoreLoadingBar&&(query.ignoreLoadingBar=input.ignoreLoadingBar),2===version)return header.follow=followHeader||"TRUE",httpRequestWrapper.post(apiURL,null,query,header,"loadCart","loadCart").then(function(loadCartResponse){return angular.equals(loadCartResponse.status,200)||"FALSE"===header.follow&&angular.equals(loadCartResponse.status,201)?getProfileInfo().then(function(profileData){var creditSelector=globalValue.authorValue.cart.creditSelector["class"],creditClass=epToAppMapping[commonUtils.searchJson(profileData.data,"creditLevel")],creditClassObject=_.find(creditSelector,{"class":creditClass});creditClassService.setCreditClass(creditClassObject);var transformCartFactory=transformCart.getFactory("loadCart"),transformedCart=transformCartFactory.transformCartData(loadCartResponse.data);return cartStorage.setGlobalSmartCartInfo(transformedCart),loadCartResponse}):loadCartResponse});if(3===version){header.follow=followHeader||"TRUE";var postBody={};return httpRequestWrapper.post(apiURL,postBody,query,header,"loadCart","loadCart").then(function(loadCartResponse){return angular.equals(loadCartResponse.status,200)||"FALSE"===header.follow&&angular.equals(loadCartResponse.status,201)?getV3Cart(loadCartResponse):loadCartResponse})["catch"](errorHandler)}return header=null,httpRequestWrapper.post(apiURL,null,query,header,"loadCart","loadCart").then(function(cartResponse){if(angular.equals(cartResponse.status,200)){var creditSelector=globalValue.authorValue.cart.creditSelector["class"],creditClassObject=_.find(creditSelector,{"class":epToAppMapping[commonUtils.searchJson(cartResponse,"creditClass")]});creditClassService.setCreditClass(creditClassObject);var transformCartFactory=transformCart.getFactory("loadCart"),transformedCart=transformCartFactory.transformCartData(cartResponse.data);cartStorage.setGlobalSmartCartInfo(transformedCart)}return cartResponse})}function getV3Cart(loadCartResponse){return getFullCart().then(function(cartResponseData){if(angular.equals(cartResponseData.status,200)){var transformCartFactory=transformCart.getFactory("loadCart"),transformedCart=transformCartFactory.transformCartData(cartResponseData.data);return cartStorage.setGlobalSmartCartInfo(transformedCart),$log.info("cart response transformation completed."),loadCartResponse}})["catch"](errorHandler)}function getSelectedDeviceData(selectedsku){var apiURL=apiURLs.authorableCarousel,query={sku:selectedsku,detailed:!0};return httpRequestWrapper.get(apiURL,query,null,!0)}function addTradeIn(lineId,body){var urlObject=apiService.getURL("addTradeIn"),apiURL=urlObject.url,header={};apiURL=apiURL.replace("{{cartID}}",cartStorage.getCartId()),apiURL=apiURL.replace("{{lineID}}",lineId);var query={creditLevel:creditClassService.getEPCreditClass()||"GOOD"};return 2===urlObject.version?(header.follow="TRUE",cartHttpWrapper.post(apiURL,body,query,"addTradeIn","addTradeIn",header)):3===urlObject.version?(header.follow="TRUE",
cartHttpWrapper.post(apiURL,body,"","addTradeIn","addTradeIn",header)):cartHttpWrapper.post(apiURL,body,query,"addTradeIn","addTradeIn",null)}function removeTradeIn(lineId,tradeInId){var urlObject=apiService.getURL("removeTradeIn"),apiURL=urlObject.url,header={};apiURL=apiURL.replace("{{cartID}}",cartStorage.getCartId()),apiURL=apiURL.replace("{{lineID}}",lineId),apiURL=apiURL.replace("{{tradeInID}}",tradeInId);var query=void 0;return 3!==urlObject.version&&(query={creditLevel:creditClassService.getEPCreditClass()||"GOOD"}),2===urlObject.version||3===urlObject.version?(header.follow="TRUE",cartHttpWrapper["delete"](apiURL,query,"removeTradeIn","removeTradeIn",header)):cartHttpWrapper["delete"](apiURL,query,"removeTradeIn","removeTradeIn",null)}function getProfileInfo(){var apiKey,url=apiURLs.getProfile+"/"+cartStorage.getCartId();return lodash.get(toggleService.model,"toggles.isV2getProfiles",!1)&&(url=apiService.getURL("getProfilesV2").url,apiKey="pdp"),httpRequestWrapper.get(url,null,null,!0,apiKey)}function getSkuPrices(){var cartId=cartStorage.getCartId();if(cartId){var skuURL;skuURL=lodash.get(toggleService.model,"toggles.isSkuPriceFromV2Cart",!1)?"getSkuPricesV2Cart":"getSkuPrices";var header,urlObect=apiService.getURL(skuURL),apiURL=urlObect.url;apiURL=apiURL.replace("{{cartID}}",cartStorage.getCartId());var query={creditLevel:creditClassService.getEPCreditClass()||"GOOD"};return httpRequestWrapper.get(apiURL,query,header,"getSkuPrices","getSkuPrices")}}function updateProfileInfo(inputData){var body,header={},urlObject=apiService.getURL("updateProfile"),apiURL=urlObject.url;return body={firstName:inputData.firstName,lastName:inputData.lastName,emailId:inputData.email,phoneNo:inputData.phoneNo,creditLevel:creditClassService.getEPCreditClass()||"GOOD"},2===urlObject.version?getProfileId().then(function(profileId){return apiURL=apiURL.replace("{{profileID}}",profileId),header.follow="true",httpRequestWrapper.put(apiURL,body,null,header,"updateProfile","updateProfile")}):httpRequestWrapper.post(apiURL,body,null,null,!0)}function getProfileId(ignoreLoadingBarParam){var defer=$q.defer(),profileId=cartStorage.getProfileId();if(profileId)return defer.resolve(profileId),defer.promise;var urlObject=apiService.getURL("getProfileId"),apiURL=urlObject.url,header={};return httpRequestWrapper.get(apiURL,queryLoadingBar(ignoreLoadingBarParam),header,"getProfileId","getProfileId").then(function(response){return profileId=response.data.profile.profileId,cartStorage.setProfileId(profileId),profileId})}function createLead(inputData){var data={firstName:inputData.firstName?inputData.firstName.toLowerCase():"",lastName:inputData.lastName?inputData.lastName.toLowerCase():"",phoneNumber:inputData.phoneNumber?inputData.phoneNumber:"",zip:inputData.zipCode?inputData.zipCode:"",consent:inputData.cisConsent?inputData.consentObject.cisuniqueid:"",updateRecord:cartConstants.OTHERS.TRUE,email:inputData.email.toLowerCase()};inputData.leadSource&&inputData.channel&&(data.leadSource=inputData.leadSource,data.channel=inputData.channel);var urlObject,header={"Content-Type":"application/json"};return urlObject=apiService.getURL("createLeadRetailCart"),httpRequestWrapper.post(urlObject.url,data,"",header,!0)}function saveLead(inputData){var urlObject,header={"Content-Type":"application/json"};urlObject=apiService.getURL("saveLeadRetailCart");var cartURL=cartStorage.getSaveCartURL();cartURL||(cartURL=location.origin+"/cart/SC?id="+cartStorage.getCartId());var data={leadId:inputData.leadId,cartURL:cartURL,cartType:inputData.cartType,transactionId:inputData.transId};return httpRequestWrapper.post(urlObject.url,data,"",header,!0)}function eosCreditCheck(inputData,ignoreLoadingBarParam){var urlObject,header=getEOSApiHeaders();return urlObject=toggleService.model.toggles.handleTMOorSprintCustomer?apiService.getURL("eosCreditCheckV2"):apiService.getURL("eosCreditCheck"),httpRequestWrapper.post(urlObject.url,inputData,queryLoadingBar(ignoreLoadingBarParam),header,!0)}function getShippingOptions(ignoreLoadingBarParam){var header={},urlObject=apiService.getURL("shippingOptionsUrl"),apiURL=urlObject.url;return apiURL=apiURL.replace("{{cartID}}",cartStorage.getCartId()),httpRequestWrapper.get(apiURL,queryLoadingBar(ignoreLoadingBarParam),header,"shippingOptionsUrl","shippingOptionsUrl")}function getCartV3(ignoreLoadingBarParam){var cartId=cartStorage.getCartId();if(cartId){var urlObect=apiService.getURL("getCartV3"),apiURL=urlObect.url;return apiURL=apiURL.replace("{{cartID}}",cartStorage.getCartId()),cartHttpWrapper.get(apiURL,queryLoadingBar(ignoreLoadingBarParam),"getCartV3","getCartV3")}}function updateCreditProfileV3(body,profileId,creditProfileId,ignoreLoadingBarParam){var header={},urlObject=apiService.getURL("getCreditProfile"),apiURL=urlObject.url;return apiURL=apiURL.replace("{{profileID}}",profileId),apiURL=apiURL.replace("{{creditProfileID}}",creditProfileId),header.follow="true",httpRequestWrapper.patch(apiURL,body,queryLoadingBar(ignoreLoadingBarParam),header,"getCreditProfile","getCreditProfile")}function updateProfileInfoV3(body,ignoreLoadingBarParam){var header={},urlObject=apiService.getURL("updateProfile"),apiURL=urlObject.url;return getProfileId().then(function(profileId){return apiURL=apiURL.replace("{{profileID}}",profileId),header.follow="true",httpRequestWrapper.patch(apiURL,body,queryLoadingBar(ignoreLoadingBarParam),header,"updateProfile","updateProfile")})}function getCreditProfileById(profileId,creditProfileId){var apiKey="getCreditProfile",urlObject=apiService.getURL(apiKey),apiURL=urlObject.url,headers={};return apiURL=apiURL.replace("{{profileID}}",profileId).replace("{{creditProfileID}}",creditProfileId),httpRequestWrapper.get(apiURL,null,headers,!0,apiKey)}function getQuotes(checkoutInfo){var apiURL=apiService.getURL(cartConstants.GET_QUOTES_KEY).url;return apiURL=apiURL.replace("{{cartID}}",cartStorage.getCartId()),httpRequestWrapper.get(apiURL,null,null,!0).then(function(response){if(angular.isDefined(response)&&response.status===cartConstants.SUCCESS_CODE){var transformedData=transformCartV3.transformQuotesData(response.data,checkoutInfo);return checkoutInfo.total=transformedData.total,checkoutInfo.subTotal=transformedData.subTotal,checkoutInfo.reviewCart=transformedData.reviewCart,{status:response.status,data:transformedData}}return{error:"error"}})}function getDefaultCart(){var urlObject=apiService.getURL("getDefaultCart"),apiURL=urlObject.url;return apiURL=apiURL.replace("{{cartID}}",cartStorage.getCartId()),httpRequestWrapper.get(apiURL,null,null,!0)}function getAccounts(profileId){var urlObject=apiService.getURL("getAccounts"),apiURL=urlObject.url;return apiURL=apiURL.replace("{{profileID}}",profileId),httpRequestWrapper.get(apiURL,null,null,!0)}function createCreditProfileV3(profileId,body){var header={follow:!0},urlObject=apiService.getURL("createCreditProfiles"),apiURL=urlObject.url;return apiURL=apiURL.replace("{{profileID}}",profileId),httpRequestWrapper.post(apiURL,body,null,header,"createCreditProfile","createCreditProfile")}function createAccount(profileId){var header={follow:!0},urlObject=apiService.getURL("createAccounts"),apiURL=urlObject.url;apiURL=apiURL.replace("{{profileID}}",profileId);var body={accountType:cartConstants.INDIVIDUAL,accountSubtype:cartConstants.INDIVIDUAL_REGULAR};return httpRequestWrapper.post(apiURL,body,null,header,!0)}function getFullCart(){var urlObject=apiService.getURL("getFullCart"),apiURL=urlObject.url;return apiURL=apiURL.replace("{{cartID}}",cartStorage.getCartId()),httpRequestWrapper.get(apiURL,null,null,!0,"getFullCart")}function updateAccount(body,profileID,accountID){var urlObject=apiService.getURL("updateAccount"),apiURL=urlObject.url;apiURL=apiURL.replace("{{profileID}}",profileID).replace("{{accountID}}",accountID);var header={follow:!0};return httpRequestWrapper.patch(apiURL,body,null,header,"updateAccount","updateAccount")}function getPublicKey(urlName,ignoreLoadingBarParam){var urlObject=apiService.getURL(urlName),apiURL=urlObject.url,header=getEOSApiHeaders();return httpRequestWrapper.get(apiURL,queryLoadingBar(ignoreLoadingBarParam),header,!0,urlName)}function onVerifyIdentity(body){var urlObject=toggleService.model.toggles.handleTMOorSprintCustomer?apiService.getURL("verifyIdentityV2"):apiService.getURL("verifyIdentity"),header=getEOSApiHeaders(),apiURL=urlObject.url;return httpRequestWrapper.post(apiURL,body,null,header,!0,"verifyIdentity")}function getEOSApiHeaders(){var header={clientid:cartConstants.ESSENTIALS_CONSTANT.CLIENTID,correlationId:uuid.create().toString(),transactionId:uuid.create().toString(),transactionType:cartConstants.ESSENTIALS_CONSTANT.TRANSACTION_CODE};return header}function queryLoadingBar(ignoreLoadingBarParam){var query=angular.isUndefined(ignoreLoadingBarParam)?null:{ignoreLoadingBar:ignoreLoadingBarParam};return query}function deleteCart(cartId){var header={},urlObject=apiService.getURL("getCartV3"),apiURL=urlObject.url;apiURL=apiURL.replace("{{cartID}}",cartId);var query="";return cartHttpWrapper["delete"](apiURL,query,"deleteCart","getCartV3",header)}function deleteCreditProfile(profileId,creditProfileId){var header={},urlObject=apiService.getURL("getCreditProfile"),apiURL=urlObject.url;apiURL=apiURL.replace("{{profileID}}",profileId),apiURL=apiURL.replace("{{creditProfileID}}",creditProfileId);var query="";return cartHttpWrapper["delete"](apiURL,query,"deleteCreditProfile","getCreditProfile",header)}function initiateConversation(payload){var urlObject=apiService.getURL("initiateConversation"),header={},apiURL=urlObject.url;return httpRequestWrapper.post(apiURL,payload,null,header,!0,"initiateConversation")}function continueConversation(payload){var urlObject=apiService.getURL("continueConversation"),header={},apiURL=urlObject.url;return httpRequestWrapper.post(apiURL,payload,null,header,!0,"continueConversation")}function fraudReview(payload){var apiURL=apiService.getURL("fraudReview").url,header={};return apiURL=apiURL.replace("{{cartID}}",cartStorage.getCartId()),httpRequestWrapper.post(apiURL,payload,null,header,!0,"fraudReview")}function postFinanceEstimates(headerValue){var cartId=cartStorage.getCartId();if(cartId){var header={follow:headerValue},urlObect=apiService.getURL("financeEstimates"),apiURL=urlObect.url,body={loanOriginSystem:"EIP"};return apiURL=apiURL.replace("{{cartID}}",cartStorage.getCartId()),headerValue?cartHttpWrapper.post(apiURL,body,null,"financeEstimates","financeEstimates",header):httpRequestWrapper.post(apiURL,body,null,header,!0,"financeEstimates")}}function getBvEncryptionKey(){var urlObect=apiService.getURL("bvEncryptionKey"),apiURL=urlObect.url;return httpRequestWrapper.get(apiURL,null,null,!1,"bvEncryptionKey")}var aemCachedPdpUrl,epToAppMapping={GOOD:"creditClass1",BUILDING:"creditClass2",NONE:"creditClass3"},apiKey=apiService.getURL("bundleService"),transformService=responseTransformationService.getFactory(apiKey.version);return{getProfileInfo:getProfileInfo,getMostPopularDevices:getMostPopularDevices,getAccessoriesData:getAccessoriesData,getKeyValuePairs:getKeyValuePairs,getDataForUseMyPhone:getDataForUseMyPhone,getDataForUseMyPhoneV2:getDataForUseMyPhoneV2,saveCreditLevel:saveCreditLevel,getSIMKitDetails:getSIMKitDetails,addAccessoryToCart:addAccessoryToCart,getSelectedAccessoryData:getSelectedAccessoryData,duplicateLine:duplicateLine,removeLine:removeLine,addNewLine:addNewLine,addToLine:addToLine,getCart:getCart,deleteAccessoryFromCart:deleteAccessoryFromCart,editSelectedAccessoryData:editSelectedAccessoryData,editAccessoryInCart:editAccessoryInCart,showAvailablity:showAvailablity,removeDeviceFromLine:removeDeviceFromLine,getCartPreview:getCartPreview,getConfiguredPlans:getConfiguredPlans,toggleSelectedPlan:toggleSelectedPlan,loadCart:loadCart,saveCart:saveCart,findCart:findCart,getSelectedDeviceData:getSelectedDeviceData,addTradeIn:addTradeIn,removeTradeIn:removeTradeIn,getSkuPrices:getSkuPrices,updateProfileInfo:updateProfileInfo,getProfileId:getProfileId,createLead:createLead,saveLead:saveLead,updateProfileInfoV3:updateProfileInfoV3,getCreditProfileById:getCreditProfileById,eosCreditCheck:eosCreditCheck,getShippingOptions:getShippingOptions,getCartV3:getCartV3,updateCreditProfileV3:updateCreditProfileV3,getQuotes:getQuotes,getDefaultCart:getDefaultCart,createCreditProfileV3:createCreditProfileV3,getAccounts:getAccounts,createAccount:createAccount,updateAccount:updateAccount,getFullCart:getFullCart,getPublicKey:getPublicKey,onVerifyIdentity:onVerifyIdentity,getEOSApiHeaders:getEOSApiHeaders,deleteCreditProfile:deleteCreditProfile,deleteCart:deleteCart,initiateConversation:initiateConversation,continueConversation:continueConversation,fraudReview:fraudReview,postFinanceEstimates:postFinanceEstimates,getBvEncryptionKey:getBvEncryptionKey}}cartHttpDataServiceFn.$inject=["httpRequest","apiURLs","apiURLsV2","apiService","httpRequestWrapper","$q","dataFactory","responseTransformationService","commonStorage","cartHttpWrapper","creditClassService","devicePDPService","session","$cookies","apiZoomLevel","cartStorage","commonUtils","$log","transformCart","globalValue","globalConfig","toggleService","pdpResponseTransformationServicePDPV2","cartConstants","transformCartV3","checkOutConstants"],angular.module("tmobileApp").service("cartHttpDataService",cartHttpDataServiceFn)}(window.angular,_,window.UUIDjs),function(angular){"use strict";function salesforceUtils($http,$q,utils,csrfTokenUtils){function makeSalesforceLeadRequest(csrfToken,token,data){var req={method:"POST",url:"/bin/services/marketing/salesforce",headers:{Authorization:"Basic "+token,"CSRF-Token":csrfToken},data:data};return $http(req)}function createSalesforceLead(authToken,inputData){return csrfTokenUtils.getCSRF(authToken).then(function(csrfToken){return makeSalesforceLeadRequest(csrfToken,authToken,inputData)})}return{createSalesforceLead:createSalesforceLead}}salesforceUtils.$inject=["$http","$q","utils","csrfTokenUtils"],angular.module("marketingCore").factory("salesforceUtils",salesforceUtils)}(window.angular),function(angular,lodash){"use strict";function cartDevicesService(cartHttpDataService,cartStorage,tmobNotificationService,cartCommonOperationsService,commonUtils,toggleService,commonStorage){function duplicateLine(selectedLine){var oldLineItems,newLineItems,oldLineIdsArray,newLineIdsArray,duplicateLineId,_searchJsonPathArray=commonUtils.searchJsonArray,lineItemsHandsetArray=_searchJsonPathArray(cartCommonOperationsService.model.structCartData.lineItems,'[?(@.lineType=="HANDSET")]')||[],lineItemsTabletArray=_searchJsonPathArray(cartCommonOperationsService.model.structCartData.lineItems,'[?(@.lineType=="TABLET")]')||[],lineItemsWearableArray=_searchJsonPathArray(cartCommonOperationsService.model.structCartData.lineItems,'[?(@.lineType=="WEARABLE")]')||[];cartStorage.getServiceId(selectedLine.lineId)&&(oldLineItems=cartCommonOperationsService.model.structCartData.lineItems,oldLineIdsArray=_.map(oldLineItems,"lineId")),cartHttpDataService.duplicateLine(selectedLine.lineId).then(function(cartResponseStatus){commonStorage.updateCartCounter(1),cartCommonOperationsService.model.structCartData=cartStorage.getGlobalSmartCartInfo(),angular.isDefined(oldLineIdsArray)&&(newLineItems=cartCommonOperationsService.model.structCartData.lineItems,newLineIdsArray=_.map(newLineItems,"lineId"),duplicateLineId=_.difference(newLineIdsArray,oldLineIdsArray),cartStorage.setServiceId(cartStorage.getServiceId(selectedLine.lineId),duplicateLineId),cartStorage.setRecommendedServiceFlag(duplicateLineId,cartStorage.getRecommendedServiceFlag(selectedLine.lineId))),cartCommonOperationsService.removeMagentaClass(),cartCommonOperationsService.checkDeviceLimit();var type=["TABLET","WEARABLE"];lodash.includes(type,selectedLine.lineType)&&(lineItemsTabletArray.length>0||lineItemsWearableArray.length>0)&&lineItemsHandsetArray.length>0?(tmobNotificationService.addNotification.push("cart033"),tmobNotificationService.showNotification(tmobNotificationService.addNotification)):(tmobNotificationService.addNotification.push("cart011"),tmobNotificationService.showNotification(tmobNotificationService.addNotification))})}var service=this,service={model:{},duplicateLine:duplicateLine};return service}cartDevicesService.$inject=["cartHttpDataService","cartStorage","tmobNotificationService","cartCommonOperationsService","commonUtils","toggleService","commonStorage"],angular.module("tmobileApp").service("cartDevicesService",cartDevicesService)}(window.angular,window._),function(angular){"use strict";function scene7($cookies,$log,$window,$document){function backgroundVid(modId,videoURL,config,initCallback){var videoViewer=new $window.s7viewers.VideoViewer({containerId:"s7video_"+modId,params:{asset:config.params.asset,serverurl:config.params.serverurl,contenturl:config.params.contentserverurl,config:config.params.config,"VideoPlayer.autoplay":"1","VideoPlayer.loop":config.params.loop,"VideoPlayer.muted":"1","VideoPlayer.singleclick":"none",videoserverurl:config.params.videoserverurl}});videoViewer.setParam("posterimage",config.params.posterimage),videoViewer.setHandlers({initComplete:function(){if(initCallback&&angular.isFunction(initCallback)){var mutableVolume=videoViewer.getComponent("mutableVolume");null===mutableVolume?$log.log("s7 mutableVolume component not found."):mutableVolume.setPosition(0),initCallback(videoViewer)}}}),videoViewer.init()}function foregroundVid(modId,videoURL,config,initCallback,trackEventCallback){var videoViewer=new $window.s7viewers.VideoViewer({containerId:modId+"_s7foregroundVideo",params:{asset:config.params.asset,serverurl:config.params.serverurl,contenturl:config.params.contentserverurl,config:config.params.config,"VideoPlayer.autoplay":"1","VideoPlayer.loop":"0",videoserverurl:config.params.videoserverurl,caption:config.params.captionUrl+",0"}});config.params.posterimage&&videoViewer.setParam("posterimage",config.params.posterimage),videoViewer.setHandlers({initComplete:function(){initCallback&&angular.isFunction(initCallback)&&initCallback(videoViewer)},trackEvent:trackEventCallback}),videoViewer.init()}return{backgroundVid:backgroundVid,foregroundVid:foregroundVid}}scene7.$inject=["$cookies","$log","$window","$document"],angular.module("marketingCore").factory("scene7",scene7)}(angular),function(angular,lodash){"use strict";function cartControllerHelperServiceConstructor(cartStorage,cartHttpDataService,$q,deviceProtectionAndServicesHttpData,responseTransformationService,creditClassService,transformCart,dataFactory,globalConfig,jsonPath,$log,apiService,pdpResponseTransformationServicePDPV2,toggleService,essentialsService,authorValueService,globalValue,$state,cartConstants,CartCommonModal){function addCartStoredValues(structCartData){return structCartData.lineItems&&structCartData.lineItems.length>0&&(structCartData.lineItems[0].lineItemDetails.deviceDetails.pricingOption=cartStorage.getPaymentOption()),structCartData}function getSIMKitDetails(){cartHttpDataService.getSIMKitDetails().then(function(response){if(200===response.status){var simKitresponse=pdpResponseTransformationServicePDPV2.getTransformedV2APIResponse(response,toggleService.model.toggles.toggleV2API);simKitDetails={family:jsonPath(simKitresponse.data,"$..Family")[0],fullPrice:jsonPath(simKitresponse.data,"$..PurchasePrice")[0]},cartStorage.setSIMKitDetails(simKitDetails)}})}function transformCartResponse(cartData,apiKey){var transformCartFactory=transformCart.getFactory(apiKey),structCartData=transformCartFactory.transformCartData(cartData);return cartStorage.setGlobalSmartCartInfo(structCartData),structCartData}function getGlobalCart(structCartData){return cartInfo=cartStorage.getGlobalSmartCartInfo(),cartInfo&&!cartInfo.error?cartInfo:!1}function getCommonResolves(openView,selectedLine,index,keyValues,accessoryToEdit,deviceToEdit,source,cartSaveOption,userName,genericResolveDataArray){return commonResolves={openView:{openView:function(){return openView}},selectedCreditClass:{selectedCreditClass:function(){return creditClassService.getCreditClass()}},selectedProductSKU:{selectedProductSKU:function(){return deviceToEdit&&deviceToEdit.sku?deviceToEdit.sku:selectedLine&&lodash.get(selectedLine.lineItemDetails,"deviceDetails",!1)?selectedLine.lineItemDetails.deviceDetails.sku:""}},selectedAccessoryOfferId:{selectedAccessoryOfferId:function(){return accessoryToEdit&&accessoryToEdit.offerId?accessoryToEdit.offerId:""}},selectedDeviceOfferId:{selectedDeviceOfferId:function(){return deviceToEdit&&deviceToEdit.offerId?deviceToEdit.offerId:selectedLine&&selectedLine.lineItemDetails.deviceDetails.id?selectedLine&&selectedLine.lineItemDetails.deviceDetails.id:""}},keyValues:{keyValues:function(){return keyValues}},selectedLine:{selectedLine:function(){return selectedLine}},accessoryToEdit:{accessoryToEdit:function(){return accessoryToEdit}},accessoryData:{accessoryData:function(){return selectedLine}},planDetails:{planDetails:function(){return angular.copy(selectedLine.lineItemDetails.planDetails)||null}},source:{source:function(){return source||"cart"}},selectedProtectionPlans:{selectedProtectionPlans:function(){if(!selectedLine.lineItemDetails.serviceDetails)return"";var selectedServices=jsonPath(selectedLine.lineItemDetails.serviceDetails,"$..[sku]");return selectedServices&&selectedServices.length>0?selectedServices:void 0}},protectionData:{protectionData:function(){return $q(function(resolve,reject){cartStorage.getServiceId(selectedLine.lineId)?deviceProtectionAndServicesHttpData.bundleServices(selectedLine.lineId,void 0).then(function(serviceResponse){if(200===serviceResponse.status){cartStorage.setServiceId(serviceResponse.data.services.id,selectedLine.lineId),cartStorage.setSelectedServiceId(serviceResponse.data.services.id,selectedLine.lineId);var apiKey=apiService.getURL("bundleService"),transformService=responseTransformationService.getFactory(apiKey.version),_serviceData=transformService.getTransformedServies(serviceResponse.data);cartStorage.setBundleServices(_serviceData,selectedLine.lineId),resolve(_serviceData)}}):deviceProtectionAndServicesHttpData.getServices(selectedLine.lineId).then(function(serviceResponse){if(200===serviceResponse.status){cartStorage.setServiceId(serviceResponse.data.services.id,selectedLine.lineId),cartStorage.setSelectedServiceId(serviceResponse.data.services.id,selectedLine.lineId);var apiKey=apiService.getURL("bundleService"),transformService=responseTransformationService.getFactory(apiKey.version);resolve(transformService.getTransformedServies(serviceResponse.data))}})})}},cartSaveOption:{cartSaveOption:function(){return cartSaveOption}},userName:{userName:function(){return userName}}},genericResolveDataArray&&angular.forEach(genericResolveDataArray,function(item){var actualKey=item.key;genericCommonResolves[actualKey]={},genericCommonResolves[actualKey][actualKey]=function(){return item.value}}),angular.merge(commonResolves,genericCommonResolves),commonResolves}function isLineItemPresent(selectedLine){return selectedLine.lineItemDetails.deviceDetails.isProductAdded||selectedLine.simKitDetails.isOnlySimAdded?!0:!1}function isPlanSelectorModal(flag){var isPlanSelectorModalObject={isPlanSelectorModal:{isPlanSelectorModal:function(){return flag?!0:!1}}};return isPlanSelectorModalObject}function getSortedServices(protectionServices){if(protectionServices){var sortedRecommendedServices=[],sortedServices=[];return angular.forEach(protectionServices,function(protectionService){"isRecommended"===protectionService.recommended?sortedRecommendedServices.push(protectionService):protectionService.recommended===!1&&sortedServices.push(protectionService)}),sortedRecommendedServices=sortedRecommendedServices.concat(sortedServices)}return protectionServices}function getNewLineID(lineType){var requestBody,itemCode;if(itemCode=globalConfig.cartSettings.constants.mockSKUs.addNewLine,requestBody={itemCode:itemCode,selectedCreditLevel:creditClassService.getEPCreditClass()||"GOOD",financeOption:"",subType:lineType},toggleService.model.toggles.isPlanMgmtEnabled){globalValue&&globalValue.authorValue&&!globalValue.authorValue.cart&&getEssentialsAuthorData();var structCartData=getGlobalCart();return essentialsService.createEmptyLine(requestBody,{structCartData:structCartData}).then(createLineSuccessHandler)}return cartHttpDataService.addNewLine(requestBody).then(function(cartResponseStatus){return cartStorage.setCartId(cartResponseStatus.cartId),cartStorage.setOrderId(cartResponseStatus.orderId),cartResponseStatus.lineItems[cartResponseStatus.lineItems.length-1].lineId})}function getEssentialsAuthorData(){authorValueService.loadAuthorJson("/bin/authorvalue/content/t-mobile/smartcartdialog.json").then(function(response){globalValue.authorValue.cart=response.cart},function(error){$log.log("Error getting smartcartdialog data : "+error)})}function createLineSuccessHandler(createLineResponse){var structCartData=cartStorage.getGlobalSmartCartInfo(),length=structCartData.lineItems.length-1,createdLineItem=structCartData.lineItems[length],lineId=createdLineItem.lineId;return cartStorage.setCartId(structCartData.cartId),cartStorage.setOrderId(structCartData.orderId),lineId}function eligiblePlans(lineId,createdLineItem,sameState){var selectedPlan,deferred=$q.defer();return essentialsService.getEligiblePlans(lineId,createdLineItem.lineType,!1).then(function(eligiblePlansResponse){if(!lodash.isEmpty(eligiblePlansResponse)&&angular.isDefined(eligiblePlansResponse)&&null!==eligiblePlansResponse){var defaultPlan=getPlanToPost(createdLineItem,eligiblePlansResponse);selectedPlan=createdLineItem.lineType.toUpperCase()===cartConstants.DEVICE_TYPE.HANDSET?{offerFamilyId:defaultPlan.offerFamilyId,planOptions:[{soc:defaultPlan.planSoc||defaultPlan.planOptions[0].soc}]}:{offerFamilyId:defaultPlan.offerFamilyId},essentialsService.postSelectedPlanToLine(lineId,selectedPlan,sameState).then(function(result){sameState?cartHttpDataService.getCart().then(function(cartData){deferred.resolve(cartData)},function(error){deferred.reject(error),$log.log("Error getting cart details : "+error)}):$state.go("myCart")},function(error){$log.log("Error getting postSelectedPlanToLine data : "+error)})}},function(error){$log.log("Error getting getEligiblePlans data : "+error)}),deferred.promise}function getPlanToPost(createdLineItem,eligiblePlansResponse){var selectedPlan={},dfRequest=getDataFactoryRequest(),cacheKey=cartConstants.ESSENTIALS_CONSTANT.CACHE.DATA_KEY_NEW+JSON.stringify(dfRequest.input),dataCache=dataFactory.getCacheObject(cartConstants.ESSENTIALS_CONSTANT.CACHE.NAME),planType=dataCache.get(cacheKey);return selectedPlan=lodash.isEmpty(planType)?getDefaultPlanData(createdLineItem,eligiblePlansResponse):essentialsService.getSelectedPlanToPost(createdLineItem,eligiblePlansResponse.eligiblePlans,planType)}function getDataFactoryRequest(){var dfRequest=new dataFactory.DFRequest;return dfRequest.input={key:cartConstants.ESSENTIALS_CONSTANT.PLAN_TYPE},dfRequest}function getDefaultPlanType(plans){return lodash.isArray(plans)?lodash.find(plans,function(plan){return plan.isDefault===!0}):plans}function getDefaultPlanData(createdLineItem,eligiblePlansResponse){var defaultPlanByLineType;switch(createdLineItem.lineType){case"HANDSET":defaultPlanByLineType=getDefaultPlanType(globalValue.authorValue.cart.essentials.devicePlans);break;case"TABLET":defaultPlanByLineType=getDefaultPlanType(globalValue.authorValue.cart.essentials.tabletPlans);break;case"WEARABLE":defaultPlanByLineType=getDefaultPlanType(globalValue.authorValue.cart.essentials.wearablePlans)}var defaultPlan=lodash.find(eligiblePlansResponse.eligiblePlans,function(plan){return plan.offerFamilyId===defaultPlanByLineType.familyOfferId}),defaultPlanOption=lodash.find(defaultPlan.planOptions,function(option){return option["default"]===!0});return defaultPlanOption?{offerFamilyId:defaultPlan.offerFamilyId,planSoc:defaultPlanOption.soc,planType:defaultPlanByLineType.planType}:{offerFamilyId:defaultPlan.offerFamilyId,planType:defaultPlanByLineType.planType}}function checkPlanEligibility(productCategoryType){var cartData=cartStorage.getGlobalSmartCartInfo(),data=globalValue.authorValue.cart.essentials;if(angular.isDefined(cartData)&&angular.isDefined(data)&&cartData.lineItems.length>0){var planId=cartData.lineItems[0].lineItemDetails.planDetails.sku;angular.isDefined(planId)&&(checkEligibility(productCategoryType,data,planId)?openIneligibleModal():"")}}function checkEligibility(productCategoryType,data,planId){var currentPlanObject,selectedPlanType;switch(lodash.isArray(data.devicePlans)?currentPlanObject=lodash.find(data.devicePlans,function(plan){return lodash.find(plan.planUIDs,{planUid:planId})?plan:void 0}):lodash.find(data.devicePlans.planUIDs,{planUid:planId})&&(currentPlanObject=data.devicePlans),angular.isDefined(currentPlanObject)&&(selectedPlanType=currentPlanObject.planType),productCategoryType){case cartConstants.DEVICE_TYPE.HANDSET:return checkPlanTypeEligibility(data.devicePlans,selectedPlanType);case cartConstants.DEVICE_TYPE.TABLET:return checkPlanTypeEligibility(data.tabletPlans,selectedPlanType);case cartConstants.DEVICE_TYPE.WEARABLE:return checkPlanTypeEligibility(data.wearablePlans,selectedPlanType);default:return!1}}function checkPlanTypeEligibility(availablePlans,selectedPlanType){var planObject={};return lodash.isArray(availablePlans)?planObject=lodash.find(availablePlans,function(plan){return plan.planType===selectedPlanType}):availablePlans.planType===selectedPlanType&&(planObject=availablePlans),lodash.isEmpty(planObject)}function openIneligibleModal(modalData){commonResolves=getCommonResolves(null,null,null,modalData);var resolveAttributes={resolve:angular.extend(commonResolves.keyValues)};CartCommonModal.openCartModal("ineligibleModal",resolveAttributes)}function getImagePath(cdnUrl,imagepath){$log.log("cdnURL-==========",cdnUrl),$log.log("toggleService.model.toggles.enableGar",toggleService.model.toggles.enableGar),$log.log("imagepath",imagepath);var updatedModel=imagepath;return toggleService.model.toggles.enableGar&&(updatedModel=cdnUrl+imagepath),updatedModel}function checkFinanceEstimatesCall(){var cartData=cartStorage.getGlobalSmartCartInfo(),isDeviceEIP=!1,isAccessoryEIP=!1;angular.forEach(cartData.lineItems,function(lineItem){angular.equals(lineItem.lineItemDetails.deviceDetails.pricingOption,"MONTHLY")&&(isDeviceEIP=!0)}),cartData.accessories.accessoryDetails&&cartData.accessories.accessoryDetails.length>0&&angular.forEach(cartData.accessories.accessoryDetails,function(accessory){angular.equals(accessory.paymentOption,"EIP")&&(isAccessoryEIP=!0)}),isDeviceEIP||isAccessoryEIP?cartStorage.setIsEIPReservationRequired(!0):cartStorage.setIsEIPReservationRequired(!1)}var cartInfo,simKitDetails,commonResolves,genericCommonResolves={};return{getGlobalCart:getGlobalCart,getSIMKitDetails:getSIMKitDetails,isLineItemPresent:isLineItemPresent,commonResolves:getCommonResolves,transformCartResponse:transformCartResponse,isPlanSelectorModal:isPlanSelectorModal,addCartStoredValues:addCartStoredValues,getSortedServices:getSortedServices,getNewLineID:getNewLineID,getEssentialsAuthorData:getEssentialsAuthorData,createLineSuccessHandler:createLineSuccessHandler,eligiblePlans:eligiblePlans,checkPlanEligibility:checkPlanEligibility,openIneligibleModal:openIneligibleModal,getDefaultPlanData:getDefaultPlanData,getDataFactoryRequest:getDataFactoryRequest,getImagePath:getImagePath,checkFinanceEstimatesCall:checkFinanceEstimatesCall}}cartControllerHelperServiceConstructor.$inject=["cartStorage","cartHttpDataService","$q","deviceProtectionAndServicesHttpData","responseTransformationService","creditClassService","transformCart","dataFactory","globalConfig","jsonPath","$log","apiService","pdpResponseTransformationServicePDPV2","toggleService","essentialsService","authorValueService","globalValue","$state","cartConstants","CartCommonModal"],angular.module("tmobileApp").service("cartControllerHelperService",cartControllerHelperServiceConstructor);
}(window.angular,window._),function(angular){"use strict";function selligentUtils($http,utils,csrfTokenUtils){function makeEventRouterRequest(csrfToken,token,data,url){var req={method:"POST",url:url,headers:{Authorization:"Basic "+token,"CSRF-Token":csrfToken},data:data};return $http(req)}function makeSelligentLeadRequest(csrfToken,token,data,url){var req={method:"POST",url:url,headers:{Authorization:"Basic "+token,"CSRF-Token":csrfToken},data:data};return $http(req)}function createSelligentLead(authToken,inputData,type,url){return csrfTokenUtils.getCSRF(authToken).then(function(csrfToken){return"eventRouter"===type?makeEventRouterRequest(csrfToken,authToken,inputData,url):makeSelligentLeadRequest(csrfToken,authToken,inputData,url)})}return{createSelligentLead:createSelligentLead}}selligentUtils.$inject=["$http","utils","csrfTokenUtils"],angular.module("marketingCore").factory("selligentUtils",selligentUtils)}(window.angular),function(angular,lodash){"use strict";function CartCommonModalConstructor($modal,loggingService,$log,productDetailsService,pdlConstant,pdlService,$injector){function openCartModal(modalName,modalResolve,modalCallBack,modalDismissCallBack,disableBackdrop){$log.log("modalResolve::",angular.extend(modalSettings[modalName],modalResolve)),disableBackdrop?(modalSettings[modalName].backdrop="static",modalSettings[modalName].keyboard=!1):!disableBackdrop&&modalSettings[modalName].backdrop&&(modalSettings[modalName].backdrop=!0,modalSettings[modalName].keyboard=!0),productDetailsService.rejectPromise();var modalInstance=$modal.open(angular.extend(modalSettings[modalName],modalResolve));modalInstance.result.then(function(modalObject){loggingService.debug("Here is the API response for openExitPathConfirmationModal",modalObject),modalCallBack&&modalCallBack(modalObject)},function(err){if(err){var cartCommonOperationsService=$injector.get("cartCommonOperationsService"),dismissModalName=cartCommonOperationsService.model.isOverrideCart?pdlConstant.CARTOVERRIDE_MODAL_NAME:modalName,modalData=lodash.get(pdlConstant.BACK_DROP_MODALS,dismissModalName);angular.isDefined(modalData)&&pdlService.setModalBackDropCloseEvent(modalData)}productDetailsService.rejectPromise(),$log.log("openCartModal dismiss error::",err),modalDismissCallBack&&modalDismissCallBack()})}var modalSettings={deviceSelectorModal:{size:"lg",windowClass:"device-selector-modal",templateUrl:"app/cart/deviceSelectorModal/deviceSelectorModal.html",controller:"DeviceSelectorModalController",controllerAs:"deviceSelectorModalCtrl"},miniPDPModal:{size:"lg",windowClass:"mini-pdp-modal",templateUrl:"app/cart/miniPDPModal/miniPDPModal.html",controller:"miniPDPModalController",controllerAs:"miniPDPModalCtrl"},priceBreakdownModal:{size:"lg",windowClass:"price-breakdown-modal",templateUrl:"app/cart/priceBreakdownModal/priceBreakdownModal.html",controller:"PriceBreakdownController",controllerAs:"priceBreakdownCtrl"},phpModal:{size:"lg",windowClass:"php-modal",templateUrl:"app/cart/PHPModal/PHPModal.html",controller:"PHPModalController",controllerAs:"phpModalCtrl"},exitPathConfirmationModal:{size:"lg",windowClass:"open-exit-modal",templateUrl:"app/cart/exitPathConfirmationModal/exitPathConfirmation.html",controller:"ExitPathConfirmationController",controllerAs:"exitPathConfirmation"},locationFPOModal:{size:"lg",windowClass:"location-fpo-modal",templateUrl:"app/cart/setLocationFPOModal/setLocationFPOModal.html",controller:"SetLocationFPOModalController",controllerAs:"setLocationFPOModalCtrl"},learnMoreModal:{size:"lg",windowClass:"learn-more-modal",templateUrl:"app/cart/learnMoreModal/learnMoreModal.html",controller:"LearnMoreModalController",controllerAs:"learnMoreModalCtrl"},ownPhoneModal:{size:"lg",windowClass:"own-phone-modal",templateUrl:"app/cart/ownPhoneModal/ownPhone.html",controller:"OwnPhoneController",controllerAs:"ownPhone"},creditSelectionModal:{size:"lg",windowClass:"holdup-modal",templateUrl:"app/cart/creditSelectorModal/creditClassSelectorModal.html",controller:"CreditSelectorModalController",controllerAs:"creditSelectorModalCtrl"},deviceProtectionAndServicesSelectorModal:{size:"lg",windowClass:"protection-modal",templateUrl:"app/cart/deviceProtectionAndServicesSelectorModal/deviceProtectionAndServicesSelectorModal.html",controller:"DeviceProtectionAndServicesSelectorModalController",controllerAs:"devicePASelctor"},deviceProtectionAndServicesSelectorModalV3:{size:"lg",windowClass:"protection-modal",templateUrl:"app/cart/deviceProtectionAndServicesSelectorModal/deviceProtectionAndServicesSelectorModalV3.html",controller:"DeviceProtectionAndServicesSelectorModalV3Controller",controllerAs:"devicePASelector"},accessoriesSelectorModal:{size:"lg",windowClass:"accessories-modal",templateUrl:"app/cart/Accessory/accessorySelectorModal/accessorySelectorModal.html",controller:"AccessorySelectorModalController",controllerAs:"vm",keyboard:!0},planModal:{size:"lg",windowClass:"plan-modal planModalCustomClass",templateUrl:"app/cart/planModal/planModal.html",controller:"PlanModalController",controllerAs:"vm"},checkCompatibilityModal:{size:"lg",windowClass:"check-compatibility-modal",templateUrl:"app/cart/checkCompatibilityModal/checkCompatibilityModal.html",controller:"CheckCompatibilityModalController",controllerAs:"vm"},checkCompatibilityResultModal:{size:"lg",windowClass:"check-compatibility-result-modal",templateUrl:"app/cart/checkCompatibilityResultModal/checkCompatibilityResultModal.html",controller:"CheckCompatibilityResultModalController",controllerAs:"vm"},checkImeiModal:{size:"lg",windowClass:"check-imei-modal",templateUrl:"app/cart/checkIMEIModal/checkIMEIModal.html",controller:"CheckIMEIModalController",controllerAs:"vm"},alertMessageModal:{size:"md",windowClass:"alert-message-modal",templateUrl:"app/cart/components/alertMessage/alertMessage.html",controller:"alertMessageController",controllerAs:"alertMessageCtrl"},ineligibleModal:{size:"md",windowClass:"ineligible-modal",templateUrl:"app/cart/ineligibleModal/ineligibleModal.html",controller:"ineligibleModalController",controllerAs:"ineligibleModalCtrl"},comparePlanModal:{size:"lg",windowClass:"compare-plan-modal",templateUrl:"app/cart/comparePlanModal/comparePlanModal.html",controller:"comparePlanController",controllerAs:"comparePlanController"},saveCartModal:{size:"lg",windowClass:"save-cart",templateUrl:"app/cart/saveCartModal/saveCart.html",controller:"saveCartController",controllerAs:"vm"},finalizeInStoreModal:{size:"lg",windowClass:"finalize-in-store",templateUrl:"app/cart/finalizeInStoreModal/finalizeInStore.html",controller:"finalizeInStoreController",controllerAs:"vm"},finalizeCartThankYouModal:{size:"lg",windowClass:"finalize-cart-thankyou",templateUrl:"app/cart/finalizeInStoreThankYou/finalizeInStoreThankYou.html",controller:"finalizeInStoreThankYouController",controllerAs:"vm"},saveCartWebConfirmationModal:{size:"lg",windowClass:"finalize-cart-thankyou",templateUrl:"app/cart/finalizeInStoreThankYou/saveCartWebConfirmationModal.html",controller:"saveWebConfirmationModalController",controllerAs:"vm"},saveCartThankYouModal:{size:"lg",windowClass:"save-cart-thankyou",templateUrl:"app/cart/saveCartThankYouModal/saveCartThankYouModal.tpl.html",controller:"saveCartThankYouModalController",controllerAs:"vm"},loadCartModal:{size:"lg",windowClass:"load-cart",templateUrl:"app/cart/loadCartModal/loadCart.html",controller:"loadCartController",controllerAs:"vm"},tradeInTool:{size:"lg",windowClass:"trade-in-tool",templateUrl:"app/cart/tradeIn/tradeIn.html",controller:"tradeInController",controllerAs:"vm"},tradeValueScreen:{size:"lg",windowClass:"trade-value-screen",templateUrl:"app/core/components/tradeInTool/tradeValueScreen/tradeValueScreen.html",controller:"tradeValueScreenController",controllerAs:"vm"},miniBrowseAccessory:{size:"lg",windowClass:"mini-browse-accessory-modal",templateUrl:"app/cart/accessories/miniBrowse/miniBrowseAccessory.html",controller:"miniBrowseAccessoryController",controllerAs:"vm"},miniPDPAccessory:{size:"lg",windowClass:"mini-pdp-accessory-modal",templateUrl:"app/cart/accessories/miniPDP/miniPDPAccessory.html",controller:"miniPDPAccessoryController",controllerAs:"vm"},accessoriesMiniBrowse:{size:"lg",windowClass:"accessories-mini-browse-modal",templateUrl:"app/cart/cartAccessories/accessoriesMiniBrowse/accessoriesMiniBrowse.html",controller:"AccessoriesMiniBrowseController",controllerAs:"vm"},accessoriesMiniPDP:{size:"lg",windowClass:"accessories-mini-pdp-modal",templateUrl:"app/cart/cartAccessories/accessoriesMiniPDP/accessoriesMiniPDP.html",controller:"AccessoriesMiniPDPController",controllerAs:"vm"},authenticationModal:{size:"lg",windowClass:"authentication-modal",templateUrl:"app/cart/authenticationModel/authenticationModel.html",controller:"AuthModelController",controllerAs:"vm"}};return{openCartModal:openCartModal}}var serviceName="CartCommonModal";angular.module("tmobileApp").service(serviceName,CartCommonModalConstructor)}(window.angular,window._),function(angular){"use strict";function sendSMSUtils($q,$http,utils,$window){function isReady(){return isLoading||(isLoading=!0,utils.pollForGlobal("branch",3e3).then(function(){deferred.resolve(!0)},function(){deferred.reject("Error while loading branch API")})),deferred.promise}function sendText(branchKey,phoneNumber,options,message,callback){return isReady(branchKey).then(function(){$window.branch.init(branchKey);var optionsParam=options||{},linkData={tags:optionsParam.tags||[],channel:optionsParam.channel||"Website",feature:optionsParam.feature||"TextMeTheApp",data:optionsParam.data||{}};message&&message.length>0&&(linkData.data.$custom_sms_text=message+" {{ link }}");var branchOptions={};$window.branch.sendSMS(phoneNumber,linkData,branchOptions,callback)},function(error){return $q.reject(error)})}var deferred=$q.defer(),isLoading=!1;return{isReady:isReady,sendText:sendText}}sendSMSUtils.$inject=["$q","$http","utils","$window"],angular.module("marketingCore").factory("sendSMSUtils",sendSMSUtils)}(window.angular),function(angular,externalLogger){"use strict";angular.module("tmobileApp").constant("CART_STATE_NAME","myCart").config(["$stateProvider","LOWER_FUNNEL_ABSTRACT_ROOT_STATE_NAME","CART_STATE_NAME",function($stateProvider,LOWER_FUNNEL_ABSTRACT_ROOT_STATE_NAME,CART_STATE_NAME){externalLogger.moduleConfigured("tmobileApp","cart.js");var cartStateConfig={url:"/cart",parent:LOWER_FUNNEL_ABSTRACT_ROOT_STATE_NAME,data:{title:"My Cart"},views:{content:{templateUrl:"app/cart/myCart.html",controller:"CartController",controllerAs:"myCartCtrl"}},resolve:{toggleData:function($log,toggleService){return toggleService.getToggleFeature().then(function(toggle){return $log.log(" resolve :: toggleService"),toggle})},keyValues:function(keyValuesUtilities){return keyValuesUtilities.getKeyValuePairs().then(function(keyValues){return keyValues})},unoHandOff:function(toggleData,unoHandOff,unoHandOffV3){var check=angular.equals(toggleData.toggles.isUnoOn,!0)&&angular.equals(toggleData.toggles.isDcpV3ApiEnabled,!0);return check?unoHandOffV3.initialization(toggleData):unoHandOff.initialization(toggleData)}}};$stateProvider.state(CART_STATE_NAME,cartStateConfig)}])}(angular,externalLogger),function(angular){"use strict";function utils($q,$interval,$window,$document,$timeout){function isTouch(){return"ontouchstart"in window||navigator.maxTouchPoints}function isInView(element){return $window.pageYOffset>getElementOffset(element).top+element.clientHeight?"top":getElementOffset(element).top>$window.pageYOffset+$window.innerHeight?"bottom":!0}function isCarouselCardInView(element){var rect=element.getBoundingClientRect();return rect.left>=0&&rect.right<=($window.innerWidth||$document.documentElement.clientWidth)}function focusElement(selector){$timeout(function(){var selected=$window.document.querySelector(selector);selected&&(selected.tabIndex=-1,selected.focus())})}function getElementOffset(element){var rect=element.getBoundingClientRect(),win=element.ownerDocument.defaultView;return{top:rect.top+win.pageYOffset,left:rect.left+win.pageXOffset,bottom:rect.bottom+win.pageYOffset}}function getOS(){var userAgent=navigator.userAgent||navigator.vendor||$window.opera;return/android/i.test(userAgent)?"Android":/iPad|iPhone|iPod/.test(userAgent)&&!$window.MSStream?"iOS":"unknown"}function loadScript(src,callback,location){var s=$window.document.createElement("script");if(s.type="text/javascript",s.async=!0,s.src=src,s.addEventListener("load",callback,!1),location)location.insertAdjacentElement("beforeend",s);else{var head=$window.document.getElementsByTagName("head")[0];head.appendChild(s)}}function pollForGlobal(global,timeout){var deferred=$q.defer(),t=0,check=$interval(function(){$window[global]?(deferred.resolve(),cancelCheck()):timeout&&t>=timeout&&(deferred.reject(),cancelCheck()),t+=100},100),cancelCheck=function(){$interval.cancel(check),check=null};return deferred.promise}function announce(holder,message,method){var announcer,methodSet=method||"polite";return holder.setAttribute("aria-live","off"),announcer=holder,announcer.innerHTML="",announcer.setAttribute("aria-live",methodSet),announcer.innerHTML=message,this}function getGeolocation(){var deferred=$q.defer();return sessionStorage.getItem("latitude")&&sessionStorage.getItem("longitude")?deferred.resolve({latitude:sessionStorage.getItem("latitude"),longitude:sessionStorage.getItem("longitude")}):navigator.geolocation&&navigator.geolocation.getCurrentPosition(function(position){sessionStorage.setItem("latitude",position.coords.latitude),sessionStorage.setItem("longitude",position.coords.longitude),deferred.resolve({latitude:position.coords.latitude,longitude:position.coords.longitude})},function(){deferred.reject("There was a geolocation error.")}),deferred.promise}function getDistanceFromLatLonInKm(lat1,lon1,lat2,lon2){var R=6371,dLat=deg2rad(lat2-lat1),dLon=deg2rad(lon2-lon1),a=Math.sin(dLat/2)*Math.sin(dLat/2)+Math.cos(deg2rad(lat1))*Math.cos(deg2rad(lat2))*Math.sin(dLon/2)*Math.sin(dLon/2),c=2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a)),d=R*c;return d}function deg2rad(deg){return deg*(Math.PI/180)}function getClosest(element,selector){var matchesFn;["matches","webkitMatchesSelector","mozMatchesSelector","msMatchesSelector","oMatchesSelector"].some(function(fn){return angular.isFunction($document[0].body[fn])?(matchesFn=fn,!0):!1});for(var elementParent=element;elementParent;)if(elementParent=elementParent.parentElement,elementParent&&elementParent[matchesFn](selector))return elementParent;return null}function getPageReach(win,html){return{initial:Math.min(100,Math.round(win.height()/html.height()*1e4)/100),maxReach:Math.min(100,Math.round(win.height()/html.height()*1e4)/100),exitPoint:Math.min(100,Math.round((win.scrollTop()+win.height())/html.height()*1e4)/100)}}function htmlSanitization(str){return String(str).replace(/&nbsp;/g," ").replace(/(?:\r\n|\r|\n)/g,"").replace(/<(?:.|[\s\S])*?>/gm,"").replace(/ {2}/gm," ")}return{isTouch:isTouch,isInView:isInView,isCarouselCardInView:isCarouselCardInView,focusElement:focusElement,getOS:getOS,loadScript:loadScript,pollForGlobal:pollForGlobal,announce:announce,getGeolocation:getGeolocation,getDistanceFromLatLonInKm:getDistanceFromLatLonInKm,getClosest:getClosest,getElementOffset:getElementOffset,getPageReach:getPageReach,htmlSanitization:htmlSanitization}}utils.$inject=["$q","$interval","$window","$document","$timeout"],angular.module("marketingCore").factory("utils",utils)}(window.angular),function(angular){"use strict";angular.module("tmobileApp").constant("cartConstants",{SIM_KIT_BYOD:"SIM_KIT_BYOD",REQ_DATA_MINI_PLP:{HANDSET:{productTypes:["DEVICE"],billingType:"POSTPAID",filterOptionsSelected:[{fieldName:"productSubType",values:["Handset","SimCard","SIM"]}],pageSize:"50",sortOptions:[{sortOptionValue:"frpPrice",sortDirection:"descending"}]},TABLET:{productType:["Device"],billingType:"POSTPAID",filterOptionsSelected:[{fieldName:"productSubType",values:["Tablet","Mobile HotSpot","IOT","Wearable"]}],sortOptions:[{sortOptionValue:"frpPrice",sortDirection:"descending"}],pageSize:"50"},WEARABLE:{productType:["Device"],billingType:"POSTPAID",filterOptionsSelected:[{fieldName:"productSubType",values:["TABLET","WEARABLE"]}],sortOptions:[{sortOptionValue:"frpPrice",sortDirection:"descending"}],pageSize:"50"},ACCESSORY:{productType:["ACCESSORY"],filterOptionsSelected:[{fieldName:"productType",values:["ACCESSORY"]},{fieldName:"productSubType",exclude:["SimCard"]}],sortOptions:[{sortOptionValue:"frpPrice",sortDirection:"descending"}],pageSize:"50",pageNumber:"1"}},SF_CART_TYPE:{SEND_TO_RETAIL:"Send To Retail",SAVE_WEB_CART:"Saved Web Cart"},OTHERS:{TRUE:"true"},SAVE_CART:{SHOW_ITEMS:"Show Items",HIDE_ITEMS:"Hide Items"},INVENTORY_STATUS:{ALL_ITEMS:"All items in stock",IN_STOCK:"In stock",ITEMS_IN_STOCK:"items in stock",OUT_STOCK:"Out of stock"},DEVICE:"DEVICE",ACCESSORY:"ACCESSORY",SIM_CARD:"SimCard",ALL_CATEGORIES:"All Categories",EIP:"EIP",MONTHLY:"MONTHLY",TOTAL_FINANCE_AMOUNT:"Total Financed amount",MARKET_CONSENT:"Marketing consent",SELECT_PHONE:"Select Phone",DEVICE_TYPE:{HANDSET:"HANDSET",TABLET:"TABLET",WEARABLE:"WEARABLE",ACCESSORY:"ACCESSORY",BYOD:"BYOD"},APPLE_MANUFACTURER:"Apple",DEVICE_SUBTYPE:{TABLET:"Tablet",WEARABLE:"Wearable"},DEVICE_TYPE_IN_LOWER:{ACCESSORY:"accessory",HANDSET:"phone",TABLET:"internet-device",WEARABLE:"wearable"},ESSENTIALS_PLAN_UIDs:{HANDSET:"devicePlanUID",TABLET:"tabletPlanUID",WEARABLE:"wearablePlanUID"},ESSENTIALS_CONSTANT:{ADD_NEW_LINE:"addNewLine",GET_ELIGIBLE_PLANS:"getEligiblePlans",GET_ELIGIBLE_PLAN_CART:"getEligiblePlansCart",POST_PLAN_TO_LINE:"postPlanToLine",PATCH_PLAN_TO_LINE:"patchPlanToLine",ELIGIBLE_PLANS:"eligiblePlans",CONTENT_TYPE_VALUE:"application/json",APPLICATION_ID_VALUE:"TMO",CHANNEL_ID_VALUE:"WEB",CREDIT_LEVEL_GOOD:"GOOD",TRANSACTION_CODE:"ACTIVATION",TRUE:"TRUE",PLAN_TYPE:"planType",DEFAULT_PLAN:"defaultPlan",ERROR_TEXT:"error",SUCCESS_CODE:200,MAGENTA_PLUS_PLAN:"T_Mobile_PLUS",CLIENTID:"TMNG",CACHE:{NAME:"sessionStorage",DATA_KEY:"essentialsService",DATA_KEY_NEW:"postPlanToLine",DATA_KEY_CART:"getEligiblePlansCart"},HANDSET:"HANDSET",DEFAULT_INTERACTIONID:"abc12354687",TRADEIN_ELIGIBILITY:"tradeInIMEI",CART_PLANS_URL:"cartPlansUrl"},P_SIM:"pSim",FILTER_OPTIONS:{MANUFACTURER:{VALUE:"manufacturer",URL_KEY:"pm"},PRICE_RANGE:{VALUE:"priceRange",URL_KEY:"prg"},CONDITION:{VALUE:"condition",URL_KEY:"cd"},OPERATING_SYSTEM:{URL_KEY:"osy",VALUE:"operatingSystem"}},SUCCESS_CODE:200,SORT_OPTIONS_VALUE:{FRP_PRICE:"frpPrice",PRICE_LOW_TO_HIGH:"pr",PRICE_HIGH_TO_LOW:"prr",FEATURED:{VALUE:"isfeatured_sort_integer",URL_KEY:"if"},RATING:{VALUE:"reviewrating",URL_KEY:"r"},BESTSELLER:{VALUE:"bestseller_sort_integer",URL_KEY:"bs"}},SORT_DIRECTION:{ASCENDING:"ascending",DESCENDING:"descending"},ITEMS_PER_PAGE:"12",ADD_ONS_OFFER_FAMILY_ID:{addOnsHandsetTMOOne:"TMO1HANDSET",addOnsHandsetTMOEss:"TMOESSENTIALSHANDSET",addOnsTabletTMOOne:"TMO1TABLET",addOnsTabletTMOEss:"TMOESSENTIALSTEBLATE",addOnsWearableTMOOne:"TMO1WEARABLE"},ADD_ONS_LINETYPE_AEM_COMPONENT:{HANDSET:["addOnsHandsetTMOOne","addOnsHandsetTMOEss","addOnsHandsetMagentaPlus"],TABLET:["addOnsTabletTMOOne","addOnsTabletTMOEss","addOnsTabletMagentaPlus"],WEARABLE:["addOnsWearableTMOOne"]},LINE_HEADER_TEXT:"Line",GET_QUOTES_KEY:"getQuotes",INDIVIDUAL:"INDIVIDUAL",INDIVIDUAL_REGULAR:"INDIVIDUAL_REGULAR",PRODUCT_TYPE:{SERVICE:"service",DATASOC:"datasoc"},PLAN_TYPES:{T_MOBILE_ESSENTIALS:"T_Mobile_Essentials",T_MOBILE_ONE:"T_Mobile_ONE",T_MOBILE_PLUS:"T_Mobile_PLUS"},PAYMENT_OPTION:"paymentOption"})}(angular),function(angular){"use strict";function accordionNavConstructor($window){return{restrict:"A",link:function(scope,element,attrs){element.bind("click",function(){if($window.innerWidth<724){var elem=$(this);elem.hasClass("section-expanded")?elem.removeClass("section-expanded"):elem.addClass("section-expanded")}})}}}accordionNavConstructor.$inject=["$window"],angular.module("marketingCore").directive("accordionnav",accordionNavConstructor)}(window.angular),function(angular){"use strict";function breakdownPromotionDetailsControllerFunction($scope,$rootScope,globalConfig){var vm=this;vm.promotionObj=vm.promotionData,vm.promoAuthorValue=vm.authorValue,vm.cartSettings=globalConfig.cartSettings}breakdownPromotionDetailsControllerFunction.$inject=["$scope","$rootScope","globalConfig"];var controllerName="BreakdownPromotionDetailsController";angular.module("tmobileApp").controller(controllerName,breakdownPromotionDetailsControllerFunction)}(angular),function(angular){"use strict";var marketingfootercomponentconstructor={templateUrl:"app/marketing/footer/footer.component.html",controller:"marketingFooterController",controllerAs:"vm",bindings:{}};angular.module("marketingApp").component("marketingFooter",marketingfootercomponentconstructor)}(angular),function(angular,lodash){"use strict";function cartBreakdownDetailsControllerFunction($scope,commonUtils,globalValue,globalConfig,cartCommonOperationsService,toggleService,essentialsService,cartStorage){function toggleCollapse(item){item.mvcAttrs.isCollapsed=!item.mvcAttrs.isCollapsed,item.mvcAttrs.collapsedMsg=item.mvcAttrs.isCollapsed?"Collapsed":"Not Collapsed"}function orderGrouping(lineItems,orderGroup){var isGrouped=!1;return angular.forEach(lineItems,function(item,key){return item.orderGroup!==orderGroup||isGrouped?void 0:(item.mvcAttrs.isCollapsed=!1,item.mvcAttrs.collapsedMsg="Not Collapsed",void(isGrouped=!0))}),isGrouped}function setDataSocDetails(){lodash.isEmpty(vm.cartObj.lineItems)||angular.forEach(vm.cartObj.lineItems,function(lineItem){essentialsService.getNonDefaultDataSocDetails(lineItem).then(function(dataSocDetails){lineItem.dataSocDetails=dataSocDetails})})}var vm=this;switch(vm.cartObj=vm.cartData,vm.uiType=vm.sourceType.type,vm.authorValue.page=globalValue.authorValue.page,vm.authorValue.rootPage=globalValue.authorValue.rootPage,vm.cartSettings=globalConfig.cartSettings,vm.isVoiceLineAdded=lodash.get(cartCommonOperationsService.model,"structCartData.flags.isVoiceLineAdded"),vm.isVerifiedCRPForTPP=cartCommonOperationsService.isCRPVerifiedForTPP(),vm.showSskKey=toggleService.model.toggles.isSimKitEnabled,angular.forEach(vm.cartObj.accessories.accessoryDetails,function(item,key){item.mvcAttrs||(item.mvcAttrs={}),item.mvcAttrs.isCollapsed=!0,item.mvcAttrs.collapsedMsg="Collapsed"}),vm.cartObj.accessories.accessoryDetails&&vm.cartObj.accessories.accessoryDetails.length>0&&(vm.cartObj.accessories.accessoryDetails[0].mvcAttrs.isCollapsed=!1,vm.cartObj.accessories.accessoryDetails[0].mvcAttrs.collapsedMsg="Not Collapsed"),angular.forEach(vm.cartObj.lineItems,function(item,key){item.mvcAttrs.isCollapsed=!0,item.mvcAttrs.collapsedMsg="Collapsed"}),vm.uiType){case"priceBreakdown":vm.breakdownAuthorValue={rootPage:vm.authorValue.rootPage,planNameDevice:commonUtils.searchJson(vm.authorValue.rootPage,"pricingBreakdown.planNameDevice"),tabletPlanName:commonUtils.searchJson(vm.authorValue.rootPage,"pricingBreakdown.tabletPlanName"),wearablePlanName:commonUtils.searchJson(vm.authorValue.rootPage,"pricingBreakdown.wearablePlanName"),deviceLegalText:commonUtils.searchJson(vm.authorValue.rootPage,"pricingBreakdown.deviceLegalText"),rowOfferTitle:commonUtils.searchJson(vm.authorValue,"cartRowItems.rowOfferTitle"),todayPriceLabel:commonUtils.searchJson(vm.authorValue.rootPage,"pricing.todayPriceLabel"),monthlyPriceLabel:commonUtils.searchJson(vm.authorValue.rootPage,"pricing.monthlyPriceLabel"),taxesAndFeesDetail:commonUtils.searchJson(vm.authorValue.rootPage,"pricing.taxesAndFeesDetail"),includeAutoPay:commonUtils.searchJson(vm.authorValue.rootPage,"pricing.includeAutoPay"),includesLabel:commonUtils.searchJson(vm.authorValue.rootPage,"pricing.includeLabel"),hybridBanDetail:commonUtils.searchJson(vm.authorValue.rootPage,"pricingBreakdown.hybridBanDetail"),wearableHybridBanDetail:commonUtils.searchJson(vm.authorValue.rootPage,"pricingBreakdown.wearableHybridBanDetail"),hybridBanLegalTextTablet:commonUtils.searchJson(vm.authorValue.rootPage,"pricingBreakdown.hybridBanLegalTextTablet"),hybridBanLegalTextWearable:commonUtils.searchJson(vm.authorValue.rootPage,"pricingBreakdown.hybridBanLegalTextWearable"),pbReinforceMessageTablet:commonUtils.searchJson(vm.authorValue.rootPage,"pricingBreakdown.pbReinforceMessageTablet"),pbReinforceIconTablet:commonUtils.searchJson(vm.authorValue.rootPage,"pricingBreakdown.pbReinforceIconTablet"),pbReinforceMessageWearable:commonUtils.searchJson(vm.authorValue.rootPage,"pricingBreakdown.pbReinforceMessageWearable"),pbReinforceIconWearable:commonUtils.searchJson(vm.authorValue.rootPage,"pricingBreakdown.pbReinforceIconWearable"),accessoriesTitle:commonUtils.searchJson(vm.authorValue,"accessories.accessoriesTitle"),eipDetail:commonUtils.searchJson(vm.authorValue.rootPage,"pricing.eipDetail"),simKitToolTip:commonUtils.searchJson(vm.authorValue.rootPage.generalAuthoring,"simtooltipdesc"),simKitText:commonUtils.searchJson(vm.authorValue,"simkittooltip.simKitText"),refundableDepositHeader:commonUtils.searchJson(vm.authorValue,"cartRowItems.refundableDepositHeader"),accessoriesLegal:commonUtils.searchJson(vm.authorValue,"accessories.frpCartMessage"),promotionIcon:commonUtils.searchJson(vm.authorValue,"icons.promotionIcon"),flp:commonUtils.searchJson(vm.authorValue.rootPage,"pricingBreakdown.flp"),fsp:commonUtils.searchJson(vm.authorValue.rootPage,"pricingBreakdown.fsp"),refundableDeposit:commonUtils.searchJson(vm.authorValue.rootPage,"pricingBreakdown.refundableDeposit"),refundableDepositIcon:commonUtils.searchJson(vm.authorValue.rootPage,"pricingBreakdown.refundableDepositIcon"),totalPrice:commonUtils.searchJson(vm.authorValue.rootPage,"pricingBreakdown.totalPrice"),autoPayText:commonUtils.searchJson(vm.authorValue.rootPage,"pricingBreakdown.autoPayText"),planUpgradeText:commonUtils.searchJson(vm.authorValue.rootPage,"pricingBreakdown.planUpgradeText"),eipMonthlyPaymentDesc:commonUtils.searchJson(vm.authorValue,"rootPage.generalAuthoring.eipmonthly_price_desc"),orderTypeDisplay:{AVAILABLE:commonUtils.searchJson(vm.authorValue.rootPage,"pricingBreakdown.yourOrder"),AVAILABLE_FOR_BACK_ORDER:commonUtils.searchJson(vm.authorValue.rootPage,"pricingBreakdown.backOrder"),AVAILABLE_FOR_PRE_ORDER:commonUtils.searchJson(vm.authorValue.rootPage,"pricingBreakdown.preOrder")},standardTitle:commonUtils.searchJson(vm.authorValue.rootPage,"tradeInTool.standardOrderDetails.standardTitle"),standardTradeInDeviceHeader:commonUtils.searchJson(vm.authorValue.rootPage,"tradeInTool.standardOrderDetails.standardTradeInDeviceHeader"),standardTradeInDeviceInfo:commonUtils.searchJson(vm.authorValue.rootPage,"tradeInTool.standardOrderDetails.standardTradeInDeviceInfo"),tradeInValueModalLink:commonUtils.searchJson(vm.authorValue.rootPage,"tradeInTool.standardOrderDetails.tradeInValueModalLink"),promotionTitle:commonUtils.searchJson(vm.authorValue.rootPage,"tradeInTool.promotionOrderDetails.promotionTitle"),promotionTradeInDeviceHeader:commonUtils.searchJson(vm.authorValue.rootPage,"tradeInTool.promotionOrderDetails.promotionTradeInDeviceHeader"),promotionTradeInDeviceInfo:commonUtils.searchJson(vm.authorValue.rootPage,"tradeInTool.promotionOrderDetails.promotionTradeInDeviceInfo"),simKitImage:commonUtils.searchJson(vm.authorValue.rootPage,"simStarterKitImage.sskImagePath"),autoPayDiscountLabel:commonUtils.searchJson(vm.authorValue.rootPage,"pricing.autoPayDiscountLabel"),deviceLabel:commonUtils.searchJson(vm.authorValue.rootPage,"pricing.deviceLabel")},angular.isUndefined(vm.breakdownAuthorValue.accessoriesLegal)&&(vm.breakdownAuthorValue.accessoriesLegal=vm.authorValue.checkout.review.accessoriesLegalText),orderGrouping(vm.cartObj.lineItems,0),orderGrouping(vm.cartObj.lineItems,1),orderGrouping(vm.cartObj.lineItems,2);break;case"reviewCart":vm.keyValues=vm.authorValue,vm.breakdownAuthorValue={planNameDevice:commonUtils.searchJson(vm.authorValue,"checkout.review.planNameDevice"),tabletPlanName:commonUtils.searchJson(vm.authorValue,"checkout.review.tabletPlanName"),wearablePlanName:commonUtils.searchJson(vm.authorValue,"checkout.review.wearablePlanName"),todayPriceLabel:commonUtils.searchJson(vm.authorValue,"checkout.review.todayPriceLabel"),monthlyPriceLabel:commonUtils.searchJson(vm.authorValue,"checkout.review.monthlyPriceLabel"),taxesAndFeesDetail:commonUtils.searchJson(vm.authorValue,"checkout.review.taxesAndFeesDetail"),includesLabel:commonUtils.searchJson(vm.authorValue,"checkout.review.includeLabel"),includeAutoPay:commonUtils.searchJson(vm.authorValue,"checkout.review.autoPayText"),hybridBanDetail:commonUtils.searchJson(vm.authorValue,"checkout.review.hybridBanDetail"),wearableHybridBanDetail:commonUtils.searchJson(vm.authorValue,"checkout.review.wearableHybridBanDetail"),hybridBanLegalTextTablet:commonUtils.searchJson(vm.authorValue.rootPage,"pricingBreakdown.hybridBanLegalTextTablet"),hybridBanLegalTextWearable:commonUtils.searchJson(vm.authorValue.rootPage,"pricingBreakdown.hybridBanLegalTextWearable"),pbReinforceMessageTablet:commonUtils.searchJson(vm.authorValue.rootPage,"pricingBreakdown.pbReinforceMessageTablet"),pbReinforceIconTablet:commonUtils.searchJson(vm.authorValue.rootPage,"pricingBreakdown.pbReinforceIconTablet"),pbReinforceMessageWearable:commonUtils.searchJson(vm.authorValue.rootPage,"pricingBreakdown.pbReinforceMessageWearable"),pbReinforceIconWearable:commonUtils.searchJson(vm.authorValue.rootPage,"pricingBreakdown.pbReinforceIconWearable"),accessoriesTitle:commonUtils.searchJson(vm.authorValue,"checkout.review.accessoriesHeader"),eipDetail:commonUtils.searchJson(vm.authorValue,"checkout.review.eipDetail"),refundableDepositHeader:commonUtils.searchJson(vm.authorValue,"checkout.review.refundableDepositHeader"),accessoriesLegal:commonUtils.searchJson(vm.authorValue,"checkout.review.accessoriesLegalText"),deviceLegalText:commonUtils.searchJson(vm.authorValue,"checkout.review.deviceLegalText"),editcartlabel:commonUtils.searchJson(vm.authorValue,"checkout.review.editCartText"),reviewheader:commonUtils.searchJson(vm.authorValue,"checkout.review.header"),estimatedTimelineLabel:commonUtils.searchJson(vm.authorValue,"checkout.review.estimatedShippingTimeTxt"),promotionIcon:commonUtils.searchJson(vm.authorValue,"checkout.icons.tagIcon"),simKitToolTip:commonUtils.searchJson(vm.authorValue.rootPage.generalAuthoring,"simtooltipdesc"),flp:commonUtils.searchJson(vm.authorValue,"checkout.review.flp"),fsp:commonUtils.searchJson(vm.authorValue,"checkout.review.fsp"),refundableDeposit:commonUtils.searchJson(vm.authorValue,"checkout.review.refundableDeposit"),totalPrice:commonUtils.searchJson(vm.authorValue,"checkout.review.totalPrice"),autoPayText:commonUtils.searchJson(vm.authorValue,"checkout.review.autoPayText"),planUpgradeText:commonUtils.searchJson(vm.authorValue,"checkout.review.planUpgradeText"),eipMonthlyPaymentDesc:commonUtils.searchJson(vm.authorValue,"rootPage.generalAuthoring.eipmonthly_price_desc"),orderTypeDisplay:{AVAILABLE:commonUtils.searchJson(vm.authorValue,"checkout.review.yourOrder"),AVAILABLE_FOR_BACK_ORDER:commonUtils.searchJson(vm.authorValue,"checkout.review.backOrder"),AVAILABLE_FOR_PRE_ORDER:commonUtils.searchJson(vm.authorValue,"checkout.review.preOrder")},standardTitle:commonUtils.searchJson(vm.authorValue.rootPage,"tradeInTool.standardOrderDetails.standardTitle"),standardTradeInDeviceHeader:commonUtils.searchJson(vm.authorValue.rootPage,"tradeInTool.standardOrderDetails.standardTradeInDeviceHeader"),standardTradeInDeviceInfo:commonUtils.searchJson(vm.authorValue.rootPage,"tradeInTool.standardOrderDetails.standardTradeInDeviceInfo"),tradeInValueModalLink:commonUtils.searchJson(vm.authorValue.rootPage,"tradeInTool.standardOrderDetails.tradeInValueModalLink"),promotionTitle:commonUtils.searchJson(vm.authorValue.rootPage,"tradeInTool.promotionOrderDetails.promotionTitle"),promotionTradeInDeviceHeader:commonUtils.searchJson(vm.authorValue.rootPage,"tradeInTool.promotionOrderDetails.promotionTradeInDeviceHeader"),promotionTradeInDeviceInfo:commonUtils.searchJson(vm.authorValue.rootPage,"tradeInTool.promotionOrderDetails.promotionTradeInDeviceInfo"),
simKitImage:commonUtils.searchJson(vm.authorValue.rootPage,"simStarterKitImage.sskImagePath"),autoPayDiscountLabel:commonUtils.searchJson(vm.authorValue.rootPage,"pricing.autoPayDiscountLabel"),deviceLabel:commonUtils.searchJson(vm.authorValue.rootPage,"pricing.deviceLabel")},vm.authorValue.checkout.review.estimatedTimelineURL&&vm.authorValue.checkout.review.estimatedTimelineURL.contains("/content")&&!vm.authorValue.checkout.review.estimatedTimelineURL.contains(".")?vm.authorValue.checkout.review.estimatedTimelineURL+=".html":vm.authorValue.checkout.review.estimatedTimelineURL=vm.authorValue.checkout.review.estimatedTimelineURL,orderGrouping(vm.cartObj.lineItems,0),orderGrouping(vm.cartObj.lineItems,1),orderGrouping(vm.cartObj.lineItems,2)}lodash.forEach(vm.cartObj.lineItems,function(selectedLine,key){var poFull=lodash.get(selectedLine,"lineItemDetails.deviceDetails.pricingOption");selectedLine.poFull=poFull&&"FULL"===poFull});var creditClass3=lodash.get(cartCommonOperationsService.model,"structCartData.selectedCreditClass.class");vm.creditClass3=creditClass3&&"creditClass3"===creditClass3,vm.toggleCollapse=toggleCollapse,vm.toggles=toggleService.model.toggles,vm.cartCommonOperationsService=cartCommonOperationsService,vm.planPromotionAmount=cartCommonOperationsService.planPromotionAmount,vm.toggles.isDcpV3ApiEnabled||setDataSocDetails()}var controllerName="CartBreakdownDetailsController";angular.module("tmobileApp").controller(controllerName,cartBreakdownDetailsControllerFunction)}(angular,_),function(angular){"use strict";function marketingFooterControllerFunction($window,footerDataService){function isMobileView(){return $window.innerWidth<724}function replaceUrlToken(url){$window.open(url.replace("{originUrl}",$window.location.href),"_blank")}var vm=this;vm.universalNavService=footerDataService,vm.isMobileView=isMobileView,vm.replaceUrlToken=replaceUrlToken}marketingFooterControllerFunction.$inject=["$window","footerDataService"],angular.module("marketingApp").controller("marketingFooterController",marketingFooterControllerFunction)}(angular),function(angular){"use strict";function accessoriesBreakdownDetailsControllerFunction($log,cartAccessoryService,accessoriesService,globalValue,toggleService,$scope,commonUtils,cartCommonOperationsService){function toggleCollapse(item){item.mvcAttrs.isCollapsed=!item.mvcAttrs.isCollapsed,item.mvcAttrs.collapsedMsg=item.mvcAttrs.isCollapsed?"Collapsed":"Not Collapsed"}function assignAccessoryPaymentOptions(){var accessories=vm.cartData.accessories;accessories.accessoryDetails.forEach(function(value,index){accessories.accessoryDetails[index].isFRPPayment=!accessoryService.checkPaymentOptionType(value.paymentOption,vm.keyValuePair)})}var vm=this;vm.authorValue.rootPage=globalValue.authorValue.rootPage,vm.apiVersion=toggleService.model.toggles.apiVersion2,vm.newAccessory=toggleService.model.toggles.newAccessory,vm.viewOrdDetailsATv2=toggleService.model.toggles.viewOrdDetailsATv2,vm.isVerifiedCRPForTPP=cartCommonOperationsService.isCRPVerifiedForTPP();var accessoryService=vm.newAccessory?accessoriesService:cartAccessoryService;vm.uiType=vm.sourceType.type,vm.toggleCollapse=toggleCollapse,assignAccessoryPaymentOptions(),$log.log(vm.cartData)}accessoriesBreakdownDetailsControllerFunction.$inject=["$log","cartAccessoryService","accessoriesService","globalValue","toggleService","$scope","commonUtils","cartCommonOperationsService"],angular.module("tmobileApp").controller("AccessoriesBreakdownDetailsController",accessoriesBreakdownDetailsControllerFunction)}(angular),function(angular){"use strict";function footerDataServiceFn($location,marketingHttpRequest){function isB2b(){return service.model.isB2b=$location.host().contains("business.t-mobile.com")?!0:!1,service.model.isB2b}function unavData(){var b2b=isB2b(),url="";if(9e3==$location.port()||"9000"==$location.port())url=1==b2b?"/mockData/businessUnavData.json":"/mockData/unavData.json";else{var getObject=1==b2b?"/srvspub/navigation.business.json":"/srvspub/navigation.consumer.json";url=getObject}marketingHttpRequest.get(url).then(function(result){service.model.unavData=result.data})}function init(){unavData()}function getCopyrightText(){var currentYear=(new moment).year(),copyrightText="©2002-{currentYear} T-Mobile USA, INC.";return copyrightText.replace("{currentYear}",currentYear)}var service=this;service.model={unavData:{},isB2b:"",copyrightText:getCopyrightText()},init()}footerDataServiceFn.$inject=["$location","marketingHttpRequest"],angular.module("marketingApp").service("footerDataService",footerDataServiceFn)}(angular),function(angular,lodash){"use strict";function AuthModelControllerConstructor($modalInstance,globalValue,commonServices,cartStorage,commonStorage,checkOutModelService,checkOutConstants){function close(){$modalInstance.dismiss("cancel"),cartStorage.setHardCreditCheck(!1),cartStorage.setSoftCreditCheck(!1),commonServices.$window.location.href=vm.authorValues.authenticationPrompt.closeCTALink}function navigate(){commonServices.$window.location.href=vm.authorValues.authenticationPrompt.loginCTALink}var vm=this;vm.visible=!0;var cartValueCheck=globalValue.authorValue.cart;vm.authorValues={},angular.isDefined(cartValueCheck)&&angular.isDefined(cartValueCheck.authenticationPrompt)?vm.authorValues=globalValue.authorValue.cart:vm.authorValues.authenticationPrompt=lodash.get(globalValue.authorValue,"rootPage.authenticationPrompt",{}),checkOutModelService.billingApplication===checkOutConstants.SPRINT?(vm.authorValues.authenticationPrompt.loginCTALink=vm.authorValues.authenticationPrompt.sprintLoginCTALink,vm.authorValues.authenticationPrompt.loginText=vm.authorValues.authenticationPrompt.sprintLoginText,vm.authorValues.authenticationPrompt.loginCTA=vm.authorValues.authenticationPrompt.sprintLoginCTA,vm.authorValues.authenticationPrompt.header=vm.authorValues.authenticationPrompt.sprintHeader,vm.modalName=checkOutConstants.SPRINTMODALNAME):vm.modalName=checkOutConstants.TMOMODALNAME,vm.close=close,vm.navigate=navigate}AuthModelControllerConstructor.$inject=["$modalInstance","globalValue","commonServices","cartStorage","commonStorage","checkOutModelService","checkOutConstants"],angular.module("tmobileApp").controller("AuthModelController",AuthModelControllerConstructor)}(angular,_),function(angular){"use strict";var channelListComponent={templateUrl:"app/marketing/layer3Tv/components/channelList/channelList.tpl.html",controller:"channelListController",controllerAs:"vm"};angular.module("marketingCore").component("channelList",channelListComponent)}(window.angular),function(angular,_){"use strict";function cartAccessoryService($log,cartHttpDataService,transformCart,cartStorage,tmobNotificationService,creditClassService,commonUtils){function obtainObject(input,callback){"miniBrowseAccessory"===input.openViewType?getAccessoriesData(input).then(function(){callback&&callback(service.model.accessories)}):"miniPDPAccessory"===input.openViewType&&getSelectedAccessoryData(input.accessoryOfferId).then(function(){callback&&callback(service.model.selectedAccessory)})}function checkPaymentOptionType(paymentOption,keyValues){return!("EIP"!==paymentOption||!checkAccessoryEIPEligiblity())}function checkAccessoryEIPFlag(){return!("$0.00"===service.getCreditAmount().Monthly||!service.checkAccessoryEIPEligiblity())}function checkAccessoryEIPEligiblity(){return service.enableEIPforAccessories&&service.model.cartDetails.accessories.isAccessoryEIPEligible}function getCreditClassObject(){var defaultClassObject={"class":"creditClass1",label:"AWESOME CREDIT",pricing_popup_text:"<p>Tmo Expert Banner TExt</p>↵",enable:"true",description:"You've got seller credit."},selectedCreditClass=angular.isDefined(creditClassService.getCreditClass())?creditClassService.getCreditClass():defaultClassObject;return angular.isUndefined(selectedCreditClass.label)&&angular.equals(selectedCreditClass["class"],"creditClass1")&&(selectedCreditClass.label="AWESOME CREDIT"),selectedCreditClass}function getCreditAmount(){var selectedCreditClassis;selectedCreditClassis=angular.isDefined(creditClassService.getCreditClass())&&"creditClass1"===getCreditClassObject()["class"]?"GOOD":angular.isDefined(creditClassService.getCreditClass())&&"creditClass2"===getCreditClassObject()["class"]?"BUILDING":angular.isDefined(creditClassService.getCreditClass())&&"creditClass3"===getCreditClassObject()["class"]?"":"GOOD";var paymentOptionType=service.model.isFRPPayment?"FRP":"EIP";return service.model.selectedAccessory&&(service.model.selectedAccessory.pricing.length&&(service.model.selectedAccessory.originalPricing=service.model.selectedAccessory.pricing),angular.forEach(service.model.selectedAccessory.originalPricing,function(accessory,index){accessory.creditLevel!==selectedCreditClassis&&(""!==selectedCreditClassis||accessory.creditLevel)||accessory.type!==paymentOptionType||(service.model.selectedAccessory.pricing={Discount:service.model.selectedAccessory.FullPrice,Upfront:accessory.payNowAmount.amount,Monthly:accessory.monthlyAmount.amount,TermMonth:"24",DiscountedPrice:service.model.selectedAccessory.originalPricing[0].components[0].purchasePrice.display,totalPrice:accessory.components[0].purchasePrice.display,totalOriginalPrice:service.model.selectedAccessory.originalPricing[0].components[0].listPrice.display})})),service.model.selectedAccessory.pricing}function getSelectedAccessoryData(offerId){return cartHttpDataService.getSelectedAccessoryData(offerId).then(function(response){service.model.selectedAccessory=response.data.productdetails[0],service.model.selectedAccessory.imageArray=[],angular.isUndefined(service.model.selectedAccessory.ProductImage)&&(service.model.selectedAccessory.ProductImage=""),angular.isDefined(service.model.selectedAccessory.FrontImage)&&""!==service.model.selectedAccessory.FrontImage&&service.model.selectedAccessory.imageArray.push(service.model.selectedAccessory.FrontImage),angular.isDefined(service.model.selectedAccessory.BackImage)&&""!==service.model.selectedAccessory.BackImage&&service.model.selectedAccessory.imageArray.push(service.model.selectedAccessory.BackImage),angular.isDefined(service.model.selectedAccessory.LeftImage)&&""!==service.model.selectedAccessory.LeftImage&&service.model.selectedAccessory.imageArray.push(service.model.selectedAccessory.LeftImage),angular.isDefined(service.model.selectedAccessory.RightImage)&&""!==service.model.selectedAccessory.RightImage&&service.model.selectedAccessory.imageArray.push(service.model.selectedAccessory.RightImage)},function(){})}function getAccessoriesData(input){return cartHttpDataService.getAccessoriesData(input).then(function(response){service.model.accessories=response.data},function(){})}function deleteAccessoryFromCart(data){return cartHttpDataService.deleteAccessoryFromCart(data).then(function(transformedCart){service.model.cartDetails=transformedCart,showAccessoryNudgeWhenEIP(!1,null)})}function editSelectedAccessoryData(skuId){return cartHttpDataService.editSelectedAccessoryData(skuId).then(function(response){service.model.selectedAccessory=response.data.productdetails[0],service.model.selectedAccessory.imageArray=[],angular.isUndefined(service.model.selectedAccessory.ProductImage)&&(service.model.selectedAccessory.ProductImage=""),angular.isDefined(service.model.selectedAccessory.FrontImage)&&""!==service.model.selectedAccessory.FrontImage&&service.model.selectedAccessory.imageArray.push(service.model.selectedAccessory.FrontImage),angular.isDefined(service.model.selectedAccessory.BackImage)&&""!==service.model.selectedAccessory.BackImage&&service.model.selectedAccessory.imageArray.push(service.model.selectedAccessory.BackImage),angular.isDefined(service.model.selectedAccessory.LeftImage)&&""!==service.model.selectedAccessory.LeftImage&&service.model.selectedAccessory.imageArray.push(service.model.selectedAccessory.LeftImage),angular.isDefined(service.model.selectedAccessory.RightImage)&&""!==service.model.selectedAccessory.RightImage&&service.model.selectedAccessory.imageArray.push(service.model.selectedAccessory.RightImage)},function(){})}function getAccessoryAddedToCart(){return service.model.setAccessoryAddedToCart}function disablePricingLink(){service.model.setAccessoryAddedToCart=!1}function setCartDetails(cartDetail){service.model.cartDetails=cartDetail;var _paymentOption=commonUtils.searchJson(cartDetail,"accessoryDetails[0].paymentOption");service.model.checkUserPaymentOption=_paymentOption?_paymentOption:service.model.checkUserPaymentOption,service.model.isFRPPayment=!0,angular.isDefined(service.model.cartDetails.accessories)&&(service.model.cartDetails.accessories.accessoryDetails.forEach(function(value,index){"EIP"===value.paymentOption&&(service.model.isFRPPayment=!1)}),service.checkAccessoryEIPEligiblity()||(service.model.isFRPPayment=!0))}function getCartDetails(){return service.model.cartDetails}function processAccessoryToCart(operationType,selectedAccessoryValue,$modalInstance,keyValues){return"editAccessaory"===operationType?cartHttpDataService.editAccessoryInCart(selectedAccessoryValue).then(function(selectedCart){processCartOperationSuccessResponse(selectedCart,$modalInstance,keyValues,"editAccessoryInCart"),tmobNotificationService.addNotification.push("cart014"),tmobNotificationService.showNotification(tmobNotificationService.addNotification)})["catch"](function(e){$log.error(e)}):(selectedAccessoryValue.cartParams.sku=selectedAccessoryValue.skuCode,cartHttpDataService.addAccessoryToCart(selectedAccessoryValue).then(function(selectedCart){processCartOperationSuccessResponse(selectedCart,$modalInstance,keyValues,"addAccessoryToCart"),selectedCart.data&&102!==selectedCart.data.status.code&&(tmobNotificationService.addNotification.push("cart013"),tmobNotificationService.showNotification(tmobNotificationService.addNotification))})["catch"](function(e){$log.error(e)}))}function processCartOperationSuccessResponse(selectedCart,$modalInstance,keyValues,apiKey){if(null!==selectedCart.data&&_.isEmpty(selectedCart.data.errors)){if(102===selectedCart.data.status.code)return void errorHandlerForSKUCount(keyValues);var transformCartFactory=transformCart.getFactory(apiKey);service.model.selectedAccessoryFromBrowse=transformCartFactory.transformCartData(selectedCart.data),cartStorage.setGlobalSmartCartInfo(service.model.selectedAccessoryFromBrowse),angular.isDefined(typeof $modalInstance)&&$modalInstance.close(service.model.selectedAccessoryFromBrowse),service.model.setAccessoryAddedToCart=!0,service.model.cartDetails=service.model.selectedAccessoryFromBrowse,showAccessoryNudgeWhenEIP(!1,null)}else(-1===selectedCart.status||selectedCart.status>200)&&errorHandlerForSKUCount(keyValues)}function errorHandlerForSKUCount(keyValues){service.model.showAccessoryQtyErrorModal=!0,service.model.accessoryQtyErrorHeader=keyValues.accessoryErrorState.errorHeader,service.model.accessoryQtyErrorBody=keyValues.accessoryErrorState.errorBody;setInterval(function(){$("#dialogTitle").focus()},300)}function showAccessoryNudgeWhenEIP(isSetCartDetails,updatedStructCartDetails,source){isSetCartDetails&&setCartDetails(updatedStructCartDetails),"false"===sessionStorage.getItem("isAccessoryEIPtoggle")&&checkAccessoryEIPEligiblity()&&"EIP"===service.model.cartDetails.accessories.accessoryDetails[0].paymentOption&&(source&&"frommainpdp"===source?sessionStorage.setItem("eipnudge","cart017"):(service.model.enableNudge=!0,tmobNotificationService.showNotification(["cart017"]),sessionStorage.setItem("isAccessoryEIPtoggle",!0)));var paymentOption="FRP";service.model.cartDetails&&service.model.cartDetails.accessories&&service.model.cartDetails.accessories.accessoryDetails&&service.model.cartDetails.accessories.accessoryDetails.length>0&&(paymentOption=service.model.cartDetails.accessories.accessoryDetails[0].paymentOption),service.model.checkUserPaymentOption=paymentOption,sessionStorage.setItem("accessoryPaymentOption",paymentOption),"true"!==sessionStorage.getItem("isAccessoryEIPtoggle")||checkAccessoryEIPEligiblity()&&"FRP"!=paymentOption||(source&&"frommainpdp"===source?sessionStorage.setItem("eipnudge","cart018"):(service.model.enableNudge=!0,tmobNotificationService.showNotification(["cart018"]),sessionStorage.setItem("isAccessoryEIPtoggle",!1)))}function init(){null===sessionStorage.getItem("isAccessoryEIPtoggle")&&sessionStorage.setItem("isAccessoryEIPtoggle",!1)}var service=this;return init(),service.model={creditClass:{creditClass1:"creditClass1",creditClass2:"creditClass2",creditClass3:"creditClass3"},creditClassType:{awesomeCredit:"Awesome credit",averageCredit:"Average credit",noCredit:"No credit"},accessories:[],selectedAccessory:{},setAccessoryAddedToCart:!1,disableEIPforAccessories:!1,cartDetails:{},selectedAccessoryFromBrowse:{},showAccessoryQtyErrorModal:!1,accessoryQtyErrorHeader:"",accessoryQtyErrorBody:"",isFRPPayment:!0,enableNudge:!1,isAccessoryEIPtoggle:!1,checkUserPaymentOption:"FRP"},service.enableEIPforAccessories="",service.getSelectedAccessoryData=getSelectedAccessoryData,service.getAccessoriesData=getAccessoriesData,service.deleteAccessoryFromCart=deleteAccessoryFromCart,service.editSelectedAccessoryData=editSelectedAccessoryData,service.getAccessoryAddedToCart=getAccessoryAddedToCart,service.disablePricingLink=disablePricingLink,service.setCartDetails=setCartDetails,service.getCartDetails=getCartDetails,service.processCartOperationSuccessResponse=processCartOperationSuccessResponse,service.checkAccessoryEIPEligiblity=checkAccessoryEIPEligiblity,service.getCreditAmount=getCreditAmount,service.getCreditClassObject=getCreditClassObject,service.checkPaymentOptionType=checkPaymentOptionType,service.checkAccessoryEIPFlag=checkAccessoryEIPFlag,service.obtainObject=obtainObject,service.showAccessoryNudgeWhenEIP=showAccessoryNudgeWhenEIP,service.processAccessoryToCart=processAccessoryToCart,service}cartAccessoryService.$inject=["$log","cartHttpDataService","transformCart","cartStorage","tmobNotificationService","creditClassService","commonUtils"],angular.module("tmobileApp").service("cartAccessoryService",cartAccessoryService)}(angular,_),function(angular){"use strict";function channelListController(commonServices,layer3TvService,lazerSharkAnalyticsService,$anchorScroll){function loadLookupComponent(){vm.model.isFormTouched.channel=!1,vm.model.isChannelListAvailable=!1,vm.model.zipcode="";var analyticsData={formName:"",ctaName:vm.model.authorValues.results.checkNewZip.text,isActionClick:!0,assetType:"Button"};if(lazerSharkAnalyticsService.tracklsGenericClick(analyticsData),document.getElementsByClassName("channelLookup").length>0){var elemID=document.getElementsByClassName("channelLookup")[0].id;$anchorScroll(elemID),document.getElementsByClassName("channelLookup")[0].getElementsByClassName("tmo-modal-link").length>0&&(document.getElementsByClassName("channelLookup")[0].getElementsByClassName("tmo-modal-link")[0].tabIndex=0)}}function getChannelListHeight(elem){var maxHeight=document.getElementsByClassName(elem)[0].offsetHeight*vm.model.channelCount+"px";return{"max-height":maxHeight}}function updateChannelList(){var analyticsData={filterName:vm.model.categorySelected};lazerSharkAnalyticsService.tracklsGenericClick(analyticsData,!0),layer3TvService.sortChannels(vm.model.channelList,vm.model.categorySelected)}function trackShopNowClickEvent(){var analyticsData={formName:"",ctaName:vm.model.authorValues.results.shopNow.text,isActionClick:!1,assetType:"Button",targetUrl:vm.model.shopNowHref,icid:vm.model.authorValues.results.shopNow.icid||""};lazerSharkAnalyticsService.tracklsGenericClick(analyticsData),commonServices.$window.open(vm.model.shopNowHref,vm.model.authorValues.results.shopNow.target)}function changeIcon(){vm.isOpen=!vm.isOpen}var vm=this;vm.model=layer3TvService.model,vm.isOpen=!1,vm.loadLookupComponent=loadLookupComponent,vm.getChannelListHeight=getChannelListHeight,vm.updateChannelList=updateChannelList,vm.trackShopNowClickEvent=trackShopNowClickEvent,vm.changeIcon=changeIcon}channelListController.$inject=["commonServices","layer3TvService","lazerSharkAnalyticsService","$anchorScroll"],angular.module("marketingCore").controller("channelListController",channelListController)}(angular),function(angular,externalLogger){"use strict";angular.module("tmobileApp").constant("BOT_SHOPPING_STATE_NAME","botShopping").config(["$stateProvider","LOWER_FUNNEL_ABSTRACT_ROOT_STATE_NAME","BOT_SHOPPING_STATE_NAME",function($stateProvider,LOWER_FUNNEL_ABSTRACT_ROOT_STATE_NAME,BOT_SHOPPING_STATE_NAME){externalLogger.moduleConfigured("tmobileApp","botShopping.js");var botShoppingStateConfig={url:"/bot-shopping/:type?:skuId=&:fbId=&:psId=",parent:LOWER_FUNNEL_ABSTRACT_ROOT_STATE_NAME,views:{content:{templateUrl:"app/botShopping/botShopping.html",controller:"BotShoppingCtrl",controllerAs:"vm"}}};$stateProvider.state(BOT_SHOPPING_STATE_NAME,botShoppingStateConfig)}])}(angular,externalLogger),function(angular){"use strict";var channelLookupComponent={templateUrl:"app/marketing/layer3Tv/components/channelLookup/channelLookup.tpl.html",controller:"channelLookupController",controllerAs:"vm",bindings:{authorValue:"<"}};angular.module("marketingCore").component("channelLookup",channelLookupComponent)}(window.angular),function(angular,_,CQ_Analytics){"use strict";function authoredRedirectUrlService(httpRequest,commonServices,apiURLs){function getAuthoredRedirectUrlData(){var url=apiURLs.authoredRedirectUrlJson;return httpRequest.get(url)}function postAuthoredRedirectUrlData(url){return httpRequest.get(url)}return{getAuthoredRedirectUrlData:getAuthoredRedirectUrlData,postAuthoredRedirectUrlData:postAuthoredRedirectUrlData}}authoredRedirectUrlService.$inject=["httpRequest","commonServices","apiURLs"],angular.module("tmobileApp").service("authoredRedirectUrlService",authoredRedirectUrlService)}(angular,_,window.CQ_Analytics),function(angular,lodash){"use strict";function channelLookupController($location,marketingHttpRequest,layer3TvService,lazerSharkAnalyticsService,commonServices,apiURLs){function getChannelList(){vm.isApiCallPending=!0,vm.serviceError=!1,vm.model.channelList=[],vm.model.categoryList=[],vm.model.isChannelListAvailable=!1;var url=apiURLs.layer3Lookup+vm.model.zipcode,analyticsData={formName:"T-Vision Channel lookup",ctaName:vm.model.authorValues.basic.ctaText,assetType:"Button"};marketingHttpRequest.get(url).then(function(response){if(vm.isApiCallPending=!1,200===response.status){analyticsData.isActionClick=!0,lazerSharkAnalyticsService.tracklsGenericClick(analyticsData),formCompleteEvent();var allChannels=response.data.lineup,imgUrl=response.data.url+"/image?group={channelLid}&profile=lcm&language=en";vm.model.channelCount=vm.model.authorValues.results.defaultChannelCount||10,vm.model.channelListHeadline=vm.model.authorValues.results.headline?vm.model.authorValues.results.headline.replace(/{zipcode}/gi,vm.model.zipcode):"",vm.model.shopNowHref=vm.model.authorValues.results.shopNow.href?vm.model.authorValues.results.shopNow.href.replace(/{zipcode}/gi,vm.model.zipcode):"",categorizeChannelList(allChannels,imgUrl),document.getElementsByClassName("channelLookup").length>0&&(document.getElementsByClassName("channelLookup")[0].getElementsByClassName("tmo-modal-link")[0].tabIndex=-1)}else trackErrorEvent(response.status)})["catch"](function(error){if(vm.isApiCallPending=!1,400===error.status){analyticsData.isActionClick=!1,lazerSharkAnalyticsService.tracklsGenericClick(analyticsData),formCompleteEvent();var url=vm.model.authorValues.basic.noChannelReference.replace("{zipcode}",vm.model.zipcode),target=vm.model.authorValues.basic.noChannelTarget;commonServices.$window.open(url,target)}else trackErrorEvent(error.status)})}function categorizeChannelList(channels,imgUrl){lodash.isEmpty(channels)||(angular.forEach(channels,function(category){category.channels.length>0&&(vm.model.categoryList.push(category.display_name),angular.forEach(category.channels,function(channel){vm.model.channelList.push({image:imgUrl.replace("{channelLid}",channel.lid),name:channel.display_name,category:category.display_name})}))}),vm.model.isChannelListAvailable=!0,vm.model.categorySelected=vm.model.categoryList[0],layer3TvService.sortChannels(vm.model.channelList,vm.model.categorySelected))}function redirectToLayer3Service(){var url=vm.serviceAuthorValue.basic.serviceLookupReference.replace("{zipcode}",vm.serviceLookupZip),target=vm.serviceAuthorValue.basic.serviceLookupTarget,analyticsData={formName:"T-Vision service lookup",ctaName:vm.serviceAuthorValue.basic.ctaText,isActionClick:!1,assetType:"Button",targetUrl:url,icid:vm.serviceAuthorValue.basic.serviceLookupIcid||""};lazerSharkAnalyticsService.tracklsGenericClick(analyticsData),formCompleteEvent(),commonServices.$window.open(url,target)}function initialize(){if(9e3===$location.port()){var url="mockdata/layer3TvAuthorValues.json";marketingHttpRequest.get(url).then(function(response){vm.model.authorValues=response.data,vm.displayAs="channel"})}else vm.displayAs=vm.authorValue.basic.displayAs,"service"===vm.authorValue.basic.displayAs&&(vm.serviceAuthorValue=vm.authorValue),"channel"===vm.authorValue.basic.displayAs&&(vm.model.authorValues=vm.authorValue)}function formStartEvent(){var analyticsData={formName:"channel"===vm.displayAs?"T-Vision Channel lookup":"T-Vision service lookup",modalName:""};"channel"===vm.displayAs&&vm.model.isFormTouched.channel===!1?(lazerSharkAnalyticsService.tracklsFormStart(analyticsData,!0),vm.model.isFormTouched.channel=!0):"service"===vm.displayAs&&vm.model.isFormTouched.service===!1&&(lazerSharkAnalyticsService.tracklsFormStart(analyticsData,!0),vm.model.isFormTouched.service=!0)}function formCompleteEvent(){var analyticsData={formName:"channel"===vm.displayAs?"T-Vision Channel lookup":"T-Vision service lookup",modalName:""};lazerSharkAnalyticsService.tracklayer3FormComplete(analyticsData)}function trackErrorEvent(errorCode){var errorText="Service failed, Please try again",formName="T-Vision Channel lookup",modalName="";lazerSharkAnalyticsService.trackLSErrorEvent(errorText,errorCode,formName,modalName)}var vm=this;vm.model=layer3TvService.model,vm.model.channelList=[],vm.serviceError=!1,vm.model.isFormTouched.service=!1,document.getElementsByClassName("channelLookup").length>0&&document.getElementsByClassName("channelLookup")[0].getElementsByClassName("tmo-modal-link").length>0&&(document.getElementsByClassName("channelLookup")[0].getElementsByClassName("tmo-modal-link")[0].tabIndex=0),initialize(),vm.getChannelList=getChannelList,vm.redirectToLayer3Service=redirectToLayer3Service,vm.formStartEvent=formStartEvent}channelLookupController.$inject=["$location","marketingHttpRequest","layer3TvService","lazerSharkAnalyticsService","commonServices","apiURLs"],angular.module("marketingCore").controller("channelLookupController",channelLookupController)}(angular,window._),function(angular){"use strict";var authoredRedirectUrlComponent={bindings:{},controller:"authoredRedirectUrlController",controllerAs:"vm",templateUrl:"app/authoredRedirectUrl/authoredRedirectUrl.component.html"};angular.module("tmobileApp").component("authoredRedirectUrlComponent",authoredRedirectUrlComponent)}(angular),function(angular){function scrollElement($anchorScroll){return{restrict:"A",link:function(scope,element,attrs){scope.$watch("scrollElement",function(){0!==document.getElementsByClassName("sticky").length?$anchorScroll.yOffset=document.getElementsByClassName("global-header")[0].offsetHeight:window.innerWidth<1024?$anchorScroll.yOffset=51:$anchorScroll.yOffset=66,$anchorScroll(attrs.id),element[0].focus(),element.bind("keydown keypress",function(event){event.shiftKey&&"Tab"===event.computerKey&&document.getElementsByClassName("channelLookup").length>0&&document.getElementsByClassName("channelLookup")[0].getElementsByClassName("tmo-modal-link").length>0&&(document.getElementsByClassName("channelLookup")[0].getElementsByClassName("tmo-modal-link")[0].tabIndex=0)})})}}}scrollElement.$inject=["$anchorScroll"],angular.module("marketingCore").directive("scrollElement",scrollElement)}(angular),function(angular,externalLogger){"use strict";function configureRouter($stateProvider,APP_ROOT_STATE_NAME){externalLogger.moduleConfigured("tmobileApp","serverConfig.js"),$stateProvider.state("root.serverconfig",{parent:APP_ROOT_STATE_NAME,url:"/serverconfig",views:{main:{templateUrl:"/app/aemComponents/serverConfig/serverConfig.tpl.html",controller:"serverConfigController as vm"}}})}configureRouter.$inject=["$stateProvider","APP_ROOT_STATE_NAME"],angular.module("tmobileApp").config(configureRouter)}(angular,externalLogger),function(angular,externalLogger){"use strict";function configureRouter($stateProvider,APP_ROOT_STATE_NAME){externalLogger.moduleConfigured("tmobileApp","layer3Tv.js"),$stateProvider.state("root.channel-lookup",{parent:APP_ROOT_STATE_NAME,url:"/layer3tv",views:{main:{templateUrl:"app/marketing/layer3Tv/layer3Tv.tpl.html",controller:"channelLookupController as vm"}}})}configureRouter.$inject=["$stateProvider","APP_ROOT_STATE_NAME"],angular.module("tmobileApp").config(configureRouter)}(angular,externalLogger),function(angular){"use strict";var serverConfigComponent={bindings:{serverConfigData:"="},templateUrl:"app/aemComponents/serverConfig/component/serverConfig.component.html",controller:"ServerConfigController",controllerAs:"vm"};angular.module("tmobileApp").component("serverConfig",serverConfigComponent)}(window.angular),function(angular,lodash){"use strict";function layer3TvService(){var vm=this;vm.model={zipcode:"",isChannelListAvailable:!1,channelList:[],authorValues:{},categoryList:[],sortedChannelList:[],channelCount:0,isFormTouched:{channel:!1,service:!1}},vm.sortChannels=function(channelList,selectedCategory){vm.model.sortedChannelList=[],vm.model.sortedChannelList=lodash.filter(channelList,{category:selectedCategory})}}angular.module("marketingCore").service("layer3TvService",layer3TvService)}(window.angular,window._),function(angular){"use strict";function seoService(httpRequest,commonServices,apiURLs){function getseoData(){var url=apiURLs.getSeoData;return httpRequest.get(url).then(function(response){service.model.seoData=response.data})}function postseoData(url,data){return httpRequest.post(url,data)}var service=this;service.model={seoData:"",browseType:["cell-phones","internet-devices","accessories"]},service.getseoData=getseoData,service.postseoData=postseoData}seoService.$inject=["httpRequest","commonServices","apiURLs"],angular.module("tmobileApp").service("seoService",seoService)}(angular),function(angular){"use strict";var lsConfirmation={templateUrl:"app/marketing/lazerShark/Components/lsConfirmation/lsConfirmation.tpl.html",controller:"lsConfirmationController",controllerAs:"vm",bindings:{}};angular.module("marketingCore").component("lsConfirmation",lsConfirmation)}(window.angular),function(angular,externalLogger){"use strict";function configureRouter($stateProvider,APP_ROOT_STATE_NAME){externalLogger.moduleConfigured("tmobileApp","seo.js"),$stateProvider.state("root.seo",{parent:APP_ROOT_STATE_NAME,url:"/seo",views:{main:{templateUrl:"/app/seo/seo.tpl.html",controller:"seoController",controllerAs:"vm"}}})}configureRouter.$inject=["$stateProvider","APP_ROOT_STATE_NAME"],angular.module("tmobileApp").config(configureRouter)}(angular,externalLogger),function(angular,lodash){"use strict";function lsConfirmationController(lazerSharkService){function resendMail(){vm.resentMailDone=!0}var vm=this;vm.model=lazerSharkService.model,vm.authorValues=lodash.get(lazerSharkService.model,"authorValues.confirmation"),vm.model.formName=vm.authorValues.header,vm.requestValidated=!1,vm.resentMailDone=!1,vm.formData=lazerSharkService.model.formData,vm.authorValues.emailCopy=vm.authorValues.emailCopy.replace(/{email}/gi,vm.formData.email),vm.resendMail=resendMail}lsConfirmationController.$inject=["lazerSharkService"],angular.module("marketingCore").controller("lsConfirmationController",lsConfirmationController)}(window.angular,window._),function(angular,externalLogger){
"use strict";angular.module("tmobileApp").constant("EXTANT_CART_STATE_NAME","extantCart").config(["$stateProvider","LOWER_FUNNEL_ABSTRACT_ROOT_STATE_NAME","EXTANT_CART_STATE_NAME",function($stateProvider,LOWER_FUNNEL_ABSTRACT_ROOT_STATE_NAME,EXTANT_CART_STATE_NAME){externalLogger.moduleConfigured("tmobileApp","extantCart.js");var extantCartStateConfig={url:"/cart/:type?:key=&:id=&:fbId=&:psId=",parent:LOWER_FUNNEL_ABSTRACT_ROOT_STATE_NAME,views:{content:{templateUrl:"app/extantCart/extantCart.html",controller:"extantCartCtrl",controllerAs:"vm"}},resolve:{toggleData:function($log,toggleService){return toggleService.getToggleFeature().then(function(){$log.log(" resolve :: toggleService")})}}};$stateProvider.state(EXTANT_CART_STATE_NAME,extantCartStateConfig),externalLogger.moduleConfigured("tmobileApp","extantCart.js")}])}(angular,externalLogger),function(angular){"use strict";var lsEmailVerification={templateUrl:"app/marketing/lazerShark/Components/lsEmailVerification/lsEmailVerification.tpl.html",controller:"lsEmailVerificationController",controllerAs:"vm",bindings:{isEmailVerified:"<",failureMessage:"<"}};angular.module("marketingCore").component("lsEmailVerification",lsEmailVerification)}(window.angular),function(angular,externalLogger){"use strict";function isAemRuntime(){return angular.isDefined(window.AEMmode)&&window.AEMmode.isAuthor}function isUnitTest(){return angular.isDefined(window.__karma__)}function isLiveMode(){return!(isAemRuntime()||isUnitTest())}angular.module("home",["ui.router","tmobileCore"]).constant("HOME_STATE_NAME","root.home").config(["$stateProvider","$urlRouterProvider","HOME_STATE_NAME",function($stateProvider,$urlRouterProvider,HOME_STATE_NAME){externalLogger.moduleConfigured("home","home.js :: configureRouter"),isLiveMode()&&$urlRouterProvider.otherwise(function(){var url=window.location.href;window.open(url,"_self")}),$stateProvider.state(HOME_STATE_NAME,{url:"/",views:{main:{templateUrl:"app/home/home.html"}},data:{title:"Next Gen Home"}})}]),externalLogger.moduleRegistered("home","home.js")}(angular,externalLogger),function(angular,lodash){"use strict";function lsEmailVerificationController(lazerSharkService,lazerSharkAnalyticsService){var vm=this;vm.authorValues=lodash.get(lazerSharkService.model,"authorValues.verification"),lazerSharkAnalyticsService.trackLSPageLoad("order confirmation","")}lsEmailVerificationController.$inject=["lazerSharkService","lazerSharkAnalyticsService"],angular.module("marketingCore").controller("lsEmailVerificationController",lsEmailVerificationController)}(window.angular,window._),function(angular){"use strict";var imeiComponentConstructor={templateUrl:"app/imei/components/imeiComponent/imeiComponent.html",controller:"imeiComponenetController as vm",bindings:{authorValue:"<"}};angular.module("tmobileApp").component("imeiComponenet",imeiComponentConstructor)}(window.angular),function(angular){"use strict";var lsShipInfo={templateUrl:"app/marketing/lazerShark/Components/lsShipInfo/lsShipInfo.tpl.html",controller:"lsShipInfoController",controllerAs:"vm",bindings:{}};angular.module("marketingCore").component("lsShipInfo",lsShipInfo)}(window.angular),function(angular,externalLogger){"use strict";angular.module("tmobileApp").constant("IMEI_STATE_NAME","imei").config(["$stateProvider","UPPER_FUNNEL_ABSTRACT_ROOT_STATE_NAME","IMEI_STATE_NAME",function($stateProvider,UPPER_FUNNEL_ABSTRACT_ROOT_STATE_NAME,IMEI_STATE_NAME){externalLogger.moduleConfigured("tmobileApp","imei.js");var imeiConfig={url:"/verifyimei",parent:UPPER_FUNNEL_ABSTRACT_ROOT_STATE_NAME,data:{title:"IMEI"},views:{content:{templateUrl:"app/imei/imei.tpl.html",controller:"imeiController as vm"}},resolve:{authorizationToken:function(tokenUtils,$log){return tokenUtils.generateToken().then(function(){$log.log(" resolve :: access token")})}}};$stateProvider.state(IMEI_STATE_NAME,imeiConfig)}])}(angular,externalLogger),function(angular,lodash){"use strict";function lsShipInfoController(lazerSharkModalFactory,lazerSharkAnalyticsService,lazerSharkService,marketingConstants,$timeout){function submit(form){var analyticsData={formName:vm.authorValues.header,modalName:"",ctaName:vm.authorValues.primaryCta,isActionClick:!1,assetType:"Button"};lazerSharkAnalyticsService.tracklsGenericClick(analyticsData),vm.model.focusRequired=!1,vm.focusRequired=!1,lodash.includes(vm.model.excludedZipcodeList,vm.model.formData.zipcode)?lazerSharkService.openGenericErrorModal("zipcodeError",200,"","NT Not eligible -Excluded zip code").then(function(){lazerSharkService.clearShipInfoFormData(form)})["catch"](function(){lazerSharkService.clearShipInfoFormData(form)}):(vm.model.isApiCallPending=!0,lazerSharkService.getFormattedAddresses().then(function(response){vm.model.isApiCallPending=!1,"success"===response.status?lazerSharkModalFactory.openAddresssModal().then(function(){vm.disableSalesForceOnLZ?lazerSharkService.submitOrderToVerify(form):lazerSharkService.addressEligibilitySearch().then(function(res){res.data.isExistingAddress?lazerSharkService.openGenericErrorModal("shippingCurrentCustomerError",200,"","NT Not eligible -Existing user address").then(function(){lazerSharkService.clearShipInfoFormData(form)})["catch"](function(){lazerSharkService.clearShipInfoFormData(form)}):lazerSharkService.submitOrder(form)})}):"partial"===response.status?lazerSharkService.openGenericErrorModal("shippingPOError",response.code,response.status,"NT Not eligible -Invalid address").then(function(){lazerSharkService.clearShipInfoFormData(form)})["catch"](function(){lazerSharkService.clearShipInfoFormData(form)}):lazerSharkService.openGenericErrorModal("genericError","500","","NT Generic errors")}))}function back(){lazerSharkService.navigateToPrevScreen(vm.authorValues.secondaryCta),vm.model.focusRequired=!1}function fireFormStartEvent(){if(!vm.isFormTouched){vm.isFormTouched=!0;var formData={formName:vm.authorValues.header,modalName:""};lazerSharkAnalyticsService.tracklsFormStart(formData)}}var vm=this;vm.leftTemp=!0,vm.authorValues=lodash.get(lazerSharkService.model,"authorValues.shipping"),vm.globalAuthorValue=lodash.get(lazerSharkService.model,"authorValues.global"),vm.disableSalesForceOnLZ=vm.globalAuthorValue.disableSalesForceOnLZ||!1,vm.model=lazerSharkService.model,vm.model.formName=vm.authorValues.header,vm.isFormTouched=!1,vm.listValues=marketingConstants.states,vm.selectedValWA=vm.model.formData.state||"Select from the list",lazerSharkService.getZipExclusionList(),lazerSharkService.checkUserPreferredLanguage(),vm.submit=submit,vm.back=back,vm.fireFormStartEvent=fireFormStartEvent,vm.openTermsandConditions=lazerSharkService.openTermsandConditions,vm.openSecondaryTermsandConditions=lazerSharkService.openSecondaryTermsandConditions}lsShipInfoController.$inject=["lazerSharkModalFactory","lazerSharkAnalyticsService","lazerSharkService","marketingConstants","$timeout"],angular.module("marketingCore").controller("lsShipInfoController",lsShipInfoController)}(window.angular,window._),function(angular){"use strict";function lowerFunnelControllerConstructor($log){$log.log("Buy Abstract Root Controller is initializing...")}lowerFunnelControllerConstructor.$inject=["$log"],angular.module("tmobileApp").controller("LowerFunnelController",lowerFunnelControllerConstructor)}(angular),function(angular){"use strict";var lsSurvey={templateUrl:"app/marketing/lazerShark/Components/lsSurvey/lsSurvey.tpl.html",controller:"lsSurveryController",controllerAs:"vm",bindings:{}};angular.module("marketingCore").component("lsSurvey",lsSurvey)}(window.angular),$(document).ready(function(){$(".announcement-component__close").on("click",function(){$(this).closest(".announcement").slideUp("slow"),generatemapheight()})}),function(angular){"use strict";function announcementComponentController($sce,$window,$timeout){var vm=this;vm.isVisible=!1,vm.uNavHeight=0,vm.$onInit=function(){if(vm.isVisible=vm.getSession("announcementComponent-"+vm.settings.id.moduleID),"section"!==vm.settings.style.options.htmlTag&&(vm.getUnavHeight(),angular.element($window).bind("resize",function(){vm.getUnavHeight()}),angular.element($window).bind("scroll",function(){$timeout(function(){vm.getUnavHeight()},250)})),vm.settings.basic.headlineSection&&vm.settings.basic.headlineSection.bannerName&&""!==vm.settings.basic.headlineSection.bannerName)var event={eventInfo:{eventAction:"load",eventType:"alert",timeStamp:(new Date).toString()},eventDescription:{dynamicContent:"",transId:""},alert:[{type:"Page Alert",name:vm.settings.basic.headlineSection.bannerName,code:""}]},cnt=0,max=10,gap=350,hnd=setInterval(function(){cnt+=1,(cnt==max||window.digitalData&&window.digitalData.hasCallbacks&&window.digitalData.hasCallbacks()>0)&&(clearInterval(hnd),window.digitalData.events.push(event),window.triggerEvent(CLICK_EVENT))},gap)},vm.closeSeccion=function(){vm.setSession("announcementComponent-"+vm.settings.id.moduleID,!0);var event={eventInfo:{eventAction:"click",eventType:"clickToAction"},category:{eventCategory:"pgalertclose"},eventDescription:{ctaName:"Dismiss Sprint Coverage Notification",targetUrl:"",icid:"",assetType:"alert",alertInfo:"Dismiss Sprint Coverage Notification",formName:"",modalName:""}};window.digitalData.events.push(event),window.triggerEvent()},vm.clickSeccion=function(){var moduleItem=_.filter($window.marketingDigitalData.page.modules.moduleListAll,function(value){return value.ID===vm.settings.id.analyticsID});if(moduleItem){var event={eventInfo:{eventAction:"click",eventType:"clickToNavigate"},category:{eventCategory:"page alert"},eventDescription:{ctaName:vm.settings.ctaTab.screenreaderText,targetUrl:vm.settings.ctaTab.reference,icid:" ",assetType:"alert",alertInfo:"Sprint Coverage",formName:"",modalName:"",PlacementID:moduleItem[0].placementID,dataAnalyticsID:vm.settings.id.analyticsID+"--primaryCta",ModuleName:vm.settings.id.moduleID,parentComponent:""}};window.digitalData.events.push(event),window.triggerEvent()}},vm.getSession=function(name){return!!$window.sessionStorage.getItem(name)},vm.setSession=function(name,value){$window.sessionStorage.setItem(name,value)},vm.trustHtml=function(value){return $sce.trustAsHtml(value)},vm.getUnavHeight=function(){angular.element("header.global-header").length&&(vm.uNavHeight=angular.element("header.global-header").height()+"px")}}announcementComponentController.$inject=["$sce","$window","$timeout"];var announcementComponent={templateUrl:"app/marketing/components/announcement/announcement.component.tpl.html",controller:announcementComponentController,bindings:{settings:"<",dynamic:"<"},controllerAs:"vm"};angular.module("marketingCore").component("announcementComponent",announcementComponent)}(angular),function(angular,lodash){"use strict";function lsSurveryController(lazerSharkAnalyticsService,lazerSharkService,lazerSharkModalFactory){function handleContinueClick(){var analyticsData={ctaName:vm.authorValues.primaryCta,formName:vm.authorValues.header,modalName:"",assetType:"Button",isActionClick:!0,userSelection:"Wireless provider:T-mobile | Interest in TFB:"+(vm.formData.InterestedinTFB?"Yes":"No")+" | Rate experience:"+vm.formData.carriersatisfaction};lazerSharkAnalyticsService.tracklsGenericClick(analyticsData),vm.isFormTouched&&lazerSharkAnalyticsService.tracklsFormComplete(analyticsData.formName,analyticsData.modalName,"Network Trial : Get Started"),lazerSharkService.navigateToNextScreen()}function getSelectedRating(userSelectedRating){vm.formData.carriersatisfaction=userSelectedRating}function fireFormStartEvent(){if(!vm.isFormTouched){vm.isFormTouched=!0;var formData={formName:vm.authorValues.header,modalName:""};lazerSharkAnalyticsService.tracklsFormStart(formData)}}var vm=this;vm.isFormTouched=!1,vm.leftTemp=!0,vm.model=lazerSharkService.model,vm.formData=vm.model.formData,vm.globalAuthorValue=lodash.get(vm.model,"authorValues.global"),vm.authorValues=lodash.get(vm.model,"authorValues.survey"),vm.model.formName=vm.authorValues.header,vm.ratings={current:vm.formData.carriersatisfaction,max:5},vm.handleContinueClick=handleContinueClick,vm.openTermsandConditions=lazerSharkService.openTermsandConditions,vm.getSelectedRating=getSelectedRating,vm.fireFormStartEvent=fireFormStartEvent}lsSurveryController.$inject=["lazerSharkAnalyticsService","lazerSharkService","lazerSharkModalFactory"],angular.module("marketingCore").controller("lsSurveryController",lsSurveryController)}(window.angular,window._),function(angular){"use strict";function articleFilterController($element,$timeout,analyticsUtils){function getAnalyticsEntry(defaultText,key,value){return value?key+":"+value:defaultText}function getFiltersForAnalytics(filters){var filterAnalyticsData=[];if(filters)for(var key in vm.exportData)if(key){var value=vm.exportData[key].value,defaultText=vm.exportData[key].text,analyticsEntry=getAnalyticsEntry(defaultText,key,value);filterAnalyticsData.push(analyticsEntry)}return filterAnalyticsData.join("|")}var vm=this;vm.generateID=function(string){var array=new Uint8Array(1);return string.toLowerCase().replace(/\W]/g,"")+Math.floor(window.crypto.getRandomValues(array)/(Math.pow(2,8)-1)*1e9)},vm.isOpen=!1,vm.isUserFocusedOnResetButton=!1,vm.haveFiltersBeenApplied=!1,vm.defaults={},vm.currentlyApplied={},vm.selected={},vm.mobileButtonBarID=vm.generateID("mobile-button-bar"),vm.closeButtonID=vm.generateID("close-button"),vm.denormalizeFilters=function(){function denormalizeFilterOptions(filter){return filter.options.reduce(function(acc,option){var id=vm.generateID(option.value);return acc.list.push(id),acc.items[id]=option,acc},{list:[],items:{}})}return vm.filters.reduce(function(acc,filter){var options=denormalizeFilterOptions(filter),id=filter.category.value;return acc.list.push(id),vm.defaults[id]=options.list[0],vm.currentlyApplied[id]=options.list[0],vm.selected[id]=options.list[0],acc.items[id]={id:id,category:filter.category,options:options.items,optionsList:options.list},acc},{list:[],items:{}})},vm.computeProperties=function(){vm.changedFromAppliedList=vm.denormalizedFilters.list.filter(function(item){return vm.selected[item]!==vm.currentlyApplied[item]}),vm.changedFromDefaultList=vm.denormalizedFilters.list.filter(function(item){return vm.selected[item]!==vm.defaults[item]}),vm.commaSeparatedSelections=vm.changedFromDefaultList.map(function(item){return vm.denormalizedFilters.items[item].options[vm.selected[item]].text}).join(", "),vm.haveValuesChangedFromDefault=!!vm.changedFromDefaultList.length,vm.haveValuesChangedFromApplied=!!vm.changedFromAppliedList.length,vm.exportData=function(){var selectedList=Object.keys(vm.selected);return selectedList.reduce(function(acc,item){return acc[item]={text:vm.denormalizedFilters.items[item].options[vm.selected[item]].text,value:vm.denormalizedFilters.items[item].options[vm.selected[item]].value},acc},{})}()},vm.updateCurrentlyApplied=function(){vm.denormalizedFilters.list.forEach(function(item){vm.currentlyApplied[item]=vm.selected[item]})},vm.close=function(){vm.isOpen=!1,vm.shiftFocusTo(vm.mobileButtonBarID)},vm.open=function(){vm.isOpen=!0,vm.shiftFocusTo(vm.closeButtonID)},vm.shiftFocusTo=function(elementID){$timeout(function(){$element.find("#"+elementID).focus()},0)},vm.applyFilters=function(){vm.haveFiltersBeenApplied=!0,vm.close(),vm.updateCurrentlyApplied(),vm.computeProperties(),vm.onFilterChanged&&vm.onFilterChanged({data:vm.exportData}),analyticsUtils.trackArchiveFilterTagClick({ctaName:vm.settings.content.applyFilters,assetType:"Button",icid:vm.settings.config.filterButtonICID,filterName:getFiltersForAnalytics(vm.exportData),type:"filter"})},vm.resetValues=function(){vm.denormalizedFilters.list.forEach(function(filter){vm.selected[filter]=vm.defaults[filter]}),vm.haveFiltersBeenApplied=!1,vm.updateCurrentlyApplied(),vm.computeProperties(),$element.find("#"+vm.closeButtonID).length&&vm.shiftFocusTo(vm.closeButtonID),vm.onFilterChanged&&vm.onFilterChanged({data:vm.exportData}),analyticsUtils.trackArchiveFilterTagClick({ctaName:vm.settings.content.reset,assetType:"Button",icid:vm.settings.config.filterButtonICID,filterName:getFiltersForAnalytics(vm.exportData),type:"filter"})},vm.updateSelected=function(id,selected){vm.selected[id]=selected,vm.computeProperties()},vm.$onInit=function(){vm.denormalizedFilters=vm.denormalizeFilters(),vm.computeProperties()}}articleFilterController.$inject=["$element","$timeout","analyticsUtils"];var articleFilterComponent={templateUrl:"app/marketing/components/articleArchive/articleFilter/articleFilter.component.tpl.html",controller:articleFilterController,bindings:{filters:"<",settings:"<",onFilterChanged:"&",showFilter:"<"},controllerAs:"vm"};angular.module("marketingCore").component("articleFilter",articleFilterComponent)}(angular),function(angular){"use strict";var lsUserInfoComponent={templateUrl:"app/marketing/lazerShark/Components/lsUserInfo/lsUserInfo.tpl.html",controller:"lsUserInfoController",controllerAs:"vm",bindings:{}};angular.module("marketingCore").component("lsUserInfo",lsUserInfoComponent)}(window.angular),function(angular){"use strict";function articleCardController($sce,analyticsUtils){function withinOneDay(){var articleDateInMilliseconds=new Date(vm.article.date).getTime(),today=new Date,todayInMilliseconds=today.getTime(),millisecondsInADay=864e5;return articleDateInMilliseconds>todayInMilliseconds-millisecondsInADay}function parseImageFromStringDefinition(image){vm.desktopImage=image,vm.tabletImage=image,vm.mobileImage=image,image.length?vm.hasImage=!0:vm.hasImage=!1}function parseImageFromObjectDefinition(image){vm.hasImage=image&&(image.desktop||image.tablet||image.mobile),vm.hasImage&&(vm.desktopImage=image.desktop||image.tablet||image.mobile,vm.tabletImage=image.tablet||image.desktop||image.mobile,vm.mobileImage=image.mobile||image.tablet||image.desktop)}function parseImageDefinition(){var image=vm.article.image;angular.isString(image)&&parseImageFromStringDefinition(image),angular.isObject(image)&&parseImageFromObjectDefinition(image)}var vm=this;vm.date=vm.article.date.split(".")[0],vm.title=$sce.trustAsHtml(vm.article.title.trim()),vm.isPostedInLast24Hours=withinOneDay(),vm.$onInit=function(){parseImageDefinition()}}articleCardController.$inject=["$sce","analyticsUtils"];var articleCardComponent={templateUrl:"app/marketing/components/articleCard/articleCard.component.tpl.html",controller:articleCardController,bindings:{article:"<",isFullWidth:"<"},controllerAs:"vm"};angular.module("marketingCore").component("articleCard",articleCardComponent)}(angular),function(angular,lodash,uuid){"use strict";function lsUserInfoConstructorController(apiURLs,marketingHttpRequest,lazerSharkAnalyticsService,lazerSharkService){function isPhoneValueChanged(formInput){vm.lastCommittedValue&&!lodash.isEqual(vm.lastCommittedValue,formInput.$$rawModelValue)&&(vm.phoneValidated=!1)}function toggleimeiPopup(){vm.isAlreadyOpen?vm.isAlreadyOpen=!1:vm.isIMEIPopupVisible=!vm.isIMEIPopupVisible}function onSelect(value){vm.showIMEIBox="yes"===value,vm.formData.hasDevice=vm.showIMEIBox,vm.showIMEIBox||(vm.formData.IMEI="")}function validatePhoneOnChange(formInput){if(angular.isUndefined(formInput.$modelValue)||formInput.$modelValue.length<10)formInput.$setValidity("minlength",!1);else{if(formInput.$setValidity("minlength",!0),vm.phoneValidated&&lodash.isEqual(vm.lastCommittedValue,formInput.$modelValue))return;vm.authorValues.customerSearchEnabled||checkPhoneEligibility(formInput)}}function checkPhoneEligibility(formInput){var body={MSISDN:vm.formData.phoneNumber,ValidateMSISDN:!0};vm.model.isApiCallPending=!0,vm.lastCommittedValue=vm.formData.phoneNumber,vm.phoneValidated=!0,lazerSharkService.generateCSRFToken().then(function(csrfResponse){var header={"csrf-token":csrfResponse};return marketingHttpRequest.authPost(apiURLs.marketingLazerShark.lsEligibilityServlet,header,body,!1).then(function(response){vm.model.isApiCallPending=!1,angular.equals(response.status,200)?"true"===response.data.istmocustomer&&(vm.phoneValidated=!1,lazerSharkService.openGenericErrorModal("phoneError",200,"","NT Not eligible -Existing user MSISDN").then(function(){vm.formData.phoneNumber=""})["catch"](function(){vm.formData.phoneNumber=""})):lazerSharkService.openGenericErrorModal("genericError",500,"","NT Generic errors")})["catch"](function(error){vm.model.isApiCallPending=!1,lazerSharkService.openGenericErrorModal("genericError",404,"","NT Generic errors")})})["catch"](function(csrfError){vm.model.isApiCallPending=!1,$log.error("wrong csrf",csrfError)})}function checkIMEIValidity(imeiFormControl){checkIMEI(imeiFormControl.$modelValue)?imeiFormControl.$setValidity("valid",!0):(imeiFormControl.$setValidity("valid",!1),imeiFormControl.$pristine=!1)}function verifyEmail(userForm){angular.isDefined(userForm.confirmEmail.$$rawModelValue)&&(angular.equals(userForm.Email.$$rawModelValue.toLowerCase(),userForm.confirmEmail.$$rawModelValue.toLowerCase())?userForm.confirmEmail.$setValidity("valid",!0):userForm.confirmEmail.$setValidity("valid",!1))}function checkIMEI(value){var nCheck=0,nDigit=0,bEven=!1;if(angular.isDefined(value)){value=value.replace(/\D/g,"");for(var n=value.length-1;n>=0;n--){var cDigit=value.charAt(n),nDigit=parseInt(cDigit,10);bEven&&(nDigit*=2)>9&&(nDigit-=9),nCheck+=nDigit,bEven=!bEven}return nCheck%10===0}return!1}function navigateToAddressSection(){var analyticsData={formName:vm.authorValues.header,modalName:"",ctaName:vm.authorValues.primaryCta,isActionClick:!0,assetType:"Button",userSelection:"Wireless provider:T-mobile | Already have a device:"+(vm.formData.hasDevice?"Yes":"No")};lazerSharkAnalyticsService.tracklsGenericClick(analyticsData),vm.isFormTouched&&lazerSharkAnalyticsService.tracklsFormComplete(analyticsData.formName,analyticsData.modalName,"Network Trial : About Yourself"),lazerSharkService.navigateToNextScreen()}function handleContinueClick(){var activityid=uuid.create().toString(),headers={activityid:activityid},body=vm.authorValues.customerSearchEnabled?{emailAddress:vm.formData.email,msisdn:vm.formData.phoneNumber}:{emailAddress:vm.formData.email};if(vm.model.isApiCallPending=!0,vm.authorValues.customerSearchEnabled){var token=marketingHttpRequest.getToken();if(token){var header={"activity-id":token.usn,"x-auth-originator":token.access_token};postVerifyEmail(apiURLs.marketingLazerShark.lsExistingCustomerVerification,header,body,!0)}}else postVerifyEmail(apiURLs.marketingLazerShark.lsEmailVerification,headers,body,!0)}function postVerifyEmail(url,headers,body,authRequired){var existingCustomer,analyticsData={formName:vm.authorValues.header,modalName:"",ctaName:vm.authorValues.primaryCta,isActionClick:!0,assetType:"Button",userSelection:"Wireless provider:T-mobile | Already have a device:"+(vm.formData.hasDevice?"Yes":"No")};lazerSharkAnalyticsService.tracklsGenericClick(analyticsData),marketingHttpRequest.authPost(url,headers,body,authRequired).then(function(response){vm.model.isApiCallPending=!1,angular.equals(response.status,200)?(existingCustomer=vm.authorValues.customerSearchEnabled?response.data.isExistingCustomer:response.data.isExistingEmailAddress,existingCustomer?(lazerSharkService.openGenericErrorModal("emailCurrentCustomerError",200,"","NT Not eligible -Existing user email"),vm.formData.email="",vm.formData.confirmEmail="",vm.authorValues.customerSearchEnabled&&(vm.formData.phoneNumber="")):(vm.isFormTouched&&lazerSharkAnalyticsService.tracklsFormComplete(analyticsData.formName,analyticsData.modalName,"Network Trial : About Yourself"),lazerSharkService.navigateToNextScreen())):lazerSharkService.openGenericErrorModal("genericError",500,"","NT Generic errors")})["catch"](function(error){vm.model.isApiCallPending=!1,lazerSharkService.openGenericErrorModal("genericError",404,"","NT Generic errors")})}function fireFormStartEvent(){if(!vm.isFormTouched){vm.isFormTouched=!0;var formData={formName:vm.authorValues.header,modalName:""};lazerSharkAnalyticsService.tracklsFormStart(formData)}}function back(){lazerSharkService.navigateToPrevScreen(vm.authorValues.secondaryCta)}var vm=this;vm.isFormTouched=!1,vm.leftTemp=!0,vm.model=lazerSharkService.model,vm.formData=vm.model.formData,vm.showIMEIBox=vm.formData.hasDevice,vm.isIMEIPopupVisible=!1,vm.phoneValidated=!1,vm.globalAuthorValue=lodash.get(vm.model,"authorValues.global"),vm.disableSalesForceOnLZ=vm.globalAuthorValue.disableSalesForceOnLZ||!1,vm.authorValues=lodash.get(vm.model,"authorValues.customer"),vm.model.formName=vm.authorValues.header,vm.onSelect=onSelect,vm.validatePhoneOnChange=validatePhoneOnChange,vm.checkIMEIValidity=checkIMEIValidity,vm.verifyEmail=verifyEmail,vm.handleContinueClick=handleContinueClick,vm.fireFormStartEvent=fireFormStartEvent,vm.openTermsandConditions=lazerSharkService.openTermsandConditions,vm.back=back,vm.toggleimeiPopup=toggleimeiPopup,vm.isPhoneValueChanged=isPhoneValueChanged,vm.navigateToAddressSection=navigateToAddressSection}lsUserInfoConstructorController.$inject=["apiURLs","marketingHttpRequest","lazerSharkAnalyticsService","lazerSharkService"],angular.module("marketingCore").controller("lsUserInfoController",lsUserInfoConstructorController)}(window.angular,window._,window.UUIDjs),function(angular){"use strict";function articleGridController(dataAccessService,analyticsFactory){var vm=this;vm.allArticlesShown=!1,vm.showMoreButtonHasFocus=!1,vm.loadingArticles=vm.shouldFetchArticles,vm.initialArticleCount=vm.initialArticleCount||0,vm.articleLayoutMode=vm.articleLayoutMode||0,vm.articles=vm.articles||[],vm.shownArticles=[],vm.hiddenArticles=[],vm.showRemainingArticles=function(){vm.allArticlesShown=!0},vm.onShowMoreButtonFocus=function(){vm.showMoreButtonHasFocus=!0},vm.onShowMoreButtonBlur=function(){vm.showMoreButtonHasFocus=!1},vm.getShowMoreContainerClass=function(){return vm.allArticlesShown?vm.showMoreButtonHasFocus?"sr-only":"hidden":""},vm.fetchArticles=function(){vm.loadingArticles=!0,dataAccessService.request({url:vm.constructApiUrl(),method:"GET"}).then(function(result){Array.prototype.push.apply(vm.articles,result.data.articles),vm.articles.length>vm.maxArticles&&vm.articles.pop(),vm.articles.length&&(vm.updateArticleLayout(vm.articleLayoutMode),vm.processArticlesList(),analyticsFactory.trackContentLoaded({analyticsId:vm.analyticsId})),vm.loadingArticles=!1})["catch"](function(){vm.loadingArticles=!1})},vm.constructApiUrl=function(){var splitUrl=vm.apiUrl.split(".{selectors}"),basePath=splitUrl[0],extension=splitUrl[1],url=[];return url.push(basePath),vm.tag&&url.push(vm.tag),vm.maxArticles&&url.push(vm.maxArticles),url.push("grid"),url.push(extension),url.join(".")},vm.updateArticleLayout=function(layoutMode){"full"===layoutMode&&(vm.articles[0].display="full")},vm.processArticlesList=function(){vm.initialArticleCount?(vm.shownArticles=vm.articles.slice(0,vm.initialArticleCount),vm.hiddenArticles=vm.articles.slice(vm.initialArticleCount)):vm.shownArticles=angular.copy(vm.articles),vm.hiddenArticles.length||(vm.allArticlesShown=!0)},vm.$onInit=function(){vm.shouldFetchArticles?vm.fetchArticles():vm.processArticlesList()}}articleGridController.$inject=["dataAccessService","analyticsFactory"];var articleGridComponent={controller:articleGridController,templateUrl:"app/marketing/components/articleGrid/articleGrid.component.tpl.html",bindings:{headline:"@",showMore:"<",secondaryCta:"<",links:"<",articles:"<",apiUrl:"@",shouldFetchArticles:"<",maxArticles:"<",initialArticleCount:"<",tag:"@",analyticsId:"@",articleLayoutMode:"@"},controllerAs:"vm"};angular.module("marketingCore").component("articleGrid",articleGridComponent)}(angular),function(angular){"use strict";var progressBarComponent={templateUrl:"app/marketing/lazerShark/Components/progressBar/progressBar.tpl.html",controller:"progressBarController",controllerAs:"vm",bindings:{authorValue:"="}};angular.module("marketingCore").component("progressBar",progressBarComponent)}(window.angular),function(angular){"use strict";var benefitComponent={templateUrl:"app/marketing/components/benefitComponent/benefitComponent.component.tpl.html",bindings:{settings:"<"},controllerAs:"vm"};angular.module("marketingCore").component("benefitComponent",benefitComponent)}(angular),function(angular,lodash){"use strict";function progressBarController(lazerSharkService){var vm=this;vm.model=lazerSharkService.model,vm.activatedSection=vm.model.lsChildSections.activatedSection}progressBarController.$inject=["lazerSharkService"],angular.module("marketingCore").controller("progressBarController",progressBarController)}(window.angular,window._),function(angular){"use strict";function benefitsContentController($element,$window,$scope,$timeout,$sce,$document,utils,analyticsUtils){var vm=this;vm.modalLegal=""!==vm.settings.modalLegal&&""!==vm.settings.modalLegalAriaLabel&&""!==vm.settings.modalLegalCtaText,this.$onInit=function(){utils.getClosest($element[0],".benefits-container")||$element.children()[0].classList.add("benefits-content-ntm-library-section")},$scope.$on("modalOpen",function(){$window.addEventListener("resize",_.throttle(vm.adjustBgImgGuideLines,100)),$timeout(function(){vm.adjustBgImgGuideLines()},450)}),$scope.$on("modalClosed",function(){$window.removeEventListener("resize",_.throttle(vm.adjustBgImgGuideLines,100))}),$scope.$on("benefits-modal-translate",function(){vm.adjustBgImgGuideLines()}),$element.on("click","button[data-analytics-id], a[data-analytics-id], [role=button][data-analytics-id]",function(e){analyticsUtils.trackActionableElementClick(e.currentTarget,utils.getPageReach(angular.element($window),angular.element("html")))}),vm.adjustBgImgGuideLines=function(){var sectionContent=$element[0].querySelector(".section-content"),pictureContainer=$element[0].querySelector(".picture-container"),bgImgGuideLines=$element[0].querySelectorAll(".bg-img-guide-line");if(sectionContent&&pictureContainer){const margin=36,height=(pictureContainer.clientHeight-sectionContent.clientHeight)/2-margin;bgImgGuideLines[0].setAttribute("style","height:"+Math.max(height,0)+"px"),bgImgGuideLines[1].setAttribute("style","height:"+Math.max(height,0)+"px")}},vm.onLegalModalOpen=function(){$document[0].querySelector(".modal-backdrop").classList.remove("modal-backdrop-benefits")},vm.trustHtml=function(value){return $sce.trustAsHtml(value)}}var benefitsContentComponent={templateUrl:"app/marketing/components/benefitsContent/benefitsContent.component.tpl.html",controller:benefitsContentController,bindings:{settings:"<"},controllerAs:"vm"};angular.module("marketingCore").component("benefitsContent",benefitsContentComponent)}(angular),function(angular,lodash){"use strict";function addressModalController(lazerSharkAnalyticsService,$modalInstance,lazerSharkService,commonServices){function close(){$modalInstance.close()}function confirm(selectedAddress){lodash.isEmpty(selectedAddress)||(vm.model.formData.address1=lodash.trim(selectedAddress.addressline1),vm.model.formData.address2=lodash.trim(selectedAddress.addressline2),vm.model.formData.city=lodash.trim(selectedAddress.cityname),vm.model.formData.state=lodash.trim(selectedAddress.statecode),vm.model.formData.zipcode=lodash.trim(selectedAddress.postalcode)),analyticsData.ctaName=vm.authoringData.primaryCTA,lazerSharkAnalyticsService.tracklsGenericClick(analyticsData),$modalInstance.close()}function dismiss(){analyticsData.ctaName=vm.authoringData.secondaryCTA,lazerSharkAnalyticsService.tracklsGenericClick(analyticsData),$modalInstance.dismiss()}var vm=this;vm.model=lazerSharkService.model,vm.selectedAddress=vm.model.addressResponse[0],vm.addresses=vm.model.addressResponse,vm.authoringData=lodash.get(vm.model,"authorValues.suggestedAddressModal");var modalName=vm.authoringData&&vm.authoringData.heading?vm.authoringData.heading:"",analyticsData={isActionClick:!1,ctaName:"",assetType:"Button",modalName:modalName};lazerSharkAnalyticsService.trackLSModalLoad(modalName,vm.authoringData.legal),vm.close=close,vm.dismiss=dismiss,vm.confirm=confirm}addressModalController.$inject=["lazerSharkAnalyticsService","$modalInstance","lazerSharkService","commonServices"],angular.module("marketingCore").controller("addressModalController",addressModalController);
}(window.angular,window._),function(angular){"use strict";function queryComponentController($location,dataAccessService,analyticsUtils,apiURLsV2,JWToken,$log,marketingHttpRequest,globalConfig,internationalRoamingService){function getItemFromName(name){var searchedItem=null;return angular.forEach(vm.masterList,function(value,key){vm.toggleFeature?"device"===vm.mode?value.displayName.toLowerCase()===name.toLowerCase()&&(searchedItem=value):value.regionName.toLowerCase()===name.toLowerCase()&&(searchedItem=value):"device"===vm.mode?value.DeviceName.toLowerCase()===name.toLowerCase()&&(searchedItem=value):value.CountryName.toLowerCase()===name.toLowerCase()&&(searchedItem=value)}),searchedItem||(searchedItem=name),searchedItem}function getPartnersList(compatibilityList){for(var partners={},i=0;i<compatibilityList.length;i++)partners.hasOwnProperty(compatibilityList[i].partnerName)?compatibilityList[i].technologyGeneration.forEach(function(e){partners[compatibilityList[i].partnerName].push(e)}):partners[compatibilityList[i].partnerName]=compatibilityList[i].technologyGeneration;return partners}function getVoiceCompatibility(compatibilityList){var gsmUmtsExists=[];if(compatibilityList.length>0){var partners=getPartnersList(compatibilityList);for(var i in partners){var techGen=partners[i].filter(function(e){return"GSM"===e.wirelessNetworkTechnology||"UMTS"===e.wirelessNetworkTechnology}),hasBand=techGen.some(function(e){return e.bands.length>0});gsmUmtsExists.push(hasBand),hasBand&&(vm.gsmInAtLeastOneCarrier=hasBand)}}else gsmUmtsExists.push(!1);return-1===gsmUmtsExists.indexOf(!1)}function getDataCompatibility(compatibilityList){var dataCompatibility=!1;if(compatibilityList.length>0){var partners=getPartnersList(compatibilityList);for(var i in partners){var techGenWithMapcodes=partners[i].filter(function(e){return e.mapCodes&&e.mapCodes.length>0}),techGen=techGenWithMapcodes.filter(function(e){return("LTE"===e.wirelessNetworkTechnology||"UMTS"===e.wirelessNetworkTechnology)&&e.bands.length>0});if(!(techGen.length>0))return!1;dataCompatibility=!0}}else dataCompatibility=!1;return dataCompatibility}var trackToolComplete=function(nameString){var trackEvent={ctaName:vm.ctaText,assetType:"Button",type:"Complete",name:nameString,analyticsID:vm.ctaDataAnalyticsId,icid:vm.ctaDataIcid};"device"===vm.mode?trackEvent.userInput=vm.selectedItem.displayName:"roaming"===vm.mode?trackEvent.userInput=vm.selectedItem.regionName:trackEvent.userInput=vm.selectedItem.regionName,analyticsUtils.trackTool(trackEvent)},vm=this;vm.masterList=[],vm.detailsList=[],vm.selectedItem=null,vm.notCompatible=!1,vm.fullyCompatible=!1,vm.partialCompatible=!1,vm.dataPass=!1,vm.searchFired=!1,vm.autoCompleteSelection=null,vm.masterListUrl="",vm.countryData={},vm.headers={"Content-Type":"",consumerType:"",application:""},vm.$onChanges=function(changes){changes.moduleId&&vm.moduleId&&(vm.templateUrl=vm.moduleId+(vm.toggleFeature?"/common/newquery.html":"/common/query.html")),"device"===vm.mode&&(vm.selectedItem=null,vm.autoCompleteSelection=null)},vm.$onInit=function(){var searchNameFromQueryString="roaming"===vm.mode?$location.search().country:$location.search().cruise;vm.toggleFeature?("roaming"===vm.mode?vm.masterListUrl=apiURLsV2.roamingMasterListUrl:"cruise"===vm.mode?vm.masterListUrl=apiURLsV2.cruiseMasterListUrl:"device"===vm.mode&&(vm.masterListUrl=apiURLsV2.deviceMasterListUrl),JWToken.getJSONWebToken().then(function(jwtresponse){vm.headers.Authorization="Bearer "+jwtresponse,vm.headers["Content-Type"]=globalConfig&&globalConfig.credentials&&globalConfig.credentials.global_v2.content_type.json,vm.headers.consumerType=globalConfig&&globalConfig.credentials&&globalConfig.credentials.roaming.consumer_type,vm.headers.application=globalConfig&&globalConfig.credentials&&globalConfig.credentials.roaming.application,marketingHttpRequest.authGet(vm.masterListUrl,vm.headers,null).then(function(result){"roaming"===vm.mode||"cruise"===vm.mode?(vm.masterList=result.data.regions,vm.selectedItem=getItemFromName(searchNameFromQueryString),vm.autoCompleteSelection=searchNameFromQueryString,vm.ctaAction(vm.selectedItem)):"device"===vm.mode&&(vm.masterList=result.data.deviceModelSpecs)})},function(error){$log.log("Error, valid token not available")}),vm.templateUrl=vm.moduleId+"/common/newquery.html"):(dataAccessService.request({url:vm.masterUrl,method:"GET"}).then(function(result){vm.masterList=result.data,"roaming"!==vm.mode&&"cruise"!==vm.mode||!searchNameFromQueryString||(vm.selectedItem=getItemFromName(searchNameFromQueryString),vm.autoCompleteSelection=searchNameFromQueryString,vm.ctaAction(vm.selectedItem))}),vm.templateUrl=vm.moduleId+"/common/query.html")},vm.toolBlur=function($event){var toolName;toolName="roaming"===vm.mode?"International Roaming Rate Check":"device"===vm.mode?"International Device Compatibility Check":"Cruise Rate Check",analyticsUtils.trackTool({type:"Start",name:toolName,analyticsID:vm.ctaDataAnalyticsId})},vm.keySelect=function($event){var keyCode=$event.which||$event.keyCode;if(13===keyCode){var dropdownActive=$event.currentTarget.nextElementSibling.querySelector(".active").innerText;angular.element($event.currentTarget.nextElementSibling).removeClass("open"),vm.autoCompleteSelection=dropdownActive.trim()}},vm.keysActions=function($event){var element=$event.currentTarget.nextElementSibling;if(element&&(38===$event.keyCode||40===$event.keyCode)){var index=Number($event.currentTarget.nextElementSibling.querySelector(".active").getAttribute("index")),listLenght=$event.currentTarget.nextElementSibling.querySelector("ul").getElementsByTagName("li").length-1;38===$event.keyCode?0===index?index=listLenght:index===listLenght?index--:index--:40===$event.keyCode&&(index===listLenght?index=0:index>=0&&index++);for(var els=$event.currentTarget.nextElementSibling.querySelectorAll("li.active"),i=0;i<els.length;i++)els[i].classList.remove("active");element.querySelector("#element-"+index).classList.add("active")}},vm.ctaAction=function(selectedItemParam){if(vm.selectedItem=selectedItemParam,angular.isObject(selectedItemParam)||(vm.selectedItem=getItemFromName(selectedItemParam)),vm.searchFired=!0,"device"===vm.mode){vm.notCompatible=!1,vm.fullyCompatible=!1,vm.partialCompatible=!1,vm.dataPass=!1,vm.gsmInAtLeastOneCarrier=!1,vm.dataInServiceArray=!1;var mode=vm.ctaHref&&-1!==vm.ctaHref.toLowerCase().indexOf("cruise")?"cruise":"roaming";if(vm.countryData=angular.fromJson(internationalRoamingService.getCountryData(mode)),trackToolComplete("International Device Compatibility Check"),vm.toggleFeature)if(vm.selectedItem&&!vm.selectedItem.identifier)vm.notCompatible=!0;else{var deviceDetailsListUrl=apiURLsV2.deviceDetailListUrl.replace("{{regionCode}}",sessionStorage.getItem("regionCode"));deviceDetailsListUrl=deviceDetailsListUrl.replace("{{deviceModelSpecId}}",vm.selectedItem.identifier.deviceModelSpecId),marketingHttpRequest.authGet(deviceDetailsListUrl,vm.headers,null).then(function(result){if(result.data){var compatibleDevices=angular.fromJson(result.data),voiceCompatibilityList=compatibleDevices.voiceCompatibility&&compatibleDevices.voiceCompatibility.length>0?compatibleDevices.voiceCompatibility:[],dataCompatibilityList=compatibleDevices.dataCompatibility&&compatibleDevices.dataCompatibility.length>0?compatibleDevices.dataCompatibility:[],gsmUmtsExists=getVoiceCompatibility(voiceCompatibilityList);if(gsmUmtsExists){for(var wirelessNetworksList=vm.countryData&&vm.countryData.region&&vm.countryData.region.wirelessNetworks&&vm.countryData.region.wirelessNetworks.length>0?vm.countryData.region.wirelessNetworks:[],i=0;i<wirelessNetworksList.length;i++){var wirelessNetworkTechnologiesList=wirelessNetworksList[i].wirelessNetworkTechnologies;if(wirelessNetworkTechnologiesList.some(function(e){return-1!==e.services.indexOf("Data")})){vm.dataInServiceArray=!0;break}}if(vm.dataInServiceArray)if(vm.countryData&&vm.countryData.region&&vm.countryData.region.roaming&&vm.countryData.region.roaming.discountedRates&&vm.countryData.region.roaming.discountedRates.length>0&&(vm.countryData.region.roaming.discountedRates[0].dataRate.length>0||vm.countryData.region.roaming.discountedRates[0].voiceRate.length>0||vm.countryData.region.roaming.discountedRates[0].textRate.length>0)){var dataCompatible=getDataCompatibility(dataCompatibilityList);dataCompatible?(vm.fullyCompatible=!0,vm.dataPass=!0):vm.fullyCompatible=!0}else vm.fullyCompatible=!0;else vm.fullyCompatible=!0}else vm.gsmInAtLeastOneCarrier?vm.partialCompatible=!0:vm.notCompatible=!0}else vm.notCompatible=!0})}else if(vm.notCompatible=!0,vm.result&&vm.result[0]){var compatibleDevices=angular.fromJson(vm.result[0].CompatibleDevices);compatibleDevices.forEach(function(item){if(item.DeviceID===vm.selectedItem.DeviceID){var dataCompatible=item.DataCompatible,fullVoiceCompatibility=item.FullVoiceCompatibility;dataCompatible&&fullVoiceCompatibility?(vm.fullyCompatible=!0,vm.partialCompatible=!1,vm.notCompatible=!1):!dataCompatible&&fullVoiceCompatibility||dataCompatible&&!fullVoiceCompatibility?(vm.fullyCompatible=!1,vm.partialCompatible=!0,vm.notCompatible=!1):(vm.fullyCompatible=!1,vm.partialCompatible=!1,vm.notCompatible=!0)}})}}else vm.toggleFeature?marketingHttpRequest.authGet(("roaming"===vm.mode?apiURLsV2.roamingDetailListUrl:apiURLsV2.cruiseDetailListUrl)+vm.selectedItem.regionCode,vm.headers,null).then(function(result){internationalRoamingService.setCountryData(vm.mode,JSON.stringify(result.data)),vm.onQueryResult({result:{mode:vm.mode,selectedItem:vm.selectedItem,toggleFeature:vm.toggleFeature,result:result.data}}),"roaming"===vm.mode&&(trackToolComplete("International Roaming Rate Check"),$location.search("country",vm.selectedItem.regionName)),"cruise"===vm.mode&&(trackToolComplete("Cruise Rate Check"),$location.search("cruise",vm.selectedItem.regionName)),vm.autoCompleteSelection=vm.selectedItem.regionName,sessionStorage.setItem("regionCode",vm.selectedItem.regionCode)}):dataAccessService.request({url:vm.detailsUrl+vm.selectedItem.CountryID+".json",method:"GET"}).then(function(result){vm.onQueryResult({result:{mode:vm.mode,selectedItem:vm.selectedItem,toggleFeature:vm.toggleFeature,result:result.data}}),"roaming"===vm.mode&&(trackToolComplete("International Roaming Rate Check"),$location.search("country",vm.selectedItem.CountryName)),"cruise"===vm.mode&&(trackToolComplete("Cruise Rate Check"),$location.search("cruise",vm.selectedItem.CountryName)),vm.autoCompleteSelection=vm.selectedItem.CountryName})}}var travelQueryComponent={template:'<div ng-include="$ctrl.templateUrl"> </div>',controller:queryComponentController,bindings:{masterUrl:"@",detailsUrl:"@",mode:"@",placeholderText:"@",ctaText:"@",ctaDataAnalyticsId:"@",ctaHref:"@",ctaDataIcid:"@",ctaAriaLabel:"@",onQueryResult:"&",moduleId:"@",result:"<",dataAnalyticsId:"@",toggleFeature:"<"}};angular.module("marketingCore").component("travelQuery",travelQueryComponent)}(angular),function(angular,lodash){"use strict";function lsErrorModalController($modalInstance,lazerSharkService,lazerSharkAnalyticsService){function close(){var analyticsData={isActionClick:!1,ctaName:vm.authoringData.ctaLabel,assetType:"Button",modalName:"NT Generic errors"};lazerSharkAnalyticsService.tracklsGenericClick(analyticsData),$modalInstance.close()}var vm=this;vm.authoringData=lodash.get(lazerSharkService.model,"authorValues.dynamicErrorModal"),vm.errorModal=lodash.get(lazerSharkService.model,"errorModal",{}),vm.close=close}lsErrorModalController.$inject=["$modalInstance","lazerSharkService","lazerSharkAnalyticsService"],angular.module("marketingCore").controller("lsErrorModalController",lsErrorModalController)}(window.angular,window._),function(angular){"use strict";var sliderComponent={templateUrl:"app/marketing/components/common/slider/slider.component.tpl.html",controller:"SliderController",controllerAs:"vm",bindings:{max:"<",defaultPlan:"<",analyticsIdEx:"<",analyticsIdStr:"@",selectedLine:"=",bubblePosition:"<",readPrice:"<"}};angular.module("marketingCore").component("tmoSlider",sliderComponent)}(window.angular),function(angular,lodash){"use strict";function lazerSharkModalFactory(commonServices,$modal){function _combineModalConfig(config){return lodash.merge(_defaultModalConfig,config)}function _openModal(modalConfig){return $log.log("modalConfig::",modalConfig),$modal.open(modalConfig).result}function openAddresssModal(){var modalConfig={templateUrl:"app/marketing/lazerShark/Modals/AddressModal/addressModal.tpl.html",controller:"addressModalController",controllerAs:"vm"};return _openModal(_combineModalConfig(modalConfig))}function openErrorModal(){var modalConfig={templateUrl:"app/marketing/lazerShark/Modals/errorModal/errorModal.tpl.html",controller:"lsErrorModalController",controllerAs:"vm"};return _openModal(_combineModalConfig(modalConfig))}function openTermsandConditions(){var modalConfig={templateUrl:"app/marketing/lazerShark/Modals/termsAndConditions/termsAndconditionsModal.tpl.html",controller:"lsTermsAndConditionsController",controllerAs:"vm"};return _openModal(_combineModalConfig(modalConfig))}var $log=commonServices.$log,_defaultModalConfig={size:"lg",windowClass:"modalClass"};return{openAddresssModal:openAddresssModal,openErrorModal:openErrorModal,openTermsandConditions:openTermsandConditions}}lazerSharkModalFactory.$inject=["commonServices","$modal"],angular.module("marketingCore").factory("lazerSharkModalFactory",lazerSharkModalFactory)}(window.angular,window._),function(angular,lodash){"use strict";function tmoSlider($window){return{restrict:"A",link:function(scope,element,attr){function setThumbStyles(event){var isMobile=$window.innerWidth<767,selectedLine=scope.vm.selectedLine,bubblepos=isMobile?0:scope.vm.bubblePosition,maxLines=scope.vm.maxLines,thumbPosition=Number(24/(maxLines-2)),thumb=element[0].querySelector(".md-thumb").style;if(1===selectedLine)thumb.left=-10+bubblepos+"px";else if(3===maxLines)thumb.left=-16+bubblepos+"px";else if(selectedLine===maxLines||selectedLine===maxLines-1)thumb.left=-32+bubblepos+"px";else if(maxLines>selectedLine){var finalPix=thumbPosition*(selectedLine-1);thumb.left="-"+(finalPix-bubblepos+6)+"px"}}setThumbStyles(),scope.$on("setThumbStyles",setThumbStyles)}}}tmoSlider.$inject=["$window"],angular.module("marketingCore").directive("tmoSlider",tmoSlider)}(window.angular,window._),function(angular,lodash){"use strict";function lsTermsAndConditionsController($modalInstance,lazerSharkAnalyticsService,lazerSharkService){function close(){var analyticsData={isActionClick:!1,ctaName:vm.ctaText,assetType:"Button",modalName:modalName};lazerSharkAnalyticsService.tracklsGenericClick(analyticsData),$modalInstance.close()}function dismiss(){$modalInstance.dismiss()}var vm=this;vm.model=lazerSharkService.model,vm.authoringData=lodash.get(lazerSharkService.model,"authorValues.termsAndConditionModal");var modalName="NT Terms & conditions";angular.isDefined(lazerSharkService.model.isSecondayCtaClicked)&&lazerSharkService.model.isSecondayCtaClicked?(lazerSharkAnalyticsService.trackLSModalLoad(modalName,vm.authoringData.secondaryLegalBody),vm.body=vm.authoringData.secondaryLegalBody,vm.heading=vm.authoringData.secondaryLegalHeading,vm.ctaText=vm.authoringData.secondaryLegalCta,lazerSharkService.model.isSecondayCtaClicked=!1):(lazerSharkAnalyticsService.trackLSModalLoad(modalName,vm.authoringData.body),vm.body=vm.authoringData.body,vm.heading=vm.authoringData.heading,vm.ctaText=vm.authoringData.primaryCta),vm.close=close,vm.dismiss=dismiss}lsTermsAndConditionsController.$inject=["$modalInstance","lazerSharkAnalyticsService","lazerSharkService"],angular.module("marketingCore").controller("lsTermsAndConditionsController",lsTermsAndConditionsController)}(window.angular,window._),function(angular){"use strict";function expandingSearchBarController($scope,$window,utils){var vm=this;vm.searchIsActive=!1,vm.searchTerms=[],vm.compileSearchString=function(){return vm.searchTerms=vm.settings.config.additionalTerms||[],vm.searchTerms=vm.searchTerms.concat(vm.searchForm.searchTerms.$viewValue.split(/\s+/)),vm.searchTerms.join("%20")},vm.$onInit=function(){$scope.searchTerms="",vm.placeholder=vm.settings.content.placeholder}}expandingSearchBarController.$inject=["$scope","$window","utils"];var expandingSearchBarComponent={templateUrl:"app/marketing/components/expandingSearchBar/expandingSearchBar.component.tpl.html",controller:expandingSearchBarController,bindings:{settings:"<",onSearchAction:"&",onSearchSubmit:"&"},controllerAs:"vm"};angular.module("marketingCore").component("expandingSearchBar",expandingSearchBarComponent)}(angular),function(angular,lodash,uuid){"use strict";function lazerSharkService(lazerSharkAnalyticsService,commonServices,lazerSharkModalFactory,mpLocalizationService,apiURLs,marketingHttpRequest,authTokenManager,jwtHelper,$cookies){function getZipExclusionList(){var data={zipcodeFilePath:lodash.get(vm.model,"authorValues.zipCodeExclusion","")},header={"CSRF-Token":sessionStorage.getItem("csrfToken")};marketingHttpRequest.authPost(apiURLs.marketingLazerShark.lsEligibilityServlet,header,data,!1).then(function(res){res.data.zipcode&&(vm.model.excludedZipcodeList=res.data.zipcode)})["catch"](function(error){vm.model.isApiCallPending=!1,openGenericErrorModal("genericError",404,"","NT Generic errors"),$log.error('Error "getZipExclusionList()" can not be completed',error)})}function getFormattedAddresses(){var formattedAddress,addressFormat,isExactMatch,data={addressline1:vm.model.formData.address1,addressline2:vm.model.formData.address2,cityname:vm.model.formData.city,statecode:vm.model.formData.state,postalcode:vm.model.formData.zipcode},formattedResponse={};return marketingHttpRequest.authPost(apiURLs.marketingLazerShark.addressValidation,{},data,!0).then(function(response){return 200===response.status?(formattedAddress=response.data.addresses.find(function(address){return addressFormat=lodash.toLower(address.addressformattype),isExactMatch="EXACT_MATCH"===address.verificationstatus.statuscode,"street"===addressFormat||"s"===addressFormat}),lodash.isEmpty(formattedAddress)&&(formattedResponse.status="partial",formattedResponse.code=200),lodash.isEmpty(formattedAddress)||isExactMatch!==!1?(formattedResponse.status="success",vm.model.addressResponse[0]=formattedAddress):(formattedResponse.status="partial",formattedResponse.code=206)):206===response.status&&(formattedResponse.status="partial",formattedResponse.code=206),formattedResponse})["catch"](function(error){vm.model.isApiCallPending=!1,openGenericErrorModal("genericError","500","","NT Generic errors"),$log.error("Error getFormattedAddresses() can not be completed",error)})}function checkUserPreferredLanguage(){commonServices.$location.host().startsWith("es.")&&(vm.model.languagePreference="Spanish")}function submitOrderToVerify(form){var requestBody={customerProfile:{firstName:vm.model.formData.firstName,lastName:vm.model.formData.lastName,email:vm.model.formData.email,languagePreference:"Spanish"===vm.model.languagePreference?"es":"en",contactNumber:vm.model.formData.phoneNumber,isByodFlow:vm.model.formData.hasDevice,imei:vm.model.formData.hasDevice?vm.model.formData.IMEI:"",deviceFingerPrintId:vm.fingerPrintId?vm.fingerPrintId:""},address:{addressLine1:vm.model.formData.address1,addressline2:lodash.get(vm.model,"formData.address2",""),city:vm.model.formData.city,state:vm.model.formData.state,zipCode:vm.model.formData.zipcode,geoCode:vm.model.addressResponse[0].geocode,zipExtension:vm.model.addressResponse[0].postalcodeextension,countryCode:vm.model.addressResponse[0].countrycode}};vm.model.isApiCallPending=!0;var header=setHeadersForOrderAPIs();marketingHttpRequest.authPost(apiURLs.marketingLazerShark.eligibilitySubmitOrder,header,requestBody,!0).then(function(res){vm.model.isApiCallPending=!1;var responseData=res.data;if(responseData)if(200===res.status&&responseData.orderId&&responseData.verificationResult){var stepData={isActionClick:!0,step:"Network Trial: Order Submit"};lazerSharkAnalyticsService.tracklsFormComplete(vm.model.authorValues.shipping.header,vm.model.authorValues.suggestedAddressModal.heading,"Network Trial: Ship Device"),navigateToNextScreen(),lazerSharkAnalyticsService.tracklsGenericClick(stepData)}else responseData.errors[0].code>=2010&&responseData.errors[0].code<=2014?openGenericErrorModal("shippingCurrentCustomerError",responseData.errors[0].code,responseData.errors[0].message,"").then(function(){clearShipInfoFormData(form)})["catch"](function(){clearShipInfoFormData(form)}):2015===responseData.errors[0].code&&openGenericErrorModal("shippingOrderedAlreadyError",responseData.errors[0].code,responseData.errors[0].message,"NT Not eligible -Recent participant").then(function(){clearShipInfoFormData(form)})["catch"](function(){clearShipInfoFormData(form)})})["catch"](function(error){vm.model.isApiCallPending=!1,openGenericErrorModal("genericError","500","","NT Generic errors")})}function submitOrder(form){var data={firstname:vm.model.formData.firstName,lastname:vm.model.formData.lastName,MSISDN:vm.model.formData.phoneNumber,email:vm.model.formData.email,addressline1:vm.model.formData.address1,addressline2:lodash.get(vm.model,"formData.address2",""),cityname:vm.model.formData.city,statecode:vm.model.formData.state,postalcode:vm.model.formData.zipcode,InterestedinTFB:vm.model.formData.InterestedinTFB,hasdevice:vm.model.formData.hasDevice,currentcarrier:vm.model.formData.currentcarrier,carriersatisfaction:vm.model.formData.carriersatisfaction,language:vm.model.languagePreference,program:"lazershark",IMEI:vm.model.formData.hasDevice?vm.model.formData.IMEI:""};vm.model.isApiCallPending=!0;var header={"CSRF-Token":sessionStorage.getItem("csrfToken")};marketingHttpRequest.authPost(apiURLs.marketingLazerShark.lsOrderSubmit,header,data,!1).then(function(res){if(vm.model.isApiCallPending=!1,res.data)switch(res.data.response.returnCode){case 0:var stepData={isActionClick:!0,step:"Network Trial: Order Submit"};lazerSharkAnalyticsService.tracklsFormComplete(vm.model.authorValues.shipping.header,vm.model.authorValues.suggestedAddressModal.heading,"Network Trial: Ship Device"),navigateToNextScreen(),lazerSharkAnalyticsService.tracklsGenericClick(stepData);break;case 121:openGenericErrorModal("shippingOrderedAlreadyError",res.data.response.returnCode,res.data.response.usermessage,"NT Not eligible -Recent participant").then(function(){clearShipInfoFormData(form)})["catch"](function(){clearShipInfoFormData(form)});break;default:openGenericErrorModal("genericError",res.data.response.returnCode,res.data.response.usermessage,"NT Generic errors")}})["catch"](function(error){vm.model.isApiCallPending=!1,openGenericErrorModal("genericError","500","","NT Generic errors")})}function navigateToPrevScreen(ctaName){var analyticsData={ctaName:ctaName,isActionClick:!0,assetType:"Button",formName:vm.model.formName,modalName:""};switch(lazerSharkAnalyticsService.tracklsGenericClick(analyticsData),vm.model.lsChildSections.navigationDirection=!1,vm.model.lsChildSections.activatedSection.name){case"lsShipInfo":vm.model.prevPage="lsShipInfo",vm.model.lsChildSections.activatedSection.name="lsUserInfo",vm.model.lsChildSections.activatedSection.index=1}}function navigateToNextScreen(){switch(vm.model.lsChildSections.navigationDirection=!0,vm.model.lsChildSections.activatedSection.name){case"lsUserInfo":vm.model.prevPage="lsUserInfo",vm.model.lsChildSections.activatedSection.name="lsShipInfo",vm.model.lsChildSections.activatedSection.index=2;break;case"lsShipInfo":vm.model.prevPage="lsShipInfo",vm.model.lsChildSections.activatedSection.name="lsConfirmation",vm.model.lsChildSections.activatedSection.index=3;break;default:vm.model.prevPage="",vm.model.lsChildSections.activatedSection.name="lsUserInfo",vm.model.lsChildSections.activatedSection.index=1}}function addressEligibilitySearch(){var data={addressLine1:vm.model.formData.address1,addressLine2:vm.model.formData.address2,city:vm.model.formData.city,state:vm.model.formData.state,zipCode:vm.model.formData.zipcode},activityid=uuid.create().toString(),headers={activityid:activityid};return vm.model.isApiCallPending=!0,marketingHttpRequest.authPost(apiURLs.marketingLazerShark.addressEligibilitySearch,headers,data,!0).then(function(response){return vm.model.isApiCallPending=!1,response})["catch"](function(error){vm.model.isApiCallPending=!1,openGenericErrorModal("genericError","500","","NT Generic errors"),$log.error("Error addressEligibilitySearch() can not be completed",error)})}function openGenericErrorModal(modalType,ecode,etext,modalName){vm.model.errorModal=lodash.get(vm.model.authorValues.dynamicErrorModal,modalType);var errorText=etext||vm.model.errorModal.body||"",errorCode=ecode||"";return lazerSharkAnalyticsService.trackLSModalLoad(modalName,vm.model.errorModal.body),lazerSharkAnalyticsService.trackLSErrorEvent(errorText,errorCode,vm.model.formName,modalName),lazerSharkModalFactory.openErrorModal()}function openTermsandConditions(formName){var analyticsData={formName:formName,modalName:"NT Terms & conditions ",isActionClick:!1,ctaName:vm.model.authorValues.global.tncLinkText,assetType:"Link"};lazerSharkAnalyticsService.tracklsGenericClick(analyticsData),lazerSharkModalFactory.openTermsandConditions()}function openSecondaryTermsandConditions(formName){var analyticsData={formName:formName,modalName:"NT Terms & conditions ",isActionClick:!1,ctaName:vm.model.authorValues.global.tnc2LinkText,assetType:"Link"};vm.model.isSecondayCtaClicked=!0,lazerSharkAnalyticsService.tracklsGenericClick(analyticsData),lazerSharkModalFactory.openTermsandConditions()}function clearShipInfoFormData(form){form.$setUntouched(),vm.model.formData.address1=void 0,vm.model.formData.address2=void 0,vm.model.formData.city=void 0,vm.model.formData.state=void 0,vm.model.formData.zipcode=void 0,vm.model.focusRequired=!0}function getEmailVerificationStatus(id){var data={caseId:id};vm.model.isApiCallPending=!0;var header={"CSRF-Token":sessionStorage.getItem("csrfToken")};return marketingHttpRequest.authPost(apiURLs.marketingLazerShark.lsOrderSubmit,header,data,!1).then(function(response){return response})}function updateOrder(id){var data={orderId:id};vm.model.isApiCallPending=!0;var header=setHeadersForOrderAPIs();return marketingHttpRequest.authPut(apiURLs.marketingLazerShark.updateOrder,header,data,!0).then(function(response){return response})}function setHeadersForOrderAPIs(){var token=authTokenManager.getTokenCookies("JSONWebToken",angular.equals(apiURLs.storage,"localStorage")),header={};if(token){var accessToken=jwtHelper.decodeToken(token.access_token);header={activityId:accessToken.usn,"Content-Type":"application/json",usn:token.usn,transactionId:uuid.create().toString(),transactionType:"ACTIVATION",applicationId:"TMO",channelId:"WEB",correlationId:uuid.create().toString(),clientId:"TMNG"}}return header}function generateCSRFToken(){vm.model.isApiCallPending=!0;var token,url="/libs/granite/csrf/token.json";return marketingHttpRequest.get(url).then(function(response){return token=response.data.token,sessionStorage.setItem("csrfToken",token),vm.model.isApiCallPending=!1,token})["catch"](function(errorResponse){$log.error("Error call can not be completed. Error is :: ",url+errorResponse),vm.model.isApiCallPending=!1})}var vm=this,$log=commonServices.$log;vm.fingerPrintId="",vm.model={formName:"",excludedZipcodeList:[],authorValues:{},formData:{firstName:"",lastName:"",address1:"",address2:"",city:"",state:"",zipcode:"",phoneNumber:"",email:"",confirmEmail:"",hasDevice:!1,IMEI:"",InterestedinTFB:!1,PIN:"",currentcarrier:"",carriersatisfaction:0,language:[],program:"lazershark"},errorModal:{},phoneResponse:null,phoneErrorResponse:null,addressResponse:[],addressErrorResponse:null,languagePreference:"English",lsChildSectionsList:[{name:"lsUserInfo",index:"1"},{name:"lsShipInfo",index:"2"},{name:"lsConfirmation",index:"3"}],lsChildSections:{navigationDirection:!0,activatedSection:{name:"",index:""},totalNumberOfSections:3},focusRequired:!1,emailVerificationStatus:!1,isSecondayCtaClicked:!1},vm.getZipExclusionList=getZipExclusionList,vm.checkUserPreferredLanguage=checkUserPreferredLanguage,vm.navigateToNextScreen=navigateToNextScreen,vm.navigateToPrevScreen=navigateToPrevScreen,vm.getFormattedAddresses=getFormattedAddresses,vm.submitOrder=submitOrder,vm.addressEligibilitySearch=addressEligibilitySearch,vm.openGenericErrorModal=openGenericErrorModal,vm.openTermsandConditions=openTermsandConditions,vm.clearShipInfoFormData=clearShipInfoFormData,vm.getEmailVerificationStatus=getEmailVerificationStatus,vm.openSecondaryTermsandConditions=openSecondaryTermsandConditions,vm.generateCSRFToken=generateCSRFToken,vm.submitOrderToVerify=submitOrderToVerify,vm.updateOrder=updateOrder,vm.setHeadersForOrderAPIs=setHeadersForOrderAPIs}lazerSharkService.$inject=["lazerSharkAnalyticsService","commonServices","lazerSharkModalFactory","mpLocalizationService","apiURLs","marketingHttpRequest","authTokenManager","jwtHelper","$cookies"],angular.module("marketingCore").service("lazerSharkService",lazerSharkService)}(window.angular,window._,window.UUIDjs),function(angular){"use strict";function ibaModalControllerConstructor($location,$log,$modalInstance,apiURLs,commonServices,authorValue,JWToken,marketingHttpRequest,analyticsUtils){function cancel(){var modalEventData={eventAction:"close",modalID:"",modalName:vm.authorValue.modalHeadline};analyticsUtils.trackModalEvents(modalEventData),$modalInstance.dismiss()}function turnOffIBA(){var analyticsData={formName:"",ctaName:vm.authorValue.modalPrimaryCtaLabel,isActionClick:!1,assetType:"Button",modalName:vm.authorValue.modalHeadline};analyticsUtils.trackClickEvent(analyticsData),JWToken.getJSONWebToken().then(function(jwtresponse){var url=apiURLs.ibaOptOut,headers={"Content-Type":"application/json"};headers.Authorization="Bearer "+jwtresponse,headers.Accept="application/json";var data={programOffer:{associatedLines:[{receiveOfferSms:!0,phoneNumber:vm.authorValue.phoneNumber,optOut:"OPTOUT"}]}};marketingHttpRequest.deleteRequest(url,headers,data,!1).then(function(response){200===response.status&&(commonServices.$window.location.href=vm.authorValue.modalPrimaryCtaActionUrl)})["catch"](function(error){$log.log("Service Error")})})["catch"](function(){$log.log("Error, valid token not available")})}function trackleaveOnClickEvent(){var analyticsData={formName:"",ctaName:vm.authorValue.modalSecondaryCtaLabel,isActionClick:!1,assetType:"Button",modalName:vm.authorValue.modalHeadline};analyticsUtils.trackClickEvent(analyticsData)}function initialize(){var modalEventData={eventAction:"load",modalID:"",modalName:vm.authorValue.modalHeadline,icid:""};analyticsUtils.trackModalEvents(modalEventData)}var vm=this;vm.authorValue=authorValue,initialize(),vm.turnOffIBA=turnOffIBA,vm.cancel=cancel,vm.trackleaveOnClickEvent=trackleaveOnClickEvent}var moduleName="marketingCore",controllerName="ibaModalController";angular.module(moduleName).controller(controllerName,ibaModalControllerConstructor)}(window.angular),function(angular,lodash){"use strict";function lazerSharkAnalyticsService($window,$location){function tracklsGenericClick(data,isFilterEvent){if(isFilterEvent)var evt={eventInfo:{eventType:"click",eventAction:"filter",timeStamp:(new Date).toString()},eventDescription:{filterName:data.filterName||"",moduleArray:[]}};else var evt={eventInfo:{eventAction:"click",eventType:data.isActionClick?"clickToAction":"clickToNavigate"},eventDescription:{ctaName:data.ctaName||"",targetUrl:data.targetUrl||"",icid:data.icid||"",modalName:data.modalName||""}};""===evt.eventDescription.icid&&evt.eventDescription.targetUrl&&evt.eventDescription.targetUrl.indexOf("icid")>-1&&(evt.eventDescription.icid=evt.eventDescription.targetUrl.split("icid=")[1]),data.step&&(evt.eventDescription.step=data.step),data.formName&&(evt.eventDescription.formName=data.formName),data.userSelection&&(evt.eventDescription.userSelection=data.userSelection),data.assetType&&(evt.eventDescription.assetType=data.assetType),
$window.digitalData.events.push(evt),$window.digitalData.hasCallbacks()&&$window.digitalData.triggerEvent(evt.TRIGGER_BASIC_EVENT)}function tracklsFormStart(formData,attrRemoveStatus){var event={};event.eventInfo={eventAction:"click",eventType:"form start"},event.eventDescription={formName:formData.formName,modalName:formData.modalName},attrRemoveStatus||(event.attributes={type:"navigation"}),$window.digitalData.events.push(event),$window.digitalData.hasCallbacks()&&$window.digitalData.triggerEvent("click")}function tracklsFormComplete(formName,modalName,step){var event={eventInfo:{eventAction:"click",eventType:"form complete"},attributes:{type:"navigation"},eventDescription:{formName:formName,modalName:modalName,step:step}};$window.digitalData.events.push(event),$window.digitalData.hasCallbacks()&&$window.digitalData.triggerEvent("click")}function tracklayer3FormComplete(formData){var event={eventInfo:{eventAction:"click",eventType:"form complete"},eventDescription:{formName:formData.formName,modalName:formData.modalName}};$window.digitalData.events.push(event),$window.digitalData.hasCallbacks()&&$window.digitalData.triggerEvent("click")}function trackLSPageLoad(pageName,prevPageName){pageName&&""!==pageName&&($window.digitalData.page.pageInfo.pageName=pageName),$window.digitalData.page.pageInfo.timeStamp=(new Date).toString(),$window.digitalData.page.pageInfo.pageURL=$location.absUrl(),$window.digitalData.page.pageInfo.pageURLwoQuery=$location.absUrl(),$window.digitalData.page.pageInfo.prevPageName=prevPageName,$window.digitalData.page.pageInfo.previousPageURL=prevPageName?$location.absUrl():"",$window.digitalData.page.pageInfo.pageURLFull=$location.absUrl();({eventInfo:{eventAction:"load",eventType:"page",timeStamp:(new Date).toString()},attributes:{dynamicContent:"",icidList:[]}});$window.digitalData.hasCallbacks()&&$window.digitalData.triggerEvent("pageLoad")}function trackLSErrorEvent(errorText,errorCode,formName,modalName){var event={eventInfo:{eventAction:"click",eventType:"error"},eventDescription:{errorText:errorText,errorCode:errorCode,formName:formName,modalName:modalName}};$window.digitalData.events.push(event),$window.digitalData.hasCallbacks()&&$window.digitalData.triggerEvent("click")}function trackLSModalLoad(modalName,dynamicContent){var event={eventInfo:{eventAction:"load",eventType:"modal",timeStamp:(new Date).toString()},attributes:{modalID:"",modalName:modalName,dynamicContent:dynamicContent||""}};$window.digitalData.events.push(event),$window.digitalData.hasCallbacks()&&$window.digitalData.triggerEvent("modalLoad")}return{tracklsGenericClick:tracklsGenericClick,tracklsFormStart:tracklsFormStart,trackLSPageLoad:trackLSPageLoad,tracklsFormComplete:tracklsFormComplete,trackLSErrorEvent:trackLSErrorEvent,trackLSModalLoad:trackLSModalLoad,tracklayer3FormComplete:tracklayer3FormComplete}}lazerSharkAnalyticsService.$inject=["$window","$location"],angular.module("marketingCore").factory("lazerSharkAnalyticsService",lazerSharkAnalyticsService)}(window.angular,window._),function(angular){"use strict";function ibaOptOutController($modal,$log,$location,apiURLs,marketingHttpRequest,analyticsUtils){function openIBAModal(){var analyticsData={formName:"",ctaName:vm.authorValue.turnOffButtonLabel,isActionClick:!1,assetType:"Button"};analyticsUtils.trackClickEvent(analyticsData),$modal.open({size:"lg",windowClass:"iba-modal",templateUrl:"app/marketing/components/ibaOptOut/ibaModalComponent/ibaModal.html",controller:"ibaModalController",controllerAs:"vm",resolve:{authorValue:function(){return vm.authorValue}}}).result.then(function(successResult){},function(errorResult){$log.error(errorResult)})}function initialization(){var url=apiURLs.ibaServlet,data=$location.search().tid,queryParams={actionType:"decrypt",data:data};marketingHttpRequest.get(url,queryParams).then(function(response){vm.authorValue.phoneNumber=response.data.data||"",close()})}var vm=this;vm.authorValue.phoneNumber="",initialization(),vm.openIBAModal=openIBAModal}ibaOptOutController.$inject=["$modal","$log","$location","apiURLs","marketingHttpRequest","analyticsUtils"],angular.module("marketingCore").controller("ibaOptOutController",ibaOptOutController)}(angular),function(angular){function setAutoFocus($timeout){return{scope:{trigger:"@setAutoFocus"},link:function(scope,element,attrs){scope.$watch("trigger",function(value){"true"===value&&$timeout(function(){element[0].focus()},600)})}}}setAutoFocus.$inject=["$timeout"],angular.module("marketingCore").directive("setAutoFocus",setAutoFocus)}(angular),function(angular){"use strict";var loadingIconComponent={templateUrl:"app/marketing/components/loadingIcon/loadingIcon.component.tpl.html",bindings:{link:"<"},controllerAs:"vm"};angular.module("marketingCore").component("loadingIcon",loadingIconComponent)}(angular),function(angular){"use strict";function fingerPrintFn($compile,$http,$templateCache,lazerSharkService,$timeout){function setFingerPrintId(scope,elm){var element=angular.element("<span/>"),rawTemplate=$templateCache.get("app/marketing/lazerShark/directives/fingerPrint/fingerPrint.html"),uuid=UUIDjs.create(4).toString();uuid=uuid.replace(/-/g,""),lazerSharkService.fingerPrintId=uuid,rawTemplate=rawTemplate.replace(/##token_id##/g,"TMOBILE"+uuid),element.append(rawTemplate).show(),elm.append(element)}return{restrict:"E",replace:!0,link:function(scope,elm){$timeout(function(){setFingerPrintId(scope,elm)},2e3)}}}var moduleName="marketingCore",directiveName="fingerPrint";angular.module(moduleName).directive(directiveName,fingerPrintFn)}(angular),function(angular){"use strict";function marketingPaginationController(analyticsUtils){function getPages(){var pageArray=[],num=1;for(num;num<vm.totalPages+1;num++)pageArray.push(num);return pageArray}var vm=this;vm.pages=1,vm.pageSelected=function($event,pageNumber,analyticsData){$event.preventDefault(),vm.onPageSelected({pageNumber:pageNumber}),analyticsUtils.trackPaginationClick(analyticsData)},vm.$onChanges=function(){vm.pages=getPages(),vm.indexOfCurrentPage=vm.pages.indexOf(vm.currentPage),vm.fivePagesArray=function(){if(vm.pages.length<5)return vm.pages;var startingIndex=0;return vm.indexOfCurrentPage>=3&&(startingIndex=vm.indexOfCurrentPage-2),vm.indexOfCurrentPage===vm.pages.length&&(startingIndex=vm.indexOfCurrentPage-5),vm.indexOfCurrentPage===vm.pages.length-1&&(startingIndex=vm.indexOfCurrentPage-4),vm.indexOfCurrentPage===vm.pages.length-2&&(startingIndex=vm.indexOfCurrentPage-3),vm.pages.slice(startingIndex,startingIndex+5)}(),vm.firstItemInFivePages=vm.fivePagesArray[0],vm.lastItemInFivePages=vm.fivePagesArray[vm.fivePagesArray.length-1],vm.firstItemInAllPages=vm.pages[0],vm.secondItemInAllPages=vm.pages[1],vm.secondToLastItemInAllPages=vm.pages[vm.pages.length-2],vm.lastItemInAllPages=vm.pages[vm.pages.length-1],vm.showFirstPageNumber=!vm.fivePagesArray.includes(vm.firstItemInAllPages),vm.firstPageIsNonadjacent=function(){return vm.firstItemInFivePages===vm.secondItemInAllPages?!1:!0}(),vm.showLastPage=!vm.fivePagesArray.includes(vm.lastItemInAllPages),vm.lastPageIsNonadjacent=function(){return vm.lastItemInFivePages===vm.secondToLastItemInAllPages?!1:!0}(),vm.isCurrentPageFirst=vm.currentPage===vm.firstItemInAllPages,vm.isCurrentPageLast=vm.currentPage===vm.lastItemInAllPages,vm.previousPage=function(){return vm.isCurrentPageFirst?vm.firstItemInAllPages:vm.pages[vm.indexOfCurrentPage-1]}(),vm.nextPage=function(){return vm.isCurrentPageLast?vm.lastItemInAllPages:vm.pages[vm.indexOfCurrentPage+1]}()}}marketingPaginationController.$inject=["analyticsUtils"];var marketingPaginationComponent={templateUrl:"app/marketing/components/marketingPagination/marketingPagination.component.tpl.html",controller:marketingPaginationController,bindings:{currentPage:"<",totalPages:"<",theme:"@",screenReaderCopyPreviousPage:"@",screenReaderCopyNextPage:"@",onPageSelected:"&"},controllerAs:"vm"};angular.module("marketingCore").component("marketingPagination",marketingPaginationComponent)}(angular),function(angular){"use strict";function imageBackground($window){return{restrict:"A",scope:{imageBackground:"<"},link:function(scope,element){function updateImageBackground(){if(authoredimage){var image=getImageForBreakpoint();element.css({"background-image":"url("+image+")"})}}function getImageForBreakpoint(){return $window.innerWidth<1024&&$window.innerWidth>=768?authoredimage.replace("desktop","tablet"):$window.innerWidth<768?authoredimage.replace("desktop","mobile"):authoredimage}function cleanup(){jqWindow.off("resize")}var jqWindow=angular.element($window),authoredimage=scope.imageBackground;jqWindow.on("resize",updateImageBackground),updateImageBackground(),scope.$on("$destroy",cleanup)}}}imageBackground.$inject=["$window"],angular.module("marketingCore").directive("imageBackground",imageBackground)}(angular),function(angular){"use strict";function sideBarController(analyticsUtils){function fireAnalytics(e){analyticsUtils.trackSideBarClick(e.currentTarget)}var vm=this;vm.onClickNavigationElement=function(data){fireAnalytics(data)}}var sideBar={templateUrl:"app/marketing/components/navigation/sideBar/sideBar.component.tpl.html",controller:sideBarController,controllerAs:"vm",transclude:!0,bindings:{settings:"<"}};angular.module("marketingCore").component("sideBar",sideBar)}(angular),function(angular){"use strict";function starRating(){return{restrict:"A",template:'<ul class="ratings" ><li ng-repeat="star in stars"  ><a id="{{$index}}" href="javascript:void(0)" ng-class="star" class="fa fa-star-o star-rating" aria-label="star {{$index +1}}"   ng-click="toggle($index)"></a></li></ul>',scope:{ratingValue:"=",max:"=",onRatingSelected:"&"},link:function(scope,elem,attrs){var updateStars=function(){scope.stars=[],scope.fillstar=!1;for(var i=0;i<scope.max;i++)scope.stars.push({filled:i<scope.ratingValue,fastaro:i<scope.ratingValue})};scope.toggle=function(index){scope.ratingValue=index+1,scope.onRatingSelected({rating:index+1});var nextElement=document.getElementById("tfbHeader");nextElement.focus()},scope.$watch("ratingValue",function(newVal,oldVal){updateStars()})}}}angular.module("marketingCore").directive("starRating",starRating)}(window.angular),function(angular){"use strict";function networkSpeedsController(networkSpeedsFactory,analyticsUtils,$log){function successNetworkData(response){vm.availableMarkets=response}function errorNetworkData(response){$log.error("error network data",response)}var vm=this;vm.availableMarkets=[],vm.selectedCity="",vm.$onInit=function(){networkSpeedsFactory.getNetworkSpeedData(vm.settings.labelTab.jsonFilePath).then(successNetworkData,errorNetworkData)},vm.onSelect=function(){analyticsUtils.trackEvent("CLICK_EVENT",vm.settings.idTab.analyticsID,{eventInfo:{eventAction:"click",eventType:"clickToAction"},attributes:{type:"navigation"},eventDescription:{ctaName:vm.selectedCity.name,assetType:"Dropdown Menu"}})}}networkSpeedsController.$inject=["networkSpeedsFactory","analyticsUtils","$log"];var networkSpeedsComponent={controller:networkSpeedsController,templateUrl:"app/marketing/components/networkSpeeds/networkSpeeds.component.tpl.html",bindings:{settings:"<"},controllerAs:"vm"};angular.module("marketingCore").component("networkSpeeds",networkSpeedsComponent)}(angular),function(angular,externalLogger){"use strict";var lazerShark={templateUrl:"app/marketing/lazerShark/lazerShark.tpl.html",controller:"lazerSharkController",controllerAs:"vm",bindings:{authorValues:"<"}};angular.module("marketingCore").component("lazerShark",lazerShark)}(angular,externalLogger),function(angular){"use strict";function overlayHeaderController($sce,analyticsUtils,$element,$window){var vm=this;vm.$onInit=function(){"full-height"===vm.settings.basic.moduleHeight&&"digits"!==vm.settings.basic.stylingDisplayAs?vm.maintainAspectRatio=!0:vm.maintainAspectRatio=!1},vm.onBackgroundClick=function(e){"a"!==e.target.tagName.toLowerCase()&&"button"!==e.target.tagName.toLowerCase()&&""!==vm.settings.background.ctaHref&&(analyticsUtils.trackGenericClick($element[0].querySelectorAll(".background-cta")[0]),$window.open(vm.settings.background.ctaHref,vm.settings.background.ctaTarget))},vm.trustHtml=function(value){return $sce.trustAsHtml(value)}}var overlayHeader={templateUrl:"app/marketing/components/overlayHeader/overlayHeader.component.tpl.html",controller:overlayHeaderController,bindings:{settings:"<"},controllerAs:"vm"};angular.module("marketingCore").component("overlayHeader",overlayHeader)}(angular),function(angular,externalLogger){"use strict";angular.module("tmobileApp").constant("LAZER_SHARK_STATE_NAME","lazer-shark").config(["$stateProvider","APP_ROOT_STATE_NAME","LAZER_SHARK_STATE_NAME",function($stateProvider,APP_ROOT_STATE_NAME,LAZER_SHARK_STATE_NAME){externalLogger.moduleConfigured("marketingCore","lazerShark.js :: config router");var lazerSharkConfig={url:"/lazer-shark",parent:APP_ROOT_STATE_NAME,views:{main:{templateUrl:"app/marketing/lazerShark/lazerShark.tpl.html",controller:"lazerSharkController",controllerAs:"vm"}}};$stateProvider.state(LAZER_SHARK_STATE_NAME,lazerSharkConfig)}])}(angular,externalLogger),function(angular){"use strict";function plansComponentController($location,$sce,$templateCache,viewport,analyticsUtils){function onBreakpointChange(bp){viewport.breakpointUp("desktop")?(vm.topFeaturesColSpan=1,vm.tableColspan=4,vm.planDetailColspan=1,vm.tableRowspan=2,vm.utilityTableColspan=1,vm.categoryLegalColspan=3):(vm.topFeaturesColSpan=2,vm.tableColspan=2,vm.planDetailColspan=2,vm.tableRowspan=1,vm.utilityTableColspan=2,vm.categoryLegalColspan=2)}function showPlan(planId){return searchUrl.plan?planId.id===searchUrl.plan:"true"===planId["default"]}function showLine(lineId){return searchUrl.lines?lineId.id===searchUrl.lines:"true"===lineId["default"]}var vm=this,searchUrl=$location.search(),heroText=vm.settings.paragraph,trueCheck=/^(\bTRUE\b)/;vm.$onInit=function(){vm.plansDropdown=$templateCache.get("app/marketing/components/plansComponent/plansDropdownPlans.html"),vm.linesDropdown=$templateCache.get("app/marketing/components/plansComponent/plansDropdownLines.html"),heroText=heroText.split("{plansDropdown}").join(vm.plansDropdown),heroText=heroText.split("{linesDropdown}").join(vm.linesDropdown),vm.replacedParagraph=heroText,searchUrl.tmoPlan?vm.tab=searchUrl.tmoPlan:vm.tab="magenta","true"===searchUrl.showTables?vm.showMore=!0:vm.showMore=!1,vm.plans=vm.settings.dropdown1.find(showPlan),vm.lines=vm.settings.dropdown2.find(showLine)},vm.selectTab=function(setTab,tabName){vm.tab=setTab,$location.search("tmoPlan",vm.tab),analyticsUtils.trackEvent("CLICK_EVENT",vm.settings.analyticsId,{eventInfo:{eventAction:"click",eventType:"clickToAction"},attributes:{type:"tab"},eventDescription:{dataAnalyticsID:vm.settings.analyticsId,assetType:"Tab",ctaName:tabName}})},vm.isSelected=function(checkTab){return vm.tab===checkTab},vm.onChangePlansDropdown=function(plansValue){$location.search("plan",plansValue),analyticsUtils.trackEvent("CLICK_EVENT",vm.settings.analyticsId,{eventInfo:{eventAction:"filter",eventType:"clickToAction"},attributes:{type:"navigation"},eventDescription:{ctaName:"Compare Plans",assetType:"Dropdown",filterName:plansValue+" plan | "+vm.lines.id+" lines"}})},vm.onChangeLinesDropdown=function(linesValue){$location.search("lines",linesValue),analyticsUtils.trackEvent("CLICK_EVENT",vm.settings.analyticsId,{eventInfo:{eventAction:"filter",eventType:"click"},attributes:{type:"navigation"},eventDescription:{ctaName:"Compare Plans",assetType:"Dropdown",filterName:vm.plans.id+" plan | "+linesValue+" lines"}})},vm.showAllTables=function(){vm.showMore?($location.search("showTables","true"),analyticsUtils.trackEvent("CLICK_EVENT",vm.settings.analyticsId,{eventInfo:{eventAction:"click",eventType:"clickToAction"},attributes:{type:"Link"},eventDescription:{dataAnalyticsID:vm.settings.analyticsId,ctaName:vm.settings.expandedCtaInitialTxt.replace(/<(?:.|\n)*?>/gm," ")}})):($location.search("showTables","false"),analyticsUtils.trackEvent("CLICK_EVENT",vm.settings.analyticsId,{eventInfo:{eventAction:"click",eventType:"clickToAction"},attributes:{type:"Link"},eventDescription:{dataAnalyticsID:vm.settings.analyticsId,ctaName:vm.settings.expandedCtaTxt.replace(/<(?:.|\n)*?>/gm," ")}}))},vm.onToolTipAnalytics=function(data){analyticsUtils.trackEvent("CLICK_EVENT",vm.settings.analyticsId,{eventInfo:{eventAction:"click",eventType:"clickToAction"},attributes:{type:"tooltip"},eventDescription:{dataAnalyticsID:vm.settings.analyticsId,ctaName:"Tooltip Click : "+data.replace(/<(?:.|\n)*?>/gm," ")}})},vm.startsWithTrue=function(startString){return trueCheck.test(startString)?!0:!1},vm.deleteTrueString=function(value){if(trueCheck.test(value)){var newValue=value.replace("TRUE","");return newValue}return value},viewport.onBreakpointChange(onBreakpointChange,!0)}plansComponentController.$inject=["$location","$sce","$templateCache","viewport","analyticsUtils"];var plansComponentComponent={templateUrl:"app/marketing/components/plansComponent/plansComponent.component.tpl.html",controller:plansComponentController,bindings:{settings:"<"},controllerAs:"vm"};angular.module("marketingCore").component("plansComponent",plansComponentComponent)}(angular),function(angular,lodash){"use strict";function lazerSharkController($location,$timeout,marketingHttpRequest,lazerSharkService,lazerSharkAnalyticsService,apiURLs){function initialize(){if(!lodash.isEmpty(vm.queryParams)&&vm.queryParams.id)if(vm.model.isApiCallPending=!0,vm.disableSalesForceOnLZ){const foundMatch=vm.queryParams.id.match(regexExp);null===foundMatch?lazerSharkService.updateOrder(vm.queryParams.id).then(function(res){vm.model.isApiCallPending=!1,vm.model.lsChildSections.activatedSection.name="lsEmailVerification",lazerSharkAnalyticsService.trackLSPageLoad(),res.data&&res.data.isOrderUpdated&&(vm.model.emailVerificationStatus=!0)})["catch"](function(error){switch(vm.model.isApiCallPending=!1,vm.model.lsChildSections.activatedSection.name="lsEmailVerification",lazerSharkAnalyticsService.trackLSPageLoad(),error.data.errors[0].code){case"ORDER-0021":vm.errorMessage=vm.verificationAuthorValue.failureOrderCancelled;break;case"ORDER-0022":vm.errorMessage=vm.verificationAuthorValue.failureOnExpiry;break;case"ORDER-0116":vm.errorMessage=vm.verificationAuthorValue.failureBody;break;case"ORDER-0117":vm.errorMessage=vm.verificationAuthorValue.notServiceable;break;default:vm.errorMessage=vm.verificationAuthorValue.defaultFailure}}):(vm.model.isApiCallPending=!1,vm.model.lsChildSections.activatedSection.name="lsEmailVerification",lazerSharkAnalyticsService.trackLSPageLoad(),vm.errorMessage=vm.verificationAuthorValue.failureOnIncorrectOrderId)}else lazerSharkService.generateCSRFToken().then(function(csrfResponse){lazerSharkService.getEmailVerificationStatus(vm.queryParams.id).then(function(res){vm.model.isApiCallPending=!1,vm.model.lsChildSections.activatedSection.name="lsEmailVerification",lazerSharkAnalyticsService.trackLSPageLoad(),res.data&&0===res.data.response.returnCode&&(vm.model.emailVerificationStatus=!0)})});else vm.model.lsChildSections.activatedSection={name:"lsUserInfo",index:"1"},vm.model.isApiCallPending=!1;if(9e3===$location.port()){var url="mockdata/lazerSharkAuthorValues.json";marketingHttpRequest.get(url).then(function(response){vm.model.authorValues=response.data,vm.isAuthorDataAvailable=!0})}else vm.model.authorValues=vm.authorValues,vm.isAuthorDataAvailable=!0;vm.activatedSection=vm.model.lsChildSections.activatedSection,"lsEmailVerification"!==vm.activatedSection.name&&$timeout(function(){lazerSharkAnalyticsService.trackLSPageLoad("","")},8e3)}var vm=this;vm.model=lazerSharkService.model,vm.globalAuthorValue=lodash.get(vm.authorValues,"global"),vm.verificationAuthorValue=lodash.get(vm.authorValues,"verification"),vm.disableSalesForceOnLZ=vm.globalAuthorValue.disableSalesForceOnLZ||!1,vm.leftTemp=!0,vm.showImage=!0,vm.errorMessage="",vm.queryParams=$location.search();const regexExp=/[A-Z]/gi;vm.model.emailVerificationStatus=!1,vm.model.lsChildSections.activatedSection={name:"emptySection",index:"0"},vm.activatedSection=vm.model.lsChildSections.activatedSection,initialize()}lazerSharkController.$inject=["$location","$timeout","marketingHttpRequest","lazerSharkService","lazerSharkAnalyticsService","apiURLs"],angular.module("marketingCore").controller("lazerSharkController",lazerSharkController)}(window.angular,window._),function(angular){"use strict";function socialLinksController(utils){var vm=this;vm.isMobileOrTablet="unknown"!==utils.getOS()}socialLinksController.$inject=["utils"];var socialLinksComponent={templateUrl:"/social-links/social-links.html",controller:socialLinksController,bindings:{contentData:"<"},controllerAs:"vm"};angular.module("marketingCore").component("socialLinks",socialLinksComponent)}(angular),function(angular){"use strict";angular.module("marketingCore").constant("marketingConstants",{states:["AL","AK","AZ","AR","CA","CO","CT","DE","DC","FL","GA","HI","ID","IL","IN","IA","KS","KY","LA","ME","MD","MA","MI","MN","MS","MO","MT","NE","NV","NH","NJ","NM","NY","NC","ND","OH","OK","OR","PA","PR","RI","SC","SD","TN","TX","UT","VT","VA","WA","WV","WI","WY"],serviceProviderCode:"6527"})}(angular),function(angular){"use strict";function takeoverModalController(analyticsUtils,$scope,$element,$window,$document,$timeout,utils){var vm=this,modalContent=utils.getClosest($element[0],".modal-content");vm.timeOfPrevScroll=(new Date).getTime(),vm.slickConfig={infinite:!0,arrows:!1,accessibility:!0,focusOnSelect:!1,speed:600,lazyLoad:"ondemand",useTransform:!0,autoplay:!1,cssEase:"ease-out",dots:!1,vertical:!0,verticalSwiping:!0,pauseOnHover:!1,autoplaySpeed:12e3,method:{},event:{beforeChange:function(event,slick,currentSlide,nextSlide){var direction;direction=1===Math.abs(nextSlide-currentSlide)?nextSlide-currentSlide>0?"up":"down":nextSlide-currentSlide>0?"down":"up","up"===direction?analyticsUtils.trackCarousel(!0,$element):analyticsUtils.trackCarousel(!1,$element),modalContent&&(modalContent.classList.remove("gradient-border-pos-"+currentSlide%4),modalContent.classList.add("gradient-border-pos-"+nextSlide%4)),$scope.$broadcast("takeover-modal-translate")}}},$scope.$on("modalOpen",function(){$window.addEventListener("wheel",_.throttle(vm.scroll,50)),$window.addEventListener("keydown",vm.keydown)}),$scope.$on("modalClosed",function(){$window.removeEventListener("wheel",_.throttle(vm.scroll,50)),$window.removeEventListener("keydown",vm.keydown)}),vm.scroll=function(e){if(Math.abs(e.deltaY)>70)e.deltaY<0?vm.slickConfig.method.slickPrev():vm.slickConfig.method.slickNext();else{var timeOfCurScroll=(new Date).getTime(),timeThreshold=100,timeDiff=timeOfCurScroll-vm.timeOfPrevScroll;timeDiff>timeThreshold&&(e.deltaY<0?vm.slickConfig.method.slickPrev():vm.slickConfig.method.slickNext()),vm.timeOfPrevScroll=timeOfCurScroll}},vm.keydown=function(e){switch(e.key){case"ArrowUp":vm.slickConfig.method.slickPrev();break;case"ArrowDown":vm.slickConfig.method.slickNext();break;case"PageUp":vm.slickConfig.method.slickPrev();break;case"PageDown":vm.slickConfig.method.slickNext();break;case"Tab":vm.handleTabKeydown(e)}},vm.handleTabKeydown=function(e){var section=$element[0].querySelector(".slick-active"),actionableElements=section.querySelectorAll("a"),closeButton=$document[0].querySelector(".modal-dialog button.close");e.shiftKey||0!==actionableElements.length?(e.shiftKey||$document[0].activeElement!==actionableElements[actionableElements.length-1]||(e.preventDefault(),vm.slickConfig.method.slickNext(),$timeout(function(){closeButton.focus()},600)),e.shiftKey&&$document[0].activeElement===closeButton&&(vm.slickConfig.method.slickPrev(),$timeout(function(){section=$element[0].querySelector(".slick-active"),actionableElements=section.querySelectorAll("a"),actionableElements[actionableElements.length-1].focus()},600))):(e.preventDefault(),vm.slickConfig.method.slickNext(),$timeout(function(){closeButton.focus()},600))}}var takeoverModalComponent={templateUrl:"app/marketing/components/takeoverModal/takeoverModal.component.tpl.html",controller:takeoverModalController,bindings:{settings:"<"},controllerAs:"vm"};angular.module("marketingCore").component("takeoverModal",takeoverModalComponent)}(angular),function(angular,moment){"use strict";var articleService=function($http,dataAccessService){function setArticleSourceBaseUrl(url){articleBaseUrl=url}function getArticleSourceBaseUrl(){return articleBaseUrl}function getAllArticles(){return dataAccessService.request({url:articleBaseUrl+"articles.full.json",method:"GET"}).then(function(result){return result.data.articles=sortArticlesByDate(result.data.articles),result})}function getFirstSetOfArticles(tag){var separator=""===tag?"":".";return dataAccessService.request({url:articleBaseUrl+"articles"+separator+tag+".json",method:"GET"}).then(function(result){return result.data.articles=sortArticlesByDate(result.data.articles),result})}function getArticlesByPage(articlesList,pageNumber,pageSize){var pageNumberIndex=pageNumber-1;return articlesList.slice(pageNumberIndex*pageSize,pageNumber*pageSize)}function getFilteredArticles(articlesList,tag,filters){var filteredArticles=[];tag.length?angular.forEach(articlesList,function(article,key){article.tags.indexOf(tag)>=0&&filteredArticles.push(article)}):filteredArticles=angular.copy(articlesList);var selectedFilters=angular.copy(filters);return angular.forEach(selectedFilters,function(filter,key){filter.value.length&&(filteredArticles=filteredArticles.filter(function(article){var articleDate=article.date?article.date.split("T")[0]:!1;switch(key){case"articles":return article.type&&article.type.toLowerCase()===filter.value.toLowerCase();case"author":return article.author&&article.author.toLowerCase()===filter.value.toLowerCase();case"year":return articleDate&&moment(articleDate,"YYYY-MM-DD").year()===Number(filter.value);case"month":return articleDate&&moment(articleDate,"YYYY-MM-DD").month()===filter.value-1;default:return null}}))}),filteredArticles}function getTotalPages(articlesList,pageSize){return!articlesList||articlesList.length<=0?0:Math.floor((articlesList.length+pageSize-1)/pageSize)}function sortArticlesByDate(articlesList){return articlesList.sort(function(article1,article2){return article2.date>article1.date?1:article2.date<article1.date?-1:0})}var articleBaseUrl="";return{setArticleSourceBaseUrl:setArticleSourceBaseUrl,getAllArticles:getAllArticles,getFirstSetOfArticles:getFirstSetOfArticles,getArticlesByPage:getArticlesByPage,getTotalPages:getTotalPages,getFilteredArticles:getFilteredArticles,getArticleSourceBaseUrl:getArticleSourceBaseUrl,sortArticlesByDate:sortArticlesByDate}};articleService.$inject=["$http","dataAccessService"],angular.module("marketingCore").factory("articleService",articleService)}(angular,moment),function(angular){"use strict";function tmoBlasterWrapperController(){var vm=this;vm.$onInit=function(){}}var tmoBlasterWrapperComponent={controller:tmoBlasterWrapperController,templateUrl:"app/marketing/components/tmoBlasterGame/tmoBlasterWrapper.component.tpl.html",bindings:{settings:"<"},controllerAs:"vm"};angular.module("marketingCore").component("tmoBlasterWrapper",tmoBlasterWrapperComponent)}(angular),function(angular,lodash){"use strict";function byodCheckerService($http,$q,$log,$location,marketingHttpRequest,apiURLs){function getByodDetails(url,headers,data){var promise;return promise=marketingHttpRequest.authGet(url,headers,data).then(function(response){return ts.model.byodCheckSuccess=!0,response})["catch"](function(error){return ts.model.byodCheckSuccess=!1,ts.model.byodAPIError=!0,error})}function getCompatabilityandEligibilityDetails(pIMEI){var reqURL=apiURLs.hapiAccessToken;return marketingHttpRequest.get(reqURL).then(function(response){if(200==response.status){var url,params={},headers={},data={};return params.imeiNumber=pIMEI,headers.Authorization=response.data.access_token,url=apiURLs.byodChecker+"?"+queryString.stringify(params),getByodDetails(url,headers,data)}return response},function(errorResponse){return ts.model.byodCheckSuccess=!1,ts.model.byodAuthError=!0,errorResponse})}var ts=this;return ts.model={byodCheckSuccess:!1,byodAPIError:!1,byodAuthError:!1},{getCompatabilityandEligibilityDetails:getCompatabilityandEligibilityDetails,byodCheckerModel:ts.model,getByodDetails:getByodDetails}}byodCheckerService.$inject=["$http","$q","$log","$location","marketingHttpRequest","apiURLs"],angular.module("marketingCore").factory("byodCheckerService",byodCheckerService)}(window.angular,window._),function(angular){"use strict";function travelContainerComponentController($location){var vm=this;vm.queryResult={},vm.onQueryResult=function(result){vm.queryResult=result},this.$onChanges=function(changes){changes.moduleId&&vm.moduleId&&(vm.templateUrl=vm.moduleId+"/travel/travel-container.html")},this.$onInit=function(){vm.templateUrl=vm.moduleId+"/travel/travel-container.html"}}var travelContainerComponent={template:'<div ng-include="$ctrl.templateUrl"> </div>',controller:travelContainerComponentController,bindings:{moduleId:"@"}};angular.module("marketingCore").component("travelContainer",travelContainerComponent)}(window.angular),function(angular){"use strict";function businessILExpansionService($window,$http,$log){function validateUUID(uuiddata,url,csrfToken){var data={method:"POST",url:$window.location.origin+url,headers:{"CSRF-Token":csrfToken},data:uuiddata};return $http(data).then(function(onSuccessResponse){return onSuccessResponse.data},function(errorResponse){return $log.error("Error call can not be completed",url+errorResponse),errorResponse})}function validateLink(data,url){var token=sessionStorage.getItem("csrfToken");if(token)return validateUUID(data,url,token);var auth={method:"GET",url:"/libs/granite/csrf/token.json"};return $http(auth).then(function(response){return token=response.data.token,sessionStorage.setItem("csrfToken",token),validateUUID(data,url,token)},function(errorResponse){return $log.error("Error call can not be completed",auth.url+errorResponse),errorResponse})}var vm=this;vm.validateLink=validateLink}businessILExpansionService.$inject=["$window","$http","$log"],angular.module("marketingCore").service("businessILExpansionService",businessILExpansionService)}(angular,window),function(angular){"use strict";function AppDownloadController($scope,$element,$cookies,analyticsUtils,sendSMSUtils){function callback(err,result){err?(vm.status="fail",vm.phoneNumber=null,vm.appDownloadForm.$setPristine(),vm.appDownloadForm.$setUntouched(),$scope.$apply()):(vm.status="success",vm.phoneNumber=null,vm.appDownloadForm.$setPristine(),vm.appDownloadForm.$setUntouched(),$scope.$apply(),analyticsUtils.trackForm({eventType:"form complete",analyticsID:vm.analyticsID,submitText:submitCTA}))}function onInit(analyticsID){vm.analyticsID=analyticsID,vm.status="initial",vm.focus="",vm.lang=$cookies.get("MP_LANG")}function submit(isValid){if(vm.submitted=!0,isValid){vm.status="processing";var message,branchKey=$element[0].dataset.branchKey,branchChannel=$element[0].dataset.branchChannel,branchFeature=$element[0].dataset.branchFeature,englishMessage=$element[0].dataset.branchEnglishMessage,spanishMessage=$element[0].dataset.branchSpanishMessage,options={channel:branchChannel,feature:branchFeature};message="es"===vm.lang&&spanishMessage?spanishMessage:englishMessage,sendSMSUtils.sendText(branchKey,vm.phoneNumber,options,message,vm.callback)}}function activeOnFocus(){vm.focus=!0,isFormStarted||(analyticsUtils.trackForm({eventType:"form start",analyticsID:vm.analyticsID,submitText:submitCTA}),isFormStarted=!0)}function resetForm(){vm.status="initial",analyticsUtils.trackForm({eventType:"form reset",analyticsID:vm.analyticsID,submitText:submitCTA})}var vm=this,isFormStarted=!1,submitCTA=$element[0].querySelector('[type="submit"]').innerText;vm.callback=callback,vm.onInit=onInit,vm.submit=submit,vm.activeOnFocus=activeOnFocus,vm.resetForm=resetForm}AppDownloadController.$inject=["$scope","$element","$cookies","analyticsUtils","sendSMSUtils"],
angular.module("marketingCore").controller("AppDownloadController",AppDownloadController)}(angular),function(angular){"use strict";function chat($q,$window,utils){function isReady(){return utils.pollForGlobal("lpTag",3e3).then(onSuccessLoad,onErrorLoad),deferred.promise}function onSuccessLoad(){angular.isObject(lpTag)&&angular.isObject(lpTag.events)&&angular.isFunction(lpTag.events.bind)?(lpTag.events.bind("LP_OFFERS","OFFER_IMPRESSION",function(data){1===data.state?deferred.resolve(data.state):onErrorLoad()}),lpTag.newPage&&angular.isFunction(lpTag.newPage)&&lpTag.newPage($window.location.href)):onErrorLoad()}function onErrorLoad(){return deferred.reject("Chat not available.")}var deferred=$q.defer(),lpTag=$window.lpTag;return{isReady:isReady}}chat.$inject=["$q","$window","utils"],angular.module("marketingCore").service("chat",chat)}(angular),function(angular){"use strict";function businessILExpansionController($scope,commonServices,businessILExpansionService){function validateLink(){if(vm.uuid=commonServices.$location.search().uuid,!angular.isDefined(vm.uuid)||_.isEmpty(vm.uuid))commonServices.openHomePage("home");else{var url="/bin/validateLink",data={uuid:vm.uuid};try{businessILExpansionService.validateLink(data,url).then(function(result){vm.status=result.status,vm.showMsg=!0,vm.spinner=!1},function(error){commonServices.$log.log("API call status :: "+error.data)})}catch(err){commonServices.$log.log("Exception API call status :: "+err.message)}commonServices.$log.log("API call status :: "+vm.status)}}var vm=this;vm.validateLink=validateLink,vm.status=void 0,vm.showMsg=!1,vm.spinner=!0}businessILExpansionController.$inject=["$scope","commonServices","businessILExpansionService"],angular.module("marketingCore").controller("businessILExpansionController",businessILExpansionController)}(window.angular,_),function(angular){"use strict";var dataAccessService=function($http){function request(requestParams){var requestParameters={method:requestParams.method,url:requestParams.url,data:requestParams.data,headers:requestParams.headers};return $http(requestParameters).then(function(result){return result.success=!0,result},function(result){return result.success=!1,result})}return{request:request}};dataAccessService.$inject=["$http"],angular.module("marketingCore").factory("dataAccessService",dataAccessService)}(angular),function(angular){"use strict";function ChatCtaController($scope,$window,chat){var vm=this;chat.isReady().then(function(){vm.isReadyChat=!0}),vm.showChat=function(id){$window.lpTag.taglets.rendererStub.click(id)}}ChatCtaController.$inject=["$scope","$window","chat"],angular.module("marketingCore").controller("ChatCtaController",ChatCtaController)}(angular),function(angular){"use strict";var eventRouterService=function(dataAccessService){function sendEmailCaptureData(payload){return dataAccessService.request(payload)}return{sendEmailCaptureData:sendEmailCaptureData}};eventRouterService.$inject=["dataAccessService"],angular.module("marketingCore").factory("eventRouterService",eventRouterService)}(angular),function(angular,lodash){"use strict";function ContactFormController($scope,$http,$timeout,$log,utils,$element,analyticsUtils,$sce,$window){function activeOnFocus(){isFormStarted||(analyticsUtils.trackForm({eventType:"form start",analyticsID:vm.settings.analyticsID,submitText:vm.submitCTA}),isFormStarted=!0)}function updateValues(){var inputValues=getValues(),scopeFirstName=vm.businessContactForm["First Name"],scopeLastName=vm.businessContactForm["Last Name"],scopeBusinessPhone=vm.businessContactForm["Business Phone"],scopeEmail=vm.businessContactForm.Email,scopeZip=vm.businessContactForm["Zip Code"],scopeCompany=vm.businessContactForm.Company,scopeParDot=vm.businessContactForm.pardot_extra_field;$scope.formData.firstName=inputValues.firstName,scopeFirstName.$setTouched(!0),scopeFirstName.$setDirty(!0),$scope.formData.lastName=inputValues.lastName,scopeLastName.$setTouched(!0),scopeLastName.$setDirty(!0),$scope.formData.businessPhone=inputValues.businessPhone,scopeBusinessPhone.$setTouched(!0),scopeBusinessPhone.$setDirty(!0),$scope.formData.email=inputValues.email,scopeEmail.$setTouched(!0),scopeEmail.$setDirty(!0),$scope.formData.zipCode=parseInt(inputValues.zipCode,10),scopeZip.$setTouched(!0),scopeZip.$setDirty(!0),$scope.formData.company=inputValues.companyName,scopeCompany.$setTouched(!0),scopeCompany.$setDirty(!0),$scope.formData.pardot_extra_field=inputValues.firstName+" "+inputValues.lastName,scopeParDot.$setTouched(!0),scopeParDot.$setDirty(!0)}function onInit(data,analyticsID,ctaName){var dataObject=angular.fromJson(data);vm.action=$sce.trustAsResourceUrl(atob(dataObject.endpoint)),vm.settings.analyticsID=analyticsID,vm.settings.moduleId=dataObject.moduleId,vm.settings.siteId=dataObject.siteId,vm.settings.authToken=atob(dataObject.authToken),vm.submitCTA=ctaName,"section"===dataObject.htmlTag?$timeout(function(){$scope.$broadcast("renderGrecaptcha")},0):"dialog"===dataObject.htmlTag&&$scope.$on("modalOpen",function(){$scope.$broadcast("renderGrecaptcha")})}function onExecuteGrecaptcha(response){vm.grecaptchaResponse=response,$http({method:"GET",url:"/bin/services/marketing/gvalidation",params:{response:vm.grecaptchaResponse}}).then(onSuccess,onError)}function onExpireGrecaptcha(){vm.grecaptchaResponse=null}function submit($event){$event.preventDefault(),vm.form=$event.target,vm.form.setAttribute("action",vm.action),linkedInBtn()&&updateValues(),$timeout(function(){vm.businessContactForm.$setSubmitted(),vm.businessContactForm.$valid&&($scope.formData.pardot_extra_field=$scope.formData["First Name"]+" "+$scope.formData["Last Name"],grecaptcha.reset(),grecaptcha.execute($scope.grecaptchaId))},1)}function onSuccess(response){sessionStorage.setItem("business-contact-success","true"),$timeout(function(){$scope.$broadcast("submitted")},0),vm.form.submit()}function onError(response){$log.error("reCaptcha failed")}var linkedInBtn=function(){return $element[0].querySelectorAll(".linkedin-autofill-btn")?$element[0].querySelectorAll(".linkedin-autofill-btn"):null},getValues=function(){var firstName=$element[0].querySelector("#lead-gen-firstName").value,lastName=$element[0].querySelector("#lead-gen-lastName").value,businessPhone=$element[0].querySelector("#lead-gen-phone").value,zipCode=$element[0].querySelector("#lead-gen-zip").value,email=$element[0].querySelector("#lead-gen-email").value,companyName=$element[0].querySelector("#lead-gen-company").value,inputs={firstName:firstName,lastName:lastName,businessPhone:businessPhone,zipCode:zipCode,email:email,companyName:companyName};return inputs},vm=this,isFormStarted=!1;vm.activeOnFocus=activeOnFocus,vm.settings={},vm.onInit=onInit,vm.submit=submit,vm.onExecuteGrecaptcha=onExecuteGrecaptcha,vm.onExpireGrecaptcha=onExpireGrecaptcha}ContactFormController.$inject=["$scope","$http","$timeout","$log","utils","$element","analyticsUtils","$sce","$window"],angular.module("marketingCore").controller("ContactFormController",ContactFormController)}(angular,window._),function(angular,lodash){"use strict";function internationalCallingService($http,$q,$log,$location){function getInternationalCallingData(data){var request={method:"GET",url:data};return hasMadeRequest?void 0:(hasMadeRequest=!0,$http(request).then(function(response){if(response.data.Rates){var uniqRates=lodash.uniqBy(response.data.Rates,"CountryName");return internationalCallingData=response.data.Rates,lodash.forEach(uniqRates,function(value){internationalCountries.push(value.CountryName)}),$q.resolve(response.data.Rates)}return $q.reject("Error response had no country data.")},function(response){return $log.error("error country ",response),$q.reject("Error making request for country data.")}))}function getItemFromName(name){var searchedItem=null;return lodash.forEach(internationalCallingData,function(value,key){value.CountryName.toLowerCase()===name.toLowerCase()&&(searchedItem=value.CountryName)}),searchedItem||(searchedItem=name),searchedItem}function getCallingDataForCountry(){var itemFromName=getItemFromName(selectedCountry.name);selectedCountry.name=itemFromName;var selectedCountryRates=lodash.filter(internationalCallingData,{CountryName:selectedCountry.name}),socIntRates=lodash.filter(selectedCountryRates,{SocCode:"INTTMOB15"}),socStdRates=lodash.filter(selectedCountryRates,{SocCode:"STDUITT"});selectedCountry.submittedCountry=selectedCountry.name,$location.search("countryName",selectedCountry.submittedCountry),socIntRates&&socIntRates.length>0?selectedCountry.INTTMOB15=socIntRates[0]:selectedCountry.INTTMOB15={},socStdRates&&socStdRates.length>0?selectedCountry.STDUITT=socStdRates[0]:selectedCountry.STDUITT={}}var hasMadeRequest=!1,internationalCallingData=[],internationalCountries=[],selectedCountry={name:"",INTTMOB15:{},STDUITT:{},submittedCountry:""};return{getInternationalCallingData:getInternationalCallingData,getCallingDataForCountry:getCallingDataForCountry,internationalCallingData:internationalCallingData,internationalCountries:internationalCountries,selectedCountry:selectedCountry}}internationalCallingService.$inject=["$http","$q","$log","$location"],angular.module("marketingCore").factory("internationalCallingService",internationalCallingService)}(window.angular,window._),function(angular){"use strict";function CoverageMapController($window,$sce,$timeout){function onInit(data){$timeout(function(){var latitude,longitude,sessionIPC=angular.fromJson(sessionStorage.getItem("IPC"));sessionIPC&&(latitude=sessionIPC.latitude,longitude=sessionIPC.longitude),angular.isDefined(latitude)&&angular.isDefined(longitude)&&data.fallbackToggle&&"true"===data.fallbackToggle?(vm.iFrameSrcUrl=$sce.trustAsResourceUrl(data.mapURL+"&language=en&fallback="+latitude+","+longitude),vm.iFrameSrcEsUrl=$sce.trustAsResourceUrl(data.mapURL+"&language=es&fallback="+latitude+","+longitude)):(vm.iFrameSrcUrl=$sce.trustAsResourceUrl(data.mapURL+"&language=en"),vm.iFrameSrcEsUrl=$sce.trustAsResourceUrl(data.mapURL+"&language=es"))},2e3)}var vm=this;vm.onInit=onInit}CoverageMapController.$inject=["$window","$sce","$timeout"],angular.module("marketingCore").controller("CoverageMapController",CoverageMapController)}(angular),function(angular,lodash){"use strict";function internationalRoamingService(){function getCountryData(mode){return"roaming"===mode?countryData:"cruise"===mode?cruiseData:void 0}function setCountryData(mode,data){"roaming"===mode?countryData=data:"cruise"===mode&&(cruiseData=data)}var countryData={},cruiseData={};return{getCountryData:getCountryData,setCountryData:setCountryData}}angular.module("marketingCore").factory("internationalRoamingService",internationalRoamingService)}(window.angular,window._),function(angular){"use strict";function DeviceCheckerController($scope,$http,$q,$log){function onInit(data){$q.all([getHttpPromise(data.compatibleCarrierDataUrl),getHttpPromise(data.compatibleDeviceDataUrl)]).then(onSuccess,onError)}function submit(isValid){isValid?($scope.carrierName=vm.formData.selectedCarrier.carrier,$scope.deviceName=vm.formData.selectedDevice.device_name,$scope.$broadcast("valid",{isValid:!0,isCompatible:isCompatible()}),$scope.deviceCheckerForm.$setPristine(),$scope.deviceCheckerForm.$setUntouched(),vm.formData.selectedCarrier=null,vm.formData.selectedDevice=null):$scope.$broadcast("valid",{isValid:!1})}function isCompatible(){return vm.formData.selectedDevice&&vm.formData.selectedCarrier?angular.equals(vm.formData.selectedDevice.dual_mode,"Y")||angular.equals(vm.formData.selectedCarrier.radio,"GSM"):!1}function getHttpPromise(url){return $http({method:"GET",url:url})}function onSuccess(responses){responses[0]&&responses[0].data&&(vm.carriers=responses[0].data),responses[1]&&responses[1].data&&(vm.devices=responses[1].data)}function onError(){$log.error("There was a problem with the request.")}var vm=this;vm.onInit=onInit,vm.submit=submit}DeviceCheckerController.$inject=["$scope","$http","$q","$log"],angular.module("marketingCore").controller("DeviceCheckerController",DeviceCheckerController)}(angular),function(angular,lodash){"use strict";function marketingHttpRequest($log,$http,$q,apiURLs,authTokenManager){function get(url,params){var config={method:"GET",url:_.isEmpty(params)?url:url+"?"+queryString.stringify(params)};return $http(config)}function jsonp(url,params){var promise,req={};if(params){var qs=queryString.stringify(params);req.url=url+"?"+qs}else req.url=url;return req.method="JSONP",promise=$http(req).then(function(response){return response})}function post(url,data){var promise,req={};return data&&(req.data=data),req.url=url,req.method="POST",promise=$http(req).then(function(response){return response})}function authPost(url,headers,data,authRequired){var promise,req={};return req.url=url,req.method="POST",req.headers=headers,req.data=data,authRequired&&(req.headers.Authorization=getAuthorizationToken()),promise=$http(req).then(function(response){return response})}function authPut(url,headers,data,authRequired){var promise,req={};return req.url=url,req.method="PUT",req.headers=headers,req.data=data,authRequired&&(req.headers.Authorization=getAuthorizationToken()),promise=$http(req).then(function(response){return response})}function authGet(url,headers,data){var promise,req={};return req.url=url,req.method="GET",req.headers=headers,req.data=data,promise=$http(req).then(function(response){return response})}function tokenPost(url){var promise,req={};return req.url=url,req.method="POST",req.data={grant_type:"password",role:"PUBLIC",scope:"raptor"},req.transformRequest=function(obj){var str=[];return angular.forEach(obj,function(p){str.push(encodeURIComponent(p)+"="+encodeURIComponent(obj[p]))}),str.join("&")},promise=$http(req).then(function(response){return $log.log("response.data",response.data),response})}function getJSON(url){var deffered=$q.defer(),promise=deffered.promise,xhr=new XMLHttpRequest;return xhr.open("get",url,!0),xhr.responseType="json",xhr.onload=function(){var status=xhr.status;200==status?deffered.resolve(xhr.response):deffered.reject(status)},xhr.send(),promise}function patch(url,headers,data,authRequired){var req={};return req.url=url,req.method="PATCH",req.headers=headers,req.data=data,authRequired&&(req.headers.Authorization=getAuthorizationToken()),$http(req).then(function(response){var deferred=$q.defer();return 200===response.status?deferred.resolve(response):deferred.reject(),deferred.promise})}function deleteRequest(url,headers,data,authRequired){var req={};return req.url=url,req.method="DELETE",req.headers=headers,req.data=data,authRequired&&(req.headers.Authorization=getAuthorizationToken()),$http(req).then(function(response){var deferred=$q.defer();return 200===response.status?deferred.resolve(response):deferred.reject(),deferred.promise})}function getAuthorizationToken(){var authToken,token;return authToken=lodash.get(apiURLs,"isV2AccessTokenDisabled",!1)?authTokenManager.getTokenCookies("jwt_token",angular.equals(apiURLs.storage,"localStorage"))||authTokenManager.getTokenCookies("JSONWebToken",angular.equals(apiURLs.storage,"localStorage")):authTokenManager.getTokenCookies("token",angular.equals(apiURLs.storage,"localStorage")),authToken&&(token="Bearer "+authToken.access_token),token}function getToken(){var authToken;return authToken=lodash.get(apiURLs,"isV2AccessTokenDisabled",!1)?authTokenManager.getTokenCookies("jwt_token",angular.equals(apiURLs.storage,"localStorage"))||authTokenManager.getTokenCookies("JSONWebToken",angular.equals(apiURLs.storage,"localStorage")):authTokenManager.getTokenCookies("token",angular.equals(apiURLs.storage,"localStorage"))}var service=this;service.patch=patch,service.get=get,service.jsonp=jsonp,service.post=post,service.authPost=authPost,service.authGet=authGet,service.authPut=authPut,service.tokenPost=tokenPost,service.getJSON=getJSON,service.deleteRequest=deleteRequest,service.getToken=getToken}marketingHttpRequest.$inject=["$log","$http","$q","apiURLs","authTokenManager"],angular.module("marketingCore").service("marketingHttpRequest",marketingHttpRequest)}(angular,window._),function(angular){"use strict";function HeroContentController($scope,$cookies,$element){function onInit(){var modalId=$element[0].getAttribute("data-module-id");vm.bannerMode=!0,sessionItem="hero-"+modalId;var dismissComponent=$cookies.get(sessionItem);"true"===dismissComponent&&(vm.sessionClose=!0)}function onHeroClose(){$cookies.put(sessionItem,!0,{path:"/"}),vm.heroClose=!0}var sessionItem,vm=this;vm.sessionClose=!1,vm.onInit=onInit,vm.onHeroClose=onHeroClose}HeroContentController.$inject=["$scope","$cookies","$element"],angular.module("marketingCore").controller("HeroContentController",HeroContentController)}(window.angular),function(angular){"use strict";function personalizedAnchorLinks($location,$anchorScroll,$timeout){function onloadAjaxScrollTo(){$timeout(function(){$location.hash()&&!hasScrolledToAnchor&&($anchorScroll(),hasScrolledToAnchor=!0)},1500)}var hasScrolledToAnchor=!1;return{onloadAjaxScrollTo:onloadAjaxScrollTo}}personalizedAnchorLinks.$inject=["$location","$anchorScroll","$timeout"],angular.module("marketingCore").service("personalizedAnchorLinks",personalizedAnchorLinks)}(window.angular),function(angular){function InfiniteRunnerController($scope,$window,$attrs,analyticsUtils,$compile){function onInit(){function WidthChange(mqu){mq.matches?(vm.backgroundImage={"background-image":"url('"+mobileImg+"')"},vm.rotateImage={"background-image":"url('"+mobileImg+"')"}):lmq.matches?vm.backgroundImage={"background-image":"url('"+desktopImg+"')"}:tmq.matches?(vm.backgroundImage={"background-image":"url('"+tabletImg+"')"},vm.rotateImage={"background-image":"url('"+tabletImg+"')"}):dmq.matches&&(vm.backgroundImage={"background-image":"url('"+desktopImg+"')"})}var win=angular.element($window),desktopImg=$attrs.desktop,tabletImg=$attrs.tablet,mobileImg=$attrs.mobile,mq=$window.matchMedia("(max-width: 639px)"),tmq=$window.matchMedia("(min-width: 640px) and (max-width: 1023px)"),lmq=$window.matchMedia("(orientation: landscape) and (min-width: 568px) and (max-width: 1023px)"),dmq=$window.matchMedia("(min-width:1024px)");matchMedia&&(win.on("resize",_.debounce(WidthChange,100)),WidthChange(mq))}function loadGame(hol){$window.document.getElementById("imageLoad").style.display="none",$window.document.getElementById("runnerGame").innerHTML='<div infinite-runner data-runner="'+hol+'"><canvas id="canvas"></canvas><div id="rotate"></div></div>',$compile($window.document.getElementById("runnerGame"))($scope)}var vm=this;vm.onInit=onInit,vm.loadGame=loadGame,vm.backgroundImage=null,vm.rotateImage=null}InfiniteRunnerController.$inject=["$scope","$window","$attrs","analyticsUtils","$compile"],angular.module("marketingCore").controller("InfiniteRunnerController",InfiniteRunnerController)}(angular),function(angular,lodash){"use strict";function personalizedPickerService($window,$rootScope,$http,$q,utils){function getPersonalizedContent(url){var req={method:"GET",url:url};return $http(req)}function addModules(modules){angular.forEach(modules,function(singleModule){var moduleId=singleModule.attributes["data-module-picker-id"].value;moduleId&&"loaded"!==modulePickers[moduleId]&&(modulePickers[moduleId]="loading")})}function modulePickerLoaded(moduleId){modulePickers[moduleId]="loaded",hasModulePickersLoaded()}function hasModulePickersLoaded(){var state=lodash.countBy(modulePickers);state.loaded===modulePickerCount&&deferred.resolve()}function findPickerLength(){if(pagePicker){var pages=pickers[0].pages;pageType=$window.TMOPersonalize?$window.TMOPersonalize.page:pages[0].id;var pageId=pages.find(function(page){return page.id===pageType});modulePickerCount=pageId.pageModules.length}else modulePickerCount=$window.marketingTMOPersonalize.pickers.length}var modulePickerCount,pageType,deferred=$q.defer(),modulePickers={},pickers=$window.marketingTMOPersonalize.pickers,pagePicker=$window.marketingTMOPersonalize.pickers[0].pages;return utils.pollForGlobal("TMOPersonalize",1e3).then(findPickerLength,findPickerLength),deferred.promise.then(function(){$rootScope.$broadcast("modulePickersCompleted")}),{getPersonalizedContent:getPersonalizedContent,addModules:addModules,modulePickerLoaded:modulePickerLoaded,hasModulePickersLoaded:hasModulePickersLoaded,findPickerLength:findPickerLength}}personalizedPickerService.$inject=["$window","$rootScope","$http","$q","utils"],angular.module("marketingCore").service("personalizedPickerService",personalizedPickerService)}(window.angular,window._),function(angular){"use strict";function InternationalCallingResultsController($scope,internationalCallingService){function onInit(data){vm.analyticsID=data.analyticsID,vm.dataFilePath=data.dataFilePath,"false"===data.isNewInternationalCalling&&internationalCallingService.getInternationalCallingData(vm.dataFilePath)}var vm=this;vm.onInit=onInit,vm.internationalCallingService=internationalCallingService}InternationalCallingResultsController.$inject=["$scope","internationalCallingService"],angular.module("marketingCore").controller("InternationalCallingResultsController",InternationalCallingResultsController)}(window.angular),function(angular){"use strict";function serverTimeService($http,$q,utils,$log){function getServerTime(){return $q(function(resolve,reject){$http({method:"GET",url:"/etc/clientlibs/t-mobile/publish/app/clientlibs_app/assets/images/marketing/menu-icn-white.svg",params:{time:(new Date).getTime()}}).then(function(response){if(response.headers("date")){var serverTime=Date.parse(response.headers("date"));resolve(serverTime)}else reject("No server time in response header date.")},function(response){reject("Error retrieving asset for server time lookup."),$log.error("Error retrieving asset for server time lookup.")})})}return{getServerTime:getServerTime}}serverTimeService.$inject=["$http","$q","utils","$log"],angular.module("marketingCore").service("serverTimeService",serverTimeService)}(angular),function(angular){"use strict";function NetworkSpeedsController($log,networkSpeedsFactory,analyticsUtils){function onInit(data){vm.analyticsID=data.analyticsID,vm.url=data.url,networkSpeedsFactory.getNetworkSpeedData(vm.url).then(onSuccessNetworkData,onErrorNetworkData)}function onSuccessNetworkData(response){vm.availableMarkets=response}function onErrorNetworkData(response){$log.error("error network data",response)}function onSelect(){analyticsUtils.trackEvent("CLICK_EVENT",vm.analyticsID,{eventInfo:{eventAction:"click",eventType:"clickToAction"},attributes:{type:"navigation"},eventDescription:{ctaName:vm.selectedCity.name,assetType:"Dropdown Menu"}})}var vm=this;vm.availableMarkets=[],vm.onInit=onInit,vm.onSelect=onSelect}NetworkSpeedsController.$inject=["$log","networkSpeedsFactory","analyticsUtils"],angular.module("marketingCore").controller("NetworkSpeedsController",NetworkSpeedsController)}(window.angular),function(angular){"use strict";function syncUp($http,apiURLs){function getData(params){var data={CarrierCode:"tmobile-us",Language:"en-us",Region:"na"};Object.assign(data,params);var serviceURL;return serviceURL=params.Engine?apiURLs.syncUpCompatability:apiURLs.syncUpDevices,$http.post(serviceURL,data)}function getAvailableYears(){return getData({},availableYears)}function clearResults(){result.compatibility="",result.displayMessage=null,result.compatibilityType="",result.locationCode="",result.locationMessage=""}function clearAvailable(arr){arr.splice(0,arr.length)}function selectYear(params){return clearAvailable(availableMakes),clearAvailable(availableModels),clearAvailable(availableEngines),clearResults(),getData(params,availableMakes)}function selectMake(params){return clearAvailable(availableModels),clearAvailable(availableEngines),clearResults(),getData(params,availableModels)}function selectModel(params){return clearAvailable(availableEngines),clearResults(),getData(params,availableEngines)}function selectEngine(params){return clearResults(),getData(params).then(function(res){switch(result.locationCode=res.data.obdLocation.locationCode,result.compatibilityType=res.data.compatibility,res.data.compatibility){case"A":case"B":result.compatibility=!0,result.displayMessage=res.data.displayMessage,result.locationMessage=res.data.obdLocation.locationString;break;case"C":case"D":result.compatibility=!1,result.displayMessage=res.data.displayMessage?res.data.displayMessage:null;break;case"E":result.compatibility=!1,result.displayMessage=res.data.displayMessage?res.data.displayMessage:null}return result})}var availableYears=[],availableMakes=[],availableModels=[],availableEngines=[],availableDevices=[],result={compatibility:"",compatibilityType:"",displayMessage:null,locationCode:"",locationMessage:""};return{getAvailableYears:getAvailableYears,selectYear:selectYear,selectMake:selectMake,selectModel:selectModel,selectEngine:selectEngine,availableYears:availableYears,availableMakes:availableMakes,availableModels:availableModels,availableEngines:availableEngines,availableDevices:availableDevices,result:result}}syncUp.$inject=["$http","apiURLs"],angular.module("marketingCore").service("syncUp",syncUp)}(angular),function(angular){"use strict";function OffersCarouselController($scope){function onInit(data){cardsToShow=data.carouselSize<=3?1:3,$scope.slickConfig={nextArrow:'<button type="button" data-role="none" class="slick-next slick-arrow" aria-label="'+data.carouselSettings.nextAriaLabel+'" role="button" style="display: block;">'+data.carouselSettings.nextAriaLabel+"</button>",prevArrow:'<button type="button" data-role="none" class="slick-prev slick-arrow" ng-class="{\'slick-disabled\': isOnFirst}" aria-label="'+data.carouselSettings.previousAriaLabel+'" role="button" style="display: block;">'+data.carouselSettings.previousAriaLabel+"</button>",infinite:!0,accessibility:!0,focusOnSelect:!1,speed:600,useTransform:!0,autoplay:!0,cssEase:"ease",dots:!0,slidesToScroll:1,slidesToShow:cardsToShow,lazyLoad:"ondemand",variableWidth:!0,respondTo:"slider",pauseOnHover:!1,method:{},event:{},responsive:[]}}$scope.carousel={};var cardsToShow;$scope.onInit=onInit,$scope.isOnFirst=!0}OffersCarouselController.$inject=["$scope"],angular.module("marketingCore").controller("OffersCarouselController",OffersCarouselController)}(angular),function(angular,externalLogger,uuid){"use strict";function tsOfferSignupService($log,$q,$http,$window,commonStorage){function getEligibleDtata(validateData,url,v2ApiToggle,authToken){var data,tsData=angular.isUndefined(validateData)?{}:validateData,body={};return v2ApiToggle?(body=[{firstName:angular.isUndefined(tsData.firstname)?"":tsData.firstname,lastName:angular.isUndefined(tsData.lastname)?"":tsData.lastname,email:angular.isUndefined(tsData.email)?"":tsData.email,msisdn:angular.isUndefined(tsData.MSISDN)?"":tsData.MSISDN.toString(),billingStreet:angular.isUndefined(tsData.addressline1)?"":tsData.addressline1+(angular.isUndefined(tsData.addressline2)?"":tsData.addressline2),billingCity:angular.isUndefined(tsData.cityname)?"":tsData.cityname,billingState:angular.isUndefined(tsData.statecode)?"":tsData.statecode,billingPostalCode:angular.isUndefined(tsData.postalcode)?"":tsData.postalcode.toString(),socialChannel:angular.isUndefined(tsData.socialChannel)?"":tsData.socialChannel,socialHandle:angular.isDefined(tsData.socialChannel)?tsData.socialHandle:"",socialConsent:angular.isUndefined(tsData.socialConsent)?"":tsData.socialConsent,accountSource:"Magenta Insider",campaignId:angular.isUndefined(tsData.campaignId)?"":tsData.campaignId,externalId:uuid.create().toString()}],data={method:"POST",url:url,headers:{Authorization:"Bearer "+commonStorage.getToken(),"Content-Type":"application/json"},data:body}):(body={firstname:angular.isUndefined(tsData.firstname)?"":tsData.firstname,lastname:angular.isUndefined(tsData.lastname)?"":tsData.lastname,MSISDN:angular.isUndefined(tsData.MSISDN)?"":tsData.MSISDN.toString(),ValidateMSISDN:angular.isUndefined(tsData.ValidateMSISDN)?"":tsData.ValidateMSISDN,addressline1:angular.isUndefined(tsData.addressline1)?"":tsData.addressline1,addressline2:angular.isUndefined(tsData.addressline2)?"":tsData.addressline2,cityname:angular.isUndefined(tsData.cityname)?"":tsData.cityname,statecode:angular.isUndefined(tsData.statecode)?"":tsData.statecode,postalcode:angular.isUndefined(tsData.postalcode)?"":tsData.postalcode.toString(),ValidateAddress:angular.isUndefined(tsData.ValidateAddress)?"":tsData.ValidateAddress,InterestedinTFB:angular.isUndefined(tsData.InterestedinTFB)?"":tsData.InterestedinTFB,email:angular.isUndefined(tsData.email)?"":tsData.email,IMEI:angular.isUndefined(tsData.IMEI)?"":tsData.IMEI,hasdevice:angular.isUndefined(tsData.hasdevice)?"":tsData.hasdevice,zipcodeFilePath:angular.isUndefined(tsData.zipcodeFilePath)?"":tsData.zipcodeFilePath},data={method:"POST",url:$window.location.origin+url,headers:{Authorization:"Basic "+authToken,"CSRF-Token":token},data:body}),$http(data).then(function(onSuccessResponse){return onSuccessResponse.data},function(errorResponse){return $log.error("Error call can not be completed",url+errorResponse),errorResponse})}var ts=this,token=null;return ts.getTsData=function(validateData,url,v2ApiToggle,authToken){if(token=sessionStorage.getItem("csrfToken"),!token){var auth={method:"GET",url:"/libs/granite/csrf/token.json"};return $http(auth).then(function(response){return token=response.data.token,sessionStorage.setItem("csrfToken",token),getEligibleDtata(validateData,url,v2ApiToggle,authToken)},function(errorResponse){return $log.error("Error call can not be completed",auth.url+errorResponse),errorResponse})}return getEligibleDtata(validateData,url,v2ApiToggle,authToken)},ts.setSpinner=function(setValue){return ts.model.spinner=setValue,ts.model.spinner},ts.model={formData:{},validationModal:{phoneValidationModal:!1,addressValidationModal:!1,zipValidationModal:!1,alreadyOrderedModal:!1,errorModal:!1},phoneResponse:null,phoneErrorResponse:null,addressResponse:null,addressErrorResponse:null,zipcodeFilePath:"",zipCodeResponse:null,spinner:!1},ts}tsOfferSignupService.$inject=["$log","$q","$http","$window","commonStorage"],angular.module("tmobileCore").service("tsOfferSignup",tsOfferSignupService)}(window.angular,externalLogger,window.UUIDjs),function(angular){"use strict";function PriceSliderController($scope,analyticsUtils,utils){function sliderClick(){var option=vm.value;switch(vm.oldSlider=!0,option){case"1":$scope.$broadcast("updateSlider",".item-alt-one");break;case"2":$scope.$broadcast("updateSlider",".item-alt-two");break;case"3":$scope.$broadcast("updateSlider",".item-alt-three");break;case"4":$scope.$broadcast("updateSlider",".item-alt-four");break;case"5":$scope.$broadcast("updateSlider",".item-alt-five")}}var vm=this;vm.sliderClick=sliderClick}PriceSliderController.$inject=["$scope","analyticsUtils","utils"],angular.module("marketingCore").controller("PriceSliderController",PriceSliderController)}(window.angular),function(angular,externalLogger){"use strict";function tsOfferSignupAnalyticsService($timeout,tsOfferSignup){var tsAnalyze=this;return tsAnalyze.clickToAction=function(clickAction){var targetUrl="",tsForm=angular.isUndefined(document.querySelector("form[name=tsOfferSignupForm]"))?"":document.querySelector("form[name=tsOfferSignupForm]"),tsFormSubmit=angular.isUndefined(tsForm.querySelector("[type=submit]"))?"":tsForm.querySelector("[type=submit]"),formName=angular.isUndefined(tsForm.name)?"":tsForm.name,assetType=angular.isUndefined(tsFormSubmit.tagName)?"":tsFormSubmit.tagName,ctaName=angular.isUndefined(tsFormSubmit.innerText)?"":tsFormSubmit.innerText;if(tsFormSubmit)var icid=tsFormSubmit.getAttribute("data-icid");var event={eventInfo:{eventType:clickAction,eventAction:"click",timestamp:(new Date).toString()},category:{eventCategory:"click"},eventDescription:{targetUrl:targetUrl,assetType:assetType,ctaName:ctaName,modalName:"",formName:formName,icid:angular.isUndefined(icid)?"":icid}};window.digitalData.events.push(event),window.digitalData.triggerEvent(CLICK_EVENT);
},tsAnalyze.linkClickAction=function(clickAction,linkId,linkText,linkUrl){var tsLinkId,tsForm=angular.isUndefined(document.querySelector("form[name=tsOfferSignupForm]"))?"":document.querySelector("form[name=tsOfferSignupForm]"),formName=angular.isUndefined(tsForm.name)?"":tsForm.name;if(tsLinkId="imeiLink"===linkId?angular.isUndefined(tsForm.querySelector("a[id=imeiLink]"))?"":tsForm.querySelector("a[id=imeiLink]"):angular.isUndefined(tsForm.querySelector("a[id=modalLegalCta]"))?"":tsForm.querySelector("a[id=modalLegalCta]"))var icid=tsLinkId.getAttribute("data-icid");var event={eventInfo:{eventType:clickAction,eventAction:"click",timestamp:(new Date).toString()},category:{eventCategory:"click"},eventDescription:{targetUrl:angular.isUndefined(linkUrl)?"":linkUrl,assetType:"Link",ctaName:linkText,modalName:"",formName:formName,icid:angular.isUndefined(icid)?"":icid}};window.digitalData.events.push(event),window.digitalData.triggerEvent(CLICK_EVENT)},tsAnalyze.formOpen=function(){$timeout(function(){var tsModal=angular.isDefined(document.getElementById("tsModal"))?document.getElementById("tsModal"):"",modalName=angular.isUndefined(tsModal.getAttribute("data-name"))?"":tsModal.getAttribute("data-name"),modalID=modalName+"-"+tsModal.getAttribute("id");if(tsModal)var icid=tsModal.getAttribute("data-icid"),errorText=tsModal.childNodes[0].innerHTML;if(tsAnalyze.model.tsOfferSignupModel.validationModal.errorModal===!1){var event={eventInfo:{eventAction:"load",eventType:"modal",timeStamp:(new Date).toString()},attributes:{modalID:modalID,modalName:modalName,icidList:angular.isUndefined(icid)?"":icid}};window.digitalData.events.push(event),window.digitalData.triggerEvent(MODAL_LOAD_EVENT)}else{var event1={eventInfo:{eventAction:"click",eventType:"error"},eventDescription:[{errorText:errorText,modalName:modalName}]};window.digitalData.events.push(event1),window.digitalData.triggerEvent(ERROR_EVENT)}},1e3)},tsAnalyze.formComplete=function(alreadyCustomer,InterestedinTFB){var tsForm=angular.isUndefined(document.querySelector("form[name=tsOfferSignupForm]"))?"":document.querySelector("form[name=tsOfferSignupForm]"),formName=angular.isUndefined(tsForm.name)?"":tsForm.name,alreadyCustomervalue="false"==alreadyCustomer.toString()?"No":"Yes",InterestedinTFBValue="false"==InterestedinTFB.toString()?"No":"Yes",userSelectionvalue=alreadyCustomervalue.toString()+": Already have device|"+InterestedinTFBValue.toString()+": Interested in T-Mobile for Business",event={eventInfo:{eventAction:"click",eventType:"form complete",timeStamp:(new Date).toString()},eventDescription:{formName:formName,modalName:"",userSelection:userSelectionvalue}};window.digitalData.events.push(event),window.digitalData.triggerEvent(CLICK_EVENT)},tsAnalyze.formStart=function(){var tsForm=angular.isUndefined(document.querySelector("form[name=tsOfferSignupForm]"))?"":document.querySelector("form[name=tsOfferSignupForm]"),formName=angular.isUndefined(tsForm.name)?"":tsForm.name,event={eventInfo:{eventAction:"click",eventType:"form start"},eventDescription:{formName:formName,modalName:""}};window.digitalData.events.push(event),window.digitalData.triggerEvent(CLICK_EVENT)},tsAnalyze.formClose=function(){var tsModal=angular.isDefined(document.getElementById("tsModal"))?document.getElementById("tsModal"):"",modalName=angular.isUndefined(tsModal.getAttribute("data-name"))?"":tsModal.getAttribute("data-name"),modalID=modalName+"-"+tsModal.getAttribute("id");if(tsModal)var errorText=tsModal.childNodes[0].innerHTML;if(tsAnalyze.model.tsOfferSignupModel.validationModal.errorModal===!1){var event={eventInfo:{eventAction:"close",eventType:"modal",timeStamp:(new Date).toString()},attributes:{modalID:modalID,modalName:modalName}};window.digitalData.events.push(event),window.digitalData.triggerEvent(MODAL_LOAD_EVENT)}else{var event1={eventInfo:{eventAction:"close",eventType:"error"},eventDescription:[{errorText:errorText,modalName:modalName}]};window.digitalData.events.push(event1),window.digitalData.triggerEvent(ERROR_EVENT)}},tsAnalyze.errorModal=function(errorText){var tsModal=angular.isDefined(document.getElementById("tsModal"))?document.getElementById("tsModal"):"",modalName=angular.isUndefined(tsModal.getAttribute("data-name"))?"":tsModal.getAttribute("data-name"),tsForm=(modalName+"-"+tsModal.getAttribute("id"),angular.isUndefined(document.querySelector("form[name=tsOfferSignupForm]"))?"":document.querySelector("form[name=tsOfferSignupForm]")),formName=angular.isUndefined(tsForm.name)?"":tsForm.name,event={eventInfo:{eventAction:"click",eventType:"error"},eventDescription:[{errorText:errorText,errorCode:"",modalName:modalName,formName:formName}]};window.digitalData.events.push(event),window.digitalData.triggerEvent(ERROR_EVENT)},tsAnalyze.model={tsOfferSignupModel:tsOfferSignup.model},tsAnalyze}tsOfferSignupAnalyticsService.$inject=["$timeout","tsOfferSignup"],angular.module("tmobileCore").service("tsOfferSignupAnalytics",tsOfferSignupAnalyticsService)}(angular,externalLogger,window),function(angular){"use strict";function ProductPreRegisterController($scope,$window,$cookies,$log,selligentUtils){function onInit(data,analyticsID,options){vm.lang=$cookies.get("MP_LANG")||"en",vm.authToken=data.authToken,vm.analyticsID=analyticsID,vm.isSendingData=!1,vm.eventOptions=options,vm.formData.optinText=data.optInText,vm.formData.project=data.project,vm.formData.manufacturer=data.manufacturer,vm.formData.codename=data.codename,vm.formData.currentCustomer=data.currentCustomerDefault,vm.formData.optin=data.optinDefault,vm.selligentData=data.selligentData,vm.ppr.serverError=!1,vm.success=!1}function submit(isValid){vm.isSendingData||(vm.submitted=!0,isValid?(vm.isSendingData=!0,"eventRouter"===vm.eventOptions.type?createEventRouterPayload():"both"===vm.eventOptions.type?(createEventRouterPayload(),createSelligentPayload()):createSelligentPayload()):$scope.$broadcast("valid",!1))}function cleanPhone(){vm.formData.phone=""}function onSuccessSelligent(response){$scope.$broadcast("valid",!0),vm.ppr.serverError=!1,vm.response=response.data,vm.productPreRegisterForm.$setPristine(),vm.productPreRegisterForm.$setUntouched(),vm.formData={},vm.success=!0,vm.isSendingData=!1}function onErrorSelligent(response){vm.ppr.serverError=!0,$log.error("error selligent call",response),$scope.$broadcast("valid",!1),vm.isSendingData=!1}function createEventRouterPayload(){var locationUrl=$window.location.href,index=locationUrl.indexOf("?"),noQueryLocationUrl=locationUrl;-1!==index&&(noQueryLocationUrl=locationUrl.slice(0,index));var time=(new Date).toISOString(),eventRouterPayload={leadb2cmktEvents:[{middleName:"Not Applicable",birthDate:"Not Applicable",prefix:"Not Applicable",selectedCreditClass:"Not Applicable",currentCarrier:"Not Applicable",currentNumberOfLines:"Not Applicable",interestedNumberOfLines:"Not Applicable",interestedAccessories:"Not Applicable",interestedDevice:"Not Applicable",address1:"Not Applicable",address2:"Not Applicable",city:"Not Applicable",country:"Not Applicable",state:"Not Applicable",addressType:"Not Applicable",languagePreference:"Not Applicable",contactPreferenceMail:"Not Applicable",contactPreferenceEmail:"Not Applicable",contactPreferenceCall:"Not Applicable",contactPreferenceSms:"Not Applicable",source:"Web",webformUrl:noQueryLocationUrl,webformSubmissionTime:time,webformName:vm.formData.project,webformLanguage:vm.lang,testIndicator:vm.selligentData.testIndicator===!1?"N":"Y",firstName:vm.formData.firstName?vm.formData.firstName:"Not Applicable",lastName:vm.formData.lastName?vm.formData.lastName:"Not Applicable",existingCustomerFlag:0===parseInt(vm.formData.currentCustomer,10)?"N":"Y",primaryEmailAddress:vm.formData.email,primaryPhoneNumber:vm.formData.phone?vm.formData.phone:"Not Applicable",zipcode:vm.formData.zip?vm.formData.zip:"Not Applicable",marketingCommunicationOptIn:0===parseInt($scope.vm.formData.optin,10)?"N":"Y",audience:"Consumer",destination:"CRM",recordId:UUIDjs.create(4).toString(),keys:[]}]};angular.forEach(vm.formData.custom,function(value,key){eventRouterPayload.leadb2cmktEvents[0].keys.push({name:key,value:value})}),selligentUtils.createSelligentLead(vm.authToken,eventRouterPayload,"eventRouter",vm.eventOptions.urlEventRouter).then(onSuccessSelligent,onErrorSelligent)}function createSelligentPayload(){var locationUrl=$window.location.href,noQueryLocationUrl=locationUrl.slice(0,locationUrl.indexOf("?")),sellPayload={config:"prereg",operation:vm.selligentData.operation,userData:{Mail:vm.formData.email,PHONE_NUMBER:vm.formData.phone?""+vm.formData.phone.replace(/[- .●)(]/g,""):"",ZIP:vm.formData.zip?""+vm.formData.zip:"",FIRST_NAME:vm.formData.firstName?vm.formData.firstName:"",NAME:vm.formData.lastName?vm.formData.lastName:"",CUSTOMER:parseInt(vm.formData.currentCustomer,10),LANGUAGE:vm.lang,SUBSCRIBE_SOURCE:"Web"},triggerData:{},campaignData:{ACTIONID:"13",ACTIONCODE:"PREREG",PROJECT:vm.formData.project,MANUFACTURER:vm.formData.manufacturer,CODENAME:vm.formData.codename,OPTINTOMAINMARKETINGMAILS:parseInt($scope.vm.formData.optin,10),TEXT_OF_OPTIN_AGRMT:vm.formData.optinText,LEAD_CAPTURE_LOCATION:noQueryLocationUrl,MARKETING_PROGRAM:"Consumer"}};angular.forEach(vm.formData.custom,function(value,key){sellPayload.campaignData[key]=value}),_.merge(sellPayload.triggerData,vm.selligentData.triggerData),_.merge(sellPayload.campaignData,vm.selligentData.campaignData),selligentUtils.createSelligentLead(vm.authToken,sellPayload,"selligent",vm.eventOptions.urlSelligent).then(onSuccessSelligent,onErrorSelligent)}var vm=this;vm.selligentData={},vm.ppr={},vm.formData={},vm.settings={},vm.onInit=onInit,vm.submit=submit,vm.cleanPhone=cleanPhone}ProductPreRegisterController.$inject=["$scope","$window","$cookies","$log","selligentUtils"],angular.module("marketingCore").controller("ProductPreRegisterController",ProductPreRegisterController)}(window.angular),function(angular){"use strict";function validation(){function checkMinLength(length,value){return value.length>=length}function checkMaxLength(length,value){return value.length<=length}var PATTERNS={alpha:/^[a-zA-Z \-']*$/,email:/^\s*[\w\-+_]+(\.[\w\-+_]+)*@[\w\-+_]+\.[\w\-+_]+(\.[\w\-+_]+)*\s*$/,numeric:/^\d*$/,zip:/^(\d{5}-\d{4}|\d{5})$/,phoneNumber:/^\(?([0-9]{3})\)?[-.●]?([0-9]{3})[-.●]?([0-9]{4})$/},TESTS={email:function(value){return new RegExp(PATTERNS.email).test(value)},name:function(value){return new RegExp(PATTERNS.alpha).test(value)&&checkMaxLength(18,value)},phoneNumber:function(value){return new RegExp(PATTERNS.phoneNumber).test(value)&&checkMinLength(10,value)&&checkMaxLength(14,value)},required:function(value){return!!value},zip:function(value){return new RegExp(PATTERNS.zip).test(value)&&checkMinLength(5,value)&&checkMaxLength(5,value)}};return{validate:function(validationRule,value){return value||"required"===validationRule?TESTS[validationRule](value):!0}}}angular.module("marketingCore").service("validationService",validation)}(angular),function(angular){"use strict";function SocialMediaCarouselController($http,$sce,$log){function onInit(settings){maxItems=settings.maxItems?settings.maxItems:maxItems;var urlArr=[];urlArr.push("https://"),urlArr.push(settings.networkName),urlArr.push(".bootstrap.fyre.co/bs3/v3.1/"),urlArr.push(settings.networkName),urlArr.push(".fyre.co/"),urlArr.push(settings.siteId),urlArr.push("/"),urlArr.push(btoa(settings.articleId)),urlArr.push("/init"),$http({method:"GET",url:urlArr.join("")}).then(onSuccess,onError)}function toTrustedHtml(html){return $sce.trustAsHtml(html)}function buildItem(entry,authors){var item={};return item.id=entry.content.id,item.author="Twitter User",item.authorUrl="https://twitter.com",authors&&(item.author="@"+authors[entry.content.authorId].handle,item.authorUrl=authors[entry.content.authorId].profileUrl),item.bodyHtml="Tweet",entry.content&&entry.content.bodyHtml&&(item.bodyHtml=entry.content.bodyHtml),item}function onSuccess(response){if(response.data.headDocument.content&&response.data.headDocument.authors){socialContent=[];for(var responseContent=response.data.headDocument.content,responseAuthors=response.data.headDocument.authors,i=0;i<parseInt(maxItems,10);i++)if(responseContent[i].content&&1===responseContent[i].vis){var item=buildItem(responseContent[i],responseAuthors);socialContent.push(item)}vm.socialContent=socialContent}}function onError(response){$log.error("There was a problem with Livefyre request.")}var maxItems,socialContent=!1,vm=this;vm.slickConfig={infinite:!0,arrows:!1,accessibility:!1,focusOnSelect:!1,speed:600,useTransform:!0,cssEase:"ease",dots:!0,slidesToScroll:1,slidesToShow:1,lazyLoad:"ondemand",respondTo:"slider",responsive:[{breakpoint:640,settings:{variableWidth:!0,slidesToShow:2,centerMode:!0}}],method:{},event:{}},vm.onInit=onInit,vm.toTrustedHtml=toTrustedHtml}SocialMediaCarouselController.$inject=["$http","$sce","$log"],angular.module("marketingCore").controller("SocialMediaCarouselController",SocialMediaCarouselController)}(angular),function(angular,lodash){"use strict";function viewport($window,$document,$log){function calcBreakpoint(){currentWidth=$window.innerWidth||$document[0].body.clientWidth;var bp,tmpBreakpoint=!1;for(bp in breakpoints)if(breakpoints.hasOwnProperty(bp)){if(!(currentWidth>=breakpoints[bp]))break;tmpBreakpoint=bp}tmpBreakpoint!==currentBreakpoint&&(currentBreakpoint=tmpBreakpoint,lodash.forEach(breakpointCallbacks,function(callback){callback.apply(null,[currentBreakpoint,breakpoints[currentBreakpoint]])}),$log.info('Viewport: "'+currentBreakpoint+'", '+breakpoints[currentBreakpoint]+"px"))}function onBreakpointChange(callback,immediate){breakpointCallbacks.push(callback),immediate===!0&&callback(currentBreakpoint,breakpoints[currentBreakpoint])}function breakpointUp(bp){return breakpoints[currentBreakpoint]>=breakpoints[bp]}function breakpointDown(bp){return breakpoints[currentBreakpoint]<=breakpoints[bp]}function getCurrentBreakpoint(){return currentBreakpoint}var currentWidth,breakpoints={mobile:0,tablet:640,desktop:1024,"large-desktop":1280},currentBreakpoint=!1,breakpointCallbacks=[];return calcBreakpoint(),angular.element($window).on("resize",lodash.throttle(calcBreakpoint,100)),{onBreakpointChange:onBreakpointChange,breakpointUp:breakpointUp,breakpointDown:breakpointDown,getCurrentBreakpoint:getCurrentBreakpoint}}viewport.$inject=["$window","$document","$log"],angular.module("marketingCore").service("viewport",viewport)}(window.angular,window._),function(angular){"use strict";function SwitcherEmailPinController($scope,$log,$cookies,selligentUtils,salesforceUtils){function onInit(data,analyticsId){settings=data,vm.analyticsID=analyticsId,vm.switcher={},vm.switcher.authToken=settings.authToken,vm.switcher.offerText=settings.defaultOfferText,vm.view=vm.views.CAPTURE_EMAILPIN}function onSuccessSelligent(){vm.serviceError=!1,vm.view=vm.views.CONFIRM_EMAILPIN_SUBMISSION,$scope.$broadcast("emailSent",!0)}function onErrorSelligent(response){$log.error("error selligent call",response),vm.serviceError=!0}function submitEmailCapture(isValid){vm.submitted=!0,isValid?($scope.$broadcast("submitEmailCaptureValid",!0),payload={config:"switcher",userData:{sfid:vipId,Shopper_Pin__c:vipPin,Email:vm.formData.Email,Web_Submission_Time__c:(new Date).toISOString(),Last_Modified_Time__c:(new Date).toISOString()}},salesforceUtils.createSalesforceLead(vm.switcher.authToken,payload).then(onSuccessLeadUpdate,onErrorLeadUpdate)):$scope.$broadcast("valid",!1)}function onSuccessLeadUpdate(response){$scope.$broadcast("valid",!0),vm.serviceError=!1;var sellPayload={config:"switcher",userData:{Name:"Please Update",Mail:vm.formData.Email,StatusConfirmation:vm.formData.EmailConfirmation,SUBSCRIBE_SOURCE:"Web"},triggerData:{},campaignData:{ACTIONCODE:"SWITCHER",LEAD_CAPTURE_LOCATION:"https://www.t-mobile.com/switch-to-t-mobile",MARKETING_PROGRAM:"Consumer",PIN:vipPin,OFFER_TEXT:vm.switcher.offerText}};selligentUtils.createSelligentLead(vm.switcher.authToken,sellPayload,"","/bin/services/marketing/selligent").then(onSuccessSelligent,onErrorSelligent)}function onErrorLeadUpdate(response){$log.error("error updating lead ",response),$scope.$broadcast("valid",!1),vm.serviceError=!0}function sendPinStart(){$scope.$broadcast("sendPinStart",!0)}var settings,payload,vm=this,vipPin=$cookies.get("vipPinNumber"),vipId=$cookies.get("switcherId");vm.formData={},vm.OBCallFormData={},vm.view="",vm.views={CAPTURE_EMAILPIN:"captureEmailPIN",CONFIRM_EMAILPIN_SUBMISSION:"confirmEmailPinSubmission"},vm.onInit=onInit,vm.submitEmailCapture=submitEmailCapture,vm.sendPinStart=sendPinStart}SwitcherEmailPinController.$inject=["$scope","$log","$cookies","selligentUtils","salesforceUtils"],angular.module("marketingCore").controller("SwitcherEmailPinController",SwitcherEmailPinController)}(window.angular),function(angular,lodash){"use strict";function pageMetaDataControllerConstructor($scope,globalValue,commonServices,pageMetaDataUtils,mpLocalizationService,browseStateService,coreServices,toggleService){function generateMeta(){$rootScope.$broadcast("BROWSE_FILTER_INJECT",{data:vm.data})}function getAuthorValue(pattern,defaultValue,updateFn){return updateFn(lodash.get(globalValue.authorValue,pattern,defaultValue))}function replaceStateVariable(input){return lodash.isNil(input)?"":input.replace("{state}",angular.uppercase($stateParams.state))}function replaceStateCityVariable(input){return lodash.isNil(input)?"":input.replace("{state}",angular.uppercase($stateParams.state)).replace("{city}",$filter("denormalize")($stateParams.city))}var vm=this,$stateParams=commonServices.$stateParams,$location=commonServices.$location,$rootScope=commonServices.$rootScope,$log=commonServices.$log,$filter=commonServices.$filter;vm.data={keywords:"",keywords1:"",keywords2:"",description:"",canonicalUrl:"",pageTitle:"",language:void 0},$scope.$on("SL_SEO_UPDATE",function(){$log.log("SL_SEO_UPDATE! PageMetaDataController");var metadata,language=null===mpLocalizationService.getCookie("MP_LANG")?"en":mpLocalizationService.getCookie("MP_LANG");if(lodash.isEmpty($stateParams.storeName)){if(lodash.isEmpty($stateParams.city)){if(lodash.isEmpty($stateParams.state))return;metadata={encanonicalUrl:"https://www.t-mobile.com/store-locator/"+$stateParams.state,enpageTitle:getAuthorValue("storeauthoring.seo.state.english.title","",replaceStateVariable),endescription:getAuthorValue("storeauthoring.seo.state.english.description","",replaceStateVariable),enkeywords:getAuthorValue("storeauthoring.seo.state.english.keywords","",replaceStateVariable),escanonicalUrl:"https://es.t-mobile.com/store-locator/"+$stateParams.state,espageTitle:getAuthorValue("storeauthoring.seo.state.spanish.title","",replaceStateVariable),esdescription:getAuthorValue("storeauthoring.seo.state.spanish.description","",replaceStateVariable),eskeywords:getAuthorValue("storeauthoring.seo.state.spanish.keywords","",replaceStateVariable),language:language}}else metadata={encanonicalUrl:"https://www.t-mobile.com/store-locator/"+$stateParams.state+"/"+$stateParams.city,enpageTitle:getAuthorValue("storeauthoring.seo.city.english.title","",replaceStateCityVariable),endescription:getAuthorValue("storeauthoring.seo.city.english.description","",replaceStateCityVariable),enkeywords:getAuthorValue("storeauthoring.seo.city.english.keywords","",replaceStateCityVariable),escanonicalUrl:"https://es.t-mobile.com/store-locator/"+$stateParams.state+"/"+$stateParams.city,espageTitle:getAuthorValue("storeauthoring.seo.city.spanish.title","",replaceStateCityVariable),esdescription:getAuthorValue("storeauthoring.seo.city.spanish.description","",replaceStateCityVariable),eskeywords:getAuthorValue("storeauthoring.seo.city.spanish.keywords","",replaceStateCityVariable),language:language};lodash.merge(vm.data,metadata),vm.generateMeta()}}),$scope.$on("$stateChangeSuccess",function(){$log.log("$stateChangeSuccess! PageMetaDataController"),$rootScope.$broadcast("SL_SEO_UPDATE",{}),lodash.merge(vm.data,pageMetaDataUtils.getViewMetaData(globalValue.authorValue)),vm.generateMeta()}),$scope.$on("BROWSE_FILTER_UPDATED",function(event,data){$log.log("BROWSE_FILTER_UPDATED! PageMetaDataController");var defaultData,seoData,browseUrl,routeData,pageRoot,productType,seoDataFilter,browseCategory,endefaultCanonicalUrl,esdefaultCanonicalUrl,language=null===mpLocalizationService.getCookie("MP_LANG")?"en":mpLocalizationService.getCookie("MP_LANG");if(browseCategory=$stateParams.browseCategory,pageRoot=browseCategory?$stateParams.browseCategory.replace(/.html/,""):void 0,pageRoot=angular.isDefined(data.store)&&!pageRoot?"store":pageRoot,("cell-phones"===pageRoot||"internet-devices"===pageRoot||"accessories"===pageRoot)&&pageMetaDataUtils.getSeoData().then(function(seoDataResponse){seoData=seoDataResponse,productType=browseStateService.getProductCategoryType(pageRoot),routeData=browseStateService.getAuthoredData(productType);var defaultUrl="https://www.t-mobile.com"+$location.path().replace(".html","");if(endefaultCanonicalUrl=defaultUrl,esdefaultCanonicalUrl=defaultUrl,"en"!==language&&(esdefaultCanonicalUrl=$location.$$host.contains("business")?$location.$$protocol+"://"+language+".business.t-mobile.com"+$location.path().replace(".html",""):defaultUrl.replace("www.",language+".")),defaultData={encanonicalUrl:endefaultCanonicalUrl,enkeywords:pageRoot,enpageTitle:routeData.title,endescription:routeData.description,escanonicalUrl:esdefaultCanonicalUrl,eskeywords:pageRoot,espageTitle:routeData.spanishTitle,esdescription:routeData.spanishDescription,language:language},browseUrl=$location.path().replace(".html",""),browseUrl&&seoData){var keepIterating=!0;angular.forEach(seoData,function(seoDataObj){keepIterating&&seoDataObj.browseType===pageRoot&&browseUrl.contains(seoDataObj.url)&&(endefaultCanonicalUrl=seoDataObj.seoData.canonicalUrl,esdefaultCanonicalUrl=seoDataObj.seoData.canonicalUrl,"en"!==language&&(seoDataObj.seoData.canonicalUrl.contains("//es.")||(esdefaultCanonicalUrl=seoDataObj.seoData.canonicalUrl.contains("www.")?seoDataObj.seoData.canonicalUrl.replace("www.","es."):[seoDataObj.seoData.canonicalUrl.slice(0,seoDataObj.seoData.canonicalUrl.lastIndexOf("//")+2),"es.",seoDataObj.seoData.canonicalUrl.slice(defaultUrl.lastIndexOf("//")+2)].join(""))),seoDataFilter={encanonicalUrl:endefaultCanonicalUrl,enpageTitle:seoDataObj.seoData.title.en,endescription:seoDataObj.seoData.description.en,enkeywords:seoDataObj.seoData.keywords.en,escanonicalUrl:esdefaultCanonicalUrl,espageTitle:seoDataObj.seoData.title.es,esdescription:seoDataObj.seoData.description.es,eskeywords:seoDataObj.seoData.keywords.es,language:language},keepIterating=!1)})}if(!seoDataFilter&&(1===lodash.size(data.queryParams)||2===lodash.size(data.queryParams)&&"sort"in data.queryParams)&&data.filters&&1===data.filters.length){var label=pageMetaDataUtils.decodeEntities(data.filters[0].label),entitle=lodash.get(globalValue.authorValue.page,"filterTitle"),enkeywords=lodash.get(globalValue.authorValue.page,"filterKeywords"),endescription=lodash.get(globalValue.authorValue.page,"filterDescription"),estitle=lodash.get(globalValue.authorValue.page,"spanishFilterTitle"),eskeywords=lodash.get(globalValue.authorValue.page,"spanishFilterKeywords"),esdescription=lodash.get(globalValue.authorValue.page,"spanishFilterDescription");entitle=entitle?entitle.replace("{filter}",label):defaultData.enpageTitle,enkeywords=enkeywords?enkeywords.replace("{filter}",label):defaultData.enkeywords,endescription=endescription?endescription.replace("{filter}",label):defaultData.endescription,estitle=estitle?estitle.replace("{filter}",label):defaultData.espageTitle,eskeywords=eskeywords?eskeywords.replace("{filter}",label):defaultData.eskeywords,esdescription=esdescription?esdescription.replace("{filter}",label):defaultData.esdescription,endefaultCanonicalUrl="https://www.t-mobile.com"+$location.path().replace(".html",""),esdefaultCanonicalUrl="https://es.t-mobile.com"+$location.path().replace(".html",""),seoDataFilter={encanonicalUrl:endefaultCanonicalUrl,enpageTitle:entitle,endescription:endescription,enkeywords:enkeywords,escanonicalUrl:esdefaultCanonicalUrl,espageTitle:estitle,esdescription:esdescription,eskeywords:eskeywords,language:language}}lodash.merge(vm.data,angular.isDefined(seoDataFilter)?seoDataFilter:defaultData),vm.generateMeta()}),"store"===pageRoot){var meta={};if(""===data.store)endefaultCanonicalUrl="https://www.t-mobile.com/store-locator",esdefaultCanonicalUrl="https://es.t-mobile.com/store-locator",meta.entitle=lodash.get(globalValue.authorValue.storeauthoring.seo.SL.english,"title"),meta.enkeywords=lodash.get(globalValue.authorValue.storeauthoring.seo.SL.english,"keywords"),meta.endescription=lodash.get(globalValue.authorValue.storeauthoring.seo.SL.english,"description"),meta.estitle=lodash.get(globalValue.authorValue.storeauthoring.seo.SL.spanish,"title"),meta.eskeywords=lodash.get(globalValue.authorValue.storeauthoring.seo.SL.spanish,"keywords"),meta.esdescription=lodash.get(globalValue.authorValue.storeauthoring.seo.SL.spanish,"description");else{var storeType=data.store.type?data.store.type:"RETAIL";if("RETAIL"===storeType){var state=$filter("normalize")(data.store.location.address.addressRegion),city=$filter("normalize")(data.store.location.address.addressLocality),storeName=$filter("normalize")(data.store.name);lodash.get(toggleService.model,"toggles.isSprintStoresEnabled",!1)?data.store.hasSprintStack&&!data.store.hasTmobileStack?(meta.entitle=lodash.get(globalValue.authorValue.storeauthoring.seo.sprintOnlyStore.english,"title"),meta.enkeywords=lodash.get(globalValue.authorValue.storeauthoring.seo.sprintOnlyStore.english,"keywords"),meta.endescription=lodash.get(globalValue.authorValue.storeauthoring.seo.sprintOnlyStore.english,"description"),meta.estitle=lodash.get(globalValue.authorValue.storeauthoring.seo.sprintOnlyStore.spanish,"title"),meta.eskeywords=lodash.get(globalValue.authorValue.storeauthoring.seo.sprintOnlyStore.spanish,"keywords"),meta.esdescription=lodash.get(globalValue.authorValue.storeauthoring.seo.sprintOnlyStore.spanish,"description")):data.store.hasSprintStack&&data.store.hasTmobileStack?data.store.deviceRepair?(meta.entitle=lodash.get(globalValue.authorValue.storeauthoring.seo.dualRepairStore.english,"title"),meta.enkeywords=lodash.get(globalValue.authorValue.storeauthoring.seo.dualRepairStore.english,"keywords"),meta.endescription=lodash.get(globalValue.authorValue.storeauthoring.seo.dualRepairStore.english,"description"),meta.estitle=lodash.get(globalValue.authorValue.storeauthoring.seo.dualRepairStore.spanish,"title"),meta.eskeywords=lodash.get(globalValue.authorValue.storeauthoring.seo.dualRepairStore.spanish,"keywords"),meta.esdescription=lodash.get(globalValue.authorValue.storeauthoring.seo.dualRepairStore.spanish,"description")):(meta.entitle=lodash.get(globalValue.authorValue.storeauthoring.seo.dualStore.english,"title"),meta.enkeywords=lodash.get(globalValue.authorValue.storeauthoring.seo.dualStore.english,"keywords"),meta.endescription=lodash.get(globalValue.authorValue.storeauthoring.seo.dualStore.english,"description"),meta.estitle=lodash.get(globalValue.authorValue.storeauthoring.seo.dualStore.spanish,"title"),meta.eskeywords=lodash.get(globalValue.authorValue.storeauthoring.seo.dualStore.spanish,"keywords"),meta.esdescription=lodash.get(globalValue.authorValue.storeauthoring.seo.dualStore.spanish,"description")):(meta.entitle=lodash.get(globalValue.authorValue.storeauthoring.seo.tmoStore.english,"title"),meta.enkeywords=lodash.get(globalValue.authorValue.storeauthoring.seo.tmoStore.english,"keywords"),meta.endescription=lodash.get(globalValue.authorValue.storeauthoring.seo.tmoStore.english,"description"),meta.estitle=lodash.get(globalValue.authorValue.storeauthoring.seo.tmoStore.spanish,"title"),meta.eskeywords=lodash.get(globalValue.authorValue.storeauthoring.seo.tmoStore.spanish,"keywords"),meta.esdescription=lodash.get(globalValue.authorValue.storeauthoring.seo.tmoStore.spanish,"description")):(meta.entitle=lodash.get(globalValue.authorValue.storeauthoring.seo.tmoStore.english,"title"),meta.enkeywords=lodash.get(globalValue.authorValue.storeauthoring.seo.tmoStore.english,"keywords"),meta.endescription=lodash.get(globalValue.authorValue.storeauthoring.seo.tmoStore.english,"description"),meta.estitle=lodash.get(globalValue.authorValue.storeauthoring.seo.tmoStore.spanish,"title"),meta.eskeywords=lodash.get(globalValue.authorValue.storeauthoring.seo.tmoStore.spanish,"keywords"),meta.esdescription=lodash.get(globalValue.authorValue.storeauthoring.seo.tmoStore.spanish,"description")),endefaultCanonicalUrl="https://www.t-mobile.com/store-locator/"+state+"/"+city+"/"+storeName,esdefaultCanonicalUrl="https://es.t-mobile.com/store-locator/"+state+"/"+city+"/"+storeName}else"National Retail"===storeType?(meta.entitle=lodash.get(globalValue.authorValue.storeauthoring.seo.authDealer.english,"title"),meta.enkeywords=lodash.get(globalValue.authorValue.storeauthoring.seo.authDealer.english,"keywords"),meta.endescription=lodash.get(globalValue.authorValue.storeauthoring.seo.authDealer.english,"description"),meta.estitle=lodash.get(globalValue.authorValue.storeauthoring.seo.authDealer.spanish,"title"),meta.eskeywords=lodash.get(globalValue.authorValue.storeauthoring.seo.authDealer.spanish,"keywords"),meta.esdescription=lodash.get(globalValue.authorValue.storeauthoring.seo.authDealer.spanish,"description"),endefaultCanonicalUrl="https://www.t-mobile.com/store-locator",esdefaultCanonicalUrl="https://es.t-mobile.com/store-locator"):(endefaultCanonicalUrl="https://www.t-mobile.com/store-locator",esdefaultCanonicalUrl="https://es.t-mobile.com/store-locator");lodash.forEach(meta,function(item,key){if(meta[key]=item,item){var resultItem=item.replace("{city}",lodash.get(data.store,"location.address.addressLocality"));resultItem=resultItem.replace("{store_name}",data.store.name),resultItem=resultItem.replace("{state}",lodash.get(data.store,"location.address.addressRegion")),resultItem=resultItem.replace("{store_type}",data.store.type),resultItem=resultItem.replace("{phone_number}",data.store.telephone),resultItem=resultItem.replace("{address}",lodash.get(data.store,"location.address.streetAddress")),meta[key]=resultItem}})}seoDataFilter={encanonicalUrl:endefaultCanonicalUrl,enpageTitle:lodash.get(meta,"entitle",""),endescription:lodash.get(meta,"endescription",""),enkeywords:lodash.get(meta,"enkeywords",""),escanonicalUrl:esdefaultCanonicalUrl,espageTitle:lodash.get(meta,"estitle",""),esdescription:lodash.get(meta,"esdescription",""),eskeywords:lodash.get(meta,"eskeywords",""),language:language},lodash.merge(vm.data,seoDataFilter),vm.generateMeta()}}),vm.generateMeta=generateMeta}pageMetaDataControllerConstructor.$inject=["$scope","globalValue","commonServices","pageMetaDataUtils","mpLocalizationService","browseStateService","coreServices","toggleService"],angular.module("tmobileApp").controller("PageMetaDataController",pageMetaDataControllerConstructor)}(angular,_),function(angular){"use strict";function SwitcherTeaserController($scope,$cookies){function onInit(data){vm.analyticsID=data.analyticsID,vm.hideSprint=data.hideSprint,vm.hasSwitcherCookies=selectedCarrier&&vipPin&&savings,vm.hasSavings=hasSavings,vm.carrier=selectedCarrier,vm.locationCarrier=locationCarrier,vm.locationLines=locationLines,vm.locationCost=locationCost,vm.isVerizon="Verizon"===selectedCarrier,vm.isAtt="AT&T"===selectedCarrier,vm.isSprint="Sprint"===selectedCarrier,vm.isOtherCarrier="Other"===selectedCarrier,vm.vipPin=vipPin,vm.savings=savings,vm.view="start",vm.hasSavings&&("true"===vm.hideSprint&&vm.isSprint?vm.view="start":vm.view="personalized"),vm.isSprint&&"true"===vm.hideSprint&&(vm.view="start",selectedCarrier=$cookies.remove("selectedCarrier",{path:"/"}),locationCarrier=$cookies.remove("locationCarrier",{path:"/"}),locationLines=$cookies.remove("locationLines",{path:"/"}),locationCost=$cookies.remove("locationCost",{path:"/"}),vipPin=$cookies.remove("vipPinNumber",{path:"/"}),
savings=$cookies.remove("savings",{path:"/"}),hasSavings=$cookies.remove("hasSavings",{path:"/"}))}var vm=this,selectedCarrier=$cookies.get("selectedCarrier"),locationCarrier=$cookies.get("locationCarrier"),locationLines=$cookies.get("locationLines"),locationCost=$cookies.get("locationCost"),vipPin=$cookies.get("vipPinNumber"),savings=$cookies.get("savings"),hasSavings=$cookies.get("hasSavings");vm.onInit=onInit}SwitcherTeaserController.$inject=["$scope","$cookies"],angular.module("marketingCore").controller("SwitcherTeaserController",SwitcherTeaserController)}(window.angular),function(angular,externalLogger,lodash){"use strict";function pageMetaDataUtilsFn($q,commonServices,mpLocalizationService,browseStateService,productDetailsService,detailStateService,$http,apiURLs){function init(authorData){seoGlobalAuthorData={phone:{seoTitle:authorData.seoCellPhonesTitle,seoDescription:authorData.seoCellPhonesDescription,seoKeyWords:authorData.seoCellPhonesKeyWords,seoTitleSpanish:authorData.spanishseoCellPhonesTitle,seoDescriptionSpanish:authorData.spanishseoCellPhonesDescription,seoKeyWordsSpanish:authorData.spanishseoCellPhonesKeyWords},"internet-device":{seoTitle:authorData.seoInternetDevicesTitle,seoDescription:authorData.seoInternetDevicesDescription,seoKeyWords:authorData.seoInternetDevicesKeyWords,seoTitleSpanish:authorData.spanishseoInternetDevicesTitle,seoDescriptionSpanish:authorData.spanishseoInternetDevicesDescription,seoKeyWordsSpanish:authorData.spanishseoInternetDevicesKeyWords},accessory:{seoTitle:authorData.seoAccessoriesTitle,seoDescription:authorData.seoAccessoriesDescription,seoKeyWords:authorData.seoAccessoriesKeyWords,seoTitleSpanish:authorData.spanishseoAccessoriesTitle,seoDescriptionSpanish:authorData.spanishseoAccessoriesDescription,seoKeyWordsSpanish:authorData.spanishseoAccessoriesKeyWords}}}function updateSeoMetaData(routeData,productType,$stateParams){var newRouteData=seoGlobalAuthorData[productType];return routeData.title=angular.isUndefined(routeData.title)||""===routeData.title.trim()?angular.isUndefined(newRouteData.seoTitle)||""===newRouteData.seoTitle?$stateParams.productName.replace(/(.html)|(-)/g," "):newRouteData.seoTitle.replace("{ProductName}",$stateParams.productName.replace(/(.html)|(-)/g," ")):routeData.title,routeData.description=angular.isUndefined(routeData.description)||""===routeData.description.trim()?angular.isDefined(newRouteData.seoDescription)?newRouteData.seoDescription.replace("{ProductName}",$stateParams.productName.replace(/(.html)|(-)/g," ")):"":routeData.description,routeData.keywords=parseMultiKeywordsTags(newRouteData.seoKeyWords),routeData}function updateSpanishSeoMetaData(routeData,productType,$stateParams){var newRouteData=seoGlobalAuthorData[productType];return routeData.spanishTitle=angular.isUndefined(routeData.spanishTitle)||""===routeData.spanishTitle.trim()?angular.isUndefined(newRouteData.seoTitleSpanish)||""===newRouteData.seoTitleSpanish?routeData.title:newRouteData.seoTitleSpanish.replace("{ProductName}",$stateParams.productName.replace(/(.html)|(-)/g," ")):routeData.spanishTitle,routeData.spanishDescription=angular.isUndefined(routeData.spanishDescription)||""===routeData.spanishDescription.trim()?angular.isDefined(newRouteData.seoDescriptionSpanish)?newRouteData.seoDescriptionSpanish.replace("{ProductName}",$stateParams.productName.replace(/(.html)|(-)/g," ")):"":routeData.spanishDescription,routeData.spanishKeyword=angular.isUndefined(routeData.spanishKeyword)||""===routeData.spanishKeyword.trim()?angular.isDefined(newRouteData.seoKeyWordsSpanish)?parseMultiKeywordsTags(newRouteData.seoKeyWordsSpanish):"":routeData.spanishKeyword,routeData}function parseMultiKeywordsTags(keywords){if(angular.isDefined(keywords)){for(var i=0;i<keywords.length;i++)newKeyword[i]=keywords[i].split(":")[1];return newKeyword.toString()}return""}function formatTime(timeStamp){return Math.floor(timeStamp/1e3)+"."+timeStamp%1e3}function getViewMetaData(authorValue){var pageRoot,routeData,productType;if(detailStateService.isMyState($state.current)){if(pageRoot=$stateParams.detailCategory.replace(/.html/,""),productType=detailStateService.getProductCategoryType(pageRoot),routeData=detailStateService.getAuthoredData(productType,$stateParams.productName),angular.isUndefined(authorValue.rootPage)){var authorDataValue=productDetailsService.model.authorValue;init(authorDataValue.rootPage.PDPAuthoring)}else init(authorValue.rootPage.PDPAuthoring);routeData=updateSpanishSeoMetaData(routeData,productType,$stateParams),routeData=updateSeoMetaData(routeData,productType,$stateParams)}else browseStateService.isMyState($state.current)?(pageRoot=$stateParams.browseCategory.replace(/.html/,""),productType=browseStateService.getProductCategoryType(pageRoot),routeData=browseStateService.getAuthoredData(productType)):routeData="store-locator"===$state.current.name?angular.isDefined($state.params.storeName)&&null!=$state.params.storeName?{keywords:lodash.get(authorValue,"rootPage.seo.tmoStore.english.keywords"),title:lodash.get(authorValue,"rootPage.seo.tmoStore.english.title"),description:lodash.get(authorValue,"rootPage.seo.tmoStore.english.description"),spanishKeyword:lodash.get(authorValue,"rootPage.seo.tmoStore.spanish.keywords"),spanishTitle:lodash.get(authorValue,"rootPage.seo.tmoStore.spanish.title"),spanishDescription:lodash.get(authorValue,"rootPage.seo.tmoStore.spanish.description")}:{keywords:lodash.get(authorValue,"rootPage.seo.SL.english.keywords"),title:lodash.get(authorValue,"rootPage.seo.SL.english.title"),description:lodash.get(authorValue,"rootPage.seo.SL.english.description"),spanishKeyword:lodash.get(authorValue,"rootPage.seo.SL.spanish.keywords"),spanishTitle:lodash.get(authorValue,"rootPage.seo.SL.spanish.title"),spanishDescription:lodash.get(authorValue,"rootPage.seo.SL.spanish.description")}:$state.current.data;routeData=routeData||{},(angular.isUndefined(routeData.canonicalUrl)||""===routeData.canonicalUrl)&&(lodash.isEmpty($stateParams.operation)?routeData.canonicalUrl=$location.protocol()+"://www.t-mobile.com"+$location.path():routeData.canonicalUrl="https://www.t-mobile.com/store-locator/"+$stateParams.state+"/"+$stateParams.city+"/"+$stateParams.storeName);var esCanonical=routeData.canonicalUrl.replace("www.",""),tmpCanonicalUrl=[esCanonical.slice(0,esCanonical.lastIndexOf("//")+2),"es.",esCanonical.slice(esCanonical.lastIndexOf("//")+2)].join("");return{encanonicalUrl:routeData.canonicalUrl,enkeywords:routeData.keywords,enpageTitle:routeData.title,endescription:routeData.description,escanonicalUrl:tmpCanonicalUrl,eskeywords:routeData.spanishKeyword,espageTitle:routeData.spanishTitle,esdescription:routeData.spanishDescription}}function getSeoData(){var startLoading,url,deferLoadingRoutes;return deferLoadingRoutes=$q.defer(),startLoading=Date.now(),url=apiURLs.getSeoData,$http.get(url).then(function(response){var finishedLoading=Date.now();return externalLogger.info("%c getSeoData loaded in %s seconds",externalLogger.css.boldBlackOnOrange,formatTime(finishedLoading-startLoading)),deferLoadingRoutes.resolve(response.data),response.data})["catch"](function(response){externalLogger.error("get Seo Data could not be loaded from "+url,response),deferLoadingRoutes.reject(response)})}function decodeEntities(encodedString){var textArea=document.createElement("textarea");return textArea.innerHTML=encodedString,textArea.value}var seoGlobalAuthorData,$state=commonServices.$state,$stateParams=commonServices.$stateParams,$location=commonServices.$location,newKeyword=[];return{getSeoData:getSeoData,getViewMetaData:getViewMetaData,decodeEntities:decodeEntities}}pageMetaDataUtilsFn.$inject=["$q","commonServices","mpLocalizationService","browseStateService","productDetailsService","detailStateService","$http","apiURLs"],angular.module("tmobileApp").factory("pageMetaDataUtils",pageMetaDataUtilsFn)}(angular,externalLogger,window._),function(angular){"use strict";function TimelineCarouselController($scope){$scope.slickConfigForegroundCarousel={infinite:!1,accessibility:!0,focusOnSelect:!1,speed:300,cssEase:"ease",slidesToScroll:1,variableWidth:!0,arrows:!1,respondTo:"slider",swipe:!1,method:{},event:{},responsive:[{breakpoint:1023,settings:{focusOnSelect:!0,swipe:!0}},{breakpoint:639,settings:{focusOnSelect:!0,swipe:!0}}]}}TimelineCarouselController.$inject=["$scope"],angular.module("marketingCore").controller("TimelineCarouselController",TimelineCarouselController)}(angular),function(angular){"use strict";function BrowseControllerConstructor($scope,commonServices,cartHttpDataService,creditClassService,globalValue,toggleService){var vm=this,$log=commonServices.$log;vm.model={},vm.model.creditDataValues=globalValue,vm.toggle=toggleService.model.toggles;var searchObject=commonServices.$location.search();if("ncc"===searchObject.credit){var creditClass=vm.model.creditDataValues.authorValue.rootPage.creditClassSelector["class"][2];angular.isString(creditClass)&&!_.isEmpty(creditClass)&&(creditClass=JSON.parse(creditClass)),creditClassService.setCreditClass(creditClass),cartHttpDataService.saveCreditLevel(creditClass,function(){})}$log.log("Browse Controller is initializing "+$scope.$id)}BrowseControllerConstructor.$inject=["$scope","commonServices","cartHttpDataService","creditClassService","globalValue","toggleService"],angular.module("tmobileBrowse").controller("BrowseController",BrowseControllerConstructor)}(window.angular),function(angular){"use strict";function tsmodalWindowController($scope,$modalInstance,modalData,tsOfferSignupAnalytics){var vm=this;vm.model=modalData,vm.addressValidationModal=modalData.validationModal.addressValidationModal,vm.addresses=null===modalData.addressResponse?[]:modalData.addressResponse,vm.selectedAddress=vm.addresses[0],vm.addressHeadlineTxt=vm.model.authoringData.suggestedAddressModalHeading,vm.suggested=vm.model.authoringData.suggestedAddressModalBody,vm.addressHeadlineTxtParagraph=vm.model.authoringData.suggestedAddressModalText,vm.phoneValidationModal=modalData.validationModal.phoneValidationModal,vm.phoneHeadline=vm.model.authoringData.currentCustomerModalHeading,vm.phoneHeadlineText=vm.model.authoringData.currentCustomerModalBody,vm.phoneHeadlineTextExpanded=vm.model.authoringData.currentCustomerModalText,vm.zipValidationModal=modalData.validationModal.zipValidationModal,vm.zipHeadline=vm.model.authoringData.zipCodeModalHeading,vm.zipHeadlineText=vm.model.authoringData.zipCodeModalBody,vm.zipHeadlineTextExpanded=vm.model.authoringData.zipCodeModalText,vm.alreadyOrdered=modalData.validationModal.alreadyOrderedModal,vm.alreadyOrderedModalHeading=vm.model.authoringData.alreadyOrderedModalHeading,vm.alreadyOrderedModalBody=vm.model.authoringData.alreadyOrderedModalBody,vm.alreadyOrderedModalText=vm.model.authoringData.alreadyOrderedModalText,vm.errorModal=modalData.validationModal.errorModal,vm.errorHeadlineText=vm.model.authoringData.invalidAddressErrorText,vm.zipCodeInclusionFilePath=vm.model.authoringData.zipCodeInclusion,vm.opened=$modalInstance.opened,vm.result=$modalInstance.result,vm.modalTarget=$modalInstance.target,vm.dismiss=function(event){event&&event.preventDefault(),$scope.$parent.vm.isCloseButtonClicked=!0,$scope.$parent.vm.clearForm(),$modalInstance.dismiss(),tsOfferSignupAnalytics.formClose()},vm.ok=function(selectedAddress,formData,event){event&&event.preventDefault(),$scope.$parent.vm.updateForm(selectedAddress),$scope.$parent.vm.clearForm(),$modalInstance.close(),$scope.$parent.vm.v2ApiToggle?$scope.$parent.vm.orderSubmitV2():$scope.$parent.vm.alreadyCustomer()}}function tsOfferSignupController($log,$scope,$modal,marketingConstants,tsOfferSignup,tsOfferSignupAnalytics,apiURLs){function switchPhoneModal(response,validation){if(response&&""!==response&&validation.phone===!0){var checkPhoneResponse=angular.isUndefined(response.istmocustomer)?"responseError":angular.equals(response.istmocustomer,"true");switch(checkPhoneResponse){case!1:vm.spinner=tsOfferSignup.setSpinner(!1),tsOfferSignup.model.phoneResponse=response;break;case!0:tsOfferSignup.model.validationModal.phoneValidationModal=!0,tsOfferSignup.model.phoneResponse=response,openModal();break;case"responseError":tsOfferSignup.model.phoneErrorResponse=angular.isUndefined(response.responseError)?{}:response.responseError[0],tsOfferSignup.model.validationModal.errorModal=!0,openModal(),tsOfferSignupAnalytics.errorModal(tsOfferSignup.model.phoneErrorResponse)}}}function switchAdressModal(response,validation){if(response&&""!==response&&validation.submit.$valid===!0){var checkAddressResponse=angular.isUndefined(response.addresses)?"responseError":angular.equals(response.success,!0);switch(checkAddressResponse){case!1:tsOfferSignup.model.addressResponse=response.addresses,tsOfferSignup.model.validationModal.addressValidationModal=!0,openModal();break;case!0:tsOfferSignup.model.addressResponse=response.addresses,tsOfferSignup.model.validationModal.addressValidationModal=!0,openModal();break;case"responseError":tsOfferSignup.model.addressErrorResponse=angular.isDefined(response.responseError)?response.responseError:{},tsOfferSignup.model.validationModal.errorModal=!0,openModal(),tsOfferSignupAnalytics.errorModal(tsOfferSignup.model.addressErrorResponse)}}}function openModal(){vm.spinner=tsOfferSignup.setSpinner(!1),vm.isCloseButtonClicked=!1,vm.modalInstance=$modal.open({controller:tsmodalWindowController,controllerAs:"vm",templateUrl:"app/marketing/controllers/tsOfferSignup/tsOfferSignupModal.html",scope:$scope,resolve:{modalData:function(){return vm.model}}}),tsOfferSignupAnalytics.formOpen(),vm.modalInstance.result["catch"](function(){vm.clearForm(),vm.isCloseButtonClicked||tsOfferSignupAnalytics.formClose()})}function validImeiNumber(value){if(/[^0-9-\s]+/.test(value))return!1;for(var nCheck=0,nDigit=0,bEven=!1,imeiNumberEnter=value.replace(/\D/g,""),n=imeiNumberEnter.length-1;n>=0;n--){var cDigit=imeiNumberEnter.charAt(n);nDigit=parseInt(cDigit,10),bEven&&(nDigit*=2)>9&&(nDigit-=9),nCheck+=nDigit,bEven=!bEven}return nCheck%10===0}var vm=this;vm.success=!1,vm.isCloseButtonClicked=!1,vm.formStarted=!1,vm.spinner=tsOfferSignup.setSpinner(!1),vm.formData={tsDeviceExists:"false"},vm.exist=!0,vm.tsOfferSignupForm={},vm.states=marketingConstants.states,vm.model=tsOfferSignup.model,vm.eligibilityURL="/bin/eligibility",vm.initiateForm=function(){vm.formStarted||(vm.formStarted=!0,tsOfferSignupAnalytics.formStart())},vm.onInit=function(data,analyticsID,v2ApiToggle){vm.authToken=data.authToken,vm.analyticsID=analyticsID,tsOfferSignup.model.authoringData=data,vm.formData.optinText=data.optInText,vm.formData.project=data.project,vm.formData.optin="false",vm.formData.tsDeviceExists="false",vm.v2ApiToggle=v2ApiToggle},vm.zipCode=function(zipCodeValid,zipCode,event){if(event&&event.preventDefault(),5===zipCode.length&&zipCodeValid){vm.spinner=tsOfferSignup.setSpinner(!0);var zipcodeInclusionList=angular.isUndefined(tsOfferSignup.model.zipCodeResponse)?[]:tsOfferSignup.model.zipCodeResponse;vm.exist=_.includes(zipcodeInclusionList,zipCode),vm.exist||(tsOfferSignup.model.validationModal.zipValidationModal=!0,openModal()),vm.spinner=tsOfferSignup.setSpinner(!1)}},vm.validatePhone=function(isPhoneValid,phoneNumber,event){if(event&&event.preventDefault(),10===event.currentTarget.value.length&&isPhoneValid){vm.spinner=tsOfferSignup.setSpinner(!0);var data={MSISDN:phoneNumber,ValidateMSISDN:"true"};tsOfferSignup.getTsData(data,vm.eligibilityURL,vm.authToken).then(function(responsePhoneValidation){if($log.log("Phone Validation Done"),responsePhoneValidation){var isPhoneValidArg={phone:isPhoneValid};switchPhoneModal(responsePhoneValidation,isPhoneValidArg)}})}},vm.imeiValidation=function(imeiformdata,imeiValue,event){event&&event.preventDefault(),validImeiNumber(imeiValue)?imeiformdata.imei.$setValidity("imei",!0):imeiformdata.imei.$setValidity("imei",!1)},vm.submit=function(isSubmitValid,submitFormData,event){if(event&&event.preventDefault(),"State"===submitFormData.savedState?isSubmitValid.$setValidity("state",!1):isSubmitValid.$setValidity("state",!0),vm.submitted=!0,isSubmitValid.$valid){vm.spinner=tsOfferSignup.setSpinner(!0),tsOfferSignupAnalytics.clickToAction("clickToNavigate"),tsOfferSignup.model.formData=submitFormData;var data={addressline1:submitFormData.address1,addressline2:submitFormData.address2,cityname:submitFormData.city,statecode:submitFormData.savedState,postalcode:submitFormData.zip,ValidateAddress:"true",optin:submitFormData.optin,IMEI:angular.isDefined(vm.formData.imei)?vm.formData.imei:"",hasdevice:angular.isDefined(submitFormData.tsDeviceExists)?submitFormData.tsDeviceExists:"false"};tsOfferSignup.getTsData(data,vm.eligibilityURL).then(function(response){var isSubmitValidArg={submit:isSubmitValid};switchAdressModal(response,isSubmitValidArg),vm.exist=void 0})}},vm.alreadyCustomer=function(){vm.spinner=tsOfferSignup.setSpinner(!0);var data={firstname:vm.formData.firstName,lastname:vm.formData.lastName,MSISDN:vm.formData.phone,addressline1:vm.formData.address1,addressline2:vm.formData.address2,cityname:vm.formData.city,statecode:vm.formData.savedState,postalcode:vm.formData.zip,InterestedinTFB:vm.formData.optin,email:vm.formData.email,IMEI:angular.isDefined(vm.formData.imei)?vm.formData.imei:"",hasdevice:angular.isDefined(vm.formData.tsDeviceExists)?vm.formData.tsDeviceExists:"false"},url="/bin/orderSubmit";tsOfferSignup.getTsData(data,url).then(function(responseSubmitValidation){if($log.log("Submit order validation initiated"),responseSubmitValidation)switch(responseSubmitValidation.response.returnCode){case 0:vm.success=!0,vm.spinner=tsOfferSignup.setSpinner(!1),vm.formStarted=!1,tsOfferSignupAnalytics.formComplete(vm.formData.tsDeviceExists,vm.formData.optin);break;case 121:tsOfferSignup.model.validationModal.alreadyOrderedModal=!0,openModal();break;default:tsOfferSignup.model.validationModal.errorModal=!0,openModal()}})},vm.orderSubmitV2=function(){vm.spinner=tsOfferSignup.setSpinner(!0);var data={campaignId:apiURLs.upsertPersonCampaignId,firstname:vm.formData.firstName,lastname:vm.formData.lastName,MSISDN:vm.formData.phone,addressline1:vm.formData.address1,addressline2:vm.formData.address2,cityname:vm.formData.city,statecode:vm.formData.savedState,postalcode:vm.formData.zip,socialChannel:vm.formData.socialChannel,socialHandle:vm.formData.socialHandle,socialConsent:vm.formData.optin,email:vm.formData.email},v2ApiToggle=vm.v2ApiToggle,url=apiURLs.upsertPerson;tsOfferSignup.getTsData(data,url,v2ApiToggle).then(function(responseSubmitValidation){if($log.log("Submit order validation initiated"),responseSubmitValidation)switch(responseSubmitValidation.returnCode){case 0:vm.success=!0,vm.spinner=tsOfferSignup.setSpinner(!1),vm.formStarted=!1,tsOfferSignupAnalytics.formComplete(vm.formData.tsDeviceExists,vm.formData.optin);break;case 121:tsOfferSignup.model.validationModal.alreadyOrderedModal=!0,openModal();break;default:tsOfferSignup.model.validationModal.errorModal=!0,openModal()}})},vm.clearForm=function(event){event&&event.preventDefault(),vm.model.validationModal.zipValidationModal===!0&&(vm.formData={firstName:vm.formData.firstName,lastName:vm.formData.lastName,phone:vm.formData.phone,address1:"",address2:"",city:"",zip:"",socialChannel:vm.formData.socialChannel,socialHandle:vm.formData.socialHandle,savedState:vm.formData.savedState,optin:vm.formData.optin,email:vm.formData.email,imei:angular.isDefined(vm.formData.imei)?vm.formData.imei:"",tsDeviceExists:angular.isDefined(vm.formData.imei)?vm.formData.tsDeviceExists:"false"}),vm.model.validationModal.phoneValidationModal===!0&&(vm.formData={firstName:vm.formData.firstName,lastName:vm.formData.lastName,phone:"",address1:vm.formData.address1,address2:vm.formData.address2,city:vm.formData.city,zip:vm.formData.zip,socialChannel:vm.formData.socialChannel,socialHandle:vm.formData.socialHandle,savedState:vm.formData.savedState,optin:vm.formData.optin,email:vm.formData.email,imei:angular.isDefined(vm.formData.imei)?vm.formData.imei:"",tsDeviceExists:angular.isDefined(vm.formData.imei)?vm.formData.tsDeviceExists:"false"}),vm.model.validationModal={phoneValidationModal:!1,zipValidationModal:!1,addressValidationModal:!1,alreadyOrderedModal:!1,errorModal:!1},tsOfferSignup.phoneResponse=null,tsOfferSignup.addressResponse=null},vm.updateForm=function(selectedAddress){vm.formData={firstName:vm.formData.firstName,lastName:vm.formData.lastName,phone:vm.formData.phone,email:vm.formData.email,optin:vm.formData.optin,socialChannel:vm.formData.socialChannel,socialHandle:vm.formData.socialHandle,address1:angular.isUndefined(selectedAddress.addressline1)?vm.formData.address1:selectedAddress.addressline1,address2:angular.isUndefined(selectedAddress.addressline2)?vm.formData.address2:selectedAddress.addressline2,city:angular.isUndefined(selectedAddress.cityname)?vm.formData.city:selectedAddress.cityname,zip:angular.isUndefined(selectedAddress.postalcode)?vm.formData.zip:selectedAddress.postalcode,savedState:angular.isUndefined(selectedAddress.statecode)?vm.formData.savedState:selectedAddress.statecode,imei:angular.isDefined(vm.formData.imei)?vm.formData.imei:"",tsDeviceExists:angular.isDefined(vm.formData.imei)?vm.formData.tsDeviceExists:"false"}},vm.legalAnalytics=function(linkId,linkText,linkUrl){tsOfferSignupAnalytics.linkClickAction("clickToNavigate",linkId,linkText,linkUrl)},vm.selectYes=function(optInValue){return optInValue?"yes"===optInValue:void 0},vm.selectNo=function(optInValue){return optInValue?"no"===optInValue:void 0},vm.validatePhoneOnChange=function(formInput){void 0===formInput.$modelValue||formInput.$modelValue.length<10?formInput.$setValidity("minlength",!1):formInput.$setValidity("minlength",!0)}}tsOfferSignupController.$inject=["$log","$scope","$modal","marketingConstants","tsOfferSignup","tsOfferSignupAnalytics","apiURLs"],tsmodalWindowController.$inject=["$scope","$modalInstance","modalData","tsOfferSignupAnalytics"],angular.module("marketingCore").controller("tsOfferSignupController",tsOfferSignupController)}(window.angular),function(angular,externalLogger){"use strict";angular.module("tmobileBrowse").constant("PRODUCT_BROWSE_STATE_NAME","browse").config(["$stateProvider","PRODUCT_CATEGORIES","PRODUCT_BROWSE_STATE_NAME","UPPER_FUNNEL_ABSTRACT_ROOT_STATE_NAME","AEM_RUNTIME",function($stateProvider,PRODUCT_CATEGORIES,PRODUCT_BROWSE_STATE_NAME,UPPER_FUNNEL_ABSTRACT_ROOT_STATE_NAME,AEM_RUNTIME){externalLogger.moduleConfigured("tmobileBrowse","browse.js");var stateConfig={parent:UPPER_FUNNEL_ABSTRACT_ROOT_STATE_NAME,data:{title:"Browse"},views:{content:{templateProvider:null,controller:"BrowseController as vm"}},reloadOnSearch:!1,params:{singleFilter:{value:null,squash:!0,dynamic:!0}},resolve:{toggleData:function($log,toggleService){return toggleService.getToggleFeature().then(function(){$log.log(" resolve :: toggleService")})},authorizationToken:function(tokenUtils,$log,toggleData,toggleService){return toggleService.model.toggles.isCircuitBreaker?!0:tokenUtils.generateToken().then(function(){$log.log(" resolve :: access token")})},searchOptions:function($stateParams,$log,browseStateService,searchOptionsService){var browseCategory=$stateParams.browseCategory.replace(".html",""),productCategoryType=browseStateService.getProductCategoryType(browseCategory);return $log.log(PRODUCT_BROWSE_STATE_NAME+" resolve :: loadSearchOptions for "+productCategoryType),searchOptionsService.loadSearchOptions(productCategoryType).then(function(){$log.log(PRODUCT_BROWSE_STATE_NAME+" resolve :: initializeSearchOptions for "+productCategoryType)})},compatibleDevicesData:function(apiURLs,$log,$stateParams,browseService,authorizationToken,toggleService){if(_.get(toggleService.model,"toggles.mainPLPV2",!1))return!0;var browseCategory=$stateParams.browseCategory.replace(".html","");return"accessories"===browseCategory&&(_.isEmpty(browseService.model.compatibleDevices)||_.isEmpty(browseService.model.accessoryCategoriesList))?($log.log(PRODUCT_BROWSE_STATE_NAME+" resolve :: initialize accessoriesCategoriesData for "+browseCategory),browseService.loadAccessoriesData(browseCategory).then(function(){$log.log(PRODUCT_BROWSE_STATE_NAME+" resolve :: loadAccessoriesData for "+browseCategory)})):void 0}}},browseCategories=_.map(_.values(PRODUCT_CATEGORIES),"browseUrlRoot"),browseFiles=_.transform(browseCategories,function(result,root){return result.push(root+".html")}),urlRoots=AEM_RUNTIME.isHost?browseFiles:_.union(browseCategories,browseFiles);stateConfig.url="/{browseCategory:(?:"+urlRoots.join("|")+")}/{singleFilter}?",$stateProvider.state(PRODUCT_BROWSE_STATE_NAME,stateConfig);var aemPublisherConfig=angular.extend({},stateConfig);aemPublisherConfig.url="/content/t-mobile"+stateConfig.url,$stateProvider.state(PRODUCT_BROWSE_STATE_NAME+"-preview",aemPublisherConfig);var aemEditorConfig=angular.extend({},aemPublisherConfig);aemEditorConfig.url="/editor.html"+aemEditorConfig.url,$stateProvider.state(PRODUCT_BROWSE_STATE_NAME+"-editor",aemEditorConfig)}])}(angular,externalLogger),function(angular){"use strict";function iconCarousel($window,analyticsUtils){return{restrict:"A",link:function(scope,element,attr){function onInit(e,slick){slick.$slider[0].style.opacity="1",angular.element($window).triggerHandler("resize")}function onAfterChange(e,slick,currentSlide){analyticsUtils.trackCarousel(currentSlide>prevSlide,element)}function onBeforeChange(e,slick,currentSlide,nextSlide){prevSlide=currentSlide}function cleanup(){scope.slickConfig&&scope.slickConfig.method.unslick()}var prevSlide;scope.slickConfig&&(scope.slickConfig.event.init=onInit,scope.slickConfig.event.afterChange=onAfterChange,scope.slickConfig.event.beforeChange=onBeforeChange),scope.$on("$destroy",cleanup)}}}iconCarousel.$inject=["$window","analyticsUtils"],angular.module("marketingCore").directive("iconCarousel",iconCarousel)}(angular),function(angular,_,CQ_Analytics){"use strict";function browseService($rootScope,commonServices,apiURLs,commonStorage,browseStateService,searchOptionsService,creditClassService,httpRequest,toggleService,AEM_RUNTIME,responseAggregatorService,globalValue,httpRequestWrapper,cartConstants){function offerValidForColorIndex(offer,index){if(_.isEmpty(offer)||angular.isUndefined(index))return!1;var itemOfferList=offer.split("|");return itemOfferList.length<index?!1:"TRUE"===itemOfferList[index].toUpperCase()}function hasDefaultOffer(offer){return me.offerValidForColorIndex(offer,0)}function showLegalText(){return creditClassService.getCreditClass()?me.creditClass.creditClass3!==creditClassService.getCreditClass()["class"]:!0}function paginationGetNew(perPage){perPage=void 0===perPage?5:perPage;var paginator={numPages:1,perPage:perPage,page:$location.search().page?$location.search().page:1};return paginator}function resetPagination(){_.get(toggleService.model,"toggles.mainPLPV2",!1)?setItemPerPageForV2():model.itemsPerPage=angular.isDefined(model.itemsPerPageLimits)&&model.itemsPerPageLimits.length>0?model.itemsPerPage=model.itemsPerPageLimits[0]:"12",model.currentPage=1,delete model.locationQueryParams.count,delete model.locationQueryParams.page}function getCreditRatedPriceToday(product){var results="";me.model.showPrices.todayPrice=!0;var priceIndex=angular.isUndefined(product.prodPrice)||"-1"===product.prodPrice?"0":product.prodPrice;switch(angular.isDefined(creditClassService.getCreditClass())?creditClassService.getCreditClass()["class"]:me.creditClass.creditClass1){case me.creditClass.creditClass1:results=_.isEmpty(product.payNowGoodCredit_s)?"":product.payNowGoodCredit_s.split("|")[priceIndex];break;case me.creditClass.creditClass2:results=_.isEmpty(product.payNowBuildCredit_s)?"":product.payNowBuildCredit_s.split("|")[priceIndex];break;case me.creditClass.creditClass3:me.model.showPrices.todayPrice=!1,results=_.isEmpty(product.listPriceSku)?"":product.listPriceSku.split("|")[priceIndex]}return results}function getCreditRatedPriceMonthly(product){var price="";me.model.showPrices.monthlyPrice=!0;var priceIndex=angular.isUndefined(product.prodPrice)||"-1"===product.prodPrice?"0":product.prodPrice;switch(angular.isDefined(creditClassService.getCreditClass())?creditClassService.getCreditClass()["class"]:me.creditClass.creditClass1){case creditClass.creditClass1:price=_.isEmpty(product.monthlyPriceGCS)?"":product.monthlyPriceGCS.split("|")[priceIndex];break;case me.creditClass.creditClass2:price=_.isEmpty(product.monthlyPriceBCS)?"":product.monthlyPriceBCS.split("|")[priceIndex];break;case me.creditClass.creditClass3:me.model.showPrices.monthlyPrice=!1,price=_.isEmpty(product.listPriceSku)?"":product.listPriceSku.split("|")[priceIndex]}return price}function getCreditRatedPriceDiscounted(product){var priceIndex=angular.isUndefined(product.prodPrice)||"-1"===product.prodPrice?"0":product.prodPrice;return""!==product.salePriceSku?product.salePriceSku.split("|")[priceIndex]:""}function getCreditRatedPriceTotal(product){var priceIndex=angular.isUndefined(product.prodPrice)||"-1"===product.prodPrice?"0":product.prodPrice;return""!==product.listPriceSku?product.listPriceSku.split("|")[priceIndex]:""}function getOfferLabelForItem(item){var offerLabel;return offerLabel=offerValidForColorIndex(item.isNewSku,item.selectedColorIndex)?model.badges["new"]:offerValidForColorIndex(item.hotItemSku,item.selectedColorIndex)?model.badges.hotitem:offerValidForColorIndex(item.webOnlySku,item.selectedColorIndex)?model.badges.webonly:offerValidForColorIndex(item.specialOfferSku,item.selectedColorIndex)?model.badges.specialoffer:offerValidForColorIndex(item.onSaleSku,item.selectedColorIndex)?model.badges.onsale:offerValidForColorIndex(item.bogoSku,item.selectedColorIndex)?model.badges.bogo:getDefaultBadgeLabelForItem(item),offerLabel||"missing offer"}function getDefaultBadgeLabelForItem(item){var label="";return hasDefaultOffer(item.onSaleSku)?label=model.badges.onsale:hasDefaultOffer(item.webOnlySku)?label=model.badges.webonly:hasDefaultOffer(item.specialOfferSku)?label=model.badges.specialoffer:hasDefaultOffer(item.bogoSku)?label=model.badges.bogo:hasDefaultOffer(item.hotItemSku)?label=model.badges.hotitem:hasDefaultOffer(item.isNewSku)&&(label=model.badges["new"]),label}function badgeIsValidForProduct(product){return offerValidForColorIndex(product.onSaleSku,product.selectedColorIndex)||offerValidForColorIndex(product.webOnlySku,product.selectedColorIndex)||offerValidForColorIndex(product.specialOfferSku,product.selectedColorIndex)||offerValidForColorIndex(product.bogoSku,product.selectedColorIndex)||offerValidForColorIndex(product.hotItemSku,product.selectedColorIndex)||offerValidForColorIndex(product.isNewSku,product.selectedColorIndex)}function changePage(){getProductData()}function changeItemsPerPage(itemsPerPage){model.itemsPerPage=itemsPerPage,model.currentPage=1,model.locationQueryParams.count=itemsPerPage,getProductData("",itemsPerPage).then(function(){$rootScope.$broadcast("resetPaginationPage",model.pagination.numPages)})}function getAuthorData(authorJSONUrl){var url="";return url=9e3===$location.port()?"/mockData/authorData.json":authorJSONUrl.contains("content/t-mobile")?"/bin/authorvalue"+authorJSONUrl.replace("html","json"):"/bin/authorvalue/content/t-mobile/"+authorJSONUrl.replace("html","json"),httpRequest.get(url).then(function(result){return _.isEmpty(result.data)||(model.authorValue=result.data),init(),model.authorValue})}function getCategoryQuery(){var ac="";return _.isEmpty(model.subNav.label)||(ac=model.subNav.label,commonStorage.getFromSharedSession("backfrompdp")&&commonStorage.getFromSharedSession("backfrompdp")===!0&&commonStorage.assignIntoSharedSession("backfrompdp",!1)),"accessory"!==model.productType&&(ac=""),ac}function getCompatibileDevice(){var dn="";return model.compatibleSelected.key&&(dn=model.compatibleSelected.label),dn}function getItemsPerPageCount(){var count="";return _.isEmpty(model.locationQueryParams)||angular.isUndefined(model.locationQueryParams.count)?count=model.itemsPerPage.toString():(count=model.locationQueryParams.count.toString(),
model.itemsPerPage=count),count}function locationQueryParams(){$location.$$search={},angular.forEach(model.locationQueryParams,function(value,key){$location.search(key,value)})}function updateQueryStringParameters(model){"accessory"!==model.productType&&resetPagination();var query=[],acParam=getCategoryQuery();_.isEmpty(acParam)||"All Categories"===acParam||(model.locationQueryParams.ac="category-"+acParam.replace(/[^a-zA-Z0-9()_-]/g,"-").replace(/-{2,}/g,"-").replace(/\(|\)/g,"").replace(/[-]$/,"").toLowerCase(),query.push("ac="+encodeURIComponent(getAccessoryCategory(acParam))));var dnParam=getCompatibileDevice();if(_.isEmpty(dnParam)||(model.locationQueryParams.dn="device-"+dnParam.replace(/[^a-zA-Z0-9()_-]/g,"-").replace(/-{2,}/g,"-").replace(/\(|\)/g,"").replace(/[-]$/,"").toLowerCase(),query.push("dn="+encodeURIComponent(dnParam))),"accessory"===model.productType){var itemsPerPage=getItemsPerPageCount();_.isEmpty(itemsPerPage)||query.push("count="+itemsPerPage);var currentPage=model.currentPage.toString();_.isEmpty(itemsPerPage)||query.push("page="+currentPage)}var filterQuery=searchOptionsService.getFilterAndSortQueryString();return _.isEmpty(filterQuery)||(query=[filterQuery].concat(query)),locationQueryParams(),updateSingleParams(filterQuery),query.join("&")}function updateSingleParams(filterQuery){var isSingleFilter=!0,queryString=angular.copy(model.locationQueryParams);if(AEM_RUNTIME.isHost||($stateParams.browseCategory=angular.isDefined($stateParams.browseCategory)?$stateParams.browseCategory.replace(".html",""):"accessories"),angular.forEach(queryString,function(value,key){"pm"!==key&&"prg"!==key&&"osy"!==key&&"ac"!==key&&"dn"!==key&&"cd"!==key&&($location.search(key,value),delete queryString[key])}),(!_.isEmpty(queryString.pm)&&queryString.pm.split("|").length>1||!_.isEmpty(queryString.prg)&&queryString.prg.split("|").length>1||!_.isEmpty(queryString.osy)&&queryString.osy.split("|").length>1||!_.isEmpty(queryString.cd)&&queryString.cd.split("|").length>1)&&(isSingleFilter=!1),delete queryString.page,delete queryString.sort,delete queryString.count,1!==Object.keys(queryString).length||isSingleFilter!==!0||_.isEmpty(queryString.pm)&&_.isEmpty(queryString.ac)&&_.isEmpty(queryString.dn)&&_.isEmpty(queryString.cd)&&_.isEmpty(queryString.osy)&&_.isEmpty(queryString.prg))delete $stateParams.singleFilter,$location.path($state.href($state.current.name,$stateParams));else{var key=Object.keys(queryString)[0];$location.search(key,null),$stateParams.singleFilter=queryString[key],$location.path($state.href($state.current.name,$stateParams))}}function loadAccessoriesData(browseCategory){var deferred=$q.defer();if("accessories"===browseCategory&&(_.isEmpty(me.model.compatibleDevices)||_.isEmpty(me.model.accessoryCategoriesList))){var query,header,authRequired,compatibleDevicesUrl=(_.isEmpty($stateParams.singleFilter)?"":$stateParams.singleFilter.replace("category-",""),apiURLs.compatibleAccessory);query=null,header=apiURLs.nonProdBrowseHeader?{"x-target":"b"}:{},authRequired=!0,httpRequestWrapper.get(compatibleDevicesUrl,query,null,!0).then(function(response){me.model.compatibleDevices=_.isEmpty(response.data)?"":response.data["Device Names"][0],me.model.accessoryCategoriesList=_.isEmpty(response.data)?"":response.data["Accessory Categories"][0],me.setTransformAccessoriesCategories(),deferred.resolve()})}return deferred.promise}function getProductData(){init();var isFilter,query=updateQueryStringParameters(model);return isFilter=angular.isDefined(query),responseAggregatorService.getProducts(isFilter,query,model.authorValue,model).then(function(response){if(_.isEmpty(response))return void(model.newProducts=[]);model.showErroMsg=response.isOffline&&toggleService.model.toggles.browseCachedData,$rootScope.$broadcast("SHOW_ERROR_MSG",model.showErroMsg),model.newProducts=response.products,model.totalCount=response.total.products,model.isOffline=response.isOffline||!1;var category=$stateParams.browseCategory.replace(".html","");if(model.pagination=paginationGetNew(),model.pagination.numPages=Math.ceil(model.totalCount/model.itemsPerPage),"accessories"===category)if(setCategoriesForV2(),model.pagination.numPages<5&&$rootScope.$broadcast("PRODUCT_COUNT_MINIMUM",model.pagination.numPages),_.isEmpty(model.accessoryCategoriesList)){if(angular.isDefined(response["Accessory Categories"])&&0===model.accessoryNavItems.length){var navItems=response["Accessory Categories"][0].values,addAllCategories={count:response["Accessory Categories"][0].count,facetPath:"",label:response["Accessory Categories"][0].label,selected:"",undoFacetPath:""};navItems[0].label!==response["Accessory Categories"][0].label&&navItems.unshift(addAllCategories),model.accessoryNavItems=navItems,model.accessoryCategoriesList=model.accessoryNavItems}}else{var navItems=model.accessoryCategoriesList.options;model.accessoryNavItems=model.accessoryCategoriesList.options,navItems=updateNavItems(response,navItems,model),model.accessoryNavItems=navItems}})}function setCategoriesForV2(){if(_.get(toggleService.model,"toggles.mainPLPV2",!1)){var categoryOptions=searchOptionsService.getCategorySearchOptions(model.productType);model.accessoryCategoriesList=categoryOptions?categoryOptions.accessoryCategory:{}}}function updateNavItems(response,navItems,model){var addAllCategories;return response["Accessory Categories"]?(addAllCategories={count:response["Accessory Categories"][0].count,facetPath:"",label:response["Accessory Categories"][0].label,selected:"",undoFacetPath:""},navItems[0].label!==response["Accessory Categories"][0].label&&navItems.unshift(addAllCategories)):(addAllCategories={count:response.total.products,facetPath:"",label:cartConstants.ALL_CATEGORIES,selected:"",undoFacetPath:""},navItems[0].label!==cartConstants.ALL_CATEGORIES&&navItems.unshift(addAllCategories)),navItems}function isSimToolkit(product){for(var simKitSkuIds=["610214641922","610214641939"],skuArray=product.skuCode.split("|"),i=0;i<skuArray.length;i++)if(-1!==simKitSkuIds.indexOf(skuArray[i]))return!0;return!1}function getPriceTypeAvailableEIP(product){return angular.isDefined(product.priceTypeAvailableEIP)&&"true"===product.priceTypeAvailableEIP}function init(){var itemsPerPageLimitsArray=model.authorValue.rootPage.deviceBrowse.browsepagination;angular.isDefined(itemsPerPageLimitsArray)&&itemsPerPageLimitsArray.length>0&&(model.itemsPerPageLimits=_.chunk(itemsPerPageLimitsArray,4)[0]),_.get(toggleService.model,"toggles.mainPLPV2",!1)?(executed=!1,setItemPerPageForV2()):angular.isDefined(model.itemsPerPageLimits)&&model.itemsPerPageLimits.length>0&&executed&&(model.itemsPerPage=model.itemsPerPageLimits[0],executed=!1)}function setItemPerPageForV2(){if(!_.get(model,"authorValue.browseproductgrid",!1))return void(model.itemsPerPage=_.get(model,"itemsPerPageLimits[0]",!1)?model.itemsPerPageLimits[0]:cartConstants.ITEMS_PER_PAGE);var browseProductsGrid=model.authorValue.browseproductgrid;switch(model.productType){case cartConstants.DEVICE_TYPE_IN_LOWER.HANDSET:model.itemsPerPage=browseProductsGrid.pageSizeDevices;break;case cartConstants.DEVICE_TYPE_IN_LOWER.TABLET:model.itemsPerPage=browseProductsGrid.pageSizeInternetDevices;break;case cartConstants.DEVICE_TYPE_IN_LOWER.ACCESSORY:model.itemsPerPage=browseProductsGrid.pageSizeAccessories}(angular.isUndefined(model.itemsPerPage)||0===model.itemsPerPage)&&(model.itemsPerPage=_.get(model,"itemsPerPageLimits[0]",!1)?model.itemsPerPageLimits[0]:cartConstants.ITEMS_PER_PAGE)}function setTransformFamily(familyName){var trasnformFamilyName;if(angular.isDefined(familyName)){trasnformFamilyName=-1===familyName.indexOf("™")?familyName.replace(/\s+/g,"-").replace(/[^-\w]+/g,"").replace(/-{2,}/g,"-").toLowerCase():familyName.replace(/™/,"TM");var familyObj={label:familyName,trasnform:trasnformFamilyName};model.transformFamily.push(familyObj)}return trasnformFamilyName}function setTransformAccessoriesCategories(){_.isEmpty(model.accessoriesCategoryFamily)&&angular.forEach(model.accessoryCategoriesList.options,function(value){var accessoriesTransformCategoryName=value.label.replace(/\s+/g,"-").replace(/[^-\w]+/g,"").replace(/-{2,}/g,"-").toLowerCase(),accessoriesCategoryObj={label:value.label,transform:accessoriesTransformCategoryName};model.accessoriesCategoryFamily.push(accessoriesCategoryObj)})}function getTransformFamily(familyName){var familyObj=_.find(model.compatibleDevices.options,function(compatible){var label=compatible.label.replace(/[.]/g,"").replace(/[^a-zA-Z0-9()_-]/g,"-").replace(/-{2,}/g,"-").replace(/\(|\)/g,"").toLowerCase();return label===familyName});return _.isEmpty(familyObj)?familyName:familyObj.label}function getAccessoryCategory(accessoryCategoryName){_.isEmpty(model.accessoriesCategoryFamily)&&setTransformAccessoriesCategories();var categoryObj=_.find(model.accessoriesCategoryFamily,function(category){var label=category.label.replace(/[^a-zA-Z0-9()_-]/g,"-").replace(/-{2,}/g,"-").replace(/\(|\)/g,"").toLowerCase();return label===accessoryCategoryName});return _.isEmpty(categoryObj)?accessoryCategoryName:categoryObj.label}function getProductCategoryType(){return browseStateService.productCategoryType}function getPriceTypeAvailableEIPForDevice(product){var priceTypeAvailableToggle=toggleService.model.toggles.NonEipToggle,selectedProductIndex=angular.isUndefined(product.prodPrice)||"-1"===product.prodPrice?"0":product.prodPrice,priceTypeAvailableEIPForDevice=""!==product.priceTypeAvailableEIP?product.priceTypeAvailableEIP.split("|")[selectedProductIndex]:"";return angular.isDefined(priceTypeAvailableEIPForDevice)&&"true"===priceTypeAvailableEIPForDevice?!0:angular.isDefined(priceTypeAvailableToggle)&&priceTypeAvailableToggle===!0?!1:!0}var me=this,$state=(apiURLs.product.host+apiURLs.product.browse.service,commonServices.$state),$stateParams=commonServices.$stateParams,$location=commonServices.$location,$q=(commonServices.$http,commonServices.$q),mappingArr=[];mappingArr["--"]="-&-";var chkSubNavLoad=!0;$rootScope.$on("SUB_NAV_CATEGORY_RESET",function(){chkSubNavLoad=!0});var executed=!0,creditClass={creditClass1:"creditClass1",creditClass2:"creditClass2",creditClass3:"creditClass3"},model={locationQueryParams:{},productType:"accessory",isLiveFeed:!1,subNav:{},isFilterSeleted:!1,selectedFilterValue:"",products:[],prodImages:[],compatibleDevices:[],accessoryCategoriesList:[],compatibleSelected:"",accessories:[],totalCount:0,currentPage:$location.search().page?$location.search().page:1,itemsPerPage:12,itemsPerPageLimits:[],showPrices:{todayPrice:!0,monthlyPrice:!0,totalPrice:!0},authorValue:{},badges:[],creditClassSelected:[],accessoryNavItems:[],accessorySelectedFilter:"",transformFamily:[],accessoriesCategoryFamily:[],nonEIPToggleValue:!1};model.authorValue=globalValue.authorValue,model.isOffline=!1,me.model=model,me.creditClass=creditClass,me.getAuthorData=getAuthorData,me.offerValidForColorIndex=offerValidForColorIndex,me.hasDefaultOffer=hasDefaultOffer,me.getProductData=getProductData,me.changePage=changePage,me.changeItemsPerPage=changeItemsPerPage,me.resetPagination=resetPagination,me.getCreditRatedPriceToday=getCreditRatedPriceToday,me.getCreditRatedPriceMonthly=getCreditRatedPriceMonthly,me.getCreditRatedPriceDiscounted=getCreditRatedPriceDiscounted,me.getCreditRatedPriceTotal=getCreditRatedPriceTotal,me.getOfferLabelForItem=getOfferLabelForItem,me.getDefaultBadgeLabelForItem=getDefaultBadgeLabelForItem,me.badgeIsValidForProduct=badgeIsValidForProduct,me.showLegalText=showLegalText,me.isSimToolkit=isSimToolkit,me.setTransformFamily=setTransformFamily,me.getTransformFamily=getTransformFamily,me.getAccessoryCategory=getAccessoryCategory,me.setTransformAccessoriesCategories=setTransformAccessoriesCategories,me.getProductCategoryType=getProductCategoryType,me.toggles=toggleService.model.toggles,me.getPriceTypeAvailableEIP=getPriceTypeAvailableEIP,me.nonEIPToggleValue=toggleService.model.toggles.NonEipToggle,me.searchQuerystrings=$location.search(),me.locationQueryParams=locationQueryParams,me.getPriceTypeAvailableEIPForDevice=getPriceTypeAvailableEIPForDevice,me.loadAccessoriesData=loadAccessoriesData,me.setItemPerPageForV2=setItemPerPageForV2;return me}browseService.$inject=["$rootScope","commonServices","apiURLs","commonStorage","browseStateService","searchOptionsService","creditClassService","httpRequest","toggleService","AEM_RUNTIME","responseAggregatorService","globalValue","httpRequestWrapper","cartConstants"],angular.module("tmobileBrowse").constant("PRODUCT_CATEGORY_TYPES",{device:"phone",phone:"phone",accessory:"accessory",internetDevice:"internet-device",mbb:"mbb"}).service("browseService",browseService)}(angular,_,window.CQ_Analytics),function(angular,lodash){"use strict";function addLine($window,$document,$timeout,$interval,viewport){return{restrict:"A",link:function(scope,element,attr){function onresize_window(){var headContainer=element[0].querySelector('.screen[aria-hidden="false"] .header-container');$timeout(function(){updatePagination(headContainer)},500)}function updatePagination(headerContainer){var pagination=element[0].querySelector(".screen-pagination"),navHeight=$document[0].querySelector("header").offsetHeight,containerPosition=headerContainer.getBoundingClientRect(),headerContainerBottom=containerPosition.top+headerContainer.offsetHeight-navHeight,headerContainerLeft=containerPosition.left;viewport.breakpointUp("desktop")?(pagination.style.top=headerContainerBottom+"px",pagination.style.left=headerContainerLeft+"px"):(pagination.style.top=headerContainerBottom-30+"px",pagination.style.left=headerContainerLeft+"px")}function showScreen(screenElement,focusElement){var screens=element[0].querySelectorAll(".screen");if(angular.element("body").toggleClass("light","three"==scope.vm.aal.visibleScreen).toggleClass("brand","four"==scope.vm.aal.visibleScreen),lodash.forEach(screens,function(screen){screen.setAttribute("aria-hidden","true")}),screenElement.setAttribute("aria-hidden","false"),screenElement.style.visibility="visible",hasInit){var headContainer=element[0].querySelector('.screen[aria-hidden="false"] .header-container'),formWrapper=element[0].querySelector(".form-wrapper");formWrapper.addEventListener("transitionend",function transitionend(e){formWrapper.removeEventListener("transitionend",transitionend,!1),setVoiceOverFocus(focusElement),updatePagination(headContainer);for(var i=0;i<screens.length;i++)screens[i].style.visibility="hidden";screenElement.style.visibility="visible"},!1)}else hasInit=!0}function setVoiceOverFocus(el){var focusRepetitions=0;el.setAttribute("tabindex","0"),el.blur(),focusInterval=$interval(function(){el.focus(),focusRepetitions++,focusRepetitions>=10&&cancelInterval()},10)}function cancelInterval(){$interval.cancel(focusInterval),focusInterval=null}function cleanup(){angular.element($window).off("resize.aal")}var hasInit=!1,focusInterval=null,headContainer=element[0].querySelector('.screen[aria-hidden="false"] .header-container');angular.element("body").addClass("background dark"),$timeout(function(){updatePagination(headContainer)},1e3),angular.element($window).on("resize.aal",onresize_window),scope.$watch("vm.aal.emailEditable",function(editable){var hasAccountEmail=element[0].querySelector("[name=emailUser]");editable&&hasAccountEmail.focus()}),scope.$watch("vm.aal.visibleScreen",function(screen){var screenElement=element[0].querySelector(".screen-"+screen),focusTarget=screenElement.querySelector("[data-focus-target]");showScreen(screenElement,focusTarget,"three"!=screen)}),scope.$on("valid",function(e,isValid){if(isValid===!1){var inputWrapperError=element[0].querySelectorAll(".input-wrapper.error"),inputError=inputWrapperError[0].querySelector("input");inputError.focus()}}),scope.$on("$destroy",cleanup)}}}addLine.$inject=["$window","$document","$timeout","$interval","viewport"],angular.module("marketingCore").directive("addLine",addLine)}(window.angular,window._),function(angular,_){"use strict";function BrowseStateServiceConstructor($templateFactory,commonServices,aemRoutingService,MASTER_ERROR_STATE_NAME,PRODUCT_BROWSE_STATE_NAME,PRODUCT_CATEGORIES,AEM_RUNTIME){function parseUrl(url){var parsedUrl={},matches=url.match(aemRouteUrlRegEx);return angular.isArray(matches)&&(parsedUrl.root=matches[1],parsedUrl.browseCategory=matches[2].replace(".html",""),parsedUrl.productCategory=browseCategoryMap[parsedUrl.browseCategory],parsedUrl.productName=matches[3],parsedUrl.hasFileSuffix=angular.isDefined(matches[4])),parsedUrl}function findStateTemplate(){return aemRoutingService.loadRoutingStates().then(function(){var templateUrl,browseCategory=angular.isDefined(pendingStateChange.toParams)?pendingStateChange.toParams.browseCategory:void 0;if(angular.isUndefined(browseCategory)){var url=angular.isDefined(pendingStateChange.toState)?pendingStateChange.toState.url:$location.path(),urlParams=parseUrl(url);browseCategory=urlParams.browseCategory}if(angular.isDefined(browseCategory)){browseCategory=browseCategory.replace(".html","");var productCategoryType=browseCategoryMap[browseCategory];me.productCategoryType=productCategoryType;var authoredState=authoredStates[productCategoryType];angular.isDefined(authoredState)&&angular.isDefined(authoredState.templateUrl)&&(templateUrl=authoredState.templateUrl)}return _.isEmpty(templateUrl)?($log.warn("Could not find browse page for "+browseCategory),$state.go(MASTER_ERROR_STATE_NAME),$q.reject()):$templateFactory.fromUrl(templateUrl)})}function addSubState(stateConfig,parsedUrl){var stateLoadedSuccessfully=!0;return _.includes(browseUrlRoots,stateConfig.routeName.replace(/[-_]without[-_]root/,""))?(stateConfig.data=stateConfig.data||{},stateConfig.data.productCategory=stateConfig.data.productCategory||parsedUrl.productCategory,authoredStates[parsedUrl.productCategory]=stateConfig):stateLoadedSuccessfully=!1,stateLoadedSuccessfully}function isMyState(toState){return _.includes(toState.name,PRODUCT_BROWSE_STATE_NAME)}function getProductCategoryType(browseCategory){return browseCategoryMap[browseCategory.replace(/.html/,"")]}function getAuthoredData(category){angular.isUndefined(category)&&!_.isEmpty(pendingStateChange)&&(category=pendingStateChange.toParams.browseCategory);var productCategoryType=getProductCategoryType(category)||category,authoredState=authoredStates[productCategoryType];return angular.isDefined(authoredState)?authoredState.data:{}}function getAuthoredStates(){return authoredStates}function stateChangeStart(toState,toParams,fromState,fromParams,options){isMyState(toState)&&(pendingStateChange={toState:toState,toParams:toParams,fromState:fromState,fromParams:fromParams,options:options,aemData:getAuthoredData(toParams.browseCategory)})}function stateChangeComplete(toState){isMyState(toState)&&(pendingStateChange={})}var me=this,$q=commonServices.$q,$state=commonServices.$state,$location=commonServices.$location,$log=commonServices.$log,pendingStateChange={},aemPreviewState=$state.get(PRODUCT_BROWSE_STATE_NAME+"-preview");aemPreviewState.views.content.templateProvider=findStateTemplate;var aemEditorState=$state.get(PRODUCT_BROWSE_STATE_NAME+"-editor");aemEditorState.views.content.templateProvider=findStateTemplate;var masterState=$state.get(PRODUCT_BROWSE_STATE_NAME);masterState.views.content.templateProvider=findStateTemplate;var browseUrlRoots=_.map(_.values(PRODUCT_CATEGORIES),"browseUrlRoot"),browseCategoryMap={};_.forEach(PRODUCT_CATEGORIES,function(value,key){browseCategoryMap[value.browseUrlRoot]=key});var aemRoots=[];_.forEach(browseUrlRoots,function(root){aemRoots.push(root+".html")}),browseUrlRoots=aemRoots.concat(browseUrlRoots);var authoredStates={},pattern="^(/.*)?/(##categories##)(?:/([^.]*))?(.html)?",aemRouteUrlRegEx=new RegExp(pattern.replace("##categories##",browseUrlRoots.join("|")),"i");return me.getPendingState=function(){return pendingStateChange},me.stateChangeStart=stateChangeStart,me.stateChangeComplete=stateChangeComplete,me.isMyState=isMyState,me.addSubState=addSubState,me.getAuthoredData=getAuthoredData,me.getAuthoredStates=getAuthoredStates,me.getProductCategoryType=getProductCategoryType,me.parseUrl=parseUrl,me}BrowseStateServiceConstructor.$inject=["$templateFactory","commonServices","aemRoutingService","MASTER_ERROR_STATE_NAME","PRODUCT_BROWSE_STATE_NAME","PRODUCT_CATEGORIES","AEM_RUNTIME"],angular.module("tmobileBrowse").service("browseStateService",BrowseStateServiceConstructor).run(["$rootScope","browseStateService",function($rootScope,browseStateService){$rootScope.$on("$stateChangeStart",function(event,toState,toParams,fromState,fromParams,options){browseStateService.stateChangeStart(toState,toParams,fromState,fromParams,options)}),$rootScope.$on("$stateChangeError",function(event,toState,toParams,fromState,fromParams,error){browseStateService.stateChangeComplete(event,toState,toParams,fromState,fromParams,error)}),$rootScope.$on("$stateChangeSuccess",function(event,toState,toParams,fromState,fromParams,options){browseStateService.stateChangeComplete(event,toState,toParams,fromState,fromParams,options)})}])}(angular,_),function(angular){"use strict";function askJohn($window,$document,$location,$timeout,utils,scene7,analyticsUtils){return{restrict:"A",link:function(scope,element,attr){function randomize(elements,base){for(var parent=base,array=new Uint8Array(1),i=elements.length;i>=0;i--)parent.append(elements[window.crypto.getRandomValues(array)/(Math.pow(2,8)-1)*i|0])}function capQuestions(){var questionCap=element.data("cap")-1,mobileQuestionCap=element.data("cap");element.find(".questions li:gt("+questionCap+")").remove(),element.find(".video-select option:gt("+mobileQuestionCap+")").remove()}function createLists(){for(var questions=element[0].querySelector(".questions"),questionButtonsList=element[0].querySelectorAll(".questions li"),newList=document.createElement("ul"),newListTwo=document.createElement("ul"),halfNum=Math.round(questionButtonsList.length/2),i=0;halfNum>i;i++)newList.appendChild(questionButtonsList[i]),element[0].querySelector(".cta").appendChild(newList);var questionButtonsTwo=questions.querySelectorAll("li");angular.forEach(questionButtonsTwo,function(questionButtonTwo){newListTwo.appendChild(questionButtonTwo),element[0].querySelector(".cta").appendChild(newListTwo)})}function playVideo(videoId,s7config){if(player&&null!==videoId||null!==s7config)if(scope.playing=!0,scope.$apply(),s7config){var config=s7config;bcVideoContainer.hide(),element.find(".video-js").hide(),vidOverlay.style.visibility="visible",vidOverlay.style.display="flex",scrollTo(0,vidOverlay.getBoundingClientRect().top+$window.window.pageYOffset-62),vidClose.focus(),angular.element($window).on("scroll.resetVideo",onScrollWindow),scene7.foregroundVid(attr.moduleId,videoId,config,onDynamicMediaPlayerInit,onDynamicMediaPlayerTrackEvent)}else utils.loadScript("//players.brightcove.net/1403111602001/B1P2wir0_default/index.min.js",onSuccess)}function playBrightCove(){player.catalog.getVideo(videoId,function(error,video){player.catalog.load(video),videoName=player.mediainfo.name,player.play(),vidOverlay.style.visibility="visible",vidOverlay.style.display="flex",element.find(".video-js").show(),scrollTo(0,vidOverlay.getBoundingClientRect().top+$window.window.pageYOffset-62),vidClose.focus(),$window.addEventListener("scroll.resetVideo",onScrollWindow)})}function resetVideo(){s7Player?(angular.element($window).off("scroll.resetVideo"),s7Player.dispose(),s7Player=null,vidOverlay.style.visibility="hidden",vidOverlay.style.display="none",bcVideoContainer.show(),scope.playing=!1,scope.$apply()):(angular.element($window).off("scroll.resetVideo"),player.pause(),player.isFullscreen()&&player.exitFullscreen(),player=null,vidOverlay.style.visibility="hidden",vidOverlay.style.display="none",scope.playing=!1,scope.$apply())}function setPlacementId(){for(var moduleList=$window.window.marketingDigitalData&&$window.window.marketingDigitalData.page&&$window.window.marketingDigitalData.page.modules&&$window.window.marketingDigitalData.page.modules.moduleList?$window.window.marketingDigitalData.page.modules.moduleList:[],i=0;i<moduleList.length;i++)if(moduleList[i].ID===analyticsId){placementId=moduleList[i].placementID;break}}function onSuccess(){$window.window.videojs("video-"+attr.moduleId).ready(onReadyVideo)}function onReadyVideo(){player=this,player.on("play",function(){duration=this.duration(),null!==scrollPrompt&&angular.element("body").addClass("video-play"),analyticsUtils.trackVideoPlay(videoName,moduleName,placementId)}),player.on("pause",function(){null!==scrollPrompt&&angular.element("body").removeClass("video-play"),analyticsUtils.trackVideoPause(videoName,moduleName,placementId)}),player.on("seeked",function(){analyticsUtils.trackVideoSeeked(videoName,moduleName,placementId)}),player.on("timeupdate",function(){duration=duration?duration:this.duration(),this.currentTime()/duration>=.75&&this.currentTime()/duration<1&&"75%"!==milestone?(milestone="75%",analyticsUtils.trackVideoTimeUpdate(videoName,moduleName,placementId,milestone)):this.currentTime()/duration>=.5&&this.currentTime()/duration<.75&&"50%"!==milestone?(milestone="50%",analyticsUtils.trackVideoTimeUpdate(videoName,moduleName,placementId,milestone)):this.currentTime()/duration>=.25&&this.currentTime()/duration<.5&&"25%"!==milestone&&(milestone="25%",analyticsUtils.trackVideoTimeUpdate(videoName,moduleName,placementId,milestone))}),$timeout(function(){$location.search().section===attr.moduleId&&$location.search().vid&&(setPlacementId(),playVideo($location.search().vid))},0),playBrightCove(),player.on("ended",function(){resetVideo(),analyticsUtils.trackVideoEnded(videoName,moduleName,placementId)})}function onScrollWindow(){$document.fullscreenElement||$document.webkitFullscreenElement||$document.mozFullScreenElement||$document.msFullscreenElement||(angular.element($window).scrollTop()>element.offset().top+element.innerHeight()&&resetVideo(!0),angular.element($window).scrollTop()<element.offset().top-element.innerHeight()&&resetVideo(!0))}function onClickPlay(e){var playButton=angular.element(e.currentTarget);videoId=playButton.attr("data-video-id")||playButton.val();var s7config;setPlacementId();var val=angular.element(e.currentTarget).attr("data-video-id")||playButton[0].options[playButton[0].selectedIndex].value,matches=val.match(/\//);null!==matches&&(s7config="select-one"===e.target.type?angular.fromJson(angular.element(playButton[0].options[playButton[0].selectedIndex]).attr("data-foreground-video-config")):angular.fromJson(angular.element(e.currentTarget).attr("data-foreground-video-config"))),playVideo(videoId,s7config)}function onClickClose(e){e.preventDefault(),resetVideo()}function cleanup(){angular.forEach(allButtons,function(button){button.removeEventListener("click",onClickPlay)}),questionSelect.off("change",onClickPlay),$window.removeEventListener("scroll.resetVideo",onScrollWindow),vidClose.removeEventListener("click",onClickClose)}var player,s7Player,vidOverlay=element[0].querySelector(".vid-wrap.vid-overlay"),bcVideoContainer=element.find("video.video-js"),vidClose=element[0].querySelector("button.close"),questionOptions=element.find("option"),questionSelect=element.find("select"),questionButtons=element.find("li"),questionList=element.find("ul"),allButtons=element[0].querySelectorAll('[data-action="play-video"]'),scrollPrompt=angular.element(".scroll-prompt"),randomSelect=element[0].getAttribute("data-random");scope.playing=!1;var videoId,placementId,videoName,duration,milestone,analyticsId=element[0].getAttribute("data-analytics-id"),moduleName=element[0].querySelectorAll("h2").length?element[0].querySelector("h2").textContent:element[0].querySelector(".background-alt-wrap").getAttribute("aria-label"),onDynamicMediaPlayerInit=function(viewer){s7Player=viewer,setPlacementId()},onDynamicMediaPlayerTrackEvent=function(objID,compClass,instName,timeStamp,eventInfo){if(eventInfo){var eventInfoSplit=eventInfo.split(","),eventName=eventInfoSplit[0];switch(eventName){case"LOAD":var videoPath=eventInfoSplit[6];videoPath&&videoPath.length>0&&(videoName=decodeURIComponent(videoPath));break;case"METADATA":var metadataName=eventInfoSplit[1],metadataValue=eventInfoSplit[2];switch(metadataName){case"DURATION":duration=Math.floor(metadataValue/1e3);break;case"SEEK":analyticsUtils.trackVideoSeeked(videoName,moduleName,placementId)}break;case"MILESTONE":milestone=eventInfoSplit[1]+"%",("25%"===milestone||"50%"===milestone||"75%"===milestone)&&analyticsUtils.trackVideoTimeUpdate(videoName,moduleName,placementId,milestone);break;case"PAUSE":analyticsUtils.trackVideoPause(videoName,moduleName,placementId);break;case"PLAY":analyticsUtils.trackVideoPlay(videoName,moduleName,placementId);break;case"STOP":analyticsUtils.trackVideoEnded(videoName,moduleName,placementId)}}};randomSelect&&(randomize(questionOptions,questionSelect),randomize(questionButtons,questionList)),capQuestions(),createLists(),angular.forEach(allButtons,function(button){button.addEventListener("click",onClickPlay)}),questionSelect.on("change",onClickPlay),vidClose.addEventListener("click",onClickClose),scope.$on("$destroy",cleanup)}}}askJohn.$inject=["$window","$document","$location","$timeout","utils","scene7","analyticsUtils"],angular.module("marketingCore").directive("askJohn",askJohn)}(angular),function(angular,lodash,CQ_Analytics){"use strict";function responseAggregatorServiceConstructor(aemRoutingService,commonServices,browseStateService,detailStateService,globalAssetRepositoryConstants,apiURLs,cqAnlyticesService,toggleService,httpRequest,httpRequestWrapper,commonUtils,searchOptionsService,cartConstants,responseTransformServiceDCPV2,creditClassService,dcpProductUtil){function getProducts(isFilter,filterCriteria,authorValue,model){productCategoryType=browseStateService.productCategoryType,me.authorValue=authorValue,setupAuthorValues(authorValue,productCategoryType);var productInfo={pageSize:model.itemsPerPage?model.itemsPerPage:authorValue.pageSize,pageNumber:model.currentPage};if(model.subNav.label&&(productInfo.accessoryCategory=model.subNav.label),registerAEMPersonalisationTags(productCategoryType),toggleService.model.toggles.mainPLPV2)url=apiURLs.snpMiniBrowse2;else{var browseApiUrl=apiURLs.product.host+apiURLs.product.browse.service+apiURLs.product.browse.parameters[productCategoryType];url=browseApiUrl+"&"+(isFilter?filterCriteria:"")}return isFilter&&$rootScope.$emit("pdlSelectedFilterAndSort",isFilter?filterCriteria:""),$log.log('Call to SnP api at: "" + url + "" started'),aemRoutingService.loadRoutingStates().then(function(response){lodash.forEach(response,function(value){value.data&&(value.data.defaultsku&&authorOverrideSKUs.push({offerId:value.data.offerId,defaultsku:value.data.defaultsku}),value.data.tradeInPromotions&&tradeInPromotions.push({offerId:value.data.offerId,tradeInPromotions:value.data.tradeInPromotions}))});var query=null,header={},authRequired=!0;return header=apiURLs.nonProdBrowseHeader?{"x-target":"b"}:{},toggleService.model.toggles.isCBSuccess=!1,toggleService.model.toggles.isCircuitBreaker&&(productCategoryType=browseStateService.productCategoryType,aemCachedBrowseUrl=toggleService.model.toggles.mainPLPV2?apiURLs.productv2.browse.failSafeParametersMain[productCategoryType]:apiURLs.product.browse.failSafeParametersMain[productCategoryType],header["cb-response"]=aemCachedBrowseUrl),toggleService.model.toggles.turnSnPOff&&(url=apiURLs.product.browse.failSafeParametersMain[browseStateService.productCategoryType]),toggleService.model.toggles.mainPLPV2?me.getPlpV2Response(url,productCategoryType,header,productInfo):httpRequestWrapper.get(url,query,header,authRequired).then(function(response){return $log.log('Call to SnP api at: "" + url + "" completed successfully'),transformBrowseResponse(response.data,!1)})["catch"](function(error,response){$log.error("Call to SnP api at:",url+" failed with response "+angular.toJson(response))})})}function transformBrowseResponse(data,isOffline){var transformedBrowseResponse={},categoryOptions=searchOptionsService.getCategorySearchOptions();
return transformedBrowseResponse.products=[],transformedBrowseResponse.isOffline=isOffline,transformedBrowseResponse["Accessory Categories"]=data["Accessory Categories"],transformedBrowseResponse.total=data.totals,lodash.forEach(data.values.products,function(oldFormatProduct){transformedBrowseResponse.products.push(transformProduct(oldFormatProduct))}),lodash.isEmpty(browseOrder)||"if"!==categoryOptions.selectedSortOption.name||(transformedBrowseResponse.products=sortCollection(transformedBrowseResponse.products,browseOrder,"productFamilyId")),transformedBrowseResponse}function transformProduct(oldProduct){var newProduct={},defaultOverrideSKU="";if(angular.isDefined(authorOverrideSKUs)){var defaultOverrideSKUMatch=lodash.filter(authorOverrideSKUs,function(match){return match.offerId===oldProduct.offerId});lodash.isEmpty(defaultOverrideSKUMatch)||(defaultOverrideSKU=defaultOverrideSKUMatch[0].defaultsku)}newProduct.productName=oldProduct.productDisplayName,newProduct.productFamilyId=oldProduct.offerId;var lowestPrice=lodash.min(lodash.map(lodash.split(oldProduct.salePriceSku,"|"),Number),function(match){return match.index}),lowestPriceSKUIndex=lodash.findIndex(lodash.map(lodash.split(oldProduct.salePriceSku,"|"),Number),function(match){return match===lowestPrice});newProduct.defaultSKU=lodash.isEmpty(defaultOverrideSKU)?lodash.split(oldProduct.skuCode,"|")[lowestPriceSKUIndex]:defaultOverrideSKU;var defaultSKUIndex=lodash.findIndex(lodash.split(oldProduct.skuCode,"|"),function(match){return match===newProduct.defaultSKU}),defaultColor="";oldProduct.deviceColorSKU&&(-1===defaultSKUIndex?lodash.split(oldProduct.deviceColorSKU,"|")[lowestPriceSKUIndex]:lodash.split(oldProduct.deviceColorSKU,"|")[defaultSKUIndex]);var colorOption=lodash.startCase(lodash.split(defaultColor.toLowerCase(),"_")[1]);newProduct.pdpURL={link:getProductDetailLink(productCategoryType,oldProduct.productDisplayName),options:""!==colorOption?"?color="+colorOption:""};var reviews={};reviews.aggregateRating=oldProduct.rating,reviews.noOfReviews=oldProduct.reviewCount,reviews.reviewStarImagePath=oldProduct.reviewStarImagePath,newProduct.reviews=reviews,newProduct.colors=setupProductSwatches(lodash.split(oldProduct.searchableColors,"|"),oldProduct,defaultOverrideSKU,newProduct.defaultSKU);var productOffers=[],offer={};offer.offerName=oldProduct.offerShortDescription,offer.offerDisplayName=oldProduct.offerDisplayName,offer.offerDescription=getGARImagePathForOfferModal(oldProduct.offerDescription),productOffers.push(offer),newProduct.offers=productOffers;var productSKUs=[],skus=lodash.split(oldProduct.skuCode,"|"),override=lodash.get(me.authorValue,"rootPage.overrideInvStatus.invStatusDetails",[]);return override=lodash.isArray(override)?override:[override],lodash.forEach(skus,function(skuValue,skuIndex){var sku={};sku.skuCode=skuValue,sku.color=lodash.split(oldProduct.deviceColorSKU,"|")[skuIndex],sku.colorName=lodash.startCase(lodash.split(sku.color.toLowerCase(),"_")[1]),sku.offerTitle=lodash.split(oldProduct.skuOfferDisplayName,"|")[skuIndex],lodash.isEmpty(sku.offerTitle)?(sku.offerTitle=lodash.isEmpty(newProduct.offers[0].offerName)?"":newProduct.offers[0].offerName,sku.offerDescription=lodash.isEmpty(newProduct.offers[0].offerDescription)?"":getGARImagePathForOfferModal(newProduct.offers[0].offerDescription)):(sku.offerTitle=sku.offerTitle,sku.offerDescription=lodash.split(oldProduct.skuOfferDescription,"|")[skuIndex],sku.offerDescription=lodash.isEmpty(sku.offerDescription)?"":getGARImagePathForOfferModal(sku.offerDescription)),sku.badges=setupSKULevelBadges(oldProduct,skuIndex),sku.memory=lodash.split(lodash.split(oldProduct.deviceMemorySKU,"|")[skuIndex],"_")[1],sku.priceTypeAvailableForEIP={good:lodash.split(oldProduct.itemEipPriceAvailableGC,"|")[skuIndex],average:lodash.split(oldProduct.itemEipPriceAvailableBC,"|")[skuIndex]},sku.priceTypeAvailableForFRP=lodash.split(oldProduct.priceTypeAvailableFRP,"|")[skuIndex],sku.offers=[],sku.thumbnail=getGARImagePath(lodash.split(oldProduct.thumbNail),"|")[skuIndex];var tradeInPromoForSKU=getTradeInPromoForSKU(skuValue,newProduct.productFamilyId);if(!lodash.isEmpty(tradeInPromoForSKU)){var offer={};offer.offerName=tradeInPromoForSKU.offerText,offer.offerDisplayName=tradeInPromoForSKU.offerText,offer.offerDescription=getGARImagePathForOfferModal(tradeInPromoForSKU.offerDescriptionHTML),sku.offers.push(offer)}sku.pricing=setupSKUPricing(productCategoryType,me.authorValue,sku,oldProduct,tradeInPromoForSKU,skuIndex),sku.availabilityRule=oldProduct.availabilityRule,lodash.forEach(override,function(item){angular.isString(item)&&(item=angular.fromJson(item)),sku.skuCode==item.sku&&item.status&&(sku.availabilityRule=item.status)}),sku.isComingSoon="NOT_AVAILABLE_COMING_SOON"===sku.availabilityRule||"COMING_SOON"===sku.availabilityRule,productSKUs.push(sku)}),newProduct.skus=productSKUs,newProduct}function registerAEMPersonalisationTags(productType){cqAnlyticesService.clearCQAnalytics(),angular.isDefined(CQ_Analytics)&&CQ_Analytics.TmobileStoreMgr&&(CQ_Analytics.TmobileStoreMgr.setProperty("browsePageType",productType),window.isB2B?CQ_Analytics.TmobileStoreMgr.setProperty("SiteType","Business"):CQ_Analytics.TmobileStoreMgr.setProperty("SiteType","Consumer"))}function setupProductSwatches(colors,oldProduct,defaultOverrideSKU,defaultSKUfromProduct){var colorSwatches=[];return lodash.forEach(colors,function(colorName,colorIndex){var colorSwatch={};colorSwatch.name=colorName,colorSwatch.displayName=lodash.startCase(lodash.split(colorName.toLowerCase(),"_")[1]),colorSwatch.colorSwatchURL=getGARImagePath(lodash.split(oldProduct.colorSwatch,"|")[colorIndex]);var colorIndexSKUWise=lodash.findLastIndex(lodash.split(oldProduct.deviceColorSKU,"|"),function(match){return match.toLowerCase()===colorName.toLowerCase()});colorSwatch.imageURL=getGARImagePath(lodash.split(oldProduct.thumbNail,"|")[colorIndexSKUWise]);var defaultColorIndex=lodash.findLastIndex(lodash.split(oldProduct.skuCode,"|"),function(value){return value===defaultSKUfromProduct}),defaultColor=lodash.find(lodash.split(oldProduct.deviceColorSKU,"|"),function(value,key){return key===defaultColorIndex});lodash.isEmpty(defaultColor)?0===colorIndex&&(colorSwatch.isDefault=!0):colorSwatch.isDefault=colorName===defaultColor;var colorSkuIndexes=lodash.map(lodash.split(oldProduct.deviceColorSKU,"|"),function(match){return match.toLowerCase()===colorName.toLowerCase()}),matchedSKUs=[],aemOverrideExistsForColor=!1;lodash.forEach(colorSkuIndexes,function(boolValue,colorSKUIndex){lodash.forEach(lodash.split(oldProduct.skuCode,"|"),function(sku,skuIndex){boolValue&&skuIndex===colorSKUIndex&&(matchedSKUs.push({sku:sku,price:Number(lodash.split(oldProduct.salePriceSku,"|")[colorSKUIndex])}),lodash.isEmpty(defaultOverrideSKU)||sku!==defaultOverrideSKU||(aemOverrideExistsForColor=!0))})}),colorSwatch.defaultSKU=aemOverrideExistsForColor?defaultOverrideSKU:void 0!==lodash.sortBy(matchedSKUs,"price")[0]?lodash.sortBy(matchedSKUs,"price")[0].sku:"",colorSwatches.push(colorSwatch)}),colorSwatches}function getGARImagePathForOfferModal(longDes){var longDescription=longDes;return toggleService.model.toggles.enableGar&&_.includes(longDes,"/content/dam")&&(longDescription=longDes.replace("/content/dam",globalAssetRepositoryConstants.url+"/content/dam")),longDescription}function getGARImagePath(imgPath){var imagePath=imgPath;return toggleService.model.toggles.enableGar&&_.includes(imgPath,"/content/dam")&&(imagePath=globalAssetRepositoryConstants.url+imgPath),imagePath}function setupSKULevelBadges(oldProduct,skuIndex){var productBadges=[],bogo="true"===lodash.split(oldProduct.bogoSku,"|")[skuIndex],webonly="true"===lodash.split(oldProduct.webOnlySku,"|")[skuIndex],onsale="true"===lodash.split(oldProduct.onSaleSku,"|")[skuIndex],specialoffer="true"===lodash.split(oldProduct.specialOfferSku,"|")[skuIndex],hotitem="true"===lodash.split(oldProduct.hotItemSku,"|")[skuIndex],newoffer="true"===lodash.split(oldProduct.isNewSku,"|")[skuIndex];return newoffer?productBadges.push({"new":!0,authorText:newAuthorText}):hotitem?productBadges.push({hotitem:!0,authorText:hotItemAuthorText}):webonly?productBadges.push({webonly:!0,authorText:webonlyAuthorText}):specialoffer?productBadges.push({specialoffer:!0,authorText:specialOfferAuthorText}):onsale?productBadges.push({onsale:!0,authorText:onSaleAuthorText}):bogo&&productBadges.push({bogo:!0,authorText:bogoAuthorText}),productBadges}function getProductDetailLink(categoryType,productName){var detailLink=detailStateService.getLinkToProductDetail(categoryType,productName);return detailLink=detailLink.replace(/%40|~2F|%2B|%23|%25|%5E|%26|%7B|%7D|%5B|%5D|%C2%AE|%E2%84%A2|%3A|%24|%2C|%22|%3F|'/gi,""),detailLink=detailLink.replace(/!.?()/gi,"-"),detailLink=detailLink.replace(/-+/g,"-"),detailLink=detailLink.replace(/'/g,"")}function setupAuthorValues(authorValue,productCategoryType){var globalAuthoring=lodash.get(authorValue,"rootPage.globalAuthoring",{});switch(globalAuthoring&&(bogoAuthorText=globalAuthoring.bogotxt,onSaleAuthorText=globalAuthoring.onsaletxt,hotItemAuthorText=globalAuthoring.hotitemtxt,webonlyAuthorText=globalAuthoring.webonlytxt,specialOfferAuthorText=globalAuthoring.specialtxt,newAuthorText=globalAuthoring.newtxt),productCategoryType){case"phone":browseOrder=lodash.get(authorValue,"rootPage.plpRankOrdering.deviceBrowseOrdering",[]);break;case"internet-device":browseOrder=lodash.get(authorValue,"rootPage.plpRankOrdering.tabletBrowseOrdering",[])}}function isEIPPricingDisplayEligible(productType,enableEIPAuthorFlag,nonEIPToggle,eipPriceTypeEligible){var eipDisplayEligibility=!0;return eipDisplayEligibility="accessory"===productType?nonEIPToggle?eipPriceTypeEligible:enableEIPAuthorFlag:nonEIPToggle?eipPriceTypeEligible:!0}function getTradeInPromoForSKU(sku,offerId){var parsedSKUTradeIn,tradeinPromo={};return lodash.each(tradeInPromotions,function(tradeInPromo){tradeInPromo.offerId===offerId&&lodash.each(tradeInPromo.tradeInPromotions,function(skuTradeIn){if(lodash.isEmpty(parsedSKUTradeIn)){parsedSKUTradeIn=angular.fromJson(skuTradeIn);var skuPromotion=lodash.find(lodash.split(parsedSKUTradeIn.skuIDs,","),function(response){return response===sku})}lodash.isEmpty(skuPromotion)||(tradeinPromo.offerText=parsedSKUTradeIn.offerText,tradeinPromo.offerDescriptionHTML=getGARImagePathForOfferModal(parsedSKUTradeIn.offerDescriptionHTML),tradeinPromo.recurringDiscount=parsedSKUTradeIn.recurringDiscount)})}),tradeinPromo}function setupSKUPricing(productCategoryType,authorValue,sku,oldProduct,tradeInPromoForSKU,skuIndex){var goodPricing={},averagePricing={},fullretailPricing={},showEIPSKUPricingforGoodCredit="true"===isEIPPricingDisplayEligible(productCategoryType,authorValue.rootPage.deviceBrowse.enableeipaccessories,toggleService.model.toggles.NonEipToggle,sku.priceTypeAvailableForEIP.good).toString(),showEIPSKUPRicingforAverageCredit="true"===isEIPPricingDisplayEligible(productCategoryType,authorValue.rootPage.deviceBrowse.enableeipaccessories,toggleService.model.toggles.NonEipToggle,sku.priceTypeAvailableForEIP.average).toString(),pricing={};return showEIPSKUPricingforGoodCredit&&(goodPricing.today=lodash.split(oldProduct.payNowGoodCredit_s,"|")[skuIndex],goodPricing.monthly=lodash.split(oldProduct.monthlyPriceGCS,"|")[skuIndex],goodPricing.contractTermGcs=lodash.split(oldProduct.contractTerm_GCS,"|")[skuIndex]),goodPricing.fullPrice=averagePricing.fullPrice=fullretailPricing.fullPrice=lodash.split(oldProduct.listPriceSku,"|")[skuIndex],goodPricing.purchasePrice=averagePricing.purchasePrice=fullretailPricing.purchasePrice=lodash.split(oldProduct.salePriceSku,"|")[skuIndex],showEIPSKUPRicingforAverageCredit&&(averagePricing.today=lodash.split(oldProduct.payNowBuildCredit_s,"|")[skuIndex],averagePricing.monthly=lodash.split(oldProduct.monthlyPriceBCS,"|")[skuIndex],averagePricing.contractTermBcs=lodash.split(oldProduct.contractTerm_BCS,"|")[skuIndex]),pricing.good=goodPricing,pricing.average=averagePricing,pricing.nocredit=fullretailPricing,pricing}function getPlpV2Response(apiUrl,categoryType,header,productInfo){var creditClass=creditClassService.getCreditClass()?creditClassService.getCreditClass()["class"]:"creditClass1",categoryOptions=searchOptionsService.getCategorySearchOptions(),filterObjects=[],responseWithPdpLink={};categoryOptions&&categoryOptions.selectedFilterOptions&&categoryOptions.selectedFilterOptions.length&&(filterObjects=categoryOptions.selectedFilterOptions);var requestData=dcpProductUtil.createBrowseRequest(categoryType,categoryOptions.selectedSortOption.name,filterObjects,productInfo);return httpRequestWrapper.post(apiUrl,requestData,null,header,!0,"plpV2").then(function(plpV2Response){return lodash.isEmpty(plpV2Response)||plpV2Response.status!==cartConstants.SUCCESS_CODE?httpRequestWrapper.get(aemCachedBrowseUrl).then(function(response){return 200!==response.status||_.isEmpty(response.data)||_.isEmpty(response.data.products)||(responseWithPdpLink=transformPLPV2Response(response,categoryType,creditClass,categoryOptions),toggleService.model.toggles.isCBSuccess=!0),responseWithPdpLink})["catch"](function(error,response){$log.error("Call to AEM at:",aemCachedBrowseUrl+" failed with response "+angular.toJson(response))}):responseWithPdpLink=transformPLPV2Response(plpV2Response,categoryType,creditClass,categoryOptions)})}function transformPLPV2Response(plpV2Response,categoryType,creditClass,categoryOptions){var transformedV2Response,responseWithPdpLink={};return plpV2Response.data&&plpV2Response.data.products?(transformedV2Response=categoryType===cartConstants.DEVICE_TYPE_IN_LOWER.ACCESSORY?responseTransformServiceDCPV2.getTransformedAccesoryV2APIResponse(lodash.get(plpV2Response,"data.products",[]),creditClass,!0):responseTransformServiceDCPV2.getTransformedDeviceV2APIResponse(plpV2Response,!0),lodash.isEmpty(transformedV2Response)||transformedV2Response.map(function(transformedProduct){transformedProduct.pdpURL={link:getProductDetailLink(categoryType,transformedProduct.productName),options:""},transformedProduct.skus.map(function(sku){sku.isComingSoon="NOT_AVAILABLE_COMING_SOON"===transformedProduct.availabilityRule||"COMING_SOON"===transformedProduct.availabilityRule})}),responseWithPdpLink.products=transformedV2Response,responseWithPdpLink.isOffline=!1,responseWithPdpLink.total={products:plpV2Response.data.metadata.totalRecordCount},lodash.isEmpty(browseOrder)||"if"!==categoryOptions.selectedSortOption.name||(responseWithPdpLink.products=sortCollection(transformedV2Response,browseOrder,"productFamilyId"))):(responseWithPdpLink.total={products:0},responseWithPdpLink.products=[]),responseWithPdpLink}var productCategoryType,bogoAuthorText,onSaleAuthorText,specialOfferAuthorText,hotItemAuthorText,newAuthorText,webonlyAuthorText,browseOrder,url,aemCachedBrowseUrl,me=this,$log=commonServices.$log,$rootScope=commonServices.$rootScope,sortCollection=commonUtils.sortCollection,authorOverrideSKUs=[],tradeInPromotions=[];return me.getProducts=getProducts,me.isOffline=!1,me.authorValue={},me.getPlpV2Response=getPlpV2Response,me}responseAggregatorServiceConstructor.$inject=["aemRoutingService","commonServices","browseStateService","detailStateService","globalAssetRepositoryConstants","apiURLs","cqAnlyticesService","toggleService","httpRequest","httpRequestWrapper","commonUtils","searchOptionsService","cartConstants","responseTransformServiceDCPV2","creditClassService","dcpProductUtil"],angular.module("tmobileBrowse").service("responseAggregatorService",responseAggregatorServiceConstructor)}(window.angular,window._,window.CQ_Analytics),function(angular,lodash){"use strict";function cardCarousel($compile,$window,$location,analyticsUtils,viewport,utils){return{restrict:"A",link:function(scope,element,attr){function onInit(e,slick){var clonedCard=element[0].querySelectorAll(".card-slick-carousel .slick-cloned");if(!viewport.breakpointUp("desktop")&&utils.isTouch()&&(element[0].className+=" touch-device"),!active&&element[0].querySelector(".slick-prev").className.indexOf("slick-disabled")<0){element[0].querySelector(".slick-prev").className+=" slick-disabled";for(var invisibleCards=element[0].querySelectorAll('[data-slick-index^="-"]'),i=0;i<invisibleCards.length;i++)invisibleCards[i].style.visibility="hidden"}angular.forEach(clonedCard,function(el){null!==el.querySelector("[modal-content]")&&(el.querySelector("[modal-content]").removeAttribute("data-modal"),el.querySelector("[modal-content]").removeAttribute("modal-content")),null!==el.querySelector(".legal-modal")&&el.querySelector(".legal-modal").removeAttribute("data-modal-id"),$compile(angular.element(el))(scope)});for(var j=0,parentNode=element[0].parentElement;null!==(parentNode=parentNode.previousElementSibling);)j++;0===j&&angular.element($window).triggerHandler("resize"),slick.$slider[0].style.opacity="1",disableTabIndex(),isVideoCarousel&&populateSocial()}function disableTabIndex(){var carouselCards=element[0].querySelectorAll(".carousel-card");lodash.forEach(carouselCards,function(carouselCard){var carouselLinks=carouselCard.getElementsByTagName("a");lodash.forEach(carouselLinks,function(carouselLink){utils.isCarouselCardInView(carouselLink)?carouselLink.setAttribute("tabindex","0"):carouselLink.setAttribute("tabindex","-1")})})}function onAfterChange(e,slick,currentSlide){var reg=new RegExp("(\\s|^)slick-disabled(\\s|$)");element[0].querySelector(".slick-prev").className=element[0].querySelector(".slick-prev").className.replace(reg," ");for(var invisibleCards=element[0].querySelectorAll('[data-slick-index^="-"]'),i=0;i<invisibleCards.length;i++)invisibleCards[i].style.visibility="visible";active=!0,disableTabIndex(),analyticsUtils.trackCarousel(currentSlide>prevSlide,element)}function onBeforeChange(e,slick,currentSlide,nextSlide){prevSlide=currentSlide}function populateSocial(){for(var videoCards=element[0].querySelectorAll(".video-card"),i=0;i<videoCards.length;i++){var fbShare,twitShare,videoID=videoCards[i].querySelector("[data-video-id]").getAttribute("data-video-id"),headline=encodeURIComponent(videoCards[i].querySelector("h3").textContent),quote=encodeURIComponent(videoCards[i].querySelector("p").textContent),imgPath=videoCards[i].getAttribute("data-desktop-rendition"),shareImage=encodeURIComponent(baseUrl+imgPath),shareUrl=encodeURIComponent(url+"?section="+sectionID+"&video="+videoID+"#"+sectionID);"undefined"!=typeof imgPath&&(imgPath.match(/^https/)?(shareImage=encodeURIComponent(imgPath),fbShare="u="+shareUrl+"&title="+headline+"&quote="+quote+"&description="+quote+"&picture="+shareImage+"&redirect_uri=http%3A%2F%2Fwww.facebook.com%2F",twitShare="text="+headline+"%20-%20"+quote+"&url="+shareUrl+"&original_referer="+encodeURIComponent(url),videoCards[i].querySelector(".facebook.social").setAttribute("href","https://www.facebook.com/sharer/sharer.php?"+fbShare),videoCards[i].querySelector(".twitter.social").setAttribute("href","https://twitter.com/intent/tweet?"+twitShare)):(shareImage=encodeURIComponent(baseUrl+imgPath),fbShare="u="+shareUrl+"&title="+headline+"&quote="+quote+"&description="+quote+"&picture="+shareImage+"&redirect_uri=http%3A%2F%2Fwww.facebook.com%2F",twitShare="text="+headline+"%20-%20"+quote+"&url="+shareUrl+"&original_referer="+encodeURIComponent(url),videoCards[i].querySelector(".facebook.social").setAttribute("href","https://www.facebook.com/sharer/sharer.php?"+fbShare),videoCards[i].querySelector(".twitter.social").setAttribute("href","https://twitter.com/intent/tweet?"+twitShare)))}}function cleanup(){scope.slickConfig&&scope.slickConfig.method.unslick()}var active,prevSlide,isVideoCarousel=element[0].querySelector(".video-slick-carousel"),baseUrl=$location.protocol()+"://"+$location.host()+(80!==$location.port()?":"+$location.port():""),url=baseUrl+$location.path(),sectionID=element[0].getAttribute("data-module-id");element.on("click",".content-section a.tmo-modal-link",function(a){analyticsUtils.trackGenericClick(a.currentTarget)}),scope.slickConfig&&(scope.slickConfig.event.init=onInit,scope.slickConfig.event.afterChange=onAfterChange,scope.slickConfig.event.beforeChange=onBeforeChange),scope.$on("$destroy",cleanup)}}}cardCarousel.$inject=["$compile","$window","$location","analyticsUtils","viewport","utils"],angular.module("marketingCore").directive("cardCarousel",cardCarousel)}(window.angular,window._),function(angular,_){"use strict";function searchOptionsServiceConstructor(commonServices,apiURLs,toggleService){function getFilterAndSortQueryString(){var queryString=[],categorySearchOptions=getCategorySearchOptions(),selectedFilters=categorySearchOptions.selectedFilterOptions,selectedSortOption=categorySearchOptions.selectedSortOption;if(!_.isEmpty(selectedFilters)){var filterGroups=_.groupBy(selectedFilters,"groupKey");angular.forEach(filterGroups,function(group,key){var filterNames=_.map(group,"label");angular.forEach(filterNames,function(filterName,key){filterNames[key]=encodeURIComponent(filterName)}),queryString.push(key+"="+filterNames.join("|").toLowerCase())})}return _.isEmpty(selectedSortOption)||_.isEmpty(selectedSortOption.name)||queryString.push(selectedSortOption.key+"="+selectedSortOption.name),_.isEmpty(queryString)?"":queryString.join("&")}function getCategorySearchOptions(productCategoryType){var index=angular.isDefined(productCategoryType)&&!_.isEmpty(productCategoryType)?productCategoryType:currentProductCategoryType;return loadedSearchOptionsByCategory[index]}function getFilterOptionByName(name){var requestedFilter;if(angular.isDefined(name)&&angular.isString(name)){var filterName=name.replace(".html",""),options=getCategorySearchOptions();_.find(options.filterGroups,function(filterGroup){var filter=_.find(filterGroup.options,{transformlabel:filterName});return angular.isDefined(filter)?(requestedFilter=filter,!0):void 0})}return requestedFilter}function removeSpecialcharacter(filterOption){var updatedFilterOption=filterOption.replace(/[^a-zA-Z0-9_-]/g,"");return updatedFilterOption}function initializeSearchOptions(productCategoryType){_.isEmpty(productCategoryType)||(currentProductCategoryType=productCategoryType);var sortOptionName="Sort By";if(angular.isDefined($location.search().sort)&&(sortOptionName=$location.search().sort),!_.isEmpty(sortOptionName)){var categoryOptions=getCategorySearchOptions();categoryOptions.selectedSortOption=_.find(categoryOptions.sortConfig.options,{name:sortOptionName}),_.isEmpty(categoryOptions.selectedSortOption)&&(categoryOptions.selectedSortOption=angular.isDefined(categoryOptions.sortConfig.options)?categoryOptions.sortConfig.options["accessory"===currentProductCategoryType?1:0]:"pr")}return getCategorySearchOptions()}function transformSearchOptionsResponse(data,headersGetter,status){if(status>=400)return data;var jsonData=angular.fromJson(data),filterGrpOpts=toggleService.model.toggles.mainPLPV2?jsonData.filterGroupsV2:jsonData.filterGroups;_.forEach(filterGrpOpts,function(filterGroup){filterGroup.isOpen=!1,_.forEach(filterGroup.options,function(filterOption){filterOption.selected=!1,filterOption.groupKey=filterGroup.key})});var sortOptions,sortConfig=_.get(toggleService.model,"toggles.mainPLPV2",!1)?jsonData.sortConfigV2[0]:jsonData.sortConfig;return sortOptions=sortConfig.options,angular.forEach(sortOptions,function(option){option.key=sortConfig.key}),jsonData.sortConfig.options=sortOptions,$rootScope.$emit("pdlFilterAndSortOptions",jsonData),jsonData}function transformFiltersOptions(filterGroups){var transformFilterOptionsList=[];return _.forEach(filterGroups,function(filterGroup){var obj={},filterKey=filterGroup.key;obj.key=filterKey,obj.title=filterGroup.title;var transformfilterNamesArray=[];_.forEach(filterGroup.options,function(filterOption){var transformfilterNameMap={},transformObjlabel=modifyFilternameAsPerRules(filterOption.label);transformfilterNameMap.groupKey=filterKey,transformfilterNameMap.label=filterOption.label,transformfilterNameMap.transformlabel=transformObjlabel,transformfilterNameMap.name=filterOption.name,transformfilterNamesArray.push(transformfilterNameMap)}),obj.options=transformfilterNamesArray,transformFilterOptionsList.push(obj)}),transformFilterOptionsList}function modifyFilternameAsPerRules(label){return label=label.contains("&amp;")?label.replace("&amp;","&"):label,label=label.contains("$")?label.replace("$",""):label,label=label.contains("&reg;")?label.replace("&reg;",""):label,label=label.contains("®")?label.replace("®",""):label,removeSpecialcharacter(label.replace(/[^a-zA-Z0-9()_-|+]/g,"-").replace(/-{2,}/g,"-").replace(/\(|\)/g,"").toLowerCase())}function loadSearchOptions(productCategoryType){function fail(error){$log.error("Could Not Load loadedSearchOptionsByCategory from %s",url,angular.toJson(error)),deferred.reject(error)}function success(response){if(response.status>=400)return fail(response);var data=response.data,dataForFilterGroup=toggleService.model.toggles.mainPLPV2?data.filterGroupsV2:data.filterGroups;loadedSearchOptionsByCategory[productCategoryType]={categoryType:data.categoryType,filterGroups:transformFiltersOptions(dataForFilterGroup),selectedFilterOptions:[],transformFilterOptionslist:[],sortConfig:toggleService.model.toggles.mainPLPV2?data.sortConfigV2[0]:data.sortConfig,selectedSortOption:{},accessoryCategory:data.accessoryCategory},deferred.resolve()}var deferred=$q.defer();if(_.isEmpty(productCategoryType)||!angular.isString(productCategoryType))return $q.reject("no product category type provided");if(currentProductCategoryType=productCategoryType,angular.isDefined(getCategorySearchOptions(productCategoryType)))deferred.resolve();else{var url=apiURLs.searchOptions+"."+productCategoryType+".json";$http.get(url,{authRequired:!1,cache:!0,transformResponse:transformSearchOptionsResponse}).then(success,fail)}return deferred.promise}var currentProductCategoryType,me=this,$log=commonServices.$log,$q=commonServices.$q,$http=commonServices.$http,$location=commonServices.$location,$rootScope=commonServices.$rootScope,loadedSearchOptionsByCategory={};return $log.log("searchOptionsService -- loaded and initialized"),me.getCategorySearchOptions=getCategorySearchOptions,me.loadSearchOptions=loadSearchOptions,me.initializeSearchOptions=initializeSearchOptions,me.getFilterOptionByName=getFilterOptionByName,me.getFilterAndSortQueryString=getFilterAndSortQueryString,me}searchOptionsServiceConstructor.$inject=["commonServices","apiURLs","toggleService"],angular.module("tmobileBrowse").service("searchOptionsService",searchOptionsServiceConstructor)}(angular,_),function(angular){"use strict";function contactForm($window,$timeout,utils,analyticsUtils){return{restrict:"A",link:function(scope,element,attr){function cleanup(){}"true"===sessionStorage.getItem("business-contact-success")&&($timeout(function(){angular.element(".contact-form .initial-state, .contact-form .fieldset").remove(),angular.element(".contact-form .success-state").show().attr("tabindex","-1").focus(),element.attr("data-module-id",attr.moduleId+"-success");var modalLink=angular.element('[href="#'+attr.moduleId+'"]');modalLink.length?modalLink.first().click():$timeout(function(){angular.element(".contact-form.display-section").length&&$window.scrollTo(0,angular.element(".contact-form.display-section").offset().top)},0)},1e3),sessionStorage.removeItem("business-contact-success")),element.find("input, select").on("focus",function(e){angular.element(e.currentTarget).closest(".input-wrapper").addClass("active")}),element.find("input, select").on("blur",function(e){angular.element(e.currentTarget).closest(".input-wrapper").removeClass("active")}),element.find('input[type="checkbox"]').on("change",function(e){analyticsUtils.trackCheckbox(angular.element(e.currentTarget).is(":checked"),element)}),scope.$on("renderGrecaptcha",function(){utils.pollForGlobal("grecaptcha").then(function(){scope.grecaptchaId=grecaptcha.render(element.find("#grecaptcha-"+scope.vm.settings.moduleId)[0],{size:"invisible",badge:"inline",sitekey:scope.vm.settings.siteId,callback:scope.vm.onExecuteGrecaptcha,"expired-callback":scope.vm.onExpireGrecaptcha})})}),scope.$on("submitted",function(e){if(scope.vm.businessContactForm.$invalid){var errorElement=element.find(".input-wrapper.error:first input");errorElement.focus(),$window.scrollTo(0,errorElement.next(".error-msg").offset().top-angular.element(".global-header").height())}"true"===sessionStorage.getItem("business-contact-success")&&analyticsUtils.trackForm({eventType:"form complete",analyticsID:scope.vm.settings.analyticsID,submitText:submitCTA,modal:isModal,formName:formName})});var contactForms=element[0].querySelector("form"),submitCTA=contactForms.querySelector('[type="submit"]').innerText,isModal="dialog"===element[0].dataset.uiMode,formName=element[0].querySelector("h2").innerText;scope.$on("$destroy",cleanup)}}}contactForm.$inject=["$window","$timeout","utils","analyticsUtils"],angular.module("marketingCore").directive("contactForm",contactForm)}(window.angular),function(angular){"use strict";function BVReviewServiceConstructor($window,bvServiceUrl,$rootScope,pdlService,$document,$cookies){function initializeReviewsForDeviceId(deviceId){if(angular.isDefined(typeof $BV)){var productSlug="",hostname=$window.location.host,hrefSplit=$window.location.href.split("/");hrefSplit&&hrefSplit.length>0&&(productSlug=hrefSplit[hrefSplit.length-1]);var submitContainer=$window.location.protocol+"//"+hostname+"/content/t-mobile/write-a-review."+productSlug;$window.$BV.configure("global",{submissionContainerUrl:submitContainer}),$window.$BV.ui("rr","show_reviews",{productId:deviceId})}}function setBVReviews(deviceId){$.getScript(bvServiceUrl).done(function(data,status){initializeReviewsForDeviceId(deviceId),$rootScope.$broadcast("bvReviewNotification")}),captureReviewAnalytics()}function captureReviewAnalytics(){var pageHeight=$document.context.documentElement.scrollTop>.4*$document.context.body.scrollHeight;pageHeight&&"true"===$cookies.get("loadPDLGenerated")&&pdlService.loadProductReviewsEvent()}return{setBVReviews:setBVReviews,captureReviewAnalytics:captureReviewAnalytics}}BVReviewServiceConstructor.$inject=["$window","bvServiceUrl","$rootScope","pdlService","$document","$cookies"],angular.module("tmobileApp").service("BVReviewService",BVReviewServiceConstructor)}(angular),function(angular){"use strict";angular.module("tmobileCore").constant("tmobileAppConfig",{env:"dev",aemIntegration:!0}).constant("apiZoomLevel",{updateCart:"lineitems:element:item:definition,lineitems:element:item:code,lineitems:element:item:price,total,monthlyprice,paynowprice,lineitems:element:line:paynowprice,lineitems:element:line:monthlyprice,lineitems:element:line:device:selected,lineitems:element:line:device:selected:availability,lineitems:element:line:device:selected:item:definition,lineitems:element:line:device:selected:paynowprice,lineitems:element:line:device:selected:monthlyprice,refundable-deposit,lineitems:element:line:plan:selected,lineitems:element:line:plan:selected:item:definition,lineitems:element:line:plan:selected:paynowprice,lineitems:element:line:plan:selected:monthlyprice,lineitems:element:line:device:selected:price,lineitems:element:line:service:selected:item:definition,lineitems:element:line:service:selected:item:monthlyprice,lineitems:element:item:definition,lineitems:element:item:price,lineitems:element:line:device:selected:item:code,line:device:selected:item:definition:options:element,line:device:selected:item:definition:options:element:value,lineitems:element:line:plan:selected:item:code,lineitems:element:item:paynowprice,lineitems:element:item:monthlyprice,lineitems:element,accessoriestotal",planDetails:"monthlyprice,paynowprice,definition,definition:item,definition:options:element:value",creditClass:"monthlyprice,paynowprice",loadCheckOut:"lineitems:lineitems:element:item:definition,lineitems:element:item:code,lineitems:element:item:price,total,monthlyprice,paynowprice,lineitems:element:line:paynowprice,lineitems:element:line:monthlyprice,lineitems:element:line:device:selected,lineitems:element:line:device:selected:availability,lineitems:element:line:device:selected:item:definition,lineitems:element:line:device:selected:item:definition:options:element:value,lineitems:element:line:device:selected:paynowprice,lineitems:element:line:device:selected:monthlyprice,refundable-deposit,lineitems:element:line:plan:selected,lineitems:element:line:plan:selected:item:definition,lineitems:element:line:plan:selected:item:definition:options:element:value,lineitems:element:line:plan:selected:paynowprice,lineitems:element:line:plan:selected:monthlyprice,lineitems:element:line:device:selected:price,lineitems:element:line:service:selected:item:definition,lineitems:element:line:service:selected:item:monthlyprice,lineitems:element:item:definition,lineitems:element:item:price,lineitems:element:line:device:selected:item:code,lineitems:element:line:plan:selected:item:code,lineitems:element:line:service:selected:item:code,order:deliveries:element:destinationinfo:selector:chosen:description,order:billingaddressinfo:selector:chosen:description,order:paynowprice,order:monthlyprice,lineitems:element:item:paynowprice,lineitems:element:item:monthlyprice,lineitems:element,accessoriestotal",
servicesLookUp:"addtolineform,constituentselectorform,constituentselectorform:addtolineform,itemconfiguration,itemconfiguration:item:code,itemconfiguration:item:definition,itemconfiguration:item:monthlyprice,itemconfiguration:constituentselectorform",defaultCart:"lineitems:element:item:definition,lineitems:element:item:code,lineitems:element:item:price,total,monthlyprice,paynowprice,lineitems:element:line:paynowprice,lineitems:element:line:monthlyprice,lineitems:element:line:device:selected,lineitems:element:line:device:selected:availability,lineitems:element:line:device:selected:item:definition,lineitems:element:line:device:selected:paynowprice,lineitems:element:line:device:selected:monthlyprice,refundable-deposit,lineitems:element:line:plan:selected,lineitems:element:line:plan:selected:item:definition,lineitems:element:line:plan:selected:paynowprice,lineitems:element:line:plan:selected:monthlyprice,lineitems:element:line:device:selected:price,lineitems:element:line:service:selected:item:definition,lineitems:element:line:service:selected:item:monthlyprice,lineitems:element:item:definition,lineitems:element:item:price,lineitems:element:line:device:selected:item:code,lineitems:element:line:device:selected:item:definition:options:element,lineitems:element:line:device:selected:item:definition:options:element:value,lineitems:element:line:plan:selected:item:definition,lineitems:element:line:plan:selected:item:definition:options:element,lineitems:element:line:plan:selected:item:definition:options:element:value,lineitems:element:line:plan:selected:item:code,lineitems:element:line:service:selected:item:code,lineitems:element,accessoriestotal",creditCard:"order:creditcardinfo:creditcardform,order:monthlyprice,order:total,order:tax,order:deliveries:element:shippingoptioninfo:selector:chosen:description,order:paynowprice",legalAgreement:"order:legalagreementform",servicesBundling:"addtolineform,constituentselectorform"}).constant("aemApiURLs",{productDetails:"https://tmobileh-sb02.apigee.net/raptor/v1/productDetails/HOAppleiPhone6s?",faqData:"app/productDetails/data/QuestionAnsw.json"}).constant("staticData",{countries:["State","AL","AK","AZ","AR","CA","CO","CT","DE","DC","FL","GA","HI","ID","IL","IN","IA","KS","KY","LA","ME","MD","MA","MI","MN","MS","MO","MT","NE","NV","NH","NJ","NM","NY","NC","ND","OH","OK","OR","PA","RI","SC","SD","TN","TX","UT","VT","VA","WA","WV","WI","WY"]}).constant("slickCarouselBreakpoints",{lg:1200,md:992,sm:768,xs:320}).constant("bvServiceUrl","//t-mobile.ugc.bazaarvoice.com/static/9060redes2-en_us/bvapi.js").constant("AEM_RUNTIME",{isHost:window.location.pathname.indexOf("/content/")>=0,isAuthor:angular.isDefined(window.AEMmode)&&window.AEMmode.isAuthor,isPublisher:(angular.isUndefined(window.AEMmode)||!window.AEMmode.isAuthor)&&window.location.pathname.indexOf("/content/")>=0}).constant("AEM_RUNTIME_SERVER",{isWebserver:window.location.hostname.indexOf("publisher")>=0||window.location.hostname.indexOf("author")>=0||window.location.port.indexOf("4503")>=0||window.location.port.indexOf("4502")>=0||window.location.hostname.indexOf("adobecqms.net")>=0}).constant("GlobalConstants",window.globalConstants).constant("inventoryAPI",{apiKey:"inventoryAPI",interactionid:"getInventoryAvailabilityByProductAndLocation",applicationid:"frontend",channelid:"web",activityid:"ae8fcfc4-da53-4cbb-be05-8b7927723e54"}).constant("geoLocationConstants",{adobeLocationLatitude:"profile.geoLatitude",adobeLocationLongitude:"profile.geoLongitude",geoLocation:"geolocation",permissionGranted:"granted",cookiesLanguage:"MP_LANG",englishLanguage:"en",spanishLanguage:"es"}).constant("storeLocatorModalContainerConstants",{searchResultView:"searchResultView",stateResultsView:"stateResultsView",sectionToDisplay:"sectionToDisplay"}).constant("globalAssetRepositoryConstants",{url:"https://cdn.tmobile.com"}).constant("jwtConfigConstants",{crypto:{algorithm:"RSASSA-PKCS1-v1_5",hash:"SHA-256"},indexedDB:{dbName:"tmo-db",storeName:"tmo-key-store",jwtKeyName:"tmo-jwk-pair"},token:{timetolive:3600}}).constant("tokenTtl",{token:{timetolive:80280}}).run(["$log","globalConfig","GlobalConstants",function($log,globalConfig,GlobalConstants){externalLogger.moduleRun("tmobileCore","app.constants.js"),window.__karma__||externalLogger.setAllowedMethods(globalConfig.allowedLogLevels)}])}(angular),function(angular){"use strict";function backToTopDirectiveConstructor(){return{restrict:"EA",controller:["$scope",function($scope){"ngInject";$scope.scrollToTop=function(){angular.element("html,body").animate({scrollTop:angular.element(".container-main").offset().top},"slow")}}]}}angular.module("tmobileApp").directive("backToTop",backToTopDirectiveConstructor)}(angular),function(angular,lodash){"use strict";function shippingUtilConstructor(coreServices,checkOutModelService,checkOutValidationUtil,commonServices,checkOutConstants,responseTransformationService,apiService,dataFactory,toggleService,urlConstants,mpLocalizationService){function errorHandler(error){return commonServices.$log.log("Something went wront: ",error),error}function getShippingOptions(){var cartId=cartStorage.getCartId(),shippingOptionsUrlObject=apiService.getURL("shippingOptionsUrl"),shippingOptionsAPIUrl=shippingOptionsUrlObject.url;return lodash.get(toggleService.model,"toggles.isDcpV3ApiEnabled",!1)?shippingOptionsAPIUrl=shippingOptionsAPIUrl.replace("{{cartID}}",cartId):shippingOptionsAPIUrl+=cartId,cartId?httpRequestWrapper.get(shippingOptionsAPIUrl,null,null,!0):null}function getShippingOrderFees(){return httpRequestWrapper.get(apiURLs.ShippingOrderFees,null,null,!0)}function showHideBilling(addressForm,addressType){"bill"===addressType&&(checkOutModelService.model.checkOutInfo.billSameAsShip?(checkOutModelService.model.checkOutInfo.billInfo={},checkOutValidationUtil.resetBillingAddress(addressForm,addressType)):(checkOutModelService.model.checkOutInfo.billInfo=angular.copy(checkOutModelService.model.checkOutInfo.shipInfo),checkOutValidationUtil.resetBillingAddress(addressForm,addressType))),"e911"===addressType&&(checkOutModelService.model.checkOutInfo.e911SameAsShip?(checkOutModelService.model.checkOutInfo.e911Info={},checkOutValidationUtil.resetBillingAddress(addressForm,addressType)):(checkOutModelService.model.checkOutInfo.e911Info=angular.copy(checkOutModelService.model.checkOutInfo.shipInfo),checkOutValidationUtil.resetBillingAddress(addressForm,addressType)))}function shippingOptionChange(optionDeliveryTime,optionUrl){checkOutModelService.model.checkOutInfo.shipInfo.shippingOption=optionDeliveryTime,checkOutModelService.model.checkOutInfo.shipInfo.shippingOptionUrl=optionUrl,angular.forEach(checkOutModelService.model.checkOutInfo.initData.selectedShippingOptions,function(value){value.selected=angular.equals(value.deliveryTime,optionDeliveryTime)})}function shippingOptionChangeV3(shippingType,optionUrl){checkOutModelService.model.checkOutInfo.shipInfo.shippingOption=shippingType,checkOutModelService.model.checkOutInfo.shipInfo.shippingOptionUrl=optionUrl,angular.forEach(checkOutModelService.model.checkOutInfo.initData.selectedShippingOptions,function(value){value.selected=angular.equals(value.shippingType,shippingType)})}function submitShippingData(){var userSelectedShippingOption=checkOutModelService.model.checkOutInfo.shipInfo,dcpSelectedShippingOption=checkOutModelService.model.checkOutInfo.initData.dcpSelectedShippingOption;if(angular.isDefined(userSelectedShippingOption.shippingOptionUrl)&&dcpSelectedShippingOption.deliveryTime!==userSelectedShippingOption.shippingOption){var url=userSelectedShippingOption.shippingOptionUrl+"?auth_token="+coreServices.cartStorage.getCartToken();httpRequestWrapper.post(url).then(function(shippingDataResponse){angular.equals(shippingDataResponse.status,200)?getShippingOptions().then(function(shippingOptionsResponse){checkOutModelService.model.checkOutInfo.initData.selectedShippingOptions=transformService.transformShippingOptionsResponse(shippingOptionsResponse.data),checkOutModelService.model.checkOutInfo.initData.dcpSelectedShippingOption=transformService.transformShippingOptionsResponse(shippingOptionsResponse.data),dcpSelectedShippingOption=lodash.find(checkOutModelService.model.checkOutInfo.initData.dcpSelectedShippingOption,function(option){return"true"===option.selected}),coreServices.cartStorage.setShippingOption(dcpSelectedShippingOption),postShippingAddress().then(postShippingAddressRsHandler)}):(commonServices.$log.log("Error in PostShippingData- Response:",shippingDataResponse),checkOutModelService.model.errors.displayErrorMessage=!0)})["catch"](errorHandler)}else postShippingAddress().then(postShippingAddressRsHandler)["catch"](errorHandler)}function setShippingInputData(){return{shippingAddress:{"given-name":checkOutModelService.model.checkOutInfo.personalInfo.firstName,"family-name":checkOutModelService.model.checkOutInfo.personalInfo.lastName,"country-name":"US",locality:checkOutModelService.model.checkOutInfo.shipInfo.city,"postal-code":checkOutModelService.model.checkOutInfo.shipInfo.zip,region:checkOutModelService.model.checkOutInfo.shipInfo.state,"street-address":checkOutModelService.model.checkOutInfo.shipInfo.address1,addressLine2:checkOutModelService.model.checkOutInfo.shipInfo.address2,isShippingAddressasBilling:checkOutModelService.model.checkOutInfo.shipInfo.isShippingAddressasBilling,isShippingAddressasE911:checkOutModelService.model.checkOutInfo.shipInfo.isShippingAddressasE911},billingAddress:{"country-name":"US",locality:checkOutModelService.model.checkOutInfo.billInfo.city,"postal-code":checkOutModelService.model.checkOutInfo.billInfo.zip,region:checkOutModelService.model.checkOutInfo.billInfo.state,"street-address":checkOutModelService.model.checkOutInfo.billInfo.address1,addressLine2:checkOutModelService.model.checkOutInfo.billInfo.address2},e911Address:{"country-name":"US",locality:checkOutModelService.model.checkOutInfo.e911Info.city,"postal-code":checkOutModelService.model.checkOutInfo.e911Info.zip,region:checkOutModelService.model.checkOutInfo.e911Info.state,"street-address":checkOutModelService.model.checkOutInfo.e911Info.address1,addressLine2:checkOutModelService.model.checkOutInfo.e911Info.address2}}}function setAddressInfo(){var inputData=setShippingInputData(),url=apiURLs.checkoutSetAddress.replace("{{orderID}}",cartStorage.getOrderId());return httpRequestWrapper.post(url,inputData,null,null,!0)}function postShippingAddress(){checkOutModelService.model.checkOutInfo.billSameAsShip?(checkOutModelService.model.checkOutInfo.billInfo=checkOutModelService.model.checkOutInfo.shipInfo,checkOutModelService.model.checkOutInfo.shipInfo.isShippingAddressasBilling="true"):checkOutModelService.model.checkOutInfo.shipInfo.isShippingAddressasBilling="false",checkOutModelService.model.checkOutInfo.e911SameAsShip?(checkOutModelService.model.checkOutInfo.e911Info=checkOutModelService.model.checkOutInfo.shipInfo,checkOutModelService.model.checkOutInfo.shipInfo.isShippingAddressasE911="true"):checkOutModelService.model.checkOutInfo.shipInfo.isShippingAddressasE911="false";var promises={setAddressInfo:setAddressInfo(),getShippingOrderFees:getShippingOrderFees()};return commonServices.$q.all(promises).then(function(response){return angular.equals(checkOutConstants.OKSTATUS,response.setAddressInfo.statusText)&&angular.equals(checkOutConstants.OKSTATUS,response.getShippingOrderFees.statusText)?(checkOutModelService.model.checkOutInfo.subTotal.oneTimeFees=response.getShippingOrderFees.data.Cost.displayValue,checkOutConstants.OKSTATUS):checkOutConstants.FAILEDSTATUS})["catch"](errorHandler)}function postShippingAddressRsHandler(postShippingResponse){if(angular.equals(postShippingResponse,checkOutConstants.FAILEDSTATUS))checkOutModelService.setSectionToBeDisplayed(checkOutConstants.SECTIONS.INFOANDSHIPPING),checkOutModelService.model.errors.displayErrorMessage=!0;else{checkOutModelService.setSectionToBeDisplayed(checkOutConstants.SECTIONS.PAYMENTANDCREDIT);var dataCache=dataFactory.getCacheObject(checkOutConstants.CACHE.NAME),dataObject={shipInfo:checkOutModelService.model.checkOutInfo.shipInfo,billInfo:checkOutModelService.model.checkOutInfo.billInfo,e911Info:checkOutModelService.model.checkOutInfo.e911Info,personalInfo:checkOutModelService.model.checkOutInfo.personalInfo,billSameAsShip:checkOutModelService.model.checkOutInfo.billSameAsShip,e911SameAsShip:checkOutModelService.model.checkOutInfo.e911SameAsShip,chosenShipping:checkOutModelService.model.checkOutInfo.chosenShipping};dataCache.put(checkOutConstants.CACHE.DATA_KEY,dataObject)}}function getProfileAddressList(ignoreLoadingBarParam){var profileId=cartStorage.getProfileId(),addressListUrlObject=apiService.getURL("getAddressList"),addressListAPIUrl=addressListUrlObject.url;addressListAPIUrl=addressListAPIUrl.replace("{{profileID}}",profileId);var query=angular.isUndefined(ignoreLoadingBarParam)?null:{ignoreLoadingBar:ignoreLoadingBarParam};return profileId?httpRequestWrapper.get(addressListAPIUrl,query,null,!0):null}function getFormAddress(type){var address;return type===checkOutConstants.ADDRESS_TYPE.SHIPPING?address={address1:checkOutModelService.model.checkOutInfo.shipInfo.address1,address2:checkOutModelService.model.checkOutInfo.shipInfo.address2,zipCode:checkOutModelService.model.checkOutInfo.shipInfo.zip,state:checkOutModelService.model.checkOutInfo.shipInfo.state,city:checkOutModelService.model.checkOutInfo.shipInfo.city}:type===checkOutConstants.ADDRESS_TYPE.BILLING?address={address1:checkOutModelService.model.checkOutInfo.billInfo.address1,address2:checkOutModelService.model.checkOutInfo.billInfo.address2,zipCode:checkOutModelService.model.checkOutInfo.billInfo.zip,state:checkOutModelService.model.checkOutInfo.billInfo.state,city:checkOutModelService.model.checkOutInfo.billInfo.city}:type===checkOutConstants.ADDRESS_TYPE.E911&&(address={address1:checkOutModelService.model.checkOutInfo.e911Info.address1,address2:checkOutModelService.model.checkOutInfo.e911Info.address2,zipCode:checkOutModelService.model.checkOutInfo.e911Info.zip,state:checkOutModelService.model.checkOutInfo.e911Info.state,city:checkOutModelService.model.checkOutInfo.e911Info.city}),address.firstName=checkOutModelService.model.checkOutInfo.personalInfo.firstName,address.middleName=checkOutModelService.model.checkOutInfo.personalInfo.middleName,address.lastName=checkOutModelService.model.checkOutInfo.personalInfo.lastName,address.country=checkOutConstants.COUNTRY,address}function getAddress(addressType,addressArray){var billingAddress=addressArray?addressArray:checkOutModelService.model.checkOutInfo.initData.addresses;return lodash.find(billingAddress,function(address){return angular.isUndefined(address.addressTypes)?!1:void 0!==lodash.find(address.addressTypes,function(type){return type.type===addressType})})}function isSameAsShippingAddress(type){var shippingAddress=serviceObj.getAddress(checkOutConstants.ADDRESS_TYPE.SHIPPING),compareAddress=serviceObj.getAddress(type);return angular.isDefined(shippingAddress)&&angular.isDefined(compareAddress)&&shippingAddress.addressId===compareAddress.addressId}function isBillingSameAsShippingAddress(){return serviceObj.isSameAsShippingAddress(checkOutConstants.ADDRESS_TYPE.BILLING)}function isE911SameAsShippingAddress(){return serviceObj.isSameAsShippingAddress(checkOutConstants.ADDRESS_TYPE.E911)}function isAddressAvailable(type){return angular.isDefined(serviceObj.getAddress(type))}function isFormShippingAddressasBilling(){return lodash.get(checkOutModelService.model,"checkOutInfo.billSameAsShip",!1)}function isFormShippingAddressasE911(){return lodash.get(checkOutModelService.model,"checkOutInfo.e911SameAsShip",!1)}function profileAddressOperation(){var operations={"delete":[],post:[],patch:[]},service=serviceObj;return service.isAddressAvailable(checkOutConstants.ADDRESS_TYPE.SHIPPING)?service.isBillingSameAsShippingAddress()&&service.isE911SameAsShippingAddress()&&!service.isFormShippingAddressasBilling()&&service.isFormShippingAddressasE911()?(operations["delete"].push({type:checkOutConstants.ADDRESS_TYPE.BILLING,isAssociationDelete:!0}),operations.post.push([checkOutConstants.ADDRESS_TYPE.BILLING]),operations.patch.push({type:checkOutConstants.ADDRESS_TYPE.SHIPPING})):service.isBillingSameAsShippingAddress()&&service.isE911SameAsShippingAddress()&&service.isFormShippingAddressasBilling()&&!service.isFormShippingAddressasE911()?(operations["delete"].push({type:checkOutConstants.ADDRESS_TYPE.E911,isAssociationDelete:!0}),operations.post.push([checkOutConstants.ADDRESS_TYPE.E911]),operations.patch.push({type:checkOutConstants.ADDRESS_TYPE.SHIPPING})):service.isBillingSameAsShippingAddress()&&service.isE911SameAsShippingAddress()&&!service.isFormShippingAddressasBilling()&&!service.isFormShippingAddressasE911()?(operations["delete"].push({type:checkOutConstants.ADDRESS_TYPE.SHIPPING,isAssociationDelete:!1}),operations.post.push([checkOutConstants.ADDRESS_TYPE.SHIPPING]),operations.post.push([checkOutConstants.ADDRESS_TYPE.BILLING]),operations.post.push([checkOutConstants.ADDRESS_TYPE.E911])):service.isBillingSameAsShippingAddress()&&!service.isE911SameAsShippingAddress()&&!service.isFormShippingAddressasBilling()&&service.isFormShippingAddressasE911()?(operations["delete"].push({type:checkOutConstants.ADDRESS_TYPE.SHIPPING,isAssociationDelete:!1}),operations["delete"].push({type:checkOutConstants.ADDRESS_TYPE.E911,isAssociationDelete:!1}),operations.post.push([checkOutConstants.ADDRESS_TYPE.SHIPPING,checkOutConstants.ADDRESS_TYPE.E911]),operations.post.push([checkOutConstants.ADDRESS_TYPE.BILLING])):service.isBillingSameAsShippingAddress()&&!service.isE911SameAsShippingAddress()&&service.isFormShippingAddressasBilling()&&service.isFormShippingAddressasE911()?(operations["delete"].push({type:checkOutConstants.ADDRESS_TYPE.SHIPPING,isAssociationDelete:!1}),operations["delete"].push({type:checkOutConstants.ADDRESS_TYPE.E911,isAssociationDelete:!1}),operations.post.push([checkOutConstants.ADDRESS_TYPE.SHIPPING,checkOutConstants.ADDRESS_TYPE.BILLING,checkOutConstants.ADDRESS_TYPE.E911])):!service.isBillingSameAsShippingAddress()&&service.isE911SameAsShippingAddress()&&service.isFormShippingAddressasBilling()&&!service.isFormShippingAddressasE911()?(operations["delete"].push({type:checkOutConstants.ADDRESS_TYPE.SHIPPING,isAssociationDelete:!1}),operations["delete"].push({type:checkOutConstants.ADDRESS_TYPE.BILLING,isAssociationDelete:!1}),operations.post.push([checkOutConstants.ADDRESS_TYPE.E911]),operations.post.push([checkOutConstants.ADDRESS_TYPE.SHIPPING,checkOutConstants.ADDRESS_TYPE.BILLING])):!service.isBillingSameAsShippingAddress()&&service.isE911SameAsShippingAddress()&&service.isFormShippingAddressasBilling()&&service.isFormShippingAddressasE911()?(operations["delete"].push({type:checkOutConstants.ADDRESS_TYPE.SHIPPING,isAssociationDelete:!1}),operations["delete"].push({type:checkOutConstants.ADDRESS_TYPE.BILLING,isAssociationDelete:!1}),operations.post.push([checkOutConstants.ADDRESS_TYPE.SHIPPING,checkOutConstants.ADDRESS_TYPE.BILLING,checkOutConstants.ADDRESS_TYPE.E911])):service.isBillingSameAsShippingAddress()||service.isE911SameAsShippingAddress()||!service.isFormShippingAddressasBilling()||service.isFormShippingAddressasE911()?service.isBillingSameAsShippingAddress()||service.isE911SameAsShippingAddress()||service.isFormShippingAddressasBilling()||!service.isFormShippingAddressasE911()?!service.isBillingSameAsShippingAddress()&&!service.isE911SameAsShippingAddress()&&service.isFormShippingAddressasBilling()&&service.isFormShippingAddressasE911()?(operations["delete"].push({type:checkOutConstants.ADDRESS_TYPE.SHIPPING,isAssociationDelete:!1}),operations["delete"].push({type:checkOutConstants.ADDRESS_TYPE.BILLING,isAssociationDelete:!1}),operations["delete"].push({type:checkOutConstants.ADDRESS_TYPE.E911,isAssociationDelete:!1}),operations.post.push([checkOutConstants.ADDRESS_TYPE.SHIPPING,checkOutConstants.ADDRESS_TYPE.BILLING,checkOutConstants.ADDRESS_TYPE.E911])):service.isBillingSameAsShippingAddress()||!service.isE911SameAsShippingAddress()||service.isFormShippingAddressasBilling()||service.isFormShippingAddressasE911()?service.isBillingSameAsShippingAddress()&&!service.isE911SameAsShippingAddress()&&service.isFormShippingAddressasBilling()&&!service.isFormShippingAddressasE911()?(operations["delete"].push({type:checkOutConstants.ADDRESS_TYPE.BILLING,isAssociationDelete:!1}),operations.post.push([checkOutConstants.ADDRESS_TYPE.BILLING]),operations.patch.push({type:checkOutConstants.ADDRESS_TYPE.SHIPPING})):operations=service.profileAddressPatcOnlyOperation():(operations["delete"].push({type:checkOutConstants.ADDRESS_TYPE.E911,isAssociationDelete:!1}),operations.post.push([checkOutConstants.ADDRESS_TYPE.E911]),operations.patch.push({type:checkOutConstants.ADDRESS_TYPE.SHIPPING})):(operations["delete"].push({type:checkOutConstants.ADDRESS_TYPE.SHIPPING,isAssociationDelete:!1}),operations["delete"].push({type:checkOutConstants.ADDRESS_TYPE.E911,isAssociationDelete:!1}),operations.post.push([checkOutConstants.ADDRESS_TYPE.SHIPPING,checkOutConstants.ADDRESS_TYPE.E911]),operations.patch.push({type:checkOutConstants.ADDRESS_TYPE.BILLING})):(operations["delete"].push({type:checkOutConstants.ADDRESS_TYPE.SHIPPING,isAssociationDelete:!1}),operations["delete"].push({type:checkOutConstants.ADDRESS_TYPE.BILLING,isAssociationDelete:!1}),operations.post.push([checkOutConstants.ADDRESS_TYPE.SHIPPING,checkOutConstants.ADDRESS_TYPE.BILLING]),operations.patch.push({type:checkOutConstants.ADDRESS_TYPE.E911})):operations=service.profileAddressPostOnlyOperation(),operations}function profileAddressPostOnlyOperation(){var operations={"delete":[],post:[],patch:[]},service=serviceObj;return service.isFormShippingAddressasBilling()&&service.isFormShippingAddressasE911()?operations.post.push([checkOutConstants.ADDRESS_TYPE.SHIPPING,checkOutConstants.ADDRESS_TYPE.BILLING,checkOutConstants.ADDRESS_TYPE.E911]):service.isFormShippingAddressasBilling()&&!service.isFormShippingAddressasE911()?(operations.post.push([checkOutConstants.ADDRESS_TYPE.SHIPPING,checkOutConstants.ADDRESS_TYPE.BILLING]),operations.post.push([checkOutConstants.ADDRESS_TYPE.E911])):!service.isFormShippingAddressasBilling()&&service.isFormShippingAddressasE911()?(operations.post.push([checkOutConstants.ADDRESS_TYPE.SHIPPING,checkOutConstants.ADDRESS_TYPE.E911]),operations.post.push([checkOutConstants.ADDRESS_TYPE.BILLING])):(operations.post.push([checkOutConstants.ADDRESS_TYPE.SHIPPING]),operations.post.push([checkOutConstants.ADDRESS_TYPE.BILLING]),operations.post.push([checkOutConstants.ADDRESS_TYPE.E911])),operations}function profileAddressPatcOnlyOperation(){var operations={"delete":[],post:[],patch:[]},service=serviceObj;return service.isBillingSameAsShippingAddress()&&service.isE911SameAsShippingAddress()?operations.patch.push({type:checkOutConstants.ADDRESS_TYPE.SHIPPING}):service.isBillingSameAsShippingAddress()&&!service.isE911SameAsShippingAddress()?(operations.patch.push({type:checkOutConstants.ADDRESS_TYPE.SHIPPING}),operations.patch.push({type:checkOutConstants.ADDRESS_TYPE.E911})):!service.isBillingSameAsShippingAddress()&&service.isE911SameAsShippingAddress()?(operations.patch.push({type:checkOutConstants.ADDRESS_TYPE.SHIPPING}),operations.patch.push({type:checkOutConstants.ADDRESS_TYPE.BILLING})):(operations.patch.push({type:checkOutConstants.ADDRESS_TYPE.SHIPPING}),operations.patch.push({type:checkOutConstants.ADDRESS_TYPE.BILLING}),operations.patch.push({type:checkOutConstants.ADDRESS_TYPE.E911})),operations}function generateDeleteAddressrequest(deleteOperationList){var profileID=cartStorage.getProfileId(),deleteAddressAssociationUrlObject=apiService.getURL("deleteAddressAssociation"),deleteAddressUrlObject=apiService.getURL("deleteAddress");return lodash.map(deleteOperationList,function(operation){var address=serviceObj.getAddress(operation.type),addressTypes=lodash.find(address.addressTypes,function(type){return type.type===operation.type}),url="";return url=operation.isAssociationDelete&&angular.isDefined(addressTypes)?deleteAddressAssociationUrlObject.url.replace("{{profileID}}",profileID).replace("{{addressId}}",address.addressId).replace("{{associationId}}",addressTypes.associationId):deleteAddressUrlObject.url.replace("{{profileID}}",profileID).replace("{{addressId}}",address.addressId),httpRequestWrapper["delete"](url,null,null,!0)})}function generatePostAddressRequest(postOperationList){var profileID=cartStorage.getProfileId(),cartData=cartStorage.getGlobalSmartCartInfo(),orderId=cartData.orderId,lineItems=cartData.lineItems,header={follow:"true"},postProfileAddressUrlObject=apiService.getURL("postProfileAddress"),url=postProfileAddressUrlObject.url.replace("{{profileID}}",profileID);return lodash.map(postOperationList,function(operations){var addressTypes=[],firstAddressType=operations[0];lodash.each(operations,function(addressType){angular.equals(addressType,checkOutConstants.ADDRESS_TYPE.E911)?lodash.each(lineItems,function(line){addressTypes.push({relatedResourceId:line.lineId,type:addressType})}):addressTypes.push({relatedResourceId:orderId,type:addressType})});var address=angular.copy(serviceObj.getFormAddress(firstAddressType));return address.addressTypes=addressTypes,httpRequestWrapper.post(url,address,null,header,!0)})}function generatePatchAddressRequest(patcOperationList){var profileID=cartStorage.getProfileId(),patchProfileAddressUrl=apiService.getURL("patchProfileAddress").url.replace("{{profileID}}",profileID);return lodash.chain(patcOperationList).filter(function(address){var output=serviceObj.isFormAddressChanged(address.type);return output.isAddressChanged&&(address.formAddress=serviceObj.getFormAddress(address.type),address.addressId=output.addressId),output.isAddressChanged}).map(function(address){return patchProfileAddressUrl=patchProfileAddressUrl.replace("{{addressId}}",address.addressId),httpRequestWrapper.patch(patchProfileAddressUrl,address.formAddress,null,null,!0)}).value()}function isFormAddressChanged(type){var apiAddressRes=serviceObj.getAddress(type),newAddress=serviceObj.getFormAddress(type),object={isAddressChanged:apiAddressRes.firstName!==newAddress.firstName||apiAddressRes.middleName!==newAddress.middleName||apiAddressRes.lastName!==newAddress.lastName||apiAddressRes.address1!==newAddress.address1||apiAddressRes.address2!==newAddress.address2||apiAddressRes.state!==newAddress.state||apiAddressRes.state!==newAddress.state||apiAddressRes.zipCode!==newAddress.zipCode,addressId:apiAddressRes.addressId};return object}function postPaymentRequest(){return httpRequestWrapper.post("postPaymentURL",{},null,null,!0)}function getAddressIdFromAddressAPIResponse(responseList){var addressIdList=[];return lodash.each(responseList,function(data){var requestInfo=data.config;if(requestInfo&&requestInfo.url&&requestInfo.url.indexOf("/addresses")>-1)if("DELETE"===requestInfo.method||"PATCH"===requestInfo.method){var urlList=requestInfo.url.replace(/\/\s*$/,"").split("/"),index=lodash.indexOf(urlList,"addresses")+1;urlList.length>=index&&addressIdList.push(urlList[index])}else"POST"===requestInfo.method&&addressIdList.push(data.data.addresses[0].addressId)}),addressIdList}function postShippingOptionRequest(){var cartId=cartStorage.getCartId(),cartData=cartStorage.getGlobalSmartCartInfo(),orderId=cartData.orderId,shippingOption=lodash.find(checkOutModelService.model.checkOutInfo.initData.selectedShippingOptions,function(item){return item.selected===!0})||{},inputData={shipmentDetailsId:shippingOption.shipmentDetailsId,optionsId:shippingOption.optionsId,extCartId:orderId},shippingOptionsAPIUrl=apiService.getURL(urlConstants.URL.POST_SHIPPING_OPTIONS).url.replace("{{cartID}}",cartId);return cartId?httpRequestWrapper.post(shippingOptionsAPIUrl,inputData,null,null,!0):void 0}function getBillingAddressId(responseList){var billingAddressId;if(lodash.each(responseList,function(data){var requestInfo=data.config;if(requestInfo&&requestInfo.method===checkOutConstants.POSTMETHOD&&data.data&&data.data.addresses){var billingAddressObj=lodash.find(data.data.addresses,function(item){return lodash.find(item.addressTypes,{type:checkOutConstants.ADDRESS_TYPE.BILLING})});billingAddressId||(billingAddressId=billingAddressObj?billingAddressObj.addressId:void 0)}}),angular.isUndefined(billingAddressId)){var billingAddressObj=serviceObj.getAddress(checkOutConstants.ADDRESS_TYPE.BILLING);angular.isDefined(billingAddressObj)&&(billingAddressId=billingAddressObj.addressId)}return billingAddressId}function getAuditRecordsKeys(){var isAccessoryFlow;angular.isDefined(cartStorage.getGlobalSmartCartInfo())&&angular.isDefined(cartStorage.getGlobalSmartCartInfo().flags)&&(isAccessoryFlow=cartStorage.getGlobalSmartCartInfo().flags.isOnlyAccessory);var inputData={auditRecords:[{auditKey:checkOutConstants.AUDIT_RECORD_KEY.APPLICATIONID,auditValue:checkOutConstants.AUDIT_RECORD_AUDITVALUE.TMO},{auditKey:checkOutConstants.AUDIT_RECORD_KEY.CHANNELID,auditValue:checkOutConstants.AUDIT_RECORD_AUDITVALUE.WEB},{auditKey:checkOutConstants.AUDIT_RECORD_KEY.CLIENTID,auditValue:checkOutConstants.AUDIT_RECORD_AUDITVALUE.TMNG},{auditKey:checkOutConstants.AUDIT_RECORD_KEY.KEY_LANGUAGE_PREFERENCE,auditValue:mpLocalizationService.getUserPreferredLanguage()},{auditKey:checkOutConstants.AUDIT_RECORD_KEY.DEALER_CODE,auditValue:checkOutConstants.AUDIT_RECORD_AUDITVALUE.DEALER_CODE}]};return cartStorage.getFbSessionId()&&inputData.auditRecords.push({auditKey:checkOutConstants.AUDIT_RECORD_KEY.FB_ID,auditValue:cartStorage.getFbSessionId()}),cartStorage.getPsSessionId()&&inputData.auditRecords.push({auditKey:checkOutConstants.AUDIT_RECORD_KEY.PS_ID,auditValue:cartStorage.getPsSessionId()}),isAccessoryFlow||(inputData.auditRecords.push({auditKey:checkOutConstants.AUDIT_RECORD_KEY.AUTO_PAY,auditValue:checkOutModelService.model.checkOutInfo.flags.isAutoPay}),inputData.auditRecords.push({auditKey:checkOutConstants.AUDIT_RECORD_KEY.STORE_PAYMENT,auditValue:checkOutModelService.model.checkOutInfo.flags.isStorePayment||!1})),inputData}function auditRecordsRequest(){var cartId=cartStorage.getCartId(),apiUrl=apiService.getURL("createAuditRecordsUrl").url.replace("{{cartID}}",cartId),headers={follow:"true"},inputData=getAuditRecordsKeys();return httpRequestWrapper.post(apiUrl,inputData,null,headers,!0,"createAuditRecordsUrl")}var httpRequestWrapper=coreServices.httpRequestWrapper,cartStorage=coreServices.cartStorage,apiURLs=coreServices.apiURLs,apiKey=apiService.getURL("bundleService"),serviceObj={},transformService=responseTransformationService.getFactory(apiKey.version);return serviceObj.getShippingOptions=getShippingOptions,serviceObj.showHideBilling=showHideBilling,serviceObj.shippingOptionChange=shippingOptionChange,serviceObj.submitShippingData=submitShippingData,serviceObj.getProfileAddressList=getProfileAddressList,serviceObj.getAddress=getAddress,serviceObj.getFormAddress=getFormAddress,serviceObj.isSameAsShippingAddress=isSameAsShippingAddress,serviceObj.isAddressAvailable=isAddressAvailable,serviceObj.isFormShippingAddressasBilling=isFormShippingAddressasBilling,serviceObj.isFormShippingAddressasE911=isFormShippingAddressasE911,serviceObj.isBillingSameAsShippingAddress=isBillingSameAsShippingAddress,serviceObj.isE911SameAsShippingAddress=isE911SameAsShippingAddress,serviceObj.profileAddressOperation=profileAddressOperation,serviceObj.profileAddressPatcOnlyOperation=profileAddressPatcOnlyOperation,serviceObj.profileAddressPostOnlyOperation=profileAddressPostOnlyOperation,serviceObj.isFormAddressChanged=isFormAddressChanged,serviceObj.generateDeleteAddressrequest=generateDeleteAddressrequest,serviceObj.generatePostAddressRequest=generatePostAddressRequest,serviceObj.generatePatchAddressRequest=generatePatchAddressRequest,serviceObj.postPaymentRequest=postPaymentRequest,serviceObj.postShippingOptionRequest=postShippingOptionRequest,serviceObj.getAddressIdFromAddressAPIResponse=getAddressIdFromAddressAPIResponse,
serviceObj.getBillingAddressId=getBillingAddressId,serviceObj.auditRecordsRequest=auditRecordsRequest,serviceObj.shippingOptionChangeV3=shippingOptionChangeV3,serviceObj}shippingUtilConstructor.$inject=["coreServices","checkOutModelService","checkOutValidationUtil","commonServices","checkOutConstants","responseTransformationService","apiService","dataFactory","toggleService","urlConstants","mpLocalizationService"],angular.module("tmobileApp").service("shippingUtil",shippingUtilConstructor)}(window.angular,window._),function(angular){"use strict";angular.module("tmobileApp").constant("productDetailConstant",{TRANSACTION_TYPE:{UPGRADE:"UPGRADE",AAL:"AAL",UNKNOWN:"unknown"},INTENT:{BYOD:"BYOD",GSM:"GSM"},BUTTON_ACTION_TYPE:{UPGRADE:"Upgrade",AAL:"Add A Line"},PRODUCT_TYPE:{DEVICE:"DEVICE",ACCESSORY:"ACCESSORY"}})}(window.angular),function(angular,lodash){"use strict";function ProductDetailControllerConstructor($scope,$anchorScroll,browseService,commonServices,productService,creditClassService,productDetailsService,cartHttpDataService,cartServicesService,commonStorage,globalValue,AEM_RUNTIME,toggleService,authorValueService){function onQuantityClick(qty){productService.setQuantity(qty),vm.model.sQuantity=qty}function showPromotionStripLocation(){return angular.isDefined(vm.model.selectedCreditClass)&&!lodash.isEmpty(vm.model.selectedCreditClass.promotion_strip_location)}function showAwesomeCredit(){return!vm.showPromotionStripLocation()}function setDeviceType(){switch(angular.lowercase(productDetailsService.model.productCategoryType)){case"phone":return"device";case"internet-device":return"internet-device";case"accessory":return"accessory";default:return""}}var vm=this,$window=commonServices.$window,$log=commonServices.$log,$location=commonServices.$location,$timeout=commonServices.$timeout,cartCISFlag=lodash.get(toggleService.model,"toggles.cartCISFlag",!1);vm.isLoading=!0,vm.model=productDetailsService.model,vm.model.isB2B=$window.isB2B,vm.model.creditDataValues=globalValue,vm.authorValue=globalValue.authorValue,vm.isAccessory="accessory"===vm.model.productCategoryType.toLowerCase();try{AEM_RUNTIME.isHost?vm.allCompatibleAccessoriesCTAHref="content/t-mobile/accessories.html?dn=device-"+browseService.setTransformFamily(vm.model.selectedProduct.Family):vm.allCompatibleAccessoriesCTAHref="/accessories?dn=device-"+browseService.setTransformFamily(vm.model.selectedProduct.Family)}catch(err){$scope.$on("sliderDataChangeEvent",function(){vm.allCompatibleAccessoriesCTAHref="accessories.html?dn=device-"+browseService.setTransformFamily(productDetailsService.model.selectedProduct.Family)})}$log.log("Product Details Controller is initializing "),window.onpopstate=function(){commonStorage.assignIntoSharedSession("backfrompdp",!0)},vm.model.creditDataValues=globalValue;var searchObject=commonServices.$location.search();if("ncc"===searchObject.credit){var creditClass=vm.model.creditDataValues.authorValue.rootPage.creditClassSelector["class"][2];angular.isString(creditClass)&&!_.isEmpty(creditClass)&&(creditClass=JSON.parse(creditClass)),creditClassService.setCreditClass(creditClass),cartHttpDataService.saveCreditLevel(creditClass,function(){})}if((lodash.get(toggleService.model,"toggles.digitalToRetail",!1)||lodash.get(toggleService.model,"toggles.d2rAccessories",!1))&&authorValueService.loadAuthorJson("/bin/authorvalue/content/t-mobile/store-authoring.json").then(function(response){var hideAtFamilyLevel=!1;globalValue.authorValue.storeauthoring=response.storeauthoring,globalValue.authorValue.storeauthoring.digitalToRetail&&(vm.model.storeauthoring=!0,hideAtFamilyLevel=cartServicesService.hideContainer(vm.model.selectedProduct.familyId),hideAtFamilyLevel||(vm.model.skuEnabled=!0)),vm.isLoading=!1})["catch"](function(error){$log.log("Error getting store author data for digital to retail: "+error),vm.isLoading=!1}),vm.model.sQuantity=1,vm.onQuantityClick=onQuantityClick,vm.showPromotionStripLocation=showPromotionStripLocation,vm.showAwesomeCredit=showAwesomeCredit,vm.isSimToolkit=productDetailsService.isSimToolkit,vm.isEIPProductTypeAvailable=productDetailsService.isEIPProductTypeAvailable,vm.deviceType=setDeviceType(),vm.toggles=toggleService.model.toggles,$scope.$on("filteredProductDataOn",function(event,data){vm.model.selectedProduct=data,productDetailsService.populateProductBannerAttributes()}),$scope.$watch(function(){return creditClassService.getCreditClass()},function(newValue,oldValue){newValue!==oldValue&&(productDetailsService.setPricingDetails(),productDetailsService.updateTradeinPromotions())}),$window.scroll(0,0),cartCISFlag)var killPdpLoadWatch=$scope.$on("$viewContentLoaded",function(){$timeout(function(){if($location.hash()&&0===angular.element("#tab-review-container").length)var killDataReqWatch=$scope.$on("ALL_DATA_REQUESTS_COMPLETED",function(){$timeout(function(){productDetailsService.setTabAndScrollOnLoad($location.hash()),killDataReqWatch(),killPdpLoadWatch()},1e3)})})});else $scope.$on("$viewContentLoaded",function(){$timeout(function(){$location.hash()&&$anchorScroll()})})}ProductDetailControllerConstructor.$inject=["$scope","$anchorScroll","browseService","commonServices","productService","creditClassService","productDetailsService","cartHttpDataService","cartServicesService","commonStorage","globalValue","AEM_RUNTIME","toggleService","authorValueService"],angular.module("tmobileApp").controller("ProductDetailsController",ProductDetailControllerConstructor)}(window.angular,window._),function(angular,moment){"use strict";function checkOutValidationUtilConstructor(commonServices){function validatePhoneOnChange(formInput){void 0===formInput.$modelValue||formInput.$modelValue.length<10?formInput.$setValidity("minlength",!1):formInput.$setValidity("minlength",!0)}function poBoxValidator(addressText,formInput){var pattern=new RegExp("\\b[p]*(ost)*\\.*\\s*[o|0]*(ffice)*\\.*\\s*b[o|0]x.*\\b","i");addressText&&addressText.match(pattern)?formInput.$setValidity("containsPOBox",!1):formInput.$setValidity("containsPOBox",!0)}function validateSsnOnChange(formInput,creditClass){var ssn=Number.isInteger(Number(formInput.$modelValue))?formInput.$modelValue:void 0,len=ssn?ssn.toString().length:0;"NONE"===creditClass?4>len||"1111"===ssn.toString()?formInput.$setValidity("minlength",!1):formInput.$setValidity("minlength",!0):(9>len?formInput.$setValidity("minlength",!1):formInput.$setValidity("minlength",!0),len>9?formInput.$setValidity("maxlength",!1):formInput.$setValidity("maxlength",!0),isNaN(ssn)||!Number.isInteger(Number(ssn))?formInput.$setValidity("format",!1):formInput.$setValidity("format",!0))}function validateSecurityPinOnChange(formInput,checkOutInfo,author){var ssn=checkOutInfo.creditcheck.ssn?checkOutInfo.creditcheck.ssn:"",dob=checkOutInfo.creditcheck.dob?checkOutInfo.creditcheck.dob:"";if(checkOutInfo.creditcheck.idNumber)var drivingLicence="Drivers License"===checkOutInfo.creditcheck.idType.idTypeName?checkOutInfo.creditcheck.idNumber:"";checkOutInfo.creditcheck.idType&&!checkOutInfo.creditcheck.idType.isMandatoryState&&(checkOutInfo.creditcheck.state=author.stateHelperText);var value=formInput.portOutPin.$modelValue?formInput.portOutPin.$modelValue:"";dob&&(value===dob||value.indexOf(dob.slice(0,4)+dob.slice(6,8))>-1||value.indexOf(dob.slice(0,2)+dob.slice(4,8))>-1)?(formInput.portOutPin.$setValidity("portOutPinValidator",!1),formInput.portOutPin.$modelValue=""):ssn&&value.indexOf(ssn)>-1?(formInput.portOutPin.$setValidity("portOutPinValidator",!1),formInput.portOutPin.$modelValue=""):drivingLicence&&value.indexOf(drivingLicence)>-1?(formInput.portOutPin.$setValidity("portOutPinValidator",!1),formInput.portOutPin.$modelValue=""):formInput.portOutPin.$setValidity("portOutPinValidator",!0)}function validateExpireDateOnChange(formInput){var expireDate=Number.isInteger(Number(formInput.$modelValue))?formInput.$modelValue:void 0,len=0;expireDate?len=expireDate.toString().length:formInput.$setValidity("format",!1),4>len?formInput.$setValidity("minlength",!1):formInput.$setValidity("minlength",!0),len>4?formInput.$setValidity("maxlength",!1):formInput.$setValidity("maxlength",!0),isNaN(expireDate)?formInput.$setValidity("format",!1):formInput.$setValidity("format",moment(expireDate.toString(),"MMYY").isValid()&&4===len)}function checkAge(dob){var isValid=!1,givenDate=moment(dob,"MM/DD/YYYY");if(givenDate.isValid()){var todayDate=moment();todayDate.diff(givenDate,"years")>=18&&(isValid=!0,dob=commonServices.$filter("dateFilter")(dob,"dateOfBirth"))}return{validAge:isValid,dob:dob}}function checkExpAge(dob){var isValid=!1,givenDate=moment(dob,"MM/DD/YYYY");if(givenDate.isValid()){var todayDate=moment();todayDate.diff(givenDate,"years")<=99&&(isValid=!0,dob=commonServices.$filter("dateFilter")(dob,"dateOfBirth"))}return{expValidAge:isValid,dob:dob}}function resetBillingAddress(addressForm,addressType){var addressFields=["Address1","Address2","City","State","Zip"];angular.forEach(addressFields,function(fieldName){addressForm[addressType+fieldName].$setPristine(),addressForm[addressType+fieldName].$setValidity("containsPOBox",!0)})}return{validatePhoneOnChange:validatePhoneOnChange,validateSsnOnChange:validateSsnOnChange,validateExpireDateOnChange:validateExpireDateOnChange,validateSecurityPinOnChange:validateSecurityPinOnChange,checkExpAge:checkExpAge,checkAge:checkAge,resetBillingAddress:resetBillingAddress,poBoxValidator:poBoxValidator}}checkOutValidationUtilConstructor.$inject=["commonServices"],angular.module("tmobileApp").factory("checkOutValidationUtil",checkOutValidationUtilConstructor)}(window.angular,window.moment),function(angular,_,externalLogger){"use strict";var moduleName="tmobileApp";angular.module(moduleName).constant("PRODUCT_DETAIL_STATE_NAME","detail").config(["$stateProvider","PRODUCT_CATEGORIES","PRODUCT_DETAIL_STATE_NAME","UPPER_FUNNEL_ABSTRACT_ROOT_STATE_NAME","MASTER_ERROR_STATE_NAME","AEM_RUNTIME",function($stateProvider,PRODUCT_CATEGORIES,PRODUCT_DETAIL_STATE_NAME,UPPER_FUNNEL_ABSTRACT_ROOT_STATE_NAME,MASTER_ERROR_STATE_NAME,AEM_RUNTIME){externalLogger.moduleConfigured(moduleName,"detail.js");var stateConfig={parent:UPPER_FUNNEL_ABSTRACT_ROOT_STATE_NAME,data:{},views:{content:{templateProvider:void 0,controller:"ProductDetailsController as vm"}},reloadOnSearch:!1,resolve:{toggleData:function($log,toggleService){return toggleService.getToggleFeature().then(function(){$log.log(" resolve :: toggleService")})},authorizationToken:function(tokenUtils,toggleData,toggleService){return toggleService.model.toggles.isCircuitBreaker?!0:tokenUtils.generateToken()},routeData:function(aemRoutingService,productDetailsService,$stateParams){return aemRoutingService.loadRoutingStates().then(function(){return productDetailsService.loadRouteData($stateParams)})},sskData:function(routeData,authorizationToken,$q,$sessionStorage,productDetailsService,cqAnlyticesService,apiService){if(!(location.href.indexOf("accessory")>-1)){cqAnlyticesService.clearCQAnalytics();var byodDeviceAPI=apiService.getURL("useMyPhone"),byodTabletAPI=apiService.getURL("useMyTablet"),isByodDevice=byodDeviceAPI.url.indexOf(productDetailsService.model.routeData.offerId)>=0,isByodTablet=byodTabletAPI.url.indexOf(productDetailsService.model.routeData.offerId)>=0;return isByodDevice||isByodTablet||!_.isEmpty($sessionStorage.simPrice)&&!_.isEmpty($sessionStorage.simText)?$q.resolve():productDetailsService.getSSKData().then(function(response){response&&response.data&&($sessionStorage.simPrice=_.get(response.data.productdetails,"PurchasePrice"),$sessionStorage.simPrice=_.get(response.data.productdetails,"Family"))})}},productData:function(sskData,routeData,productDetailsService){var offerId=routeData.data.offerId,productCategoryType=routeData.data.productCategory;return productDetailsService.getAuthorData(routeData.url).then(function(){return productDetailsService.getProductData(offerId,productCategoryType)})}}};window.marketingDigitalData={page:{pageInfo:{templateName:"",pageName:"",pageTitle:"",pageURL:"",language:"en",currencyCode:"USD"},modules:{moduleCount:0,moduleList:[]}}};var urlKey=AEM_RUNTIME.isHost?"browseUrlRoot":"detailUrlRoot",detailCategories=_.map(_.values(PRODUCT_CATEGORIES),urlKey);stateConfig.url="/{detailCategory:(?:"+detailCategories.join("|")+")}/{productName}?",$stateProvider.state(PRODUCT_DETAIL_STATE_NAME,stateConfig);var aemPublisherConfig=angular.extend({},stateConfig);aemPublisherConfig.url="/content/t-mobile"+stateConfig.url,$stateProvider.state(PRODUCT_DETAIL_STATE_NAME+"-preview",aemPublisherConfig);var aemEditorConfig=angular.extend({},aemPublisherConfig);aemEditorConfig.url="/editor.html"+aemEditorConfig.url,$stateProvider.state(PRODUCT_DETAIL_STATE_NAME+"-editor",aemEditorConfig)}])}(angular,_,externalLogger),function(angular){"use strict";function checkOutModelService(coreServices,checkOutProgressService,checkOutConstants,commonUtils,globalValue,dataFactory){function initShipInfoDisclaimer(){model.checkOutInfo.billSameAsShip&&(model.checkOutInfo.billInfo=model.checkOutInfo.shipInfo),model.checkOutInfo.e911SameAsShip&&(model.checkOutInfo.e911Info=model.checkOutInfo.shipInfo)}function setCheckOutInitData(){model.checkoutInitData={},model.checkoutInitData.c=[];var creditCheck=commonUtils.searchJson(globalValue.authorValue.checkout,"paymentAndCreditCheck");creditCheck&&(creditCheck.idTypes instanceof Array?model.checkoutInitData.creditCheckIdTypes=creditCheck.idTypes:model.checkoutInitData.creditCheckIdTypes=[creditCheck.idTypes]),model.checkoutInitData.states=checkOutConstants.states,model.checkoutInitData.dob="",model.checkoutInitData.expDate="",model.checkoutInitData.product={open:!0},model.checkoutInitData.activeItem=0}function setCreditClass(){model.checkOutInfo.personalInfo.creditClass=coreServices.creditClassService.getEPCreditClass();var dataCache=dataFactory.getCacheObject(checkOutConstants.CACHE.NAME),dataObject=dataCache.get(checkOutConstants.CACHE.DATA_KEY);dataObject&&(dataObject.personalInfo.creditClass=model.checkOutInfo.personalInfo.creditClass),dataCache.put(checkOutConstants.CACHE.DATA_KEY,dataObject)}function setSectionToBeDisplayed(section,isProgressBarCall){model.errors.displayErrorMessage=!1,(!isProgressBarCall||checkOutProgressService.model.enableSection[section])&&(checkOutProgressService.disableCheckoutSections(section),model.sectionToBeDisplayed=section,section!==checkOutConstants.SECTIONS.REVIEW&&(model.checkOutInfo.cardInfo.securityCode="",model.checkOutInfo.creditcheck.portOutPinCode=""),model.checkOutInfo.personalInfo.personlaInfoDisclaimer=isProgressBarCall?!0:!1)}function initCheckout(){var globalCheckoutInfo=coreServices.cartStorage.getGlobalCheckOutInfo();model.errors={displayErrorMessage:!1,displaySSNMismatchError:!1,displayInProgressErrorMessage:!1,displayTimedOutErrorMessage:!1,displayInvalidAddressError:!1},model.checkOutInfo={personalInfo:{creditClass:"",personlaInfoDisclaimer:!1},shipInfo:{disclaimer:{checkbox:!0}},billInfo:{disclaimer:{checkbox:!0}},e911Info:{disclaimer:{checkbox:!0}},order:{},chosenShipping:{},cardInfo:{creditcheck:{}},reviewCart:{},subTotal:{oneTimeFee:{},shippingFee:{},tax:{total:{}}},total:{payNowPrice:{},monthlyPrice:{}},verifyId:{}},model.checkOutInfo.billSameAsShip=angular.isDefined(globalCheckoutInfo.billSameAsShip)?globalCheckoutInfo.billSameAsShip:!0,model.checkOutInfo.e911SameAsShip=angular.isDefined(globalCheckoutInfo.e911SameAsShip)?globalCheckoutInfo.e911SameAsShip:!0,model.checkOutInfo.billInfo={},model.checkOutInfo.e911Info={},globalCheckoutInfo&&!globalCheckoutInfo.error&&(_.merge(globalCheckoutInfo,model.checkOutInfo),model.checkOutInfo=globalCheckoutInfo,model.checkOutInfo.creditcheck={},model.checkOutInfo.creditcheckTpp={},model.checkOutInfo.cardInfo={});var personalInfoFromUser={firstName:model.checkOutInfo.personalInfo.firstName,lastName:model.checkOutInfo.personalInfo.lastName,email:model.checkOutInfo.personalInfo.email},personalInfoFromProfile={firstName:coreServices.cartStorage.PROFILE_DATA.firstName,lastName:coreServices.cartStorage.PROFILE_DATA.lastName,email:coreServices.cartStorage.PROFILE_DATA.emailId};angular.equals(personalInfoFromUser,personalInfoFromProfile)&&(model.checkOutInfo.personalInfo.firstName="",model.checkOutInfo.personalInfo.lastName="",model.checkOutInfo.personalInfo.email="");var shippingInfoFromUser={address1:model.checkOutInfo.shipInfo.address1,city:model.checkOutInfo.shipInfo.city,state:model.checkOutInfo.shipInfo.state,zip:model.checkOutInfo.shipInfo.zip},shippingInfoFromProfile={address1:coreServices.cartStorage.SHIPPING_DATA.address1,city:coreServices.cartStorage.SHIPPING_DATA.city,state:coreServices.cartStorage.SHIPPING_DATA.state,zip:coreServices.cartStorage.SHIPPING_DATA.zip};angular.equals(shippingInfoFromUser,shippingInfoFromProfile)&&(model.checkOutInfo.shipInfo={},model.checkOutInfo.shipInfo={disclaimer:{checkbox:!0}},model.checkOutInfo.billInfo={},model.checkOutInfo.e911Info={}),initShipInfoDisclaimer(),setCreditClass(),setCheckOutInitData()}var billingApplication,model={};return{model:model,initShipInfoDisclaimer:initShipInfoDisclaimer,initCheckout:initCheckout,setSectionToBeDisplayed:setSectionToBeDisplayed,billingApplication:billingApplication}}checkOutModelService.$inject=["coreServices","checkOutProgressService","checkOutConstants","commonUtils","globalValue","dataFactory"],angular.module("tmobileApp").factory("checkOutModelService",checkOutModelService)}(angular),function(angular,_){"use strict";function serviceConstructor($templateFactory,commonServices,aemRoutingService,PRODUCT_DETAIL_STATE_NAME,PRODUCT_CATEGORIES,AEM_RUNTIME,MASTER_ERROR_STATE_NAME){function parseUrl(url){var parsedUrl={},matches=url.match(aemRouteUrlRegEx);return angular.isArray(matches)&&(parsedUrl.root=matches[1],parsedUrl.browseCategory=matches[2],parsedUrl.productCategory=detailCategoryMap[matches[2]],parsedUrl.hasCategorySuffix=angular.isDefined(matches[3]),parsedUrl.productName=matches[4],parsedUrl.hasProductNameSuffix=angular.isDefined(matches[5])),parsedUrl}function findStateTemplate(){return aemRoutingService.loadRoutingStates().then(function(){var detailCategory,productName,templateUrl;if(angular.isDefined(pendingStateChange.toParams)&&(detailCategory=pendingStateChange.toParams.detailCategory,productName=pendingStateChange.toParams.productName),angular.isUndefined(detailCategory)||angular.isUndefined(productName)){var url=angular.isDefined(pendingStateChange.toState)?pendingStateChange.toState.url:$location.path(),urlParams=parseUrl(url);detailCategory=urlParams.detailCategory,productName=urlParams.productName}if(angular.isDefined(detailCategory)&&angular.isDefined(productName)){detailCategory=detailCategory.replace(".html",""),productName=productName.replace(".html","");var productCategoryType=detailCategoryMap[detailCategory];me.productCategoryType=productCategoryType;var authoredState=getAuthoredState(productCategoryType,productName);angular.isDefined(authoredState)&&angular.isDefined(authoredState.templateUrl)&&(templateUrl=authoredState.templateUrl)}return _.isEmpty(templateUrl)?($log.warn("Could not find detail page for "+productName),$state.go(MASTER_ERROR_STATE_NAME),$q.reject()):$templateFactory.fromUrl(templateUrl)})}function addSubState(stateConfig,parsedUrl){var stateLoadedSuccessfully=!0;return angular.isUndefined(elvis(stateConfig,"data.offerId"))||angular.isUndefined(parsedUrl.browseCategory)||angular.isUndefined(parsedUrl.productName)?stateLoadedSuccessfully=!1:(stateConfig.data=stateConfig.data||{},stateConfig.data.productName=stateConfig.data.productName||parsedUrl.productName,stateConfig.data.productCategory=stateConfig.data.productCategory||parsedUrl.productCategory,authoredStates[parsedUrl.productCategory].push(stateConfig)),stateLoadedSuccessfully}function isMyState(toState){return _.includes(toState.name,PRODUCT_DETAIL_STATE_NAME)}function getProductCategoryType(detailCategory){return detailCategoryMap[detailCategory]}function createFriendlyUrlFragment(productName){var friendlyName=productName;return angular.isString(productName)&&(friendlyName=productName.toLowerCase().replace(/\s/g,"-").replace(/\./g,"")),friendlyName}function getLinkToProductDetail(productCategoryType,productName){var detailCategory=_.invert(detailCategoryMap)[productCategoryType],urlFriendlyProductName=createFriendlyUrlFragment(productName),stateName=PRODUCT_DETAIL_STATE_NAME;_.includes($location.path(),"/editor.html")?stateName+="-editor":_.includes($location.path(),"/content/t-mobile")&&(stateName+="-preview");var href=$state.href(stateName,{detailCategory:detailCategory,productName:urlFriendlyProductName});return stateName!==PRODUCT_DETAIL_STATE_NAME&&href.indexOf(urlFriendlyProductName+".html")<0&&(href+=".html"),href}function getAuthoredData(category,productFileName){var authoredData,authoredState=getAuthoredState(category,productFileName);return angular.isDefined(authoredState)&&(authoredData=authoredState.data),authoredData}function getAuthoredStates(){return authoredStates}function getAuthoredState(category,productFileName){var authoredState;if(_.isEmpty(category)||_.isEmpty(productFileName))$log.error("cannot lookup authored states without a category or productFileName");else{var productName=productFileName.replace(".html",""),list=authoredStates[category];authoredState=_.find(list,{data:{productName:productName}}),angular.isUndefined(authoredState)&&(authoredState=_.find(list,{routeName:productName+(AEM_RUNTIME.isHost?"":"_without_root")}))}return authoredState}function getOfferId(category,productFileName){var offerId,authoredData=getAuthoredData(category,productFileName);return angular.isDefined(authoredData)&&(offerId=authoredData.offerId),offerId}function getDetailCategory(productCategoryType){return _.invert(detailCategoryMap)[productCategoryType]}function stateChangeStart(toState,toParams,fromState,fromParams,options){isMyState(toState)&&(pendingStateChange={toState:toState,toParams:toParams,fromState:fromState,fromParams:fromParams,options:options})}function stateChangeComplete(toState){isMyState(toState)&&(pendingStateChange={})}function getStateRouteData($stateParams){var productCategoryType=getProductCategoryType($stateParams.detailCategory);return getAuthoredState(productCategoryType,$stateParams.productName)}var me=this,$state=commonServices.$state,$location=commonServices.$location,$log=commonServices.$log,$q=commonServices.$q,pendingStateChange={},aemPreviewState=$state.get(PRODUCT_DETAIL_STATE_NAME+"-preview");aemPreviewState.views.content.templateProvider=findStateTemplate;var aemEditorState=$state.get(PRODUCT_DETAIL_STATE_NAME+"-editor");aemEditorState.views.content.templateProvider=findStateTemplate;var masterState=$state.get(PRODUCT_DETAIL_STATE_NAME);masterState.views.content.templateProvider=findStateTemplate;var urlKey=AEM_RUNTIME.isHost?"browseUrlRoot":"detailUrlRoot",detailUrlRoots=_.map(_.values(PRODUCT_CATEGORIES),urlKey),aemRoots=[];_.forEach(detailUrlRoots,function(root){aemRoots.push(root+".html")}),detailUrlRoots=aemRoots.concat(detailUrlRoots);var detailCategoryMap={};_.forEach(PRODUCT_CATEGORIES,function(value,key){detailCategoryMap[value[urlKey]]=key});var productCategoryTypes=_.keys(PRODUCT_CATEGORIES),authoredStates={};angular.forEach(productCategoryTypes,function(category){authoredStates[category]=[]});var pattern="^(/.*)?/(##categories##)(?:/([^.]*))?(.html)?",aemRouteUrlRegEx=new RegExp(pattern.replace("##categories##",Object.keys(detailUrlRoots).join("|")),"i");return me.getPendingState=function(){return pendingStateChange},me.stateChangeStart=stateChangeStart,me.stateChangeComplete=stateChangeComplete,me.isMyState=isMyState,me.addSubState=addSubState,me.getAuthoredData=getAuthoredData,me.getAuthoredStates=getAuthoredStates,me.getProductCategoryType=getProductCategoryType,me.getLinkToProductDetail=getLinkToProductDetail,me.getDetailCategory=getDetailCategory,me.getOfferId=getOfferId,me.getStateRouteData=getStateRouteData,me}serviceConstructor.$inject=["$templateFactory","commonServices","aemRoutingService","PRODUCT_DETAIL_STATE_NAME","PRODUCT_CATEGORIES","AEM_RUNTIME","MASTER_ERROR_STATE_NAME"],angular.module("tmobileApp").service("detailStateService",serviceConstructor).run(["$rootScope","detailStateService",function($rootScope,detailStateService){$rootScope.$on("$stateChangeStart",function(event,toState,toParams,fromState,fromParams,options){detailStateService.stateChangeStart(toState,toParams,fromState,fromParams,options)}),$rootScope.$on("$stateChangeError",function(event,toState,toParams,fromState,fromParams,error){detailStateService.stateChangeComplete(event,toState,toParams,fromState,fromParams,error)}),$rootScope.$on("$stateChangeSuccess",function(event,toState,toParams,fromState,fromParams,options){detailStateService.stateChangeComplete(event,toState,toParams,fromState,fromParams,options)})}])}(angular,_),function(angular,lodash){"use strict";function orderDetailsModalController($modalInstance,authorValues,cartStorage,cartConstants,creditClassService,modalDialogFactory,$log,commonServices,checkOutModelService,commonUtils,coreServices,pdlService,pdlConstant,$location,cartCommonOperationsService,checkOutHttpDataUtil){function closePricingModal(){vm.orderDetails.visibleModal=!0,$modalInstance.close()}function primaryCTA(){vm.hcc=cartStorage.getHardCreditCheck();var creditClass=getCreditClass();vm.hcc&&creditClass===vm.orderDetails.creditClassText&&vm.openCartManualReviewModal(),vm.closePricingModal();var targetURL=$location.host()+"/checkout";pdlService.CTANavOrClickEvent(pdlConstant.CTA_NAME.CHECKOUT_NOW,targetURL,!0,"",pdlConstant.ASSET_TYPE.BUTTON,"",pdlConstant.MODAL_DATA.PRICE_UPDATE_MODAL),vm.isTPPON?pdlService.callCheckOutStepEvent(pdlConstant.EVENT_ATTRIBUTES.STEP_NAME.shippingPaymentTPP):pdlService.callCheckOutStepEvent(pdlConstant.EVENT_ATTRIBUTES.STEP_NAME.shippingPayment)}function getCreditClass(){return cartStorage.getPriceIndicator()}function ctaToCart(){lodash.get(toggleService.model,"toggles.unoCartMigration",!1)?checkOutHttpDataUtil.redirectToUnoCart():angular.isDefined(vm.orderDetails.ctaToCartLink)&&(pdlService.CTANavOrClickEvent(vm.orderDetails.ctaToCartTextBold,vm.orderDetails.ctaToCartLink,!0,"",pdlConstant.ASSET_TYPE.BUTTON,"",pdlConstant.MODAL_DATA.PRICE_UPDATE_MODAL),commonServices.$window.location.href=vm.orderDetails.ctaToCartLink)}function replaceShortestTerm(){var replacedShortestTerm;return vm.orderDetails.monthlypaymentText&&angular.isDefined(vm.shortEIPTerm)&&(replacedShortestTerm=vm.orderDetails.monthlypaymentText.replace("{{no.}}",vm.shortEIPTerm)),replacedShortestTerm}function formatHeaderText(){var formatedHeaderText,name=checkOutModelService.model.checkOutInfo.personalInfo.firstName;return vm.orderDetails.headerText&&(formatedHeaderText=vm.orderDetails.headerText.replace("{{name}}",name)),formatedHeaderText}function calculateShortestEIPTerm(cartItems){var shortestEIPTerm,eipTerms=[];return cartItems&&(cartItems.accessories||cartItems.lineItems)&&(cartItems.lineItems&&angular.forEach(cartItems.lineItems,function(value,key){angular.equals(value.lineItemDetails.deviceDetails.productType,cartConstants.DEVICE)&&angular.equals(value.lineItemDetails.deviceDetails.pricingOption,cartConstants.MONTHLY)&&angular.isDefined(value.lineItemDetails.deviceDetails.monthlyPrice)&&eipTerms.push(value.lineItemDetails.deviceDetails.monthlyPrice.termMonths)}),cartItems.accessories&&angular.forEach(cartItems.accessories.accessoryDetails,function(value,key){angular.equals(value.paymentOption,cartConstants.EIP)&&angular.isDefined(value.monthlyPrice.termMonths)&&eipTerms.push(value.monthlyPrice.termMonths)}),eipTerms.length>0&&(shortestEIPTerm=Math.min.apply(Math,eipTerms),vm.isFRPOnlyCart=!1)),shortestEIPTerm}function getClass(amountDisplay,itemsLength,index){return amountDisplay?"p-b-8":itemsLength-1>index?"p-b-16":""+(0==index?"p-t-16":"")}function init(){vm.orderDetails=lodash.get(authorValues,"checkout.orderDetails",{}),vm.breakdownAuthorValue={autoPayText:commonUtils.searchJson(authorValues.rootPage,"pricingBreakdown.autoPayText"),pbReinforceMessageTablet:commonUtils.searchJson(authorValues.rootPage,"pricingBreakdown.pbReinforceMessageTablet"),pbReinforceMessageWearable:commonUtils.searchJson(authorValues.rootPage,"pricingBreakdown.pbReinforceMessageWearable"),standardTitle:commonUtils.searchJson(authorValues.rootPage,"tradeInTool.standardOrderDetails.standardTitle"),standardTradeInDeviceHeader:commonUtils.searchJson(authorValues.rootPage,"tradeInTool.standardOrderDetails.standardTradeInDeviceHeader"),standardTradeInDeviceInfo:commonUtils.searchJson(authorValues.rootPage,"tradeInTool.standardOrderDetails.standardTradeInDeviceInfo"),tradeInValueModalLink:commonUtils.searchJson(authorValues.rootPage,"tradeInTool.standardOrderDetails.tradeInValueModalLink"),promotionTitle:commonUtils.searchJson(authorValues.rootPage,"tradeInTool.promotionOrderDetails.promotionTitle"),promotionTradeInDeviceHeader:commonUtils.searchJson(authorValues.rootPage,"tradeInTool.promotionOrderDetails.promotionTradeInDeviceHeader"),promotionTradeInDeviceInfo:commonUtils.searchJson(authorValues.rootPage,"tradeInTool.promotionOrderDetails.promotionTradeInDeviceInfo"),autoPayDiscountLabel:commonUtils.searchJson(authorValues.rootPage,"pricing.autoPayDiscountLabel"),deviceLabel:commonUtils.searchJson(authorValues.rootPage,"pricing.deviceLabel"),simKitToolTip:commonUtils.searchJson(authorValues.rootPage.generalAuthoring,"simtooltipdesc")},vm.linedetails=[],vm.calculateShortestEIPTerm=calculateShortestEIPTerm,vm.formatHeaderText=formatHeaderText,vm.toggles=toggleService.model.toggles,vm.orderDetails.cartObj=cartStorage.getGlobalSmartCartInfo(),lodash.forEach(vm.orderDetails.cartObj.lineItems,function(selectedLine,key){var poFull=lodash.get(selectedLine,"lineItemDetails.deviceDetails.pricingOption");selectedLine.poFull=poFull&&"FULL"===poFull}),checkOutModelService.model.checkOutInfo.reviewCart.subTotalMonthlyPrice=vm.orderDetails.cartObj.subTotalMonthlyPrice,checkOutModelService.model.checkOutInfo.reviewCart.subTotalPayNowPrice=vm.orderDetails.cartObj.subTotalPayNowPrice,vm.orderDetails.selectedCreditCls=creditClassService.getCreditClass(),vm.closePricingModal=closePricingModal,vm.replaceShortestTerm=replaceShortestTerm,vm.shortEIPTerm=calculateShortestEIPTerm(vm.orderDetails.cartObj),vm.openCartManualReviewModal=modalDialogFactory.openCartManualReviewModal,vm.primaryCTA=primaryCTA,vm.ctaToCart=ctaToCart,vm.getClass=getClass,vm.isTPPON=lodash.get(vm.toggles,"isTPPON",!1),vm.planPromotionAmount=cartCommonOperationsService.planPromotionAmount,vm.serviceTaxLabel=cartCommonOperationsService.serviceTaxLabel}var vm=this;vm.showAccessoriesDetails=!1;var toggleService=coreServices.toggleService;vm.EIPTerm=function(data){var text;return angular.isDefined(data)&&vm.orderDetails.monthlypaymentText&&(text=vm.orderDetails.monthlypaymentText.replace("{{no.}}",data)),text},vm.showLineDetails=function(index){vm.linedetails[index]=!0},vm.hideLineDetails=function(index){vm.linedetails[index]=!1},init()}orderDetailsModalController.$inject=["$modalInstance","authorValues","cartStorage","cartConstants","creditClassService","modalDialogFactory","$log","commonServices","checkOutModelService","commonUtils","coreServices","pdlService","pdlConstant","$location","cartCommonOperationsService","checkOutHttpDataUtil"],angular.module("tmobileApp").controller("OrderDetailsModalController",orderDetailsModalController)}(window.angular,window._),function(angular){"use strict";function bindUnsafeHtmlDirectiveConstructor($compile){return function(scope,element,attrs){scope.$watch(function(scope){return scope.$eval(attrs.bindUnsafeHtml)},function(value){element.html(value),$compile(element.contents())(scope)})}}bindUnsafeHtmlDirectiveConstructor.$inject=["$compile"],angular.module("tmobileApp").directive("bindUnsafeHtml",bindUnsafeHtmlDirectiveConstructor)}(angular),function(angular,lodash){"use strict";function fraudCheckRejectModalController($modalInstance,authorValues,commonServices){function onCtaAction(redirectUrl){
angular.isDefined(redirectUrl)&&($modalInstance.close(),commonServices.$window.location.href=redirectUrl)}var vm=this;vm.fraudCheck=lodash.get(authorValues,"checkout.fraudCheck",{}),vm.onCtaAction=onCtaAction}fraudCheckRejectModalController.$inject=["$modalInstance","authorValues","commonServices"],angular.module("tmobileApp").controller("fraudCheckRejectModalController",fraudCheckRejectModalController)}(window.angular,window._),function(angular){"use strict";function changeOnScreenResizeDirectiveConstructor($window,$log){return{restrict:"A",link:function(scope,elem,attrs){function changeImage(){scope.screenWidth=$window.innerWidth,scope.screenWidth<=480?(elem.attr("src",attrs.mobileImage),$log.log("mobileImage",attrs.mobileImage)):scope.screenWidth>=480&&scope.screenWidth<=992?(elem.attr("src",attrs.tabletImage),$log.log("small",attrs.small)):elem.attr("src",attrs.desktopImage)}$window.onresize=function(){changeImage(),scope.$apply()},changeImage()}}}changeOnScreenResizeDirectiveConstructor.$inject=["$window","$log"],angular.module("tmobileApp").directive("changeOnScreenResize",changeOnScreenResizeDirectiveConstructor)}(angular),function(angular,lodash){"use strict";function authFailModalController($state,$modalInstance,authorValues,CART_STATE_NAME,toggleService,checkOutHttpDataUtil){function close(){$modalInstance.close()}function goToCart(){$modalInstance.close(),lodash.get(toggleService.model,"toggles.unoCartMigration",!1)?checkOutHttpDataUtil.redirectToUnoCart():$state.go(CART_STATE_NAME)}var vm=this;vm.authfailModal=lodash.get(authorValues,"checkout.authfailmodal",{}),vm.close=close,vm.goToCart=goToCart}authFailModalController.$inject=["$state","$modalInstance","authorValues","CART_STATE_NAME","toggleService","checkOutHttpDataUtil"],angular.module("tmobileApp").controller("AuthFailModalController",authFailModalController)}(window.angular,window._),function(angular){function icidDirectiveConstructor(){return{restrict:"A",link:function(scope,elem,attrs){function getUrl(url,icid){var urlmod=url,str=urlmod.split("#"),hash=_.includes(urlmod,"#")?"#"+str[1]:"";urlmod=str[0],icid?urlmod=_.includes(urlmod,"?")&&!_.includes(urlmod,"icid")?urlmod+"&icid="+icid+hash:urlmod+"?icid="+icid+hash:urlmod+=hash,elem.attr("href",urlmod)}getUrl(attrs.imageCtaLink,attrs.icid)}}}angular.module("tmobileApp").directive("icidUrl",icidDirectiveConstructor)}(angular),function(angular){"use strict";function dateFilterFn(){return function(input,filterType){if(!angular.isUndefined(input)){var value=input.toString().trim().replace(/^\+/,"");if(value.match(/[^0-9]/))return input;if(angular.equals("expiryDateDisplay",filterType)){if(value)return value.substring(0,2)+"/"+value.substring(2)}else{if(angular.equals("dateOfBirth",filterType))return value.length<=2?value:value.length>2&&value.length<=4?value.substring(0,2)+"/"+value.substring(2,4):value.substring(0,2)+"/"+value.substring(2,4)+"/"+value.substring(4);if(angular.equals("expiryDate",filterType)){var date,year;switch(value.length){case 1:case 2:date=value;break;case 3:date=value.slice(0,2),year=value.slice(2);break;default:date=value.slice(0,2),year=value.slice(2)}return year?(year=year.length>2?year.slice(0,2)+year.slice(2,2):year,(date+"/"+year).trim()):date}}}}}angular.module("tmobileCheckOut").filter("dateFilter",dateFilterFn)}(angular),function(angular,externalLogger){"use strict";function configMarqueeSlider($stateProvider){externalLogger.moduleConfigured("tmobileApp","marqueeSlider.js :: configMarqueeSlider"),$stateProvider.state("marqueeSlider",{url:"/marqueeSlider",controller:"MarqueeSliderController",controllerAs:"vm",templateUrl:"app/product/detail/marqueeSlider/marqueeSlider.html"})}configMarqueeSlider.$inject=["$stateProvider"],angular.module("tmobileApp").config(configMarqueeSlider)}(angular,externalLogger),function(angular){"use strict";function portOutPinValidatorFn(checkOutModelService){return{require:"ngModel",link:function(scope,elem,attr,ngModel){var checkOutInfo=checkOutModelService.model.checkOutInfo;ngModel.$parsers.unshift(function(value){ngModel.$setValidity("portOutPinValidator",!0);var isSameDigitInput=!1,isForwardSequentialInput=!1,isReverseSequentialInput=!1,ssn=checkOutInfo.creditcheck.ssn,phoneNumber=checkOutInfo.personalInfo.phoneNumber,dob=checkOutInfo.creditcheck.dob;if(checkOutInfo.creditcheck.idType)var drivingLicence="Drivers License"===checkOutInfo.creditcheck.idType.idTypeName?checkOutInfo.creditcheck.idNumber:"";for(var valueArray=[],i=0;i<value.length;i++)valueArray.push(value.slice(i,i+1));for(var i=0;i<valueArray.length;i++){for(var repetitiveNumber="",j=0;6>j;j++)repetitiveNumber+=valueArray[i];if(value.indexOf(repetitiveNumber)>-1){ngModel.$setValidity("portOutPinValidator",!1),isSameDigitInput=!0;break}var forwardSequenceNumber="";if(parseInt(valueArray[i])<5)for(var j=0;6>j;j++)forwardSequenceNumber+=parseInt(valueArray[i])+parseInt(j);if(forwardSequenceNumber&&value.indexOf(forwardSequenceNumber)>-1){ngModel.$setValidity("portOutPinValidator",!1),isForwardSequentialInput=!0;break}var reverseSequenceNumber="";if(parseInt(valueArray[i])>5)for(var j=0;6>j;j++)reverseSequenceNumber+=parseInt(valueArray[i])-parseInt(j);if(reverseSequenceNumber&&value.indexOf(reverseSequenceNumber)>-1){ngModel.$setValidity("portOutPinValidator",!1),isReverseSequentialInput=!0;break}}return isSameDigitInput||isForwardSequentialInput||isReverseSequentialInput||(dob&&(value===dob||value.indexOf(dob.slice(0,4)+dob.slice(6,8))>-1||value.indexOf(dob.slice(0,2)+dob.slice(4,8))>-1)?ngModel.$setValidity("portOutPinValidator",!1):phoneNumber&&value.indexOf(phoneNumber)>-1?ngModel.$setValidity("portOutPinValidator",!1):ssn&&value.indexOf(ssn)>-1?ngModel.$setValidity("portOutPinValidator",!1):drivingLicence&&value.indexOf(drivingLicence)>-1?ngModel.$setValidity("portOutPinValidator",!1):ngModel.$setValidity("portOutPinValidator",!0)),value})}}}var moduleName="tmobileCheckOut",directiveName="portOutPinValidator";angular.module(moduleName).directive(directiveName,portOutPinValidatorFn)}(window.angular),function(angular){"use strict";function MarqueeSliderControllerConstructor($scope,$log,$q,marqueeSliderService,slickCarouselBreakpoints,$window){function getSlideData(){for(var promises=[],i=0;i<vm.dataUrl.length;i++){var promise=marqueeSliderService.getSlides(vm.dataUrl[i]);promises.push(promise)}$q.all(promises).then(function(values){vm.slides=values,vm.selectView=!0})}var vm=this;vm.isB2B=$window.isB2B,$log.log("Marquee Slider Controller is initializing "+$scope.$id),vm.dataUrl="",vm.slides=[],vm.slickAccessoriesConfig={infinite:!1,slidesToShow:1,slidesToScroll:1,responsive:[{breakpoint:slickCarouselBreakpoints.lg,settings:{slidesToShow:1,slidesToScroll:1}},{breakpoint:slickCarouselBreakpoints.md,settings:{slidesToShow:1,slidesToScroll:1,dots:!0}},{breakpoint:slickCarouselBreakpoints.sm,settings:{slidesToShow:1,slidesToScroll:1,dots:!0}}]},vm.marqueeSliderDataChange=!1,vm.selectView=!1,$scope.$watch("vm.selectView",function(){$scope.$broadcast("MarqueesliderDataChangeEvent")});var killWatch=$scope.$watch("vm.marqueeSlideUrls",function(newVal){newVal&&($log.debug(vm.marqueeSlideUrls),vm.dataUrl=vm.marqueeSlideUrls,getSlideData(),killWatch())})}MarqueeSliderControllerConstructor.$inject=["$scope","$log","$q","marqueeSliderService","slickCarouselBreakpoints","$window"],angular.module("tmobileApp").controller("MarqueeSliderController",MarqueeSliderControllerConstructor)}(angular),function(angular){"use strict";function numberMaskFn($filter,$browser){return{require:"ngModel",restrict:"A",link:function($scope,$element,$attrs,ngModelCtrl){function listener(){$element.val($filter("maskFilter")(inputNumber,$attrs.eltype))}function onBlurEventHandler(){$scope.$apply(function(){inputNumber=$element.val(),$browser.defer(listener)})}var inputNumber;inputNumber=$element.val(),$element.bind("blur",onBlurEventHandler),ngModelCtrl.$render=function(){$element.val($filter("maskFilter")(ngModelCtrl.$viewValue,$attrs.eltype))},ngModelCtrl.$parsers.push(function(viewValue){return viewValue?(inputNumber!==viewValue&&(inputNumber=viewValue.replace(/[^0-9]/g,""),ngModelCtrl.$setViewValue(inputNumber),ngModelCtrl.$render()),inputNumber):""})}}}var moduleName="tmobileCheckOut",directiveName="numberMask";angular.module(moduleName).directive(directiveName,numberMaskFn)}(angular),function(angular){"use strict";function marqueeSliderServiceConstructor($log,$q,$http){function getSlides(slideUrl){var deferred=$q.defer(),u=slideUrl;return $http.get(u).then(function(response){slides.push(response.data),$log.log("slides",slides),deferred.resolve(response.data)})["catch"](function(response){deferred.reject(response),$log.error("Gists error",response.status,response.data)}),deferred.promise}var slides=[];return{getSlides:getSlides}}marqueeSliderServiceConstructor.$inject=["$log","$q","$http"],angular.module("tmobileApp").constant("marqueeSlides",[{imageUrl:"http://s.tmocache.com/content/dam/tmo/en-g/q2-2016/marquee/3027-browse-mq-iPhone-5s-100offer-505x450.jpg"},{imageUrl:"http://s.tmocache.com/content/dam/tmo/en-g/q2-2016/marquee/browse-tablet-mq-apple.png"},{imageUrl:"http://s.tmocache.com/content/dam/tmo/en-g/q2-2016/marquee/browse-mq-samsung-offer-dsk-v2.png"},{imageUrl:"http://s.tmocache.com/content/dam/tmo/en-g/q2-2016/marquee/2993-browse-mq-mothers-day-phones.png"}]).service("marqueeSliderService",marqueeSliderServiceConstructor)}(angular),function(angular){"use strict";function checkDobFn($filter,$browser,checkOutValidationUtil){return{require:"ngModel",link:function($scope,$element,$attrs,ngModelCtrl){function checkDobValidator(modelValue,viewValue){var value=modelValue||viewValue;return angular.isDefined(value)?value.length<8?!1:moment(value,"MM/DD/YYYY").isValid()&&moment(value,"MM/DD/YYYY").year()>1599:!1}function validAgeValidator(modelValue,viewValue){var value=modelValue||viewValue,ageValidation=checkOutValidationUtil.checkAge(value);return ageValidation.validAge}function expiredAgeValidator(modelValue,viewValue){var value=modelValue||viewValue,expAgeValidation=checkOutValidationUtil.checkExpAge(value);return expAgeValidation.expValidAge}var listener=function(){var cursorPos=$element[0].selectionStart,value=$element.val().replace(/[^0-9]/g,"");$element.val($filter("dateFilter")(value,"dateOfBirth")),10!==$element.val().length&&(3===cursorPos||6===cursorPos?$element[0].setSelectionRange(cursorPos+1,cursorPos+1):$element[0].setSelectionRange(cursorPos,cursorPos))};ngModelCtrl.$parsers.push(function(viewValue){return viewValue.replace(/[^0-9]/g,"").slice(0,8)}),ngModelCtrl.$render=function(){$element.val($filter("dateFilter")(ngModelCtrl.$viewValue,"dateOfBirth"))},$element.bind("change",listener),$element.bind("keydown",function(event){var key=event.keyCode;if(!(46===key||91===key||key>15&&19>key||key>=35&&40>=key||8===key))return event.ctrlKey===!0&&65===key||8===key?!0:void $browser.defer(listener)}),$element.bind("paste cut",function(){$browser.defer(listener)}),ngModelCtrl.$validators.checkDob=checkDobValidator,ngModelCtrl.$validators.validAge=validAgeValidator,ngModelCtrl.$validators.expValidAge=expiredAgeValidator}}}var moduleName="tmobileApp",directiveName="checkDob";angular.module(moduleName).directive(directiveName,checkDobFn)}(window.angular),function(angular){"use strict";function viewportCoordinateDirective($window){function getCssPosition(scope,viewport){return{top:scope[viewport+TOP]+"%",left:scope[viewport+LEFT]+"%",right:scope[viewport+RIGHT]+"%"}}function isNotValidCoordinate(value){return!_.isFinite(parseFloat(value))}function hasAllViewCoordinates(scope,viewport){return!(isNotValidCoordinate(scope[viewport+TOP])||isNotValidCoordinate(scope[viewport+LEFT])||isNotValidCoordinate(scope[viewport+RIGHT]))}function setCoordinates(scope,elem){scope.screenWidth=$window.innerWidth;var css={};scope.screenWidth<=767?css=hasAllViewCoordinates(scope,MOBILE)?getCssPosition(scope,MOBILE):{position:"static"}:scope.screenWidth<=992&&hasAllViewCoordinates(scope,TAB)?css=getCssPosition(scope,TAB):hasAllViewCoordinates(scope,DESKTOP)&&(css=getCssPosition(scope,DESKTOP)),elem.css("top",css.top),elem.css("left",css.left),elem.css("right",css.right),elem.css("position",css.position)}function linkFn(scope,elem){$window.onresize=function(){setCoordinates(scope,elem),scope.$apply()},setCoordinates(scope,elem)}return{restrict:"A",scope:{desktopTop:"<",desktopLeft:"<",desktopRight:"<",mobileTop:"<",mobileLeft:"<",mobileRight:"<",tabTop:"<",tabLeft:"<",tabRight:"<"},link:linkFn}}viewportCoordinateDirective.$inject=["$window"];var MOBILE="mobile",TAB="tab",DESKTOP="desktop",TOP="Top",LEFT="Left",RIGHT="Right";angular.module("tmobileApp").directive("viewportCordinates",viewportCoordinateDirective)}(window.angular),function(angular){"use strict";function whatsNextSectionController(checkOutModelService){var vm=this;vm.model={confirmationString:checkOutModelService.model.confirmationString}}whatsNextSectionController.$inject=["checkOutModelService"],angular.module("tmobileApp").controller("WhatsNextSectionController",whatsNextSectionController)}(window.angular,window._),function(angular,lodash,CQ_Analytics){"use strict";function productDetailsServiceConstructor($sce,$q,$location,$log,$rootScope,$sessionStorage,$timeout,httpRequest,detailStateService,creditClassService,BVReviewService,creditClassData,apiURLs,defaultProductService,toggleService,dataFactory,globalValue,cartStorage,commonServices,pdpResponseTransformationServicePDPV2,httpRequestWrapper,$anchorScroll,productDetailConstant){function setProductBadge(badges){angular.forEach(badges,function(badge){"true"===badge.value&&(service.model.productBadge=badge.label)})}function getFAQData(tags){var url=apiURLs.faqData+tags;return httpRequest.authGet(url)}function getSimKitResponse(url,body,query,header,isV2API){return isV2API?httpRequestWrapper.post(url,body,query,header,!0,"plpV2"):httpRequestWrapper.get(url,query,header,!0)}function getSSKData(){var V2API=toggleService.model.toggles.toggleV2API,url=angular.equals(V2API,!0)?apiURLs.SSKDataUrlV2:apiURLs.SSKDataUrl,body=angular.equals(V2API,!0)?{}:null,header=angular.equals(V2API,!0)?{}:{},aemCachedPdpUrl=apiURLs.product.detail.pdpCacheData[service.model.routeData.productCategory],arrProductUrls=url.split("/"),simKitFamilyId=arrProductUrls[arrProductUrls.length-1];return aemCachedPdpUrl=aemCachedPdpUrl.replace("{offerId}",simKitFamilyId),toggleService.model.toggles.isCircuitBreaker&&(header["cb-response"]=aemCachedPdpUrl),getSimKitResponse(url,body,null,header,V2API).then(function(response){if(response.status>=400)return response.status;var sskData=angular.equals(V2API,!0)?pdpResponseTransformationServicePDPV2.getTransformedV2APIResponse(response,V2API).data.productdetails:response.data.productdetails;service.model.sskData=sskData,service.model.simPrice=sskData[0].PurchasePrice,service.model.simText=sskData[0].Family,$sessionStorage.simPrice=service.model.simPrice,$sessionStorage.simText=service.model.simText})}function getAuthorData(authorJSONUrl){var url="";switch($location.port()){case 9e3:url="/mockData/authorData.json";break;default:url=$location.$$url.contains("content/t-mobile")?"/bin/authorvalue"+authorJSONUrl.replace("html","json"):authorJSONUrl.contains("content/t-mobile")?"/bin/authorvalue/"+authorJSONUrl.replace("html","json"):"/bin/authorvalue/content/t-mobile"+authorJSONUrl.replace("html","json")}return httpRequest.get(url).then(function(result){service.model.authorValue=result.data,globalValue.authorValue=result.data})}function overrideInvStatus(){service.model.selectedProduct.invStatusLabel=service.model.selectedProduct.InvStatus,service.model.selectedProduct.InvStatus&&(angular.isUndefined(service.model.selectedProduct.InvStatus)&&"available"===service.model.selectedProduct.InvStatus.toLowerCase()&&(service.model.selectedProduct.invStatusLabel="Add to Bag"),service.model.invStatusObject&&service.model.invStatusObject.SKU===service.model.selectedProduct.SKU&&service.model.invStatusObject.invStatus===service.model.selectedProduct.InvStatus&&(service.model.selectedProduct.invStatusLabel=service.model.invStatusObject.invStatusLabel))}function refreshProductData(product){service.model.viewLessOrMoreDesc="less",service.model.selectedsku?service.model.selectedColorIndex=lodash.findIndex(lodash.filter(service.model.bulkproductData,function(data){return data.Memory===product.Memory}),function(o){return o.Color===product.Color&&o.Memory===service.model.selectedProduct.Memory}):service.model.selectedColorIndex=0,service.model.selectedColorValue=product.Color,filterProductData()}function filterProductData(){service.model.filteredProductData=lodash.filter(service.model.bulkproductData,{Memory:service.model.selectedProduct.Memory}),service.model.filteredProductData.length>5&&(service.model.viewLessOrMoreColors="less"),service.model.selectedProduct.Description.length>200&&(service.model.viewMoreDesc=!0)}function getCreditClassName(){var creditClassName="",persistedCreditClass=angular.isDefined(creditClassService.getCreditClass())?creditClassService.getCreditClass():{"class":"creditClass1"};return"creditClass1"===persistedCreditClass["class"]?creditClassName="GOOD":"creditClass2"===persistedCreditClass["class"]?creditClassName="BUILDING":"creditClass3"===persistedCreditClass["class"]&&(creditClassName="NONE"),creditClassName}function setSelectedPricing(){var creditClassName=getCreditClassName(),selectCreditLevel="";selectCreditLevel="monthly"===service.model.selectedVal?"EIP":"full"===service.model.selectedVal?"FRP":"EIP";var eipMonthlyPriceDesc="/mo (x{contractTerm} mos.)",showContractTermAPIValue=lodash.get(toggleService.model,"toggles.mainPDPATv2",!1);angular.forEach(service.model.selectedProduct.originalData,function(val){("GOOD"===val.creditLevel||"BUILDING"===val.creditLevel)&&(selectCreditLevel="EIP"),val.creditLevel!==creditClassName&&(""!==creditClassName||val.creditLevel)||val.type!==selectCreditLevel||(service.model.selectedPrice={PurchasePrice:service.model.selectedProduct.originalData[0].components[0].purchasePrice.amount,Upfront:val.payNowAmount.display,Monthly:val.monthlyAmount.display,TermMonth:"24",eipMonthlyText:showContractTermAPIValue===!0?eipMonthlyPriceDesc.replace("{contractTerm}",val.monthlyAmount.contractTerm):service.model.authorValue.rootPage.PDPAuthoring.eipMonthlyText,FullPrice:service.model.selectedProduct.originalData[0].components[0].listPrice.amount,DiscountMoney:parseFloat(service.model.selectedProduct.originalData[0].components[0].listPrice.amount-service.model.selectedProduct.originalData[0].components[0].purchasePrice.amount).toFixed(2)},$log.log("pricing",service.model.selectedProduct.pricing))})}function setPricingDetails(){service.model.defaultCreditClass=!0,service.model.selectedProduct.originalData=service.model.selectedProduct.pricing,"creditClass3"===service.model.selectedCreditClass["class"]?(service.model.creditClass3True=!0,service.model.selectedCreditClass=creditClassData.creditClass3,setSelectedPricing()):"creditClass2"===service.model.selectedCreditClass["class"]?(service.model.creditClass3True=!1,service.model.selectedCreditClass=creditClassData.creditClass2,setSelectedPricing()):(service.model.creditClass3True=!1,service.model.selectedCreditClass=creditClassData.creditClass1,angular.isDefined(service.model.selectedProduct)&&setSelectedPricing()),$rootScope.$emit("abttPDPSelectingProduct",service.model.selectedProduct)}function updateTradeinPromotions(){if(service.model.isTradeInApplicable=!1,service.model.selectedSku=service.model.selectedProduct.SKU,!lodash.isEmpty(service.model.routeData.tradeInPromotions)){service.model.tradeInPromotions=service.model.routeData.tradeInPromotions[0];var skuPromotion=lodash.find(lodash.split(angular.fromJson(service.model.tradeInPromotions).skuIDs,","),function(response){return response===service.model.selectedSku});lodash.isEmpty(skuPromotion)||(service.model.isTradeInApplicable=!0,service.model.offerText=angular.fromJson(service.model.tradeInPromotions).offerText,service.model.offerDescriptionHTML=angular.fromJson(service.model.tradeInPromotions).offerDescriptionHTML)}}function paymentOpt(){setSelectedPricing()}function loadRouteData($stateParams){var routeData=detailStateService.getStateRouteData($stateParams);return lodash.isEmpty(routeData)?$q.reject():(service.model.routeData=routeData.data,service.model.productOfferId=routeData.data.offerId,service.model.productTitle=routeData.data.title,$q.resolve(routeData))}function getProductData(productOfferId,productCategory){service.model.simprice=$sessionStorage.simPrice,service.model.simText=$sessionStorage.simText,service.model.productCategoryType=productCategory,service.model.selectedProductColor=$location.search().color;var dfRequest=new dataFactory.DFRequest;return dfRequest.input={familyId:productOfferId,productCategory:productCategory},dataFactory.getVO("globalPDPService",dfRequest,function(response){response.data.productdetails=_.map(response.data.productdetails,defaultProductService.updateMemoryValue),service.model.bulkproductData=[],service.model.defaultsku=response.data.DefaultSku,service.model.responseUniqueColors=lodash.uniq(lodash.map(response.data.productdetails,"Color")),service.model.selectedVal={},service.model.userSelectedPricing={},response.data.productdetailsData&&(service.model.productdetailsData=response.data.productdetailsData);for(var idx=0;idx<service.model.responseUniqueColors.length;idx++){var colorFilteredProducts=lodash.filter(response.data.productdetails,{Color:service.model.responseUniqueColors[idx]});colorFilteredProducts=lodash.sortBy(colorFilteredProducts,function(d){return parseInt(d.Memory,10)});for(var index=0;index<colorFilteredProducts.length;index++)service.model.bulkproductData.push(colorFilteredProducts[index])}defaultProductService.updateQueryStringParameters($location.search());var defaultProduct=defaultProductService.getDefaultDisplaySKU(service.model.bulkproductData,$location.search(),service.model.authorValue.page.defaultsku);service.model.selectedMemoryData=lodash.filter(service.model.bulkproductData,{Color:defaultProduct.Color}),service.model.selectedMemory=defaultProduct.SKU,service.model.selectedProduct=defaultProduct,service.model.productOfferId=productOfferId,service.model.isSimKitPdp=_.includes(simKitOfferIds,service.model.selectedProduct.familyId);var colorOptions=[],memoryOptions=[];lodash.each(lodash.uniqBy(service.model.bulkproductData,"Color"),function(colorSKU){colorOptions.push({color:colorSKU.Color,swatch:colorSKU.ColorSwatch,sku:colorSKU.SKU,associatedMemorySKUS:lodash.filter(service.model.bulkproductData,{Color:colorSKU.Color})})}),lodash.each(lodash.uniqBy(service.model.bulkproductData,"Memory"),function(memorySKU){memoryOptions.push({memory:memorySKU.Memory,sku:memorySKU.SKU,associatedColorSKUS:lodash.filter(service.model.bulkproductData,{Memory:memorySKU.Memory})})}),service.model.colorOptions=lodash.uniqBy(colorOptions,"color"),service.model.memoryOptions=lodash.uniqBy(memoryOptions,"memory"),service.model.productCategoryType=productCategory,"accessory"===service.model.productCategoryType&&angular.isDefined(service.model.authorValue.rootPage.deviceBrowse.enableeipaccessories)&&"true"===service.model.authorValue.rootPage.deviceBrowse.enableeipaccessories?service.model.selectedVal="monthly":"accessory"===service.model.productCategoryType&&(angular.isUndefined(service.model.authorValue.rootPage.deviceBrowse.enableeipaccessories)||lodash.isEmpty(service.model.authorValue.rootPage.deviceBrowse.enableeipaccessories))&&(service.model.selectedVal="full"),service.model.selectedsku=service.model.selectedProduct.SKU,service.model.productOfferId=productOfferId;var selectedProduct=service.model.selectedProduct;if(service.model.productTitle=selectedProduct.Family,angular.isDefined(service.model.selectedProduct.BadgesAndPromotions)&&setProductBadge(service.model.selectedProduct.BadgesAndPromotions),setPricingDetails(),updateTradeinPromotions(),angular.isDefined(service.model.selectedProduct.DeviceId)&&!isSimToolkit(service.model.selectedProduct)&&(angular.element($window).on("scroll",BVReviewService.captureReviewAnalytics),BVReviewService.setBVReviews(service.model.selectedProduct.DeviceId)),service.model.productImg=[],lodash.isEmpty(service.model.selectedProduct.FrontImage)||service.model.productImg.push(service.model.selectedProduct.FrontImage),lodash.isEmpty(service.model.selectedProduct.LeftImage)||service.model.productImg.push(service.model.selectedProduct.LeftImage),lodash.isEmpty(service.model.selectedProduct.BackImage)||service.model.productImg.push(service.model.selectedProduct.BackImage),lodash.isEmpty(service.model.selectedProduct.RightImage)||service.model.productImg.push(service.model.selectedProduct.RightImage),lodash.isEmpty(service.model.selectedProduct.AverageStarRating)&&(service.model.selectedProduct.AverageStarRating=""),updateInventoryStatus(service.model.selectedProduct.InvStatus),service.model.productImgDataChange=!1,service.model.selectedMemory=service.model.selectedProduct.SKU,overrideInvStatus(),refreshProductData(service.model.selectedProduct),populateProductBannerAttributes(),service.model.selectedProduct.labelUpfront=service.model.pricingLabelData.selectedProductUpfront,service.model.selectedProduct.labelUpfrontDesc=service.model.pricingLabelData.selectedProductUpfrontDescription,service.model.selectedProduct.labelMonthly=service.model.pricingLabelData.selectedProductMonthly,service.model.selectedProduct.labelMonthlyDesc=service.model.pricingLabelData.selectedProductMonthlyDescription,service.model.selectedProduct.labelStandard=service.model.pricingLabelData.selectedProductStandard,service.model.selectedProduct.labelStandardDesc=service.model.pricingLabelData.selectedProductStandardDescription,service.model.selectedProduct.labelTotal=service.model.pricingLabelData.selectedProductTotal,service.model.selectedProduct.labelTotalDesc=service.model.pricingLabelData.selectedProductTotalDescription,service.model.selectedProduct.labelPriceBreakdown=service.model.pricingLabelData.selectedProductPriceBreakdownTitle,service.model.selectedProduct.labelFullDevicePrice=service.model.pricingLabelData.selectedProductFullDevicePriceTitle,service.model.selectedProduct.labelOriginalPrice=service.model.pricingLabelData.selectedProductOriginalPriceTitle,service.model.selectedProduct.creditClassDescText=service.model.pricingLabelData.selectedProductCreditClassDescriptionText,service.model.selectedProduct.eipMonthlyText=service.model.pricingLabelData.selectedProductEIPMonthlyText,$rootScope.$broadcast("sliderDataChangeEvent"),$rootScope.$broadcast("pdpUpdateSlowResponse"),productDataUpdate(),service.model.tabs=[{id:"key_features",label:"Features"},{id:"reviews",label:"Reviews",value:"Reviews content"}],_.isEmpty(service.model.selectedProduct.Description)||_.isEmpty(service.model.selectedProduct.Family)||_.isEmpty(service.model.selectedProduct.ProductBoxSpec)){var tabs=service.model.tabs;service.model.tabs=_.remove(tabs,function(tab){return"key_features"!==tab.id})}if(angular.equals(service.model.productCategoryType,"accessory")){var tabss=service.model.tabs;service.model.tabs=_.remove(tabss,function(tab){return"reviews"!==tab.id})}})}function productDataUpdate(){productDataUpdateDeferred.notify()}function onProductDataUpdate(){return productDataUpdateDeferred.promise}function rejectPromise(){productDataUpdateDeferred.reject(),productDataUpdateDeferred=$q.defer()}function populateProductBannerAttributes(){CQ_Analytics&&CQ_Analytics.TmobileStoreMgr&&(CQ_Analytics.TmobileStoreMgr.setProperty("devicetype",service.model.productCategoryType),CQ_Analytics.TmobileStoreMgr.setProperty("sku",service.model.selectedProduct.SKU),CQ_Analytics.TmobileStoreMgr.setProperty("Family",service.model.selectedProduct.Family),CQ_Analytics.TmobileStoreMgr.setProperty("Manufacturer",service.model.selectedProduct.Manufacturer),window.isB2B?CQ_Analytics.TmobileStoreMgr.setProperty("SiteType","Business"):CQ_Analytics.TmobileStoreMgr.setProperty("SiteType","Consumer"))}function getFormattedDate(dateValue){if(angular.isDefined(dateValue)){var myDate=new Date(dateValue);if(myDate=moment(myDate),myDate.isValid())return myDate.format("M/D")}return""}function isSimToolkit(product){var simKitSkuIds=["610214641922","610214641939"];return!(!product||-1===simKitSkuIds.indexOf(product.SKU))}function isEIPProductTypeAvailable(product){var available="",creditClassName=getCreditClassName();return product&&product.pricing&&angular.forEach(product.pricing,function(pricingOption){if(creditClassName===pricingOption.creditLevel&&"EIP"===pricingOption.type){available=pricingOption.priceTypeAvailable;var nonEipToggle=toggleService.model.toggles.NonEipToggle;nonEipToggle===!1&&(available=!0)}}),available}function isAccessoryEIPEligible(product){var eipDisplayEligibility=!0,creditClassName=getCreditClassName();return product&&product.pricing&&angular.forEach(product.pricing,function(pricingOption){if(creditClassName===pricingOption.creditLevel&&"EIP"===pricingOption.type){var eipPriceTypeEligible=pricingOption.priceTypeAvailable,enableEIPAuthorFlag=service.model.authorValue.rootPage.accessoriesAuthoring.enableeipaccessoriespdp;eipDisplayEligibility=toggleService.model.toggles.NonEipToggle?eipPriceTypeEligible:"true"===enableEIPAuthorFlag}}),eipDisplayEligibility}function getAccessoriesCarouselData(url){var deferred=$q.defer();return httpRequest.get(url).then(function(response){angular.isObject(response.data)&&angular.isDefined(response.data.products)?deferred.resolve(response.data.products):deferred.resolve([])},function(){deferred.reject({error:"error"})}),deferred.promise}function accessoriesCarouselForDevice(){var deferred=$q.defer(),apiUrl=apiURLs.authorableCarousel+"/associations/"+service.model.productOfferId,params=["productType=Accessory","detailed=true","popular=true"],url=apiUrl+"?"+params.join("&");return getAccessoriesCarouselData(url).then(function(response){var products=response;products.length<12?(params=params.slice(0,-1),url=apiUrl+"?"+params.join("&"),getAccessoriesCarouselData(url).then(function(response){products=products.concat(response),deferred.resolve(products)},function(){deferred.reject({error:"error"})})):deferred.resolve(products)},function(){deferred.reject({error:"error"})}),deferred.promise}function accessoriesCarouselForAccessories(){var products,deferred=$q.defer(),apiUrl=apiURLs.authorableCarousel,params=["type=ACCESSORIES","accessoryCategory=UNIVERSAL","detailed=true","skuLevelInstantDiscountRange=0-100"],url=apiUrl+"?"+params.join("&");return getAccessoriesCarouselData(url).then(function(response){products=response,products.length<12?(params=params.slice(0,-1),url=apiUrl+"?"+params.join("&"),getAccessoriesCarouselData(url).then(function(response){products=products.concat(response),deferred.resolve(products)},function(){deferred.reject({error:"error"})})):deferred.resolve(products)},function(){return params=params.slice(0,-1),url=apiUrl+"?"+params.join("&"),getAccessoriesCarouselData(url).then(function(response,errorResponse){products=products.concat(response),deferred.resolve(products)},function(){deferred.reject({error:"error"})}),deferred.promise}),deferred.promise}function recommendedAccessoriesCarousel(){return"accessory"===service.model.productCategoryType?accessoriesCarouselForAccessories():accessoriesCarouselForDevice()}function getProductCategoryType(){return detailStateService.productCategoryType}function resetInvStatus(){service.model.invStatusPreOrder=!1,service.model.invStatusOutOfOrder=!1,service.model.invStatusBackOrder=!1,service.model.invStatusComingSoon=!1,service.model.invStatusAddToCart=!1,service.model.invStatusNotForSale=!1,service.model.invStatusDefault=!1}function addtoTmoCookie(buttonName){var data={},tradeInPromoName=service.model.tradeInPromotions,groupPromoId="";tradeInPromoName&&(tradeInPromoName=lodash.isArray(tradeInPromoName)?angular.fromJson(service.model.tradeInPromotions[0]).promoName:angular.fromJson(service.model.tradeInPromotions).promoName,
groupPromoId=service.model.tradeInPromotions[0].groupPromoId),data=lodash.get(toggleService.model,"toggles.isAALTMO2MyTMODeepLinkEnabled",!1)&&service.model.selectedProduct.ProductType===productDetailConstant.PRODUCT_TYPE.DEVICE?{sku:service.model.selectedProduct.SKU?service.model.selectedProduct.SKU:void 0,productType:service.model.selectedProduct.ProductSubType?service.model.selectedProduct.ProductSubType:void 0,paymentOption:service.isSimToolkit(service.model.selectedProduct)?"FULL":service.model.selectedVal&&"monthly"===service.model.selectedVal?"EIP":"FULL",promoName:tradeInPromoName,promoID:groupPromoId,familyId:service.model.productOfferId,transactionType:service.getMyTmoUserIntent(buttonName),intent:isSimToolkit(service.model.selectedProduct)?productDetailConstant.INTENT.BYOD:productDetailConstant.INTENT.GSM,deviceId:service.model.selectedProduct.DeviceId}:service.model.selectedProduct.ProductType===productDetailConstant.PRODUCT_TYPE.ACCESSORY?{accessoryId:service.model.selectedProduct.DeviceId?service.model.selectedProduct.DeviceId:void 0,sku:service.model.selectedProduct.SKU?service.model.selectedProduct.SKU:void 0,productName:service.model.selectedProduct.Family?service.model.selectedProduct.Family:void 0,imageURL:service.model.selectedProduct.FrontImage?service.model.selectedProduct.FrontImage:void 0,pdpURL:$location.$$absUrl,isEIPEligible:isEIPProductTypeAvailable(service.model.selectedProduct),webPrice:service.model.selectedProduct.PurchasePrice,quantity:1}:{sku:service.model.selectedProduct.SKU?service.model.selectedProduct.SKU:void 0,productType:service.model.selectedProduct.ProductSubType?service.model.selectedProduct.ProductSubType:void 0,paymentOption:service.isSimToolkit(service.model.selectedProduct)?"FULL":service.model.selectedVal&&"monthly"===service.model.selectedVal?"EIP":"FULL",promoName:tradeInPromoName,promoID:groupPromoId,familyId:service.model.productOfferId},$log.log("Data defined",data),cartStorage.setTmoData(data)}function updateInventoryStatus(inventoryStatus){lodash.isEmpty(inventoryStatus)?(resetInvStatus(),service.model.invStatusDefault=!0,service.model.invStatusDefaultMessage=service.model.authorValue.rootPage.PDPAuthoring.defaultMsg):"AVAILABLE_FOR_PRE_ORDER"===inventoryStatus?(resetInvStatus(),service.model.invStatusPreOrder=!0,lodash.isEmpty(service.model.selectedProduct.AvailableFromDate)||(service.model.availFromDate=service.getFormattedDate(service.model.selectedProduct.AvailableFromDate)),lodash.isEmpty(service.model.selectedProduct.AvailableToDate)||(service.model.availToDate=service.getFormattedDate(service.model.selectedProduct.AvailableToDate)),""!==service.model.availFromDate&&""!==service.model.availToDate&&(service.model.validDateFormat=!0)):"AVAILABLE_FOR_BACK_ORDER"===inventoryStatus?(resetInvStatus(),service.model.invStatusBackOrder=!0,lodash.isEmpty(service.model.selectedProduct.AvailableFromDate)||(service.model.availFromDate=service.getFormattedDate(service.model.selectedProduct.AvailableFromDate)),lodash.isEmpty(service.model.selectedProduct.AvailableToDate)||(service.model.availToDate=service.getFormattedDate(service.model.selectedProduct.AvailableToDate)),""!==service.model.availFromDate&&""!==service.model.availToDate&&(service.model.validDateFormat=!0)):"NOT_AVAILABLE"===inventoryStatus?(resetInvStatus(),service.model.invStatusOutOfOrder=!0):"COMING_SOON"===inventoryStatus||"NOT_AVAILABLE_COMING_SOON"===inventoryStatus?(resetInvStatus(),service.model.invStatusComingSoon=!0,service.model.invStatusComingMessage=service.model.authorValue.rootPage.PDPAuthoring.comingsoonMsg):"AVAILABLE"===inventoryStatus?(resetInvStatus(),service.model.invStatusAddToCart=!0,service.model.invStatusAddToCartMessage=service.model.authorValue.rootPage.PDPAuthoring.availableMsg):"NOT_AVAILABLE_FOR_SALE_ONLINE"===inventoryStatus?(resetInvStatus(),service.model.invStatusNotForSale=!0,service.model.invStatusNotForSaleMessage=service.model.authorValue.rootPage.PDPAuthoring.notforsaleMsg):(resetInvStatus(),service.model.invStatusDefault=!0,service.model.invStatusDefaultMessage=service.model.authorValue.rootPage.PDPAuthoring.defaultMsg)}function setTabAndScroll(hash){var isHashLocation=!1;return _.isEmpty(hash)||$location.hash(hash),_.map(service.model.tabs,function(value,index){value.id===$location.hash()&&(service.model.paneIndextab=index,isHashLocation=!0)}),angular.equals(service.model.paneIndextab,1)&&angular.isDefined(service.model.selectedProduct.DeviceId)&&!isSimToolkit(service.model.selectedProduct)&&$timeout(function(){BVReviewService.setBVReviews(service.model.selectedProduct.DeviceId),$anchorScroll(),$window.innerWidth>768?$anchorScroll.yOffset=250:$window.innerWidth>400?$anchorScroll.yOffset=-1704:$anchorScroll.yOffset=-1550},400),$anchorScroll(),$window.innerWidth>768?$anchorScroll.yOffset=250:$window.innerWidth>400?$anchorScroll.yOffset=-1704:$anchorScroll.yOffset=-1550,isHashLocation}function setTabAndScrollForTab(hash){var isHashLocation=!1;return _.isEmpty(hash)||$location.hash(hash),_.map(service.model.tabs,function(value,index){value.id===$location.hash()&&(service.model.paneIndextab=index,isHashLocation=!0)}),angular.equals(service.model.paneIndextab,1)&&angular.isDefined(service.model.selectedProduct.DeviceId)&&!isSimToolkit(service.model.selectedProduct)&&$timeout(function(){if(BVReviewService.setBVReviews(service.model.selectedProduct.DeviceId),$window.innerWidth>768)$anchorScroll.yOffset=250,$anchorScroll();else if($window.innerWidth>400)$anchorScroll.yOffset=-1704,$anchorScroll();else{if(angular.isUndefined(angular.element("pdp-help-block"))){var offset=angular.element("pdp-help-block").offset().top,navBarHeight=angular.element("header").css("height")?parseInt(angular.element("header").css("height")):0;$anchorScroll.yOffset=-(offset-navBarHeight)}else $anchorScroll.yOffset=-1550;$anchorScroll()}},400),isDesktopView&&$anchorScroll(),$window.innerWidth>768?$anchorScroll.yOffset=250:$window.innerWidth>400,isHashLocation}function setTabAndScrollOnLoad(hash){var isHashLocation=!1;return _.isEmpty(hash)||$location.hash(hash),_.map(service.model.tabs,function(value,index){value.id===$location.hash()&&(service.model.paneIndextab=index,isHashLocation=!0)}),angular.equals(service.model.paneIndextab,1)&&angular.isDefined(service.model.selectedProduct.DeviceId)&&!isSimToolkit(service.model.selectedProduct)&&$timeout(function(){BVReviewService.setBVReviews(service.model.selectedProduct.DeviceId),$window.innerWidth>768?($rootScope.$broadcast("selectReviewTab"),$anchorScroll()):$window.innerWidth>700&&$window.innerWidth<=768?($rootScope.$broadcast("selectReviewTab"),$anchorScroll.yOffset=175,$anchorScroll($location.hash())):$window.innerWidth>400?($rootScope.$broadcast("selectReviewTab"),$anchorScroll.yOffset=150,$anchorScroll($location.hash())):($rootScope.$broadcast("selectReviewTab"),$anchorScroll.yOffset=150,$anchorScroll($location.hash()))},400),$window.innerWidth>768?$anchorScroll():$window.innerWidth>400,isHashLocation}function getMyTmoUserIntent(buttonName){return service.isMyTmoCookiedCustomer()?buttonName===productDetailConstant.BUTTON_ACTION_TYPE.UPGRADE?productDetailConstant.TRANSACTION_TYPE.UPGRADE:productDetailConstant.TRANSACTION_TYPE.AAL:lodash.get(toggleService.model,"toggles.isLoginIntentUpgrade",!1)?productDetailConstant.TRANSACTION_TYPE.UPGRADE:productDetailConstant.TRANSACTION_TYPE.UNKNOWN}function isMyTmoCookiedCustomer(){return angular.isDefined(commonServices.$cookies.get("MyTMobile"))}var service=this,$window=commonServices.$window,isDesktopView=$window.innerWidth>767,simKitOfferIds=["i-21225F913860490989C4738E867119BB","i-DC14CC31D84F4BB7A9547DB4DDD19DF8"],productDataUpdateDeferred=$q.defer();service.model={productdetailsData:[],defaultCreditClass:!0,creditClass3True:!0,isTradeInApplicable:!1,tradeinPromo:{},selectedCreditClass:{},selectedProduct:{},sskData:"",simPrice:"",simText:"",productOfferId:"",productCategoryType:"",productTitle:"",bulkproductData:[],responseUniqueColors:[],productImg:[],productImgDataChange:!1,selectedMemory:"",pricingLabelData:[],productBadge:"",viewLessOrMoreDesc:"less",selectedsku:0,selectedColorIndex:0,selectedColorValue:"",selectedProductColor:"",filteredProductData:[],selectedVal:"",productDataForFeatureDevices:[],sQuantity:1,productDescCharLimit:200,currentPage:0,invStatusPreOrder:!1,invStatusBackOrder:!1,invStatusOutOfOrder:!1,invStatusComingSoon:!1,invStatusAddToCart:!1,invStatusNotForSale:!1,invStatusDefault:!1,invStatusAddToCartMessage:"",invStatusPreOrderMessage:"",invStatusBackOrderMessage:"",invStatusComingMessage:"",invStatusNotForSaleMessage:"",invStatusDefaultMessage:"",pdpSubNav:!0,isQuantityDropDown:!0,FAQ:{},DESC:{},quantity:5,$sce:$sce,creditClassData:{},selectedIndexnew:0,setCreditClass:{},invStatusObject:[],authorValue:{},clubTier:0,selectedMemoryData:[],colorOptions:[],memoryOptions:[],availFromDate:"",availToDate:"",validDateFormat:!1,paneIndextab:0,tabs:[],tabslength:"",selectedProductFeatureDetails:{}},service.setPricingDetails=setPricingDetails,service.updateTradeinPromotions=updateTradeinPromotions,service.paymentOpt=paymentOpt,service.getProductData=getProductData,service.productDataUpdate=productDataUpdate,service.onProductDataUpdate=onProductDataUpdate,service.getAuthorData=getAuthorData,service.getSSKData=getSSKData,service.populateProductBannerAttributes=populateProductBannerAttributes,service.isSimToolkit=isSimToolkit,service.isEIPProductTypeAvailable=isEIPProductTypeAvailable,service.recommendedAccessoriesCarousel=recommendedAccessoriesCarousel,service.getProductCategoryType=getProductCategoryType,service.loadRouteData=loadRouteData,service.getFormattedDate=getFormattedDate,service.getFAQData=getFAQData,service.updateInventoryStatus=updateInventoryStatus,service.isAccessoryEIPEligible=isAccessoryEIPEligible,service.addtoTmoCookie=addtoTmoCookie,service.setTabAndScroll=setTabAndScroll,service.setTabAndScrollOnLoad=setTabAndScrollOnLoad,service.setTabAndScrollForTab=setTabAndScrollForTab,service.rejectPromise=rejectPromise,service.getMyTmoUserIntent=getMyTmoUserIntent,service.isMyTmoCookiedCustomer=isMyTmoCookiedCustomer}productDetailsServiceConstructor.$inject=["$sce","$q","$location","$log","$rootScope","$sessionStorage","$timeout","httpRequest","detailStateService","creditClassService","BVReviewService","creditClassData","apiURLs","defaultProductService","toggleService","dataFactory","globalValue","cartStorage","commonServices","pdpResponseTransformationServicePDPV2","httpRequestWrapper","$anchorScroll","productDetailConstant"],angular.module("tmobileApp").service("productDetailsService",productDetailsServiceConstructor)}(angular,_,window.CQ_Analytics),function(angular,lodash){"use strict";function reviewOrderController($window,$state,checkOutModelService,globalValue,submitOrderUtil,cartHttpDataService,checkOutConstants,CartUtils,toggleService,skuPriceService,commonUtils,apiService,$log,cartConstants,transformCartV2,cartCommonOperationsService,checkOutHttpDataUtil){function reviewOrderSubmit(){var checkOutInfo=checkOutModelService.model.checkOutInfo;vm.toggles.isV3DataMatchEnabled&&vm.toggles.isDcpV3ApiEnabled?dataMatchV3(checkOutInfo):vm.toggles.isDcpV3ApiEnabled?submitOrderUtil.submitOrderV3():dataMatch(checkOutInfo)}function dataMatch(checkOutInfo){cartHttpDataService.getCart().then(function(epCart){matchData(epCart,checkOutInfo)?submitOrderUtil.submitOrder():$state.reload()})}function dataMatchV3(checkOutInfo){cartHttpDataService.getQuotes(checkOutInfo).then(function(quotesRes){matchData(quotesRes.data.reviewCart,checkOutInfo)?submitOrderUtil.submitOrderV3():$state.reload()})}function matchData(response,checkOutInfo){var epAccessorySkuArray=lodash.map(checkOutInfo.reviewCart.accessories.accessoryDetails,function(accessoryDetail){return lodash.pick(accessoryDetail,"sku")}),localAccessorySkuArray=lodash.map(response.accessories.accessoryDetails,function(accessoryDetail){return lodash.pick(accessoryDetail,"sku")}),epLinesSKUArray=lodash.map(response.lineItems,function(epLineItem){return lodash.pick(epLineItem,"lineItemDetails.deviceDetails.sku")}),localLinesSKUArray=lodash.map(checkOutInfo.reviewCart.lineItems,function(lineItem){return lodash.pick(lineItem,"lineItemDetails.deviceDetails.sku")}),epSimkitSKUArray=lodash.map(response.lineItems,function(lineItem){return lodash.pick(lineItem,"simKitDetails.simKitId")}),localSimkitSKUArray=lodash.map(checkOutInfo.reviewCart.lineItems,function(lineItem){return lodash.pick(lineItem,"simKitDetails.simKitId")});return angular.equals(epAccessorySkuArray,localAccessorySkuArray)&&angular.equals(epLinesSKUArray,localLinesSKUArray)&&angular.equals(epSimkitSKUArray,localSimkitSKUArray)?!0:!1}function setSectionToBeDisplayed(sectionToBeDisplayed){checkOutModelService.model.errors.displayErrorMessage=!1,checkOutModelService.setSectionToBeDisplayed(sectionToBeDisplayed)}function storeCartForm(){checkOutModelService.model.checkOutInfo.cardInfo={},checkOutModelService.model.checkOutInfo.creditcheck={},checkOutModelService.model.checkOutInfo.personalInfo.personlaInfoDisclaimer=!1,checkOutModelService.setSectionToBeDisplayed(checkOutConstants.SECTIONS.INFOANDSHIPPING),sessionStorage.setItem("cartForm",angular.toJson(checkOutModelService.model))}function init(){var tradeInTypes=checkOutConstants.TRADEINTYPES;vm.checkoutInfo=checkOutModelService.model.checkOutInfo,vm.authorValue=globalValue.authorValue,vm.setSectionToBeDisplayed=setSectionToBeDisplayed,vm.errors=checkOutModelService.model.errors,vm.SECTIONS=checkOutConstants.SECTIONS,vm.tradeInTnC="",vm.showFinancedAmount=lodash.get(toggleService.model,"toggles.showFinancedAmount",!1),vm.shippingFee=commonUtils.searchJson(checkOutModelService.model.checkOutInfo,'selectedShippingOptions[?(@.selected==="true" || @.selected===true)].cost'),vm.totalFinanceAmtStaticLabel=cartConstants.TOTAL_FINANCE_AMOUNT,vm.totalFinancedAmount=0,vm.showFinancedAmount&&calculateTotalFinancedAmount(),vm.isDesktopView=$window.innerWidth>767;var tncLength=lodash.get(vm.authorValue,"checkout.termsandconditions.termsCondition.length");switch(vm.index=tncLength?tncLength-1:0,vm.tradeInType=lodash.get(checkOutModelService.model,"checkOutInfo.reviewCart.tradeInType",void 0),vm.tradeInType){case tradeInTypes.STANDARD:vm.tradeInTnC=lodash.get(vm.authorValue,"checkout.drpCustomerAgreements.standardTradeIn","");break;case tradeInTypes.DOLLARZEROPROMO:vm.tradeInTnC=lodash.get(vm.authorValue,"checkout.drpCustomerAgreements.dollarZeroTradeIn","");break;case tradeInTypes.MIXED:vm.tradeInTnC=lodash.get(vm.authorValue,"checkout.drpCustomerAgreements.mixedTradeIn","");break;default:vm.tradeInTnC=void 0}}function getEIPShortestTerm(cartItems){var shortestEIPTerm,eipTerms=[];return cartItems&&(cartItems.accessories||cartItems.lineItems)&&(cartItems.lineItems&&angular.forEach(cartItems.lineItems,function(value,key){angular.isDefined(value.lineItemDetails.deviceDetails.monthlyPrice)&&"MONTHLY"===value.lineItemDetails.deviceDetails.pricingOption&&"DEVICE"===value.lineItemDetails.deviceDetails.productType&&eipTerms.push(value.lineItemDetails.deviceDetails.monthlyPrice.termMonths)}),cartItems.accessories&&angular.forEach(cartItems.accessories.accessoryDetails,function(value,key){value.monthlyPrice.termMonths&&"EIP"===value.paymentOption&&eipTerms.push(value.monthlyPrice.termMonths)}),eipTerms.length>0&&(shortestEIPTerm=Math.min.apply(Math,eipTerms),vm.isFRPOnlyCart=!1)),shortestEIPTerm}function calculateTotalFinancedAmount(){vm.showFinancedAmount&&(vm.totalFinancedAmount=transformCartV2.totalFinanceAmountCalculation(vm.checkoutInfo.reviewCart))}var vm=this;init(),vm.toggles=toggleService.model.toggles,vm.reviewOrderSubmit=reviewOrderSubmit,vm.storeCartForm=storeCartForm,vm.cartCommonOperationsService=cartCommonOperationsService,vm.getEIPShortestTerm=getEIPShortestTerm,(vm.toggles.apiVersion2||vm.toggles.isDcpV3ApiEnabled)&&skuPriceService.getAllSkuPrices(vm.checkoutInfo.reviewCart),vm.checkOutHttpDataUtil=checkOutHttpDataUtil,vm.toggles.checkoutReviewATv2&&(vm.isFRPOnlyCart=!0,vm.eipShortestTerm=getEIPShortestTerm(vm.checkoutInfo.reviewCart),vm.eipLegalTextOnCart=vm.authorValue.rootPage.pricingBreakdown.shortestEIPLegalText?vm.authorValue.rootPage.pricingBreakdown.shortestEIPLegalText.replace("{shortestEIPTerm}",vm.eipShortestTerm):"")}reviewOrderController.$inject=["$window","$state","checkOutModelService","globalValue","submitOrderUtil","cartHttpDataService","checkOutConstants","CartUtils","toggleService","skuPriceService","commonUtils","apiService","$log","cartConstants","transformCartV2","cartCommonOperationsService","checkOutHttpDataUtil"],angular.module("tmobileApp").controller("ReviewOrderController",reviewOrderController)}(window.angular,window._),function(angular){"use strict";function productService(httpRequest,apiURLs){function getProductData(productOfferId,productCategoryType){var url=apiURLs.product.detail+"/"+productOfferId;return httpRequest.get(url)}function setAemDescription(url,data){return httpRequest.post(url,data)}function getAccessoriesData(){return httpRequest.get(apiURLs.accessoriesData)}function setQuantity(qty){quantity=qty}function getQuantity(){return quantity}var quantity="";return{getProductData:getProductData,getAccessoriesData:getAccessoriesData,setAemDescription:setAemDescription,setQuantity:setQuantity,getQuantity:getQuantity}}productService.$inject=["httpRequest","apiURLs"],angular.module("tmobileApp").service("productService",productService)}(angular),function(angular,lodash){"use strict";function paymentInfoController(coreServices,checkOutModelService,checkOutControllerHelperUtil,checkOutValidationUtil,checkOutHttpDataUtil,checkOutConstants,globalValue,CHECKOUT_STATE_NAME,apiService,$log,commonStorage,pdlConstant,modalDialogFactory){function autoPaySwitched(){lodash.get(vm.toggles,"isTPPON",!1)?vm.autoPaySwitchedv3():autoPaySwitchedv1()}function autoPaySwitchedv1(){vm.checkoutInfo.flags.isStorePayment=vm.checkoutInfo.flags.isAutoPay?vm.checkoutInfo.flags.isAutoPay:vm.checkoutInfo.flags.isStorePayment,checkOutHttpDataUtil.createAuditRecords(vm.checkoutInfo.flags.isAutoPay,vm.checkoutInfo.flags.isStorePayment).then(function(auditCallResponse){200===auditCallResponse.status?checkOutHttpDataUtil.loadCheckOutData({ignoreLoadingBar:!1}).then(function(cartResponse){angular.equals(checkOutConstants.FAILEDSTATUS,cartResponse.status)?checkOutModelService.model.errors.displayErrorMessage=!0:(coreServices.cartStorage.setGlobalSmartCartInfo(cartResponse.reviewCart),checkOutModelService.model.checkOutInfo.reviewCart=cartResponse.reviewCart,checkOutModelService.model.checkOutInfo.subTotal=cartResponse.subTotal,checkOutModelService.model.checkOutInfo.total=cartResponse.total)}):checkOutModelService.model.errors.displayErrorMessage=!0})}function autoPaySwitchedv3(){var apiUrl=apiService.getURL("createAuditRecordsUrl").url,cartId=coreServices.cartStorage.getCartId();apiUrl=apiUrl.replace("{{cartID}}",cartId);var headers={follow:"true"},inputData={auditRecords:[{auditKey:"AUTO_PAY",auditValue:vm.checkoutInfo.flags.isAutoPay}]};coreServices.httpRequestWrapper.post(apiUrl,inputData,null,headers,!0,"createAuditRecordsUrl").then(function(responseData){angular.equals(responseData.status,200)&&responseData.data?checkOutHttpDataUtil.loadFullCheckOutData().then(function(response){commonStorage.assignIntoSharedLS(checkOutConstants.AUTO_PAY_TOGGLE,checkOutModelService.model.checkOutInfo.flags.isAutoPay),coreServices.cartStorage.setGlobalSmartCartInfo(response.reviewCart),checkOutModelService.model.checkOutInfo.reviewCart=response.reviewCart,checkOutModelService.model.checkOutInfo.subTotal=response.subTotal,checkOutModelService.model.checkOutInfo.total=response.total}):checkOutModelService.model.errors.displayErrorMessage=!0})}var vm=this,toggleService=coreServices.toggleService;vm.authorValue=globalValue.authorValue,vm.CHECKOUT_STATE_NAME=CHECKOUT_STATE_NAME,vm.conditionalAuthorValue=checkOutControllerHelperUtil.setConditionalAuthorData(vm.authorValue.checkout.paymentAndCreditCheck),vm.checkoutInfo=checkOutModelService.model.checkOutInfo,vm.isOnlyAccessoryFlow=lodash.get(vm.checkoutInfo,"reviewCart.flags.isOnlyAccessory",!1),vm.validateExpOnChange=checkOutValidationUtil.validateExpireDateOnChange,vm.errors=checkOutModelService.model.errors,vm.toggles=toggleService.model.toggles,vm.autoPaySwitched=autoPaySwitched,vm.autoPaySwitchedv3=autoPaySwitchedv3,vm.isTPPON=lodash.get(vm.toggles,"isTPPON",!1),vm.openVerifyIdentityModal=modalDialogFactory.openVerifyIdentityModal,vm.isFormStartAnalyticsOn=lodash.get(vm.toggles,"isFormStartAnalyticsOn",!1),vm.openFraudCheckRejectModal=modalDialogFactory.openFraudCheckRejectModal,vm.openFraudCheckTimeoutModal=modalDialogFactory.openFraudCheckTimeoutModal,"true"===localStorage.getItem("isCheckoutModalOpenFlow")?vm.pageToLoad="":vm.pageToLoad="shippingPayment",vm.formName=vm.isFormStartAnalyticsOn?pdlConstant.FORM_NAME.SHIPPING_PAYMENT:""}paymentInfoController.$inject=["coreServices","checkOutModelService","checkOutControllerHelperUtil","checkOutValidationUtil","checkOutHttpDataUtil","checkOutConstants","globalValue","CHECKOUT_STATE_NAME","apiService","$log","commonStorage","pdlConstant","modalDialogFactory"],angular.module("tmobileApp").controller("PaymentInfoController",paymentInfoController)}(window.angular,window._),function(angular){"use strict";function responseTransformationServicePDPFn(jsonPath,$log,apiURLs,toggleService,globalAssetRepositoryConstants){function getSpecData(specDataV2){var specifications=[];if(!_.isEmpty(specDataV2))for(var i=0;i<specDataV2.length;i++){var dataToPush={label:specDataV2[i].label,value:[specDataV2[i].value]};specifications.push(dataToPush)}return specifications}function getColorSwatch(colorOptionsV2,color){var colorSwatch="";if(!_.isEmpty(colorOptionsV2))for(var i=0;i<colorOptionsV2.length;i++)(toggleService.model.toggles.mainPDPATv2?colorOptionsV2[i].name.toLowerCase()===color.toLowerCase():colorOptionsV2[i].name===color)&&(colorSwatch=colorOptionsV2[i].imagePath);return colorSwatch}function getFeatures(featuresDataV2){var features=[];if(!_.isEmpty(featuresDataV2))for(var i=0;i<featuresDataV2.length;i++){var dataToPush={Header:featuresDataV2[i].name,Description:featuresDataV2[i].description,Type:""};features.push(dataToPush)}return features}function getOffers(offerData){var offers=[],dataToPush={offerName:"",offerShortDescription:"",offerLongDescription:""};if(angular.isDefined(offerData)&&""!==offerData)for(var i=0;i<offerData.length;i++)if("GOOD"===apiURLs[offerData[i].pricingOptionName]&&angular.isDefined(offerData[i].skuPrice.promotions)&&""!==offerData[i].skuPrice.promotions)for(var j=0;j<offerData[i].skuPrice.promotions.length;j++)dataToPush={offerName:offerData[i].skuPrice.promotions[j].promoName,offerShortDescription:offerData[i].skuPrice.promotions[j].promoName,offerLongDescription:getGARImagePathForOfferModal(offerData[i].skuPrice.promotions[j].longDescription)},offers.push(dataToPush);return offers}function getGARImagePathForOfferModal(longDes){var longDescription=longDes;return toggleService.model.toggles.enableGar&&_.includes(longDes,"/content/dam")&&(longDescription=longDes.replace("/content/dam",globalAssetRepositoryConstants.url+"/content/dam")),longDescription}function getRecommendations(){var listPrice={amount:"",currency:"",display:""},purchasePrice={amount:"",currency:"",display:""},components=[],compDataToPush={name:"",listPrice:listPrice,purchasePrice:purchasePrice,frequency:""};components.push(compDataToPush);var monthlyAmount={amount:"",currency:"",display:"",taxInclusive:!1},payNowAmount={amount:"",currency:"",display:"",taxInclusive:!1},arrPricing=[],pricingDataToPush={creditLevel:"",type:"",priceTypeAvailable:"",monthlyAmount:monthlyAmount,payNowAmount:payNowAmount,components:components};arrPricing.push(pricingDataToPush);var arrAccessories=[],arrDevices=[],AccDataToPush={listPrice:"",purchasePrice:"",description:"",productType:"",skuName:"",sku:"",pricing:arrPricing,availability:""};arrAccessories.push(AccDataToPush);var recommendations={accessories:arrAccessories,devices:arrDevices};return recommendations}function getCreditName(pricingOptionName){var creditName="";return _.isEmpty(pricingOptionName)||(creditName=apiURLs[pricingOptionName]),creditName}function getPriceTypeAvailable(pricingOption,priceType){var priceTypeAvailable=!1;if(0==priceType){var frpPrice=_.get(pricingOption.skuPrice,"priceSummary.payNowPrice.listPrice.amount",0);frpPrice>0&&(priceTypeAvailable=!0)}if(1==priceType){var eipPrice=_.get(pricingOption.skuPrice,"priceSummary.monthlyPrice.salePrice.amount",0);eipPrice>0&&(priceTypeAvailable=!0)}return priceTypeAvailable}function getPayNowAmount(pricingOptionName,priceType,payNowPrice){var payNowAmount;return payNowAmount=_.isEmpty(pricingOptionName)||"NONE"!=apiURLs[pricingOptionName]||1!=priceType?{amount:_.get(payNowPrice,"salePrice.amount",0),currency:_.get(payNowPrice,"salePrice.currency","USD"),display:_.get(payNowPrice,"salePrice.display","0.00"),taxInclusive:!1,contractTerm:_.get(payNowPrice,"salePrice.contractTerm","")}:{currency:_.get(payNowPrice,"listPrice.currency","USD"),taxInclusive:!1,contractTerm:_.get(payNowPrice,"listPrice.contractTerm","")}}function getMonthlyAmount(pricingOptionName,priceType,monthlyPrice){var monthlyAmount;return monthlyAmount=0==priceType?{amount:0,currency:"USD",display:"0.00",taxInclusive:!1,contractTerm:""}:_.isEmpty(pricingOptionName)||"NONE"!=apiURLs[pricingOptionName]||1!=priceType?{amount:_.get(monthlyPrice,"salePrice.amount",0),currency:_.get(monthlyPrice,"salePrice.currency","USD"),display:_.get(monthlyPrice,"salePrice.display","0.00"),taxInclusive:!1,contractTerm:_.get(monthlyPrice,"salePrice.contractTerm","")}:{amount:0,currency:"USD",taxInclusive:!1,contractTerm:""}}function getPricingComponent(priceType,payNowPrice,monthlyPrice){var components;if(0==priceType)var components=[{name:"FRP",listPrice:{amount:_.get(payNowPrice,"listPrice.amount",0),currency:_.get(payNowPrice,"listPrice.currency","USD"),display:_.get(payNowPrice,"listPrice.display","0.00"),contractTerm:_.get(payNowPrice,"listPrice.contractTerm","")},purchasePrice:{amount:_.get(payNowPrice,"salePrice.amount",0),currency:_.get(payNowPrice,"salePrice.currency","USD"),display:_.get(payNowPrice,"salePrice.display","0.00"),contractTerm:_.get(payNowPrice,"salePrice.contractTerm","")},frequency:"onetime"}];else components=[{name:"pay-now",listPrice:{amount:_.get(payNowPrice,"listPrice.amount",0),currency:_.get(payNowPrice,"listPrice.currency","USD"),display:_.get(payNowPrice,"listPrice.display","0.00"),contractTerm:_.get(payNowPrice,"listPrice.contractTerm","")},purchasePrice:{amount:_.get(payNowPrice,"salePrice.amount",0),currency:_.get(payNowPrice,"salePrice.currency","USD"),display:_.get(payNowPrice,"salePrice.display","0.00"),contractTerm:_.get(payNowPrice,"salePrice.contractTerm","")},frequency:"onetime"},{name:"pay-monthly",listPrice:{amount:_.get(monthlyPrice,"listPrice.amount",0),currency:_.get(monthlyPrice,"listPrice.currency","USD"),display:_.get(monthlyPrice,"listPrice.display","0.00"),contractTerm:_.get(monthlyPrice,"listPrice.contractTerm","")},purchasePrice:{amount:_.get(monthlyPrice,"salePrice.amount",0),currency:_.get(monthlyPrice,"salePrice.currency","USD"),display:_.get(monthlyPrice,"salePrice.display","0.00"),contractTerm:_.get(monthlyPrice,"salePrice.contractTerm","")},frequency:"monthly"}];return components}function getPricingData(skuPrices){var arrPricing=[];return _.isEmpty(skuPrices)||angular.forEach(skuPrices,function(pricingOption){if(!_.isEmpty(pricingOption))for(var i=0;2>i;i++){var pricingDataToPush={creditLevel:getCreditName(pricingOption.pricingOptionName),type:0==i?"FRP":"EIP",priceTypeAvailable:getPriceTypeAvailable(pricingOption,i),monthlyAmount:getMonthlyAmount(pricingOption.pricingOptionName,i,_.get(pricingOption,"skuPrice.priceSummary.monthlyPrice")),payNowAmount:getPayNowAmount(pricingOption.pricingOptionName,i,_.get(pricingOption,"skuPrice.priceSummary.payNowPrice")),components:getPricingComponent(i,_.get(pricingOption,"skuPrice.priceSummary.payNowPrice"),_.get(pricingOption,"skuPrice.priceSummary.monthlyPrice"))};arrPricing.push(pricingDataToPush)}}),arrPricing}function getGARImagePath(imgPath){var imagePath=imgPath;return toggleService.model.toggles.enableGar&&_.includes(imgPath,"/content/dam")&&(imagePath=globalAssetRepositoryConstants.url+imgPath),imagePath}function getImage(image,findImage){var imagePath="";if(angular.isDefined(image)&&""!==image&&findImage){var imageProduct=_.find(image,{imgtype:findImage});return imagePath=angular.isDefined(imageProduct&&imageProduct.url)?getGARImagePath(imageProduct.url):""}return imagePath}function getInTheBox(productBoxContent){var boxSpec={};return angular.isDefined(productBoxContent)&&""!==productBoxContent?boxSpec={label:"In The Box",value:angular.isDefined(productBoxContent&&productBoxContent[0].name)?_.map(productBoxContent,"name"):[]}:boxSpec}function getFullPrice(skuPrices){var fullPrice="0.00";return _.isEmpty(skuPrices)||angular.forEach(skuPrices,function(pricingOption){"FRP"==pricingOption.pricingOptionName&&(fullPrice=_.get(pricingOption.skuPrice,"priceSummary.payNowPrice.listPrice.display","0.00"))}),fullPrice}function getPurchasePrice(skuPrices){var purchasePrice="0.00";return _.isEmpty(skuPrices)||angular.forEach(skuPrices,function(pricingOption){"FRP"==pricingOption.pricingOptionName&&(purchasePrice=_.get(pricingOption.skuPrice,"priceSummary.payNowPrice.salePrice.display","0.00"))}),purchasePrice}function getUpFrontPrice(skuPrices){var upFrontPrice="0.00";return _.isEmpty(skuPrices)||angular.forEach(skuPrices,function(pricingOption){"FRP"==pricingOption.pricingOptionName&&(upFrontPrice=_.get(pricingOption.skuPrice,"priceSummary.payNowPrice.salePrice.display","0.00"))}),upFrontPrice}function getItemEipPriceAvailable(skuPrices){var itemEipPriceAvailable=!1;return _.isEmpty(skuPrices)||angular.forEach(skuPrices,function(pricingOption){var eipPrice=_.get(pricingOption.skuPrice,"priceSummary.monthlyPrice.listPrice.amount",0);"BUILDING"===apiURLs[pricingOption.pricingOptionName]&&eipPrice>0&&(itemEipPriceAvailable=!0)}),itemEipPriceAvailable}function getSSKData(sskrequired){return!(!_.isEmpty(sskrequired)&&("n"===sskrequired.toLowerCase()||"no"===sskrequired.toLowerCase()))}function getInvStatus(availability){return availability.availabilityStatus}function getAvailableFromDate(availability){return availability.estimatedShippingFromDateTime}function getAvailableToDate(availability){return availability.estimatedShippingToDateTime}function getIsPreOrderAvailable(availability){return availability.preorderCapable}function getPreOrderAvailableFromDate(availability){return availability.preorderEnabledDateTime}function getPreOrderAvailableToDate(availability){return availability.preorderDisabledDateTime}function getTransformedV2APIResponse(servicesResponseV2API,isV2API){if(angular.isDefined(isV2API)&&isV2API===!1)return servicesResponseV2API;var productdetails=[];if(!_.isEmpty(servicesResponseV2API.data)&&!_.isEmpty(servicesResponseV2API.data.products[0].skus))for(var i=0;i<servicesResponseV2API.data.products[0].skus.length;i++){var dataToPush={SKU:servicesResponseV2API.data.products[0].skus[i].skuCode,Color:servicesResponseV2API.data.products[0].skus[i].color,itemEipPriceAvailable:getItemEipPriceAvailable(servicesResponseV2API.data.products[0].skus[i].skuPrices),Family:servicesResponseV2API.data.products[0].familyName,FullPrice:"$"+getFullPrice(servicesResponseV2API.data.products[0].skus[i].skuPrices),PurchasePrice:"$"+getPurchasePrice(servicesResponseV2API.data.products[0].skus[i].skuPrices),UpFront:"$"+getUpFrontPrice(servicesResponseV2API.data.products[0].skus[i].skuPrices),SSKRequired:getSSKData(servicesResponseV2API.data.products[0].SSKRequired),ProductBoxSpec:getInTheBox(servicesResponseV2API.data.products[0].boxContents),pricing:getPricingData(servicesResponseV2API.data.products[0].skus[i].skuPrices),Specifications:getSpecData(servicesResponseV2API.data.products[0].skus[i].specifications),
BadgesAndPromotions:servicesResponseV2API.data.products[0].skus[i].badgesAndPromotions,ColorSwatch:getColorSwatch(servicesResponseV2API.data.products[0].colorOptions,servicesResponseV2API.data.products[0].skus[i].color),DeviceId:servicesResponseV2API.data.products[0].skus[i].id,BackImage:getImage(servicesResponseV2API.data.products[0].skus[i].images,"BackImage"),FrontImage:getImage(servicesResponseV2API.data.products[0].skus[i].images,"FrontImage"),LeftImage:getImage(servicesResponseV2API.data.products[0].skus[i].images,"LeftImage"),RightImage:getImage(servicesResponseV2API.data.products[0].skus[i].images,"RightImage"),SpecImage:getImage(servicesResponseV2API.data.products[0].skus[i].images,"SpecImage"),ThumbNail:getImage(servicesResponseV2API.data.products[0].skus[i].images,"ThumbNail"),Memory:_.isEmpty(servicesResponseV2API.data.products[0].skus[i].memory)?"":servicesResponseV2API.data.products[0].skus[i].memory.split(" ")[0],MemoryUOM:_.isEmpty(servicesResponseV2API.data.products[0].skus[i].memory)?"":servicesResponseV2API.data.products[0].skus[i].memory.split(" ")[1],Description:servicesResponseV2API.data.products[0].longDescription,Features:getFeatures(servicesResponseV2API.data.products[0].features),Manufacturer:servicesResponseV2API.data.products[0].manufacturer,ProductSubType:servicesResponseV2API.data.products[0].subType,ProductType:servicesResponseV2API.data.products[0].type,ReviewCount:servicesResponseV2API.data.products[0].skus[i].reviewCount,AverageStarRating:servicesResponseV2API.data.products[0].averageStarRating,ReviewStarImagePath:servicesResponseV2API.data.products[0].skus[i].reviewStarImagePath,Bvsku:servicesResponseV2API.data.products[0].ratingSku,offers:getOffers(servicesResponseV2API.data.products[0].skus[i].skuPrices),recommendations:getRecommendations(),InvStatus:getInvStatus(servicesResponseV2API.data.products[0].skus[i].availability),AvailableFromDate:getAvailableFromDate(servicesResponseV2API.data.products[0].skus[i].availability),AvailableToDate:getAvailableToDate(servicesResponseV2API.data.products[0].skus[i].availability),IsPreOrderAvailable:getIsPreOrderAvailable(servicesResponseV2API.data.products[0].skus[i].availability),PreOrderAvailableFromDate:getPreOrderAvailableFromDate(servicesResponseV2API.data.products[0].skus[i].availability),PreOrderAvailableToDate:getPreOrderAvailableToDate(servicesResponseV2API.data.products[0].skus[i].availability)};productdetails.push(dataToPush)}var detailObj={data:{productdetails:productdetails}};return detailObj}var service=this;return service.getTransformedV2APIResponse=getTransformedV2APIResponse,service}responseTransformationServicePDPFn.$inject=["jsonPath","$log","apiURLs","toggleService","globalAssetRepositoryConstants"],angular.module("tmobileApp").service("pdpResponseTransformationServicePDPV2",responseTransformationServicePDPFn)}(angular),function(angular,lodash){"use strict";function deviceConfirmationController(checkOutModelService,toggleService,globalValue,checkOutControllerHelperUtil){function showScheduleMsg(){vm.model.scheduleCallBackMsg=lodash.get(globalValue.authorValue,"checkout.scheduleCallback.scheduleCallbackConfirmationButtonMessage","")}var vm=this;vm.model={confirmationString:checkOutModelService.model.confirmationString,scheduleCallback:checkOutModelService.model.scheduleCallback,federalHoliday:checkOutModelService.model.federalHoliday,orderNumber:checkOutModelService.model.checkOutInfo.order.orderNumber,firstName:checkOutModelService.model.checkOutInfo.personalInfo.firstName},vm.showScheduleMsg=showScheduleMsg,vm.toggles=toggleService.model.toggles,lodash.get(vm.toggles,"blueCoreEmail",!1)&&(vm.blueCoreEmailUrl=checkOutControllerHelperUtil.blueCoreEmailUrl())}deviceConfirmationController.$inject=["checkOutModelService","toggleService","globalValue","checkOutControllerHelperUtil"],angular.module("tmobileApp").controller("DeviceConfirmationController",deviceConfirmationController)}(window.angular,window._),function(angular,_){"use strict";function slickSliderDirectiveConstructor($timeout,$compile,$log){return{restrict:"EA",scope:!0,link:function(scope,element,attrs){function renderCarousel(){if(scope.sliderData=[],scope.selectedProductAccessories=[],attrs.slickConfig&&(scope.slickConfig=angular.fromJson(attrs.slickConfig)),attrs.slidesAtBreakpoints&&scope.slickConfig&&(scope.slidesAtBreakpoints=angular.fromJson(attrs.slidesAtBreakpoints),scope.slickConfig.slidesToShow=scope.slickConfig.slidesToScroll=_.find(scope.slidesAtBreakpoints,{device:"lg"}).slidesToShow,scope.slickConfig.responsive[0].settings.slidesToShow=scope.slickConfig.responsive[0].slidesToScroll=_.find(scope.slidesAtBreakpoints,{device:"md"}).slidesToShow,scope.slickConfig.responsive[1].settings.slidesToShow=scope.slickConfig.responsive[1].slidesToScroll=_.find(scope.slidesAtBreakpoints,{device:"sm"}).slidesToShow,scope.slickConfig.responsive[2].settings.slidesToShow=scope.slickConfig.responsive[2].slidesToScroll=_.find(scope.slidesAtBreakpoints,{device:"xs"}).slidesToShow),""!==attrs.selectedProductAccessories&&angular.isDefined(attrs.selectedProductAccessories)&&(scope.selectedProductAccessories=attrs.selectedProductAccessories.split(",").map(function(item){return parseInt(item,10)})),_.isEmpty(attrs.sliderdata)||(0===scope.selectedProductAccessories.length?scope.sliderData=angular.fromJson(attrs.sliderdata):angular.fromJson(attrs.sliderdata).filter(function(item){-1!==scope.selectedProductAccessories.indexOf(item.id)&&scope.sliderData.push(item)})),""!==attrs.modifieddata&&angular.isDefined(attrs.modifieddata))for(var modifiedData=angular.fromJson(attrs.modifieddata),i=0;i<modifiedData.length;i++)for(var j=0;j<scope.sliderData.length;j++)modifiedData[i].productId===scope.sliderData[j].id&&(scope.sliderData[j].ImageName=modifiedData[i].productName,scope.sliderData[j].ctaLabel=modifiedData[i].ctaLabel)}scope.$last===!0&&($log.log("I am the last"),$timeout(function(){renderCarousel()})),renderCarousel(),scope.slickDataChanged=!0,scope.isSlickSliderUpdate=!0,scope.$on("carouselSliderDataChangeEvent",function(){scope.isSlickSliderUpdate=!1,$timeout(function(){renderCarousel(),scope.isSlickSliderUpdate=!0},1)}),scope.$on("sliderDataChangeEvent",function(){scope.slickDataChanged=scope.productImgDataChange,"true"===attrs.dynamicdatachange&&(renderCarousel(),$timeout(function(){scope.slickDataChanged=!0},0),$timeout(function(){var newelm=element,slickUlLi=element.contents().find("ul.slick-dots li");slickUlLi.each(function(){var liAriaControl=this.getAttribute("aria-controls"),id=this.getAttribute("id");element.contents().find("#"+id).find("button").attr("id",liAriaControl),element.contents().find("#"+id).find("button").removeAttr("aria-required"),element.contents().find("#"+id).attr("role","tab")}),newelm.replaceWith(element),element=newelm},300))}),scope.$on("removeslick",function(){angular.element(element).remove("slick")}),scope.$on("sliderDataChangeEventMiniPDP",function(){angular.element(element).remove("slick");$compile(element.contents())(scope)}),scope.$on("sliderDataChangeEventAccessory",function(){$compile(element.contents())(scope)}),scope.$on("MarqueesliderDataChangeEvent",function(){$compile(element.contents())(scope)}),scope.$on("sliderDataChangeEventBYOD",function(){$compile(element.contents())(scope)})}}}slickSliderDirectiveConstructor.$inject=["$timeout","$compile","$log"],angular.module("tmobileApp").directive("slickSlider",slickSliderDirectiveConstructor)}(angular,_),function(angular,lodash){"use strict";function creditCheckController(checkOutModelService,paymentAndCreditCheckUtil,checkOutControllerHelperUtil,checkOutValidationUtil,modalDialogFactory,CHECKOUT_STATE_NAME){var vm=this;vm.CHECKOUT_STATE_NAME=CHECKOUT_STATE_NAME,vm.sourceType===vm.CHECKOUT_STATE_NAME?(vm.icons=vm.authorValue.checkout.icons,vm.authorValue=vm.authorValue.checkout.paymentAndCreditCheck,vm.conditionalAuthorValue=checkOutControllerHelperUtil.setConditionalAuthorData(vm.authorValue)):vm.conditionalAuthorValue=vm.authorValue,lodash.forEach(vm.authorValue.idTypes,function(value,key){vm.authorValue.idTypes[key]=angular.fromJson(value)}),vm.checkOutInfo=checkOutModelService.model.checkOutInfo,vm.checkoutInitData=vm.sourceType===vm.CHECKOUT_STATE_NAME?checkOutModelService.model.checkoutInitData:{creditCheckIdTypes:vm.authorValue.idTypes},vm.validateSsnOnChange=checkOutValidationUtil.validateSsnOnChange,vm.validateExpOnChange=checkOutValidationUtil.validateExpireDateOnChange,vm.validateSecurityPinOnChange=checkOutValidationUtil.validateSecurityPinOnChange,vm.stateChanged=paymentAndCreditCheckUtil.stateChanged,vm.openSsnLearnMoreModal=modalDialogFactory.openSsnLearnMoreModal}creditCheckController.$inject=["checkOutModelService","paymentAndCreditCheckUtil","checkOutControllerHelperUtil","checkOutValidationUtil","modalDialogFactory","CHECKOUT_STATE_NAME"],angular.module("tmobileApp").controller("CreditCheckController",creditCheckController)}(window.angular,window._),function(angular){"use strict";function tabsDirectiveConstructor(){return{restrict:"EA",controller:["$scope",function(scope){scope.changeTab=function(tab){scope.clicked=tab.navdestination}}],link:function(scope,element,attrs){scope.clicked=attrs.init,scope.tabArray=angular.fromJson(attrs.tabArray),scope.clicked=scope.tabArray[0].navdestination}}}angular.module("tmobileApp").directive("tabs",tabsDirectiveConstructor)}(angular),function(angular){"use strict";function addressFieldsController($scope,checkOutConstants,shippingUtil,checkOutModelService){function showHideAddressSection(){angular.isDefined(vm.addressType)&&shippingUtil.showHideBilling(vm.addressForm,vm.addressType.type)}var vm=this;$scope.$watch("vm.formData",function(){vm.addressType&&angular.equals(vm.addressType.type,"ship")&&checkOutModelService.initShipInfoDisclaimer()},!0),vm.showHideAddressSection=showHideAddressSection,vm.controlsInitData={states:checkOutConstants.states}}addressFieldsController.$inject=["$scope","checkOutConstants","shippingUtil","checkOutModelService"],angular.module("tmobileApp").controller("AddressFieldsController",addressFieldsController)}(window.angular),function(angular,_){"use strict";function factoryConstructor($q,browseStateService,detailStateService){function getLoadedRouteStatistics(){var browseStates=browseStateService.getAuthoredStates(),detailStates=detailStateService.getAuthoredStates();return{authoredBrowseStates:_.reduce(browseStates,function(sum,category){return sum+(_.isEmpty(category)?0:1)},0),authoredDetailStates:_.reduce(detailStates,function(sum,category){return sum+category.length},0),loadedStates:{browse:browseStates,detail:detailStates}}}function verifyRoutesLoaded(){return deferred.promise}function processAuthoredStates(authoredStates){var unUsedStates=[];return angular.forEach(authoredStates,function(config){if(angular.isUndefined(config.serviceworker)){var parsedUrl=browseStateService.parseUrl(config.url);detailStateService.addSubState(config,parsedUrl)||browseStateService.addSubState(config,parsedUrl)||unUsedStates.push(config)}}),deferred.resolve(),unUsedStates}var deferred=$q.defer();return{getLoadedRouteStatistics:getLoadedRouteStatistics,processAuthoredStates:processAuthoredStates,verifyRoutesLoaded:verifyRoutesLoaded}}factoryConstructor.$inject=["$q","browseStateService","detailStateService"],angular.module("tmobileApp").factory("productStateManager",factoryConstructor)}(angular,_),function(angular){"use strict";angular.module("tmobileApp").constant("checkOutConstants",{YES:"yes",NO:"NO",DONESTATUS:"done",FAILEDSTATUS:"failed",SUCCESSSTATUS:"success",CREATEDSTATUS:"Created",OKSTATUS:"OK",APPLICATION_STATUS_COMPLETE:"COMPLETE",APPLICATION_STATUS_REVIEW:"REVIEW",APPLICATION_STATUS_INPROGRESS:"InProgress",states:["AL","AK","AZ","AR","CA","CO","CT","DE","DC","FL","GA","HI","ID","IL","IN","IA","KS","KY","LA","ME","MD","MA","MI","MN","MS","MO","MT","NE","NV","NH","NJ","NM","NY","NC","ND","OH","OK","OR","PA","RI","SC","SD","TN","TX","UT","VT","VA","WA","WV","WI","WY"],TWO_DAY_SHIPPING:"UPS Express - 2 to 3 business days",NEXT_DAY_SHIPPING:"UPS Expedited Next Day - Up to 2 business days",GROUND_SHIPPING:"UPS Ground - Up to 7 business days",STANDARD_SHIPPING:"Standard",SHIPPING_OVERNIGHT:"Overnight",SATURDAY_SHIPPING:"Saturday delivery",CREDIT_CHECK_TYPE:"HARDCREDITCHECK",DECISION_CRITERIA:"CREDIT_CLASS_BASED",INVALID_ADDRESS:"Invalid_Address",RECOMMENDED_SERVICE_GROUP:"Handset Protection and Upgrade",RECOMMENDED_CATEGORY:"Bundles",HTTP_CODES:{STATUS_SUCCESS:200,STATUS_UPDATE:204,STATUS_ERROR:400,STATUS_SUCCESS_201:201,STATUS_REJECT:404,STATUS_ERROR_500:500,STATUS_TIMEDOUT:504},SECTIONS:{INFOANDSHIPPING:"infoAndShipping",PAYMENTANDCREDIT:"paymentAndCredit",REVIEW:"review",CONFIRMATION:"confirmation",VERIFY_CREDIT:"verifyCredit"},TRADEINTYPES:{STANDARD:"STANDARD",DOLLARZEROPROMO:"DOLLARZEROPROMO",MIXED:"MIXED"},CACHE:{NAME:"localStorage",DATA_KEY:"checkout PersonalInfo Shipping Billing and E911 Data",PERSONAL_INFO_KEY:"PersonalInfoV3"},TMOPRESCREEN:"tmoPrescreen",TMOHARDCC:"tmoHardCC",TRUE:"true",ADDRESS_TYPE:{SHIPPING:"SHIPPING",BILLING:"BILLING",E911:"E911"},COUNTRY:"US",PROFILE_ADDRESS_LIST:"profileAddressIdList",PAYMENT_METHOD:"CREDIT",GET_PUBLIC_KEY_PAYMENT:"getPublicKeyForPayment",POSTPAYMENT:"postPaymentUrl",SHIPPING_OPTIONS_V1:{OVERNIGHT:"OVERNIGHT_SHIPPING"},SHIPPING_OPTIONS_V3:{GROUND:"2Day_Shipping",STANDARD:"STANDARD_SHIPPING",OVERNIGHT:"OVERNIGHT_SHIPPING"},SHIPPING_OPTIONS_V4:{GROUND:"2Day",STANDARD:"10",OVERNIGHT:"OVERNIGHT"},PAYMENT_TEXT:"PAYMENT",POSTMETHOD:"POST",BILLING_TYPE:"POSTPAID",SETTLEMENT_INDICATOR:"false",STOREPAYMENT:"false",ISAUTHREQUIRED:"true",ISFULLAUTH:"true",CUSTOMER_PRESENT_INDICATOR:"false",RedirectionStatusKey:2,SUBMIT_ORDER_URL:"submitOrderUrl",BillingAddressId:"billingAddressId",GET_PUBLIC_KEY_VERIFY_IDENTITY:"getPublicKeyForVerifyIdentity",GET_PUBLIC_KEY_CREDIT_CHECK:"getPublicKeyForCreditCheck",VERIFY_ID:{SSN:"ssn",ID_NUMBER:"idNumber",EXPIRY_DATE:"expiryDate",IDENTITY_DOCUMENT_ID:"idType.idTypeName",STATE:"state",DOB:"dob",FIRSTNAME:"firstName",MIDDLENAME:"middleName",LASTNAME:"lastName",CITY:"city",ZIP:"zip",ADDRESS1:"address1",ADDRESS2:"address2",PHONENUMBER:"phoneNumber",EMAIL:"email",IDTYPE:"idType"},EXPIRATION_DATE_DAY:"-01-20",ECRYPTION_ERROR:"Error when encrypting data",SUCCESS_STATUS_CODES:[200,201,202,204],AUDIT_RECORD_KEY:{AUTO_PAY:"AUTO_PAY",STORE_PAYMENT:"STORE_PAYMENT",KEY_LANGUAGE_PREFERENCE:"KEY_LANGUAGE_PREFERENCE",FB_ID:"FB_ID",PS_ID:"PS_ID",LEGAL_AGREEMENT_NOTES:"LEGAL_AGREEMENT_NOTES",LEGAL_AGREEMENT_TIMESTAMP:"LEGAL_AGREEMENT_TIMESTAMP",DEALER_CODE:"DEALER_CODE",APPLICATIONID:"applicationid",CHANNELID:"channelid",CLIENTID:"clientid"},AUDIT_RECORD_AUDITVALUE:{TMO:"TMO",WEB:"WEB",TMNG:"TMNG",DEALER_CODE:"1292933"},AUTO_PAY_TOGGLE:"isAutoPay",PRIMARY:"primary",SSN_TYPE:"ssn4",FRAUD_QUESTION_RESPONSE:{PENDING:"pending",PASSED:"passed",ERROR:"error",FAILED:"failed"},SPRINT:"SPRINT",TMOMODALNAME:"Existing Customer",SPRINTMODALNAME:"Existing Customer - Sprint"}).constant("creditCardTypes",{creditTypes:{VS:"Visa",MC:"MasterCard",AM:"American Express",DS:"Discover Card",CU:"China UnionPay",VE:"Visa-Electron"}}).constant("cardTypeCodes",{typeCodes:{VISA:"VISA",MASTERCARD:"MASTERCARD",AMERICANEXPRESS:"AMERICAN EXPRESS",DISCOVER:"DISCOVER CARD"}}).constant("holidaysConstants",{federalHoliday:[{federalHoliday:"01-01"},{federalHoliday:"01-18"},{federalHoliday:"02-15"},{federalHoliday:"05-30"},{federalHoliday:"07-04"},{federalHoliday:"09-05"},{federalHoliday:"10-10"},{federalHoliday:"11-11"},{federalHoliday:"11-24"},{federalHoliday:"12-25"}],optFederalHoliday:[{optFederalHoliday:"06-20-2017",optFederalState:"AK"},{optFederalHoliday:"10-28-2016",optFederalState:"CA"}],callCenterHolidays:[{weekOffDay:"Saturday",weekOffState:"AL"},{weekOffDay:"Sunday",weekOffState:"WA"}],onHoursTime:"07:30",offHoursTime:"20:00"}).constant("creditClassConstant",{creditClasses:{GOOD:"GOOD",BUILDING:"BUILDING",NONE:"NONE",PAYNOWPRICE:"paynowPrice.display",MONTHLYPRICE:"monthlyPrice.display",MONTHLYPRICEAMOUNT:"monthlyPrice.amount",CREDITLEVEL:"creditLevel"}})}(window.angular),function(angular){"use strict";function productPromotionControllerConstructor($log,$compile,$window){$log.log("Product Promotion Controller is initializing "),$window.compileAuthoredHtml=function(elementId,injectedHtml,scope){$("#"+elementId).html($compile(injectedHtml)(scope))}}productPromotionControllerConstructor.$inject=["$log","$compile","$window"],angular.module("tmobileApp").controller("ProductPromotionController",productPromotionControllerConstructor)}(angular),function(angular,lodash,uuid){"use strict";function saveCartControllerFunction($modalInstance,cartCommonOperationsService,tmobNotificationService,globalValue,cartHttpDataService,toggleService,pdlService,cartConstants,salesForceUtil,commonServices,storeLocatorModelService){function cancel(){$modalInstance.dismiss()}function close(){var firstName=angular.isUndefined(vm.inputData.firstName)?"":vm.inputData.firstName;$modalInstance.close({name:firstName,toggle:vm.toggles.saveCart,saveCartOption:vm.saveCartOption})}function submitSaveCart(){var inputData;inputData=vm.toggles.saveCart?{email:vm.inputData.email.toLowerCase(),transactionId:transactionId}:{email:vm.saveCartEmail.toLowerCase(),transactionId:transactionId},cartHttpDataService.findCart(inputData).then(function(responseData){vm.toggles.d2rWebSaveCart?pdlService.setSaveCartEvent({eventDescription:{ctaName:vm.keyValues.save.saveCartCtaText,modalName:"Save Cart",userSelection:cartConstants.MARKET_CONSENT+":"+vm.agreeTerm,transId:transactionId}}):pdlService.setSaveCartEvent({eventDescription:{ctaName:vm.keyValues.save.saveCartCtaText,modalName:"Save Cart",assetType:"button",transId:transactionId}}),angular.equals(responseData.status,201)?cartCommonOperationsService.saveCartURL().then(function(){if(vm.toggles.saveCart)close();else if(cancel(),vm.toggles.cartCISFlag){var commonResolveData=[{key:"orderInStoreData",value:vm.inputData}];vm.toggles.salesForceWebCartToRetail&&(inputData.cartType=cartConstants.SF_CART_TYPE.SAVE_WEB_CART,salesForceUtil.createAndSaveRetailCart(inputData).then(function(success){$log.info("Data Sent to SalesForce")})["catch"](function(error){vm.saveCartError=!0,$log.error("Failed to sent SalesForce")})),cartCommonOperationsService.saveCartWebConfirmationModal(commonResolveData,!0)}else tmobNotificationService.showNotification(["cart019"])}):angular.equals(responseData.status,200)?vm.overrideSaveCart=!0:vm.saveCartError=!0})["catch"](function(error){vm.saveCartError=!0,$log.error("Failed to sent DCP")})}function submitOverrideCart(){var inputData;inputData=vm.toggles.saveCart?{email:vm.inputData.email.toLowerCase(),transactionId:transactionId}:{email:vm.saveCartEmail.toLowerCase(),transactionId:transactionId},cartHttpDataService.saveCart(inputData).then(function(responseData){angular.equals(responseData.status,201)?cartCommonOperationsService.saveCartURL().then(function(){if(pdlService.setSaveCartEvent({eventDescription:{ctaName:vm.keyValues.override.ctaLabel,modalName:"Cart Override",assetType:"button",transId:transactionId}}),vm.toggles.saveCart)close();else{cancel();var commonResolveData=[{key:"orderInStoreData",value:vm.inputData}];vm.toggles.salesForceWebCartToRetail&&(inputData.cartType=cartConstants.SF_CART_TYPE.SAVE_WEB_CART,salesForceUtil.createAndSaveRetailCart(inputData).then(function(success){$log.info("Data Sent to SalesForce")})["catch"](function(error){vm.saveCartError=!0,$log.error("Data not sent to SalesForce")})),cartCommonOperationsService.saveCartWebConfirmationModal(commonResolveData,!0)}}):vm.saveCartError=!0})["catch"](function(error){vm.saveCartError=!0,$log.error("Failed to sent DCP")})}function selectedOption(option){vm.saveCartOption=option===vm.keyValues.save.saveCartTitle?"saveLater":"saveFinal",vm.selectedValue=option}var vm=this,$log=commonServices.$log,transactionId=uuid.create().toString(),storeModel=storeLocatorModelService.model;vm.close=close,vm.cancel=cancel,vm.submitSaveCart=submitSaveCart,vm.submitOverrideCart=submitOverrideCart,vm.selectedOption=selectedOption,vm.productAnalyticsData=storeModel.productAnalyticsData,vm.emailRegex=/^\s*[\w\-\+_]+(\.[\w\-\+_]+)*\@[\w\-\+_]+\.[\w\-\+_]+(\.[\w\-\+_]+)*\s*$/,vm.overrideSaveCart=!1,vm.saveCartError=!1,vm.keyValues=globalValue.authorValue.rootPage.saveCartModal,vm.selectedValue="",vm.saveCart=vm.keyValues.save.saveCartTitle,vm.finalCart=vm.keyValues.save.finalizeCartTitle,vm.toggles=toggleService.model.toggles,vm.saveCartOption="",vm.agreeTerm=!1}saveCartControllerFunction.$inject=["$modalInstance","cartCommonOperationsService","tmobNotificationService","globalValue","cartHttpDataService","toggleService","pdlService","cartConstants","salesForceUtil","commonServices","storeLocatorModelService"],angular.module("tmobileApp").controller("saveCartController",saveCartControllerFunction)}(window.angular,window._,window.UUIDjs),function(angular){"use strict";var aemSitemap={templateUrl:"app/sitemap/components/aemSitemap/aemSitemap.tpl.html",controller:"aemSitemapController as vm"};angular.module("tmobileApp").component("aemSitemap",aemSitemap)}(window.angular),function(angular){"use strict";function responseTransformationServiceFn(responseTransformationServiceV1,responseTransformationServiceV2,responseTransformationServiceV3){function getFactory(apiKey){return apiKey?3===apiKey?responseTransformationServiceV3:2===apiKey?responseTransformationServiceV2:responseTransformationServiceV1:responseTransformationServiceV1}return{getFactory:getFactory}}responseTransformationServiceFn.$inject=["responseTransformationServiceV1","responseTransformationServiceV2","responseTransformationServiceV3"],angular.module("tmobileApp").service("responseTransformationService",responseTransformationServiceFn)}(angular),function(angular){"use strict";function aemSitemapControllerConstructor(sitemapModelService,sitemapUtil){function init(){vm.model.sitemapType="aemSitemap",sitemapUtil.createServletUrl("aem-pages"),sitemapModelService.getData()}var vm=this;vm.oneAtATime=!1,vm.model=sitemapModelService.model,init(),vm.openSitemapModal=sitemapModelService.openSitemapModal}aemSitemapControllerConstructor.$inject=["sitemapModelService","sitemapUtil"],angular.module("tmobileApp").controller("aemSitemapController",aemSitemapControllerConstructor)}(window.angular),function(angular){"use strict";var preconfiguredcartModalcomponentConstructor={templateUrl:"app/cart/preConfiguredCartModal/preConfiguredCartModal.html",controller:"preConfiguredCartModalController",controllerAs:"vm",bindings:{preConfiguredCartId:"@",preConfiguredCartIdNonNy:"@",preConfiguredCartImageUrl:"@",currentPath:"@"}};angular.module("tmobileApp").component("preConfiguredCartModal",preconfiguredcartModalcomponentConstructor)}(angular),function(angular){"use strict";var filtersSitemap={templateUrl:"app/sitemap/components/filtersSitemap/filtersSitemap.tpl.html",controller:"filtersSitemapController as vm"};angular.module("tmobileApp").component("filtersSitemap",filtersSitemap)}(window.angular),function(angular,lodash){"use strict";function saveWebConfirmationModalControllerFunction($modalInstance,$state,globalValue,orderInStoreData,cartStorage,cartConstants,inventoryUtils,$modal,pdlService,D2RModelManager,pdlConstant,digitalToRetailConstant,cartCommonOperationsService,utils,toggleService,storeLocatorModelService,productDetailsService,storeLocatorConstants,storeLocatorUtil,commonServices,inventoryStatusService){function cancel(){$modalInstance.dismiss()}function goToStoreLocator(){$modalInstance.dismiss(),cartCommonOperationsService.model.ispfcart?(cartCommonOperationsService.model.ispfcart=!1,utils.loadScript("//maps.googleapis.com/maps/api/js?libraries=visualization,places&client=gme-tmobileusa3&channel=smartcart&v=3.26",redirectToSL)):redirectToSL()}function openStoreLocatorModal(isAppointment){storeLocatorModelService.setStoreFilterAuthorContentInModel(vm.pageType),storeLocatorModelService.model.pageType="cart",isAppointment?(vm.model.storeLocatorInModal=!0,vm.model.sectionToDisplay=storeLocatorConstants.SECTIONS.APPOINTMENT_FORM):vm.model.sectionToDisplay=storeLocatorConstants.SECTIONS.SEARCH_RESULTS,vm.model.d2rModelManager=d2rModelManager,$modal.open({windowClass:"store-locator-d2r-modal",controller:"storeLocatorModalController",templateUrl:"app/core/components/digitalToRetail/components/storeLocator/storeLocatorModal.tpl.html",controllerAs:"vm"}).result.then(getSelectedStore)}function openAppointmentFlow(){openStoreLocatorModal(!0),storeLocatorModelService.showOperationSection(storeLocatorConstants.PAGES.ISA)}function getSelectedStore(){return lodash.isNil(sessionStorage.getItem("selectedStore"))?getLocation().then(getStores):(vm.selectedStore=sessionStorage.getItem("selectedStore"),vm.selectedStore=angular.isObject(vm.selectedStore)?vm.selectedStore:angular.fromJson(vm.selectedStore),loadInventoryData()),vm.selectedStore}function handleGetInLineOperation(){storeLocatorModelService.setStoreFilterAuthorContentInModel(vm.pageType),storeLocatorModelService.model.store=vm.selectedStore,vm.model.storeLocatorInModal=!0,storeLocatorModelService.showOperationSection(vm.pages.GIL),vm.model.sectionToDisplay=storeLocatorConstants.SECTIONS.GET_IN_LINE,vm.model.d2rModelManager=d2rModelManager,$modal.open({windowClass:"store-locator-d2r-modal",controller:"storeLocatorModalController",templateUrl:"app/core/components/digitalToRetail/components/storeLocator/storeLocatorModal.tpl.html",controllerAs:"vm"}).result.then(getSelectedStore)}function getLocation(){return storeLocatorUtil.getUserLocation().then(function(data){vm.location=data,lodash.isEmpty(data)||(vm.locationflag=!0)},function(){vm.locationflag=!1,vm.product.setInventoryAvailability(digitalToRetailConstant.INVENTORY_STATUS.STORE_UNKNOWN)})}function getStores(){return storeLocatorUtil.getStoreList(vm.location,vm.model.start,vm.model.d2rResultsCount,vm.model.miles,!0).then(function(storeResults){var storeList=d2rModelManager.setStores(storeResults.data);vm.selectedStore=d2rModelManager.getSelectedStore(),vm.selectedStore=angular.isObject(vm.selectedStore)?vm.selectedStore:angular.fromJson(vm.selectedStore),loadInventoryData(),lodash.isEmpty(storeList)&&vm.product.setInventoryAvailability(digitalToRetailConstant.INVENTORY_STATUS.STORE_UNKNOWN)},function(){vm.product.setInventoryAvailability(digitalToRetailConstant.INVENTORY_STATUS.STORE_UNKNOWN)})}function stopLoading(){vm.inventoryDetail.statusValue=vm.product.getInventoryStatusMessage(),vm.productAnalyticsData=Object.assign({},productData,vm.selectedStore,vm.inventoryDetail),storeLocatorModelService.productData=productData,storeLocatorModelService.storeInventoryDetails=Object.assign({},vm.selectedStore,vm.inventoryDetail),vm.isLoading=!1}function errorCatch(){vm.hideContainer=!0,$log.log("error")}function showItemsCTAButton(){lodash.isEqual(vm.showItemsCTAName,cartConstants.SAVE_CART.SHOW_ITEMS)?(vm.showItemsCTAName=cartConstants.SAVE_CART.HIDE_ITEMS,vm.showItemsDiv=!0):(vm.showItemsCTAName=cartConstants.SAVE_CART.SHOW_ITEMS,vm.showItemsDiv=!1)}function redirectToSL(){orderInStoreData.zipCode?$state.go("store-locator",{search:orderInStoreData.zipCode}):$state.go("store-locator")}function loadInventoryData(){inventoryStatusService.loadInventoryData(vm.selectedStore).then(function(){vm.deviceList=inventoryStatusService.deviceList,vm.accessoryList=inventoryStatusService.accessoryList,inventoryStatusService.getInventoryDetails().then(function(){vm.outOfStock=inventoryStatusService.outOfStock,vm.showItemsCTAName=inventoryStatusService.showItemsCTAName}),vm.selectedStore=inventoryStatusService.selectedStore})}function init(){angular.extend(vm,defaults),vm.cartObj.lineItems.length>0?angular.forEach(vm.cartObj.lineItems,function(cartItem){angular.isDefined(cartItem.lineItemDetails.deviceDetails.sku)&&(vm.productAvailable=!0)}):d2rAccessories&&vm.cartObj.accessories.accessoryDetails.length>0&&(vm.productAvailable=!0),lodash.isNil(sessionStorage.getItem("selectedStore"))?getLocation().then(getStores)["catch"](errorCatch)["finally"](stopLoading):(vm.selectedStore=sessionStorage.getItem("selectedStore"),vm.selectedStore=angular.isObject(vm.selectedStore)?vm.selectedStore:angular.fromJson(vm.selectedStore),getLocation(),loadInventoryData())}var vm=this;vm.productAvailable=!1,vm.authorvalue=globalValue.authorValue.rootPage.saveCartModal,vm.toggles=toggleService.model.toggles,vm.pages=storeLocatorConstants.PAGES,vm.openStoreLocatorModal=openStoreLocatorModal,vm.CTANavOrClickEvent=pdlService.CTANavOrClickEvent,vm.cartObj=cartStorage.getGlobalSmartCartInfo(),vm.SKUArray=[],vm.inventoryDetail={};var productData=productDetailsService.model.selectedProduct,$log=commonServices.$log;vm.cancel=cancel,vm.getStores=getStores,vm.getLocation=getLocation,vm.goToStoreLocator=goToStoreLocator,vm.handleGetInLineOperation=handleGetInLineOperation,vm.showItemsCTAButton=showItemsCTAButton,vm.openAppointmentFlow=openAppointmentFlow,vm.stopLoading=stopLoading,vm.errorCatch=errorCatch,vm.getSelectedStore=getSelectedStore,vm.loadInventoryData=loadInventoryData;var cartCISFlag=lodash.get(toggleService.model,"toggles.cartCISFlag",!1);vm.productAnalyticsData=storeLocatorModelService.productAnalyticsData;var digitalToRetailFlag=lodash.get(toggleService.model,"toggles.digitalToRetail",!1),digitalToRetailCartFlag=lodash.get(toggleService.model,"toggles.digitalToRetailCart",!1),d2rWebSaveCartFlag=lodash.get(toggleService.model,"toggles.d2rWebSaveCart",!1),d2rAccessories=lodash.get(toggleService.model,"toggles.d2rAccessories",!1);if(vm.locationflag=!1,cartCISFlag?vm.isSavePage=cartCommonOperationsService.isSavePage:vm.isSavePage=!1,digitalToRetailFlag&&digitalToRetailCartFlag&&d2rWebSaveCartFlag){vm.model=storeLocatorModelService.model,vm.model.storeLocatorInModal=!0,vm.storeauthoring=globalValue.authorValue.storeauthoring,vm.digitalToRetailAuthoring=globalValue.authorValue.storeauthoring.digitalToRetail,vm.store=storeLocatorModelService.model.store,vm.showStoreAppointmentModel=storeLocatorUtil.showStoreAppointmentModel,vm.showOperationSection=storeLocatorModelService.showOperationSection;var d2rModelManager=D2RModelManager.prototype.model(),defaults=Object.freeze({isLoading:!0,selectedSKU:"",product:d2rModelManager.getProduct(),location:{},digitalToRetailAuthoring:globalValue.authorValue.storeauthoring.digitalToRetail,selectedStore:"",hideContainer:storeLocatorModelService.model.hideContainer});init()}}saveWebConfirmationModalControllerFunction.$inject=["$modalInstance","$state","globalValue","orderInStoreData","cartStorage","cartConstants","inventoryUtils","$modal","pdlService","D2RModelManager","pdlConstant","digitalToRetailConstant","cartCommonOperationsService","utils","toggleService","storeLocatorModelService","productDetailsService","storeLocatorConstants","storeLocatorUtil","commonServices","inventoryStatusService"],angular.module("tmobileApp").controller("saveWebConfirmationModalController",saveWebConfirmationModalControllerFunction)}(window.angular,_),function(angular){"use strict";function filtersSitemapControllerConstructor(sitemapModelService,sitemapUtil){function init(){vm.model.sitemapType="filtersSitemap",sitemapUtil.createServletUrl("plp-filters"),sitemapModelService.getData()}var vm=this;vm.model=sitemapModelService.model,vm.panelIndex=0,init()}filtersSitemapControllerConstructor.$inject=["sitemapModelService","sitemapUtil"],angular.module("tmobileApp").controller("filtersSitemapController",filtersSitemapControllerConstructor)}(window.angular),function(angular){"use strict";function MiniPDPDeviceServiceFn(httpRequestWrapper,apiURLs,globalValue){function obtainObject(input,callback){httpRequestWrapper.get(apiURLs.snpMiniBrowse+input.familyId,null,null,!0).then(function(response){for(var bulkProudctData=[],responseUniqueColors=_.uniq(_.map(response.data.productdetails,"Color")),idx=0;idx<responseUniqueColors.length;idx++){var colorFilteredProducts=_.filter(response.data.productdetails,{
Color:responseUniqueColors[idx]});colorFilteredProducts=_.sortBy(colorFilteredProducts,function(d){return parseInt(d.Memory,10)});for(var index=0;index<colorFilteredProducts.length;index++)bulkProudctData.push(colorFilteredProducts[index])}bulkProudctData=_.sortBy(bulkProudctData,function(d){return parseInt(d.Memory,10)});var miniPDPData={bulkProudctData:bulkProudctData};callback&&callback(miniPDPData)})}function getModalContent(url){return httpRequestWrapper.get(url,null,null,!0)}function SSKGetData(){var url=apiURLs.SSKDataUrl+globalValue.authorValue.rootPage.generalAuthoring.simkitofferid;return httpRequestWrapper.get(url,null,null,!0)}return{obtainObject:obtainObject,getModalContent:getModalContent,SSKGetData:SSKGetData}}MiniPDPDeviceServiceFn.$inject=["httpRequestWrapper","apiURLs","globalValue"],angular.module("tmobileApp").service("miniPDPDeviceService",MiniPDPDeviceServiceFn)}(angular),function(angular){"use strict";var sitemapForm={templateUrl:"app/sitemap/components/sitemapForm/sitemapForm.tpl.html",controller:"sitemapFormController as vm",bindings:{key:"<",submitAction:"="}};angular.module("tmobileApp").component("sitemapForm",sitemapForm)}(window.angular),function(angular,lodash){"use strict";function myCartAuthInterceptorFactoryConstructor($rootScope,apiURLs,authTokenManager,commonUtils,$injector){return{request:function(config){if(!config.authRequired)return config;var localtoggleService=$injector.get("toggleService");if(commonUtils.isCommerceV3URL(config.url)||commonUtils.isEOSURL(config.url)){var authToken=authTokenManager.getTokenCookies("jwt_token",angular.equals(apiURLs.storage,"localStorage"));authToken&&(config.headers.Authorization="Bearer "+authToken.access_token,config.headers["x-auth-originator"]=authToken.access_token,config.headers.usn=authToken.usn)}else if(commonUtils.isLexisNexisUrl(config.url)){var fraudCheckModelService=$injector.get("fraudCheckModelService");config.headers.Authorization="PoP "+fraudCheckModelService.token}else{var authToken;authToken=lodash.get(localtoggleService.model,"toggles.isV2Disabled",!1)?authTokenManager.getTokenCookies("jwt_token",angular.equals(apiURLs.storage,"localStorage"))||authTokenManager.getTokenCookies("JSONWebToken",angular.equals(apiURLs.storage,"localStorage")):authTokenManager.getTokenCookies("token",angular.equals(apiURLs.storage,"localStorage")),authToken&&(config.headers.Authorization="Bearer "+authToken.access_token)}return config},responseError:function(resp){return 401===resp.status&&$rootScope.$emit("unauthorized"),resp}}}myCartAuthInterceptorFactoryConstructor.$inject=["$rootScope","apiURLs","authTokenManager","commonUtils","$injector"],angular.module("tmobileApp").factory("authInterceptor",myCartAuthInterceptorFactoryConstructor)}(angular,_),function(angular){"use strict";function sitemapFormControllerConstructor(commonServices,sitemapUtil,sitemapModelService){function submitData(){var data={changeFrequency:vm.changeFrequency,priority:vm.priority,contentPath:vm.nodeName,hideUrlFromSitemap:hideUrlFromSitemap,actionType:actionType};data.loc="add"===actionType?"https://"+vm.loc:vm.loc,sitemapUtil.postSitemapData(data).then(function(){"aemSitemap"===model.sitemapType&&"add"!==actionType?commonServices.$timeout(function(){sitemapModelService.getData()},1e3):sitemapModelService.getData(),vm.submitAction()})}var actionType,hideUrlFromSitemap,vm=this,model=sitemapModelService.model;vm.node=model.selectedNode,vm.key=model.key,vm.frequencyData=["","ALWAYS","DAILY","WEEKLY","MONTHLY","YEARLY","NEVER","HOURLY"],vm.priorityData=["","0.1","0.2","0.3","0.4","0.5","0.6","0.7","0.8","0.9","1.0"],vm.node?(vm.changeFrequency=vm.frequencyData[vm.frequencyData.indexOf(vm.node.changeFrequency)],vm.priority=vm.priorityData[vm.priorityData.indexOf(vm.node.priority)],vm.loc=vm.node.loc,vm.nodeName=vm.node.contentPath,hideUrlFromSitemap=vm.node.hideUrlFromSitemap,actionType="edit"):(vm.changeFrequency=vm.frequencyData[0],vm.priority=vm.priorityData[0],hideUrlFromSitemap=!1,actionType="add"),vm.submitData=submitData}sitemapFormControllerConstructor.$inject=["commonServices","sitemapUtil","sitemapModelService"],angular.module("tmobileApp").controller("sitemapFormController",sitemapFormControllerConstructor)}(window.angular),function(angular,lodash){"use strict";function essentialsServiceCartFn($q,$timeout,apiService,httpRequestWrapper,cartStorage,cartHttpWrapper,cartConstants,dataFactory,globalValue,commonServices,cartHttpDataService,coreServices,toggleService,$injector){function getAuthorPlans(lineItem,authoredPlanData){var deviceDetails=lineItem.lineItemDetails?lineItem.lineItemDetails.deviceDetails:void 0;switch(lineItem.lineType){case cartConstants.DEVICE_TYPE.HANDSET:return authoredPlanData.devicePlans;case cartConstants.DEVICE_TYPE.TABLET:return authoredPlanData.tabletPlans;case cartConstants.DEVICE_TYPE.WEARABLE:return lodash.get(toggleService.model,"toggles.isWearableOsPlanEnabled",!1)&&deviceDetails?fetchWearbleAuthoringData(authoredPlanData,deviceDetails):authoredPlanData.wearablePlans}}function fetchWearbleAuthoringData(authoredPlanData,deviceDetails){return deviceDetails.manufacturer===cartConstants.APPLE_MANUFACTURER?authoredPlanData.appleWearablePlans:authoredPlanData.nonAppleWearablePlans}function getMatchedPlanData(authoredPlans,planType){return lodash.isArray(authoredPlans)?lodash.find(authoredPlans,function(plan){return plan.planType===planType}):authoredPlans}function createRequestObjectForPostPlan(planDetails,lineType,eligiblePlansResponse){var requestObject={offerFamilyId:planDetails.familyOfferId,planType:lineType};if(lineType.toUpperCase()===cartConstants.DEVICE_TYPE.HANDSET){var defaultSocObject={soc:getDefaultSoc(planDetails,eligiblePlansResponse)};requestObject.planOptions=[defaultSocObject]}return requestObject}function getDefaultSoc(planDetails,eligiblePlansResponse){var planToPost=lodash.find(eligiblePlansResponse.eligiblePlans,function(plan){return plan.offerFamilyId===planDetails.familyOfferId}),defaultPlanOption=lodash.find(planToPost.planOptions,function(option){return option["default"]===!0});return defaultPlanOption.soc}function resetServiceOptions(){var cartObj=cartStorage.getGlobalSmartCartInfo();cartObj.lineItems&&cartObj.lineItems.forEach(function(lineItem){cartStorage.setServiceOptions(lineItem.lineId,!1)})}var _self=this,$log=commonServices.$log;return _self.getApiUrl=function(urlToGet){var cartId=cartStorage.getCartId(),urlObject=apiService.getURL(urlToGet);return urlObject.url.replace("{{cartID}}",cartId)},_self.deletePlanfromCart=function(lineType){var url=_self.getApiUrl(cartConstants.ESSENTIALS_CONSTANT.CART_PLANS_URL);return lodash.isUndefined(lineType)||(url=url+"?plan-type="+lineType),cartHttpWrapper["delete"](url,null,"deletePlan","deletePlan",null)},_self.changePlan=function(planType){var changePlanDefer=$q.defer(),cartData=cartStorage.getGlobalSmartCartInfo(),deletePlansDefer=$q.defer();return _self.deletePlanfromCart().then(function(){deletePlansDefer.resolve()}),$q.all(deletePlansDefer).then(function(){cartData.flags.isDeviceInHandset?_self.getEligiblePlansCart(cartConstants.DEVICE_TYPE.HANDSET,!1).then(function(response){_self.postPlansToCart({lineType:cartConstants.DEVICE_TYPE.HANDSET},planType,response).then(function(){_self.updateTabletPlans(cartData.flags,planType)},function(){$log.error("failed while posting handset plan")})},function(){$log.error("failed while getting eligible handset plans")}):_self.updateTabletPlans(cartData.flags,planType)}),_self.updateTabletPlans=function(flags){flags.isDeviceInTablet?_self.postPlansToCart({lineType:cartConstants.DEVICE_TYPE.TABLET},planType).then(function(){_self.updateWearablePlans(flags)},function(){$log.error("failed while posting plan for tablet")}):_self.updateWearablePlans(flags)},_self.updateWearablePlans=function(flags){var count=0,wearableCount=0,wearableArray=[];flags.isDeviceInWearable?lodash.get(toggleService.model,"toggles.isWearableOsPlanEnabled",!1)?(angular.forEach(cartData.lineItems,function(lineItem){lineItem.lineType===cartConstants.DEVICE_TYPE.WEARABLE&&(wearableCount+=1,wearableArray.push(lineItem))}),_self.postWearablePlan(count,wearableCount,wearableArray)):_self.postPlansToCart({lineType:cartConstants.DEVICE_TYPE.WEARABLE},planType).then(function(){_self.getCart()},function(){$log.error("failed while posting plan for wearable")}):_self.getCart()},_self.postWearablePlan=function(count,wearableCount,wearableArray){var lineItem=wearableArray[count];_self.postPlansToCart(lineItem,planType,void 0,!0,lineItem.lineId).then(function(){count+=1,count===wearableCount?_self.getCart():_self.postWearablePlan(count,wearableCount,wearableArray)},function(){$log.error("failed while posting plan for wearable")})},_self.getCart=function(){resetServiceOptions(),cartHttpDataService.getCartV3().then(function(){changePlanDefer.resolve()})},changePlanDefer.promise},_self.getEligiblePlansCart=function(lineType,defaultPlan){var eligiblePlansDeferred=$q.defer(),dfRequest=new dataFactory.DFRequest;if(!lodash.get(toggleService.model,"toggles.isCachingDisabledForPlans",!1)){dfRequest.input={apiKey:cartConstants.ESSENTIALS_CONSTANT.GET_ELIGIBLE_PLANS,planType:lineType};var cacheKey=cartConstants.ESSENTIALS_CONSTANT.CACHE.DATA_KEY+angular.toJson(dfRequest.input),dataCache=dataFactory.getCacheObject(cartConstants.ESSENTIALS_CONSTANT.CACHE.NAME),cachedEligiblePlans=dataCache.get(cacheKey);if(!lodash.isEmpty(cachedEligiblePlans))return $timeout(function(){eligiblePlansDeferred.resolve(cachedEligiblePlans)},0),eligiblePlansDeferred.promise}var defaultPlanValue=defaultPlan||!1,url=_self.getApiUrl(cartConstants.ESSENTIALS_CONSTANT.CART_PLANS_URL);return url=url+"?plan-type="+lineType+"&default-plan="+defaultPlanValue,httpRequestWrapper.get(url,{},void 0,!0,cartConstants.ESSENTIALS_CONSTANT.GET_ELIGIBLE_PLANS).then(function(response){angular.equals(response.status,cartConstants.ESSENTIALS_CONSTANT.SUCCESS_CODE)?(lodash.get(toggleService.model,"toggles.isCachingDisabledForPlans",!1)||dataFactory.setVO(cartConstants.ESSENTIALS_CONSTANT.CACHE.DATA_KEY,dfRequest,response.data),eligiblePlansDeferred.resolve(response.data)):eligiblePlansDeferred.reject({error:cartConstants.ESSENTIALS_CONSTANT.ERROR_TEXT})}),eligiblePlansDeferred.promise},_self.postPlansToCart=function(lineItem,planType,eligiblePlansResponse,isLineLevel,lineId){var header,url=isLineLevel?_self.getApiUrl(cartConstants.ESSENTIALS_CONSTANT.POST_PLAN_TO_LINE):_self.getApiUrl(cartConstants.ESSENTIALS_CONSTANT.CART_PLANS_URL),essentialsPlanData=globalValue.authorValue.cart.essentials,authoredPlans=getAuthorPlans(lineItem,essentialsPlanData),matchedPlan=getMatchedPlanData(authoredPlans,planType)||authoredPlans[0],requestObject=createRequestObjectForPostPlan(matchedPlan,lineItem.lineType,eligiblePlansResponse);return isLineLevel&&(url=url.replace("{{lineID}}",lineId),delete requestObject.planType),httpRequestWrapper.post(url,requestObject,header,null,!0,cartConstants.ESSENTIALS_CONSTANT.POST_PLAN_TO_LINE)},_self.createAuditRecord=function(){var apiUrl=apiService.getURL("createAuditRecordsUrl").url,cartId=coreServices.cartStorage.getCartId();apiUrl=apiUrl.replace("{{cartID}}",cartId);var headers={follow:"true"},inputData={auditRecords:[{auditKey:"AUTO_PAY",auditValue:!0},{auditKey:"STORE_PAYMENT",auditValue:!0}]};return coreServices.httpRequestWrapper.post(apiUrl,inputData,null,headers,!0,"createAuditRecordsUrl")},_self.checkEligibilityAndOpenIneligibleModal=function(lineItem,planType){var essentialsPlanData=globalValue.authorValue.cart.essentials,authoredPlans=getAuthorPlans(lineItem,essentialsPlanData),matchedPlan=getMatchedPlanData(authoredPlans,planType);if(!matchedPlan){var cartControllerHelperService=$injector.get("cartControllerHelperService");return cartControllerHelperService.openIneligibleModal(),!1}return!0},_self.changePlanOnEmptyCart=function(lineId,lineItem,planType){var changePlanDefer=$q.defer(),essentialsService=$injector.get("essentialsService");return essentialsService.getEligiblePlans(lineId,lineItem.lineType,!1).then(function(getEligibleResponse){_self.postPlansToCart(lineItem,planType,getEligibleResponse,!0,lineId).then(function(postPlanInLineResp){cartStorage.removePlanIntentCookie(),cartHttpDataService.getCartV3().then(function(){changePlanDefer.resolve("plan changed successfully")})["catch"](function(getCartError){$log.error("something wrong while getting cart",getCartError),changePlanDefer.reject("something wrong while getting cart")})})["catch"](function(postPlanInLineError){$log.error("something wrong while posting plan",postPlanInLineError),changePlanDefer.reject("something wrong while posting plan")})})["catch"](function(getEligiblePlanError){$log.error("something wrong while getting eligible plans",getEligiblePlanError),changePlanDefer.reject("something wrong while getting eligible plans")}),changePlanDefer.promise},_self.checkPlanIntentScenario=function(){return lodash.get(toggleService.model,"toggles.isPlanIntentEnabled",!1)&&cartStorage.getPlanIntentCookie()?!0:!1},_self}essentialsServiceCartFn.$inject=["$q","$timeout","apiService","httpRequestWrapper","cartStorage","cartHttpWrapper","cartConstants","dataFactory","globalValue","commonServices","cartHttpDataService","coreServices","toggleService","$injector"],angular.module("tmobileApp").service("essentialsServiceCart",essentialsServiceCartFn)}(window.angular,_),function(angular){"use strict";var sitemapUrlDetails={templateUrl:"app/sitemap/components/sitemapUrlDetails/sitemapUrlDetails.tpl.html",controller:"sitemapUrlDetailsController as vm",bindings:{item:"=",itemType:"@"}};angular.module("tmobileApp").component("sitemapUrlDetails",sitemapUrlDetails)}(window.angular),function(angular){"use strict";function checkCompatibilityDataServiceFn(apiURLs,httpRequest,cartStorage,$log,commonUtils,globalValue){function _getAuthorValue(path){return commonUtils.searchJson(globalValue.authorValue,path)}function _setUpViewData(){angular.equals(me.model.openView,"HANDSET")?me.model.byodModal={modalSROnlyTitle:"Check Device Compatibility Page",successMessage:_getAuthorValue("byodCompatibilityModal.byodDeviceCompatibilitySuccess"),header:_getAuthorValue("byodCompatibilityModal.byodDeviceHeader"),subHeader:_getAuthorValue("byodCompatibilityModal.byodDeviceSubHeader"),carrierLabel:_getAuthorValue("byodCompatibilityModal.byodDeviceCarrierLabel"),deviceLabel:_getAuthorValue("byodCompatibilityModal.byodDeviceLabel"),checkCompatibilityCtaText:_getAuthorValue("byodCompatibilityModal.byodDeviceCompatibilityCtaText"),suggestions:me.model.devices}:me.model.byodModal={modalSROnlyTitle:"Check Tablet Compatibility Page",successMessage:_getAuthorValue("byodCompatibilityModal.byodTabletCompatibilitySuccess"),header:_getAuthorValue("byodCompatibilityModal.byodTabletHeader"),subHeader:_getAuthorValue("byodCompatibilityModal.byodTabletSubHeader"),carrierLabel:_getAuthorValue("byodCompatibilityModal.byodTabletCarrierLabel"),deviceLabel:_getAuthorValue("byodCompatibilityModal.byodTabletLabel"),checkCompatibilityCtaText:_getAuthorValue("byodCompatibilityModal.byodTabletCompatibilityCtaText"),suggestions:me.model.tablets}}function _getData(type){var url,actionOnSuccessFn;return angular.equals(type,"CARRIERS")?(url=apiURLs.carrierList,actionOnSuccessFn=cartStorage.setCarriers):(url=apiURLs.deviceList,actionOnSuccessFn=cartStorage.setDevices),httpRequest.getJSON(url).then(function(data){var status;return data&&data.length>0?(actionOnSuccessFn(data),status="DONE"):($log.error("Error fetching list from checkCompatibilityDataService"),status="ERROR"),status})}function _setNamedLists(){me.model.devices=cartStorage.getDevices(),me.model.tablets=cartStorage.getTablets(),_setUpViewData()}function _getDeviceList(){cartStorage.getDevices()?_setNamedLists():_getData("DEVICES").then(function(status){angular.equals(status,"DONE")&&_setNamedLists()})}function _getCarrierList(){cartStorage.getCarriers()?me.model.carriers=cartStorage.getCarriers():_getData("CARRIERS").then(function(status){angular.equals(status,"DONE")&&(me.model.carriers=cartStorage.getCarriers())})}function init(){_getDeviceList(),_getCarrierList()}function isCompatible(){return angular.equals(me.model.selectedDevice.dual_mode,"Y")||angular.equals(me.model.selectedCarrier.radio,"GSM")}var me=this;return me.model={},me.init=init,me.isCompatible=isCompatible,me}checkCompatibilityDataServiceFn.$inject=["apiURLs","httpRequest","cartStorage","$log","commonUtils","globalValue"],angular.module("tmobileApp").service("checkCompatibilityDataService",checkCompatibilityDataServiceFn)}(window.angular),function(angular){"use strict";function sitemapUrlDetailsController(commonServices,sitemapModelService,sitemapUtil){function toggleURLVisibility(data){data.hideUrlFromSitemap=!data.hideUrlFromSitemap,data.actionType="showHide",sitemapUtil.postSitemapData(data).then(function(){"aemSitemap"===vm.model.sitemapType?commonServices.$timeout(function(){sitemapModelService.getData()},1e3):sitemapModelService.getData()})}function resetToDefault(data){data.actionType="reset",data.reset=!1,sitemapUtil.postSitemapData(data).then(function(){"aemSitemap"===vm.model.sitemapType?commonServices.$timeout(function(){sitemapModelService.getData()},1e3):sitemapModelService.getData()})}function deleteSitemapUrl(data){sitemapUtil.deleteSitemapData(data.contentPath).then(function(){sitemapModelService.getData()})}var vm=this;vm.model=sitemapModelService.model,vm.deleteSitemapUrl=deleteSitemapUrl,vm.resetToDefault=resetToDefault,vm.toggleURLVisibility=toggleURLVisibility,vm.openSitemapModal=sitemapModelService.openSitemapModal}sitemapUrlDetailsController.$inject=["commonServices","sitemapModelService","sitemapUtil"],angular.module("tmobileApp").controller("sitemapUrlDetailsController",sitemapUrlDetailsController)}(window.angular),function(angular,lodash){"use strict";function cartServicesService($rootScope,cartHttpDataService,cartStorage,tmobNotificationService,cartAccessoryService,accessoriesService,deviceProtectionAndServicesHttpData,responseTransformationService,globalConfig,globalValue,cartCommonOperationsService,apiService,commonUtils,toggleService,dataFactory,cartConstants,pdlService,commonStorage,cartControllerHelperService){function MiniPDPModalCallBack(modalData){var cartSettings=globalConfig.cartSettings,_selectedLine=modalData.selectedLine,devicePlans={};devicePlans.device=modalData.SKU,devicePlans.plans=null,devicePlans.index=modalData.selectedLine.lineNumber,devicePlans.paymentOption=modalData.paymentOption,devicePlans.isExistingProduct=0;var oldFamilyId=cartStorage.getDeviceFamily(_selectedLine.lineItemDetails.deviceDetails.sku),newFamilyId=cartStorage.getDeviceFamily(devicePlans.device);_selectedLine.simKitDetails&&_selectedLine.simKitDetails.isProductAdded&&angular.equals("SIM_KIT_BYOD",_selectedLine.simKitDetails.simKitId)?cartCommonOperationsService.addDeviceToLine(modalData,modalData.selectedLine,"SIM_KIT_BYOD",newFamilyId):_selectedLine.lineItemDetails&&_selectedLine.lineItemDetails.deviceDetails&&_selectedLine.lineItemDetails.deviceDetails.isProductAdded?cartSettings&&cartSettings.removeServiceInEditDevice&&(angular.equals(cartSettings.removeServiceInEditDevice,cartSettings.constants.skuId)?cartCommonOperationsService.addDeviceToLine(modalData,modalData.selectedLine,_selectedLine.lineItemDetails.deviceDetails.sku,devicePlans.device):angular.equals(cartSettings.removeServiceInEditDevice,cartSettings.constants.familyId)&&cartCommonOperationsService.addDeviceToLine(modalData,modalData.selectedLine,oldFamilyId,newFamilyId),cartCommonOperationsService.editProductClose(_selectedLine)):cartCommonOperationsService.addDeviceToLine(modalData,modalData.selectedLine,oldFamilyId,newFamilyId)}function removeLine(selectedLine){pdlService.defaultDeviceData.isDeviceSelected=!0,pdlService.defaultDeviceData.lineNumber=selectedLine.lineNumber,pdlService.defaultDeviceData.lineType=selectedLine.lineType;var _searchJsonPathArray=commonUtils.searchJsonArray,lineId=selectedLine.lineId,lineItemsHandsetArray=_searchJsonPathArray(cartCommonOperationsService.model.structCartData.lineItems,'[?(@.lineType=="HANDSET")]')||[],lineItemsTabletArray=_searchJsonPathArray(cartCommonOperationsService.model.structCartData.lineItems,'[?(@.lineType=="TABLET")]')||[],lineItemsWearableArray=_searchJsonPathArray(cartCommonOperationsService.model.structCartData.lineItems,'[?(@.lineType=="WEARABLE")]')||[];cartHttpDataService.removeLine(lineId).then(function(){if(commonStorage.updateCartCounter(-1),cartStorage.setMockCartCreated(void 0),cartCommonOperationsService.model.structCartData=cartStorage.getGlobalSmartCartInfo(),accessoryService.showAccessoryNudgeWhenEIP(!0,cartCommonOperationsService.model.structCartData),cartCommonOperationsService.removeMagentaClass(),cartCommonOperationsService.checkDeviceLimit(),cartCommonOperationsService.checkStatus(),removeWebOnlyOffer(selectedLine),0===cartCommonOperationsService.model.structCartData.lineItems.length){var dfRequest=new dataFactory.DFRequest;dfRequest.input={key:cartConstants.ESSENTIALS_CONSTANT.PLAN_TYPE};var cacheKey=cartConstants.ESSENTIALS_CONSTANT.CACHE.DATA_KEY_NEW+JSON.stringify(dfRequest.input),dataCache=dataFactory.getCacheObject(cartConstants.ESSENTIALS_CONSTANT.CACHE.NAME);dataCache.remove(cacheKey),cartCommonOperationsService.model.selectedPlanType=""}cartCommonOperationsService.disableProductCta(),lodash.get(toggleService.model,"toggles.isEclaEnabled",!1)&&cartControllerHelperService.checkFinanceEstimatesCall(),1===lineItemsHandsetArray.length&&"HANDSET"===selectedLine.lineType&&(lineItemsTabletArray.length>0||lineItemsWearableArray.length>0)?(tmobNotificationService.addNotification.push("cart034"),tmobNotificationService.showNotification(tmobNotificationService.addNotification)):(tmobNotificationService.addNotification.push("cart012"),tmobNotificationService.showNotification(tmobNotificationService.addNotification))})}function updateService(selectedLine,serviceId,isServiceChecked){var lineId=selectedLine.lineId,apiVersion=apiService.getVersion("bundleService"),transformService=responseTransformationService.getFactory(apiVersion);if(3===apiVersion){var selectedServices=deviceProtectionAndServicesHttpData.initSelectedServices();isServiceChecked?selectedServices.addServices.offerIds.push(serviceId):selectedServices.removeServices.offerIds.push(serviceId),deviceProtectionAndServicesHttpData.addServicesToLine(lineId,void 0,selectedServices).then(function(response){deviceProtectionAndServicesHttpData.getServices(lineId).then(function(serviceResponse){cartStorage.setBundleServices(transformService.getTransformedServies(serviceResponse.data),lineId),handleAddServiceToLineResponse(selectedLine)})})}else deviceProtectionAndServicesHttpData.bundleServices(lineId,serviceId).then(function(serviceResponse){200===serviceResponse.status&&(cartStorage.setServiceId(serviceResponse.data.services.id,lineId),cartStorage.setSelectedServiceId(serviceResponse.data.services.id,lineId),cartStorage.setBundleServices(transformService.getTransformedServies(serviceResponse.data),lineId),deviceProtectionAndServicesHttpData.addServicesToLine(lineId).then(function(){handleAddServiceToLineResponse(selectedLine)}))})}function handleAddServiceToLineResponse(selectedLine){cartCommonOperationsService.removeMagentaClass(),selectedLine.mvcAttrs.isDeviceChanged=!1,selectedLine.mvcAttrs.isServiceChanged=!0,cartCommonOperationsService.updateStructCartData(),cartCommonOperationsService.disableCheckoutCTA(),tmobNotificationService.addNotification.push("cart008"),tmobNotificationService.showNotification(tmobNotificationService.addNotification)}function addZipServices(selectedLine,zipService){var selectedZipService,lineId=selectedLine.lineId,apiVersion=apiService.getVersion("bundleService"),transformService=responseTransformationService.getFactory(apiVersion),isServiceSelected=!1,getServicesPromise=3===apiVersion?deviceProtectionAndServicesHttpData.getServices(lineId,void 0):deviceProtectionAndServicesHttpData.bundleServices(lineId,void 0);getServicesPromise.then(function(serviceResponse){if(200===serviceResponse.status){3!==apiVersion&&(cartStorage.setServiceId(serviceResponse.data.services.id,lineId),cartStorage.setSelectedServiceId(serviceResponse.data.services.id,lineId));var _servicesData=transformService.getTransformedServies(serviceResponse.data);cartStorage.setBundleServices(_servicesData,lineId);var serviceOptions=cartStorage.getServiceOptions(lineId);if(angular.forEach(_servicesData,function(serviceItem){serviceItem.name.indexOf(zipService.familyName)>-1&&!isServiceSelected&&(selectedZipService=serviceItem,isServiceSelected=!0)}),selectedZipService)angular.forEach(serviceOptions,function(serviceObj){selectedZipService.name.indexOf(serviceObj.familyName)>-1&&(serviceObj.serviceId=selectedZipService.code)}),cartStorage.setServiceOptions(lineId,serviceOptions),updateService(selectedLine,selectedZipService.code,!0);else{var modalData={errorHeader:globalValue.authorValue.cart.services.serviceErrorTitle,errorBody:globalValue.authorValue.cart.services.serviceErrorBody};cartCommonOperationsService.openAlertMessageModal(modalData),$rootScope.$broadcast("cart-service",{selectedLine:selectedLine})}}})}function saveWebOnlyOffer(selectedProduct){var badgesPromoValue=selectedProduct.BadgesAndPromotions,webOfferList=[],webOnlyValue={};webOnlyValue.SKU=selectedProduct.SKU;var checkWeb=cartStorage.getWebOnlyInfo();lodash.forEach(badgesPromoValue,function(promoVal){lodash.isEqual(promoVal.label,lodash.get(globalValue.authorValue,"rootPage.globalAuthoring.webOnlyOffer"))&&lodash.isEqual(promoVal.value,"true")&&(webOnlyValue.WebOnly=promoVal.value,lodash.isNil(checkWeb)||lodash.isEmpty(checkWeb)?(webOfferList.push(webOnlyValue),cartStorage.setWebOnlyInfo(webOfferList)):(checkWeb.push(webOnlyValue),cartStorage.setWebOnlyInfo(checkWeb)))})}function hideContainer(selectedFamily){if(!lodash.isEmpty(globalValue.authorValue.storeauthoring)){var allHiddenSkus=transformStatusList(globalValue.authorValue.storeauthoring.digitalToRetail.containerBoxVisibility),hideAtFamilyLevel=lodash.find(allHiddenSkus,function(visibility){var visibilityFlag=!1;return visibilityFlag=1===allHiddenSkus.length&&""!==allHiddenSkus[0]?visibility===selectedFamily:visibility.familyID===selectedFamily});if(hideAtFamilyLevel)return!0}return!1}function transformStatusList(inputList){if(!lodash.isEmpty(inputList)){var skuArrayLength=Object.keys(inputList).length;return lodash.map(inputList,function(item){return skuArrayLength>1?angular.isString(item)?angular.fromJson(item):item:1!==skuArrayLength||lodash.isEmpty(item)?void 0:item})}}function removeWebOnlyOffer(selectedLine){var checkWeb=cartStorage.getWebOnlyInfo(),isFirstMatch=!0;if(!lodash.isNil(selectedLine.lineItemDetails)&&!lodash.isNil(checkWeb)){var checkWebVal=checkWeb.filter(function(item){return item.SKU!==selectedLine.lineItemDetails.deviceDetails.sku||item.SKU===selectedLine.lineItemDetails.deviceDetails.sku&&!isFirstMatch?item:void(item.SKU===selectedLine.lineItemDetails.deviceDetails.sku&&isFirstMatch&&(isFirstMatch=!1))});cartStorage.setWebOnlyInfo(checkWebVal)}}var accessoryService=toggleService.model.toggles.newAccessory?accessoriesService:cartAccessoryService;return{addZipServices:addZipServices,updateService:updateService,MiniPDPModalCallBack:MiniPDPModalCallBack,removeLine:removeLine,saveWebOnlyOffer:saveWebOnlyOffer,removeWebOnlyOffer:removeWebOnlyOffer,hideContainer:hideContainer}}cartServicesService.$inject=["$rootScope","cartHttpDataService","cartStorage","tmobNotificationService","cartAccessoryService","accessoriesService","deviceProtectionAndServicesHttpData","responseTransformationService","globalConfig","globalValue","cartCommonOperationsService","apiService","commonUtils","toggleService","dataFactory","cartConstants","pdlService","commonStorage","cartControllerHelperService"],angular.module("tmobileApp").service("cartServicesService",cartServicesService)}(window.angular,window._),function(angular){"use strict";var storeSitemap={templateUrl:"app/sitemap/components/storeSitemap/storeSitemap.tpl.html",controller:"storeSitemapController as vm"};angular.module("tmobileApp").component("storeSitemap",storeSitemap)}(window.angular),function(angular,lodash){"use strict";function cartManualReviewModalCtrlFn($modalInstance,commonServices,globalValue,cartStorage,invocaScriptService,coreServices){function close(){vm.visible=!0,$modalInstance.close(),cartStorage.setHardCreditCheck(!1),cartStorage.setSoftCreditCheck(!1),angular.isDefined(vm.cartManualReview.ctaToCartLink)&&(commonServices.$window.location.href=vm.cartManualReview.ctaToCartLink)}function visitToStore(){angular.isDefined(vm.cartManualReview.visitStoreCTALink)&&(commonServices.$window.location.href=vm.cartManualReview.visitStoreCTALink)}function invocaRun(){invocaScriptService.runPnapi()}function init(){vm.close=close,vm.visitToStore=visitToStore,vm.cartManualReview=lodash.get(globalValue.authorValue,"rootPage.cartManualReview",{}),vm.isTPPON=lodash.get(coreServices.toggleService.model.toggles,"isTPPON",!1)}var vm=this;vm.invocaRun=invocaRun,init()}var controllerName="cartManualReviewModalController";angular.module("tmobileApp").controller(controllerName,cartManualReviewModalCtrlFn)}(angular,_),function(angular){"use strict";function storeSitemapControllerConstructor(sitemapModelService,sitemapUtil){function init(){vm.model.sitemapType="storeSitemap",sitemapUtil.createServletUrl("store-locator");var data={actionType:"UPDATENODE"};sitemapUtil.postSitemapData(data).then(function(){sitemapModelService.getData()})}var vm=this;vm.model=sitemapModelService.model,init()}storeSitemapControllerConstructor.$inject=["sitemapModelService","sitemapUtil"],angular.module("tmobileApp").controller("storeSitemapController",storeSitemapControllerConstructor)}(window.angular),function(angular,lodash){"use strict";function myCartControllerConstructor($rootScope,$timeout,cartHttpDataService,commonStorage,creditClassService,commonUtils,cartControllerHelperService,CartCommonModal,cartStorage,deviceProtectionAndServicesHttpData,keyValues,globalConfig,globalValue,tmobNotificationService,cartServicesService,cartCommonOperationsService,cartDevicesService,commonServices,productDetailsService,geoLocation,utils,toggleService,$state,CHECKOUT_STATE_NAME,$sessionStorage,deviceTradeInService,authorValueService,cartConstants,miniBrowseDeviceService,accessoriesService,essentialsService,$scope,dataFactory,pdlService,universalMenuDataService,$location){function getCart(){cartStorage.getCartId()&&cartStorage.getGlobalSmartCartInfo()&&(cartCommonOperationsService.model.structCartData=cartStorage.getGlobalSmartCartInfo(),cartCommonOperationsService.isDeeplinkFlow&&(cartCommonOperationsService.isDeeplinkFlow=!1,cartCommonOperationsService.loadOrderDetailsView()),cartCommonOperationsService.checkDeviceLimit())}function addLineByLineType(lineType){cartCommonOperationsService.addLineByLineType(lineType),angular.element(".cart-product:last").offset()&&$timeout(function(){commonServices.$window.scrollTo(0,angular.element(".cart-product:last").offset().top)},200)}function addLine(){angular.element(".empty-cart-error-message").length>0&&$rootScope.$broadcast("clearCartErrorMsg"),addLineByLineType("HANDSET"),angular.element(".cart-product:last").offset()&&$timeout(function(){commonServices.$window.scrollTo(0,angular.element(".cart-product:last").offset().top)},200)}function duplicateLine(selectedLine){vm.cartCommonOperationsService.deviceLimitReached||cartDevicesService.duplicateLine(selectedLine)}function deviceSelectorModalCallBack(modalData){var _selectedLine=modalData.selectedLine;if(modalData.openminipdppage){var _commonResolves=cartControllerHelperService.commonResolves("miniPDPModalView",_selectedLine,1,keyValues,null,modalData.deviceData),resolveAttributes={resolve:angular.extend(_commonResolves.openView,_commonResolves.selectedCreditClass,_commonResolves.selectedProductSKU,_commonResolves.keyValues,_commonResolves.selectedLine,_commonResolves.selectedDeviceOfferId)
};CartCommonModal.openCartModal("miniPDPModal",resolveAttributes,cartServicesService.MiniPDPModalCallBack)}else modalData.openBringYourOwnDevice&&openOwnPhoneModal(modalData.selectedLine)}function openDeviceSelectorModal(openView,selectedLine,i){var _commonResolves=cartControllerHelperService.commonResolves(openView,selectedLine,i,keyValues,null),resolveAttributes={resolve:angular.extend(_commonResolves.openView,_commonResolves.selectedCreditClass,_commonResolves.selectedProductSKU,_commonResolves.keyValues,_commonResolves.selectedLine)};CartCommonModal.openCartModal("deviceSelectorModal",resolveAttributes,deviceSelectorModalCallBack)}function openMiniPDPEditModal(openView,selectedLine,i){var _commonResolves=cartControllerHelperService.commonResolves(openView,selectedLine,i,keyValues,null),resolveAttributes={resolve:angular.extend(_commonResolves.openView,_commonResolves.selectedCreditClass,_commonResolves.selectedProductSKU,_commonResolves.keyValues,_commonResolves.selectedLine,_commonResolves.selectedDeviceOfferId)};CartCommonModal.openCartModal("miniPDPModal",resolveAttributes,cartServicesService.MiniPDPModalCallBack)}function emptyModalCallBack(){}function userSelectedPlan(selectedLine,planOption){}function editProductClose(selectedLine){cartCommonOperationsService.editProductClose(selectedLine)}function openPriceBreakdownModal(){if(!cartCommonOperationsService.model.structCartData.accessories.accessoryDetails.length){if(!cartCommonOperationsService.model.structCartData.lineItems.length)return;if(!cartCommonOperationsService.model.structCartData.flags.isPriceBreakdownEnable)return}var _commonResolves=cartControllerHelperService.commonResolves(null,cartCommonOperationsService.model.structCartData,null,keyValues,null,null,"cart"),resolveAttributes={resolve:angular.extend(_commonResolves.keyValues,_commonResolves.selectedLine,_commonResolves.source)};CartCommonModal.openCartModal("priceBreakdownModal",resolveAttributes,emptyModalCallBack)}function openDeviceProtectionAndServicesSelectorModal(selectedLine,index){var commonResolves=cartControllerHelperService.commonResolves(null,selectedLine,index,keyValues),serviceCount=selectedLine.lineItemDetails.serviceDetails.length,resolveAttributes={resolve:angular.extend(commonResolves.keyValues,commonResolves.selectedProtectionPlans,commonResolves.selectedLine,commonResolves.protectionData)},modalCallBack=function(globalServiceObject){var addServiceToLinePromise;if(toggleService.model.toggles.isDcpV3ApiEnabled&&globalServiceObject.selectedServices){var selectServices=lodash.get(globalServiceObject.selectedServices.addServices,"offerIds"),removeExistingServices=lodash.get(globalServiceObject.selectedServices.removeExistingServices,"offerIds"),removeServices=lodash.get(globalServiceObject.selectedServices.removeServices,"offerIds");selectServices&&selectServices.length>0||removeExistingServices&&removeExistingServices.length>0||removeServices&&removeServices.length>0?(addServiceToLinePromise=deviceProtectionAndServicesHttpData.addServicesToLine(selectedLine.lineId,void 0,globalServiceObject.selectedServices),vm.addServicesToLine(addServiceToLinePromise,selectedLine,serviceCount,globalServiceObject.protectionPlansLineItems)):vm.handleDataSoc(globalServiceObject.protectionPlansLineItems,selectedLine)}else addServiceToLinePromise=deviceProtectionAndServicesHttpData.addServicesToLine(selectedLine.lineId),vm.addServicesToLine(addServiceToLinePromise,selectedLine,serviceCount)},modalDismissCallBack=function(){$rootScope.$broadcast("cart-service",{selectedLine:selectedLine})},deviceProtectionModalName="deviceProtectionAndServicesSelectorModalV3";CartCommonModal.openCartModal(deviceProtectionModalName,resolveAttributes,modalCallBack,modalDismissCallBack)}function updateCart(dataSocObj){cartStorage.isDataSocSelected=!1,cartHttpDataService.getCart().then(function(){cartCommonOperationsService.model.structCartData=cartStorage.getGlobalSmartCartInfo()},function(error){$log.error("Error getting cart details : "+error)})}function patchDataSoc(selectedLine,dataSocObj,selectedPlan){essentialsService.patchPlanToLine(selectedLine,selectedPlan,!1).then(function(result){$log.log("Successfully getting postSelectedPlanToLine result"),updateCart(dataSocObj)},function(error){$log.error("Error getting postSelectedPlanToLine result : "+error)})}function handleDataSoc(protectionPlanLineItems,selectedLine){var selectedPlan,plan=lodash.find(protectionPlanLineItems,{selected:!0,isDataSoc:!0});if(plan)plan.isSelected=plan.selected,plan.isChecked=plan.selected,selectedPlan={planOptions:[{soc:plan.code}]},vm.patchDataSoc(selectedLine,plan,selectedPlan);else{var unselectedDataSoc=lodash.find(protectionPlanLineItems,{isDataSoc:!0,code:selectedLine.lineItemDetails.planDetails.planSOCs[0]});angular.isDefined(unselectedDataSoc)&&(selectedLine.lineType===cartConstants.DEVICE_TYPE.TABLET?(selectedPlan={planOptions:[{soc:selectedLine.lineItemDetails.planDetails.planId}]},vm.patchDataSoc(selectedLine,unselectedDataSoc,selectedPlan)):essentialsService.getEligiblePlans(selectedLine.lineId,selectedLine.lineType,!1).then(function(eligiblePlansResponse){if(!lodash.isEmpty(eligiblePlansResponse)&&angular.isDefined(eligiblePlansResponse)&&null!==eligiblePlansResponse){var defaultPlan=cartControllerHelperService.getDefaultPlanData(selectedLine,eligiblePlansResponse);selectedPlan={planOptions:[{soc:defaultPlan.planSoc}]},vm.patchDataSoc(selectedLine,defaultPlan,selectedPlan)}},function(error){$log.error("Error getting getEligiblePlans data : "+error)}))}}function addServicesToLine(addServiceToLinePromise,selectedLine,serviceCount,protectionPlansLineItems){cartStorage.isDataSocSelected=isDataSocSelected(protectionPlansLineItems,selectedLine),addServiceToLinePromise.then(function(cartResponseStatus){lodash.get(toggleService.model,"toggles.isDataSocEnabledOnModal",!1)&&angular.isDefined(protectionPlansLineItems)&&vm.handleDataSoc(protectionPlansLineItems,selectedLine),cartCommonOperationsService.removeMagentaClass(),selectedLine.mvcAttrs.isDeviceChanged=!1,selectedLine.mvcAttrs.isServiceChanged=!0,cartCommonOperationsService.updateStructCartData(),serviceCount?(tmobNotificationService.addNotification.push("cart008"),tmobNotificationService.showNotification(tmobNotificationService.addNotification)):(tmobNotificationService.addNotification.push("cart007"),tmobNotificationService.showNotification(tmobNotificationService.addNotification))})}function openExitPathConfirmationModal(){if((!cartCommonOperationsService.model.structCartData||cartCommonOperationsService.model.structCartData.flags.isEmpty)&&!cartCommonOperationsService.model.structCartData.flags.isAccessoryFlow||cartStorage.getSaveCartFlag())commonServices.$window.location.href=keyValues.exitPage.goToHomeLink;else{var commonResolves=cartControllerHelperService.commonResolves(null,null,null,keyValues),resolveAttributes={resolve:angular.extend(commonResolves.keyValues)};CartCommonModal.openCartModal("exitPathConfirmationModal",resolveAttributes,emptyModalCallBack)}}function openOwnPhoneModal(selectedLine){var _commonResolves=cartControllerHelperService.commonResolves(null,selectedLine,null,keyValues),resolveAttributes={resolve:angular.extend(_commonResolves.keyValues,_commonResolves.selectedLine)},modalCallBack=function(modalObject){var reqJSON={rowData:[{}]},_selectedLine=modalObject.selectedLine;reqJSON.rowData[0].productSKU=modalObject.phoneDetails.SKU,reqJSON.rowData[0].paymentOption=modalObject.paymentOption,lodash.get(toggleService.model,"toggles.isEssentialsEnabled",!1)&&lodash.get(toggleService.model,"toggles.isProductFirst",!1)&&(selectedLine=_selectedLine),_selectedLine.lineItemDetails.deviceDetails&&_selectedLine.lineItemDetails.deviceDetails.isProductAdded?(cartCommonOperationsService.addDeviceToLine(modalObject.phoneDetails,selectedLine,_selectedLine.lineItemDetails.deviceDetails.sku,modalObject.phoneDetails.SKU),_selectedLine.lineItemDetails.serviceDetails.length>0?(tmobNotificationService.addNotification.push("cart009"),tmobNotificationService.addNotification.push("cart004"),tmobNotificationService.addNotification.push("cart005"),tmobNotificationService.showNotification(tmobNotificationService.addNotification)):(tmobNotificationService.addNotification.push("cart004"),tmobNotificationService.addNotification.push("cart005"),tmobNotificationService.showNotification(tmobNotificationService.addNotification))):(cartCommonOperationsService.addDeviceToLine(modalObject.phoneDetails,selectedLine,modalObject.phoneDetails.SKU,modalObject.phoneDetails.SKU),tmobNotificationService.addNotification.push("cart005"),tmobNotificationService.showNotification(tmobNotificationService.addNotification))};CartCommonModal.openCartModal("ownPhoneModal",resolveAttributes,modalCallBack)}function openLocationFPOModal(selectedLine,index,zipService){var commonResolves=cartControllerHelperService.commonResolves(null,null,null,keyValues),resolveAttributes={resolve:angular.extend(commonResolves.keyValues)},modalCallBack=function(){zipService?cartServicesService.addZipServices(selectedLine,zipService):openDeviceProtectionAndServicesSelectorModal(selectedLine,index)},modalDismissCallBack=function(){$rootScope.$broadcast("cart-service",{selectedLine:selectedLine})};CartCommonModal.openCartModal("locationFPOModal",resolveAttributes,modalCallBack,modalDismissCallBack);var uiViewElement=angular.element($document.querySelector(".ng-main-view"));uiViewElement.removeClass("ng-main-view"),$timeout(function(){uiViewElement.addClass("ng-main-view")},1e3)}function openLearnMoreModal(selectedLine){var _commonResolves=cartControllerHelperService.commonResolves(null,selectedLine,null,keyValues),resolveAttributes={resolve:angular.extend(_commonResolves.planDetails,_commonResolves.selectedLine,_commonResolves.keyValues)};CartCommonModal.openCartModal("learnMoreModal",resolveAttributes,emptyModalCallBack)}function openPlanModal(selectedLine){vm.planModalOpen=!0,vm.authorValue||(vm.authorValue={learnMoreModalURL:{},smartcartjson:{}}),vm.authorValue.learnMoreModal={};var templateUrl,templateUrl1,_commonResolves=cartControllerHelperService.commonResolves(null,selectedLine,null,keyValues);cartCommonOperationsService.model.structCartData.selectedCreditClass||(cartCommonOperationsService.model.structCartData.selectedCreditClass={"class":"creditClass1"}),templateUrl="creditClass3"===cartCommonOperationsService.model.structCartData.selectedCreditClass["class"]?vm.authorValue.smartcartjson.simpleChoiceNoCredit:vm.authorValue.smartcartjson.simpleChoiceModal,vm.authorValue.learnMoreModalURL={templateUrl:templateUrl},templateUrl1=templateUrl+".partial.html";var resolveAttributes={templateUrl1:templateUrl1,resolve:angular.extend(_commonResolves.planDetails,_commonResolves.keyValues,_commonResolves.selectedCreditClass)},modalCallBack=function(modalObject){openCreditClassSelectorModal(),vm.planModalOpen=!1},modalDismissCallBack=function(modalObject){vm.planModalOpen=!1,cartCommonOperationsService.model.structCartData=cartStorage.getGlobalSmartCartInfo()};CartCommonModal.openCartModal("planModal",resolveAttributes,modalCallBack,modalDismissCallBack)}function zipCodeCheck(selectedLine,index,zipService){angular.isDefined(zipService)&&pdlService.setDefaultServiceDataObject(!0,zipService.familyName,selectedLine.lineNo,cartConstants.PRODUCT_TYPE.SERVICE),cartControllerHelperService.isLineItemPresent(selectedLine)&&(zipService?cartCommonOperationsService.isZipCodeAdded()?cartServicesService.addZipServices(selectedLine,zipService):openLocationFPOModal(selectedLine,index,zipService):cartCommonOperationsService.isZipCodeAdded()?openDeviceProtectionAndServicesSelectorModal(selectedLine,index):openLocationFPOModal(selectedLine,index))}function openCreditClassSelectorModal(current,callback){cartCommonOperationsService.openCreditClassSelectorModal(current,keyValues,callback,vm.planModalOpen)}function openCheckCompatibilityModal(selectedLine){var openView=selectedLine.lineType,_commonResolves=cartControllerHelperService.commonResolves(openView,selectedLine),resolveAttributes={resolve:angular.extend(_commonResolves.openView,_commonResolves.selectedLine)},modalCallBack=function(selectedLineCallback){selectedLineCallback&&openCheckCompatibilityResultModal(selectedLineCallback,commonUtils.searchJson(globalConfig,"CheckCompatibilityModal"))};CartCommonModal.openCartModal("checkCompatibilityModal",resolveAttributes,modalCallBack)}function openCheckCompatibilityResultModal(data,source){var openView=data.lineType,selectedLine=data,_commonResolves=cartControllerHelperService.commonResolves(openView,selectedLine,null,null,null,null,source),resolveAttributes={resolve:angular.extend(_commonResolves.openView,_commonResolves.selectedLine,_commonResolves.source)},modalCallBack=function(modalData){angular.equals(modalData.source,commonUtils.searchJson(globalConfig,"CheckCompatibilityModal"))?openCheckCompatibilityModal(modalData.selectedLine):angular.equals(modalData.source,commonUtils.searchJson(globalConfig,"IMEIModal"))?openCheckIMEIModal(modalData.selectedLine):creditCheck("Select Phone",modalData)};CartCommonModal.openCartModal("checkCompatibilityResultModal",resolveAttributes,modalCallBack)}function openCheckIMEIModal(){var _commonResolves=cartControllerHelperService.commonResolves(null,null,null,keyValues),resolveAttributes={resolve:angular.extend(_commonResolves.keyValues)};CartCommonModal.openCartModal("checkImeiModal",resolveAttributes,emptyModalCallBack)}function openComparePlanModal(){var _commonResolves=cartControllerHelperService.commonResolves(null,null,null,keyValues),resolveAttributes={resolve:angular.extend(_commonResolves.keyValues)};CartCommonModal.openCartModal("comparePlanModal",resolveAttributes);var pdlData={description:{ctaName:lodash.get(vm.keyValues,"essentials.plansCtaText"),assetType:"Button"}};pdlService.callGenericCTAorLinkEvent(pdlData)}function isCreditCheckDoneForNonEssentialFlow(){return angular.isDefined(cartCommonOperationsService.model.structCartData.selectedCreditClass)&&cartCommonOperationsService.model.structCartData.selectedCreditClass.label||vm.isB2B}function isCreditCheckDoneForEssentialFlow(openView,selectedLine,index){var _commonResolves=cartControllerHelperService.commonResolves(openView,selectedLine,index,keyValues,null);return vm.isCreditCheckDoneForNonEssentialFlow()&&angular.isDefined(_commonResolves.selectedCreditClass.selectedCreditClass())}function isCreditCheckDone(openView,selectedLine,index){return lodash.get(toggleService.model,"toggles.isEssentialsEnabled",!1)&&lodash.get(toggleService.model,"toggles.isProductFirst",!1)?vm.isCreditCheckDoneForEssentialFlow(openView,selectedLine,index):vm.isCreditCheckDoneForNonEssentialFlow()}function creditCheck(openView,selectedLine,index,targetModal){var _selectedLine=selectedLine;vm.isCreditCheckDone()?(vm.isB2B&&(cartCommonOperationsService.model.structCartData.selectedCreditClass["class"]="creditClass1"),targetModal?openOwnPhoneModal(_selectedLine):openDeviceSelectorModal(openView,_selectedLine,index)):vm.openCreditClassSelectorModal(_selectedLine,function(modalObject){targetModal?openOwnPhoneModal(modalObject.selectedLine):openDeviceSelectorModal(openView,_selectedLine,index)})}function isAccessoryAddedToCart(){return cartCommonOperationsService.model.structCartData=cartStorage.getGlobalSmartCartInfo(),angular.isDefined(cartCommonOperationsService.model.structCartData.accessories)&&cartCommonOperationsService.model.structCartData.accessories.accessoryDetails.length>0?!0:!1}function productFirstCTAAction(deviceType){var ctaName;if(deviceType)switch(deviceType){case cartConstants.DEVICE_TYPE.HANDSET:ctaName=lodash.get(vm.keyValues,"productFirstCartCTA.addAPhoneCTAText"),vm.creditCheck(cartConstants.SELECT_PHONE,{lineType:cartConstants.DEVICE_TYPE.HANDSET});break;case cartConstants.DEVICE_TYPE.TABLET:ctaName=lodash.get(vm.keyValues,"productFirstCartCTA.addATabletCTAText"),vm.creditCheck(cartConstants.SELECT_PHONE,{lineType:cartConstants.DEVICE_TYPE.TABLET});break;case cartConstants.DEVICE_TYPE.ACCESSORY:ctaName=lodash.get(vm.keyValues,"productFirstCartCTA.addAnAccessoryCTAText"),accessoriesService.openAccessoryMiniBrowse();break;case cartConstants.DEVICE_TYPE.WEARABLE:ctaName=lodash.get(vm.keyValues,"productFirstCartCTA.addAWearableCTAText"),vm.creditCheck(cartConstants.SELECT_PHONE,{lineType:cartConstants.DEVICE_TYPE.WEARABLE});break;case cartConstants.DEVICE_TYPE.BYOD:ctaName=lodash.get(vm.keyValues,"productFirstCartCTA.bringYourOwnDeviceCTAText"),vm.openOwnPhoneModal({lineType:cartConstants.DEVICE_TYPE.HANDSET})}var pdlData={description:{ctaName:ctaName,assetType:"tile"}};pdlService.callGenericCTAorLinkEvent(pdlData)}function showAccessories(){angular.element(".empty-cart-error-message").length>0&&$rootScope.$broadcast("clearCartErrorMsg"),cartCommonOperationsService.model.structCartData.flags.isAccessoryFlow=!0,cartCommonOperationsService.disableCheckoutCTA()}function editProduct(selectedLine){if(selectedLine.simKitDetails.isProductAdded)selectedLine.lineItemDetails.deviceDetails.isProductAdded&&!selectedLine.simKitDetails.isBYODAdded?openMiniPDPEditModal("Edit Phone",selectedLine,selectedLine.lineNumber-1):openOwnPhoneModal(selectedLine);else if(selectedLine.lineItemDetails.deviceDetails.isWearable)openMiniPDPEditModal("Edit Phone",selectedLine,selectedLine.lineNumber-1);else{selectedLine.mvcAttrs.editProductInProgress=!0;var id="#cartDeviceSection_"+selectedLine.lineNumber;removeRole(id)}}function toggleSelectedPlan(selectedLine){cartHttpDataService.toggleSelectedPlan(selectedLine).then(function(status){var cartData=cartStorage.getGlobalSmartCartInfo(),planConfigData=cartStorage.getPlanConfigData();angular.forEach(cartData.lineItems,function(item,index){_.merge(item.lineItemDetails.planDetails,planConfigData.lineItems[index].lineItemDetails.planDetails)}),cartCommonOperationsService.model.structCartData=cartStorage.getGlobalSmartCartInfo()})}function removeRole(id){var elm=angular.element(id);elm.removeAttr("role")}function redirectCheckout(){commonServices.$window.location.href=globalConfig.outagePageURL}function accessoryEIPNotification(cartData){var persistedEIPSettings={},ns=cartStorage.getNotificationState();persistedEIPSettings.state=ns,persistedEIPSettings.isNotifyEIP=vm.isNotifyEIP,persistedEIPSettings.isAccessoryEnabled=vm.isAccessoryEnabled,cartStorage.setEIPSettings(persistedEIPSettings),cartData.accessories&&0===cartData.accessories.accessoryDetails.length&&vm.isAccessoryEnabled===!0&&(vm.isNotifyEIP===!0&&"EIP"!==ns?(tmobNotificationService.addNotification.push("cart018"),tmobNotificationService.showNotification(tmobNotificationService.addNotification),cartStorage.setNotificationState("EIP")):"FRP"!==ns&&(tmobNotificationService.addNotification.push("cart018"),tmobNotificationService.showNotification(tmobNotificationService.addNotification),cartStorage.setNotificationState("FRP")),vm.isNotifyEIP=!1,vm.isAccessoryEnabled=!1),cartData.accessories.accessoryDetails.length>0&&(vm.isAccessoryEnabled=!0,cartData.flags.isNotifyEIP&&vm.isNotifyEIP===!1?"EIP"!==ns&&(tmobNotificationService.addNotification.push("cart017"),tmobNotificationService.showNotification(tmobNotificationService.addNotification),cartStorage.setNotificationState("EIP"),vm.isNotifyEIP=!0):cartData.flags.isNotifyFRP&&vm.isNotifyEIP===!0&&"FRP"!==ns&&(tmobNotificationService.addNotification.push("cart018"),tmobNotificationService.showNotification(tmobNotificationService.addNotification),vm.isNotifyEIP=!1,cartStorage.setNotificationState("FRP")))}function manageRatePlanCookie(){var planType=getPlanTypeFromUrl(),cartData=cartStorage.getGlobalSmartCartInfo(),planIntentCookie=cartConstants.PLAN_TYPES[planType];$location.search("planType",null),planIntentCookie&&0===cartData.lineItems.length&&cartStorage.setPlanIntentCookie(planIntentCookie)}function getPlanTypeFromUrl(){var planType=$location.search().planType;return planType?planType.toUpperCase():planType}function initialize(){if(lodash.get(toggleService.model,"toggles.isPlanIntentEnabled",!1)&&(vm.manageRatePlanCookie(),cartCommonOperationsService.disableProductForRatePlan()),cartCommonOperationsService.setStructCartData(),cartCommonOperationsService.model.structCartData&&cartCommonOperationsService.checkDeviceLimit(),authorValueFlagEnable){if(vm.keyValues=cartCommonOperationsService.getAuthorKeyValues(vm.authorValue),keyValues=vm.keyValues,!lodash.get(toggleService.model,"toggles.isDcpV3ApiEnabled",!1)){var selectedClass=angular.isDefined(creditClassService.getCreditClass())?creditClassService.getCreditClass()["class"]:cartCommonOperationsService.model.structCartData.selectedCreditClass["class"];cartCommonOperationsService.model.structCartData.selectedCreditClass=_.find(keyValues.creditSelector["class"],{"class":selectedClass})}vm.authorValue.cart.cartTfn.callMeNow=vm.authorValue.cart.callMeNow}lodash.get(toggleService.model,"toggles.isDcpV3ApiEnabled",!1)||(cartStorage.setCreditClassJson(keyValues["class"]),cartStorage.getCartId()||creditClassService.setCreditClass(void 0)),cartSettings&&!cartSettings.isEmptyCartEnabled&&cartCommonOperationsService.model.structCartData&&cartCommonOperationsService.model.structCartData.flags&&cartCommonOperationsService.model.structCartData.flags.isDefaultCart&&addLine(),cartCommonOperationsService.removeMagentaClass(),getCart(),cartCommonOperationsService.checkStatus();var authorableOfferIds=getAllOfferIdsForDeviceAndTablets();if(deviceTradeInService.getTradeInOffers(authorableOfferIds),lodash.get(toggleService.model,"toggles.isEssentialsEnabled",!1)&&lodash.get(toggleService.model,"toggles.isProductFirst",!1)&&!lodash.get(toggleService.model,"toggles.isDcpV3ApiEnabled",!1)&&miniBrowseDeviceService.prefetchInternetDevice(),lodash.get(toggleService.model,"toggles.isEssentialsEnabled",!1)&&lodash.get(toggleService.model,"toggles.isPlanMgmtEnabled",!1)){if(!lodash.isEmpty(cartCommonOperationsService.model.structCartData.lineItems)){var length=cartCommonOperationsService.model.structCartData.lineItems.length-1,lastAddedLine=cartCommonOperationsService.model.structCartData.lineItems[length];toggleService.model.toggles.isDcpV3ApiEnabled||cartCommonOperationsService.fetchEligiblePlans(lastAddedLine.lineId,lastAddedLine.lineType,!1,!0);var unoEnableLineType=lodash.get(toggleService.model,"toggles.isUnoOn",!1)&&commonStorage.getFromSharedCookie("lineType")?commonStorage.getFromSharedCookie("lineType"):lastAddedLine.lineType;cartControllerHelperService.checkPlanEligibility(unoEnableLineType)}cartCommonOperationsService.disableProductCta()}}function changePlan(planType){planType!==cartCommonOperationsService.model.selectedPlanType&&essentialsService.setEligiblePlan(planType).then(function(){var dfRequest=cartControllerHelperService.getDataFactoryRequest();dataFactory.setVO(cartConstants.ESSENTIALS_CONSTANT.CACHE.DATA_KEY_NEW,dfRequest,planType),cartCommonOperationsService.setActiveIndex(),cartCommonOperationsService.model.structCartData=cartStorage.getGlobalSmartCartInfo(),cartCommonOperationsService.disableProductCta()})}function noCreditSelected(){var currentCreditClass=angular.isDefined(creditClassService.getCreditClass());if(currentCreditClass){var creditClass=creditClassService.getCreditClass();return"creditClass3"===creditClass["class"]}}function setCartNotificationDefaultText(defaultCompatibleHeplerText){var compatibleNotificationObj={"hideTimer@Delete":"",messageKey:"cart035",messageTimer:7,messageValue:defaultCompatibleHeplerText.Header};tmobNotificationService.notificationList.messages?!tmobNotificationService.notificationList.messages||_.findIndex(tmobNotificationService.notificationList.messages,{messageKey:"cart035"})>-1||tmobNotificationService.notificationList.messages.push(compatibleNotificationObj):tmobNotificationService.notificationList.messages=[compatibleNotificationObj]}function showPendingNotifications(){var cartData=cartStorage.getGlobalSmartCartInfo();if(productDetailsService.model.selectedProductFeatureDetails.showCompatibleNotification)setCartNotificationDefaultText(productDetailsService.model.selectedProductFeatureDetails.defaultCompatibleHeplerText),tmobNotificationService.addNotification.push("cart035"),tmobNotificationService.showNotification(tmobNotificationService.addNotification),productDetailsService.model.selectedProductFeatureDetails.showCompatibleNotification=!1;else{tmobNotificationService.isAbLoaded&&(tmobNotificationService.addNotification.push("cart022"),tmobNotificationService.showNotification(tmobNotificationService.addNotification),tmobNotificationService.isAbLoaded=!1);var persistedSmartCartInfo=cartStorage.getPersistedGlobalSmartCartInfo();if(angular.equals(persistedSmartCartInfo,cartStorage.getGlobalSmartCartInfo())){var EIPSettings=cartStorage.getEIPSettings();EIPSettings&&(vm.isNotifyEIP=EIPSettings.isNotifyEIP,vm.isAccessoryEnabled=EIPSettings.isAccessoryEnabled,cartStorage.setNotificationState(EIPSettings.state))}accessoryEIPNotification(cartStorage.getGlobalSmartCartInfo());var lineItemsHandsetArray=_searchJsonPathArray(cartCommonOperationsService.model.structCartData.lineItems,'[?(@.lineType=="HANDSET")]')||[],lineItemsTabletArray=_searchJsonPathArray(cartCommonOperationsService.model.structCartData.lineItems,'[?(@.lineType=="TABLET")]')||[],lineItemsWearableArray=_searchJsonPathArray(cartCommonOperationsService.model.structCartData.lineItems,'[?(@.lineType=="WEARABLE")]')||[];"phone"===previousState&&1===lineItemsHandsetArray.length&&(lineItemsTabletArray.length>0||lineItemsWearableArray.length>0)?(tmobNotificationService.addNotification.push("cart032"),tmobNotificationService.showNotification(tmobNotificationService.addNotification)):"internet-device"===previousState&&(1===lineItemsTabletArray.length||1===lineItemsWearableArray.length)&&lineItemsHandsetArray.length>0?(tmobNotificationService.addNotification.push("cart031"),tmobNotificationService.showNotification(tmobNotificationService.addNotification)):"internet-device"===previousState&&angular.merge(lineItemsTabletArray,lineItemsWearableArray).length>0&&lineItemsHandsetArray.length>0&&(tmobNotificationService.addNotification.push("cart033"),tmobNotificationService.showNotification(tmobNotificationService.addNotification))}angular.isDefined(cartData)&&angular.isDefined(cartData.lineItems)&&cartData.lineItems.length>1&&cartCommonOperationsService.triggerNotification(cartData)}function getZipCode(){geoLocation.getZipCode().then(function(zipCode){cartStorage.setRecommendedZipCode(zipCode)})}function isValidCart(){try{var pdlData={description:{ctaName:lodash.get(vm.keyValues,"stickyBanner.checkoutButtonText"),assetType:"Button",targetUrl:location.host+"/checkout"}};pdlService.callGenericCTAorLinkEvent(pdlData)}catch(error){$log.error("PDL:: Error while navigating to Checkout from Cart: "+error)}var hcc=cartStorage.getHardCreditCheck();lodash.get(toggleService.model,"toggles.isTPPON",!1)&&hcc&&(tmobNotificationService.addNotification.push("cart036"),tmobNotificationService.notificationKeys.splice(0,tmobNotificationService.notificationKeys.length-1),tmobNotificationService.showNotification(tmobNotificationService.addNotification)),cartCommonOperationsService.model.structCartData.flags.isOrderEligible&&("/checkout"===keyValues.checkoutLink.checkoutRedirectionLink||angular.isUndefined(keyValues.checkoutLink.checkoutRedirectionLink))&&$state.go(CHECKOUT_STATE_NAME),$sessionStorage.checkoutClick="true"}function getAllOfferIdsForDeviceAndTablets(){var offerIdsTablets=lodash.get(vm.authorValue,"rootPage.plpRankOrdering.tabletMiniBrowseOrdering",[]),offerIdsDevices=lodash.get(vm.authorValue,"rootPage.plpRankOrdering.deviceBrowseOrdering",[]),offers=_.concat(offerIdsTablets,offerIdsDevices);return offers}function hideContainer(selectedFamily){cartServicesService.hideContainer(selectedFamily)}function redirectToMainPlpCTAAction(deviceType){if(deviceType&&vm.authorValue.cart.browseToMainPage)switch(deviceType){case cartConstants.DEVICE_TYPE.HANDSET:commonServices.$window.location.href=vm.authorValue.cart.browseToMainPage.mainbrowseHandsetCta;break;case cartConstants.DEVICE_TYPE.TABLET:commonServices.$window.location.href=vm.authorValue.cart.browseToMainPage.mainbrowseTabletCta;break;case cartConstants.DEVICE_TYPE.ACCESSORY:commonServices.$window.location.href=vm.authorValue.cart.browseToMainPage.mainbrowseAccessoryCta;break;case cartConstants.DEVICE_TYPE.WEARABLE:commonServices.$window.location.href=vm.authorValue.cart.browseToMainPage.mainbrowseWearableCta;break;case cartConstants.DEVICE_TYPE.BYOD:commonServices.$window.location.href=vm.authorValue.cart.browseToMainPage.mainbrowseBYODCta}}function isDataSocSelected(protectionPlansLineItems,selectedLine){return angular.isDefined(lodash.find(protectionPlansLineItems,{selected:!0,isDataSoc:!0})||lodash.find(protectionPlansLineItems,{isDataSoc:!0,code:lodash.get(selectedLine,"lineItemDetails.planDetails.planSOCs[0]")}))}function fetchPlanName(){var devicePlans,planData,planType=cartStorage.getPlanIntentCookie();return lodash.get(toggleService.model,"toggles.isPlanIntentEnabled",!1)&&planType&&vm.authorValue.cart.essentials&&vm.authorValue.cart.essentials.devicePlans&&(devicePlans=vm.authorValue.cart.essentials.devicePlans,planData=lodash.find(devicePlans,{planType:planType}),planData&&vm.authorValue.cart.emptyCart&&vm.authorValue.cart.emptyCart.planIntentName)?(vm.authorValue.cart.emptyCart.planIntentName=vm.authorValue.cart.emptyCart.planIntentName.replace("$planName",planData.planName),!0):!1}function cartFooterVoiceText(){return"NY"==cartStorage.getStateCode()?vm.authorValue.cart.footerText.voiceNYLegalText:vm.authorValue.cart.footerText.voiceLegalText}var vm=this;vm.authorValue=globalValue.authorValue;var $document=commonServices.$document,$log=commonServices.$log,_searchJsonPathArray=commonUtils.searchJsonArray,previousState=$rootScope.previousState||"";$sessionStorage.checkoutClick="false",vm.storeauthoring=!1,vm.onPageLoadEvent=!0,vm.lineHeaderText=cartConstants.LINE_HEADER_TEXT,vm.isMobileView=universalMenuDataService.isMobileView(),(lodash.get(toggleService.model,"toggles.digitalToRetail",!1)&&lodash.get(toggleService.model,"toggles.digitalToRetailCart",!1)||lodash.get(toggleService.model,"toggles.d2rWebSaveCart",!1)||lodash.get(toggleService.model,"toggles.d2rRetailSaveCart",!1))&&authorValueService.loadAuthorJson("/bin/authorvalue/content/t-mobile/store-authoring.json").then(function(response){globalValue.authorValue.storeauthoring=response.storeauthoring,globalValue.authorValue.storeauthoring.digitalToRetail&&(vm.storeauthoring=!0)})["catch"](function(error){$log.log("Error getting store author data for digital to retail: "+error)}),$rootScope.$on("cartAccessoryUpdated",function(event,data){cartCommonOperationsService.model.structCartData=data,cartCommonOperationsService.checkStatus(),cartCommonOperationsService.disableCheckoutCTA()}),$rootScope.$on("openBrowseModal",function(event,data){creditCheck("Select Phone",data.selectedLine)}),$rootScope.$on("cart-notifications",function(event,args){angular.equals(cartStorage.getPersistedGlobalSmartCartInfo(),args.cartData)||(cartStorage.setPersistedGlobalSmartCartInfo(args.cartData),lodash.get(toggleService.model,"toggles.isEssentialsEnabled",!1)&&lodash.get(toggleService.model,"toggles.isPlanMgmtEnabled",!1)&&(0===args.cartData.lineItems.length?(cartCommonOperationsService.model.isDeviceDisabled=!1,cartCommonOperationsService.model.isTabetDisabled=!1,cartCommonOperationsService.model.isWearableDisabled=!1):args.cartData.lineItems.length>0&&cartCommonOperationsService.disableProductCta()),accessoryEIPNotification(args.cartData))});var ispfcart=cartCommonOperationsService.model.ispfcart;ispfcart||utils.loadScript("//maps.googleapis.com/maps/api/js?libraries=visualization,places&client=gme-tmobileusa3&channel=smartcart&v=3",getZipCode),vm.isCreditCheckDone=isCreditCheckDone,vm.isCreditCheckDoneForEssentialFlow=isCreditCheckDoneForEssentialFlow,vm.isCreditCheckDoneForNonEssentialFlow=isCreditCheckDoneForNonEssentialFlow,
vm.hideContainer=hideContainer,vm.isValidCart=isValidCart,vm.cartCommonOperationsService=cartCommonOperationsService,vm.cartDevicesService=cartDevicesService,vm.cartServicesService=cartServicesService;var cartSettings=globalConfig.cartSettings,authorValueFlagEnable=globalConfig.authorValueFlagEnable;vm.keyValues=keyValues,vm.authorValue=globalValue.authorValue,vm.cartSettings=cartSettings,vm.showPromoInput=!0,vm.planModalOpen=!1,vm.isPlanAvailable=!0,vm.creditCheck=creditCheck,vm.openCreditClassSelectorModal=openCreditClassSelectorModal,vm.zipCodeCheck=zipCodeCheck,vm.openLearnMoreModal=openLearnMoreModal,vm.openLocationFPOModal=openLocationFPOModal,vm.openOwnPhoneModal=openOwnPhoneModal,vm.openPlanModal=openPlanModal,vm.openExitPathConfirmationModal=openExitPathConfirmationModal,vm.openDeviceProtectionAndServicesSelectorModal=openDeviceProtectionAndServicesSelectorModal,vm.openPriceBreakdownModal=openPriceBreakdownModal,vm.openDeviceSelectorModal=openDeviceSelectorModal,vm.openMiniPDPEditModal=openMiniPDPEditModal,vm.openCheckCompatibilityModal=openCheckCompatibilityModal,vm.openCheckCompatibilityResultModal=openCheckCompatibilityResultModal,vm.openCheckIMEIModal=openCheckIMEIModal,vm.openComparePlanModal=openComparePlanModal,vm.editProductClose=editProductClose,vm.editProduct=editProduct,vm.duplicateLine=duplicateLine,vm.addLine=addLine,vm.addLineByLineType=addLineByLineType,vm.showPendingNotifications=showPendingNotifications,vm.isAccessoryAddedToCart=isAccessoryAddedToCart,vm.showAccessories=showAccessories,vm.userSelectedPlan=userSelectedPlan,vm.redirectCheckout=redirectCheckout,vm.toggleSelectedPlan=toggleSelectedPlan,vm.toggles=toggleService.model.toggles,vm.isBotShopping=!!cartStorage.getFbSessionId(),vm.noCreditSelected=noCreditSelected,vm.isNotifyEIP=!1,vm.isAccessoryEnabled=!1,vm.getAllOfferIdsForDeviceAndTablets=getAllOfferIdsForDeviceAndTablets,vm.isB2B=window.isB2B,vm.productFirstCTAAction=productFirstCTAAction,vm.changePlan=changePlan,vm.redirectToMainPlpCTAAction=redirectToMainPlpCTAAction,vm.addServicesToLine=addServicesToLine,vm.patchDataSoc=patchDataSoc,vm.handleDataSoc=handleDataSoc,vm.isDataSocSelected=isDataSocSelected,vm.manageRatePlanCookie=manageRatePlanCookie,vm.fetchPlanName=fetchPlanName,vm.cartFooterVoiceText=cartFooterVoiceText,initialize()}myCartControllerConstructor.$inject=["$rootScope","$timeout","cartHttpDataService","commonStorage","creditClassService","commonUtils","cartControllerHelperService","CartCommonModal","cartStorage","deviceProtectionAndServicesHttpData","keyValues","globalConfig","globalValue","tmobNotificationService","cartServicesService","cartCommonOperationsService","cartDevicesService","commonServices","productDetailsService","geoLocation","utils","toggleService","$state","CHECKOUT_STATE_NAME","$sessionStorage","deviceTradeInService","authorValueService","cartConstants","miniBrowseDeviceService","accessoriesService","essentialsService","$scope","dataFactory","pdlService","universalMenuDataService","$location"],angular.module("tmobileApp").controller("CartController",myCartControllerConstructor)}(window.angular,window._,externalLogger),function(angular,lodash){"use strict";function sitemapModelService($modal,commonServices,sitemapUtil){function getData(){sitemapUtil.getSitemapData().then(function(response){model.nodes=response.data,model.isNodeDataAvailable=!0,"filtersSitemap"===model.sitemapType&&angular.isObject(model.nodes)&&lodash.forEach(model.nodes,function(value,key){key.indexOf("accessories_")>-1&&(model.nodes.accessories=model.nodes.accessories.concat(model.nodes[key]),delete model.nodes[key])})})}function openSitemapModal(nodeData,key){model.selectedNode=nodeData,model.key=key,angular.isDefined(nodeData)&&(lodash.isNull(model.selectedNode.priority)&&(model.selectedNode.priority=""),lodash.isNull(model.selectedNode.changeFrequency)&&(model.selectedNode.changeFrequency=""));var modalInstance=$modal.open({size:"md",templateUrl:"app/sitemap/sitemapModal/sitemapModal.tpl.html",controller:"SitemapModalController",controllerAs:"vm"});modalInstance.result.then(function(response){$log.log("Here is the response for modalClose",response)},function(err){$log.log("dismiss............",err)})}var $log=commonServices.$log,model={sitemapType:"",nodes:{},key:"",selectedNode:{},isNodeDataAvailable:!1};return{model:model,getData:getData,openSitemapModal:openSitemapModal}}sitemapModelService.$inject=["$modal","commonServices","sitemapUtil"],angular.module("tmobileApp").factory("sitemapModelService",sitemapModelService)}(window.angular,window._),function(angular){"use strict";var moduleName="tmobileApp",componentName="breakdownPromotionDetails",breakdownpromotiondetailscomponentConstructor={templateUrl:"app/cart/breakdown/promotionDetails/breakdownPromotionDetails.html",controller:"BreakdownPromotionDetailsController",controllerAs:"vm",bindings:{promotionData:"=",authorValue:"=",isVersion2:"="}};angular.module(moduleName).component(componentName,breakdownpromotiondetailscomponentConstructor)}(angular),function(angular,externalLogger){"use strict";function configureRouter($stateProvider,APP_ROOT_STATE_NAME){externalLogger.moduleConfigured("tmobileApp","sitemap.js"),$stateProvider.state("root.sitemap",{parent:APP_ROOT_STATE_NAME,url:"/sitemap",views:{main:{templateUrl:"/app/sitemap/components/aemSitemap/aemSitemap.tpl.html",controller:"aemSitemapController as vm"}}}).state("root.store-locator-sitemap",{parent:APP_ROOT_STATE_NAME,url:"/store-locator-sitemap",views:{main:{templateUrl:"/app/sitemap/components/storeSitemap/storeSitemap.tpl.html",controller:"storeSitemapController as vm"}}}).state("root.filters-sitemap",{parent:APP_ROOT_STATE_NAME,url:"/filters-sitemap",views:{main:{templateUrl:"/app/sitemap/components/filtersSitemap/filtersSitemap.tpl.html",controller:"filtersSitemapController as vm"}}})}configureRouter.$inject=["$stateProvider","APP_ROOT_STATE_NAME"],angular.module("tmobileApp").config(configureRouter)}(angular,externalLogger),function(angular){"use strict";var moduleName="tmobileApp",componentName="accessoriesBreakdownDetails",accessoriesbreakdowndetailscomponentConstructor={templateUrl:"app/cart/breakdown/accessoriesBreakdownDetails/accessoriesBreakdownDetails.html",controller:"AccessoriesBreakdownDetailsController as vm",bindings:{cartData:"=",authorValue:"=",sourceType:"<",keyValuePair:"<"}};angular.module(moduleName).component(componentName,accessoriesbreakdowndetailscomponentConstructor)}(angular),function(angular){"use strict";function SitemapModalControllerConstructor($window,$modalInstance){function cancel(){$modalInstance.dismiss()}function mobileView(){return!($window.innerWidth>768)}var vm=this;vm.cancel=cancel,vm.mobileView=mobileView}SitemapModalControllerConstructor.$inject=["$window","$modalInstance"],angular.module("tmobileApp").controller("SitemapModalController",SitemapModalControllerConstructor)}(window.angular),function(angular){"use strict";function botShoppingServiceConstructor(authorization,$rootScope,authTokenManager,coreServices,httpRequestWrapper,globalConfig,cartHttpDataService,cartStorage,$log,apiURLs,tokenTtl,creditClassService,cartCommonOperationsService,checkOutHttpDataUtil){function generateAccessToken(){return authorization.generateToken().then(function(accessTokenResponse){return angular.equals(accessTokenResponse.status,200)&&($rootScope.cookiesExpiresIn=moment().add(accessTokenResponse.data.expires_in,"seconds").toDate(),authTokenManager.setTokenCookies(accessTokenResponse.data,"token",angular.equals(apiURLs.storage,"localStorage"),tokenTtl.token.timetolive)),accessTokenResponse})}function createDefaultCart(){return generateAccessToken().then(function(accessTokenResponse){if(angular.equals(accessTokenResponse.status,200)){var apiURL=coreServices.apiURLs.getDefaultCart,query={creditLevel:"GOOD",ignoreLoadingBar:!0};return httpRequestWrapper.get(apiURL,query,null,!0)}return accessTokenResponse})}function addLineToCart(lineType){var requestBody,itemCode;return itemCode=globalConfig.cartSettings.constants.mockSKUs.addNewLine,requestBody={itemCode:itemCode,selectedCreditLevel:creditClassService.getEPCreditClass()||"GOOD",financeOption:"",subType:lineType||"HANDSET"},cartHttpDataService.addNewLine(requestBody).then(function(cartResponse){return cartResponse.status})}function addProductToLine(lineType,sku){return createDefaultCart().then(function(defaultCartResponse){return angular.equals(defaultCartResponse.status,200)?(cartStorage.setCartId(defaultCartResponse.data.cart.cartId),cartStorage.setOrderId(defaultCartResponse.data.cart.orderId),checkOutHttpDataUtil.createAuditRecords(!0,!1).then(function(auditRecordsResponse){return angular.equals(auditRecordsResponse.status,200)?addLineToCart(lineType).then(function(cartResponseStatus){if(angular.equals(cartResponseStatus,200)){var requestBody={sku:sku,pricingOption:""},selectedLine=cartStorage.getGlobalSmartCartInfo().lineItems[0];return cartHttpDataService.addToLine(requestBody,selectedLine.lineId).then(function(cartResponse){return cartResponse.status})}return $log.log("Bot-Shopping-Flow: Error adding line to cart. Status: ",cartResponseStatus),cartResponseStatus}):($log.log("Bot-Shopping-Flow: Error in the audit-records call. Response: ",auditRecordsResponse),auditRecordsResponse.status)})):($log.log("Bot-Shopping-Flow: Error in the create default cart call. Response: ",defaultCartResponse),defaultCartResponse.status)})}return{addProductToLine:addProductToLine}}botShoppingServiceConstructor.$inject=["authorization","$rootScope","authTokenManager","coreServices","httpRequestWrapper","globalConfig","cartHttpDataService","cartStorage","$log","apiURLs","tokenTtl","creditClassService","cartCommonOperationsService","checkOutHttpDataUtil"],angular.module("tmobileApp").service("botShoppingService",botShoppingServiceConstructor)}(angular),function(angular){"use strict";function sitemapUtilConstructor(httpRequestWrapper,apiService,commonServices){function createServletUrl(sitemapType){url=9e3===$location.port()?"mockdata/sitemap.{{page}}.json":apiService.getURL("getSitemapData")&&apiService.getURL("getSitemapData").url,url=url.replace("{{page}}",sitemapType)}function getSitemapData(){return httpRequestWrapper.get(url)}function postSitemapData(data){return httpRequestWrapper.post(url,data)}function deleteSitemapData(data){var queryParam="?contentPath="+data;return httpRequestWrapper["delete"](url+queryParam)}var url,$location=commonServices.$location;return{getSitemapData:getSitemapData,postSitemapData:postSitemapData,deleteSitemapData:deleteSitemapData,createServletUrl:createServletUrl}}sitemapUtilConstructor.$inject=["httpRequestWrapper","apiService","commonServices"],angular.module("tmobileApp").factory("sitemapUtil",sitemapUtilConstructor)}(window.angular),function(angular){"use strict";function authoredRedirectUrlController(authoredRedirectUrlService,$window,apiURLs){function ignoreClick($event){$event.stopPropagation()}function getData(){authoredRedirectUrlService.getAuthoredRedirectUrlData().then(function(response){vm.data=response.data})}function deleteRedirectNode(actionType,redirectType,contentPath,redirectTarget){function successCallback(){$window.location.reload()}function errorCallback(){}var queryUrl=["contentPath="+contentPath,"actionType="+actionType,"redirectTarget="+redirectTarget,"redirectType="+redirectType].join("&"),url=apiURLs.authoredRedirectURLUpdate+queryUrl;authoredRedirectUrlService.postAuthoredRedirectUrlData(url).then(successCallback,errorCallback)}function showConfirmationMessage(actionType,redirectType,contentPath,redirectTarget){var confirmDelete=$window.confirm("Do you want to delete the redirect?");confirmDelete&&deleteRedirectNode(actionType,redirectType,contentPath,redirectTarget)}var vm=this;vm.oneAtATime=!1,vm.getData=getData,vm.ignoreClick=ignoreClick,vm.showConfirmationMessage=showConfirmationMessage,vm.getData()}authoredRedirectUrlController.$inject=["authoredRedirectUrlService","$window","apiURLs"],angular.module("tmobileApp").controller("authoredRedirectUrlController",authoredRedirectUrlController)}(angular),function(angular){"use strict";var addToCalendar={templateUrl:"app/storeLocator/components/addToCalendar/addToCalendar.tpl.html",controller:"addToCalendarController",controllerAs:"vm",bindings:{}};angular.module("tmobileApp").component("addToCalendar",addToCalendar)}(window.angular),function(angular){"use strict";function serverConfigControllerConstructor(){}angular.module("tmobileApp").controller("serverConfigController",serverConfigControllerConstructor)}(angular),function(angular){"use strict";function addToCalendarController(storeAppointmentUtil,storeLocatorConstants,globalValue){function selectedCalendarChanged(){storeAppointmentUtil.generateURLs(),storeAppointmentUtil.selectedCalendarChanged(vm.selectedCalendar)}var vm=this;vm.authoring=globalValue.authorValue.storeauthoring.appointmentsAndWaitTime,vm.listOfCalendars=storeLocatorConstants.CAL_TYPES,storeAppointmentUtil.generateURLs(),vm.selectedCalendarChanged=selectedCalendarChanged}addToCalendarController.$inject=["storeAppointmentUtil","storeLocatorConstants","globalValue"],angular.module("tmobileApp").controller("addToCalendarController",addToCalendarController)}(window.angular),function(angular){function errorControllerConstructor($stateParams){"use strict";var vm=this;vm.statusCode=$stateParams.statusCode}errorControllerConstructor.$inject=["$stateParams"],angular.module("tmobileCore").controller("ErrorController",errorControllerConstructor)}(angular),function(angular){"use strict";var appointmentConfirmation={templateUrl:"app/storeLocator/components/appointmentConfirmation/appointmentConfirmation.tpl.html",controller:"AppointmentConfirmationController",controllerAs:"vm",bindings:{}};angular.module("tmobileApp").component("appointmentConfirmation",appointmentConfirmation)}(window.angular),function(angular,lodash){"use strict";function extantCartServiceConstructor($rootScope,$log,coreServices,httpRequestWrapper,globalConfig,globalValue,$q,apiService,tokenTtl,authorization,authTokenManager,cartHttpDataService,checkOutHttpDataUtil,cartCommonOperationsService,commonUtils,cartStorage,creditClassService,toggleService,tokenUtils){function getProfileInfo(){var url=coreServices.apiURLs.getProfile;return url=url+"/"+cartStorage.getCartId(),httpRequestWrapper.get(url,null,null,!0)}function getCartData(cartId,key){var urlObect=apiService.getURL("getFullCheckout"),apiURL=urlObect.url;return apiURL=apiURL.replace("{{cartID}}",cartId),getProfileInfo().then(function(profileData){var creditSelector=globalValue.authorValue.cart.creditSelector["class"],creditClass=vm.epToAppMapping[commonUtils.searchJson(profileData.data,"creditLevel")],creditClassObject=_.find(creditSelector,{"class":creditClass});creditClassService.setCreditClass(creditClassObject);var query={creditLevel:creditClassService.getEPCreditClass()||"GOOD"};return httpRequestWrapper.get(apiURL,query,null,!0,"getFullCheckout")})}function generateAccessToken(){return authorization.generateToken().then(function(accessTokenResponse){return angular.equals(accessTokenResponse.status,200)&&($rootScope.cookiesExpiresIn=moment().add(accessTokenResponse.data.expires_in,"seconds").toDate(),authTokenManager.setTokenCookies(accessTokenResponse.data,"token",angular.equals(coreServices.apiURLs.storage,"localStorage"),tokenTtl.token.timetolive)),accessTokenResponse})}function createDefaultCart(){return generateAuthToken().then(function(accessTokenResponse){if(angular.equals(accessTokenResponse.status,200)||angular.equals(accessTokenResponse.status,"done")){var urlObject=apiService.getURL("getDefaultCart"),apiURL=urlObject.url,query={creditLevel:"GOOD",ignoreLoadingBar:!0};return httpRequestWrapper.get(apiURL,query,null,!0,"getDefaultCart")}return accessTokenResponse})}function generateAuthToken(){return lodash.get(toggleService.model,"toggles.isDcpV3ApiEnabled",!1)?tokenUtils.generateJWT():generateAccessToken()}function addLineToCart(lineType){lineType||(lineType="HANDSET");var requestBody,itemCode;return itemCode=globalConfig.cartSettings.constants.mockSKUs.addNewLine,requestBody={itemCode:itemCode,selectedCreditLevel:creditClassService.getEPCreditClass()||"GOOD",financeOption:"",subType:lineType},cartHttpDataService.addNewLine(requestBody).then(function(cartResponse){return cartResponse.status})}function addProductToLine(lineType,sku){return createDefaultCart().then(function(defaultCartResponse){return angular.equals(defaultCartResponse.status,200)?(cartStorage.setCartId(defaultCartResponse.data.cart.cartId),cartStorage.setOrderId(defaultCartResponse.data.cart.orderId),checkOutHttpDataUtil.createAuditRecords(!0,!1).then(function(auditRecordsResponse){return angular.equals(auditRecordsResponse.status,200)?addLineToCart(lineType).then(function(cartResponseStatus){if(angular.equals(cartResponseStatus,200)){var requestBody={sku:sku,pricingOption:""},selectedLine=cartStorage.getGlobalSmartCartInfo().lineItems[0];return cartHttpDataService.addToLine(requestBody,selectedLine.lineId).then(function(cartResponse){return cartResponse.status})}return cartResponseStatus}):auditRecordsResponse.status})):defaultCartResponse.status})}function addConfigCart(cartId,loadCartId){var queryData={cartId:loadCartId,ignoreLoadingBar:!0},followHeader="FALSE";return lodash.get(toggleService.model,"toggles.isDcpV3ApiEnabled",!1)&&(followHeader="TRUE"),cartId?cartHttpDataService.loadCart(queryData,followHeader).then(function(responseData){return angular.equals(responseData.status,200)&&cartCommonOperationsService.updateStructCartData(),responseData}):createDefaultCart().then(function(defaultCartResponse){return angular.equals(defaultCartResponse.status,200)?(cartStorage.setCartId(defaultCartResponse.data.cart.cartId),cartStorage.setOrderId(defaultCartResponse.data.cart.orderId),cartHttpDataService.loadCart(queryData,followHeader).then(function(responseData){return angular.equals(responseData.status,200)&&cartCommonOperationsService.updateStructCartData(),responseData})):defaultCartResponse})}var vm=this;return vm.epToAppMapping=globalConfig.cartSettings.epToAppMapping,vm.getCartData=getCartData,vm.addProductToLine=addProductToLine,vm.addConfigCart=addConfigCart,vm}extantCartServiceConstructor.$inject=["$rootScope","$log","coreServices","httpRequestWrapper","globalConfig","globalValue","$q","apiService","tokenTtl","authorization","authTokenManager","cartHttpDataService","checkOutHttpDataUtil","cartCommonOperationsService","commonUtils","cartStorage","creditClassService","toggleService","tokenUtils"],angular.module("tmobileApp").service("extantCartService",extantCartServiceConstructor)}(angular,_),function(angular,lodash){"use strict";function appointmentConfirmationController($log,storeLocatorModelService,navigationUtil,globalValue,storeAppointmentService,toggleService){var vm=this;vm.model=storeLocatorModelService.model,vm.toggles=toggleService.model.toggles,vm.authoring=globalValue.authorValue.storeauthoring.appointmentsAndWaitTime,vm.authoring.confirmationHeader=vm.model.user.RSVPAppointment?vm.authoring.RSVPconfirmationHeader:vm.authoring.confirmationHeader,vm.header=lodash.isEmpty(vm.authoring.confirmationHeader)?"":vm.authoring.confirmationHeader.replace("@user",vm.model.user.firstName),vm.closeAppointment=storeAppointmentService.closeAppointment,vm.toggles=toggleService.model.toggles,vm.cancelAppointment=storeAppointmentService.getCancelAppointmentModel,vm.rescheduleAppointment=storeAppointmentService.getRescheduleAppointmentModel,vm.navigateToStore=navigationUtil.navigateToStore}appointmentConfirmationController.$inject=["$log","storeLocatorModelService","navigationUtil","globalValue","storeAppointmentService","toggleService"],angular.module("tmobileApp").controller("AppointmentConfirmationController",appointmentConfirmationController)}(window.angular,window._),function(angular){"use strict";function imeiControllerConstructor(toggleService){var vm=this,toggles=toggleService.model.toggles;vm.enableModernizedUNAV=toggles.enableModernizedUNAV}imeiControllerConstructor.$inject=["toggleService"],angular.module("tmobileApp").controller("imeiController",imeiControllerConstructor)}(angular),function(angular){"use strict";var appointmentForm={templateUrl:"app/storeLocator/components/appointmentForm/appointmentForm.tpl.html",controller:"AppointmentFormController",controllerAs:"vm",bindings:{}};angular.module("tmobileApp").component("appointmentForm",appointmentForm)}(window.angular),function(angular){"use strict";function lowerFunnelFactoryConstructor(commonServices){var $window=commonServices.$window,$log=commonServices.$log;return{runFSR:function(){angular.isDefined($window.top.FSR)&&($window.setTimeout($window.top.FSR.run(),500),$log.log(FSR.getStorage("pv"),"FSR.getStorage('pv')"))}}}lowerFunnelFactoryConstructor.$inject=["commonServices"],angular.module("tmobileApp").factory("lowerFunnelFactory",lowerFunnelFactoryConstructor)}(angular),function(angular,lodash,uuid){"use strict";function appointmentFormController($log,storeAppointmentService,genericModalUtil,navigationUtil,checkOutValidationUtil,storeLocatorModelService,pdlService,storeAppointmentUtil,globalValue,storeLocatorConstants,commonServices){function transformAuthorValues(){try{var selectedTimeSlot=vm.model.selectedDateAndDay.timeSlots[vm.model.selectedTimeIndex];vm.model.selectedTimeSlot=selectedTimeSlot;var timeSlotStringLength=selectedTimeSlot.length,dayAndDateString=vm.model.selectedDateAndDay.day.slice(0,3)+", "+vm.model.selectedDateAndDay.date.slice(0,5),timeString=selectedTimeSlot.slice(0,5)+" "+selectedTimeSlot.slice(timeSlotStringLength-2,timeSlotStringLength),fields=["languagePreferenceOptions","customerStatusOptions"];lodash.isEmpty(dateTimeSummary)||(vm.model.dateTimeSummary=dateTimeSummary.replace("@dowAndDate",dayAndDateString).replace("@time",timeString)),fields.forEach(function(field){lodash.isEmpty(vm.model.user[field])&&vm.authoring[field].forEach(function(option){option.isDefault&&(vm.model.user[field]=option.optionLabel)})});var consentFromAuthor=lodash.get(vm.authoring,"userConsent");consentFromAuthor&&(vm.model.user.consentObject=lodash.isArray(consentFromAuthor)?consentFromAuthor[consentFromAuthor.length-1]:consentFromAuthor,vm.model.user.consentObject.consentText=vm.model.user.consentObject.consentText.replace(/\\n/g," "))}catch(ex){$log.error(ex.message)}}function _handleError(){genericModalUtil.openModal().then(function(successResult){$log.log(successResult),navigationUtil.navigateToStore()})}function _reSchedule(){storeLocatorModelService.model.transactionId=uuid.create().toString(),storeAppointmentService.rescheduleAppointment().then(function(response){"success"===response?(vm.model.sectionToDisplay=views.APPOINTMENT_CONFIRMATION,pdlService.setFormCompleteEvent("Appointment Form","","Reason for visit:"+vm.model.user.reason+"| Customer:"+vm.model.user.customerStatusOptions+"| Language:"+vm.model.user.languagePreferenceOptions,storeLocatorModelService.model.transactionId,vm.store.id,"update")):_handleError()},function(error){_handleError()})}function _schedule(){storeLocatorModelService.model.transactionId=uuid.create().toString(),storeAppointmentService.scheduleAppointment().then(function(response){"success"===response?(vm.model.sectionToDisplay=views.APPOINTMENT_CONFIRMATION,pdlService.setFormCompleteEvent("Appointment Form","","Reason for visit:"+vm.model.user.reason+"| Customer:"+vm.model.user.customerStatusOptions+"| Language:"+vm.model.user.languagePreferenceOptions,storeLocatorModelService.model.transactionId,vm.store.id,"new")):genericModalUtil.openModal().then(function(successResult){vm.model.selectedDateIndex=0,vm.model.selectedTimeIndex=null,vm.model.timeSlotsAvailableFor="",successResult===storeLocatorConstants.APPT_FLOWS.NEW?(vm.model.user.appointmentId=vm.model.preExistingAppointment.appointmentId,_reSchedule()):successResult===storeLocatorConstants.APPT_FLOWS.ORIGINAL?(vm.model.user.appointmentId=vm.model.preExistingAppointment.appointmentId,vm.model.dateTimeSummary=vm.model.preExistingAppointment.dateTimeSummary,vm.model.selectedDateAndDay.date=vm.model.preExistingAppointment.startdate,vm.model.selectedTimeSlot=vm.model.preExistingAppointment.starttime,storeAppointmentUtil.generateURLs(),storeAppointmentService.getRelevantStoreDetails().then(function(){lodash.isEmpty(vm.model.store)||(vm.model.showCarouselUp=!1,storeLocatorModelService.createStoreAddress(),vm.model.sectionToDisplay=views.APPOINTMENT_CONFIRMATION)})):successResult===storeLocatorConstants.SECTIONS.STORE_DETAILS&&storeAppointmentService.getRelevantStoreDetails().then(function(){lodash.isEmpty(vm.model.store)||(storeLocatorModelService.createStoreAddress(),navigationUtil.navigateToStore(),vm.model.showCarouselUp=!1)})})},function(error){_handleError()})}function submitAppointmentForm(){var CTAName="Button Click : "+vm.authoring.scheduleAppointmentCTALabel;pdlService.CTAClickEvent(CTAName,"","Appointment Form","Appointment Form",void 0,vm.store.id);var elem=angular.element(".store-locator-container")[0];lodash.isEmpty(elem)||angular.element(".store-locator-container").scrollTop(0),storeAppointmentService.createLead().then(function(response){"success"===response&&(vm.model.isAppointmentRescheduled?_reSchedule():_schedule())},function(){_handleError()})}function changeAppointment(){vm.model.sectionToDisplay=views.TIME_SLOT_SELECTOR}var vm=this,$document=commonServices.$window.document;vm.modalName="Schedule Appointment";var views=storeLocatorConstants.SECTIONS;vm.model=storeLocatorModelService.model,vm.model.user.languagePreferenceOptions||(vm.model.user.languagePreferenceOptions=$document.location.subdomain&&($document.location.subdomain.includes("es.")||"es"===$document.location.subdomain)?"Español":"English"),vm.model.user.consent=!1,vm.store=storeLocatorModelService.model.store,vm.validatePhoneOnChange=checkOutValidationUtil.validatePhoneOnChange,vm.authoring=globalValue.authorValue.storeauthoring.appointmentsAndWaitTime,vm.closeAppointment=storeAppointmentService.closeAppointment;var dateTimeSummary=lodash.get(vm.authoring,"reservationHeaderDateTime",{});vm.model.isAppointmentRescheduled&&(vm.modalName="Modify Appointment Schedule"),transformAuthorValues(),vm.submitAppointmentForm=submitAppointmentForm,vm.changeAppointment=changeAppointment,vm.validatePhoneNumberOnChange=storeLocatorModelService.validatePhoneNumberOnChange,vm._schedule=_schedule,vm._reSchedule=_reSchedule}appointmentFormController.$inject=["$log","storeAppointmentService","genericModalUtil","navigationUtil","checkOutValidationUtil","storeLocatorModelService","pdlService","storeAppointmentUtil","globalValue","storeLocatorConstants","commonServices"],angular.module("tmobileApp").controller("AppointmentFormController",appointmentFormController)}(window.angular,window._,window.UUIDjs),function(angular){"use strict";function articleFilterDropdownController($element,$timeout){function onKeypressDownArrow(){var newIndex=vm.optionsList.indexOf(vm.selectedOption)+1;newIndex<vm.optionsList.length&&vm.onUpdateSelected({id:vm.id,selected:vm.optionsList[newIndex]})}function onKeypressUpArrow(){var newIndex=vm.optionsList.indexOf(vm.selectedOption)-1;newIndex>=0&&vm.onUpdateSelected({id:vm.id,selected:vm.optionsList[newIndex]})}function onKeypressHome(){vm.onUpdateSelected({id:vm.id,selected:vm.optionsList[0]})}function onKeypressEnd(){vm.onUpdateSelected({id:vm.id,selected:vm.optionsList[vm.optionsList.length-1]})}var vm=this;vm.generateID=function(string){var array=new Uint8Array(1);return string.toLowerCase().replace(/\W]/g,"")+Math.floor(window.crypto.getRandomValues(array)/(Math.pow(2,8)-1)*1e9)},vm.enterKeydownBeganOnButton=!1,vm.isOpen=!1,vm.buttonID=vm.generateID(vm.displayMode+"button"),vm.categoryID=vm.generateID(vm.displayMode+vm.category.value),vm.listboxID=vm.generateID(vm.displayMode+"listbox"),vm.isActive=function(option){return option===vm.selectedOption},vm.close=function(){vm.isOpen=!1,$element.find("#"+vm.buttonID).focus()},vm.open=function(){vm.isOpen=!0,$timeout(function(){vm.selectedOption||vm.onUpdateSelected({id:vm.id,selected:vm.optionsList[0]}),$element.find("#"+vm.listboxID).focus()},0)},vm.startCloseDropdownTimer=function(){vm.closeDropdownTimer=$timeout(function(){vm.isOpen=!1},250)},vm.cancelCloseDropdownTimer=function(){$timeout.cancel(vm.closeDropdownTimer)},vm.onButtonClick=function(){vm.isOpen?vm.close():vm.open()},vm.onItemClick=function(option){vm.onUpdateSelected({id:vm.id,selected:option}),vm.close()},vm.onButtonKeydown=function(event){var key=event.which||event.keyCode||0;13===key&&(vm.enterKeydownBeganOnButton=!0)},vm.onListboxKeydown=function(event){var key=event.which||event.keyCode||0;switch(key){case 40:event.preventDefault(),onKeypressDownArrow();break;case 38:event.preventDefault(),onKeypressUpArrow();break;case 32:event.preventDefault();break;case 27:vm.close();break;case 36:event.preventDefault(),onKeypressHome();break;case 35:event.preventDefault(),onKeypressEnd()}},vm.onListboxKeyup=function(event){var key=event.which||event.keyCode||0;switch(key){case 13:vm.enterKeydownBeganOnButton?vm.enterKeydownBeganOnButton=!1:vm.close();break;case 32:vm.close()}}}articleFilterDropdownController.$inject=["$element","$timeout"];var articleFilterDropdownComponent={templateUrl:"app/marketing/components/articleArchive/articleFilterDropdown/articleFilterDropdown.component.tpl.html",controller:articleFilterDropdownController,bindings:{category:"<",displayMode:"@",id:"@",options:"<",optionsList:"<",selectedOption:"@",onUpdateSelected:"&",settings:"<"},controllerAs:"vm"};angular.module("marketingCore").component("articleFilterDropdown",articleFilterDropdownComponent)}(angular),function(angular){"use strict";var appointmentNotFound={templateUrl:"app/storeLocator/components/appointmentNotFound/appointmentNotFound.tpl.html",controller:"appointmentNotFoundController",controllerAs:"vm",bindings:{closeModal:"="}};angular.module("tmobileApp").component("appointmentNotFound",appointmentNotFound)}(window.angular),function(angular){"use strict";function articleTagController(utils,analyticsUtils){var vm=this;this.DEFAULT_TAGS_SHOWN=11,this.numberOfTagsShown=this.DEFAULT_TAGS_SHOWN,this.showToggleButton=this.tagList.length>this.DEFAULT_TAGS_SHOWN,this.tagsExpanded=!1,this.$onInit=function(){this.selectedTag=this.selectedTag||this.tagList[0],this.ctaText=this.settings.content.showMoreButton.collapsed},this.toggleFullTagList=function(event){this.tagsExpanded=!this.tagsExpanded,this.ctaText=this.tagsExpanded?this.settings.content.showMoreButton.expanded:this.settings.content.showMoreButton.collapsed,this.numberOfTagsShown=this.tagsExpanded?this.tagList.length:this.DEFAULT_TAGS_SHOWN},vm.$onChanges=function(){this.selectedTag=vm.selectedTag},vm.triggerAnalytics=function(selectedTag){analyticsUtils.trackArchiveFilterTagClick({ctaName:selectedTag.text,assetType:"Tag",filterName:selectedTag.text,type:"filter"})}}articleTagController.$inject=["utils","analyticsUtils"];var articleTagComponent={controller:articleTagController,templateUrl:"app/marketing/components/articleTags/articleTags.component.tpl.html",bindings:{tagList:"<",settings:"<",onTagSelectionChanged:"&",selectedTag:"<"},controllerAs:"vm"};angular.module("marketingCore").component("articleTags",articleTagComponent)}(angular),function(angular,lodash){"use strict";function appointmentNotFoundController($state,storeLocatorModelService,globalValue,STORE_LOCATOR_STATE_NAME){function submit(){storeLocatorModelService.changeState(),vm.closeModal()}var vm=this;vm.authoring=globalValue.authorValue.storeauthoring.appointmentsAndWaitTime,vm.submit=submit}appointmentNotFoundController.$inject=["$state","storeLocatorModelService","globalValue","STORE_LOCATOR_STATE_NAME"],angular.module("tmobileApp").controller("appointmentNotFoundController",appointmentNotFoundController)}(window.angular,window._),function(angular){"use strict";function coverageMapComponentController($sce,$window){
function parseMapCodes(mapData){var querystring="",keyString="",dataAvailable=!1;if(mapData){mapData.MapCodes=angular.fromJson(mapData.MapCodes),querystring="cc="+(vm.toggleFeature?mapData.isoCode:mapData.CountryCode),mapData.defaultcityview&&(querystring+="&view="+mapData.defaultcityview),mapData.MapCodes.Net1&&(querystring+="&net1="+mapData.MapCodes.Net1,dataAvailable=vm.toggleFeature?mapData.MapCodes.dataAvailableNet1:"true"===mapData.DataAvailable,keyString=dataAvailable?"&key1="+encodeURIComponent(vm.mapDataSet.talkTextDataKey):"&key1="+encodeURIComponent(vm.mapDataSet.talkTextKey)),dataAvailable=vm.toggleFeature?mapData.MapCodes.dataAvailableNet2:"true"===mapData.DataAvailable,mapData.MapCodes.Net2&&dataAvailable&&(querystring+="&net2="+mapData.MapCodes.Net2,keyString+="&key2="+encodeURIComponent(vm.mapDataSet.umtsDataKey));var protocol="http://",pageProtocol=$window.window.location.protocol;-1!==pageProtocol.indexOf("https")&&(protocol="https://"),vm.url=$sce.trustAsResourceUrl(protocol+vm.mapBaseUrl+"?"+querystring+keyString)}}var vm=this;vm.url={},this.$onInit=function(){vm.templateUrl=vm.moduleId+"/common/coverage-map.html"},this.$onChanges=function(changes){vm.toggleFeature&&(vm.url={}),vm.mapData&&(vm.toggleFeature||(vm.mapData=vm.mapData.result[0]),vm.mapData.MapCodes&&parseMapCodes(vm.mapData)),changes.moduleId&&vm.moduleId&&(vm.templateUrl=vm.moduleId+"/common/coverage-map.html")}}coverageMapComponentController.$inject=["$sce","$window"];var coverageMapComponent={template:'<div ng-include="$ctrl.templateUrl"> </div>',controller:coverageMapComponentController,bindings:{moduleId:"@",mapData:"<",mapBaseUrl:"@",mapDataSet:"<",toggleFeature:"<"}};angular.module("marketingCore").component("coverageMap",coverageMapComponent)}(window.angular),function(angular){"use strict";var cancelAppointment={templateUrl:"app/storeLocator/components/cancelAppointment/cancelAppointment.tpl.html",controller:"cancelAppointmentController",controllerAs:"vm",bindings:{dismissModal:"=",closeModal:"="}};angular.module("tmobileApp").component("cancelAppointment",cancelAppointment)}(window.angular),function(angular){"use strict";function SliderController($scope,$location,analyticsUtils){var vm=this;vm.analyticsId=vm.analyticsIdStr?vm.analyticsIdStr:vm.analyticsIdEx;var searchUrl=$location.search();vm.maxLines=Number(vm.max),vm.selectedLine=searchUrl.lines?Number(searchUrl.lines):Number(vm.defaultPlan);var sliderAnalyticsData={eventInfo:{eventAction:"clickToAction",eventType:"click"},attributes:{type:"slider"},eventDescription:{ctaName:vm.selectedLine,assetType:"slider"}};vm.getNumber=function(){return new Array(vm.maxLines)},vm.changePlan=function(index){vm.selectedLine=index+1,vm.slideChange()},vm.slideChange=function(){if($location.search("lines",vm.selectedLine),sliderAnalyticsData.eventDescription.ctaName=vm.selectedLine,analyticsUtils.trackEvent("CLICK_EVENT",vm.analyticsId,sliderAnalyticsData),$scope.$broadcast("setThumbStyles",vm.selectedLine),vm.readPrice)switch(vm.selectedLine){case 1:$scope.$emit("updateSlider",".item-alt-one");break;case 2:$scope.$emit("updateSlider",".item-alt-two");break;case 3:$scope.$emit("updateSlider",".item-alt-three");break;case 4:$scope.$emit("updateSlider",".item-alt-four");break;case 5:$scope.$emit("updateSlider",".item-alt-five")}}}SliderController.$inject=["$scope","$location","analyticsUtils"],angular.module("marketingCore").controller("SliderController",SliderController)}(window.angular),function(angular,lodash){"use strict";function cancelAppointmentController(storeAppointmentService,globalValue,commonServices,storeLocatorModelService){function submit(){storeAppointmentService.cancelAppointment(vm.reasonForCancellation.value).then(function(response){"success"===response&&vm.closeModal("cancellationConfirmed","Cancel Appointment")})}function init(){vm.isSpanish=$document.location.subdomain&&($document.location.subdomain.includes("es.")||"es"===$document.location.subdomain);var reasonMapEnToEs={};vm.isSpanish&&reasons.length&&reasons.forEach(function(res){reasonMapEnToEs[res.reasonEN]=res.reasonES}),storeAppointmentService.getReasons("cancel").then(function(reasonsResponse){vm.reasons=reasonsResponse&&reasonsResponse.map(function(reason){return{name:vm.isSpanish?reasonMapEnToEs[reason]:reason,value:reason}})||[]})}var vm=this,$document=commonServices.$window.document;vm.model=storeLocatorModelService.model,vm.authoring=globalValue.authorValue.storeauthoring.appointmentsAndWaitTime;var reasons=vm.authoring.cancellationReasons||[];vm.submit=submit,init()}cancelAppointmentController.$inject=["storeAppointmentService","globalValue","commonServices","storeLocatorModelService"],angular.module("tmobileApp").controller("cancelAppointmentController",cancelAppointmentController)}(window.angular,window._),function(angular){"use strict";function faqContentController(analyticsUtils,$sce,$location){function expandFaqItems(faqArray){return faqArray.forEach(function(item){item.isOpen=!0})}function callAnalytics(item,data){return item.isOpen?analyticsUtils.trackAccordion("faq",data,"Collapse"):analyticsUtils.trackAccordion("faq",data,"Expand")}var url,vm=this;vm.$onInit=function(){url=$location.url(),vm.toggleFaq=!vm.dynamic},vm.$onChanges=function(){if(vm.settings.buttonCtaType||(vm.settings.buttonCtaType="link"),url.match("#")){var accordionId=url.split("#")[1];accordionId===vm.settings.moduleId&&vm.dynamic&&("one-column"===vm.settings.columns&&(expandFaqItems(vm.settings.fullFaqItems),expandFaqItems(vm.settings.initialFaqItems)),"two-column"===vm.settings.columns&&(expandFaqItems(vm.settings.fullLeftFaqItems),expandFaqItems(vm.settings.fullRightFaqItems),expandFaqItems(vm.settings.leftInitialFaqItems),expandFaqItems(vm.settings.rightInitialFaqItems))),accordionId!==vm.settings.moduleId||vm.dynamic||("one-column"===vm.settings.columns&&expandFaqItems(vm.settings.fullFaqItems),"two-column"===vm.settings.columns&&(expandFaqItems(vm.settings.fullLeftFaqItems),expandFaqItems(vm.settings.fullRightFaqItems)))}},vm.onClick=function(item,data){callAnalytics(item,data)},vm.trustHtml=function(value){return $sce.trustAsHtml(value)}}faqContentController.$inject=["analyticsUtils","$sce","$location"];var faqContentComponent={templateUrl:"app/marketing/components/faqContent/faqContent.component.tpl.html",controller:faqContentController,bindings:{settings:"<",dynamic:"<",isntm:"<"},controllerAs:"vm"};angular.module("marketingCore").component("faqContent",faqContentComponent)}(angular),function(angular){"use strict";var cancelAppointmentConfirmation={templateUrl:"app/storeLocator/components/cancelAppointmentConfirmation/cancelAppointmentConfirmation.tpl.html",controller:"cancelAppointmentConfirmationController",controllerAs:"vm",bindings:{}};angular.module("tmobileApp").component("cancelAppointmentConfirmation",cancelAppointmentConfirmation)}(window.angular),function(angular){"use strict";function imageComparisonSliderController($window,$element,$scope,analyticsUtils){function getSeparatorStyle(){return vm.isVerticallySplit?{left:vm.separatorPositionPercentage}:{top:vm.separatorPositionPercentage}}function getBeforeFigureStyle(){return vm.isVerticallySplit?{width:vm.separatorPositionPercentage}:{height:vm.separatorPositionPercentage}}function getAfterCaptionStyle(){return vm.isVerticallySplit&&"left"===vm.settings.after.caption.alignment.x?{left:vm.separatorPositionPercentage}:vm.isVerticallySplit||"top"!==vm.settings.after.caption.alignment.y?!1:{top:vm.separatorPositionPercentage}}var vm=this,arrowKeyMovementRate=10,pageKeyMovementRate=25;vm.separatorPosition=vm.settings.initialSeparatorPosition||50,vm.draggingSeparator=!1,vm.isVerticallySplit="vertical"===vm.settings.separatorOrientation,vm.clientAxis=vm.isVerticallySplit?"clientX":"clientY",vm.componentOffsetDimension=vm.isVerticallySplit?"offsetWidth":"offsetHeight",vm.separatorOrientationClass="separator-orientation-"+vm.settings.separatorOrientation,vm.updateComputedValuesForSeparatorPosition=function(){vm.separatorPositionPercentage=vm.separatorPosition+"%",vm.separatorPositionRounded=Math.round(vm.separatorPosition),vm.separatorStyle=getSeparatorStyle(),vm.beforeFigureStyle=getBeforeFigureStyle(),vm.afterCaptionStyle=getAfterCaptionStyle()},vm.startDraggingSeparator=function(event){event.preventDefault(),vm.draggingSeparator=!0},vm.conditionallyRestartDrag=function(event){event.buttons&&vm.startDraggingSeparator(event)},vm.stopDraggingSeparator=function(){vm.draggingSeparator=!1},vm.getCursorOffset=function(event){var offset;return offset=event.touches?event.touches[0][vm.clientAxis]:event.originalEvent&&event.originalEvent.touches?event.originalEvent.touches[0][vm.clientAxis]:event[vm.clientAxis],offset-vm.componentOffset},vm.getComponentOffset=function(){const boundingRectangle=$element[0].getBoundingClientRect();vm.componentOffset=vm.isVerticallySplit?boundingRectangle.left:boundingRectangle.top},vm.getComponentSize=function(event){return event.currentTarget[vm.componentOffsetDimension]},vm.dragSeparator=function(event){if(vm.draggingSeparator){var cursorOffset=vm.getCursorOffset(event),componentSize=vm.getComponentSize(event),newPosition=cursorOffset/componentSize*100;vm.placeSeparatorAt(newPosition)}},vm.placeSeparatorAt=function(proposedPosition){var newPosition=proposedPosition;proposedPosition>100&&(newPosition=100),0>proposedPosition&&(newPosition=0),vm.separatorPosition=newPosition,vm.updateComputedValuesForSeparatorPosition()},vm.onKeydown=function(event){var key=event.which||event.keyCode;switch(key){case 33:event.preventDefault(),vm.nudgeSeparatorBackward(pageKeyMovementRate);break;case 34:event.preventDefault(),vm.nudgeSeparatorForward(pageKeyMovementRate);break;case 35:event.preventDefault(),vm.placeSeparatorAt(100);break;case 36:event.preventDefault(),vm.placeSeparatorAt(0);break;case 37:vm.isVerticallySplit&&vm.nudgeSeparatorBackward(arrowKeyMovementRate);break;case 39:vm.isVerticallySplit&&vm.nudgeSeparatorForward(arrowKeyMovementRate);break;case 38:vm.isVerticallySplit||(event.preventDefault(),vm.nudgeSeparatorBackward(arrowKeyMovementRate));break;case 40:vm.isVerticallySplit||(event.preventDefault(),vm.nudgeSeparatorForward(arrowKeyMovementRate))}},vm.nudgeSeparatorBackward=function(amount){vm.placeSeparatorAt(vm.separatorPosition-amount)},vm.nudgeSeparatorForward=function(amount){vm.placeSeparatorAt(vm.separatorPosition+amount)},vm.reportComponentTouched=function(){var payload={attributes:{type:"slider"},eventInfo:{eventAction:"click",eventType:"clickToAction"},eventDescription:{assetType:"slider",ctaName:vm.settings.analytics.engagementActionTitle,dataAnalyticsID:vm.settings.analytics.analyticsId,icid:vm.settings.analytics.icid}};analyticsUtils.trackEvent($window.CLICK_EVENT,vm.settings.analytics.analyticsId,payload)},vm.watchForUserInteraction=function(){var removeTouchWatcher=$scope.$watch(function(){return vm.separatorPosition},function(newValue,oldValue){newValue!==oldValue&&(vm.reportComponentTouched(),removeTouchWatcher())})},vm.$onInit=function(){vm.updateComputedValuesForSeparatorPosition(),vm.getComponentOffset(),vm.watchForUserInteraction(),$window.addEventListener("resize",vm.getComponentOffset),$window.addEventListener("scroll",vm.getComponentOffset)},vm.$onDestroy=function(){$window.removeEventListener("resize",vm.getComponentOffset),$window.removeEventListener("scroll",vm.getComponentOffset)}}imageComparisonSliderController.$inject=["$window","$element","$scope","analyticsUtils"];var imageComparisonSliderComponent={templateUrl:"app/marketing/components/imageComparisonSlider/imageComparisonSlider.component.tpl.html",controller:imageComparisonSliderController,controllerAs:"vm",bindings:{settings:"<"}};angular.module("marketingCore").component("imageComparisonSlider",imageComparisonSliderComponent)}(angular),function(angular){"use strict";function cancelAppointmentConfirmationController(storeLocatorModelService,storeLocatorConstants,globalValue,storeAppointmentService,commonServices){function navigateBackToStore(){var stateParams={state:$stateParams.state,city:$stateParams.city,storeName:$stateParams.storeName};storeLocatorModelService.changeState(stateParams,!1,!1,!1,!0),vm.model.sectionToDisplay=storeLocatorConstants.SECTIONS.STORE_DETAILS}function findANewStore(){storeLocatorModelService.backToSearchResult()}var vm=this;vm.model=storeLocatorModelService.model,vm.authoring=globalValue.authorValue.storeauthoring.appointmentsAndWaitTime,vm.closeAppointment=storeAppointmentService.closeAppointment;var $stateParams=commonServices.$stateParams;vm.navigateBackToStore=navigateBackToStore,vm.findANewStore=findANewStore}cancelAppointmentConfirmationController.$inject=["storeLocatorModelService","storeLocatorConstants","globalValue","storeAppointmentService","commonServices"],angular.module("tmobileApp").controller("cancelAppointmentConfirmationController",cancelAppointmentConfirmationController)}(window.angular),function(angular){"use strict";var msisdnPortabilityComponent={templateUrl:"app/marketing/components/msisdnPortability/msisdnPortability.component.tpl.html",controller:"MsisdnPortabilityController",controllerAs:"vm",bindings:{moduleId:"@",settingsJson:"@",mobileNumber:"@",invalidPhoneErrorMsg:"@",checkeligibility:"@",captchaHeader:"@",captchaDesc:"@",submitLabel:"@",eligibilityTableHeader:"@",userResultTextYes:"@",userResultTextNoTmobileNum:"@",userResultTextNoNotTmobileNum:"@",eligibilityNote:"@",checkAnotherNumberLabel:"@",apiErrorMsg:"@",checkAnotherNumberLabelIcid:"@",checkEligibilityIcid:"@",analyticsId:"@",codes:"@",siteId:"@"}};angular.module("marketingCore").component("msisdnPortabilityComponent",msisdnPortabilityComponent)}(window.angular),function(angular){"use strict";var carouselCard={templateUrl:"app/storeLocator/components/carouselCard/carouselCard.tpl.html",controller:"CarouselCardController",controllerAs:"vm",bindings:{store:"<",index:"@"}};angular.module("tmobileApp").component("carouselCard",carouselCard)}(window.angular),function(angular){"use strict";var noResultsFoundComponent={templateUrl:"app/marketing/components/noResultsFound/noResultsFound.component.tpl.html",bindings:{message:"@",link:"<"},controllerAs:"vm"};angular.module("marketingCore").component("noResultsFound",noResultsFoundComponent)}(angular),function(angular,lodash){"use strict";function CarouselCardController(mapUtil,storeLocatorModelService,commonServices,storeLocatorUtil,storeLocatorConstants,globalValue,toggleService,pdlService){function mouseClickDetector(event){clickType=storeLocatorConstants.MOUSE_EVENTS.LEFT,event.which?(3===event.which&&(clickType=storeLocatorConstants.MOUSE_EVENTS.RIGHT),2===event.which&&(clickType=storeLocatorConstants.MOUSE_EVENTS.MIDDLE)):event.button&&(2===event.button&&(clickType=storeLocatorConstants.MOUSE_EVENTS.RIGHT),4===event.button&&(clickType=storeLocatorConstants.MOUSE_EVENTS.MIDDLE))}function onInfoBoxMouseEnter(){mapUtil.selectMarkerWithHtml(0,!1,!1,null),mapUtil.selectMarkerWithHtml(vm.index,!0,!0,null)}function onInfoBoxMouseLeave(){mapUtil.selectMarkerWithHtml(vm.index,!1,!1,null)}function onInfoBoxMouseup(eve){if(clickType===storeLocatorConstants.MOUSE_EVENTS.LEFT){var store=vm.model.storeList[vm.index],stateRouteConfig=storeLocatorModelService.setStateConfig(vm.store),targetUrl=commonServices.$location.path()+"/"+stateRouteConfig.state+"/"+stateRouteConfig.city+"/"+stateRouteConfig.storeName;vm.xInfoBox===eve.clientX?(store.click="Info Box",vm.model.ignoreLoadingBar=!0,storeLocatorUtil.showStoreDetail(store,vm.index),pdlService.CTANavOrClickEvent(vm.store.name,targetUrl,!0,"Carousel")):pdlService.CTANavOrClickEvent(vm.store.name,targetUrl,!1,"Carousel")}}function onInfoBoxMousedown(eve){mouseClickDetector(eve),vm.xInfoBox=eve.clientX}var vm=this;vm.appointmentMessage=globalValue.authorValue.storeauthoring.appointmentsAndWaitTime.appointmentsMessage,vm.model=storeLocatorModelService.model,vm.toggles=toggleService.model.toggles,vm.store.name=storeLocatorUtil.toSentenceCase(vm.store.name),vm.store.location.address.streetAddress=storeLocatorUtil.toSentenceCase(vm.store.location.address.streetAddress),vm.store.location.address.addressLocality=storeLocatorUtil.toSentenceCase(vm.store.location.address.addressLocality),vm.currentPage=storeLocatorUtil.getCurrentPage(),vm.store.tprStore=lodash.get(globalValue.authorValue.storeauthoring.generalAuthoringStores,"tprStoreTag",""),vm.store.authDealer=lodash.get(globalValue.authorValue.storeauthoring.generalAuthoringStores,"authDealerTag",""),vm.store.tmobileStoreTag=lodash.get(globalValue.authorValue.storeauthoring.generalAuthoringStores,"tmobileStoreTag",""),vm.store.tmobileSignatureStoreTag=lodash.get(globalValue.authorValue.storeauthoring.generalAuthoringStores,"tmobileSignatureStoreTag",""),vm.store.tmobileExperienceStore=lodash.get(globalValue.authorValue.storeauthoring.generalAuthoringStores,"tmobileExperienceStore",""),vm.store.tmobileSignatureStoreInfoBoxIcon=lodash.get(globalValue.authorValue.storeauthoring.generalAuthoringStores,"tmobileSignatureStoreInfoboxIcon",""),vm.storeType,vm.isSprintOnlyStore=!1,vm.isDualStore=!1,vm.storeServeText=vm.toggles.storeServeTextEnabled?storeLocatorModelService.getStoreServeText(vm.store):void 0;var clickType,tmobileSprintRetailStoreTag=lodash.get(globalValue.authorValue.storeauthoring.generalAuthoringStores,"tmobileSprintRetailStoreTag",""),sprintRetailStoreTag=lodash.get(globalValue.authorValue.storeauthoring.generalAuthoringStores,"sprintRetailStoreTag",""),sprintRetailRepairStoreTag=lodash.get(globalValue.authorValue.storeauthoring.generalAuthoringStores,"sprintRetailRepairStoreTag",""),tmobileSprintRetailRepairStoreTag=lodash.get(globalValue.authorValue.storeauthoring.generalAuthoringStores,"tmobileSprintRetailRepairStoreTag",""),tmobileRepairStoreTag=lodash.get(globalValue.authorValue.storeauthoring.generalAuthoringStores,"tmobileRepairStoreTag","T-Mobile Store- Repair center"),sprintAuthorizedRetailRepairStoreTag=lodash.get(globalValue.authorValue.storeauthoring.generalAuthoringStores,"sprintAuthorizedRetailRepairStoreTag",""),sprintAuthorizedRetailStoreTag=lodash.get(globalValue.authorValue.storeauthoring.generalAuthoringStores,"sprintAuthorizedRetailStoreTag",""),tmobileSprintAuthorizedRetailRepairStoreTag=lodash.get(globalValue.authorValue.storeauthoring.generalAuthoringStores,"tmobileSprintAuthorizedRetailRepairStoreTag",""),tmobileSprintAuthorizedRetailStoreTag=lodash.get(globalValue.authorValue.storeauthoring.generalAuthoringStores,"tmobileSprintAuthorizedRetailStoreTag",""),tprRepairStoreTag=lodash.get(globalValue.authorValue.storeauthoring.generalAuthoringStores,"tprRepairStoreTag","");lodash.get(toggleService.model,"toggles.isSprintStoresEnabled",!1)&&"RETAIL"===vm.store.type&&("(FPR)First Party Retail"===vm.store.storeDefinition?vm.store.hasSprintStack&&!vm.store.hasTmobileStack?(vm.isSprintOnlyStore=!0,vm.storeType=vm.store.deviceRepair?sprintRetailRepairStoreTag:sprintRetailStoreTag):vm.store.hasSprintStack&&vm.store.hasTmobileStack?(vm.isDualStore=!0,vm.storeType=vm.store.deviceRepair?tmobileSprintRetailRepairStoreTag:tmobileSprintRetailStoreTag):vm.storeType=vm.store.deviceRepair?tmobileRepairStoreTag:vm.store.tmobileStoreTag:"(TPR)Third Party Retail"===vm.store.storeDefinition&&(vm.store.hasSprintStack&&!vm.store.hasTmobileStack?(vm.isSprintOnlyStore=!0,vm.storeType=vm.store.deviceRepair?sprintAuthorizedRetailRepairStoreTag:sprintAuthorizedRetailStoreTag):vm.store.hasSprintStack&&vm.store.hasTmobileStack?(vm.isDualStore=!0,vm.storeType=vm.store.deviceRepair?tmobileSprintAuthorizedRetailRepairStoreTag:tmobileSprintAuthorizedRetailStoreTag):vm.storeType=vm.store.deviceRepair?tprRepairStoreTag:vm.store.tprStore)),vm.onInfoBoxMouseEnter=onInfoBoxMouseEnter,vm.onInfoBoxMouseLeave=onInfoBoxMouseLeave,vm.onInfoBoxMouseup=onInfoBoxMouseup,vm.onInfoBoxMousedown=onInfoBoxMousedown}CarouselCardController.$inject=["mapUtil","storeLocatorModelService","commonServices","storeLocatorUtil","storeLocatorConstants","globalValue","toggleService","pdlService"],angular.module("tmobileApp").controller("CarouselCardController",CarouselCardController)}(window.angular,window._),function(angular){"use strict";function productPreRegisterNtmController($scope,$window,$cookies,$log,$anchorScroll,selligentUtils){var vm=this;vm.analyticsID=vm.settings.basic.analyticsId,vm.authToken=vm.settings.authToken,vm.productPreRegisterForm=vm.settings.basic.moduleId+"-productPreRegisterForm",vm.firstName=vm.settings.formFields.firstNameValue,vm.lastName=vm.settings.formFields.lastNameValue,vm.email=vm.settings.formFields.emailValue,vm.phone=vm.settings.formFields.phoneValue,vm.zip=vm.settings.formFields.zipCodeValue,vm.carrier="",vm.currentCarrier="",vm.isExistingCustomer=0,vm.lang=$cookies.get("MP_LANG")||"en",vm.isSendingData=!1,vm.eventType=vm.settings.selligentData.type,vm.formattedNumber="",vm.hasServerError=!1,vm.optEmail=1===vm.settings.formFields.optinDefault?!0:!1,vm.isPhoneRequired=vm.settings.formFields.nonCustPhoneEnabled&&vm.settings.formFields.nonCustPhoneRequired?!0:!1,vm.showPhone=vm.settings.formFields.nonCustPhoneEnabled?!0:!1,vm.currentCarrierEnabled="carrier"===vm.settings.formFields.customerStatus?!0:!1,vm.view="",vm.views={CAPTURE_PRE_REG:"capturePreReg",CONFIRM_SUBMISSION:"confirmSubmission"},vm.$onInit=function(){vm.view=vm.views.CAPTURE_PRE_REG},vm.scrollToTop=function(id){$anchorScroll(id)},vm.splitCarrier=function(){if(vm.carrier){var result=vm.carrier;result=result.split(","),vm.currentCarrier=result[0],vm.isExistingCustomer=0===parseInt(result[1])?1:0}},vm.carrierOnChange=function(){vm.splitCarrier(),vm.settings.formFields.nonCustPhoneEnabled&&1===vm.isExistingCustomer||vm.settings.formFields.nonCustPhoneEnabled&&1!==vm.isExistingCustomer||!vm.settings.formFields.nonCustPhoneEnabled&&1===vm.isExistingCustomer?vm.showPhone=!0:vm.showPhone=!1,1===vm.isExistingCustomer||vm.settings.formFields.nonCustPhoneRequired?vm.isPhoneRequired=!0:vm.isPhoneRequired=!1},vm.formatPhoneNumber=function(phoneNumberString){if(vm.formattedNumber=vm.phone,!phoneNumberString)return"";var cleaned=(""+phoneNumberString).replace(/\D/g,""),match=cleaned.match(/^(\d{3})(\d{3})(\d{4})$/);return match&&(vm.formattedNumber="("+match[1]+") "+match[2]+"-"+match[3]),vm.formattedNumber},vm.preRegSubmission=function(form){if(vm.splitCarrier(),vm.createDeviceCarrierJson(),vm.hasServerError=!1,!vm.isSendingData)if(vm.submitted=!0,form.$valid)vm.isSendingData=!0,"eventRouter"===vm.eventType?vm.createEventRouterPayload():"both"===vm.eventType?(vm.createEventRouterPayload(),vm.createSelligentPayload()):vm.createSelligentPayload();else{var errId="#"+vm.settings.basic.moduleId+" .mat-form-field .ng-invalid";angular.element(errId).first().focus(),$scope.$broadcast("valid",!1)}},vm.createDeviceCarrierJson=function(){var temp={};return vm.currentCarrierEnabled&&(temp[vm.settings.formFields.carriersSelection.currentCarrierName]=vm.currentCarrier),vm.settings.formFields.dynamicFields.first.firstCutomFieldEnabled&&(temp[vm.settings.formFields.dynamicFields.first.firstCustomFieldName]=vm.customSelect1),vm.settings.formFields.dynamicFields.second.secondCutomFieldEnabled&&(temp[vm.settings.formFields.dynamicFields.second.secondCustomFieldName]=vm.customSelect2),vm.settings.formFields.dynamicFields.third.thirdCutomFieldEnabled&&(temp[vm.settings.formFields.dynamicFields.third.thirdCustomFieldName]=vm.customSelect3),vm.deviceCarrierJson=temp},vm.createEventRouterPayload=function(){var locationUrl=$window.location.href,index=locationUrl.indexOf("?"),noQueryLocationUrl=locationUrl;-1!==index&&(noQueryLocationUrl=locationUrl.slice(0,index));var time=(new Date).toISOString(),eventRouterPayload={leadb2cmktEvents:[{middleName:"Not Applicable",birthDate:"Not Applicable",prefix:"Not Applicable",selectedCreditClass:"Not Applicable",currentCarrier:"Not Applicable",currentNumberOfLines:"Not Applicable",interestedNumberOfLines:"Not Applicable",interestedAccessories:"Not Applicable",interestedDevice:"Not Applicable",address1:"Not Applicable",address2:"Not Applicable",city:"Not Applicable",country:"Not Applicable",state:"Not Applicable",addressType:"Not Applicable",languagePreference:"Not Applicable",contactPreferenceMail:"Not Applicable",contactPreferenceEmail:"Not Applicable",contactPreferenceCall:"Not Applicable",contactPreferenceSms:"Not Applicable",source:"Web",webformUrl:noQueryLocationUrl,webformSubmissionTime:time,webformName:vm.settings.formFields.project,webformLanguage:vm.lang,testIndicator:vm.settings.testIndicator===!1?"N":"Y",firstName:vm.firstName?vm.firstName:"Not Applicable",lastName:vm.lastName?vm.lastName:"Not Applicable",existingCustomerFlag:"currentCustomer"===vm.settings.formFields.customerStatus?"Y":1===vm.isExistingCustomer?"Y":"N",primaryEmailAddress:vm.email?vm.email:"Not Applicable",primaryPhoneNumber:vm.phone?vm.phone:"Not Applicable",zipcode:vm.zip?vm.zip:"Not Applicable",marketingCommunicationOptIn:vm.optEmail===!1?"N":"Y",audience:"Consumer",destination:"CRM",recordId:UUIDjs.create(4).toString(),keys:[]}]};eventRouterPayload.leadb2cmktEvents[0].keys.push(vm.deviceCarrierJson),selligentUtils.createSelligentLead(vm.settings.authToken,eventRouterPayload,"eventRouter",vm.settings.selligentData.eventRoutingServiceUrl).then(vm.onSuccessSelligent,vm.onErrorSelligent)},vm.createSelligentPayload=function(){var locationUrl=$window.location.href,noQueryLocationUrl=locationUrl.slice(0,locationUrl.indexOf("?")),sellPayload={config:"prereg",operation:vm.settings.selligentData.operation,userData:{Mail:vm.email?vm.email:"",PHONE_NUMBER:vm.phone?""+vm.phone.replace(/[- .●)(]/g,""):"",ZIP:vm.zip?""+vm.zip:"",FIRST_NAME:vm.firstName?vm.firstName:"",NAME:vm.lastName?vm.lastName:"",CUSTOMER:"currentCustomer"===vm.settings.formFields.customerStatus?1:vm.isExistingCustomer,LANGUAGE:vm.lang,SUBSCRIBE_SOURCE:"Web"},triggerData:{},campaignData:{ACTIONID:"13",ACTIONCODE:"PREREG",PROJECT:vm.settings.formFields.project,MANUFACTURER:vm.settings.formFields.manufacturer,CODENAME:vm.settings.formFields.codename,OPTINTOMAINMARKETINGMAILS:vm.optEmail===!0?1:0,TEXT_OF_OPTIN_AGRMT:vm.settings.formFields.optInText?vm.settings.formFields.optInText:"Id like to receive  emails from T-Mobile",LEAD_CAPTURE_LOCATION:noQueryLocationUrl,MARKETING_PROGRAM:"Consumer"}};_.merge(sellPayload.campaignData,vm.deviceCarrierJson),_.merge(sellPayload.triggerData,vm.settings.selligentData.triggerData),_.merge(sellPayload.campaignData,vm.settings.selligentData.campaignData),selligentUtils.createSelligentLead(vm.settings.authToken,sellPayload,"selligent",vm.settings.selligentData.selligentServiceURL).then(vm.onSuccessSelligent,vm.onErrorSelligent)},vm.onSuccessSelligent=function(response){$scope.$broadcast("valid",!0),vm.hasServerError=!1,vm.response=response.data,vm.productPreRegisterForm.$setPristine(),vm.productPreRegisterForm.$setUntouched(),vm.view=vm.views.CONFIRM_SUBMISSION,vm.isSendingData=!1},vm.onErrorSelligent=function(response){vm.hasServerError=!0,$log.error("error selligent call",response),$scope.$broadcast("valid",!1),vm.isSendingData=!1}}productPreRegisterNtmController.$inject=["$scope","$window","$cookies","$log","$anchorScroll","selligentUtils"];var productPreRegisterNtmComponent={templateUrl:"app/marketing/components/productPreRegisterNtm/productPreRegisterNtm.component.tpl.html",controller:productPreRegisterNtmController,bindings:{settings:"<"},controllerAs:"vm"};angular.module("marketingCore").component("productPreRegisterNtm",productPreRegisterNtmComponent)}(angular),function(angular){"use strict";var concurrentAppointment={templateUrl:"app/storeLocator/components/concurrentAppointmentModal/concurrentAppointmentModal.tpl.html",controller:"concurrentAppointmentModalController",controllerAs:"vm",bindings:{closeModal:"="}};angular.module("tmobileApp").component("concurrentAppointment",concurrentAppointment)}(window.angular),function(angular){"use strict";function tmoBlasterController($document,utils,analyticsUtils){var vm=this;vm.$onInit=function(){vm.gameScreen="1"},vm.trackNextScreen=function(){var evt={eventInfo:{eventAction:"click",eventType:"clickToAction"},category:{eventCategory:"game_scrn_click"},eventDescription:{dataAnalyticsID:vm.settings.config.analyticsID,assetType:"Button",ctaName:"Next",screen:"screen2",modalName:"Vertical Shmup Game"}};analyticsUtils.trackEvent("CLICK_EVENT",vm.settings.config.analyticsID,evt)},vm.trackPlay=function(){var evt={eventInfo:{eventAction:"click",eventType:"clickToAction"},category:{eventCategory:"game_scrn_click"},eventDescription:{dataAnalyticsID:vm.settings.config.analyticsID,ctaName:"Start",assetType:"Button",screen:"screen3",modalName:"Vertical Shmup Game"},tool:{stage:"start",name:"Vertical Shmup"}};analyticsUtils.trackEvent("CLICK_EVENT",vm.settings.config.analyticsID,evt)},vm.loadGame=function(){var canvasContainer=$document[0].getElementById("blaster-canvas-container");"evergreen"===vm.settings.display.displayAs?utils.loadScript("/etc/clientlibs/t-mobile/publish/app/angular_app/assets/images/marketing/tmo-blaster/script/tmo-blaster.js",null,canvasContainer):utils.loadScript("/etc/clientlibs/t-mobile/publish/app/angular_app/assets/images/marketing/tmo-blaster/script/tmo-blaster-holiday.js",null,canvasContainer)},vm.trackReplay=function(){var evt={eventInfo:{eventAction:"click",eventType:"clickToAction"},category:{eventCategory:"game_scrn_click"},eventDescription:{dataAnalyticsID:vm.settings.config.analyticsID,assetType:"Button",ctaName:"Replay",screen:"screen5",modalName:"Vertical Shmup Game"}};analyticsUtils.trackEvent("CLICK_EVENT",vm.settings.config.analyticsID,evt)},vm.trackOutboundLink=function(){var evt={eventInfo:{eventAction:"click",eventType:"clickToNavigate"},category:{eventCategory:"game_scrn_click"},eventDescription:{dataAnalyticsID:vm.settings.config.analyticsID,targetUrl:"https://www.t-mobile.com/offers/t-mobile-tuesdays",assetType:"Link",ctaName:"Check it out",screen:"screen5",modalName:"Vertical Shmup Game"}};analyticsUtils.trackEvent("CLICK_EVENT",vm.settings.config.analyticsID,evt)}}tmoBlasterController.$inject=["$document","utils","analyticsUtils"];var tmoBlasterComponent={controller:tmoBlasterController,templateUrl:"app/marketing/components/tmoBlasterGame/tmoBlaster.component.tpl.html",bindings:{settings:"<"},controllerAs:"vm"};angular.module("marketingCore").component("tmoBlaster",tmoBlasterComponent)}(angular),function(angular,lodash){"use strict";function concurrentAppointmentModalController(globalValue){var vm=this;vm.authoring=globalValue.authorValue.storeauthoring.appointmentsAndWaitTime}concurrentAppointmentModalController.$inject=["globalValue"],angular.module("tmobileApp").controller("concurrentAppointmentModalController",concurrentAppointmentModalController)}(window.angular,window._),function(angular){"use strict";function AddLineController($scope,$window,$location,$timeout,$log,analyticsUtils,salesforceUtils,selligentUtils){function onInit(data){settings=data,vm.aal.visibleScreen="one",vm.aal.serverError=!1,vm.aal.user=getUser(),vm.aal.user&&(vm.formData.emailUser=vm.aal.user.email,vm.aal.user.phone=formatPhone(vm.aal.user.phone)),vm.aal.devices=["phones","tablets","wearables","hotspots","ownDevices","other"],vm.aal.selectedDevices=[],vm.aal.init=!0,$timeout(function(){trackPageLoad("Select Lines")},0)}function onclickScreenOneNextButton(){vm.aal.visibleScreen="two",digitalData&&digitalData.page&&digitalData.page.pageInfo&&(digitalData.page.pageInfo.transactionType="VIP AAL"),trackClick("Next",vm.formData.lines),trackPageLoad("Select Devices")}function onclickScreenTwoBackButton(){vm.aal.visibleScreen="one",trackClick("Back",vm.aal.selectedDevices.join("|")),trackPageLoad("Select Lines")}function onclickScreenTwoNextButton(){vm.aal.visibleScreen="three",trackClick("Next",vm.aal.selectedDevices.join("|")),trackPageLoad("Personal Info")}function onclickScreenThreeBackButton(){vm.aal.visibleScreen="two",trackClick("Back"),trackPageLoad("Select Devices")}function setEmailEditState(state){
vm.aal.emailEditable=state}function toggleSelectedDevice(deviceName){var idx=vm.aal.selectedDevices.indexOf(deviceName);idx>-1?vm.aal.selectedDevices.splice(idx,1):vm.aal.selectedDevices.push(deviceName)}function setFocusedInput(inputName){vm.aal.focusedInput=inputName}function submit(isValid){vm.submitted=!0,isValid?($scope.$broadcast("valid",!0),vm.aal.visibleScreen="four",vm.aal.user?vm.aal.user.email=vm.formData.emailUser:vm.aal.user={firstName:vm.formData.firstName,lastName:vm.formData.lastName,email:vm.formData.email,phone:vm.formData.phone,billingAccountCode:"",source:""},createSalesforceLead(),trackClick("Submit"),trackPageLoad("Confirmation",window.btoa(vm.aal.user.phone))):$scope.$broadcast("valid",!1)}function trackClick(ctaName,userSelection){var evt={eventInfo:{eventAction:"click",eventType:"clickToNavigate"},attributes:{type:"navigation"},eventDescription:{ctaName:"VIP AAL | "+ctaName.trim()}};userSelection&&(evt.eventDescription.userSelection=userSelection),analyticsUtils.pushEvent("CLICK_EVENT",evt)}function trackPageLoad(name,dynamicValue){analyticsUtils.trackPageLoad("AALPageLoad","VIP AAL",name,name,dynamicValue,vm.aal.user?"Personal Information Available":"Personal Information Not Available")}function formatPhone(phone){return phone.replace(/(\d{3})(\d{3})(\d{4})/,"$1-$2-$3")}function getUser(){return"false"===$location.search().user?!1:$window.aalUser?$window.aalUser.user:void 0}function onSuccessCreateSalesforceLead(){createSelligentLead()}function onErrorCreateSalesforceLead(response){$log.error("error create lead",response),vm.aal.serverError=!0}function createSalesforceLead(){var data={config:"aal",userData:{firstName:vm.aal.user.firstName,lastName:vm.aal.user.lastName,Phone:vm.aal.user.phone,Email:vm.aal.user.email,Lines__c:vm.formData.lines,Device__c:vm.aal.selectedDevices.join(","),Shopper_Pin__c:vm.aal.user.phone,Company:"T_Mobile",LeadSource:"VIP AAL",Web_Submission_Time__c:(new Date).toISOString(),BAN__c:vm.aal.user.billingAccountCode,T_Mobile_Page__c:vm.aal.user.source,Offer_Details__c:settings.offerText,Consent_Text__c:settings.legalText,Consent__c:"true",Customer_Type__c:"existing customer",T_Mobile_ID__c:vm.aal.user.email}};salesforceUtils.createSalesforceLead(settings.authToken,data).then(onSuccessCreateSalesforceLead,onErrorCreateSalesforceLead)}function onSuccessCreateSelligentLead(){$scope.$broadcast("valid",!0),vm.addLineForm.$setPristine(),vm.addLineForm.$setUntouched(),vm.formData={}}function onErrorCreateSelligentLead(response){$log.error("error selligent call",response),vm.aal.serverError=!0}function createSelligentLead(){var locationUrl=$location.absUrl(),noQueryLocationUrl=locationUrl.slice(0,locationUrl.indexOf("?")),data={config:"aal",userData:{FIRST_NAME:vm.aal.user.firstName,Name:vm.aal.user.lastName,Mail:vm.aal.user.email,SUBSCRIBE_SOURCE:"Web"},triggerData:{},campaignData:{ACTIONCODE:"AAL",LEAD_CAPTURE_LOCATION:noQueryLocationUrl,MARKETING_PROGRAM:"Consumer",PIN:vm.aal.user.phone,OFFER_TEXT:settings.offerText,CREATED_DT:(new Date).toISOString(),SUBSCRIBE_SOURCE:"Web"}};selligentUtils.createSelligentLead(settings.authToken,data,"selligent",settings.selligentURL).then(onSuccessCreateSelligentLead,onErrorCreateSelligentLead)}var settings,vm=this;vm.formData={},vm.aal={},vm.onInit=onInit,vm.onclick_screenOneNextButton=onclickScreenOneNextButton,vm.onclick_screenTwoBackButton=onclickScreenTwoBackButton,vm.onclick_screenTwoNextButton=onclickScreenTwoNextButton,vm.onclick_screenThreeBackButton=onclickScreenThreeBackButton,vm.setEmailEditState=setEmailEditState,vm.toggleSelectedDevice=toggleSelectedDevice,vm.setFocusedInput=setFocusedInput,vm.submit=submit}AddLineController.$inject=["$scope","$window","$location","$timeout","$log","analyticsUtils","salesforceUtils","selligentUtils"],angular.module("marketingCore").controller("AddLineController",AddLineController)}(window.angular),function(angular){"use strict";var dateSelectorCarousel={templateUrl:"app/storeLocator/components/dateSelectorCarousel/dateSelectorCarousel.tpl.html",controller:"dateSelectorCarouselController",controllerAs:"vm",bindings:{}};angular.module("tmobileApp").component("dateSelectorCarousel",dateSelectorCarousel)}(window.angular),function(angular){"use strict";function CardCarouselController($scope){function onInit(data){cardsToShow=data.carouselSize<=4?1:3,$scope.slickConfig={nextArrow:'<button type="button" data-role="none" class="slick-next slick-arrow" aria-label="'+data.carouselSettings.nextAriaLabel+'" role="button" style="display: block;">'+data.carouselSettings.nextAriaLabel+"</button>",prevArrow:'<button type="button" data-role="none" class="slick-prev slick-arrow" aria-label="'+data.carouselSettings.previousAriaLabel+'" role="button" style="display: block;">'+data.carouselSettings.previousAriaLabel+"</button>",infinite:!0,accessibility:!1,focusOnSelect:!1,speed:600,useTransform:!0,cssEase:"ease",dots:!0,slidesToScroll:1,slidesToShow:cardsToShow,lazyLoad:"ondemand",variableWidth:!0,respondTo:"slider",method:{},event:{},responsive:[]}}$scope.carousel={};var cardsToShow;$scope.onInit=onInit}CardCarouselController.$inject=["$scope"],angular.module("marketingCore").controller("CardCarouselController",CardCarouselController)}(angular),function(angular){"use strict";function dateSelectorCarouselController($log,storeLocatorModelService,storeAppointmentService,genericModalUtil,storeLocatorConstants){function setCarouselConfig(){vm.appointmentSlickConfig={slidesToShow:6,slidesToScroll:6,draggable:vm.model.isMobileView,infinite:!1,mobileFirst:!0,swipeToSlide:!0,prevArrow:".sl-reserve-slider-prev",nextArrow:".sl-reserve-slider-next",event:{init:function(event,slick){slick.slickGoTo(vm.model.selectedDateIndex)}}}}var vm=this;vm.model=storeLocatorModelService.model,vm.model.timeSlotsAvailableFor===vm.model.store.id.toString()?(vm.model.selectedDateAndDay=vm.model.availableTimeSlots[vm.model.selectedDateIndex],setCarouselConfig()):storeAppointmentService.getAvailableTimeSlots().then(function(status){"success"===status?(vm.model.selectedDateAndDay=vm.model.availableTimeSlots[vm.model.selectedDateIndex],setCarouselConfig()):genericModalUtil.openModal().then(function(successResult){$log.log(successResult),storeLocatorModelService.showOperationSection()})})}dateSelectorCarouselController.$inject=["$log","storeLocatorModelService","storeAppointmentService","genericModalUtil","storeLocatorConstants"],angular.module("tmobileApp").controller("dateSelectorCarouselController",dateSelectorCarouselController)}(window.angular),function(angular){"use strict";function ContentCarouselController($scope){function onInit(data){$scope.slickConfig={nextArrow:'<button type="button" data-role="none" class="slick-next slick-arrow" aria-label="'+data.carouselSettings.nextAriaLabel+'" role="button" style="display: block;">'+data.carouselSettings.nextAriaLabel+"</button>",prevArrow:'<button type="button" data-role="none" class="slick-prev slick-arrow" aria-label="'+data.carouselSettings.previousAriaLabel+'" role="button" style="display: block;">'+data.carouselSettings.previousAriaLabel+"</button>",infinite:!0,accessibility:!0,focusOnSelect:!1,speed:600,lazyLoad:"ondemand",useTransform:!0,autoplay:!0,cssEase:"ease",dots:!0,pauseOnHover:!1,autoplaySpeed:12e3,method:{},event:{}}}$scope.carousel={},$scope.onInit=onInit}ContentCarouselController.$inject=["$scope"],angular.module("marketingCore").controller("ContentCarouselController",ContentCarouselController)}(angular),function(angular){"use strict";var dateSelectorCarouselItem={templateUrl:"app/storeLocator/components/dateSelectorCarouselItem/dateSelectorCarouselItem.tpl.html",controller:"dateSelectorCarouselItemController",controllerAs:"vm",bindings:{dayAndTime:"<",index:"<"}};angular.module("tmobileApp").component("dateSelectorCarouselItem",dateSelectorCarouselItem)}(window.angular),function(angular){"use strict";function EmailCaptureController($scope,$window,$http,$log){function onInit(data,analyticsID){vm.settings=data,vm.analyticsID=analyticsID,vm.authToken=data.authToken,vm.htmlTag=data.htmlTag,vm.optinAgrmt=data.optinAgrmt,vm.success=!1}function submit(isValid){vm.submitted=!0,isValid?getCSRF():$scope.$broadcast("valid",!1)}function onSuccessGetCSRF(response){createLead(response.data.token)}function onErrorGetCSRF(response){$log.error("error csrf ",response),$scope.$broadcast("valid",!1)}function onSuccessSelligent(response){$scope.$broadcast("valid",!0),vm.response=response.data,$scope.vm.emailCaptureForm.$setPristine(),$scope.vm.emailCaptureForm.$setUntouched(),$scope.vm.formData={},vm.success=!0}function onErrorSelligent(response){$log.error("error selligent call",response),$scope.$broadcast("valid",!1)}function getCSRF(){var auth={method:"GET",url:"/libs/granite/csrf/token.json",headers:{Authorization:"Basic "+vm.authToken}};$http(auth).then(onSuccessGetCSRF,onErrorGetCSRF)}function createLead(token){var sellPayload={config:"deals",userData:{Mail:$scope.formData.email,ZIP:$scope.formData.zip+"",CUSTOMER:angular.isUndefined($scope.formData.currentCustomer)||""===parseInt($scope.formData.currentCustomer,10)?0:parseInt($scope.formData.currentCustomer,10),MSISDN:$scope.formData.phoneNumber?$scope.formData.phoneNumber.replace(/[- .●)(]/g,"")+"":"",MARKETING_PROGRAM:vm.settings.marketingProgramText,OPT_IN:1,TEXT_OF_OPTIN_AGRMT:vm.settings.optinAgrmt,IPADDRESS:"",LEAD_CAPTURE_LOCATION:$window.location.href,SUBSCRIBE_SOURCE:"Web"},triggerData:{}},sellUpd={method:"POST",url:"/bin/services/marketing/selligent",headers:{Authorization:"Basic "+vm.authToken,"CSRF-Token":token},data:sellPayload};$http(sellUpd).then(onSuccessSelligent,onErrorSelligent)}var vm=this;vm.settings={},vm.formData={},vm.onInit=onInit,vm.submit=submit}EmailCaptureController.$inject=["$scope","$window","$http","$log"],angular.module("marketingCore").controller("EmailCaptureController",EmailCaptureController)}(angular),function(angular){"use strict";function dateSelectorCarouselItemController(storeLocatorModelService){function onClickDateAndDay(index){vm.model.selectedDateIndex=index,vm.model.selectedTimeIndex=null,vm.model.selectedDateAndDay=vm.model.availableTimeSlots[index]}var vm=this;vm.model=storeLocatorModelService.model,vm.onClickDateAndDay=onClickDateAndDay}dateSelectorCarouselItemController.$inject=["storeLocatorModelService"],angular.module("tmobileApp").controller("dateSelectorCarouselItemController",dateSelectorCarouselItemController)}(window.angular),function(angular,lodash){"use strict";function InternationalCallingController($scope,$location,$timeout,internationalCallingService,analyticsUtils,apiURLsV2,marketingHttpRequest,JWToken,globalConfig){function onInit(data){vm.dataFilePath=data.dataFilePath,vm.analyticsID=data.analyticsID,vm.icid=data.icid,vm.isNewInternationalCalling=data.isNewInternationalCalling,vm.internationalCallingService.selectedCountry.name=$location.search().countryName,"true"===vm.isNewInternationalCalling?JWToken.getJSONWebToken().then(function(successRes){vm.authToken=successRes,vm.headers.Authorization="Bearer "+vm.authToken,vm.headers["Content-Type"]=globalConfig&&globalConfig.credentials&&globalConfig.credentials.international_calling.content_type,vm.headers.consumerType=globalConfig&&globalConfig.credentials&&globalConfig.credentials.international_calling.consumer_type,vm.headers.application=globalConfig&&globalConfig.credentials&&globalConfig.credentials.international_calling.application,marketingHttpRequest.authGet(apiURLsV2.newInternationalCalling,vm.headers,null).then(function(regionsResponse){vm.internationalCallingService.internationalCountries=regionsResponse.data.regions,vm.internationalCallingService.selectedCountry.name&&(transformResults(),$location.hash("stateside-results"))})},function(errorRes){$log.error("InternationalCallingController: Error while getting the token ")}):(internationalCallingService.getInternationalCallingData(vm.dataFilePath),$timeout(function(){vm.internationalCallingService.selectedCountry.name&&(vm.internationalCallingService.getCallingDataForCountry(),$location.hash("stateside-results"))},1e3))}function keySelect($event){var keyCode=$event.which||$event.keyCode;if(13===keyCode){var dropdownActive=$event.currentTarget.nextElementSibling.querySelector(".active").innerText;angular.element($event.currentTarget.nextElementSibling).removeClass("open"),vm.internationalCallingService.selectedCountry.name=dropdownActive,angular.element(".cta>button")[0].focus()}}function keysActions($event){var element=$event.currentTarget.nextElementSibling;if(element&&(38===$event.keyCode||40===$event.keyCode)){var index=Number($event.currentTarget.nextElementSibling.querySelector(".active").getAttribute("index")),listLenght=$event.currentTarget.nextElementSibling.querySelector("ul").getElementsByTagName("li").length-1;38===$event.keyCode?0===index?index=listLenght:index===listLenght?index--:index--:40===$event.keyCode&&(index===listLenght?index=0:index>=0&&index++);for(var els=$event.currentTarget.nextElementSibling.querySelectorAll("li.active"),i=0;i<els.length;i++)els[i].classList.remove("active");element.querySelector("#element-"+index).classList.add("active")}}function toolBlur($event){var dropdownActive=$event.currentTarget.nextElementSibling.querySelector(".active")?$event.currentTarget.nextElementSibling.querySelector(".active").firstElementChild.innerText:$event.currentTarget.value;vm.internationalCallingService.selectedCountry.name=dropdownActive,"true"===vm.isNewInternationalCalling&&(angular.element($event.currentTarget.nextElementSibling).removeClass("open"),angular.element(".cta>button")[0].focus()),analyticsUtils.trackTool({type:"Start",name:"Stateside Calling Comparison",analyticsID:vm.analyticsID})}function transformResults(){vm.internationalCallingService.selectedCountry.INTTMOB15={},vm.internationalCallingService.selectedCountry.STDUITT={},vm.internationalCallingService.selectedCountry.submittedCountry="",vm.selectedCountryCode=lodash.filter(vm.internationalCallingService.internationalCountries,function(item){return item.regionName.toLowerCase()===vm.internationalCallingService.selectedCountry.name.toLowerCase()})[0],vm.headers.Authorization="Bearer "+vm.authToken,vm.headers["Content-Type"]=globalConfig&&globalConfig.credentials&&globalConfig.credentials.international_calling.content_type,vm.headers.consumerType=globalConfig&&globalConfig.credentials&&globalConfig.credentials.international_calling.consumer_type,vm.headers.application=globalConfig&&globalConfig.credentials&&globalConfig.credentials.international_calling.application,vm.selectedCountryCode&&vm.selectedCountryCode.regionCode?(vm.internationalCallingService.selectedCountry.name=vm.selectedCountryCode.regionName,$location.search("countryName",vm.internationalCallingService.selectedCountry.name),marketingHttpRequest.authGet(apiURLsV2.newInternationalCalling+"/"+vm.selectedCountryCode.regionCode,vm.headers,null).then(function(regionResponse){vm.internationalCallingService.selectedCountry.submittedCountry=vm.internationalCallingService.selectedCountry.name,regionResponse.data.region&&(vm.internationalCallingService.selectedCountry.INTTMOB15=regionResponse.data.region.calling.discountedRates[0],vm.internationalCallingService.selectedCountry.STDUITT=regionResponse.data.region.calling.defaultRate)},function(errorRes){$log.error("InternationalCallingController: Error while getting the token ")})):(vm.internationalCallingService.selectedCountry.submittedCountry=vm.internationalCallingService.selectedCountry.name,$location.search("countryName",vm.internationalCallingService.selectedCountry.name))}function submit($event){analyticsUtils.trackTool({ctaName:$event.target.innerText,assetType:"Button",type:"Complete",name:"Stateside Calling Comparison",analyticsID:vm.analyticsID,userInput:vm.internationalCallingService.selectedCountry.name,icid:vm.icid}),"true"===vm.isNewInternationalCalling?transformResults():internationalCallingService.getCallingDataForCountry()}var vm=this;vm.headers={"Content-Type":"",consumerType:"",application:"",Authorization:""},vm.authToken="",vm.internationalCallingService=internationalCallingService,vm.onInit=onInit,vm.toolBlur=toolBlur,vm.submit=submit,vm.keysActions=keysActions,vm.keySelect=keySelect,vm.selectedCountryCode={}}InternationalCallingController.$inject=["$scope","$location","$timeout","internationalCallingService","analyticsUtils","apiURLsV2","marketingHttpRequest","JWToken","globalConfig"],angular.module("marketingCore").controller("InternationalCallingController",InternationalCallingController)}(window.angular,window._),function(angular){"use strict";var errorModal={templateUrl:"app/storeLocator/components/errorModal/errorModal.tpl.html",controller:"errorModalController",controllerAs:"vm",bindings:{closeModal:"="}};angular.module("tmobileApp").component("errorModal",errorModal)}(window.angular),function(angular){"use strict";function NewsroomContentCarouselController($scope){function onInit(data){$scope.slickConfig={infinite:!0,accessibility:!0,focusOnSelect:!1,speed:600,nextArrow:null,prevArrow:null,lazyLoad:"ondemand",useTransform:!0,autoplay:!0,cssEase:"ease",pauseOnHover:!1,autoplaySpeed:12e3,asNavFor:".carousel-pips",method:{},event:{}},$scope.slickNav={infinite:!0,accessibility:!0,focusOnSelect:!1,speed:600,useTransform:!0,cssEase:"ease",slidesToScroll:1,slidesToShow:3,lazyLoad:"ondemand",nextArrow:null,prevArrow:null,method:{},event:{},asNavFor:".content-slick-carousel",responsive:[{breakpoint:640,settings:{slidesToShow:1,slidesToScroll:1,variableWidth:!0}},{breakpoint:641,settings:{slidesToShow:3,slidesToScroll:1}}]}}$scope.carousel={},$scope.onInit=onInit}NewsroomContentCarouselController.$inject=["$scope"],angular.module("marketingCore").controller("NewsroomContentCarouselController",NewsroomContentCarouselController)}(angular),function(angular,lodash){"use strict";function errorModalController(commonServices,storeLocatorModelService,storeAppointmentService,globalValue,storeLocatorConstants){var vm=this;vm.model=storeLocatorModelService.model,vm.closeAppointment=storeAppointmentService.closeAppointment,vm.model.errorState===storeLocatorConstants.PAGES.GIL?vm.authoring={header:globalValue.authorValue.storeauthoring.getInLine.errorMessage,CTAText:globalValue.authorValue.storeauthoring.getInLine.errorModalCTA}:104===vm.model.appointmentErrorCode?vm.authoring={header:globalValue.authorValue.storeauthoring.appointmentsAndWaitTime.storeNotFoundErrorHeader,CTAText:globalValue.authorValue.storeauthoring.appointmentsAndWaitTime.genericErrorOKCTALabel}:vm.authoring={header:globalValue.authorValue.storeauthoring.appointmentsAndWaitTime.genericErrorModalHeader,CTAText:globalValue.authorValue.storeauthoring.appointmentsAndWaitTime.genericErrorOKCTALabel}}errorModalController.$inject=["commonServices","storeLocatorModelService","storeAppointmentService","globalValue","storeLocatorConstants"],angular.module("tmobileApp").controller("errorModalController",errorModalController)}(window.angular,window._),function(angular){"use strict";function ProductCarouselController($scope){function onInit(data){$scope.slickConfig={nextArrow:'<button type="button" data-role="none" class="slick-next slick-arrow" aria-label="'+data.carouselSettings.nextAriaLabel+'" role="button" style="display: block;">'+data.carouselSettings.nextAriaLabel+"</button>",prevArrow:'<button type="button" data-role="none" class="slick-prev slick-arrow" ng-class="{\'slick-disabled\': isOnFirst}" aria-label="'+data.carouselSettings.previousAriaLabel+'" role="button" style="display :block;">'+data.carouselSettings.previousAriaLabel+"</button>",infinite:!0,accessibility:!0,focusOnSelect:!1,speed:300,useTransform:!0,cssEase:"ease",dots:!0,slidesToShow:3,slidesToScroll:3,lazyLoad:"ondemand",variableWidth:!0,respondTo:"slider",responsive:[{breakpoint:1024,settings:{slidesToShow:2,slidesToScroll:1,draggable:!0}},{breakpoint:600,settings:{slidesToShow:1,slidesToScroll:1,draggable:!0}}],method:{},event:{}}}$scope.carousel={},$scope.onInit=onInit,$scope.isOnFirst=!0}ProductCarouselController.$inject=["$scope"],angular.module("marketingCore").controller("ProductCarouselController",ProductCarouselController)}(angular),function(angular){"use strict";var getInLineForm={templateUrl:"app/storeLocator/components/getInLineForm/getInLineForm.tpl.html",controller:"GetInLineFormController",controllerAs:"vm",bindings:{store:"<"}};angular.module("tmobileApp").component("getInLineForm",getInLineForm)}(window.angular),function(angular){"use strict";function SwitcherController($scope,$rootScope,$window,$location,$timeout,$log,$cookies,utils,analyticsUtils,viewport,geoLocation,salesforceUtils,serverTimeService){function onInit(data,analyticsID){settings=data,$scope.analyticsID=analyticsID,"false"===$window.marketingConfig.isWcm&&settings.desktopFallbackUrl&&(viewport.breakpointUp("tablet")||!utils.isTouch())&&($window.location.href=settings.desktopFallbackUrl),settings.limitedOfferTimer&&(offerStartTime=Date.parse(settings.limitedOfferTimer.startTime),offerExpirationTime=Date.parse(settings.limitedOfferTimer.expirationTime)),vm.switcher={},vm.switcher.hasLimitedOffer=!1,vm.switcher.offerText=settings.defaultOfferText,$rootScope.$on("$locationChangeSuccess",function(e){$scope.$broadcast("stepChange",getCurrentStep())}),callMeNowJson=settings.outbound,callMeNowJson&&showOBCall()}function onclickCarrier(obj){$location.search("carrier",obj.target.attributes.dataCarrier.value)}function onclickLines(obj){$location.search("lines",obj.target.attributes.dataLines.value)}function onclickResults(obj){vm.cost&&$timeout(function(){$location.search("cost",vm.cost)})}function getCurrentStep(){return carrierIsValid()&&linesIsValid()&&costIsValid()?(vm.isResultGenerated=!0,settings.limitedOfferTimer&&settings.limitedOfferText?serverTimeService.getServerTime().then(onSuccessGetServerTime,onErrorGetServerTime):(setResults(),initGraph(),updateLivePersonChatData()),4):carrierIsValid()&&linesIsValid()?3:carrierIsValid()?2:1}function setResults(){vm.switcher.carrier=formattedCarriers[$location.search().carrier],vm.switcher.lines="1"===$location.search().lines?"1 line":$location.search().lines+" lines",vm.switcher.graphLines="1"===$location.search().lines?"1 unlimited line":$location.search().lines+" unlimited lines",vm.switcher.currentMonthlyCost="$"+$location.search().cost,vm.switcher.newMonthlyCost="$"+settings.monthlyCost[$location.search().lines],vm.switcher.monthlySavings=$location.search().cost-settings.monthlyCost[$location.search().lines],vm.switcher.annualSavings=12*$location.search().cost-12*settings.monthlyCost[$location.search().lines],vm.switcher.annualSavingsFormatted="$"+vm.switcher.annualSavings,vm.switcher.hasSavings=vm.switcher.annualSavings>=settings.annualSavingsThreshold,vm.switcher.authToken=settings.authToken,createLead()}function initGraph(){$scope.$broadcast("initGraph")}function updateLivePersonChatData(){var lpInterval,intCounter=1;lpInterval=$timeout(function(){$window.lpTag&&$window.lpTag.sdes?($window.lpTag=$window.lpTag||[],$window.lpTag.sdes.push({type:"prodView",currency:"USD",products:[{product:{name:vm.switcher.carrier+", "+vm.switcher.lines+", Monthly Cost: "+parseInt($location.search().cost,10)+", Total Savings: "+vm.switcher.annualSavings}}]}),clearInterval(lpInterval)):(intCounter+=1,intCounter>3&&clearInterval(lpInterval))},500)}function carrierIsValid(){var carrier=$location.search().carrier;return carrier&&-1!==validCarriers.indexOf(carrier)}function linesIsValid(){var lines=$location.search().lines;return lines&&-1!==validLines.indexOf(lines)}function costIsValid(){return $location.search().cost&&angular.isNumber(parseInt($location.search().cost,10))}function onSuccessGetServerTime(serverTime){serverTime&&offerExpirationTime>=offerStartTime&&offerExpirationTime>=serverTime&&(vm.switcher.hasLimitedOffer=!0,vm.switcher.offerText=settings.limitedOfferText),setResults(),initGraph(),updateLivePersonChatData()}function onErrorGetServerTime(response){$log.error("There was an problem getting server time.",response),setResults(),initGraph()}function onSuccessCreateLead(response){if(vm.serviceError=!1,response.data){vm.switcher.pinNumber=response.data.Shopper_Pin__c,vm.switcher.id=response.data.id;var expireDate=new Date;expireDate.setDate(expireDate.getDate()+30),vm.switcher.hasSavings?($cookies.put("selectedCarrier",vm.switcher.carrier,{expires:expireDate,path:"/"}),$cookies.put("locationCarrier",$location.search().carrier,{expires:expireDate,path:"/"}),$cookies.put("locationLines",$location.search().lines,{expires:expireDate,path:"/"}),$cookies.put("locationCost",$location.search().cost,{expires:expireDate,path:"/"}),$cookies.put("vipPinNumber",vm.switcher.pinNumber,{expires:expireDate,path:"/"}),$cookies.put("savings",vm.switcher.annualSavingsFormatted,{expires:expireDate,path:"/"}),$cookies.put("hasSavings",!0,{expires:expireDate,path:"/"}),$cookies.put("switcherId",vm.switcher.id,{expires:expireDate,path:"/"})):($cookies.remove("selectedCarrier",{path:"/"}),$cookies.remove("locationCarrier",{path:"/"}),$cookies.remove("locationLines",{path:"/"}),$cookies.remove("locationCost",{path:"/"}),$cookies.remove("savings",{path:"/"}),$cookies.remove("hasSavings",{path:"/"}),$cookies.put("vipPinNumber",vm.switcher.pinNumber,{expires:expireDate,path:"/"}),$cookies.put("switcherId",vm.switcher.id,{expires:expireDate,path:"/"})),analyticsUtils.trackPageLoad("SwitcherPageLoad","Switch-to-t-mobile","Results",vm.switcher.hasSavings?"Signficant Savings":"Insignificant Savings",vm.switcher.pinNumber+" | "+vm.switcher.annualSavings)}}function onErrorCreateLead(response){$log.error("error create lead",response),$scope.$broadcast("valid",!1),vm.serviceError=!0}function onSuccessLoadD3(){$log.info("D3 loaded")}function createLead(data){payload={config:"switcher",userData:{firstName:"Please",lastName:"Update",Current_Carrier__c:vm.switcher.carrier,Lines__c:vm.switcher.lines,Accessory__c:"Accessory item",Monthly_Bill__c:vm.switcher.currentMonthlyCost,Web_Submission_Time__c:(new Date).toISOString(),savings__c:vm.switcher.annualSavings,LeadSource:"VIP Switch",offer_details__c:vm.switcher.offerText,Company:"T_Mobile",Phone:"",ZIP__c:"",Consent_Text__c:"Please update",Consent__c:"true"}},salesforceUtils.createSalesforceLead(vm.switcher.authToken,payload).then(onSuccessCreateLead,onErrorCreateLead)}function submit(isValid){vm.submitted=!0,isValid?getCurrentStep():$scope.$broadcast("valid",!1)}function hideShowOBCall(array,el){for(var i=0;i<array.length;i++)if(angular.toJson(array[i]).indexOf(el)>-1)return!0;return!1}function showOBCall(){var holidaysOpHrs=callMeNowJson.callMeNowHolidaysOpHrs,centerHolidays=holidaysOpHrs.callMeNowCenterHolidays,fedHolidays=holidaysOpHrs.callMeNowFederalHolidays,offHoursTime=parseInt(holidaysOpHrs.offHoursTime.replace(":",""),10),onHoursTime=parseInt(holidaysOpHrs.onHoursTime.replace(":",""),10),callMeNowTime=new Date,callMeNowDay=callMeNowTime.getDay(),callMeNowHours=callMeNowTime.getHours(),callMeNowMinutes=callMeNowTime.getMinutes(),callMeNowDate=callMeNowTime.getDate(),callMeNowMonth=callMeNowTime.getMonth()+1,callMeNowYear=callMeNowTime.getFullYear(),timeNow=100*callMeNowHours+callMeNowMinutes,days=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];blockedStates=holidaysOpHrs.blockedStates,10>callMeNowMonth&&(callMeNowMonth="0"+callMeNowMonth),dateNow=callMeNowMonth+"-"+callMeNowDate+"-"+callMeNowYear,callMeNowDay=days[callMeNowDay],isCallCenterHoliday=hideShowOBCall(centerHolidays,callMeNowDay),isFederalHoliday=hideShowOBCall(fedHolidays,dateNow),timeNow>=onHoursTime&&offHoursTime>timeNow&&(isOffHours=!1),geoLocation.getState().then(function(data){state=data,isBlockedState=hideShowOBCall(blockedStates,state),isBlockedState?isOffHours||isCallCenterHoliday||isFederalHoliday?(vm.showOBCallButton=!1,vm.showPhoneButton=!1):(vm.showOBCallButton=!1,vm.showPhoneButton=!0):isOffHours||isCallCenterHoliday||isFederalHoliday?(vm.showOBCallButton=!0,vm.showPhoneButton=!1):(vm.showOBCallButton=!1,vm.showPhoneButton=!0)},function(){isOffHours||isCallCenterHoliday||isFederalHoliday?(vm.showOBCallButton=!0,vm.showPhoneButton=!1):(vm.showOBCallButton=!1,vm.showPhoneButton=!0)}),$timeout(function(){state||(isOffHours||isCallCenterHoliday||isFederalHoliday?(vm.showOBCallButton=!0,vm.showPhoneButton=!1):(vm.showOBCallButton=!1,vm.showPhoneButton=!0))},30)}utils.loadScript("/etc/clientlibs/t-mobile/publish/lib/d3.js",onSuccessLoadD3);var vm=this;vm.formData={},vm.OBCallFormData={};var settings,offerStartTime,offerExpirationTime,payload,callMeNowJson,blockedStates,dateNow,state,validLines=["1","2","3","4","5","6"],validCarriers=["verizon","att","sprint","other"],formattedCarriers={verizon:"Verizon",att:"AT&T",sprint:"Sprint",other:"Other"},isOffHours=!0,isCallCenterHoliday=!0,isFederalHoliday=!1,isBlockedState=!1;vm.onInit=onInit,vm.submit=submit,vm.onclick_carrier=onclickCarrier,vm.onclick_lines=onclickLines,vm.onclick_results=onclickResults}SwitcherController.$inject=["$scope","$rootScope","$window","$location","$timeout","$log","$cookies","utils","analyticsUtils","viewport","geoLocation","salesforceUtils","serverTimeService"],angular.module("marketingCore").controller("SwitcherController",SwitcherController)}(window.angular),function(angular,uuid){"use strict";function getInLineFormController($log,storeLocatorModelService,mapUtil,storeLocatorUtil,toggleService,pdlService,checkOutValidationUtil,globalValue,storeLocatorConstants,commonServices){function init(){mapUtil.setMarkers(!0,[vm.model.store],0,1),storeLocatorUtil.getReasons(vm.store.id).then(function(response){vm.storeReasons=response.data},function(error){$log.log(error)}),vm.mplanguage=$document.location.subdomain&&($document.location.subdomain.includes("es.")||"es"===$document.location.subdomain)?"es":"en",vm.getInLineForm.languagePreferenceOptions="en"===vm.mplanguage?"English":"Español",vm.authoring.notifyTextMessage&&vm.authoring.notifyEmailAddress&&(vm.notifyTypes=[vm.authoring.notifyTextMessage,vm.authoring.notifyEmailAddress],vm.getInLineForm.notifyMethod=vm.authoring.notifyTextMessage),vm.getInLineForm.notifyTurn=!1}function errorHandler(error){return vm.displayErrorMessage=!0,vm.formSubmitted=!1,$log.log("Something went wrong: ",error),error}function submitGetInLineForm(getInLineForm){var transactionId=uuid.create().toString(),reasonID="";reasonID=angular.isDefined(vm.getInLineForm.object.additionReason)?[vm.getInLineForm.object.reasonType.reasonType,vm.getInLineForm.object.additionReason.reasonType]:[vm.getInLineForm.object.reasonType.reasonType],pdlService.CTAClickEvent("Button Click: "+vm.authoring.getInLineCTAText,"","","Get In Line",void 0,vm.store.id);var isDuplicateReason=vm.getInLineForm.object.reasonType.reasonType===(vm.getInLineForm.object.additionReason&&vm.getInLineForm.object.additionReason.reasonType);if(isDuplicateReason)vm.formSubmitted=!1;else if(getInLineForm&&!getInLineForm.$invalid&&!getInLineForm.$pending){var formData={customerType:"",firstName:vm.getInLineForm.firstName,lastName:vm.getInLineForm.lastName,notes:vm.getInLineForm.comment,consentForNotifications:vm.getInLineForm.notifyTurn,preferredLanguage:vm.getInLineForm.userSelectedLang?vm.getInLineForm.userSelectedLang:"English",reasonsForVisit:reasonID,storeId:vm.store.id,status:"In-line",queueType:"In-line",originatingSystem:"Store Locator"};vm.getInLineForm.notifyMethod===vm.authoring.notifyTextMessage&&vm.getInLineForm.notifyTurn?formData.phoneNumber=vm.getInLineForm.phone:vm.getInLineForm.notifyMethod===vm.authoring.notifyEmailAddress&&vm.getInLineForm.notifyTurn&&(formData.emailId=vm.getInLineForm.email),formData=sanitizeFormInputs(formData),storeLocatorUtil.addCustomer(formData).then(function(response){vm.formSubmitted=response.data&&response.data.result&&response.data.result.length&&angular.isDefined(response.data.result[0].positionInQueue),pdlService.setFormCompleteEvent("Get In Line","",vm.getInLineForm.object.reasonType.reasonType,transactionId,vm.store.id,"getinline");
var ctaName="CTA Click : "+vm.authoring.getInLineCTAText;pdlService.CTAClickEvent(ctaName,"","",void 0,void 0,vm.store.id),angular.equals(response.status,200)?(vm.displayErrorMessage=!1,$log.log("status GetInLine ",status)):(vm.displayErrorMessage=!0,vm.formSubmitted=!1)})["catch"](errorHandler)}vm.headerLabel=vm.authoring.confirmation.header,vm.headerLabel=vm.headerLabel?vm.headerLabel.replace("{user}",vm.getInLineForm.firstName):vm.getInLineForm.firstName}function sanitizeFormInputs(formData){var specialChars=/[`~!$%^&*()_|\;'",<>\{\}\[\]\\\/]/gi;return formData.hasOwnProperty("firstName")&&(formData.firstName=(formData.firstName+"").toString().replace(specialChars,"")),formData.hasOwnProperty("lastName")&&(formData.lastName=(formData.lastName+"").toString().replace(specialChars,"")),formData.hasOwnProperty("notes")&&(formData.notes=(formData.notes+"").toString().replace(specialChars,"")),formData.hasOwnProperty("consentForNotifications")&&(formData.consentForNotifications=(formData.consentForNotifications+"").toString().replace(specialChars,""),formData.consentForNotifications=-1!=formData.consentForNotifications.indexOf("true")?!0:!1),formData.hasOwnProperty("preferredLanguage")&&(formData.preferredLanguage=(formData.preferredLanguage+"").toString().replace(specialChars,"")),formData.hasOwnProperty("storeId")&&(formData.storeId=(formData.storeId+"").toString().replace(specialChars,"")),formData.hasOwnProperty("status")&&(formData.status=(formData.status+"").toString().replace(specialChars,"")),formData.hasOwnProperty("queueType")&&(formData.queueType=(formData.queueType+"").toString().replace(specialChars,"")),formData.hasOwnProperty("originatingSystem")&&(formData.originatingSystem=(formData.originatingSystem+"").toString().replace(specialChars,"")),formData}function toggleGetInLineForm(){storeLocatorModelService.showOperationSection()}function resetValues(){vm.getInLineForm.email="",vm.getInLineForm.phone="",vm.getInLineForm.notifyTurn||(vm.getInLineForm.notifyMethod="Text message")}var vm=this,$document=commonServices.$window.document;vm.store=storeLocatorModelService.model.store,vm.model=storeLocatorModelService.model,vm.toggles=toggleService.model.toggles,vm.getInLineForm={},vm.maxLength=storeLocatorConstants.MAX_INPUT_FIELD_LENGTH,vm.displayErrorMessage=!1,vm.authoring=globalValue.authorValue.storeauthoring.getInLine,vm.mplanguage="",init(),vm.submitGetInLineForm=submitGetInLineForm,vm.toggleGetInLineForm=toggleGetInLineForm,vm.resetValues=resetValues,vm.validatePhoneNumberOnChange=storeLocatorModelService.validatePhoneNumberOnChange,vm.init=init,vm.sanitizeFormInputs=sanitizeFormInputs,Object.keys(vm.authoring.languagePreferenceOptions).forEach(function(prop){vm.authoring.languagePreferenceOptions[prop].optionLabel===vm.getInLineForm.languagePreferenceOptions&&(vm.getInLineForm.userSelectedLang=vm.getInLineForm.languagePreferenceOptions)})}getInLineFormController.$inject=["$log","storeLocatorModelService","mapUtil","storeLocatorUtil","toggleService","pdlService","checkOutValidationUtil","globalValue","storeLocatorConstants","commonServices"],angular.module("tmobileApp").controller("GetInLineFormController",getInLineFormController)}(window.angular,window.UUIDjs),function(angular){"use strict";function SyncUpController(syncUp,analyticsUtils){function onInit(data){vm.analyticsID=data.analyticsID,vm.authoredDisplayMessages=data.authoredDisplayMessages,vm.selectThisDevice=data.selectThisDevice}function onSelectDropdown(data){vm.formStartCalled||(vm.formStartCalled=!0,vm.formCompleteCalled=!1,formStart(data)),analyticsUtils.trackEvent("CLICK_EVENT",vm.analyticsID,{eventInfo:{eventAction:"click",eventType:"clickToAction"},category:{eventCategory:"click"},eventDescription:{dataAnalyticsID:data.analyticsID,ctaName:[data.ctaName,data.selectedValue].join(" : "),assetType:"dropdown"}})}function onSelectDevice(data){vm.syncUp.result.compatibility="",vm.syncUp.result.displayMessage=null,vm.syncUp.result.compatibilityType="",vm.syncUp.result.locationCode="",vm.syncUp.result.locationMessage="",onSelectDropdown({ctaName:data.ctaName,selectedValue:vm.selectedDevice,analyticsID:data.analyticsID})}function onSelectYear(data){vm.selectedMake=null,vm.selectedModel=null,vm.selectedEngine=null,onSelectDropdown({ctaName:data.ctaName,selectedValue:vm.selectedYear,analyticsID:data.analyticsID}),vm.syncUp.availableMakes=[],vm.syncUp.availableModels=[],vm.syncUp.availableEngines=[],syncUp.selectYear({Year:vm.selectedYear}).then(function(res){vm.syncUp.availableMakes=res.data||[]})}function formStart(data){analyticsUtils.trackEvent("CLICK_EVENT",vm.analyticsID,{eventInfo:{eventAction:"click",eventType:"tool"},category:{eventCategory:"toolclick"},tool:{dynamicContent:"",stage:"start",name:"SyncUp Hardware Compatibility Tool",dataAnalyticsID:data.analyticsID}})}function onSelectMake(data){vm.selectedModel=null,vm.selectedEngine=null,vm.syncUp.availableModels=[],vm.syncUp.availableEngines=[],onSelectDropdown({ctaName:data.ctaName,selectedValue:vm.selectedMake,analyticsID:data.analyticsID}),syncUp.selectMake({Year:vm.selectedYear,Make:vm.selectedMake}).then(function(res){vm.syncUp.availableModels=res.data||[]})}function onSelectModel(data){vm.selectedEngine=null,vm.syncUp.availableEngines=[],onSelectDropdown({ctaName:data.ctaName,selectedValue:vm.selectedModel,analyticsID:data.analyticsID}),syncUp.selectModel({Year:vm.selectedYear,Make:vm.selectedMake,Model:vm.selectedModel}).then(function(res){vm.syncUp.availableEngines=res.data||[]})}function onSelectEngine(data){onSelectDropdown({ctaName:data.ctaName,selectedValue:vm.selectedEngine,analyticsID:data.analyticsID})}function checkCompatability(data){analyticsUtils.trackEvent("CLICK_EVENT",vm.analyticsID,{eventInfo:{eventAction:"click",eventType:"clickToAction"},category:{eventCategory:"click"},eventDescription:{ctaName:data.ctaName||"Check Compatibility",dataAnalyticsID:data.analyticsID,assetType:"Button"}}),syncUp.selectEngine({Year:vm.selectedYear,Make:vm.selectedMake,Model:vm.selectedModel,Engine:vm.selectedEngine,Device:vm.selectedDevice}).then(function(result){result.displayMessage&&(result.displayMessage=result.displayMessage.replace("Drive","DRIVE")),angular.forEach(vm.authoredDisplayMessages,function(item,key){key===result.compatibilityType&&item&&(vm.syncUp.result.displayMessage=item)});var resultMessage;switch(result.compatibilityType){case"A":resultMessage="Full compatible";break;case"B":resultMessage="Partial compatible";break;case"C":resultMessage="Minimum compatible";break;case"D":resultMessage="Not compatible";break;case"E":resultMessage="Unknown";break;default:resultMessage=""}vm.formCompleteCalled||(vm.formCompleteCalled=!0,vm.formStartCalled=!1,analyticsUtils.trackEvent("CLICK_EVENT",vm.analyticsID,{eventInfo:{eventAction:"click",eventType:"tool"},category:{eventCategory:"toolclick"},tool:{dynamicContent:resultMessage,stage:"complete",name:"SyncUp Hardware Compatibility Tool"}}))})}var vm=this;vm.syncUp=syncUp,vm.onInit=onInit,vm.onSelectYear=onSelectYear,vm.onSelectMake=onSelectMake,vm.onSelectModel=onSelectModel,vm.onSelectEngine=onSelectEngine,vm.onSelectDevice=onSelectDevice,vm.checkCompatability=checkCompatability,vm.enableCta=!1,vm.formStartCalled=!1,vm.formCompleteCalled=!1,syncUp.getAvailableYears().then(function(res){vm.syncUp.availableYears=res.data&&res.data.years,vm.syncUp.availableDevices=res.data&&res.data.devices,vm.syncUp.availableDevices&&(vm.selectedDevice=vm.syncUp.availableDevices.find(function(device){return device.includes(vm.selectThisDevice)}),vm.selectedDevice=vm.selectedDevice?vm.selectedDevice:vm.syncUp.availableDevices[0])})}SyncUpController.$inject=["syncUp","analyticsUtils"],angular.module("marketingCore").controller("SyncUpController",SyncUpController)}(angular),function(angular){"use strict";var infoBoxCarouselComponentConstructor={templateUrl:"app/storeLocator/components/infoBoxCarousel/infoBoxCarousel.tpl.html",controller:"infoBoxCarouselController",controllerAs:"vm",bindings:{onClickUpDownArrow:"=",slickConfig:"="}};angular.module("tmobileApp").component("infoBoxCarousel",infoBoxCarouselComponentConstructor)}(window.angular),function(angular){"use strict";function VideoCarouselController($scope){function onInit(data){cards=data.videos.length,$scope.videos={},$scope.videos.ids=data.videos,cardsToShow=4>=cards?1:3,$scope.slickConfig={nextArrow:'<button type="button" data-role="none" class="slick-next slick-arrow" aria-label="'+data.carouselSettings.nextAriaLabel+'" role="button" style="display: block;">'+data.carouselSettings.nextAriaLabel+"</button>",prevArrow:'<button type="button" data-role="none" class="slick-prev slick-arrow" aria-label="'+data.carouselSettings.previousAriaLabel+'" role="button" style="display: block;">'+data.carouselSettings.previousAriaLabel+"</button>",infinite:!0,accessibility:!1,focusOnSelect:!1,speed:600,useTransform:!0,cssEase:"ease",dots:!0,slidesToScroll:1,slidesToShow:cardsToShow,lazyLoad:"ondemand",variableWidth:!0,respondTo:"slider",method:{},event:{},responsive:[]}}$scope.carousel={};var cards,cardsToShow;$scope.onInit=onInit}VideoCarouselController.$inject=["$scope"],angular.module("marketingCore").controller("VideoCarouselController",VideoCarouselController)}(angular),function(angular){"use strict";function infoBoxCarouselController(storeLocatorModelService,pdlService){var vm=this;vm.model=storeLocatorModelService.model,vm.CTANavOrClickEvent=pdlService.CTANavOrClickEvent,storeLocatorModelService.setInfoCarouselConfig(),vm.model.isMobileView||(vm.model.slickConfig.scrollSpeed=1e3)}infoBoxCarouselController.$inject=["storeLocatorModelService","pdlService"],angular.module("tmobileApp").controller("infoBoxCarouselController",infoBoxCarouselController)}(window.angular),function(angular,lodash){"use strict";function articleNav($window,$timeout,$document,$location,viewport,analyticsUtils){return{restrict:"A",link:function(scope,element){function onInit(){var shareToggle=element[0].querySelector(".open-share"),toggleIcon=element[0].querySelector(".fa-share-alt"),shareBox=element[0].querySelector(".share-box"),actionableItems=element[0].querySelectorAll("[data-analytics-id]"),shareLinks=element[0].querySelectorAll('[data-category="share"]');lodash.forEach(actionableItems,function(el){el.addEventListener("mouseup",onClick_navigationElement)}),lodash.forEach(shareLinks,function(el){el.addEventListener("mouseup",analyticsUtils.trackGlobalNavigationShareClick)}),shareToggle.addEventListener("keydown",function(e){switch(e.which){case 9:break;case 13:e.currentTarget.setAttribute("aria-expanded","true"),shareBox.classList.toggle("open")}}),scope.copyLink=function(e){copyToClipboard(e,url)},$document[0].addEventListener("mouseup",function(e){e.target===shareBox||e.target===shareToggle||e.target===toggleIcon||e.target.parentElement.classList.contains("social")||(scope.open=!1,scope.$apply())}),populateSocial()}function onClick_navigationElement(e){analyticsUtils.trackGlobalNavigationClick(e.currentTarget)}function populateSocial(){var headline=encodeURIComponent($document[0].querySelector(".e-share").getAttribute("data-email-headline")),emailBody=encodeURIComponent($document[0].querySelector(".e-share").getAttribute("data-email-body")),shareUrl=encodeURIComponent(url),ogUrlMetaTag=$document[0].querySelector('meta[property="og:url"]');ogUrlMetaTag&&(shareUrl=encodeURIComponent(ogUrlMetaTag.getAttribute("content"))),element[0].querySelector(".fb-share").setAttribute("href","https://www.facebook.com/sharer/sharer.php?u="+shareUrl+"&redirect_uri=http%3A%2F%2Fwww.facebook.com%2F"),element[0].querySelector(".twt-share").setAttribute("href","https://twitter.com/intent/tweet?&url="+shareUrl+"&original_referer="+encodeURIComponent(url)),element[0].querySelector(".lnkd-share").setAttribute("href","https://www.linkedin.com/shareArticle?mini=true&url="+shareUrl+"&source="+encodeURIComponent(url)),element[0].querySelector(".e-share").setAttribute("href","mailto:?subject="+headline+"&body="+emailBody+shareUrl)}function copyToClipboard(e,text){if($window.clipboardData&&$window.clipboardData.setData)return $window.clipboardData.setData("Text",text);if($document[0].queryCommandSupported&&$document[0].queryCommandSupported("copy")){var textarea=$document[0].createElement("textarea");textarea.textContent=text,textarea.style.position="fixed",$document[0].body.appendChild(textarea),textarea.select();try{var copiedURL=$document[0].execCommand("copy",!1,null);return copiedURL&&copiedDialog.classList.add("active"),copiedURL}catch(ex){return!1}finally{$document[0].body.removeChild(textarea),$timeout(function(){copiedDialog.classList.remove("active")},1e3)}}return!1}var baseUrl=$location.protocol()+"://"+$location.host()+(80===$location.port()?"":":"+$location.port()),url=baseUrl+$location.path(),copiedDialog=element[0].querySelector(".copySuccess");onInit()}}}articleNav.$inject=["$window","$timeout","$document","$location","viewport","analyticsUtils"],angular.module("marketingCore").directive("articleNav",articleNav)}(angular,_),function(angular){"use strict";var preExistingAppointment={templateUrl:"app/storeLocator/components/preExistingAppointment/preExistingAppointment.tpl.html",controller:"preExistingAppointmentController",controllerAs:"vm",bindings:{dismissModal:"=",closeModal:"="}};angular.module("tmobileApp").component("preExistingAppointment",preExistingAppointment)}(window.angular),function(angular,lodash){"use strict";function comparisonChart($window,$rootScope,analyticsUtils,utils,$timeout,viewport){return{restrict:"A",link:function(scope,element,attr){function toggleStickyTableHeader(){var scrollTop=win.scrollTop(),chartDimensions=utils.getElementOffset(stickyHeader.parentElement);elementTop=chartDimensions.top,elementBottom=chartDimensions.bottom,scrollTop>elementTop-navHeaderHeight&&elementBottom-headerHeight>scrollTop?scope.toggleSticky=!0:scope.toggleSticky=!1}function onSelectDropdown(which){var selected=element[0].getElementsByTagName("select"),allCells=element[0].querySelectorAll("[data-column]"),optionCol=selected[which].options[selected[which].selectedIndex].dataset.column,columnCells=element[0].querySelectorAll("[data-column="+optionCol+"]"),options=element[0].getElementsByTagName("option");lodash.forEach(allCells,function(ac){ac.classList.remove("show-"+which)}),lodash.forEach(columnCells,function(cc){cc.classList.add("show-"+which)}),lodash.forEach(options,function(o){o.disabled=!1}),$timeout(function(){var reversedOptions=element[0].querySelectorAll("td.show-1 ~ td.show-0"),normalOptions=element[0].querySelectorAll("td.show-0 ~ td.show-1"),optionNotCheckedOne=element[0].querySelectorAll("option.show-0:not(:checked)"),optionNotCheckedTwo=element[0].querySelectorAll("option.show-1:not(:checked)");optionNotCheckedOne[0].disabled=!0,optionNotCheckedTwo[0].disabled=!0,lodash.forEach(reversedOptions,function(rev){rev.parentNode.classList.add("reverse")}),lodash.forEach(normalOptions,function(norm){norm.parentNode.classList.remove("reverse")})},10)}function cleanup(){win.off("scroll.comparisonChart")}var selected=element[0].getElementsByTagName("select"),selectedFirst=selected[0].options[selected[0].selectedIndex].value,selectedSecond=selected[1].options[selected[1].selectedIndex].value;scope.data={columnOne:selectedFirst,columnTwo:selectedSecond};var elementTop,elementBottom,win=angular.element($window),navHeaderHeight=angular.element(".global-header").outerHeight(),stickyHeader=element[0].querySelector("#table-header-"+attr.moduleId),headerHeight=stickyHeader.offsetHeight,popOver=element[0].querySelectorAll('[data-toggle="popover"]');element[0].querySelectorAll(".comparison-chart-header-row *");$timeout(function(){toggleStickyTableHeader()},0),win.on("scroll.comparisonChart",_.throttle(toggleStickyTableHeader,100)),viewport.breakpointDown("tablet")&&lodash.forEach(popOver,function(x){x.setAttribute("data-placement","top")}),angular.element(popOver).popover({trigger:"manual",template:'<div class="popover chart-popover" role="tooltip"><div class="arrow"></div><h4 class="popover-title chart-popover-title"></h4><div class="popover-content chart-popover-content"></div></div>'}),lodash.forEach(popOver,function(popItem){popItem.addEventListener("click",function(){angular.element(popItem).popover("toggle")})}),element[0].addEventListener("click",function(e){this.querySelectorAll(".popover.in")&&"BUTTON"!=e.target.tagName&&"I"!=e.target.tagName&&!e.target.parentNode.classList.contains("popover")&&angular.element(popOver).popover("hide")}),scope.$on("dropdown-select",function(event,x){onSelectDropdown(x)}),scope.$on("$destroy",cleanup)}}}comparisonChart.$inject=["$window","$rootScope","analyticsUtils","utils","$timeout","viewport"],angular.module("marketingCore").directive("comparisonChart",comparisonChart)}(angular,window._),function(angular,lodash){"use strict";function preExistingAppointmentController(storeLocatorModelService,storeAppointmentService,navigationUtil,globalValue,storeLocatorConstants,geoLocation,storeLocatorUtil,commonServices){function onSDPLinkClick(){vm.model.isMobileView?lodash.isEmpty(vm.storeAddress)||(navigationUtil.navigateToStoreWithAddress(vm.storeAddress),vm.model.showCarouselUp=!1):vm.closeModal(vm.storeDetailsView)}var vm=this;vm.authoring=globalValue.authorValue.storeauthoring.appointmentsAndWaitTime,vm.model=storeLocatorModelService.model,vm.constants=storeLocatorConstants.APPT_FLOWS;var $filter=commonServices.$filter;storeAppointmentService.getMyAppointments().then(function(myAppointmentsResponse){var startDate=new Date(myAppointmentsResponse.startdate).getUTCDay(),dayOfWeek=storeLocatorConstants.DAY_OF_WEEKS[startDate].toUpperCase().slice(0,3),dateAndMonth=myAppointmentsResponse.startdate.slice(0,5);vm.dateTimeSummary=dayOfWeek+", "+dateAndMonth+" at "+myAppointmentsResponse.starttime,vm.model.preExistingAppointment=myAppointmentsResponse;var storeId=myAppointmentsResponse.storeId,city=$filter("normalize")(myAppointmentsResponse.storecity),state=$filter("normalize")(myAppointmentsResponse.storestate);vm.model.preExistingAppointment.dateTimeSummary=vm.dateTimeSummary,vm.model.preExistingAppointment.normalizedCity=city,vm.model.preExistingAppointment.normalizeState=state;var generalAuthoring=globalValue.authorValue.storeauthoring.generalAuthoringStores;vm.startIndex=0,vm.resultCount=generalAuthoring.numberOfTotalResults||"50",vm.miles=generalAuthoring.numberOfMiles||"20",geoLocation.getLatLng(vm.model.preExistingAppointment.storezip).then(function(latLng){var latLngObject={lat:latLng[0],lng:latLng[1]};vm.spatialPointLatLng=latLng,storeLocatorUtil.getStoreList(latLngObject,vm.startIndex,vm.resultCount,vm.miles,!1).then(function(response){vm.startIndex=response.startIndex,vm.numberFound=response.numberFound,vm.storeList=response.data,vm.completeStoreList=response.data,vm.noStoresFound=!1,lodash.isEmpty(vm.storeList)||(vm.store=lodash.find(vm.storeList,function(store){return store.id===storeId}),lodash.isEmpty(vm.store)||(vm.storeName=vm.store.name,vm.model.preExistingAppointment.normalizedStoreName=$filter("normalize")(vm.store.name)));var storeAddressObject=lodash.get(vm,"store.location.address");lodash.isEmpty(storeAddressObject)||(vm.storeAddress=storeAddressObject.streetAddress+", "+storeAddressObject.addressLocality+", "+storeAddressObject.addressRegion+" "+storeAddressObject.postalCode)})})}),vm.storeDetailsView=storeLocatorConstants.SECTIONS.STORE_DETAILS,vm.onSDPLinkClick=onSDPLinkClick}preExistingAppointmentController.$inject=["storeLocatorModelService","storeAppointmentService","navigationUtil","globalValue","storeLocatorConstants","geoLocation","storeLocatorUtil","commonServices"],angular.module("tmobileApp").controller("preExistingAppointmentController",preExistingAppointmentController)}(window.angular,window._),function(angular){"use strict";function fraudFailCtrlFn(globalValue,coreServices){var vm=this;vm.authorValue=globalValue.authorValue,coreServices.authTokenManager.clearSession()}fraudFailCtrlFn.$inject=["globalValue","coreServices"],angular.module("tmobileApp").controller("FraudFailCtrl",fraudFailCtrlFn)}(angular),function(angular){"use strict";var rescheduleAppointment={templateUrl:"app/storeLocator/components/rescheduleAppointment/rescheduleAppointment.tpl.html",controller:"rescheduleAppointmentController",controllerAs:"vm",bindings:{dismissModal:"=",closeModal:"="}};angular.module("tmobileApp").component("rescheduleAppointment",rescheduleAppointment)}(window.angular),function(angular,lodash){"use strict";function confirmationPageUtilConstructor(globalValue,commonUtils,checkOutModelService,dateUtils,commonServices){function showDefaultConfirmationTemplate(){return{greetLine:"Thanks",greetDesc:"you are just one step away to joining T-Mobile!",copyBlock:"Our offices might closed this time, in that case you will get the call during next working day.",highCopyBlock:"A T-Mobile rep will call you if there is a problem with your order or credit selection."}}function setConfirmationTemplate(isOffHour){var confirmationStr="",paymentOptionStr="",currentCreditClass=checkOutModelService.model.checkOutInfo.personalInfo.creditClass,creditClass=currentCreditClass?currentCreditClass:"GOOD";if(confirmationStr+=isOffHour&&"NONE"!==creditClass?"offHr":"onHr","GOOD"===creditClass?confirmationStr+="Aws":"BUILDING"===creditClass&&(confirmationStr+="Avg"),checkOutModelService.model.checkOutInfo.reviewCart.flags.isOnlyAccessory||"NONE"===creditClass)confirmationStr+=checkOutModelService.model.checkOutInfo.reviewCart.flags.isOnlyAccessory&&"NONE"!==creditClass?lodash.find(checkOutModelService.model.checkOutInfo.reviewCart.accessories.accessoryDetails,{isFRPPayment:!1})?"AccessEIP":"AccessFRP":"AwsAccessFRP";else if(confirmationStr+="Device",0===checkOutModelService.model.checkOutInfo.reviewCart.accessories.accessoryDetails.length)checkOutModelService.model.checkOutInfo.reviewCart.lineItems.forEach(function(lineItem){"MONTHLY"===lineItem.lineItemDetails.deviceDetails.pricingOption&&(paymentOptionStr="EIP")}),"EIP"!==paymentOptionStr&&(paymentOptionStr="FRP"),confirmationStr+=paymentOptionStr;else{var isDeviceEIP=!1,isAccessEIP=!1;checkOutModelService.model.checkOutInfo.reviewCart.lineItems.forEach(function(lineItem){"MONTHLY"===lineItem.lineItemDetails.deviceDetails.pricingOption&&(isDeviceEIP=!0)}),checkOutModelService.model.checkOutInfo.reviewCart.accessories.accessoryDetails.forEach(function(accessory){accessory.isFRPPayment||(isAccessEIP=!0)}),confirmationStr+=isDeviceEIP&&isAccessEIP?"EIP":isDeviceEIP||isAccessEIP?"AccessEIPFRP":"FRP"}checkOutModelService.model.confirmationString=commonUtils.searchJson(globalValue.authorValue.checkout,confirmationStr),angular.isDefined(checkOutModelService.model.confirmationString)?(checkOutModelService.model.confirmationString.copyBlock=checkOutModelService.model.confirmationString.copyBlock?checkOutModelService.model.confirmationString.copyBlock.replace(/\\n/g,"<br />"):"",checkOutModelService.model.confirmationString.whatNextDesc=checkOutModelService.model.confirmationString.whatNextDesc?checkOutModelService.model.confirmationString.whatNextDesc.replace(/\\n/g,"<br />"):"",checkOutModelService.model.confirmationString.highCopyBlock=checkOutModelService.model.confirmationString.highCopyBlock?checkOutModelService.model.confirmationString.highCopyBlock.replace(/\\n/g,"<br />"):""):checkOutModelService.model.confirmationString=showDefaultConfirmationTemplate(),checkOutModelService.model.scheduleCallback=commonUtils.searchJson(globalValue.authorValue.checkout,"scheduleCallback")}function getConfirmationTemplate(){var authorValue=globalValue.authorValue;if(angular.isUndefined(authorValue.checkout.holidaysAndOpHrs.federalHoliday))checkOutModelService.model.confirmationString=showDefaultConfirmationTemplate();else{var getFederalHolidayList=lodash.get(authorValue,"checkout.holidaysAndOpHrs.federalHoliday"),holidayStatus=dateUtils.isFederalHoliday(getFederalHolidayList),federalState=checkOutModelService.model.checkOutInfo.shipInfo.state,getOptionalHolidayList=lodash.get(authorValue,"checkout.holidaysAndOpHrs.optFederalHoliday"),optHolidayStatus=dateUtils.isOptionalHoliday(getOptionalHolidayList,federalState),callCenterHolidayList=lodash.get(authorValue,"checkout.holidaysAndOpHrs.callCenterHolidays"),weekOffStatus=dateUtils.weekOffDay(callCenterHolidayList,federalState),sTime=lodash.get(authorValue,"checkout.holidaysAndOpHrs.onHoursTime"),eTime=lodash.get(authorValue,"checkout.holidaysAndOpHrs.offHoursTime"),callCenterStatus=dateUtils.callCenterOperatingHours(sTime,eTime),isOffHour=callCenterStatus||weekOffStatus||holidayStatus||optHolidayStatus;setConfirmationTemplate(isOffHour)}var federalHoliday=[],holiday=authorValue.checkout.holidaysAndOpHrs?authorValue.checkout.holidaysAndOpHrs.federalHoliday:[];lodash.isArray(holiday)?federalHoliday=holiday:federalHoliday.push(holiday);var optionalHolidayList=authorValue.checkout.holidaysAndOpHrs?authorValue.checkout.holidaysAndOpHrs.optFederalHoliday:[],optionalHoliday=[];lodash.isArray(optionalHolidayList)||optionalHoliday.push(optionalHolidayList);var isOptionalHoliday=lodash.find(optionalHoliday,{optFederalState:federalState});if(angular.isDefined(isOptionalHoliday)){var optFederalHolidayDate=isOptionalHoliday.optFederalHoliday.split("-"),optFederalHolidayMonth=optFederalHolidayDate[0],optFederalHolidayDay=optFederalHolidayDate[1];federalHoliday.push({federalHoliday:optFederalHolidayMonth+"-"+optFederalHolidayDay})}checkOutModelService.model.federalHoliday=federalHoliday}function setOrderNumberForLiveperson(){checkOutModelService.model.checkOutInfo.order.orderNumber&&$timeout(function(){var lpTag=$window.lpTag;lpTag.sdes=lpTag.sdes||[],lpTag.sdes.push({type:"purchase",total:1,orderId:checkOutModelService.model.checkOutInfo.order.orderNumber})},0)}function setOrderDetailsForBV(cartObject){try{var bvObj={};cartObject&&(bvObj.orderId=lodash.get(cartObject.order,"orderNumber"),bvObj.total=lodash.get(cartObject.total,"payNowPrice.amount"),bvObj.currency="USD",bvObj.tax=lodash.get(cartObject.subTotal,"tax.total.amount"),bvObj.shipping=lodash.get(cartObject.subTotal,"shippingFee.amount"),bvObj.encryptedEmail=cartObject.encryptedEmailId,bvObj.encryptionKeyId=cartObject.encryptionKeyId,bvObj.nickname=lodash.get(cartObject.personalInfo,"firstName"),bvObj.items=[],lodash.forEach(cartObject.lineItems,function(value){var item={},payNowPrice=parseFloat(lodash.get(value.lineItemDetails,"deviceDetails.payNowPrice.purchasePrice.amount",0)),catalogPrice=parseFloat(lodash.get(value.lineItemDetails,"deviceDetails.catalogPrice.listPrice.amount",0));item.productId=lodash.get(value.lineItemDetails,"deviceDetails.sku",""),item.name=lodash.get(value.lineItemDetails,"deviceDetails.familyName",""),item.quantity=lodash.get(value.lineItemDetails,"deviceDetails.quantity",""),item.category=lodash.get(value.lineItemDetails,"deviceDetails.productSubType",""),item.price=payNowPrice,item.discount=(catalogPrice-payNowPrice).toFixed(2),bvObj.items.push(item)}),cartObject.accessories&&0!=cartObject.accessories.accessoryDetails.length&&lodash.forEach(cartObject.accessories.accessoryDetails,function(value){var item={},payNowPrice=parseFloat(lodash.get(value.payNowPrice,"purchasePrice.amount",0)),catalogPrice=parseFloat(lodash.get(value.catalogPrice,"listPrice.amount",0));item.productId=value.sku,item.name=value.familyName,item.quantity=value.quantity,item.category=value.accessoryType,item.price=payNowPrice,item.discount=(catalogPrice-payNowPrice).toFixed(2),bvObj.items.push(item)}),commonServices.$timeout(function(){$window.bvCallback=function(BV){BV.pixel.trackTransaction(bvObj)}},0))}catch(ex){$log.error(ex)}}var $timeout=commonServices.$timeout,$window=commonServices.$window,$log=commonServices.$log;return{getConfirmationTemplate:getConfirmationTemplate,setOrderNumberForLiveperson:setOrderNumberForLiveperson,setOrderDetailsForBV:setOrderDetailsForBV}}confirmationPageUtilConstructor.$inject=["globalValue","commonUtils","checkOutModelService","dateUtils","commonServices"],angular.module("tmobileApp").factory("confirmationPageUtil",confirmationPageUtilConstructor)}(window.angular,window._),function(angular,lodash){"use strict";function rescheduleAppointmentController(storeLocatorConstants,globalValue,storeLocatorModelService){var vm=this;vm.authoring=globalValue.authorValue.storeauthoring.appointmentsAndWaitTime,vm.modalToOpen=storeLocatorConstants.MODALS.CANCEL,vm.model=storeLocatorModelService.model}rescheduleAppointmentController.$inject=["storeLocatorConstants","globalValue","storeLocatorModelService"],angular.module("tmobileApp").controller("rescheduleAppointmentController",rescheduleAppointmentController)}(window.angular,window._),function(angular,lodash){"use strict";function ssnLearnMoreModalController($modalInstance,authorValues){function close(){$modalInstance.close()}var vm=this;vm.ssnLearnMoreModal=lodash.get(authorValues,"checkout.paymentAndCreditCheck",{}),vm.close=close}ssnLearnMoreModalController.$inject=["$modalInstance","authorValues"],angular.module("tmobileApp").controller("SsnLearnMoreModalController",ssnLearnMoreModalController)}(window.angular,window._),function(angular){"use strict";var moduleName="tmobileApp",componentName="schemaData",schemaDataComponentConstructor={template:'<script type="application/ld+json" id="schemaDataID"></script>',controller:"schemaDataController",controllerAs:"vm",bindings:{store:"<",brand:"<",description:"<",events:"<",eventDefaultImage:"<",tmobileStorePin:"<",storePhoto:"<",storePhotoAltText:"<",specialHours:"<"}};angular.module(moduleName).component(componentName,schemaDataComponentConstructor)}(window.angular),function(angular,lodash){"use strict";function ccProgressModalController($modalInstance,modalDialogFactory,globalValue){function init(){vm.ccProgressModal=lodash.get(globalValue.authorValue,"checkout.creditCheckTpp"),modalDialogFactory.setModalInstance($modalInstance)}var vm=this;$modalInstance.result["finally"](function(){vm.close=!0}),init(),vm.init=init}ccProgressModalController.$inject=["$modalInstance","modalDialogFactory","globalValue"],angular.module("tmobileApp").controller("ccProgressModalController",ccProgressModalController).directive("loadingbar",["$interval",function($interval){return{restrict:"E",template:"<div class='progress'><div class='progress-bar bg-white' role='progressbar' ng-style='loadingWidth'></div></div>",replace:!0,scope:{close:"@"},controller:["$scope","$interval",function($scope){$scope.onTimeout=function(){$scope.startAt=++$scope.startAt%101,$scope.current=$scope.startAt;var width=$scope.startAt+"%";$scope.loadingWidth={width:width}}}],link:function(scope,elem,attrs,ctrl){scope.startAt=0,attrs.$observe("close",function(value){"true"===value&&$interval.cancel(scope.mytimeout)}),scope.mytimeout=$interval(scope.onTimeout,50)}}}])}(window.angular,window._),function(angular,lodash){"use strict";function schemaDataControllerFunction($sce,$filter,$scope){function getUrl(){var targetURL,stateName=$filter("normalize")(lodash.get(vm.store,"location.address.addressRegion","")),cityName=$filter("normalize")(lodash.get(vm.store,"location.address.addressLocality","")),storeName=$filter("normalize")(lodash.get(vm.store,"name",""));return targetURL=angular.isDefined(stateName)&&angular.isDefined(cityName)&&angular.isDefined(storeName)?"http://www.t-mobile.com/store-locator/"+stateName+"/"+cityName+"/"+storeName:"http://www.t-mobile.com/store-locator"}function getCountry(){var stateName=lodash.get(vm.store,"location.address.addressRegion"),countryCode="US";return angular.isDefined(stateName)&&(countryCode="PR"===stateName?"PR":"US"),countryCode}function updateSchemaContent(){document.getElementById("schemaDataID").textContent=$sce.trustAsHtml($filter("json")(vm.jsonLDData))}function getLogo(){var logo={};return logo["@type"]="ImageObject",logo.contentUrl=vm.tmobileStorePin||"",logo}function getImageObject(){return lodash.get(vm.jsonLDData,"image",{"@type":"ImageObject"
})}function addServicesToSchema(){vm.jsonLDData.hasOfferCatalog={},vm.jsonLDData.hasOfferCatalog["@type"]="OfferCatalog",vm.jsonLDData.hasOfferCatalog.name="Services",vm.jsonLDData.hasOfferCatalog.itemListElement=[],angular.forEach(vm.store.services,function(serviceType){var offer={};offer["@type"]="Offer",offer.itemOffered={},offer.itemOffered["@type"]="Service",offer.itemOffered.name=serviceType,vm.jsonLDData.hasOfferCatalog.itemListElement.push(offer)})}function addEventsToSchema(events){vm.jsonLDData.events=[],angular.forEach(events,function(event){if(angular.isDefined(event)){var schemaEvent={};schemaEvent["@type"]="Event",schemaEvent.startDate=moment(event.startDate+" "+event.opens).utcOffset(vm.store.location.utcOffset,!0).toISOString(),schemaEvent.endDate=moment(event.endDate+" "+event.closes).utcOffset(vm.store.location.utcOffset,!0).toISOString(),schemaEvent.name=event.eventName,schemaEvent.description=event.description||"",schemaEvent.url=event.linkUrl||"",schemaEvent.location={},schemaEvent.location["@type"]="Place",schemaEvent.location.name=vm.brand,schemaEvent.location.address={},schemaEvent.location.address["@type"]="PostalAddress",schemaEvent.location.address.streetAddress=lodash.get(vm.store,"location.address.streetAddress",""),schemaEvent.location.address.addressLocality=lodash.get(vm.store,"location.address.addressLocality",""),schemaEvent.location.address.addressRegion=lodash.get(vm.store,"location.address.addressRegion",""),schemaEvent.location.address.addressCountry=getCountry(),schemaEvent.location.address.postalCode=lodash.get(vm.store,"location.address.postalCode",""),schemaEvent.image=lodash.get(event,"photos[0].image.url",vm.eventDefaultImage||""),vm.jsonLDData.events.push(schemaEvent)}})}function getStandardHours(){if(vm.store.standardHours&&vm.store.standardHours.length>0){var opensClosesIndexMap=new Map;return vm.store.standardHours.reduce(function(openingHours,standardHour){var foundIndex=opensClosesIndexMap.get(standardHour.opens+"-"+standardHour.closes);if(foundIndex)openingHours[foundIndex-1].dayOfWeek.push(standardHour.day);else{var openingHour={};openingHour["@type"]="OpeningHoursSpecification",openingHour.dayOfWeek=[standardHour.day],openingHour.opens=standardHour.opens,openingHour.closes=standardHour.closes,openingHours.push(openingHour),opensClosesIndexMap.set(standardHour.opens+"-"+standardHour.closes,openingHours.length)}return openingHours},[])}return[]}function getSpecialHours(specialHours){var today=moment().startOf("isoWeek").isoWeekday(moment().isoWeekday());return specialHours.reduce(function(specialOpeningHours,currentSpecialHour){var currentDate=today.format("YYYY-MM-DD");if(today.format("dddd")===currentSpecialHour.day&&currentDate===currentSpecialHour.date&&(currentSpecialHour.isEmergencyHours||currentSpecialHour.isHolidayHours||currentSpecialHour.isNpiHours)){if(specialOpeningHours.length>0){var previousSpecialHour=specialOpeningHours[specialOpeningHours.length-1];if(previousSpecialHour.opens===(currentSpecialHour.opens||"00:00")&&previousSpecialHour.closes===(currentSpecialHour.closes||"00:00")&&previousSpecialHour.validThrough===moment(currentDate).subtract(1,"days").format("YYYY-MM-DD"))return previousSpecialHour.validThrough=currentDate,today.add("d",1),specialOpeningHours}var openingHour={};openingHour["@type"]="OpeningHoursSpecification",openingHour.opens=currentSpecialHour.opens||"00:00",openingHour.closes=currentSpecialHour.closes||"00:00",openingHour.validFrom=currentDate,openingHour.validThrough=currentDate,specialOpeningHours.push(openingHour)}return today.add("d",1),specialOpeningHours},[])}var vm=this;vm.storeType=lodash.get(vm.store,"type",""),vm.initialize=function(){vm.store&&"National Retail"!==vm.storeType&&(vm.jsonLDData={"@context":"http://schema.org","@type":"Store","@id":getUrl(),url:getUrl(),name:lodash.get(vm.store,"location.address.addressLocality","")+" T-Mobile",branchCode:lodash.get(vm.store,"id",""),address:{"@type":"PostalAddress",streetAddress:lodash.get(vm.store,"location.address.streetAddress",""),addressLocality:lodash.get(vm.store,"location.address.addressLocality",""),addressRegion:lodash.get(vm.store,"location.address.addressRegion",""),addressCountry:getCountry(),postalCode:lodash.get(vm.store,"location.address.postalCode","")},geo:{"@type":"GeoCoordinates",latitude:lodash.get(vm.store,"location.latitude",""),longitude:lodash.get(vm.store,"location.longitude","")},telephone:lodash.get(vm.store,"telephone",""),brand:{"@type":"Brand",name:vm.brand},description:lodash.get(vm,"description","").replace(/((<([^>]+)>)|\n|\r)/gi,""),logo:getLogo(),openingHoursSpecification:getStandardHours()},vm.store.services&&vm.store.services.length>0&&addServicesToSchema(),updateSchemaContent())},$scope.$watch("vm.storePhoto",function(imageUrl){vm.store&&"National Retail"!==vm.storeType&&imageUrl&&(vm.jsonLDData.image=getImageObject(),vm.jsonLDData.image.url=imageUrl,updateSchemaContent())}),$scope.$watch("vm.storePhotoAltText",function(alternateText){vm.store&&"National Retail"!==vm.storeType&&alternateText&&(vm.jsonLDData.image=getImageObject(),vm.jsonLDData.image.accessibilityFeature=alternateText,updateSchemaContent())}),$scope.$watch("vm.events",function(events){vm.store&&"National Retail"!==vm.storeType&&events&&events.length>0&&(addEventsToSchema(events),updateSchemaContent())}),$scope.$watch("vm.specialHours",function(specialHours){if(vm.store&&"National Retail"!==vm.storeType&&specialHours&&specialHours.length>0){for(var i=0;i<moment().isoWeekday()-1;i++)specialHours.push(specialHours.shift());var specialOpeningHours=getSpecialHours(specialHours);specialOpeningHours.length>0&&(vm.jsonLDData.specialOpeningHoursSpecification=specialOpeningHours,updateSchemaContent())}}),vm.initialize()}schemaDataControllerFunction.$inject=["$sce","$filter","$scope"];var controllerName="schemaDataController";angular.module("tmobileApp").controller(controllerName,schemaDataControllerFunction)}(angular,window._),function(angular){"use strict";function setClassWhenAtTopFn($window){var $win=angular.element($window);return{restrict:"A",link:function(scope,element,attrs){var topClass=attrs.setClassWhenAtTop,topPadding=parseInt(attrs.paddingWhenAtTop,10),offsetTop=element.prop("offsetTop");$win.on("scroll",function(){$window.pageYOffset+topPadding>=offsetTop+100?element.addClass(topClass):element.removeClass(topClass)})}}}var moduleName="tmobileCheckOut",directiveName="setClassWhenAtTop";angular.module(moduleName).directive(directiveName,setClassWhenAtTopFn)}(angular),function(angular){"use strict";var searchBar={templateUrl:"app/storeLocator/components/searchBar/searchBar.tpl.html",controller:"searchBarController",controllerAs:"vm",bindings:{}};angular.module("tmobileApp").component("searchBar",searchBar)}(window.angular),function(angular){"use strict";function fingerPrintFn($compile,$http,$templateCache,cartStorage,$timeout){function setFingerPrintId(scope,elm){var element=angular.element("<span/>"),rawTemplate=$templateCache.get("app/checkOut/directives/fingerPrint/fingerPrint.html"),uuid=UUIDjs.create(4).toString();uuid=uuid.replace(/-/g,""),cartStorage.setFingerPrintId(uuid),rawTemplate=rawTemplate.replace(/##token_id##/g,"TMOBILE"+cartStorage.getFingerPrintId()),element.append(rawTemplate).show(),elm.append(element)}return{restrict:"E",replace:!0,link:function(scope,elm){$timeout(function(){setFingerPrintId(scope,elm)},2e3)}}}var moduleName="tmobileApp",directiveName="fingerPrint";angular.module(moduleName).directive(directiveName,fingerPrintFn)}(angular),function(angular,lodash){"use strict";function searchBarController($rootScope,storeLocatorInitUtil,mapUtil,storeLocatorUtil,geoLocation,commonServices,storeLocatorModelService,pdlService,STORE_LOCATOR_STATE_NAME,toggleService,globalValue,searchBoxUtil){function submitSearch(){storeLocatorModelService.model.currentStore=storeLocatorModelService.model.store,autoSearch=!1,$timeout(function(){!navigatedAway&&getPlaceFromlatLng()},500)}function getPlaceFromlatLng(){var searchInput=vm.model.searchField.trim();return""===searchInput?!1:void searchBoxUtil.placeFromLatLng(searchInput).then(function(placeDetails){navigateTo(placeDetails,searchInput)},function(error){vm.model.clearSearchButton=!0,vm.model.sectionToDisplay="searchResultView",vm.model.invalidSearchAddress=!0,storeLocatorModelService.changeState({},!0)})}function navigateTo(placeDetails,searchInput){var stateParam={};return placeDetails.state&&!placeDetails.city?(stateParam={state:$filter("normalize")(placeDetails.state)},vm.model.storeList=[],navigatedAway=!0,void storeLocatorModelService.changeState(stateParam,!0,null,!0)):void getSearchResultsList(placeDetails.latLng,searchInput)}function getSearchResultsList(obtainedLatLng,searchInput){vm.model.sectionToDisplay="",vm.model.hideCompleteCarousel=!0,vm.model.currentPage="",vm.model.hideFindNearByStoreLink=!1,vm.model.zoomEventTriggeredManually=!1,vm.model.expandMileRadiusCount=0,vm.model.storeList=[],vm.model.cityList=[],vm.model.currentPageNumber=1,vm.model.storeSortByOption=vm.authoring.recommendedOption,vm.model.openNow=!1,vm.model.serveSprint=!1,vm.model.repairCenter=!1,getStoreList(obtainedLatLng,searchInput)}function getStoreList(latLng,searchInput){vm.model.spatialPointLatLng=latLng,vm.model.invalidSearchAddress=!1,storeLocatorUtil.getUpdatedStoreList(vm.model.miles,searchInput,autoSearch).then(function(){vm.model.storeLocatorInModal&&(vm.model.d2rModelManager.firstTimeInventoryLoad=!0),vm.model.store.nearbyStores=[],mapUtil.setMarkers(!0,[vm.model.storeList],0,null),$rootScope.$broadcast("apply-inventory-filter")});var stateParam={search:searchInput,page:vm.model.currentPageNumber,sortBy:"type1"};storeLocatorModelService.changeState(stateParam,!0)}function clearSearch(){vm.model.searchField="",vm.model.zoomEventTriggeredManually=!1,vm.model.searchResultsCleared=!0,vm.model.clearSearchButton=!1,vm.model.start=1,vm.model.end=vm.model.maxStoreDisplay,vm.model.hideCompleteCarousel=!1,vm.model.currentPageNumber=1,storeLocatorModelService.changeState({},!0),storeLocatorInitUtil.afterMapLoad(),vm.model.sectionToDisplay=""}function showCloseButton(){vm.model.clearSearchButton=!0,vm.helperTextFlag=!0}function changeHelperText(){vm.helperTextFlag=!1}var vm=this,$filter=commonServices.$filter,$timeout=commonServices.$timeout,autoSearch=!1;vm.model=storeLocatorModelService.model,vm.authoring=globalValue.authorValue.storeauthoring.generalAuthoringStores,vm.digitalToRetailToggle=lodash.get(toggleService.model,"toggles.digitalToRetail",!1),vm.model.maxStoreDisplay=parseInt(vm.authoring.numberOfResults,10)||10;var options={types:["geocode"],componentRestrictions:{country:["us","pr"]},fields:["address_component","adr_address","alt_id","formatted_address","geometry","icon","id","name","permanently_closed","photo","place_id","plus_code","scope","type","url","utc_offset","vicinity"]},autocomplete=new google.maps.places.Autocomplete(document.querySelector("#storeSearchField"),options),navigatedAway=!1;autocomplete.addListener("place_changed",function(){navigatedAway=!1,autoSearch=!0;var place=autocomplete.getPlace();if(place)if(place.formatted_address){vm.model.searchField=place.formatted_address;var placeDetails=searchBoxUtil.placeFromAddress(place);navigateTo(placeDetails,vm.model.searchField.trim())}else vm.model.searchField=place.name}),vm.submitSearch=submitSearch,vm.clearSearch=clearSearch,vm.showCloseButton=showCloseButton,vm.changeHelperText=changeHelperText,vm.getStoreList=getStoreList,vm.getSearchResultsList=getSearchResultsList}searchBarController.$inject=["$rootScope","storeLocatorInitUtil","mapUtil","storeLocatorUtil","geoLocation","commonServices","storeLocatorModelService","pdlService","STORE_LOCATOR_STATE_NAME","toggleService","globalValue","searchBoxUtil"],angular.module("tmobileApp").controller("searchBarController",searchBarController)}(window.angular,window._),function(angular,lodash){"use strict";function userAddressController(checkOutModelService,shippingUtil,globalValue,coreServices,toggleService,checkOutConstants){var vm=this;vm.checkoutInfo=checkOutModelService.model.checkOutInfo,vm.shippingOptionChange=shippingUtil.shippingOptionChange,vm.authorValue=globalValue.authorValue;var dcpSelectedShippingOption=coreServices.cartStorage.getShippingOption();vm.checkoutInfo.initData.dcpSelectedShippingOption=dcpSelectedShippingOption}userAddressController.$inject=["checkOutModelService","shippingUtil","globalValue","coreServices","toggleService","checkOutConstants"],angular.module("tmobileApp").controller("UserAddressController",userAddressController)}(window.angular,window._),function(angular){"use strict";var searchResults={templateUrl:"app/storeLocator/components/searchResults/searchResults.tpl.html",controller:"searchResultsController",controllerAs:"vm",bindings:{onCloseModal:"&"}};angular.module("tmobileApp").component("searchResults",searchResults)}(window.angular),function(angular){"use strict";function expertBarController(checkOutModelService,globalValue){var vm=this;vm.checkOutInfo=checkOutModelService.model.checkOutInfo,vm.authorValue=globalValue.authorValue}expertBarController.$inject=["checkOutModelService","globalValue"],angular.module("tmobileApp").controller("ExpertBarController",expertBarController)}(window.angular),function(angular,lodash){"use strict";function searchResultsController($rootScope,toggleService,storeLocatorModelService,pdlService,commonUtils,storeLocatorUtil,storeLocatorConstants,globalValue,storeFilterUtil,commonServices){function expandRadius(){vm.model.zoomEventTriggeredManually=!1;var broadenSearchRadius=lodash.get(vm.authoring.storeFilters,"broadenSearchRadius"),miles=broadenSearchRadius*vm.model.expandMileRadiusCount;storeLocatorUtil.getUpdatedStoreList(miles)}function searchClick(){angular.element(".sl-select-option").slideToggle()}function optionClick(selectedOption){vm.sortOptions.value=selectedOption,angular.element(".sl-select-option").slideToggle(),$timeout(function(){vm.model.sectionToDisplay=""}),storeFilterUtil.setTempFilters(vm.sortOptions.value),$timeout(function(){storeFilterUtil.applyFilter("sortOrder","Sort Modal",filterOptions)})}function filterByOpenStores(){filterOptions.openNow=vm.openNow,storeFilterUtil.applyFilter(vm.authoring.generalAuthoringStores.openNowLabel,"Sort Modal",filterOptions)}function filterByServeSprintStores(){filterOptions.serveSprint=vm.serveSprint,storeFilterUtil.applyFilter(vm.authoring.generalAuthoringStores.serveSprintLabel,"Sort Modal",filterOptions)}function filterByRepairCenterStores(){filterOptions.repairCenter=vm.repairCenter,storeFilterUtil.applyFilter(vm.authoring.generalAuthoringStores.repairCenterLabel,"Sort Modal",filterOptions)}function checkIfSRCPresent(){if(vm.model.storeList.length){var allSrcStore=vm.model.storeList.filter(function(obj){return obj.deviceRepair===!0});return allSrcStore.length}return!1}var vm=this;vm.model=storeLocatorModelService.model,vm.toggles=toggleService.model.toggles,vm.pages=storeLocatorConstants.PAGES,vm.authoring=globalValue.authorValue.storeauthoring,vm.storeSortByOption=vm.model.storeSortByOption||vm.authoring.generalAuthoringStores.recommendedOption;var $timeout=commonServices.$timeout;vm.openNow=vm.toggles.enableSLPOpenNow&&vm.model.openNow,vm.serveSprint=vm.toggles.sprintFiltersEnabled&&vm.model.serveSprint,vm.repairCenter=vm.toggles.sprintFiltersEnabled&&vm.model.repairCenter;var filterOptions={openNow:vm.openNow,serveSprint:vm.serveSprint,repairCenter:vm.repairCenter};vm.sortOptions={value:vm.storeSortByOption,values:[vm.authoring.generalAuthoringStores.recommendedOption,vm.authoring.generalAuthoringStores.distanceOption]},toggleService.model.toggles.enableProductRepairCenter&&vm.sortOptions.values.push(vm.authoring.generalAuthoringStores.productRepairCentersOption),vm.model.storeList=storeLocatorUtil.sortStoresByType(vm.model.completeStoreList,vm.sortOptions.value),vm.storeFilterAuthoring=lodash.get(globalValue.authorValue.storeauthoring,"storeFilters",""),vm.inStoreWaitTimes=[],$rootScope.$broadcast("SL_SEO_UPDATE",{}),vm.showOperationSection=storeLocatorModelService.showOperationSection,vm.CTANavOrClickEvent=pdlService.CTANavOrClickEvent,vm.expandRadius=expandRadius,vm.isNoNearbyStoreWithInventory=storeLocatorModelService.isNoNearbyStoreWithInventory,vm.searchClick=searchClick,vm.optionClick=optionClick,vm.filterByOpenStores=filterByOpenStores,vm.filterByServeSprintStores=filterByServeSprintStores,vm.filterByRepairCenterStores=filterByRepairCenterStores,vm.checkIfSRCPresent=checkIfSRCPresent,vm.isProductRepairCenterPresent=checkIfSRCPresent()}searchResultsController.$inject=["$rootScope","toggleService","storeLocatorModelService","pdlService","commonUtils","storeLocatorUtil","storeLocatorConstants","globalValue","storeFilterUtil","commonServices"],angular.module("tmobileApp").controller("searchResultsController",searchResultsController)}(window.angular,window._),function(angular,lodash){"use strict";function checkOutProgressController(checkOutModelService,modalDialogFactory,toggleService,globalValue,checkOutConstants,cartCommonOperationsService,cartStorage,commonStorage){var vm=this;vm.model={},vm.setSectionToBeDisplayed=checkOutModelService.setSectionToBeDisplayed,vm.openPriceBreakdownModal=modalDialogFactory.openPriceBreakDownModal,vm.openFinalizeCart=cartCommonOperationsService.openFinalizeInStoreModal,vm.toggles=toggleService.model.toggles,vm.rootPageAuthorValue=globalValue.authorValue.rootPage,vm.REVIEW_SECTION=checkOutConstants.SECTIONS.REVIEW,vm.model.checkOutInfo=checkOutModelService.model.checkOutInfo,vm.commonStorage=commonStorage,vm.isBotShopping=!!cartStorage.getFbSessionId(),vm.openOrderDetailsModal=modalDialogFactory.openOrderDetailsModal,vm.isTPPOn=lodash.get(toggleService.model,"toggles.isTPPON",!1),vm.isTaxesEnabled=lodash.get(toggleService.model,"toggles.isTaxesEnabled",!1),vm.cartCommonOperationsService=cartCommonOperationsService,vm.orderDetailsEnabled=lodash.get(toggleService.model,"toggles.isCheckOutOrderDetailsEnabled",!1),vm.hcc=cartStorage.getHardCreditCheck()}checkOutProgressController.$inject=["checkOutModelService","modalDialogFactory","toggleService","globalValue","checkOutConstants","cartCommonOperationsService","cartStorage","commonStorage"],angular.module("tmobileApp").controller("CheckOutProgressController",checkOutProgressController)}(angular,_),function(angular){"use strict";var searchResultsItem={templateUrl:"app/storeLocator/components/searchResultsItem/searchResultsItem.tpl.html",controller:"searchResultsItemController",controllerAs:"vm",bindings:{item:"<",index:"@",onRowSelect:"&",onCloseModal:"&"}};angular.module("tmobileApp").component("searchResultsItem",searchResultsItem)}(window.angular),function(angular,lodash){"use strict";function dcpProductUtilConstructor($log,apiURLs,toggleService,globalAssetRepositoryConstants,cartConstants){function getSkuImage(image,findImage){var imagePath="";if(angular.isDefined(image)&&""!==image&&findImage){var imageProduct=_.find(image,{imgtype:findImage});return imagePath=angular.isDefined(imageProduct&&imageProduct.url)?imageProduct.url:""}return imagePath}function getBadgesAndPromotions(promotion,findPromo){var promoValue="";if(angular.isDefined(promotion)&&""!==promotion&&findPromo){var promoNode=_.find(promotion,{label:findPromo});return promoValue=angular.isDefined(promoNode&&promoNode.value)?promoNode.value:""}return promoValue}function getItemEipPriceAvailable(skuPrices){var itemEipPriceAvailable="false";return _.isEmpty(skuPrices)||angular.forEach(skuPrices,function(pricingOption){var eipPrice=_.get(pricingOption.skuPrice,"priceSummary.monthlyPrice.listPrice.amount",0);"BUILDING"===apiURLs[pricingOption.pricingOptionName]&&eipPrice>0&&(itemEipPriceAvailable="true")}),itemEipPriceAvailable}function getFullPrice(skuPrices){var fullPrice="";return _.isEmpty(skuPrices)||angular.forEach(skuPrices,function(pricingOption){"FRP"==pricingOption.pricingOptionName&&(fullPrice=_.get(pricingOption.skuPrice,"priceSummary.payNowPrice.listPrice.display",""))}),fullPrice}function getPurchasePrice(skuPrices){var purchasePrice="";return _.isEmpty(skuPrices)||angular.forEach(skuPrices,function(pricingOption){"FRP"==pricingOption.pricingOptionName&&(purchasePrice=_.get(pricingOption.skuPrice,"priceSummary.payNowPrice.salePrice.display",""))}),purchasePrice}function getInvStatus(availability){return angular.isDefined(availability&&availability.availabilityStatus)?availability.availabilityStatus:""}function getCreditName(pricingOptionName){var creditName="";return _.isEmpty(pricingOptionName)||(creditName=apiURLs[pricingOptionName]),creditName}function getPriceTypeAvailable(pricingOption,priceType){var priceTypeAvailable=!1;if(0==priceType){var frpPrice=_.get(pricingOption.skuPrice,"priceSummary.payNowPrice.listPrice.amount",0);frpPrice>0&&(priceTypeAvailable=!0)}if(1==priceType){var eipPrice=_.get(pricingOption.skuPrice,"priceSummary.monthlyPrice.salePrice.amount",0);eipPrice>0&&(priceTypeAvailable=!0)}return priceTypeAvailable}function getPricingData(skuPrices){var arrPricing=[];return _.isEmpty(skuPrices)||angular.forEach(skuPrices,function(pricingOption){if(!_.isEmpty(pricingOption))for(var i=0;2>i;i++){var pricingDataToPush={creditLevel:getCreditName(pricingOption.pricingOptionName),type:0==i?"FRP":"EIP",priceTypeAvailable:getPriceTypeAvailable(pricingOption,i),monthlyAmount:getMonthlyAmount(pricingOption.pricingOptionName,i,_.get(pricingOption,"skuPrice.priceSummary.monthlyPrice")),payNowAmount:getPayNowAmount(pricingOption.pricingOptionName,i,_.get(pricingOption,"skuPrice.priceSummary.payNowPrice")),components:getPricingComponent(i,_.get(pricingOption,"skuPrice.priceSummary.payNowPrice"),_.get(pricingOption,"skuPrice.priceSummary.monthlyPrice"))};arrPricing.push(pricingDataToPush)}}),arrPricing}function getPricingComponent(priceType,payNowPrice,monthlyPrice){var components;if(0==priceType)var components=[{name:"FRP",listPrice:{amount:_.get(payNowPrice,"listPrice.amount",0),currency:_.get(payNowPrice,"listPrice.currency","USD"),display:_.get(payNowPrice,"listPrice.display","0.00")},purchasePrice:{amount:_.get(payNowPrice,"salePrice.amount",0),currency:_.get(payNowPrice,"salePrice.currency","USD"),display:_.get(payNowPrice,"salePrice.display","0.00")},frequency:"onetime"}];else components=[{name:"pay-now",listPrice:{amount:_.get(payNowPrice,"listPrice.amount",0),currency:_.get(payNowPrice,"listPrice.currency","USD"),display:_.get(payNowPrice,"listPrice.display","0.00")},purchasePrice:{amount:_.get(payNowPrice,"salePrice.amount",0),currency:_.get(payNowPrice,"salePrice.currency","USD"),display:_.get(payNowPrice,"salePrice.display","0.00")},frequency:"onetime"},{name:"pay-monthly",listPrice:{amount:_.get(monthlyPrice,"listPrice.amount",0),currency:_.get(monthlyPrice,"listPrice.currency","USD"),display:_.get(monthlyPrice,"listPrice.display","0.00")},purchasePrice:{amount:_.get(monthlyPrice,"salePrice.amount",0),currency:_.get(monthlyPrice,"salePrice.currency","USD"),display:_.get(monthlyPrice,"salePrice.display","0.00")},frequency:"monthly"}];return components}function getPayNowAmount(pricingOptionName,priceType,payNowPrice){var payNowAmount;return payNowAmount=_.isEmpty(pricingOptionName)||"NONE"!=apiURLs[pricingOptionName]||1!=priceType?{amount:_.get(payNowPrice,"listPrice.amount",0),currency:_.get(payNowPrice,"listPrice.currency","USD"),display:_.get(payNowPrice,"listPrice.display","0.00"),taxInclusive:!1}:{currency:_.get(payNowPrice,"listPrice.currency","USD"),taxInclusive:!1}}function getMonthlyAmount(pricingOptionName,priceType,monthlyPrice){var monthlyAmount;return monthlyAmount=0==priceType?{amount:0,currency:"USD",display:"0.00",contractTerm:"",taxInclusive:!1}:_.isEmpty(pricingOptionName)||"NONE"!=apiURLs[pricingOptionName]||1!=priceType?{amount:_.get(monthlyPrice,"salePrice.amount",0),currency:_.get(monthlyPrice,"salePrice.currency","USD"),display:_.get(monthlyPrice,"salePrice.display","0.00"),contractTerm:_.get(monthlyPrice,"salePrice.contractTerm",""),taxInclusive:!1}:{amount:0,currency:"USD",taxInclusive:!1}}function getCCDiscountAmount(payNowPrice){var discountAmount;return discountAmount=_.isEmpty(payNowPrice.pricingOptionName)||"NONE"!==apiURLs[payNowPrice.pricingOptionName]?_.get(payNowPrice.skuPrice,"priceSummary.payNowPrice.listPrice.display","0.00"):_.get(payNowPrice.skuPrice,"priceSummary.payNowPrice.salePrice.display","0.00")}function getCCPayNowAmount(payNowPrice){var eipPayNowAmount;return eipPayNowAmount=_.isEmpty(payNowPrice.pricingOptionName)||"NONE"!==apiURLs[payNowPrice.pricingOptionName]?_.get(payNowPrice.skuPrice,"priceSummary.payNowPrice.salePrice.display","0.00"):_.get(payNowPrice.skuPrice,"priceSummary.payNowPrice.listPrice.display","0.00")}function getOfferData(offerData){var offers=[],dataToPush={name:"",description:"",displayname:""};if(angular.isDefined(offerData)&&""!==offerData)for(var i=0;i<offerData.length;i++)if("GOOD"===apiURLs[offerData[i].pricingOptionName]&&angular.isDefined(offerData[i].skuPrice.promotions)&&""!==offerData[i].skuPrice.promotions)for(var j=0;j<offerData[i].skuPrice.promotions.length;j++)dataToPush={name:offerData[i].skuPrice.promotions[j].promoName,description:getGARImagePathForOfferModal(offerData[i].skuPrice.promotions[j].longDescription),displayname:offerData[i].skuPrice.promotions[j].promoName},offers.push(dataToPush);return offers}function getGARImagePathForOfferModal(longDes){var longDescription=longDes;return toggleService.model.toggles.enableGar&&_.includes(longDes,"/content/dam")&&(longDescription=longDes.replace("/content/dam",globalAssetRepositoryConstants.url+"/content/dam")),longDescription}function getItemEipPriceAvailableFlag(skuPrices){var itemEipPriceAvailable=!1;return _.isEmpty(skuPrices)||angular.forEach(skuPrices,function(pricingOption){var eipPrice=_.get(pricingOption.skuPrice,"priceSummary.monthlyPrice.listPrice.amount",0);"BUILDING"===apiURLs[pricingOption.pricingOptionName]&&eipPrice>0&&(itemEipPriceAvailable=!0)}),itemEipPriceAvailable}function isEIPPricingDisplayEligible(productType,enableEIPAuthorFlag,nonEIPToggle,eipPriceTypeEligible){var eipDisplayEligibility=!0;return eipDisplayEligibility=productType===cartConstants.DEVICE_TYPE.ACCESSORY?nonEIPToggle?eipPriceTypeEligible:enableEIPAuthorFlag:nonEIPToggle?eipPriceTypeEligible:!0}function createAccessoryBrowseRequest(productInfo,sortParam,filterObjects,categoryType){var requestObject=angular.copy(cartConstants.REQ_DATA_MINI_PLP.ACCESSORY);return requestObject.pageNumber=productInfo.pageNumber,updateAccessoryCategory(requestObject,productInfo),updateSortOrderAndPagesizeInRequest(requestObject,sortParam,productInfo.pageSize,filterObjects,categoryType)}function updateSortOrderAndPagesizeInRequest(requestObject,sortParam,pageSizeValue,filterObjects,categoryType){var pageSize=pageSizeValue||"12";return angular.isDefined(filterObjects)&&updateFilterOrderInRequest(createFiltersArrForReq(filterObjects),requestObject,categoryType),sortParam===cartConstants.SORT_OPTIONS_VALUE.PRICE_LOW_TO_HIGH?updateSortorderInRequest(cartConstants.SORT_DIRECTION.ASCENDING,updatePageSizeInRequest(pageSize,requestObject)):updateSortorderInRequest(cartConstants.SORT_DIRECTION.DESCENDING,updatePageSizeInRequest(pageSize,requestObject))}function updatePageSizeInRequest(pageSize,currentRequestObject){return currentRequestObject.pageSize=pageSize,currentRequestObject}function updateSortorderInRequest(newSortOrder,currentRequestObject){return currentRequestObject.sortOptions[0].sortDirection=newSortOrder,currentRequestObject}function updateFilterOrderInRequest(filterObjects,currentRequestObject,categoryType){return filterObjects&&currentRequestObject&&(categoryType===cartConstants.DEVICE_TYPE_IN_LOWER.HANDSET?currentRequestObject.filterOptionsSelected=[cartConstants.REQ_DATA_MINI_PLP.HANDSET.filterOptionsSelected[0]]:categoryType===cartConstants.DEVICE_TYPE_IN_LOWER.TABLET?currentRequestObject.filterOptionsSelected=[cartConstants.REQ_DATA_MINI_PLP.TABLET.filterOptionsSelected[0]]:currentRequestObject.filterOptionsSelected=angular.copy(cartConstants.REQ_DATA_MINI_PLP.ACCESSORY.filterOptionsSelected),angular.forEach(filterObjects,function(filterObject){currentRequestObject.filterOptionsSelected.push(filterObject)})),currentRequestObject}function createDeviceBrowseRequest(categoryType,authoredPageSize,sortParam,filterObjects){var requestObject=categoryType===cartConstants.DEVICE_TYPE_IN_LOWER.HANDSET?cartConstants.REQ_DATA_MINI_PLP.HANDSET:cartConstants.REQ_DATA_MINI_PLP.TABLET;return parseInt(authoredPageSize,10)&&(requestObject=updatePageSizeInRequest(authoredPageSize,requestObject)),angular.isDefined(filterObjects)&&filterObjects.length?requestObject=updateFilterOrderInRequest(createFiltersArrForReq(filterObjects),requestObject,categoryType):requestObject.filterOptionsSelected=categoryType===cartConstants.DEVICE_TYPE_IN_LOWER.HANDSET?[cartConstants.REQ_DATA_MINI_PLP.HANDSET.filterOptionsSelected[0]]:[cartConstants.REQ_DATA_MINI_PLP.TABLET.filterOptionsSelected[0]],lodash.isEmpty(sortParam)?requestObject:updateSortorder(sortParam,requestObject)}function createBrowseRequest(categoryType,sortParam,filterObjects,productInfo){switch(categoryType){case cartConstants.DEVICE_TYPE_IN_LOWER.ACCESSORY:return createAccessoryBrowseRequest(productInfo,sortParam,filterObjects,categoryType);case cartConstants.DEVICE_TYPE_IN_LOWER.HANDSET:case cartConstants.DEVICE_TYPE_IN_LOWER.TABLET:return createDeviceBrowseRequest(categoryType,productInfo.pageSize,sortParam,filterObjects)}}function createFiltersArrForReq(selectedFilterOptions){var selectedFiltersArray=[];return angular.forEach(selectedFilterOptions,function(filterOption){switch(filterOption.groupKey){case cartConstants.FILTER_OPTIONS.MANUFACTURER.URL_KEY:addFilterObjToArr(selectedFiltersArray,cartConstants.FILTER_OPTIONS.MANUFACTURER.VALUE,filterOption.label);break;case cartConstants.FILTER_OPTIONS.PRICE_RANGE.URL_KEY:addFilterObjToArr(selectedFiltersArray,cartConstants.FILTER_OPTIONS.PRICE_RANGE.VALUE,filterOption.label);break;case cartConstants.FILTER_OPTIONS.CONDITION.URL_KEY:addFilterObjToArr(selectedFiltersArray,cartConstants.FILTER_OPTIONS.CONDITION.VALUE,filterOption.label);break;case cartConstants.FILTER_OPTIONS.OPERATING_SYSTEM.URL_KEY:addFilterObjToArr(selectedFiltersArray,cartConstants.FILTER_OPTIONS.OPERATING_SYSTEM.VALUE,filterOption.label)}}),selectedFiltersArray}function addFilterObjToArr(selectedFiltersArray,fieldName,fieldValue){var filterObj=selectedFiltersArray.find(function(element){return element.fieldName===fieldName});if(filterObj){var index=selectedFiltersArray.map(function(filters){return filters.fieldName}).indexOf(fieldName);selectedFiltersArray[index].values.push(fieldValue)}else filterObj=createFilterObj(fieldName,fieldValue),selectedFiltersArray.push(filterObj)}function createFilterObj(fieldName,fieldvalue){var filterObject={};return filterObject.values=[],filterObject.fieldName=fieldName,filterObject.values.push(fieldvalue),filterObject}function updateSortorderOptionValueAndDirection(requestObject,sortOptionValue,sortDirection){return requestObject.sortOptions[0].sortOptionValue=sortOptionValue,requestObject.sortOptions[0].sortDirection=sortDirection,requestObject}function updateSortorder(sortParam,requestObject){switch(sortParam){case cartConstants.SORT_OPTIONS_VALUE.FEATURED.URL_KEY:return updateSortorderOptionValueAndDirection(requestObject,cartConstants.SORT_OPTIONS_VALUE.FEATURED.VALUE,cartConstants.SORT_DIRECTION.ASCENDING);case cartConstants.SORT_OPTIONS_VALUE.PRICE_LOW_TO_HIGH:return updateSortorderOptionValueAndDirection(requestObject,cartConstants.SORT_OPTIONS_VALUE.FRP_PRICE,cartConstants.SORT_DIRECTION.ASCENDING);case cartConstants.SORT_OPTIONS_VALUE.PRICE_HIGH_TO_LOW:return updateSortorderOptionValueAndDirection(requestObject,cartConstants.SORT_OPTIONS_VALUE.FRP_PRICE,cartConstants.SORT_DIRECTION.DESCENDING);case cartConstants.SORT_OPTIONS_VALUE.BESTSELLER.URL_KEY:return updateSortorderOptionValueAndDirection(requestObject,cartConstants.SORT_OPTIONS_VALUE.BESTSELLER.VALUE,cartConstants.SORT_DIRECTION.ASCENDING);
case cartConstants.SORT_OPTIONS_VALUE.RATING.URL_KEY:return updateSortorderOptionValueAndDirection(requestObject,cartConstants.SORT_OPTIONS_VALUE.RATING.VALUE,cartConstants.SORT_DIRECTION.DESCENDING)}}function updateAccessoryCategory(requestObject,productInfo){!requestObject.accessoryCategory||productInfo.accessoryCategory!==cartConstants.ALL_CATEGORIES&&productInfo.accessoryCategory||delete requestObject.accessoryCategory,productInfo.accessoryCategory&&productInfo.accessoryCategory!==cartConstants.ALL_CATEGORIES&&(requestObject.accessoryCategory=productInfo.accessoryCategory)}return{getSkuImage:getSkuImage,getBadgesAndPromotions:getBadgesAndPromotions,getItemEipPriceAvailable:getItemEipPriceAvailable,getFullPrice:getFullPrice,getPurchasePrice:getPurchasePrice,getInvStatus:getInvStatus,getCreditName:getCreditName,getPayNowAmount:getPayNowAmount,getMonthlyAmount:getMonthlyAmount,getCCDiscountAmount:getCCDiscountAmount,getPriceTypeAvailable:getPriceTypeAvailable,getCCPayNowAmount:getCCPayNowAmount,getOfferData:getOfferData,getPricingData:getPricingData,getItemEipPriceAvailableFlag:getItemEipPriceAvailableFlag,getPricingComponent:getPricingComponent,isEIPPricingDisplayEligible:isEIPPricingDisplayEligible,createBrowseRequest:createBrowseRequest,updateAccessoryCategory:updateAccessoryCategory}}dcpProductUtilConstructor.$inject=["$log","apiURLs","toggleService","globalAssetRepositoryConstants","cartConstants"],angular.module("tmobileCore").factory("dcpProductUtil",dcpProductUtilConstructor)}(window.angular,window._),function(angular,lodash){"use strict";function searchResultsItemController(mapUtil,storeLocatorModelService,commonUtils,cartCommonOperationsService,toggleService,pdlService,commonServices,storeLocatorUtil,storeLocatorConstants,globalValue,digitalToRetailService,digitalToRetailConstant,storeDetailsUtil){function onSearchListMouseEnter(){mapUtil.selectMarkerWithHtml(vm.index,!0,!1,null)}function onSearchListMouseLeave(){mapUtil.selectMarkerWithHtml(vm.index,!1,!1,null)}function handleShowOperation(operation){storeLocatorModelService.model.store=vm.item,storeLocatorModelService.showOperationSection(operation)}function showStoreDetailPage(){if(storeLocatorModelService.model.currentStore=null,vm.model.ignoreLoadingBar=!0,storeLocatorModelService.model.storeLocatorInModal)vm.model.d2rModelManager.setStoresInSession(vm.item,vm.index),storeLocatorUtil.getInventoryOnChangeLocation(vm.model.d2rModelManager.getSKUArr(vm.model.pageType),vm.item),vm.onCloseModal();else{var stateRouteConfig=storeLocatorModelService.setStateConfig(vm.item),ctaName="SRP Blade Click: "+vm.item.name,targetUrl=commonServices.$location.path()+"/"+stateRouteConfig.state+"/"+stateRouteConfig.city+"/"+stateRouteConfig.storeName;pdlService.CTANavOrClickEvent(ctaName,targetUrl,!0,"","blade",void 0,void 0,vm.item.id),vm.model.nearByStoreSelected=vm.model.sectionToDisplay===storeLocatorConstants.SECTIONS.STORE_DETAILS,storeLocatorUtil.showStoreDetail(vm.item,vm.index)}}function showItemsCTAButton(){vm.showItemsCTAName=vm.hideItemslist?vm.storeauthoring.digitalToRetail.showItemCTA:vm.storeauthoring.digitalToRetail.hideItemCTA,vm.hideItemslist=!vm.hideItemslist}function isSelectedStore(){return vm.model.storeLocatorInModal&&vm.model.d2rModelManager.getSelectedStore().id===vm.item.id}function setStoreInventoryDetailsIfDigitalToRetail(){vm.model.pageType===vm.pages.CART||vm.model.pageType===vm.pages.CARTACCESSORIES?(vm.showItemsCTAName=vm.storeauthoring.digitalToRetail.showItemCTA,vm.item.inventoryDetails=lodash.map(vm.item.inventoryDetails,function(inventory){return inventory.availabilityCode=inventory.availabilityCode||digitalToRetailConstant.INVENTORY_STATUS_CODE.INV_UNKNOWN,inventory.inventoryMessage=vm.getInventoryStatusMessage(inventory.availabilityCode),inventory}),vm.item.inventoryDetails&&vm.item.inventoryDetails.length?(vm.item.inventoryMessage=vm.getInventoryStatusSummaryMessage(vm.item.inventoryDetails),vm.oneInStock=angular.isDefined(vm.isOneInStock(vm.item.inventoryDetails))):(vm.item.availabilityCode=vm.item.availabilityCode||digitalToRetailConstant.INVENTORY_STATUS_CODE.INV_UNKNOWN,vm.item.inventoryMessage=vm.getInventoryStatusMessage(vm.item.availabilityCode))):(vm.item.availabilityCode=vm.item.availabilityCode||digitalToRetailConstant.INVENTORY_STATUS_CODE.INV_UNKNOWN,vm.item.inventoryMessage=vm.getInventoryStatusMessage(vm.item.availabilityCode))}function getInventoryStatusMessage(availabilityCode){switch(availabilityCode){case digitalToRetailConstant.INVENTORY_STATUS_CODE.IN_STOCK:return vm.storeauthoring.digitalToRetail.inStock;case digitalToRetailConstant.INVENTORY_STATUS_CODE.FEW_LEFT:return vm.storeauthoring.digitalToRetail.fewLeft;case digitalToRetailConstant.INVENTORY_STATUS_CODE.OUT_OF_STOCK:return vm.storeauthoring.digitalToRetail.outOfStock;default:return vm.storeauthoring.digitalToRetail.inventoryStatusUnavailable}}function getInventoryStatusSummaryMessage(inventoryDetails){var inventoryMessage=vm.storeauthoring.digitalToRetail.inventoryStatusUnavailable,availableCount=lodash.filter(inventoryDetails,function(inv){return isInStock(inv.availabilityCode)}).length;return inventoryDetails.length===availableCount&&availableCount>1?inventoryMessage=vm.storeauthoring.digitalToRetail.allInStock:inventoryDetails.length===availableCount&&1===availableCount?inventoryMessage=103===inventoryDetails[0].availabilityCode?vm.storeauthoring.digitalToRetail.inStock:vm.storeauthoring.digitalToRetail.fewLeft:inventoryDetails.length>availableCount&&availableCount>0?inventoryMessage=availableCount+" "+vm.storeauthoring.digitalToRetail.fewInStock:0===availableCount&&inventoryDetails&&inventoryDetails.length&&inventoryDetails[0].availabilityCode===digitalToRetailConstant.INVENTORY_STATUS_CODE.OUT_OF_STOCK&&(inventoryMessage=vm.storeauthoring.digitalToRetail.outOfStock,vm.allOutOfStock=!0),inventoryMessage}function isInStock(availabilityCode){return digitalToRetailConstant.INVENTORY_STATUS_CODE.FEW_LEFT===availabilityCode||digitalToRetailConstant.INVENTORY_STATUS_CODE.IN_STOCK===availabilityCode}function isOneInStock(inventoryDetails){return lodash.find(inventoryDetails,function(inv){return inv.availabilityCode===digitalToRetailConstant.INVENTORY_STATUS_CODE.IN_STOCK||inv.availabilityCode===digitalToRetailConstant.INVENTORY_STATUS_CODE.FEW_LEFT})}function getItemsCtaText(){return vm.showItems?vm.storeauthoring.digitalToRetail.hideItemCTA:vm.storeauthoring.digitalToRetail.showItemCTA}var vm=this,forAriaState=lodash.get(vm.item,"location.address.addressRegion","");vm.stateabbr=forAriaState.split("").join(" "),vm.toggles=toggleService.model.toggles,vm.model=storeLocatorModelService.model,vm.showOperationSection=storeLocatorModelService.showOperationSection,vm.CTANavOrClickEvent=pdlService.CTANavOrClickEvent,vm.pages=storeLocatorConstants.PAGES,vm.isTprStore="RETAIL"===vm.item.type&&"(TPR)Third Party Retail"===vm.item.storeDefinition,vm.showItems=!1,vm.oneInStock=!1,vm.allOutOfStock=!1,vm.isDisplayWaitTime=!1,vm.isSprintOnlyStore=vm.item.hasSprintStack&&!vm.item.hasTmobileStack,vm.storeauthoring=globalValue.authorValue.storeauthoring,vm.productData=storeLocatorModelService.productData,vm.productAnalyticsData=Object.assign({},vm.item,vm.productData),vm.appointmentsMessage=globalValue.authorValue.storeauthoring.appointmentsAndWaitTime.appointmentsMessage;var waitTimeInfoText=commonUtils.searchJson(globalValue.authorValue.storeauthoring.appointmentsAndWaitTime,"waitTimeInfoText");if(vm.model.storeLocatorInModal&&(vm.availabilityMessage=digitalToRetailService.availabilityMessage),vm.item&&vm.item.location&&(!vm.item.emergencyHours||!storeDetailsUtil.isEmergencyClosed(vm.item.emergencyHours))){for(var localStoreHours=[],i=0;i<storeLocatorConstants.ALL_DAYS.length;i++){var finalDayValue=storeDetailsUtil.getConsolidatedArray(storeLocatorConstants.ALL_DAYS[i],vm.item.emergencyHours,vm.item.holidayHours,vm.item.standardHours);finalDayValue&&finalDayValue.length&&Array.prototype.push.apply(localStoreHours,finalDayValue)}vm.isDisplayWaitTime=storeLocatorUtil.isStoreOpenToDisplayWaitTime(localStoreHours,vm.item.location.utcOffset)}vm.inStoreWaitTime=+(null!==vm.item.inStoreWaitTime&&vm.item.inStoreWaitTime>=0&&vm.isDisplayWaitTime)?waitTimeInfoText.replace("_",vm.item.inStoreWaitTime):null,vm.isInStock=isInStock,vm.isOneInStock=isOneInStock,vm.getInventoryStatusSummaryMessage=getInventoryStatusSummaryMessage,vm.getInventoryStatusMessage=getInventoryStatusMessage,vm.setStoreInventoryDetailsIfDigitalToRetail=setStoreInventoryDetailsIfDigitalToRetail,vm.showStoreDetailPage=showStoreDetailPage,vm.showStoreAppointmentModel=storeLocatorUtil.showStoreAppointmentModel,vm.citySelected=storeLocatorModelService.citySelected,vm.onSearchListMouseEnter=onSearchListMouseEnter,vm.onSearchListMouseLeave=onSearchListMouseLeave,vm.handleShowOperation=handleShowOperation,vm.showItemsCTAButton=showItemsCTAButton,vm.openFinalizeInStoreOnCart=cartCommonOperationsService.openFinalizeInStoreModal,vm.isSelectedStore=isSelectedStore,vm.getItemsCtaText=getItemsCtaText,vm.toggles.digitalToRetail&&setStoreInventoryDetailsIfDigitalToRetail()}searchResultsItemController.$inject=["mapUtil","storeLocatorModelService","commonUtils","cartCommonOperationsService","toggleService","pdlService","commonServices","storeLocatorUtil","storeLocatorConstants","globalValue","digitalToRetailService","digitalToRetailConstant","storeDetailsUtil"],angular.module("tmobileApp").controller("searchResultsItemController",searchResultsItemController)}(window.angular,window._),function(angular,lodash){"use strict";function priceBreakdownCtrlFn($scope,selectedLine,$modalInstance,globalValue,cartHttpDataService,keyValues,source,cartStorage,cartCommonOperationsService,creditClassService,session,checkOutValidationUtil,toggleService,CartUtils,skuPriceService,apiService,cartConstants,transformCartV2,essentialsService){function close(){$modalInstance.close()}function calculateShortestEIPTerm(cartItems){var shortestEIPTerm,eipTerms=[];return cartItems&&(cartItems.accessories||cartItems.lineItems)&&(cartItems.lineItems&&angular.forEach(cartItems.lineItems,function(value,key){angular.equals(value.lineItemDetails.deviceDetails.productType,cartConstants.DEVICE)&&angular.equals(value.lineItemDetails.deviceDetails.pricingOption,cartConstants.MONTHLY)&&angular.isDefined(value.lineItemDetails.deviceDetails.monthlyPrice)&&eipTerms.push(value.lineItemDetails.deviceDetails.monthlyPrice.termMonths)}),cartItems.accessories&&angular.forEach(cartItems.accessories.accessoryDetails,function(value,key){angular.equals(value.paymentOption,cartConstants.EIP)&&angular.isDefined(value.monthlyPrice.termMonths)&&eipTerms.push(value.monthlyPrice.termMonths)}),eipTerms.length>0&&(shortestEIPTerm=Math.min.apply(Math,eipTerms),vm.isFRPOnlyCart=!1)),shortestEIPTerm}function showAccesoryImage(imageUrl){return angular.isUndefined(imageUrl)||""===imageUrl?"":imageUrl}function calculateTotalFinancedAmount(){vm.showFinancedAmount&&(vm.totalFinancedAmount=transformCartV2.totalFinanceAmountCalculation(vm.cartObj))}function init(){vm.showAccesoryImage=showAccesoryImage,vm.calculateShortestEIPTerm=calculateShortestEIPTerm,vm.keyValues=keyValues,vm.authorValue=globalValue.authorValue.rootPage,vm.cartObj=cartStorage.getGlobalSmartCartInfo(),vm.cartCommonOperationsService=cartCommonOperationsService,vm.selectedCreditCls=creditClassService.getCreditClass(),vm.toggles=toggleService.model.toggles,vm.isBotShopping=!!cartStorage.getFbSessionId(),vm.close=close,vm.showFinancedAmount=lodash.get(toggleService.model,"toggles.showFinancedAmount",!1),vm.totalFinancedAmount=0,vm.isTaxesEnabled=lodash.get(toggleService.model,"toggles.isTaxesEnabled",!1),vm.toggles.apiVersion2&&skuPriceService.getAllSkuPrices(vm.cartObj),vm.showFinancedAmount&&calculateTotalFinancedAmount(),vm.eipLegalText="",vm.isEIPCartItemAvailable=!1,vm.viewOrdDetailsATv2&&(vm.shortestEIPTerm=calculateShortestEIPTerm(vm.cartObj),vm.shortestEIPTerm&&(vm.isEIPCartItemAvailable=!0,vm.eipLegalText=angular.isDefined(vm.authorValue.pricingBreakdown.shortestEIPLegalText)?vm.authorValue.pricingBreakdown.shortestEIPLegalText.replace("{shortestEIPTerm}",vm.shortestEIPTerm):"")),vm.totalFinanceAmtStaticLabel=cartConstants.TOTAL_FINANCE_AMOUNT}var vm=this;vm.viewOrdDetailsATv2=lodash.get(toggleService.model,"toggles.viewOrdDetailsATv2"),vm.isVerifiedCRPForTPP=cartCommonOperationsService.isCRPVerifiedForTPP(),vm.source=source,init()}var controllerName="PriceBreakdownController";angular.module("tmobileApp").controller(controllerName,priceBreakdownCtrlFn)}(window.angular,window._),function(angular){"use strict";var searchResultsPagination={templateUrl:"app/storeLocator/components/searchResultsPagination/searchResultsPagination.tpl.html",controller:"searchResultsPaginationController",controllerAs:"vm",bindings:{authorValue:"<"}};angular.module("tmobileApp").component("searchResultsPagination",searchResultsPagination)}(window.angular),function(angular,lodash,uuid){"use strict";function finalizeInStoreControllerFunction($modalInstance,globalValue,cartHttpDataService,toggleService,cartCommonOperationsService,cartStorage,pdlService,cartConstants,commonServices,salesForceUtil,D2RModelManager,storeLocatorUtil,storeLocatorModelService,pdlConstant,checkOutValidationUtil){function close(){$modalInstance.dismiss()}function finalizeInStore(){var inputForProfile,inputForSaveCart;inputForProfile={firstName:vm.inputData.firstName?vm.inputData.firstName.toLowerCase():".",lastName:vm.inputData.lastName?vm.inputData.lastName.toLowerCase():".",phoneNo:vm.inputData.phoneNumber?vm.inputData.phoneNumber:"",email:vm.inputData.email.toLowerCase()},inputForSaveCart={email:vm.inputData.email.toLowerCase()};var inputForProfileV3={firstName:vm.inputData.firstName?vm.inputData.firstName.toLowerCase():".",lastName:vm.inputData.lastName?vm.inputData.lastName.toLowerCase():".",phoneNumber:vm.inputData.phoneNumber?vm.inputData.phoneNumber:"",emailId:vm.inputData.email.toLowerCase()},isDcpV3ApiEnabled=lodash.get(toggleService.model,"toggles.isDcpV3ApiEnabled");lodash.isEqual(isDcpV3ApiEnabled,!0)?cartHttpDataService.updateProfileInfoV3(inputForProfileV3).then(function(){}):cartHttpDataService.updateProfileInfo(inputForProfile).then(function(){}),cartHttpDataService.findCart(inputForSaveCart).then(function(saveCartResponse){if(201===saveCartResponse.status){close(),cartStorage.setFinalizeInStoreFlag(!0);var commonResolveData=[{key:"orderInStoreData",value:vm.inputData}];salesForceCartToRetailAPI&&(vm.inputData.cartType=cartConstants.SF_CART_TYPE.SEND_TO_RETAIL,vm.inputData.transactionId=transactionId,salesForceUtil.createAndSaveRetailCart(vm.inputData).then(function(success){$log.info("ExitPathConfirmation : Data Sent to SalesForce"),pdlService.orderInStoreFormComplete(pdlDataFormComplete)})["catch"](function(error){lodash.isEqual(finaliseSaveCart,!0)&&(vm.isCartFailedSave=!0),$log.error("ExitPathConfirmation : Failed to sent SalesForce")})),vm.isCartFailedSave===!1&&cartCommonOperationsService.finalizeInStoreThankYouModal(commonResolveData)}else 200===saveCartResponse.status?(vm.overrideCart=!0,cartCommonOperationsService.model.isOverrideCart=!0):lodash.isEqual(finaliseSaveCart,!0)?vm.isCartFailedSave=!0:close()})["catch"](function(error){lodash.isEqual(finaliseSaveCart,!0)&&(vm.isCartFailedSave=!0),$log.error("Failed to sent DCP")})}function overrideYourCart(){var inputForSaveCart;inputForSaveCart={email:vm.inputData.email.toLowerCase()},cartHttpDataService.saveCart(inputForSaveCart).then(function(responseData){if(angular.equals(responseData.status,201)){close(),cartStorage.setFinalizeInStoreFlag(!0);var commonResolveData=[{key:"orderInStoreData",value:vm.inputData}];salesForceCartToRetailAPI&&(vm.inputData.cartType=cartConstants.SF_CART_TYPE.SEND_TO_RETAIL,vm.inputData.transactionId=transactionId,salesForceUtil.createAndSaveRetailCart(vm.inputData).then(function(success){pdlService.orderInStoreFormComplete(pdlDataFormComplete),$log.info("ExitPathConfirmation : Data Sent to SalesForce")})["catch"](function(error){lodash.isEqual(finaliseSaveCart,!0)&&(vm.isCartFailedSave=!0),$log.error("ExitPathConfirmation : Failed to sent SalesForce")})),vm.isCartFailedSave===!1&&cartCommonOperationsService.finalizeInStoreThankYouModal(commonResolveData)}else lodash.isEqual(finaliseSaveCart,!0)?vm.isCartFailedSave=!0:close()})["catch"](function(error){lodash.isEqual(finaliseSaveCart,!0)&&(vm.isCartFailedSave=!0),$log.error("Failed to sent DCP")})}function fieldOnFocusEvent(){if(isFormUntouched){isFormUntouched=!1;var formData={formName:pdlConstant.FORM_NAME.ORDER_IN_STORE_TO_RETAIL,modalName:pdlConstant.MODAL_DATA.FINALIZE_IN_STORE};pdlService.orderInStoreFormStartEvent(formData)}}function init(){var webOffer=cartStorage.getWebOnlyInfo(),showWebOnly=lodash.get(toggleService.model,"toggles.showWebOnly");if(lodash.isNil(webOffer)||lodash.isEmpty(webOffer)||lodash.forEach(webOffer,function(item){lodash.isEqual(item.WebOnly,"true")&&lodash.isEqual(showWebOnly,!0)&&(vm.showDiv=!0)}),digitalToRetailFlag&&digitalToRetailCartFlag&&d2rRetailSaveCartFlag)if(lodash.isEqual(cartCommonOperationsService.model.storeLocatorFlag,!0)){var getStoreData=angular.isObject(cartCommonOperationsService.model.storeLocationData)?cartCommonOperationsService.model.storeLocationData:angular.fromJson(cartCommonOperationsService.model.storeLocationData);vm.selectedStoreVal=getStoreData.name+" ("+getStoreData.id+")"}else getLocationData()}function getLocationData(){if(lodash.isNil(sessionStorage.getItem("selectedStore")))getLocation().then(getStores);else{var selectedStoreData=sessionStorage.getItem("selectedStore"),getStoreData=angular.isObject(selectedStoreData)?selectedStoreData:angular.fromJson(selectedStoreData);vm.selectedStoreVal=getStoreData.name+" ("+getStoreData.id+")"}}function getLocation(){return storeLocatorUtil.getUserLocation().then(function(data){vm.location=data},function(){$log.error("abort promise getLocation")})}function getStores(){return storeLocatorUtil.getStoreList(vm.location,storeModel.start,storeModel.d2rResultsCount,storeModel.miles,!0).then(function(storeResults){d2rModelManager.setStores(storeResults.data);var selectedStoreObj=d2rModelManager.getSelectedStore();vm.selectedStoreVal=selectedStoreObj.name+"  ("+selectedStoreObj.id+")"},function(){$log.error("abort promise getStores")})}var vm=this,$log=commonServices.$log;vm.selectedStoreVal="";var finaliseSaveCart=lodash.get(toggleService.model,"toggles.finaliseSaveCart"),transactionId=uuid.create().toString(),pdlDataFormComplete={formName:pdlConstant.FORM_NAME.ORDER_IN_STORE_TO_RETAIL,modalName:pdlConstant.MODAL_DATA.FINALIZE_IN_STORE_THANK_YOU,transId:transactionId};vm.validatePhoneOnChange=checkOutValidationUtil.validatePhoneOnChange,vm.isCartFailedSave=!1,vm.inputData={},vm.emailRegex=/^\s*[\w\-\+_]+(\.[\w\-\+_]+)*\@[\w\-\+_]+\.[\w\-\+_]+(\.[\w\-\+_]+)*\s*$/,vm.toggles=toggleService.model.toggles,vm.authorvalue=globalValue.authorValue.rootPage.saveCartModal,vm.showDiv=!1,vm.cisReqdImgPath=lodash.get(vm.authorvalue,"finalizeInStore.cisConsentImage"),vm.close=close,vm.finalizeInStore=finalizeInStore,vm.fieldOnFocusEvent=fieldOnFocusEvent,vm.overrideYourCart=overrideYourCart,vm.getLocation=getLocation,vm.getLocationData=getLocationData,vm.getStores=getStores,vm.location={};var digitalToRetailFlag=lodash.get(toggleService.model,"toggles.digitalToRetail",!1),digitalToRetailCartFlag=lodash.get(toggleService.model,"toggles.digitalToRetailCart",!1),d2rRetailSaveCartFlag=lodash.get(toggleService.model,"toggles.d2rRetailSaveCart",!1);init();var isFormUntouched=!0,salesForceCartToRetailAPI=lodash.get(toggleService.model,"toggles.salesForceCartToRetail",!1),cisConsentFromAuthor=lodash.get(vm.authorvalue,"cisMarketConsent");cisConsentFromAuthor&&(vm.inputData.consentObject=lodash.isArray(cisConsentFromAuthor)?cisConsentFromAuthor[cisConsentFromAuthor.length-1]:cisConsentFromAuthor,vm.inputData.consentObject.consentText=vm.inputData.consentObject.cisConsentText.replace(/\\n/g," "));var cisConsentFromAuthorRetail=lodash.get(vm.authorvalue,"cisMarketConsentRetail");if(cisConsentFromAuthorRetail&&(vm.inputData.consentObject=lodash.isArray(cisConsentFromAuthorRetail)?cisConsentFromAuthorRetail[cisConsentFromAuthorRetail.length-1]:cisConsentFromAuthorRetail,vm.inputData.consentObject.consentTextRetail=vm.inputData.consentObject.consentTextRetail.replace(/\\n/g," ")),digitalToRetailFlag&&digitalToRetailCartFlag&&d2rRetailSaveCartFlag)var storeModel=storeLocatorModelService.model,d2rModelManager=D2RModelManager.prototype.model()}finalizeInStoreControllerFunction.$inject=["$modalInstance","globalValue","cartHttpDataService","toggleService","cartCommonOperationsService","cartStorage","pdlService","cartConstants","commonServices","salesForceUtil","D2RModelManager","storeLocatorUtil","storeLocatorModelService","pdlConstant","checkOutValidationUtil"],angular.module("tmobileApp").controller("finalizeInStoreController",finalizeInStoreControllerFunction)}(window.angular,window._,window.UUIDjs),function(angular,lodash){"use strict";function searchResultsPaginationController(commonServices,storeLocatorModelService,mapUtil,storeLocatorUtil,globalValue,STORE_LOCATOR_STATE_NAME){function getInventory(){return storeLocatorUtil.setInventoryData(vm.model.d2rModelManager.getSKUArr(vm.model.pageType),storeLocatorUtil.getStoreIDsFromStoreList(vm.model.d2rModelManager.getAllStores()))}function pagination(moveTo){function setView(){$timeout(function(){lodash.isEmpty(commonServices.$stateParams.state)?lodash.isEmpty(commonServices.$stateParams.state)||lodash.isEmpty(commonServices.$stateParams.city)?vm.model.sectionToDisplay="searchResultView":vm.model.sectionToDisplay="cityResultsView":vm.model.sectionToDisplay="stateResultsView"}),mapUtil.setMarkers(!0,vm.model.storeList,vm.model.start,vm.model.end)}vm.model.filterJustApplied=!1,vm.scrollToTop();var mod=vm.model.storeList.length%vm.model.maxStoreDisplay;switch($timeout(function(){vm.model.sectionToDisplay=""}),moveTo){case"prev":vm.model.zoomEventTriggeredManually=!1,vm.model.start>vm.model.maxStoreDisplay&&(vm.model.start-=vm.model.maxStoreDisplay,vm.model.end-=mod>0&&vm.model.storeList.length===vm.model.end?mod:vm.model.maxStoreDisplay,vm.model.showNext=!0,vm.model.storeLocatorInModal?getInventory().then(function(){setStoreView(),setView()}):setView(),--vm.model.currentPageNumber),vm.model.start<vm.model.maxStoreDisplay&&(vm.model.showPrev=!1);break;case"next":vm.model.zoomEventTriggeredManually=!1,vm.model.end<vm.model.storeList.length&&(vm.model.start+=vm.model.maxStoreDisplay,vm.model.end+=vm.model.storeList.length-vm.model.end>=vm.model.maxStoreDisplay?vm.model.maxStoreDisplay:mod,vm.model.showPrev=!0,vm.model.storeLocatorInModal?getInventory().then(function(){setStoreView(),setView()}):setView(),++vm.model.currentPageNumber),vm.model.end>=vm.model.storeList.length&&(vm.model.showNext=!1)}var stateParam={page:vm.model.currentPageNumber};storeLocatorModelService.changeState(stateParam,!0,!0)}function setStoreView(){vm.model.storeFilterAuthor.applyFilter?vm.model.storeList=vm.model.d2rModelManager.getInStockStores():vm.model.storeList=vm.model.d2rModelManager.getAllStores()}var vm=this;vm.model=storeLocatorModelService.model,vm.authoring=globalValue.authorValue.storeauthoring.generalAuthoringStores;var $timeout=(commonServices.$state,commonServices.$timeout);vm.scrollToTop=function(){var elem=angular.element(".store-locator-container")[0];elem.scrollTop=0},vm.setStoreView=setStoreView,vm.pagination=pagination,vm.getInventory=getInventory}searchResultsPaginationController.$inject=["commonServices","storeLocatorModelService","mapUtil","storeLocatorUtil","globalValue","STORE_LOCATOR_STATE_NAME"],angular.module("tmobileApp").controller("searchResultsPaginationController",searchResultsPaginationController)}(window.angular,window._),function(angular){"use strict";function httpRequestWrapperConstructor($http,cartStorage,$stateParams,apiURLs,apiService,authTokenManager,inventoryAPI,cartConstants,toggleService,commonUtils){function createRequestObject(method,url,data,query,header,authRequired,apiKey){var requestObject={};if(requestObject.method=method,requestObject.url=url,requestObject.data=data,query&&query.ignoreLoadingBar&&(requestObject.ignoreLoadingBar=!0,delete query.ignoreLoadingBar),query){var qs=queryString.stringify(query);requestObject.url.indexOf("?")>0?requestObject.url=requestObject.url+"&"+qs:requestObject.url=requestObject.url+"?"+qs}if(header&&(requestObject.headers=header),authRequired&&(requestObject.authRequired=!0),($stateParams.fbId||"SC"===$stateParams.type)&&(requestObject.ignoreLoadingBar=!0),requestObject.headers=requestObject.headers?requestObject.headers:{},"pdp"===apiKey)requestObject.headers=getHeaders(),requestObject.headers.interactionid="sample";else if([constants.GET_ELIGIBLE_PLANS,constants.POST_PLAN_TO_LINE].indexOf(apiKey)>-1){requestObject.headers=getHeaders();var interactionId;if(commonUtils.isCommerceV3URL(url)){var authToken=authTokenManager.getTokenCookies("jwt_token",angular.equals(apiURLs.storage,"localStorage"));authToken&&(interactionId=authToken.usn),requestObject.headers.interactionId=angular.isDefined(interactionId)?interactionId:constants.DEFAULT_INTERACTIONID}}else if(apiKey===inventoryAPI.apiKey)requestObject.headers=getInventoryHeaders();else if("plpV2"===apiKey)requestObject.headers=getPLPV2Headers();else{var apiVersion=apiKey?apiService.getVersion(apiKey):1;if(2===apiVersion){if(requestObject.headers=requestObject.headers?requestObject.headers:{},requestObject.headers.channelID=["WEB"],requestObject.headers.applicationID=["TMO"],-1===url.indexOf("tradeinquotes")){var storageOption=angular.equals(apiURLs.storage,"localStorage"),interactionId=authTokenManager.getTokenCookies("interactionId",storageOption);requestObject.headers.interactionId=angular.isDefined(interactionId)?interactionId:"abc12354687"}}else if(3===apiVersion&&constants.TRADEIN_ELIGIBILITY.indexOf(apiKey)>-1)requestObject.headers=requestObject.headers?requestObject.headers:{},requestObject.headers.channelID=["WEB"],requestObject.headers.applicationID=["TMO"];else if(commonUtils.isCommerceV3URL(url)||commonUtils.isEOSURL(url)){var interactionId,authToken=authTokenManager.getTokenCookies("jwt_token",angular.equals(apiURLs.storage,"localStorage"));requestObject.headers=requestObject.headers?requestObject.headers:{},requestObject.headers.channelID=["WEB"],requestObject.headers.applicationID=["TMO"],requestObject.headers["content-type"]="application/json",authToken&&(interactionId=authToken.usn),requestObject.headers.interactionId=angular.isDefined(interactionId)?interactionId:"abc12354687"}else commonUtils.isLexisNexisUrl(url)&&(requestObject.headers=requestObject.headers?requestObject.headers:{},requestObject.headers["content-type"]="application/json")}return requestObject}function post(url,data,query,header,authRequired,apiKey){var requestObject=createRequestObject("POST",url,data,query,header,authRequired,apiKey);return $http(requestObject)}function put(url,data,query,header,authRequired,apiKey){var requestObject=createRequestObject("PUT",url,data,query,header,authRequired,apiKey);return $http(requestObject)}function get(url,query,header,authRequired,apiKey){var requestData;requestData=commonUtils.isCommerceV3URL(url)?"":void 0;var requestObject=createRequestObject("GET",url,requestData,query,header,authRequired,apiKey);return $http(requestObject)}function deleteRequest(url,query,header,authRequired,apiKey){var data="",requestObject=createRequestObject("DELETE",url,data,query,header,authRequired,apiKey);return $http(requestObject)}function patch(url,data,query,header,authRequired,apiKey){var requestObject=createRequestObject("PATCH",url,data,query,header,authRequired,apiKey);return $http(requestObject)}function getHeaders(){return{applicationid:constants.APPLICATION_ID_VALUE,channelid:constants.CHANNEL_ID_VALUE,"content-type":constants.CONTENT_TYPE_VALUE}}function getInventoryHeaders(){return{interactionid:inventoryAPI.interactionid,applicationid:inventoryAPI.applicationid,channelid:inventoryAPI.channelid,activityid:inventoryAPI.activityid,timestamp:(new Date).toISOString()}}function getPLPV2Headers(){return toggleService.model.toggles.mainPLPV2?{applicationid:constants.APPLICATION_ID_VALUE,channelid:constants.CHANNEL_ID_VALUE,"content-type":constants.CONTENT_TYPE_VALUE,transactionType:constants.TRANSACTION_CODE,interactionid:"sample"}:{applicationid:constants.APPLICATION_ID_VALUE,channelid:constants.CHANNEL_ID_VALUE,"content-type":constants.CONTENT_TYPE_VALUE,interactionid:"sample"}}var constants=cartConstants.ESSENTIALS_CONSTANT;return{post:post,get:get,put:put,"delete":deleteRequest,patch:patch}}httpRequestWrapperConstructor.$inject=["$http","cartStorage","$stateParams","apiURLs","apiService","authTokenManager","inventoryAPI","cartConstants","toggleService","commonUtils"],angular.module("tmobileApp").service("httpRequestWrapper",httpRequestWrapperConstructor)}(angular),function(angular){"use strict";function alignImageCaption($window){return{restrict:"A",link:function(scope,element,attrs){element.bind("load",function(){addOrRemoveStyle()}),angular.element($window).bind("resize",function(){addOrRemoveStyle()})}}}function addOrRemoveStyle(){var parentDiv=angular.element(document.getElementById("parentImageContainer")),childDiv=angular.element(document.getElementById("childImageContainer"));childDiv.prop("offsetWidth")<parentDiv.prop("offsetWidth")?childDiv.css({position:"relative"}):childDiv.css({position:"unset"})}angular.module("tmobileApp").directive("alignImageCaption",["$window",alignImageCaption])}(window.angular),function(angular,lodash){"use strict";function cartPromoCodeServiceConstructor(httpRequestWrapper,commonUtils,creditClassService,cartStorage,apiURLs,cartHttpWrapper,apiService,tmobNotificationService,globalValue,toggleService){function pushMessagekeyInShowNotificationArray(messageKey){tmobNotificationService.addNotification.push(messageKey),tmobNotificationService.showNotification(tmobNotificationService.addNotification)}function invalidPromoCodeNotification(promoInput){var errorMessageKey="cart028";angular.forEach(me.authorValue.cart.notifications.messages,function(value){value.messageKey===errorMessageKey&&(value.messageValue.indexOf("@promoCode")>-1&&(realAuthorValueInvalidPromo=angular.copy(value.messageValue)),value.messageValue=angular.copy(realAuthorValueInvalidPromo),value.messageValue=value.messageValue.replace("@promoCode",promoInput))}),pushMessagekeyInShowNotificationArray(errorMessageKey)}function validPromoCodeNotification(cartResponseStatus,promo){var promoCode,promoName,messageKey,promoObj,item=[];angular.forEach(cartResponseStatus.lineItems,function(value){0!==value.lineItemDetails.deviceDetails.promotions.cart.length&&(promoObj=value.lineItemDetails.deviceDetails.promotions.cart[0],promoObj.promoCode.toLowerCase()===promo.toLowerCase()&&(promoCode=promoObj.promoCode,promoName=promoObj.promoName,item.push(value.lineItemDetails.deviceDetails.familyName),messageKey="cart027"))}),promoCode||0!==cartResponseStatus.promotions.length&&angular.forEach(cartResponseStatus.promotions,function(value){value.promoCode.toLowerCase()===promo.toLowerCase()&&(promoCode=value.promoCode,promoName=value.promoName,messageKey="cart029")}),angular.forEach(me.authorValue.cart.notifications.messages,function(value){"cart027"===messageKey?value.messageKey===messageKey&&(value.messageValue&&value.messageValue.indexOf("@promoCode")>-1&&(realDeviceAuthorValueValidPromo=angular.copy(value.messageValue)),value.messageValue=angular.copy(realDeviceAuthorValueValidPromo),value.messageValue&&(value.messageValue=value.messageValue.replace("@promoCode",promoCode).replace("@promoName",promoName).replace("@item",item.join(", ")))):value.messageKey===messageKey&&(value.messageValue&&value.messageValue.indexOf("@promoCode")>-1&&(realCartAuthorValueValidPromo=angular.copy(value.messageValue)),
value.messageValue=angular.copy(realCartAuthorValueValidPromo),value.messageValue&&(value.messageValue=value.messageValue.replace("@promoCode",promoCode).replace("@promoName",promoName).replace("@item",item.join(", "))))}),pushMessagekeyInShowNotificationArray(messageKey)}function postPromoCode(promoCode,orderId){var urlObject=apiService.getURL("applyPromoCode"),apiURL=urlObject.url,header={},query=null;apiURL=apiURL.replace("{{cartID}}",cartStorage.getCartId());var requestBody;return 2===urlObject.version||3===urlObject.version?(requestBody={extCartId:orderId,code:promoCode},header.follow="TRUE"):(requestBody={orderID:orderId,code:promoCode},header=null),lodash.get(toggleService.model,"toggles.isDcpV3ApiEnabled",!1)||(query={creditLevel:creditClassService.getEPCreditClass()||"GOOD"}),cartHttpWrapper.post(apiURL,requestBody,query,"postPromoCode","applyPromoCode",header)}function deletePromoCode(promoCode,orderId){var deleteQuery,urlObject=apiService.getURL("removePromoCode"),apiURL=urlObject.url,header={};return 2===urlObject.version?(deleteQuery={extCartId:orderId,creditLevel:creditClassService.getEPCreditClass()||"GOOD"},header.follow="TRUE"):3===urlObject.version?(deleteQuery={extCartId:orderId},header.follow="TRUE"):(deleteQuery={orderID:orderId,creditLevel:creditClassService.getEPCreditClass()||"GOOD"},header=null),apiURL=apiURL.replace("{{cartID}}",cartStorage.getCartId()),apiURL=apiURL.replace("{{promoCode}}",promoCode),cartHttpWrapper["delete"](apiURL,deleteQuery,"deletePromoCode","removePromoCode",header)}var realAuthorValueInvalidPromo,realDeviceAuthorValueValidPromo,realCartAuthorValueValidPromo,me=this;return me.authorValue=globalValue.authorValue,me.postPromoCode=postPromoCode,me.deletePromoCode=deletePromoCode,me.invalidPromoCodeNotification=invalidPromoCodeNotification,me.validPromoCodeNotification=validPromoCodeNotification,me}cartPromoCodeServiceConstructor.$inject=["httpRequestWrapper","commonUtils","creditClassService","cartStorage","apiURLs","cartHttpWrapper","apiService","tmobNotificationService","globalValue","toggleService"],angular.module("tmobileApp").service("cartPromoCodeService",cartPromoCodeServiceConstructor)}(window.angular,window._),function(angular){"use strict";var storeDetails={templateUrl:"app/storeLocator/components/storeDetails/storeDetails.tpl.html",controller:"StoreDetailsController",controllerAs:"vm",bindings:{onBreadcrumbSelect:"&"}};angular.module("tmobileApp").component("storeDetails",storeDetails)}(window.angular),function(angular,lodash){"use strict";function accessoryService($rootScope,CartCommonModal,cartHttpDataService,transformCart,cartStorage,tmobNotificationService,creditClassService,$q,dataFactory,cartControllerHelperService,globalValue,toggleService,pdpResponseTransformationServicePDPV2){function obtainObject(input,callback){"miniBrowseAccessory"===input.openViewType?vm.getAccessoriesData(input).then(function(response){callback&&callback(vm.accessories)}):"miniPDPAccessory"===input.openViewType&&vm.getSelectedAccessoryData(input.accessoryOfferId).then(function(response){response=pdpResponseTransformationServicePDPV2.getTransformedV2APIResponse(response,toggleService.model.toggles.toggleV2API),callback&&callback(response)})}function checkPaymentOptionType(paymentOption){return vm.cartDetails=cartStorage.getGlobalSmartCartInfo(),"EIP"===paymentOption&&vm.cartDetails.accessories.isAccessoryEIPEligible}function checkAccessoryEIPEligiblity(){return vm.enableEIPforAccessories&&vm.cartDetails.accessories.isAccessoryEIPEligible}function getCreditClassObject(){var defaultClassObject={"class":"creditClass1",label:"AWESOME CREDIT",pricing_popup_text:"<p>Tmo Expert Banner TExt</p>Ã¢â€ Âµ",enable:"true",description:'You"ve got seller credit.'},creditClass=creditClassService.getCreditClass(),selectedCreditClass=angular.isDefined(creditClass)?creditClass:defaultClassObject;return angular.isUndefined(selectedCreditClass.label)&&angular.equals(selectedCreditClass["class"],"creditClass1")&&(selectedCreditClass.label="AWESOME CREDIT"),selectedCreditClass}function getPdpPrices(accessoryData){var pdpPricing={},selectedCreditClass=getCreditClassObject();return angular.forEach(accessoryData.pricing,function(key){"creditClass1"===selectedCreditClass["class"]&&"GOOD"===key.creditLevel&&"EIP"===key.type?(pdpPricing.todayPrice=key.payNowAmount.display,pdpPricing.monthlyPrice=key.monthlyAmount.display,pdpPricing.contractTerm=key.monthlyAmount.contractTerm):"creditClass2"===selectedCreditClass["class"]&&"BUILDING"===key.creditLevel&&"EIP"===key.type&&(pdpPricing.todayPrice=key.payNowAmount.display,pdpPricing.monthlyPrice=key.monthlyAmount.display,pdpPricing.contractTerm=key.monthlyAmount.contractTerm)}),pdpPricing.FRP=accessoryData.FullPrice,pdpPricing.FSP=accessoryData.PurchasePrice,pdpPricing}function getSelectedAccessoryData(offerId){return cartHttpDataService.getSelectedAccessoryData(offerId).then(function(response){return vm.variants=lodash.get(response,"data.productdetails",[]),response})}function getAccessoriesData(input){return cartHttpDataService.getAccessoriesData(input).then(function(response){return vm.accessories=lodash.get(response,"data",{}),response})}function deleteAccessoryFromCart(data){return cartHttpDataService.deleteAccessoryFromCart(data).then(function(transformedCart){vm.setCartDetails(transformedCart),vm.showAccessoryNudgeWhenEIP(!1,null)})}function bindImage(){vm.selectedAccessory.imageArray=[],vm.selectedAccessory.ProductImage=lodash.get(vm.selectedAccessory,"ProductImage","");var array=["FrontImage","BackImage","LeftImage","RightImage"];lodash.forEach(array,function(key){lodash.get(vm.selectedAccessory,key)&&vm.selectedAccessory.imageArray.push(vm.selectedAccessory[key])})}function getAccessoryAddedToCart(){return vm.setAccessoryAddedToCart}function disablePricingLink(){vm.setAccessoryAddedToCart=!1}function setCartDetails(cartDetail){vm.cartDetails=cartDetail;var _paymentOption=lodash.get(cartDetail,"accessories.accessoryDetails[0].paymentOption");vm.checkUserPaymentOption=angular.isDefined(_paymentOption)?_paymentOption:vm.checkUserPaymentOption,vm.isFRPPayment=!0,angular.isDefined(vm.cartDetails.accessories)&&(vm.cartDetails.accessories.accessoryDetails.forEach(function(value){"EIP"===value.paymentOption&&(vm.isFRPPayment=!1)}),vm.checkAccessoryEIPEligiblity()||(vm.isFRPPayment=!0))}function processAccessoryToCart(operationType,selectedAccessoryValue,$modalInstance){return"editAccessory"===operationType?(selectedAccessoryValue.cartParams.sku=selectedAccessoryValue.SKU,cartHttpDataService.editAccessoryInCart(selectedAccessoryValue).then(function(selectedCart){return 400===selectedCart.status?(vm.openAccessoryErrorModal(),!1):(vm.processCartOperationSuccessResponse(selectedCart,$modalInstance,"editAccessoryInCart"),tmobNotificationService.addNotification.push("cart014"),tmobNotificationService.showNotification(tmobNotificationService.addNotification),!0)})):(selectedAccessoryValue.cartParams.sku=selectedAccessoryValue.SKU||selectedAccessoryValue.sku,cartHttpDataService.addAccessoryToCart(selectedAccessoryValue).then(function(selectedCart){return 400===selectedCart.status?(vm.openAccessoryErrorModal(),!1):(vm.processCartOperationSuccessResponse(selectedCart,$modalInstance,"addAccessoryToCart"),tmobNotificationService.addNotification.push("cart013"),tmobNotificationService.showNotification(tmobNotificationService.addNotification),!0)}))}function processDeleteandAddAccessoryToCart(operationType,selectedAccessoryValue,$modalInstance){return"editAccessory"===operationType?(selectedAccessoryValue.cartParams.sku=selectedAccessoryValue.SKU,cartHttpDataService.deleteAccessoryFromCart(selectedAccessoryValue).then(function(response){return 200!==response.status?(vm.openAccessoryErrorModal(),!1):void cartHttpDataService.addAccessoryToCart(selectedAccessoryValue).then(function(selectedCart){return 400===selectedCart.status?(vm.openAccessoryErrorModal(),!1):(vm.processCartOperationSuccessResponse(selectedCart,$modalInstance,"editAccessoryInCart"),tmobNotificationService.addNotification.push("cart014"),tmobNotificationService.showNotification(tmobNotificationService.addNotification),!0)})})):(selectedAccessoryValue.cartParams.sku=selectedAccessoryValue.SKU||selectedAccessoryValue.sku,cartHttpDataService.addAccessoryToCart(selectedAccessoryValue).then(function(selectedCart){return 400===selectedCart.status?(vm.openAccessoryErrorModal(),!1):(vm.processCartOperationSuccessResponse(selectedCart,$modalInstance,"addAccessoryToCart"),tmobNotificationService.showNotification(["cart013"]),!0)}))}function processCartOperationSuccessResponse(selectedCart,$modalInstance,apiKey){var transformCartFactory=transformCart.getFactory(apiKey);vm.selectedAccessoryFromBrowse=transformCartFactory.transformCartData(selectedCart.data),cartStorage.setGlobalSmartCartInfo(vm.selectedAccessoryFromBrowse,!0),$modalInstance&&$modalInstance.close(vm.selectedAccessoryFromBrowse),vm.setAccessoryAddedToCart=!0,vm.cartDetails=vm.selectedAccessoryFromBrowse,vm.showAccessoryNudgeWhenEIP(!1,null),updateCartAccessory()}function showAccessoryNudgeWhenEIP(isSetCartDetails,updatedStructCartDetails,source){isSetCartDetails&&vm.setCartDetails(updatedStructCartDetails);var isEIPtoggle=cartStorage.isAccessoryEIPtoggle(),paymentOption=lodash.get(vm.cartDetails,"accessories.accessoryDetails[0].paymentOption");paymentOption=angular.isDefined(paymentOption)?paymentOption:"FRP",vm.checkUserPaymentOption=paymentOption,cartStorage.accessoryPaymentOption(paymentOption),isEIPtoggle===!1&&vm.checkAccessoryEIPEligiblity()&&"EIP"===paymentOption&&(source&&"frommainpdp"===source?cartStorage.eipNudge("cart017"):(vm.enableNudge=!0,tmobNotificationService.showNotification(["cart017"]),cartStorage.isAccessoryEIPtoggle(!0))),isEIPtoggle!==!0||vm.checkAccessoryEIPEligiblity()&&"FRP"!==paymentOption||(source&&"frommainpdp"===source?cartStorage.eipNudge("cart018"):(vm.enableNudge=!0,tmobNotificationService.showNotification(["cart018"]),cartStorage.isAccessoryEIPtoggle(!1)))}function init(){lodash.isEmpty(cartStorage.isAccessoryEIPtoggle())&&cartStorage.isAccessoryEIPtoggle(!1)}function getSelectedAccessory(options){var defer=$q.defer(),dfRequest=new dataFactory.DFRequest,openView=options.openView,offerId=options.offerId,accessoryId=options.accessoryId,paymentOptionData=options.paymentOption,skuCode=options.sku;return cartStorage.getAccessoryFamily(skuCode)||cartStorage.setAccessoryFamily(skuCode,offerId),dfRequest.input={accessoryOfferId:offerId,openViewType:"miniPDPAccessory"},dataFactory.getVO("miniPDPAccessories",dfRequest,function(responseData){var newAccessory;if(lodash.forEach(responseData.data.productdetails,function(item){accessoryId&&(item.id=accessoryId),item.paymentOption=paymentOptionData,item.SKU===skuCode&&(newAccessory=item)}),newAccessory||(newAccessory=responseData.data.productdetails[0]),vm.selectedAccessory=newAccessory,vm.selectedAccessory.originalPricing=newAccessory.pricing,vm.selectedAccessory.pdpPricing=vm.getPdpPrices(newAccessory),vm.bindImage(),vm.variants=responseData.data.productdetails,"editAccessory"!==openView){var status=getPaymentOptions(newAccessory);vm.selectedAccessory.paymentOption=status?"EIP":"FULL"}defer.resolve(vm.selectedAccessory)}),defer.promise}function getPaymentOptions(accessory){var showPaymentOptions=!1;return vm.showEIPPrices===!0&&accessory.itemEipPriceAvailable===!0?showPaymentOptions=!0:(vm.showEIPPrices===!1||1!=accessory.itemEipPriceAvailable)&&(showPaymentOptions=!1),showPaymentOptions}function openAccessoryMiniBrowse(){function browseModalCallBack(){}CartCommonModal.openCartModal("accessoriesMiniBrowse",null,browseModalCallBack)}function openAccessoryErrorModal(){function emptyCallBack(){}var modalData={errorHeader:lodash.get(globalValue,"authorValue.rootPage.accessoriesAuthoring.errorHeader"),errorBody:lodash.get(globalValue,"authorValue.rootPage.accessoriesAuthoring.errorBody")},commonResolves=cartControllerHelperService.commonResolves(null,null,null,modalData),resolveAttributes={resolve:angular.extend(commonResolves.keyValues)};CartCommonModal.openCartModal("alertMessageModal",resolveAttributes,emptyCallBack)}function getOfferId(options){var skuCode=options.sku,accessoryId=options.accessoryId,offerId=options.offerId,defer=$q.defer();return angular.isUndefined(offerId)?angular.isUndefined(cartStorage.getAccessoryFamily(skuCode))?cartHttpDataService.getSelectedDeviceData(skuCode).then(function(responseData){responseData.data&&responseData.data.products&&(vm.familyId=responseData.data.products[0].offerId,cartStorage.setAccessoryFamily(skuCode,vm.familyId),defer.resolve({offerId:vm.familyId,accessoryId:accessoryId}))}):(offerId=cartStorage.getAccessoryFamily(skuCode),defer.resolve({offerId:offerId,accessoryId:accessoryId})):defer.resolve({offerId:offerId,accessoryId:accessoryId}),defer.promise}function openSelectedAccessoryModal(options){var openView=options.openView,paymentOptionData=options.paymentOption,modalInstance=options.modalInstance,skuCode=options.sku;vm.getOfferId(options).then(function(accessoryDataId){var options={accessoryId:accessoryDataId.accessoryId,offerId:accessoryDataId.offerId,sku:skuCode,paymentOption:paymentOptionData,openView:openView};vm.getSelectedAccessory(options).then(function(accessoryDetails){function pdpModalCallBack(){}var _commonResolves=cartControllerHelperService.commonResolves(openView,accessoryDetails),resolveAttributes={resolve:angular.extend(_commonResolves.openView,_commonResolves.accessoryData)};"selectAccessory"===openView&&modalInstance.close(),CartCommonModal.openCartModal("accessoriesMiniPDP",resolveAttributes,pdpModalCallBack)})})}function openSelectedAccessoryModalFromCart(options){if(angular.isDefined(options)){var openView=options.openView,modalInstance=options.modalInstance;vm.getSelectedAccessory(options).then(function(accessoryDetails){var _commonResolves=cartControllerHelperService.commonResolves(openView,accessoryDetails),resolveAttributes={resolve:angular.extend(_commonResolves.openView,_commonResolves.accessoryData)};"selectAccessory"===openView&&modalInstance.close(),CartCommonModal.openCartModal("accessoriesMiniPDP",resolveAttributes,function(){})})}}function updateCartAccessory(){vm.cartObj=cartStorage.getGlobalSmartCartInfo(),vm.setCartDetails(vm.cartObj),$rootScope.$broadcast("cartAccessoryUpdated",vm.cartObj)}var vm=this;return vm.creditClass={creditClass1:"creditClass1",creditClass2:"creditClass2",creditClass3:"creditClass3"},vm.creditClassType={awesomeCredit:"Awesome credit",averageCredit:"Average credit",noCredit:"No credit"},vm.paymentOption="FULL",vm.accessories=[],vm.selectedAccessory=vm.variants={},vm.setAccessoryAddedToCart=!1,vm.cartDetails={},vm.selectedAccessoryFromBrowse={},vm.isFRPPayment=!0,vm.enableNudge=!1,vm.isAccessoryEIPtoggle=!1,vm.checkUserPaymentOption="FRP",vm.enableEIPforAccessories="",vm.openAccessoryMiniBrowse=openAccessoryMiniBrowse,vm.getSelectedAccessory=getSelectedAccessory,vm.openSelectedAccessoryModal=openSelectedAccessoryModal,vm.getOfferId=getOfferId,vm.deleteAccessoryFromCart=deleteAccessoryFromCart,vm.bindImage=bindImage,vm.getAccessoryAddedToCart=getAccessoryAddedToCart,vm.disablePricingLink=disablePricingLink,vm.setCartDetails=setCartDetails,vm.checkAccessoryEIPEligiblity=checkAccessoryEIPEligiblity,vm.getCreditClassObject=getCreditClassObject,vm.checkPaymentOptionType=checkPaymentOptionType,vm.getSelectedAccessoryData=getSelectedAccessoryData,vm.getAccessoriesData=getAccessoriesData,vm.obtainObject=obtainObject,vm.showAccessoryNudgeWhenEIP=showAccessoryNudgeWhenEIP,vm.processCartOperationSuccessResponse=processCartOperationSuccessResponse,vm.processAccessoryToCart=processAccessoryToCart,vm.getPdpPrices=getPdpPrices,vm.openAccessoryErrorModal=openAccessoryErrorModal,vm.getPaymentOptions=getPaymentOptions,vm.processDeleteandAddAccessoryToCart=processDeleteandAddAccessoryToCart,vm.openSelectedAccessoryModalFromCart=openSelectedAccessoryModalFromCart,vm.init=init,init(),vm}accessoryService.$inject=["$rootScope","CartCommonModal","cartHttpDataService","transformCart","cartStorage","tmobNotificationService","creditClassService","$q","dataFactory","cartControllerHelperService","globalValue","toggleService","pdpResponseTransformationServicePDPV2"],angular.module("tmobileApp").service("accessoriesService",accessoryService)}(angular,_),function(angular,lodash){"use strict";function storeDetailsController($rootScope,$timeout,$log,$state,commonServices,storeLocatorModelService,storeLocatorUtil,toggleService,pdlService,mapUtil,storeDetailsUtil,STORE_LOCATOR_STATE_NAME,storeLocatorConstants,globalValue,inventoryUtils,cartStorage,inventoryStatusService,$modal,$anchorScroll,$location){function getHeroImage(storeId){vm.heroImage=lodash.filter(heroImageAuthoring,function(store){return parseInt(store.signatureStoreId,10)===parseInt(storeId,10)});try{var modifiedCaption,actualCaption=vm.heroImage[0].eventFooterCaption?vm.heroImage[0].eventFooterCaption.trim():void 0;if(actualCaption){if(actualCaption.indexOf("@")>-1&&actualCaption.indexOf("<p>")>-1){var atSeparator=actualCaption.split("@"),paragraphSplitter=atSeparator[0].split("<p>");paragraphSplitter[1]='<span class="event-footer-caption">'+paragraphSplitter[1]+"</span>",paragraphSplitter=paragraphSplitter.join("<p>"),atSeparator=[paragraphSplitter,atSeparator[1]],modifiedCaption=atSeparator.join("@")}vm.heroImage[0].eventFooterCaption=modifiedCaption?modifiedCaption:'<span class="event-footer-caption">'+actualCaption+"</span>"}else vm.heroImage[0].eventFooterCaption=actualCaption}catch(e){$log.log("Error in setting footer caption!")}$log.log(vm.heroImage)}function getStoreHours(){var storeHours=[];storeHours=null!==vm.store.hours?storeDetailsUtil.getFormattedStoreHours(vm.store.hours):storeDetailsUtil.getFormattedHours(vm.store.hours,vm.store.holidayHours),vm.store.storeHours=storeHours}function getNewExpHoursData(){vm.title=storeDetailsUtil.checkForTitle(vm.storeDetailsAuthoring.specialHours,vm.storeDetailsAuthoring.holidayHours,vm.storeDetailsAuthoring.storeHoursLabel,vm.store.emergencyHours,vm.store.holidayHours,vm.store.npiHours),vm.emergencyClosed=vm.store.emergencyHours?storeDetailsUtil.isEmergencyClosed(vm.store.emergencyHours):!1;for(var i=0;i<vm.allDays.length;i++){var finalDayValue=storeDetailsUtil.getConsolidatedArray(vm.allDays[i],vm.store.emergencyHours,vm.store.holidayHours,vm.store.standardHours,vm.store.npiHours);finalDayValue&&finalDayValue.length&&Array.prototype.push.apply(vm.localStoreHours,finalDayValue)}return vm.updatedFormatedArray=storeDetailsUtil.formatConsolidatedArray(vm.localStoreHours),vm.formattedHours=storeDetailsUtil.getArrayToDisplay(vm.updatedFormatedArray),vm.emergencyClosed||(vm.isDisplayWaitTime=storeLocatorUtil.isStoreOpenToDisplayWaitTime(vm.localStoreHours,vm.store.location.utcOffset)),vm.formattedHours}function showMarkerOnMap(){storeLocatorModelService.changeState(),mapUtil.selectMarkerWithHtml(vm.model.selectedStoreIndex,!0,!0,null),vm.model.sectionToDisplay="",vm.model.hideCompleteCarousel=!1,vm.model.clearSearchButton=!0,$rootScope.$$postDigest(function(){vm.model.slickConfig.method.slickGoTo(vm.model.selectedStoreIndex)})}function searchNearbyStores(){vm.model.sectionToDisplay="",vm.model.hideCompleteCarousel=!0,vm.model.zoomEventTriggeredManually=!1,vm.model.storeList=[],vm.model.spatialPointLatLng=[vm.store.location.latitude,vm.store.location.longitude],vm.model.storeSortByOption="Store Type",storeLocatorUtil.getUpdatedStoreList(vm.model.miles),vm.model.storeList&&(vm.model.clearSearchButton=!0,vm.model.sectionToDisplay="searchResultView",vm.model.start=1,vm.model.end=vm.model.maxStoreDisplay,vm.model.showSTALink=!1,storeLocatorModelService.changeState())}function close(){$rootScope.$broadcast("CLOSE_STORE_DETAIL")}function init(){vm.toggles.enableNewSLEvents&&vm.store.eventIds&&vm.store.eventIds.length>0&&vm.getStoreEvents(vm.store.eventIds,vm.store.id).then(function(data){vm.upcomingEvents=data}),vm.getNewExpHoursData(),vm.toggles.aemServicesEnabled&&(vm.store.services=storeDetailsUtil.getStoreServices(vm.store)),vm.toggles.specialMessagesEnabled&&(vm.store.specialMessages=storeDetailsUtil.getSpecialMessages(vm.store)),vm.model.filterJustApplied=!1,vm.model.breadCrumbItems=storeLocatorUtil.getBreadcrumbItems(vm.store.location.address.addressRegion,vm.store.location.address.addressLocality,vm.store.name),!vm.model.isMobileView&&$window.innerWidth>500&&mapUtil.sendOffsets(400,0,0,0),storeLocatorUtil.getStoreList(spatialPoint,"",50,20,!0).then(function(response){angular.equals(response.status,200)?(vm.store.nearbyStores=response.data,vm.model.selectedStoreIndex="National Retail"===vm.store.type?_.findIndex(vm.store.nearbyStores,["type","National Retail"]):0,vm.model.storeLocatorInModal?$timeout(function(){vm.model.selectedStoreIndex=_.findIndex(vm.model.storeList,function(store){return store.id===vm.store.id})||0,vm.store.nearbyStores=lodash.filter(response.data,function(store){return"RETAIL"===store.type}),mapUtil.setMarkers(!0,vm.store.nearbyStores,1,0,!1,vm.model.selectedStoreIndex,!0),mapUtil.selectMarkerWithHtml(vm.model.selectedStoreIndex,!0,!0,null),vm.nearByStores=angular.copy(vm.store.nearbyStores),"National Retail"!==vm.store.type?vm.nearByStores.shift():null,vm.nearbyStores=vm.nearbyStores.slice(0,3)},2e3):(mapUtil.setMarkers(!0,vm.store.nearbyStores,1,0,!1,vm.model.selectedStoreIndex,!0),mapUtil.selectMarkerWithHtml(vm.model.selectedStoreIndex,!0,!0,null),vm.nearbyStores=angular.copy(vm.store.nearbyStores),"National Retail"!==vm.store.type?vm.nearbyStores.shift():null,vm.nearbyStores=vm.nearbyStores.slice(0,3)),$log.log("status nearByStores ",status)):vm.store.nearbyStores=[]})["catch"](function(error){vm.store.nearbyStores=[],$log.log("Something Went Wrong",error)});var city=vm.store.location.address.addressLocality;vm.store.description&&""!==vm.store.description?vm.store.description=vm.store.description.replace("[[CITY]]",city):vm.storeDetailsAuthoring&&vm.storeDetailsAuthoring.storeDescription&&(lodash.get(toggleService.model,"toggles.isSprintStoresEnabled",!1)?vm.store.hasSprintStack&&!vm.store.hasTmobileStack?vm.store.deviceRepair&&vm.storeDetailsAuthoring.sprintStoreRepairDescription?vm.store.description=vm.storeDetailsAuthoring.sprintStoreRepairDescription.replace("{CITY}",city):vm.storeDetailsAuthoring.sprintStoreDescription?vm.store.description=vm.storeDetailsAuthoring.sprintStoreDescription.replace("{CITY}",city):vm.store.description=vm.storeDetailsAuthoring.storeDescription.replace("{CITY}",city):vm.store.hasSprintStack&&vm.store.hasTmobileStack?vm.store.deviceRepair&&vm.storeDetailsAuthoring.dualStoreRepairDescription?vm.store.description=vm.storeDetailsAuthoring.dualStoreRepairDescription.replace("{CITY}",city):vm.storeDetailsAuthoring.dualStoreDescription?vm.store.description=vm.storeDetailsAuthoring.dualStoreDescription.replace("{CITY}",city):vm.store.description=vm.storeDetailsAuthoring.storeDescription.replace("{CITY}",city):vm.store.description=vm.storeDetailsAuthoring.storeDescription.replace("{CITY}",city):vm.store.description=vm.storeDetailsAuthoring.storeDescription.replace("{CITY}",city)),vm.storeDetailsAuthoring&&vm.storeDetailsAuthoring.nrStoreDescription&&(vm.store.nrStoreDescription=vm.storeDetailsAuthoring.nrStoreDescription.replace("{CITY}",city)),!vm.model.storeLocatorInModal||vm.model.pageType!==vm.pages.CART&&vm.model.pageType!==vm.pages.CARTACCESSORIES||vm.loadInventoryData(),!vm.model.storeLocatorInModal||vm.model.pageType!==vm.pages.PDP&&vm.model.pageType!==vm.pages.MINIPDP&&vm.model.pageType!==vm.pages.ACCESSORYMMINIPDP||vm.isMoreDataOpen(),vm.toggles.enableSLPhotoCarousel&&vm.store.photos&&(vm.photos=storeDetailsUtil.imageSelector(vm.store.photos,storeLocatorConstants.PREVIEW_STATE_IMAGE_CONTAINER_HEIGHT));var mainDiv=angular.element(".store-locator-container");vm.toggles.enableNewSLDetailTemplate&&angular.element(mainDiv).bind("scroll",function(){vm.scrollTo()}),(null===vm.store.directionsLink||""===vm.store.directionsLink)&&(vm.store.directionsLink="https://www.google.com/maps/dir/?api=1&origin=&destination="+vm.store.location.address.streetAddress+vm.store.location.address.addressLocality+vm.store.location.address.addressRegion+vm.store.location.address.postalCode)}function loadInventoryData(){var inventoryDetails,availableDeviceCount=0,isInventoryUnknown=!1;vm.SKUArray=inventoryStatusService.getCartSkuList();var cartObj=cartStorage.getGlobalSmartCartInfo();inventoryUtils.callInventoryAvailabilityAPI(vm.SKUArray,vm.store.id).then(function(inventoryData){angular.equals(inventoryData.data.statusCode,"200")&&(inventoryDetails=inventoryData.data.result.inventoryAvailabilityList[0].skuDetails,angular.forEach(cartObj.lineItems,function(line){var matchedDevice=lodash.find(inventoryDetails,{skuId:line.lineItemDetails.deviceDetails.sku});if(angular.isDefined(matchedDevice)&&"true"===matchedDevice.skuParticipation){var availableDeviceNames={};availableDeviceNames.name=line.lineItemDetails.deviceDetails.familyName,availableDeviceNames.statusCode=matchedDevice,vm.deviceDetails.push(availableDeviceNames),(103===matchedDevice.availabilityStatus||102===matchedDevice.availabilityStatus)&&availableDeviceCount++}else if(angular.isDefined(line.lineItemDetails.deviceDetails.familyName)){isInventoryUnknown=!0;var unknownDevices={};unknownDevices.name=line.lineItemDetails.deviceDetails.familyName,unknownDevices.statusCode={availabilityStatus:108},vm.deviceDetails.push(unknownDevices)}}),vm.toggles.d2rAccessories&&angular.forEach(cartObj.accessories.accessoryDetails,function(accessory){var matchedDevice=lodash.find(inventoryDetails,{skuId:accessory.sku});if(angular.isDefined(matchedDevice)&&"true"===matchedDevice.skuParticipation){var availableAccessoryNames={};availableAccessoryNames.name=accessory.familyName,availableAccessoryNames.statusCode=matchedDevice,vm.accessoryDetails.push(availableAccessoryNames),(103===matchedDevice.availabilityStatus||102===matchedDevice.availabilityStatus)&&availableDeviceCount++}else if(angular.isDefined(accessory.familyName)){isInventoryUnknown=!0;var unknownDevices={};unknownDevices.name=accessory.familyName,unknownDevices.statusCode={availabilityStatus:108},vm.accessoryDetails.push(unknownDevices)}}),vm.setAvailabilityMessage(availableDeviceCount,isInventoryUnknown),vm.toggleItemsView())})}function setAvailabilityMessage(availableCount,isInventoryUnknown){if(lodash.eq(lodash.size(vm.SKUArray),availableCount)&&lodash.gt(availableCount,1)?(vm.availabilityMsg=digitalToRetail.allInStock,vm.storeDetailsAuthoring.allInStockMessageRequired&&!vm.storeDetailsAuthoring.sameMessageForAll&&(vm.moreInfo=vm.storeDetailsAuthoring.messageForInventoryStatusAllInStock)):lodash.eq(lodash.size(vm.SKUArray),availableCount)&&lodash.eq(availableCount,1)?(1===vm.deviceDetails.length?vm.availabilityMsg=103===vm.deviceDetails[0].statusCode.availabilityStatus?digitalToRetail.inStock:digitalToRetail.fewLeft:1===vm.accessoryDetails.length&&(vm.availabilityMsg=103===vm.accessoryDetails[0].statusCode.availabilityStatus?digitalToRetail.inStock:digitalToRetail.fewLeft),vm.storeDetailsAuthoring.allInStockMessageRequired&&!vm.storeDetailsAuthoring.sameMessageForAll&&(vm.moreInfo=vm.storeDetailsAuthoring.messageForInventoryStatusAllInStock)):lodash.gt(lodash.size(vm.SKUArray),availableCount)&&(lodash.gt(availableCount,1)||lodash.eq(availableCount,1))?(vm.availabilityMsg=availableCount+" "+digitalToRetail.fewInStock,vm.storeDetailsAuthoring.fewAvailableMessageRequired&&!vm.storeDetailsAuthoring.sameMessageForAll&&(vm.moreInfo=vm.storeDetailsAuthoring.messageForInventoryStatusFewAvailable)):(vm.availabilityMsg=digitalToRetail.allOutOfStock,vm.allItemsOutOfStock=!0,vm.storeDetailsAuthoring.outOfStockMessageRequired&&!vm.storeDetailsAuthoring.sameMessageForAll&&(vm.moreInfo=vm.storeDetailsAuthoring.messageForInventoryStatusOutOfStock),isInventoryUnknown&&(lodash.isUndefined(digitalToRetail)||(vm.availabilityMsg=digitalToRetail.inventoryStatusUnavailable),vm.storeDetailsAuthoring.inventoryStatusUnknownMessageRequired&&!vm.storeDetailsAuthoring.sameMessageForAll&&(vm.moreInfo=vm.storeDetailsAuthoring.messageForInventoryStatusUnknown))),vm.storeDetailsAuthoring.sameMessageForAllCheckbox&&(vm.moreInfo=vm.storeDetailsAuthoring.sameMessageForAll),vm.deviceDetails&&!vm.accessoryDetails)var details=vm.deviceDetails;else if(vm.accessoryDetails&&vm.toggles.d2rAccessories&&!vm.deviceDetails)var details=vm.accessoryDetails;else if(vm.deviceDetails&&vm.accessoryDetails&&vm.toggles.d2rAccessories)var details=vm.deviceDetails.concat(vm.accessoryDetails);angular.forEach(details,function(inventory){switch(inventory.statusCode.availabilityStatus){case 101:inventory.statusCode.statusValue="- "+digitalToRetail.outOfStock;break;case 102:inventory.statusCode.statusValue="- "+digitalToRetail.fewLeft;break;case 103:inventory.statusCode.statusValue="- "+digitalToRetail.inStock;break;case 108:inventory.statusCode.statusValue="- "+digitalToRetail.inventoryStatusUnavailable;break;default:inventory.statusCode.statusValue=""}})}function toggleItemsView(){vm.toggleDisplay?(vm.showHideLabel=vm.storeDetailsAuthoring.showMoreLinkLabel,vm.toggleDisplay=!1):(vm.showHideLabel=vm.storeDetailsAuthoring.showLessLinkLabel,vm.toggleDisplay=!0)}function isMoreDataOpen(){vm.storeInventoryDetails&&(vm.inventoryStatusText=vm.storeInventoryDetails.statusValue,vm.inventoryStatusCode=vm.storeInventoryDetails.availabilityCode),vm.inventoryStatusCode===vm.status.STORE_UNKNOWN&&vm.storeDetailsAuthoring.storeUnknownMessageRequired&&!vm.storeDetailsAuthoring.sameMessageForAllStatusRequired?vm.moreInfo=vm.storeDetailsAuthoring.messageForInventoryStatusStoreUnknown:vm.inventoryStatusCode===vm.status.INVENTORY_UNKNOWN&&vm.storeDetailsAuthoring.inventoryStatusUnknownMessageRequired&&!vm.storeDetailsAuthoring.sameMessageForAllStatusRequired?vm.moreInfo=vm.storeDetailsAuthoring.messageForInventoryStatusUnknown:101===vm.inventoryStatusCode&&vm.storeDetailsAuthoring.noStockMessageRequired&&!vm.storeDetailsAuthoring.sameMessageForAllStatusRequired?vm.moreInfo=vm.storeDetailsAuthoring.messageForInventoryStatusNoStock:102===vm.inventoryStatusCode&&vm.storeDetailsAuthoring.limitedQuantityMessageRequired&&!vm.storeDetailsAuthoring.sameMessageForAllStatusRequired?vm.moreInfo=vm.storeDetailsAuthoring.messageForInventoryStatusLimitedQuantity:103===vm.inventoryStatusCode&&vm.storeDetailsAuthoring.inStockMessageRequired&&!vm.storeDetailsAuthoring.sameMessageForAllStatusRequired?vm.moreInfo=vm.storeDetailsAuthoring.messageForInventoryStatusInStock:vm.storeDetailsAuthoring.sameMessageForAllStatusRequired&&(vm.moreInfo=vm.storeDetailsAuthoring.sameMessageForAllInventoryStatus)}function openModal(index){$modal.open({windowClass:"image-open-modal store-locator-image-modal",templateUrl:"app/storeLocator/components/storeImageCarousel/storeImageCarousel.tpl.html",controller:"StoreImageCarouselController",controllerAs:"vm",resolve:{store:function(){return vm.store},clickedImageIndex:function(){return index}}})}function clickImageText(event){var index=document.elementFromPoint(event.pageX,event.pageY-25).getAttribute("index");openModal(index)}function alternateTextCarouselImage(photo){return storeDetailsUtil.alternateTextCarouselImage(photo,storeDetailsSectionAuthoring.interiorPhotoAlternateText,storeDetailsSectionAuthoring.exteriorPhotoAlternateText)}function stateDetailScroll(divid){vm.isActive=!1;var mainDiv=angular.element(".store-locator-container");vm.clickedAnchor=divid;var targetposition=angular.element("#link"+divid);"Overview"===divid?angular.element(mainDiv).animate({scrollTop:0},350):angular.element(mainDiv).animate({scrollTop:targetposition[0].offsetTop-angular.element(".tabcontainer")[0].offsetHeight},350)}function scrollTo(){var mainDiv=angular.element(".store-locator-container"),offsettop=(angular.element(".tabcontainer").offset().top,angular.element(".store-locator-details-info")[0].offsetHeight);angular.element(mainDiv).scrollTop()>=offsettop?(angular.element(".tabcontainer").addClass("sticky-section"),
angular.element(".header-section").addClass("headersection")):(angular.element(".tabcontainer").removeClass("sticky-section"),angular.element(".header-section").removeClass("headersection"));var ptag=commonServices.$document.find(".underline");if(-1!==["Overview","Details","NearbyStoresdata"].indexOf(vm.clickedAnchor)){for(var clickedElem=angular.element("#"+vm.clickedAnchor),i=0;i<ptag.length;i++){var currentElem=angular.element("#"+ptag[i].id);currentElem.selector===clickedElem.selector?currentElem.addClass("underline-active"):currentElem.removeClass("underline-active")}vm.clickedAnchor=""}else{for(var current="Overview",i=0;i<ptag.length;i++){var offset=angular.element("#link"+ptag[i].id)[0].offsetTop-70;offset-angular.element(mainDiv).scrollTop()<=0&&(current=ptag[i].id)}var mainDivElem=angular.element(mainDiv)[0];mainDivElem.scrollTop+mainDivElem.offsetHeight===mainDivElem.scrollHeight&&(current=ptag[ptag.length-1].id),angular.forEach(ptag,function(item){item.id===current?angular.element("#"+item.id).addClass("underline-active"):angular.element("#"+item.id).removeClass("underline-active")})}}function getStoreEvents(eventIds,storeId){return storeDetailsUtil.getStoreEvents(eventIds,storeId)}function triggerLivePersonChat(){angular.element(document.getElementById("lpStoreLocatorDetailsClick"))[0].click()}function getStackDescription(){var description="";return vm.store.hasSprintStack&&vm.store.hasTmobileStack?description=vm.store.deviceRepair?vm.storeDetailsAuthoring.dualStoreRepairStackDescription:vm.storeDetailsAuthoring.dualStoreStackDescription:vm.store.hasSprintStack&&!vm.store.hasTmobileStack?description=vm.storeDetailsAuthoring.sprintStoreStackDescription:!vm.store.hasSprintStack&&vm.store.hasTmobileStack&&(description=vm.storeDetailsAuthoring.tmoStoreStackDescription),description}var vm=this,$window=commonServices.$window;vm.store=storeLocatorModelService.model.store,vm.toggles=toggleService.model.toggles,vm.model=storeLocatorModelService.model,vm.lat=vm.store.location.latitude,vm.lng=vm.store.location.longitude,vm.pages=storeLocatorConstants.PAGES,vm.allDays=storeLocatorConstants.ALL_DAYS,vm.authoring=globalValue.authorValue.storeauthoring.generalAuthoringStores,vm.storeDetailsAuthoring=globalValue.authorValue.storeauthoring.storeDetailsSection,vm.inStoreWaitTimes=[],vm.SKUArray=[],vm.cartObj=[],vm.availabilityMsg="",vm.showHideLabel="",vm.inventoryStatusText="",vm.inventoryStatusCode="",vm.toggleDisplay=!0,vm.storeInventoryDetails=storeLocatorModelService.model.inventoryDetails,vm.status=storeLocatorConstants.STATUS,vm.hideContainer=storeLocatorModelService.model.hideContainer,vm.allItemsOutOfStock=!1,vm.productAnalyticsData=storeLocatorModelService.model.productAnalyticsData,vm.moreInfo="";var digitalToRetail=globalValue.authorValue.storeauthoring.digitalToRetail;vm.showHideDiv=!1,vm.deviceDetails=[],vm.accessoryDetails=[];commonServices.$q;vm.title="",vm.formattedHours=[],vm.emergencyClosed=!1,vm.localStoreHours=[],vm.storeAuthoring=lodash.get(globalValue.authorValue.storeauthoring,"generalAuthoringStores",""),vm.maxImagesToDisplay=storeLocatorConstants.MAX_IMAGE_DISPLAY,vm.maxImagesToDisplayInCarousel=storeLocatorConstants.MAX_IMAGE_DISPLAY_IN_CAROUSEL;var storeDetailsSectionAuthoring=globalValue.authorValue.storeauthoring.storeDetailsSection;vm.isDisplayWaitTime=!1,vm.isMegaStore=!1;var heroImageAuthoring=vm.authoring.signatureStoreHeroImages;vm.isActive=!0,vm.clickedAnchor="",vm.isSprintOnlyStore=!1,vm.isDualStore=!1;var spatialPoint={lat:vm.store.location.latitude,lng:vm.store.location.longitude};vm.store&&vm.store.type&&$rootScope.$broadcast("BROWSE_FILTER_UPDATED",{filters:[],queryParams:void 0,store:vm.store,authorValue:globalValue.authorValue}),"RETAIL"===vm.store.type&&angular.isDefined(vm.authoring)?vm.storeIcon="https://www.t-mobile.com"+vm.authoring.tmobileStoreMarker:vm.storeIcon="https://www.t-mobile.com"+vm.authoring.authDealerMarker,"National Retail"===vm.store.type&&lodash.get(toggleService.model,"toggles.removeHoursforNRstores",!1)&&(vm.store.holidayHours=null,vm.store.emergencyHours=null,vm.store.standardHours=null,vm.store.npiHours=null,vm.store.hours=null),"RETAIL"===vm.store.type&&"(TPR)Third Party Retail"===vm.store.storeDefinition?lodash.get(toggleService.model,"toggles.isSprintStoresEnabled",!1)?vm.store.hasSprintStack&&!vm.store.hasTmobileStack?(vm.isSprintOnlyStore=!0,vm.store.storeTypeDefinition=vm.store.deviceRepair?lodash.get(vm.authoring,"sprintAuthorizedRetailRepairStoreTag",""):lodash.get(vm.authoring,"sprintAuthorizedRetailStoreTag","")):vm.store.hasSprintStack&&vm.store.hasTmobileStack?(vm.isDualStore=!0,vm.store.storeTypeDefinition=vm.store.deviceRepair?lodash.get(vm.authoring,"tmobileSprintAuthorizedRetailRepairStoreTag",""):lodash.get(vm.authoring,"tmobileSprintAuthorizedRetailStoreTag","")):vm.store.storeTypeDefinition=vm.store.deviceRepair?lodash.get(vm.authoring,"tprRepairStoreTag",""):lodash.get(vm.authoring,"tprStoreTag",""):vm.store.storeTypeDefinition=lodash.get(vm.authoring,"tprStoreTag",""):"RETAIL"===vm.store.type&&"(FPR)First Party Retail"===vm.store.storeDefinition?vm.store.storeTag&&vm.store.storeTag.includes("signature")&&!vm.store.storeTag.includes("experience")?(vm.store.storeTypeDefinition=vm.store.deviceRepair?lodash.get(vm.authoring,"tmobileRepairSignatureStoreTag",""):lodash.get(vm.authoring,"tmobileSignatureStoreTag",""),getHeroImage(vm.store.id),vm.isMegaStore=!0):lodash.get(toggleService.model,"toggles.experienceStoreTagEnabled",!1)&&vm.store.storeTag&&vm.store.storeTag.includes("experience")?(vm.store.storeTypeDefinition=vm.store.deviceRepair?lodash.get(vm.authoring,"tmobileRepairExperienceStore",""):lodash.get(vm.authoring,"tmobileExperienceStore",""),getHeroImage(vm.store.id),vm.isMegaStore=!0):lodash.get(toggleService.model,"toggles.isSprintStoresEnabled",!1)?vm.store.hasSprintStack&&!vm.store.hasTmobileStack?(vm.isSprintOnlyStore=!0,vm.store.storeTypeDefinition=vm.store.deviceRepair?lodash.get(vm.authoring,"sprintRetailRepairStoreTag",""):lodash.get(vm.authoring,"sprintRetailStoreTag","")):vm.store.hasSprintStack&&vm.store.hasTmobileStack?(vm.isDualStore=!0,vm.store.storeTypeDefinition=vm.store.deviceRepair?lodash.get(vm.authoring,"tmobileSprintRetailRepairStoreTag",""):lodash.get(vm.authoring,"tmobileSprintRetailStoreTag","")):vm.store.storeTypeDefinition=vm.store.deviceRepair?lodash.get(vm.authoring,"tmobileRepairStoreTag",""):lodash.get(vm.authoring,"tmobileStoreTag",""):vm.store.storeTypeDefinition=lodash.get(vm.authoring,"tmobileStoreTag",""):"National Retail"!==vm.store.type||vm.store.storeTypeDefinition||(vm.store.storeTypeDefinition=lodash.get(vm.authoring,"authDealerTag","")),vm.staticMapFinalUrl=vm.store.staticMap,vm.loadInventoryData=loadInventoryData,vm.setAvailabilityMessage=setAvailabilityMessage,vm.toggleItemsView=toggleItemsView,vm.backToSearchResult=storeLocatorModelService.backToSearchResult,vm.CTANavOrClickEvent=pdlService.CTANavOrClickEvent,vm.showOperationSection=storeLocatorModelService.showOperationSection,vm.showMarkerOnMap=showMarkerOnMap,vm.searchNearbyStores=searchNearbyStores,vm.isMoreDataOpen=isMoreDataOpen,vm.close=close,vm.getNewExpHoursData=getNewExpHoursData,vm.getStoreHours=getStoreHours,vm.openModal=openModal,vm.alternateTextCarouselImage=alternateTextCarouselImage,vm.clickImageText=clickImageText,vm.stateDetailScroll=stateDetailScroll,vm.scrollTo=scrollTo,vm.getStoreEvents=getStoreEvents,vm.triggerLivePersonChat=triggerLivePersonChat,vm.getStackDescription=getStackDescription,init()}storeDetailsController.$inject=["$rootScope","$timeout","$log","$state","commonServices","storeLocatorModelService","storeLocatorUtil","toggleService","pdlService","mapUtil","storeDetailsUtil","STORE_LOCATOR_STATE_NAME","storeLocatorConstants","globalValue","inventoryUtils","cartStorage","inventoryStatusService","$modal","$anchorScroll","$location"],angular.module("tmobileApp").controller("StoreDetailsController",storeDetailsController)}(window.angular,_),function(angular){"use strict";var moduleName="tmobileApp",componentName="cartBreakdownDetails",cartbreakdowndetailscomponentConstructor={templateUrl:"app/cart/breakdown/cartBreakdownDetails/cartBreakdownDetails.html",controller:"CartBreakdownDetailsController as vm",bindings:{cartData:"=",authorValue:"=",sourceType:"<"}};angular.module(moduleName).component(componentName,cartbreakdowndetailscomponentConstructor)}(angular),function(angular){"use strict";var storeIdDetails={templateUrl:"app/storeLocator/components/storeIdDetails/storeIdDetails.html",controller:"storeIdDetailsController",controllerAs:"vm",bindings:{onBreadcrumbSelect:"&"}};angular.module("tmobileApp").component("storeIdDetails",storeIdDetails)}(window.angular),function(angular){"use strict";function botShoppingConstructor($stateParams,botShoppingService,cartStorage,$state,creditClassService){function init(){var productType=["HANDSET","TABLET"];$stateParams.type&&$stateParams.skuId&&$stateParams.fbId&&$stateParams.psId&&productType.indexOf($stateParams.type.toUpperCase())>-1?(vm.message="Please wait while we fetch your cart details!",botShoppingService.addProductToLine($stateParams.type.toUpperCase(),$stateParams.skuId).then(function(status){angular.equals(status,200)?(cartStorage.setFbSessionId($stateParams.fbId),creditClassService.setCreditClass({"class":"creditClass1"})):vm.message="Something went wrong! We're taking you to an empty cart.",$state.go("myCart")})):(vm.message="You haven't provided a valid product type and/or a valid product sku! We're taking you to an empty cart.",$state.go("myCart"))}var vm=this;init()}botShoppingConstructor.$inject=["$stateParams","botShoppingService","cartStorage","$state","creditClassService"],angular.module("tmobileApp").controller("BotShoppingCtrl",botShoppingConstructor)}(angular),function(angular,lodash){"use strict";function storeIdDetailsController($rootScope,$log,commonServices,storeLocatorModelService,storeLocatorUtil,toggleService,pdlService,mapUtil,storeDetailsUtil,storeLocatorConstants,globalValue,$modal){function getHeroImage(storeId){vm.heroImage=lodash.filter(heroImageAuthoring,function(store){return parseInt(store.signatureStoreId,10)===parseInt(storeId,10)});try{var modifiedCaption,actualCaption=vm.heroImage[0].eventFooterCaption?vm.heroImage[0].eventFooterCaption.trim():void 0;if(actualCaption){if(actualCaption.indexOf("@")>-1&&actualCaption.indexOf("<p>")>-1){var atSeparator=actualCaption.split("@"),paragraphSplitter=atSeparator[0].split("<p>");paragraphSplitter[1]='<span class="event-footer-caption">'+paragraphSplitter[1]+"</span>",paragraphSplitter=paragraphSplitter.join("<p>"),atSeparator=[paragraphSplitter,atSeparator[1]],modifiedCaption=atSeparator.join("@")}vm.heroImage[0].eventFooterCaption=modifiedCaption?modifiedCaption:'<span class="event-footer-caption">'+actualCaption+"</span>"}else vm.heroImage[0].eventFooterCaption=actualCaption}catch(e){$log.log("Error in setting footer caption!")}$log.log(vm.heroImage)}function getNewExpHoursData(){vm.title=storeDetailsUtil.checkForTitle(vm.storeDetailsAuthoring.specialHours,vm.storeDetailsAuthoring.holidayHours,vm.storeDetailsAuthoring.storeHoursLabel,vm.store.emergencyHours,vm.store.holidayHours,vm.store.npiHours),vm.emergencyClosed=vm.store.emergencyHours?storeDetailsUtil.isEmergencyClosed(vm.store.emergencyHours):!1;for(var i=0;i<vm.allDays.length;i++){var finalDayValue=storeDetailsUtil.getConsolidatedArray(vm.allDays[i],vm.store.emergencyHours,vm.store.holidayHours,vm.store.standardHours,vm.store.npiHours);finalDayValue&&finalDayValue.length&&Array.prototype.push.apply(vm.localStoreHours,finalDayValue)}return vm.updatedFormatedArray=storeDetailsUtil.formatConsolidatedArray(vm.localStoreHours),vm.formattedHours=storeDetailsUtil.getArrayToDisplay(vm.updatedFormatedArray),vm.emergencyClosed||(vm.isDisplayWaitTime=storeLocatorUtil.isStoreOpenToDisplayWaitTime(vm.localStoreHours,vm.store.location.utcOffset)),vm.formattedHours}function showMarkerOnMap(){storeLocatorModelService.changeState(),mapUtil.selectMarkerWithHtml(vm.model.selectedStoreIndex,!0,!0,null),vm.model.sectionToDisplay="",vm.model.hideCompleteCarousel=!1,vm.model.clearSearchButton=!0,$rootScope.$$postDigest(function(){vm.model.slickConfig.method.slickGoTo(vm.model.selectedStoreIndex)})}function init(){vm.model.selectedStoreIndex=0,mapUtil.setMarkers(!0,[vm.model.store],1,null),mapUtil.selectMarkerWithHtml(vm.model.selectedStoreIndex,!0,!0,null),vm.toggles.enableNewSLEvents&&vm.store.eventIds&&vm.store.eventIds.length>0&&vm.getStoreEvents(vm.store.eventIds,vm.store.id).then(function(data){vm.upcomingEvents=data}),vm.getNewExpHoursData(),vm.toggles.aemServicesEnabled&&(vm.store.services=storeDetailsUtil.getStoreServices(vm.store)),vm.toggles.specialMessagesEnabled&&(vm.store.specialMessages=storeDetailsUtil.getSpecialMessages(vm.store)),vm.model.filterJustApplied=!1,vm.model.breadCrumbItems=storeLocatorUtil.getBreadcrumbItems(vm.store.location.address.addressRegion,vm.store.location.address.addressLocality,vm.store.name);var city=vm.store.location.address.addressLocality;vm.store.description&&""!==vm.store.description?vm.store.description=vm.store.description.replace("[[CITY]]",city):vm.storeDetailsAuthoring&&vm.storeDetailsAuthoring.storeDescription&&(lodash.get(toggleService.model,"toggles.isSprintStoresEnabled",!1)?vm.store.hasSprintStack&&!vm.store.hasTmobileStack?vm.store.deviceRepair&&vm.storeDetailsAuthoring.sprintStoreRepairDescription?vm.store.description=vm.storeDetailsAuthoring.sprintStoreRepairDescription.replace("{CITY}",city):vm.storeDetailsAuthoring.sprintStoreDescription?vm.store.description=vm.storeDetailsAuthoring.sprintStoreDescription.replace("{CITY}",city):vm.store.description=vm.storeDetailsAuthoring.storeDescription.replace("{CITY}",city):vm.store.hasSprintStack&&vm.store.hasTmobileStack?vm.store.deviceRepair&&vm.storeDetailsAuthoring.dualStoreRepairDescription?vm.store.description=vm.storeDetailsAuthoring.dualStoreRepairDescription.replace("{CITY}",city):vm.storeDetailsAuthoring.dualStoreDescription?vm.store.description=vm.storeDetailsAuthoring.dualStoreDescription.replace("{CITY}",city):vm.store.description=vm.storeDetailsAuthoring.storeDescription.replace("{CITY}",city):vm.store.description=vm.storeDetailsAuthoring.storeDescription.replace("{CITY}",city):vm.store.description=vm.storeDetailsAuthoring.storeDescription.replace("{CITY}",city)),vm.storeDetailsAuthoring&&vm.storeDetailsAuthoring.nrStoreDescription&&(vm.store.nrStoreDescription=vm.storeDetailsAuthoring.nrStoreDescription.replace("{CITY}",city)),vm.toggles.enableSLPhotoCarousel&&vm.store.photos&&(vm.photos=storeDetailsUtil.imageSelector(vm.store.photos,storeLocatorConstants.PREVIEW_STATE_IMAGE_CONTAINER_HEIGHT));var mainDiv=angular.element(".store-locator-container");vm.toggles.enableNewSLDetailTemplate&&angular.element(mainDiv).bind("scroll",function(){vm.scrollTo()}),(null===vm.store.directionsLink||""===vm.store.directionsLink)&&(vm.store.directionsLink="https://www.google.com/maps/dir/?api=1&origin=&destination="+vm.store.location.address.streetAddress+vm.store.location.address.addressLocality+vm.store.location.address.addressRegion+vm.store.location.address.postalCode)}function openModal(index){$modal.open({windowClass:"image-open-modal store-locator-image-modal",templateUrl:"app/storeLocator/components/storeImageCarousel/storeImageCarousel.tpl.html",controller:"StoreImageCarouselController",controllerAs:"vm",resolve:{store:function(){return vm.store},clickedImageIndex:function(){return index}}})}function clickImageText(event){var index=document.elementFromPoint(event.pageX,event.pageY-25).getAttribute("index");openModal(index)}function alternateTextCarouselImage(photo){return storeDetailsUtil.alternateTextCarouselImage(photo,storeDetailsSectionAuthoring.interiorPhotoAlternateText,storeDetailsSectionAuthoring.exteriorPhotoAlternateText)}function stateDetailScroll(divid){vm.isActive=!1;var mainDiv=angular.element(".store-locator-container");vm.clickedAnchor=divid;var targetposition=angular.element("#link"+divid);"Overview"===divid?angular.element(mainDiv).animate({scrollTop:0},350):angular.element(mainDiv).animate({scrollTop:targetposition[0].offsetTop-angular.element(".tabcontainer")[0].offsetHeight},350)}function scrollTo(){var mainDiv=angular.element(".store-locator-container"),offsettop=(angular.element(".tabcontainer").offset().top,angular.element(".store-locator-details-info")[0].offsetHeight);angular.element(mainDiv).scrollTop()>=offsettop?(angular.element(".tabcontainer").addClass("sticky-section"),angular.element(".header-section").addClass("headersection")):(angular.element(".tabcontainer").removeClass("sticky-section"),angular.element(".header-section").removeClass("headersection"));var ptag=commonServices.$document.find(".underline");if(-1!==["Overview","Details","NearbyStoresdata"].indexOf(vm.clickedAnchor)){for(var clickedElem=angular.element("#"+vm.clickedAnchor),i=0;i<ptag.length;i++){var currentElem=angular.element("#"+ptag[i].id);currentElem.selector===clickedElem.selector?currentElem.addClass("underline-active"):currentElem.removeClass("underline-active")}vm.clickedAnchor=""}else{for(var current="Overview",i=0;i<ptag.length;i++){var offset=angular.element("#link"+ptag[i].id)[0].offsetTop-70;offset-angular.element(mainDiv).scrollTop()<=0&&(current=ptag[i].id)}var mainDivElem=angular.element(mainDiv)[0];mainDivElem.scrollTop+mainDivElem.offsetHeight===mainDivElem.scrollHeight&&(current=ptag[ptag.length-1].id),angular.forEach(ptag,function(item){item.id===current?angular.element("#"+item.id).addClass("underline-active"):angular.element("#"+item.id).removeClass("underline-active")})}}function getStoreEvents(eventIds,storeId){return storeDetailsUtil.getStoreEvents(eventIds,storeId)}function getStackDescription(){var description="";return vm.store.hasSprintStack&&vm.store.hasTmobileStack?description=vm.store.deviceRepair?vm.storeDetailsAuthoring.dualStoreRepairStackDescription:vm.storeDetailsAuthoring.dualStoreStackDescription:vm.store.hasSprintStack&&!vm.store.hasTmobileStack?description=vm.storeDetailsAuthoring.sprintStoreStackDescription:!vm.store.hasSprintStack&&vm.store.hasTmobileStack&&(description=vm.storeDetailsAuthoring.tmoStoreStackDescription),description}var vm=this;vm.store=storeLocatorModelService.model.store,vm.toggles=toggleService.model.toggles,vm.model=storeLocatorModelService.model,vm.pages=storeLocatorConstants.PAGES,vm.allDays=storeLocatorConstants.ALL_DAYS,vm.authoring=globalValue.authorValue.storeauthoring.generalAuthoringStores,vm.storeDetailsAuthoring=globalValue.authorValue.storeauthoring.storeDetailsSection,vm.inStoreWaitTimes=[],vm.productAnalyticsData=storeLocatorModelService.model.productAnalyticsData,vm.title="",vm.formattedHours=[],vm.emergencyClosed=!1,vm.localStoreHours=[],vm.storeAuthoring=lodash.get(globalValue.authorValue.storeauthoring,"generalAuthoringStores",""),vm.maxImagesToDisplay=storeLocatorConstants.MAX_IMAGE_DISPLAY,vm.maxImagesToDisplayInCarousel=storeLocatorConstants.MAX_IMAGE_DISPLAY_IN_CAROUSEL;var storeDetailsSectionAuthoring=globalValue.authorValue.storeauthoring.storeDetailsSection;vm.isDisplayWaitTime=!1,vm.isMegaStore=!1;var heroImageAuthoring=vm.authoring.signatureStoreHeroImages;vm.isActive=!0,vm.clickedAnchor="",vm.isSprintOnlyStore=!1,vm.isDualStore=!1,vm.store&&vm.store.type&&$rootScope.$broadcast("BROWSE_FILTER_UPDATED",{filters:[],queryParams:void 0,store:vm.store,authorValue:globalValue.authorValue}),"RETAIL"===vm.store.type&&angular.isDefined(vm.authoring)?vm.storeIcon="https://www.t-mobile.com"+vm.authoring.tmobileStoreMarker:vm.storeIcon="https://www.t-mobile.com"+vm.authoring.authDealerMarker,"National Retail"===vm.store.type&&lodash.get(toggleService.model,"toggles.removeHoursforNRstores",!1)&&(vm.store.holidayHours=null,vm.store.emergencyHours=null,vm.store.standardHours=null,vm.store.npiHours=null,vm.store.hours=null),"RETAIL"===vm.store.type&&"(TPR)Third Party Retail"===vm.store.storeDefinition?lodash.get(toggleService.model,"toggles.isSprintStoresEnabled",!1)?vm.store.hasSprintStack&&!vm.store.hasTmobileStack?(vm.isSprintOnlyStore=!0,vm.store.storeTypeDefinition=vm.store.deviceRepair?lodash.get(vm.authoring,"sprintAuthorizedRetailRepairStoreTag",""):lodash.get(vm.authoring,"sprintAuthorizedRetailStoreTag","")):vm.store.hasSprintStack&&vm.store.hasTmobileStack?(vm.isDualStore=!0,vm.store.storeTypeDefinition=vm.store.deviceRepair?lodash.get(vm.authoring,"tmobileSprintAuthorizedRetailRepairStoreTag",""):lodash.get(vm.authoring,"tmobileSprintAuthorizedRetailStoreTag","")):vm.store.storeTypeDefinition=vm.store.deviceRepair?lodash.get(vm.authoring,"tprRepairStoreTag",""):lodash.get(vm.authoring,"tprStoreTag",""):vm.store.storeTypeDefinition=lodash.get(vm.authoring,"tprStoreTag",""):"RETAIL"===vm.store.type&&"(FPR)First Party Retail"===vm.store.storeDefinition?vm.store.storeTag&&vm.store.storeTag.includes("signature")&&!vm.store.storeTag.includes("experience")?(vm.store.storeTypeDefinition=vm.store.deviceRepair?lodash.get(vm.authoring,"tmobileRepairSignatureStoreTag",""):lodash.get(vm.authoring,"tmobileSignatureStoreTag",""),getHeroImage(vm.store.id),vm.isMegaStore=!0):lodash.get(toggleService.model,"toggles.experienceStoreTagEnabled",!1)&&vm.store.storeTag&&vm.store.storeTag.includes("experience")?(vm.store.storeTypeDefinition=vm.store.deviceRepair?lodash.get(vm.authoring,"tmobileRepairExperienceStore",""):lodash.get(vm.authoring,"tmobileExperienceStore",""),getHeroImage(vm.store.id),vm.isMegaStore=!0):lodash.get(toggleService.model,"toggles.isSprintStoresEnabled",!1)?vm.store.hasSprintStack&&!vm.store.hasTmobileStack?(vm.isSprintOnlyStore=!0,vm.store.storeTypeDefinition=vm.store.deviceRepair?lodash.get(vm.authoring,"sprintRetailRepairStoreTag",""):lodash.get(vm.authoring,"sprintRetailStoreTag","")):vm.store.hasSprintStack&&vm.store.hasTmobileStack?(vm.isDualStore=!0,vm.store.storeTypeDefinition=vm.store.deviceRepair?lodash.get(vm.authoring,"tmobileSprintRetailRepairStoreTag",""):lodash.get(vm.authoring,"tmobileSprintRetailStoreTag","")):vm.store.storeTypeDefinition=vm.store.deviceRepair?lodash.get(vm.authoring,"tmobileRepairStoreTag",""):lodash.get(vm.authoring,"tmobileStoreTag",""):vm.store.storeTypeDefinition=lodash.get(vm.authoring,"tmobileStoreTag",""):"National Retail"!==vm.store.type||vm.store.storeTypeDefinition||(vm.store.storeTypeDefinition=lodash.get(vm.authoring,"authDealerTag","")),vm.staticMapFinalUrl=vm.store.staticMap,vm.CTANavOrClickEvent=pdlService.CTANavOrClickEvent,vm.showOperationSection=storeLocatorModelService.showOperationSection,vm.showMarkerOnMap=showMarkerOnMap,vm.getNewExpHoursData=getNewExpHoursData,vm.openModal=openModal,vm.alternateTextCarouselImage=alternateTextCarouselImage,vm.clickImageText=clickImageText,vm.stateDetailScroll=stateDetailScroll,vm.scrollTo=scrollTo,vm.getStoreEvents=getStoreEvents,vm.getStackDescription=getStackDescription,init()}storeIdDetailsController.$inject=["$rootScope","$log","commonServices","storeLocatorModelService","storeLocatorUtil","toggleService","pdlService","mapUtil","storeDetailsUtil","storeLocatorConstants","globalValue","$modal"],angular.module("tmobileApp").controller("storeIdDetailsController",storeIdDetailsController)}(window.angular,_),function(angular){"use strict";function serverConfigComponentController(serverConfigService){function addRow(){vm.data.formData.push({toggleName:"",enable:!1})}function addRowNested(){vm.data.NestedformData.push({toggleName:"",enable:!1})}function saveData(){vm.isDeletedItem=!1,serverConfigService.postServerConfigData(vm.data).then(function(){},function(){})}function deleteItem(index){vm.data.formData.splice(index,1),vm.isDeletedItem=!0}function deleteNestedItem(index){vm.data.NestedformData.splice(index,1),vm.isDeletedItem=!0}var vm=this,_DEFAULT_FORM_DATA={formData:[],NestedformData:[],config:{enableDates:!0,hosts:{server:{enableAll:!1,disableAll:!1}}}};vm.data=angular.merge(_DEFAULT_FORM_DATA,vm.serverConfigData||{}),vm.isDeletedItem=!1,vm.addRow=addRow,vm.saveData=saveData,vm.deleteItem=deleteItem,vm.addRowNested=addRowNested,vm.deleteNestedItem=deleteNestedItem}serverConfigComponentController.$inject=["serverConfigService"],angular.module("tmobileApp").controller("ServerConfigController",serverConfigComponentController)}(window.angular),function(angular){"use strict";function storeImageCarouselController($modalInstance,$timeout,store,clickedImageIndex,storeLocatorConstants,storeDetailsUtil,globalValue,toggleService){function closeModal(){$modalInstance.close()}function alternateTextCarouselImage(photo){return storeDetailsUtil.alternateTextCarouselImage(photo,storeDetailsSectionAuthoring.interiorPhotoAlternateText,storeDetailsSectionAuthoring.exteriorPhotoAlternateText)}function carouselContainerResize(){var updatedHeight=angular.element(document.getElementById("storesImageCarousel")).prop("offsetHeight");updatedHeight=.75*parseInt(updatedHeight),vm.photos=storeDetailsUtil.imageSelector(vm.store.photos,updatedHeight)}function init(){$timeout(function(){var initialHeight=angular.element(document.getElementById("storesImageCarousel")).prop("offsetHeight");initialHeight=.75*parseInt(initialHeight),vm.photos=storeDetailsUtil.imageSelector(vm.store.photos,initialHeight)},0),vm.isMegaStore=vm.toggles.enableNewSLDetailTemplate&&"RETAIL"===vm.store.type&&"(FPR)First Party Retail"===vm.store.storeDefinition&&vm.store.storeTag&&(vm.store.storeTag.includes("signature")||vm.store.storeTag.includes("experience"))}function hideModal(event){"storesCarouselImage"!=event.target.id&&"storesCarouselIndicators"!=event.target.id&&"storesLeftCarouselControlChevron"!=event.target.id&&"storesRightCarouselControlChevron"!=event.target.id&&vm.closeModal()}function goNext(){$(".carousel").carousel("next")}function goPrevious(){$(".carousel").carousel("prev")}var vm=this;vm.store=store,vm.toggles=toggleService.model.toggles,vm.isMegaStore=!1,vm.maxImagesToDisplay=storeLocatorConstants.MAX_IMAGE_DISPLAY_IN_CAROUSEL,vm.clickedImageIndex=clickedImageIndex;var storeDetailsSectionAuthoring=globalValue.authorValue.storeauthoring.storeDetailsSection;vm.goNext=goNext,vm.goPrevious=goPrevious,vm.closeModal=closeModal,vm.hideModal=hideModal,vm.alternateTextCarouselImage=alternateTextCarouselImage,vm.carouselContainerResize=carouselContainerResize,window.onresize=carouselContainerResize,vm.init=init,vm.init()}storeImageCarouselController.$inject=["$modalInstance","$timeout","store","clickedImageIndex","storeLocatorConstants","storeDetailsUtil","globalValue","toggleService"],angular.module("tmobileApp").controller("StoreImageCarouselController",storeImageCarouselController)}(window.angular,_),function(angular){"use strict";function imeiComponenetControllerConstructor(luhn,$log,$window,tradeInService,imeiErrorCode){function validateIMEI(imeiInput,imeiFormControl){vm.model.validImei=!1,vm.model.formData=imeiFormControl,vm.model.imei=angular.isUndefined(imeiInput)||""===imeiInput?imeiFormControl.$viewValue:imeiInput,vm.model.inputImeiLength=15!==vm.model.imei.length,vm.model.inputImeiLength||(luhn.check(vm.model.formData.$viewValue)?(vm.model.validImei=!1,$window.grecaptcha.reset(),$window.grecaptcha.execute()):vm.model.validImei=!0)}function onSubmit(response){var grecaptchaResponse=$window.grecaptcha.getResponse();return 0===grecaptchaResponse.length?($log.log("thanks please do capctha"+response),!1):(getIMEIData(),!0)}function getIMEIData(){tradeInService.getValidationIMEI(vm.model.imei).then(function(imeiResponse){if(imeiResponse.data)if(vm.model.tradeInRespose=imeiResponse.data,"ELIGIBLE"===vm.model.tradeInRespose.statusCode)vm.model={tradeInEligible:!0,tradeInBase:!1},vm.model.imeiStatus=vm.model.tradeInEligible?"Verify another IMEI number":"IMEI STATUS CHECK";else{var code=vm.model.tradeInRespose.errors[0].code;switch(vm.model.imeiErrorDisplay=_.find(vm.model.imeiErrorCodeMsg,{code:code}),vm.model.imeiErrorDisplay.code){case"TRADEIN-00144":case"GENERAL-0001":vm.model={imeiHeadStatus:"Ensuring that your device has not been reported stolen",tradeInBase:!0,tradeInNotEligibleLost:!0},vm.model.imeiStatus=vm.model.tradeInEligible?"Verify another IMEI number":"IMEI STATUS CHECK";break;default:vm.model={tradeInNotEligible:!0,tradeInBase:!1},vm.model.imeiStatus=vm.model.tradeInEligible?"Verify another IMEI number":"IMEI STATUS CHECK"}}})}var vm=this;vm.model={inputImeiLength:!1,formData:{},validImei:!1,imei:"",tradeInRespose:{},tradeInEligible:!1,tradeInNotEligible:!1,tradeInBase:!0,imeiStatus:"IMEI STATUS CHECK",imeiErrorCodeMsg:imeiErrorCode,imeiErrorDisplay:"",imeiHeadStatus:"Check to see if your device will work on the T-Mobile network",tradeInNotEligibleLost:!1},$window.onSubmit=onSubmit,vm.validateIMEI=validateIMEI}imeiComponenetControllerConstructor.$inject=["luhn","$log","$window","tradeInService","imeiErrorCode"],angular.module("tmobileApp").controller("imeiComponenetController",imeiComponenetControllerConstructor)}(angular),function(angular){"use strict";var storeLocatorContainer={templateUrl:"app/storeLocator/components/storeLocatorContainer/storeLocatorContainer.tpl.html",controller:"storeLocatorContainerController",controllerAs:"vm",bindings:{}};angular.module("tmobileApp").component("storeLocatorContainer",storeLocatorContainer)}(window.angular),function(angular){"use strict";function articleArchiveController(dataAccessService,articleService,$window,$location,$anchorScroll,analyticsUtils){function applyFilters(type){vm.currentPage=1;var tagToSearch=""===vm.selectedTag.value?"":vm.selectedTag.text;vm.filteredArticles=articleService.getFilteredArticles(vm.allArticles,tagToSearch,vm.selectedFilters),vm.currentPageArticles=articleService.getArticlesByPage(vm.filteredArticles,vm.currentPage,vm.pageSize),vm.currentPageArticles=vm.addAnalyticsIndexToArticles(vm.currentPageArticles),vm.totalPages=articleService.getTotalPages(vm.filteredArticles,vm.pageSize);var filteredTitle="";if("tag"===type)filteredTitle=tagToSearch;else var filteredTitle=tagToSearch+" | articles: "+vm.selectedFilters.articles.text+" | author: "+vm.selectedFilters.author.text+" | month: "+vm.selectedFilters.month.text+" | year: "+vm.selectedFilters.year.text;analyticsUtils.trackArchiveAngularLoad(vm.currentPageArticles,filteredTitle,analyticsId,placementId)}var vm=this;vm.allArticles=[],vm.currentPage=1;var tagFromUrl,analyticsId=vm.analyticsId,placementId="index 2";vm.articleIndex=0,vm.currentPageArticles=[],vm.filteredArticles=[],vm.pageSize=10,vm.selectedFilters=[],vm.selectedTag={text:"",value:""},vm.totalPages=1,vm.showFilter=!0,vm.onFiltersApplied=function(filters){vm.selectedFilters=filters,applyFilters()},vm.$onInit=function(){var lastslashindex=$location.absUrl().lastIndexOf("/"),tagIndex=-1;tagFromUrl=decodeURIComponent($location.absUrl().substring(lastslashindex+1)),tagIndex=tagFromUrl.indexOf("?"),-1!==tagIndex&&(tagFromUrl=tagFromUrl.substr(0,tagIndex)),angular.forEach(vm.tagList,function(tag,key){""!==tag.value&&tag.value.replace(/-/g," ").toLowerCase()===tagFromUrl.replace(/-/g," ").toLowerCase()&&(vm.selectedTag={text:tag.text,value:tag.value})}),articleService.setArticleSourceBaseUrl(vm.articleBaseUrl),articleService.getFirstSetOfArticles(vm.selectedTag.value).then(function(result){vm.currentPageArticles=result.data.articles,vm.currentPageArticles=vm.addAnalyticsIndexToArticles(vm.currentPageArticles),analyticsUtils.trackArchiveAngularLoad(vm.currentPageArticles,vm.selectedTag.text,analyticsId,placementId)}),vm.loadingArticles=!0,articleService.getAllArticles().then(function(result){vm.allArticles=result.data.articles,vm.selectedTag&&""===vm.selectedTag.value?vm.filteredArticles=angular.copy(vm.allArticles):vm.filteredArticles=articleService.getFilteredArticles(vm.allArticles,vm.selectedTag.value,{}),vm.totalPages=articleService.getTotalPages(vm.filteredArticles,vm.pageSize),vm.loadingArticles=!1})},vm.onPageChanged=function(pageNumber){pageNumber&&vm.currentPage!==pageNumber&&($anchorScroll(),
vm.currentPage=pageNumber,vm.currentPageArticles=articleService.getArticlesByPage(vm.filteredArticles,vm.currentPage,vm.pageSize),vm.currentPageArticles=vm.addAnalyticsIndexToArticles(vm.currentPageArticles),analyticsUtils.trackArchiveAngularLoad(vm.currentPageArticles,vm.selectedTag.text+" page "+pageNumber,analyticsId,placementId))},vm.addAnalyticsIndexToArticles=function(articles){return articles.map(function(article){return vm.articleIndex++,article.analyticsId=article.analyticsId+"-article-"+vm.articleIndex,article})},vm.onSearchAction=function(isActive){vm.showFilter=!isActive},vm.onSearchSubmit=function(searchString){$window.location.href=""+this.articleSearchUrl+searchString},vm.onTagSelectionChanged=function(tag){var previousSelectedTag=vm.selectedTag;vm.selectedTag=tag;var lastSlashIndex=$location.path().lastIndexOf("/"),newPath=""===previousSelectedTag.value?$location.path():$location.path().substring(0,lastSlashIndex);newPath="/"===newPath.slice(-1)?newPath.substring(0,newPath.length-1):newPath,$location.path(newPath+"/"+tag.value.replace(/\s/g,"-").toLowerCase()),applyFilters("tag")}}articleArchiveController.$inject=["dataAccessService","articleService","$window","$location","$anchorScroll","analyticsUtils"];var articleArchiveComponent={templateUrl:"/article-archive.html",controller:articleArchiveController,bindings:{settings:"<",articleBaseUrl:"@",articleSearchUrl:"@",tagList:"<",analyticsId:"@"},controllerAs:"vm"};angular.module("marketingCore").component("articleArchive",articleArchiveComponent)}(angular),function(angular,lodash){"use strict";function storeLocatorContainerControllerConstructor($scope,commonServices,storeLocatorUtil,storeLocatorModelService,storeAppointmentService,mapEventHandlerUtil,pdlService,geoLocation,storeLocatorInitUtil,storeAppointmentUtil,toggleService,genericModalUtil,storeFilterUtil,storeLocatorConstants,globalValue,STORE_LOCATOR_STATE_NAME){function showStoresWithMarkers(){var queryString=$stateParams.search||$stateParams.additionalUrl,sortBy=$stateParams.sortBy,page=$stateParams.page,paramCity=$stateParams.city,paramState=$stateParams.state,paramStoreName=$stateParams.storeName,operation=$stateParams.operation,paramId=vm.toggles.isIdDetailPageEnabled&&paramState&&paramState.length>2?paramState.toUpperCase():void 0,queryStringForLeadID=$stateParams.appointment_Id;if(queryStringForRSVPConfirmation=$stateParams.RSVPConfirmation,queryStringForConfirmation=$stateParams.Confirmation,queryStringForRSVPReschedule=$stateParams.Reschedule,queryStringForRSVPCancel=$stateParams.Cancel,vm.model.currentPage=storeLocatorUtil.getCurrentPage(),vm.model.breadCrumbItems=storeLocatorUtil.getBreadcrumbItems(paramState,paramCity,paramStoreName),vm.model.noStoresFound=!1,paramId)storeID(paramId);else if(lodash.isEmpty(paramState)||lodash.isEmpty(paramCity)||lodash.isEmpty(paramStoreName))lodash.isEmpty(paramState)||lodash.isEmpty(paramCity)?lodash.isEmpty(paramState)?lodash.isEmpty(queryString)?lodash.isEmpty(queryStringForLeadID)?(storeLocatorModelService.changeState({},!1,!1,!1,!0),vm.model.storeList=[],storeLocatorInitUtil.afterMapLoad(),vm.model.SDPViaDeeplink=!1):(vm.model.user.leadId=queryStringForLeadID,storeAppointmentService.getMyAppointments().then(function(myAppointmentResponse){setUserInfoFromMail(myAppointmentResponse)})["catch"](function(error){vm.model.modalToBeDisplayed=modals.APPOINTMENT_NOT_FOUND,genericModalUtil.openModal().then(function(successResult){storeLocatorInitUtil.afterMapLoad()})["catch"](function(errorResult){$log.error(errorResult)})})):(queryParamsConfig={sortBy:sortBy,search:queryString,page:page},geoLocation.getLatLng(queryString).then(function(latLng){({lat:latLng[0],lng:latLng[1]});vm.model.spatialPointLatLng=latLng,vm.model.noStoresFound=!1,storeLocatorUtil.getUpdatedStoreList(vm.model.miles).then(function(){return 0===vm.model.storeList.length?void(vm.model.noStoresFound=!0):(storeLocatorModelService.setInfoCarouselConfig(),vm.model.filterJustApplied?(vm.model.sectionToDisplay="",vm.model.hideCompleteCarousel=!1,vm.model.searchField="",void storeLocatorModelService.changeState({},!0,!1,!1,!0)):(vm.model.searchField=queryString,sortBy&&("type1"!==sortBy&&"type2"!==sortBy&&(!vm.toggles.enableProductRepairCenter||vm.toggles.enableProductRepairCenter&&"type4"!==sortBy)&&(sortBy="type1",queryParamsConfig.sortBy=sortBy),storeFilterUtil.setTempFilters(sortBy),storeFilterUtil.applyFilter(),vm.model.hideCompleteCarousel=!0),page&&(storeLocatorUtil.setStartAndEndBasedOnPageNumber(page),queryParamsConfig.page=vm.model.currentPageNumber),vm.model.sectionToDisplay=storeLocatorConstants.SECTIONS.SEARCH_RESULTS,void storeLocatorModelService.changeState(queryParamsConfig,!1,!1,!1,!0)))},function(error){storeLocatorModelService.changeState({},!1,!1,!1,!0),$log.log("Error getting storeLists"+error)})},function(error){vm.model.clearSearchButton=!0,vm.model.sectionToDisplay=vm.views.SEARCH_RESULTS,vm.model.invalidSearchAddress=!0})):(vm.model.hideCompleteCarousel=!0,vm.model.clearSearchButton=!1,vm.model.noCitiesFound=!1,storeLocatorUtil.getCityList(paramState).then(function(response){if(vm.model.sectionToDisplay=storeLocatorConstants.SECTIONS.STATE_RESULTS,200===response.status){if(vm.model.cityList=response.data.cityList,vm.model.cityList){var stateWiseStores=[],totalStores=0;stateWiseStores.push({name:storeLocatorConstants.CITIES,result:""+vm.model.cityList.length}),angular.forEach(vm.model.cityList,function(cityItem){totalStores+=cityItem.storeCount}),stateWiseStores.push({name:storeLocatorConstants.STORES,result:""+totalStores})}pdlService.setSearchPageLoadEvent(void 0,void 0,stateWiseStores),0===vm.model.cityList.length&&(vm.model.noCitiesFound=!0),storeLocatorInitUtil.loadCityBubbles()}else $log.error("getCityList() System Error:"+lodash.get(response,"[0].systemMessage","")),vm.model.storeList=[],vm.model.sectionToDisplay="searchResultView",vm.model.noCitiesFound=!0,vm.model.noStoresFound=!0,vm.model.storeFilterAuthor={},vm.model.cityList=[],vm.model.currentPage="statePage",vm.model.breadCrumbItems=[],mapEventHandlerUtil.clearMarkers(),mapEventHandlerUtil.setDefaultMap()},function(error){$log.error("getCityList() error:"+error),storeLocatorModelService.changeState({},!1,!1,!1,!0),storeLocatorInitUtil.afterMapLoad()})):(queryParamsConfig={page:page},vm.model.clearSearchButton=!1,vm.model.hideCompleteCarousel=!0,vm.model.noStoresFound=!1,vm.model.loadPrevStoreListView=!0,vm.model.backtoCityPage?(vm.model.backtoCityPage=!1,page?(storeLocatorUtil.setStartAndEndBasedOnPageNumber(page),queryParamsConfig.page=vm.model.currentPageNumber):(vm.model.clearSearchButton=!1,vm.model.hideCompleteCarousel=!0),storeLocatorInitUtil.loadStoreMarkers(),vm.model.sectionToDisplay=vm.model.isMobileView?"":storeLocatorConstants.SECTIONS.CITY_RESULTS):storeLocatorUtil.getStoresInCity(paramState,paramCity).then(function(response){if(200!==response.status)return vm.model.userMessage=lodash.get(response.data,"[0].userMessage","Error"),$log.error("getStoresInCity() System Error:"+lodash.get(response,"[0].systemMessage","")),vm.model.completeStoreList=[],vm.model.storeList=[],storeLocatorModelService.changeState({},!1,!1,!1,!0),void storeLocatorInitUtil.afterMapLoad();vm.model.storeList=response.data.storeList,vm.model.completeStoreList=response.data.storeList;var storeTypeList=[],storeTypeCount={};0===vm.model.storeList.length&&(vm.model.noStoresFound=!0),angular.forEach(response.data.storeList,function(store){store.todayHours=storeLocatorUtil.getTodaysHours(store),store.storeShortLabel in storeTypeCount?storeTypeCount[store.storeShortLabel]+=1:(storeTypeCount[store.storeShortLabel]=1,storeTypeList.push({name:store.storeShortLabel}))}),angular.forEach(storeTypeList,function(item){item.result=""+storeTypeCount[item.name]}),pdlService.setSearchPageLoadEvent(void 0,void 0,storeTypeList),page?(storeLocatorUtil.setStartAndEndBasedOnPageNumber(page),queryParamsConfig.page=vm.model.currentPageNumber):(vm.model.clearSearchButton=!1,vm.model.hideCompleteCarousel=!0),storeLocatorInitUtil.loadStoreMarkers(),vm.model.isMobileView?vm.model.sectionToDisplay="":vm.model.sectionToDisplay=storeLocatorConstants.SECTIONS.CITY_RESULTS,storeLocatorModelService.changeState(queryParamsConfig,!0,!0,!1,!0)},function(error){storeLocatorModelService.changeState({},!1,!1,!1,!0),$log.error("getStoresInCity() error:"+error)}));else{var stateParams={state:paramState,city:paramCity,storeName:paramStoreName};vm.model.filterJustApplied=!1,storeLocatorUtil.getStoreDetails(stateParams).then(function(response){$timeout(function(){vm.model.sectionToDisplay=""},0),200===response.status?(vm.toggles.experienceStoreTagEnabled&&"387F"==response.data.id&&(response.data.storeTag.includes(storeLocatorConstants.STORE_TAG.EXPERIENCE)?"":response.data.storeTag.push(storeLocatorConstants.STORE_TAG.EXPERIENCE),response.data.storeDefinition=storeLocatorConstants.STORE_DEFINITION.FPR),vm.model.store=response.data,vm.model.hideCompleteCarousel=!0,operation===pages.GIL?$timeout(function(){storeLocatorModelService.showOperationSection(pages.GIL)},0):operation===pages.ISA?$timeout(function(){storeLocatorModelService.showOperationSection(pages.ISA)},0):$timeout(function(){vm.model.sectionToDisplay=storeLocatorConstants.SECTIONS.STORE_DETAILS,vm.model.SDPViaDeeplink=!0,storeLocatorModelService.changeState(stateParams,!1,!1,!1,!0)},0)):(vm.model.sectionToDisplay="",storeLocatorModelService.changeState({},!1,!1,!1,!0),storeLocatorInitUtil.afterMapLoad())},function(error){storeLocatorModelService.changeState({},!1,!1,!1,!0),$log.error("getStoreDetails() error:"+error)})}}function setUserInfoFromMail(myAppointmentResponse){vm.model.user.appointmentId=myAppointmentResponse.appointmentId,vm.model.isUserRedirectedFromMail=!0;var startDayIndex=new Date(myAppointmentResponse.startdate).getUTCDay(),dayOfWeek=storeLocatorConstants.DAY_OF_WEEKS[startDayIndex].toUpperCase().slice(0,3),timeString=myAppointmentResponse.starttime;vm.model.dateTimeSummary=dayOfWeek+","+myAppointmentResponse.startdate.slice(0,5)+" at "+timeString,vm.model.selectedDateAndDay.date=myAppointmentResponse.startdate,vm.model.selectedTimeSlot=myAppointmentResponse.starttime;var city=commonServices.$filter("normalize")(myAppointmentResponse.storecity),state=commonServices.$filter("normalize")(myAppointmentResponse.storestate),storeId=myAppointmentResponse.storeId,storeStateParams={state:state,city:city,storeName:null};storeAppointmentService.getLeadInfo().then(function(userDetails){vm.model.user=angular.extend(vm.model.user,{firstName:userDetails.firstName,lastName:userDetails.lastName,email:userDetails.email,phone:userDetails.phoneNumber,notes:userDetails.notes,reason:userDetails.reason,languagePreferenceOptions:userDetails.locale?userDetails.locale:"",customerStatusOptions:userDetails.existingCustomer?"New Customer"===userDetails.existingCustomer?"No":"Yes":""}),lodash.isEmpty(vm.model.user.languagePreferenceOptions)||appointmentAuthoring.languagePreferenceOptions.forEach(function(option){vm.model.user.languagePreferenceOptions.toLowerCase()===option.language.toLowerCase()&&(vm.model.user.languagePreferenceOptions=option.optionLabel)}),getStoreListWithStateParams(storeStateParams,storeId)})["catch"](function(error){vm.model.user.firstName="Hey",getStoreListWithStateParams(storeStateParams,storeId)})}function getMoreStoreList(storeId){var paramStoreName=$stateParams.storeName,latLngObject={lat:vm.model.spatialPointLatLng[0],lng:vm.model.spatialPointLatLng[1]};vm.model.resultCount=parseInt(vm.model.resultCount,10)>50?50:parseInt(vm.model.resultCount,10),vm.model.numberFound>=vm.model.startIndex+vm.model.resultCount&&(vm.model.startIndex+=50,storeLocatorUtil.getStoreList(latLngObject,vm.model.startIndex,vm.model.resultCount,vm.model.miles,!1).then(function(response){vm.model.startIndex=response.startIndex,vm.model.numberFound=response.numberFound,vm.model.storeList=response.data,vm.model.completeStoreList=response.data,storeLocatorInitUtil.pickStore(paramStoreName,storeId).then(function(){if(lodash.isEmpty(vm.model.store))getMoreStoreList(storeId);else{$stateParams.storeName=$filter("normalize")(vm.model.store.name);var selectedStoreIndex=vm.model.storeList.indexOf(vm.model.store);storeLocatorUtil.showStoreDetail(vm.model.store,selectedStoreIndex),vm.model.ignoreLoadingBar=!0,vm.model.showCarouselUp=!1}},function(error){vm.model.noStoresFound=!0,storeLocatorModelService.changeState({},!1,!1,!1,!0),$log.log("Error picking store"+error)})},function(error){storeLocatorModelService.changeState({},!1,!1,!1,!0),$log.log("Error getting storeLists"+error)}))}function getStoreListWithStateParams(stateParams,storeId){var location=stateParams.city+", "+stateParams.state+", US";geoLocation.getLatLng(location).then(function(latLng){var latLngObject={lat:latLng[0],lng:latLng[1]};vm.model.spatialPointLatLng=latLng,storeLocatorUtil.getStoreList(latLngObject,vm.model.startIndex,vm.model.resultCount,vm.model.miles,!0).then(function(response){vm.model.startIndex=response.startIndex,vm.model.numberFound=response.numberFound,vm.model.storeList=response.data,vm.model.completeStoreList=response.data,vm.model.noStoresFound=!1,vm.model.hideCompleteCarousel=!0,storeLocatorInitUtil.loadStoreMarkers(),storeLocatorInitUtil.pickStore(stateParams.storeName,storeId).then(function(){if(lodash.isEmpty(vm.model.store))getMoreStoreList(storeId);else{stateParams.storeName=$filter("normalize")(vm.model.store.name);var selectedStoreIndex=vm.model.storeList.indexOf(vm.model.store);vm.model.selectedStoreIndex=selectedStoreIndex,vm.model.showCarouselUp=!1,vm.model.hideCompleteCarousel=!0,vm.model.store.inStoreWaitTime=0,vm.model.isUserRedirectedFromMail?(storeLocatorModelService.createStoreAddress(),lodash.isEmpty(queryStringForRSVPReschedule)||"1"!==queryStringForRSVPReschedule?lodash.isEmpty(queryStringForRSVPCancel)||"1"!==queryStringForRSVPCancel?lodash.isEmpty(queryStringForRSVPConfirmation)||"1"!==queryStringForRSVPConfirmation||(vm.model.user.RSVPAppointment=queryStringForRSVPConfirmation):storeAppointmentService.getCancelAppointmentModel():storeAppointmentService.getRescheduleAppointmentModel(),vm.model.sectionToDisplay=vm.views.APPOINTMENT_CONFIRMATION,storeLocatorModelService.changeState(stateParams,!1,!1,!1,!0)):(storeLocatorUtil.showStoreDetail(vm.model.store,selectedStoreIndex),$timeout(function(){vm.model.sectionToDisplay=storeLocatorConstants.SECTIONS.STORE_DETAILS},0))}},function(error){vm.model.noStoresFound=!0,vm.model.isUserRedirectedFromMail?(storeLocatorModelService.createStoreAddress(),vm.model.sectionToDisplay=vm.views.APPOINTMENT_CONFIRMATION,storeLocatorModelService.changeState(stateParams,!1,!1,!1,!0)):storeLocatorModelService.changeState({},!1,!1,!1,!0),$log.log("Error picking store"+error)})},function(error){storeLocatorModelService.changeState({},!1,!1,!1,!0),$log.log("Error getting storeLists"+error)})},function(error){vm.model.clearSearchButton=!0,vm.model.sectionToDisplay=vm.views.SEARCH_RESULTS,vm.model.invalidSearchAddress=!0})}function receiveMessage(event){if(event.origin.contains(storeLocatorConstants.OTHERS.TMO)){var json=angular.fromJson(event.data);switch(json.event){case storeLocatorConstants.MAP_EVENTS.LOAD:showStoresWithMarkers();break;case storeLocatorConstants.MAP_EVENTS.OVER:vm.model.markerSelected=!0,vm.model.markerIndex=json.data.index,mapEventHandlerUtil.onMarkerMouseOver(json.data);break;case storeLocatorConstants.MAP_EVENTS.OUT:(storeLocatorUtil.getCurrentPage()!==storeLocatorConstants.PAGES.STORE||json.data.index!==vm.model.selectedStoreIndex)&&(mapEventHandlerUtil.onMarkerMouseOut(json.data.index),$timeout(function(){vm.model.markerSelected=!1,vm.model.markerIndex=null},0));break;case storeLocatorConstants.MAP_EVENTS.CLICK:var store,storeIndex=json.data.index,currentPage=storeLocatorUtil.getCurrentPage();currentPage===storeLocatorConstants.PAGES.STATE?storeLocatorModelService.citySelected(vm.model.cityList[json.data.index]):currentPage!==storeLocatorConstants.PAGES.STORE&&_.isEmpty(vm.model.store.nearbyStores)?(mapEventHandlerUtil.onMarkerClick(storeIndex),store=vm.model.storeList[storeIndex],vm.model.isMobileView||storeLocatorUtil.showStoreDetail(store,storeIndex)):(mapEventHandlerUtil.onMarkerClick(storeIndex),vm.model.isMobileView||storeIndex===vm.model.selectedStoreIndex||(store=lodash.isEmpty(vm.model.store.nearbyStores)?vm.model.storeList[storeIndex]:vm.model.store.nearbyStores[storeIndex],vm.model.nearByStoreSelected=!0,storeLocatorUtil.showStoreDetail(store,storeIndex)));break;case storeLocatorConstants.MAP_EVENTS.DRAG:mapEventHandlerUtil.onMapDragOrZoom();break;case storeLocatorConstants.MAP_EVENTS.ZOOM:if(vm.model.sectionToDisplay===storeLocatorConstants.SECTIONS.SEARCH_RESULTS||vm.model.sectionToDisplay===storeLocatorConstants.SECTIONS.STORE_DETAILS||vm.model.sectionToDisplay===storeLocatorConstants.SECTIONS.STATE_RESULTS||vm.model.sectionToDisplay===storeLocatorConstants.SECTIONS.CITY_RESULTS||vm.model.sectionToDisplay===storeLocatorConstants.SECTIONS.GET_IN_LINE||vm.model.sectionToDisplay===storeLocatorConstants.SECTIONS.TIME_SLOT_SELECTOR||vm.model.sectionToDisplay===storeLocatorConstants.SECTIONS.APPOINTMENT_CONFIRMATION)return void(vm.model.hideCompleteCarousel=!0);vm.model.zoomEventTriggeredManually&&(mapEventHandlerUtil.onMapDragOrZoom(),storeLocatorModelService.changeState({},!1,!0,!1,!0));break;case storeLocatorConstants.MAP_EVENTS.IDLE:mapEventHandlerUtil.onMapIdle(json.data)}}}function subscribeToMapEvents(){if(!vm.model.alreadyListening){var eventMethod=$window.addEventListener?storeLocatorConstants.OTHERS.AEL:storeLocatorConstants.OTHERS.AE,eventer=$window[eventMethod],messageEvent=eventMethod===storeLocatorConstants.OTHERS.AE?storeLocatorConstants.OTHERS.OM:storeLocatorConstants.OTHERS.M;eventer(messageEvent,receiveMessage),vm.model.alreadyListening=!0}}function onClickBreadcrumbLink(item){0===item.index?(vm.model.searchField="",vm.model.searchResultsCleared=!0,vm.model.zoomEventTriggeredManually=!1,vm.model.clearSearchButton=!1,vm.model.cityList=[],vm.model.sectionToDisplay="",mapEventHandlerUtil.clearMarkers(!0),vm.model.storeList=[],storeLocatorModelService.changeState({},!0,!1,!0,!0),storeLocatorInitUtil.afterMapLoad()):1===item.index?(vm.searchField="",vm.model.searchResultsCleared=!0,$stateParams.city="",vm.model.storeList=[],storeLocatorModelService.changeState({state:$stateParams.state},!0,!1,!0,!0)):2===item.index&&(vm.searchField="",vm.model.searchResultsCleared=!0,$stateParams.store="",$stateParams.storeName="",vm.model.storeList=[],vm.model.cityList=[],vm.model.currentPageNumber=1,storeLocatorModelService.changeState({state:$stateParams.state,city:$stateParams.city},!0,!1,!0,!0)),pdlService.CTANavOrClickEvent(item.label,item.url,!0,"Link")}function storeID(paramId){vm.model.filterJustApplied=!1,storeLocatorUtil.getStoreDetailsById(paramId).then(function(response){if($timeout(function(){vm.model.sectionToDisplay=""},0),200===response.status){vm.toggles.experienceStoreTagEnabled&&"387F"==response.data.id&&(response.data.storeTag.includes(storeLocatorConstants.STORE_TAG.EXPERIENCE)?"":response.data.storeTag.push(storeLocatorConstants.STORE_TAG.EXPERIENCE),response.data.storeDefinition=storeLocatorConstants.STORE_DEFINITION.FPR),vm.model.store=response.data;var stateConfig=storeLocatorModelService.setStateConfig(vm.model.store);$stateParams.city=stateConfig.city,$stateParams.state=stateConfig.state,$stateParams.storeName=stateConfig.storeName,vm.model.hideCompleteCarousel=!0,$timeout(function(){vm.model.sectionToDisplay="storeDetailsById",vm.model.SDPViaDeeplink=!0},0)}else vm.model.sectionToDisplay="",storeLocatorModelService.changeState({},!1,!1,!1,!0),storeLocatorInitUtil.afterMapLoad()},function(error){storeLocatorModelService.changeState({},!1,!1,!1,!0),$log.error("getStoreDetails() error:"+error)})}var queryStringForConfirmation,queryStringForRSVPCancel,queryStringForRSVPReschedule,queryStringForRSVPConfirmation,vm=this,$stateParams=commonServices.$stateParams,$window=(commonServices.$state,commonServices.$window),$log=commonServices.$log,$timeout=commonServices.$timeout,$filter=commonServices.$filter,queryParamsConfig=(commonServices.$location,{});vm.model=storeLocatorModelService.model,vm.views=storeLocatorConstants.SECTIONS;var pages=storeLocatorConstants.PAGES,modals=storeLocatorConstants.MODALS,generalAuthoring=globalValue.authorValue.storeauthoring.generalAuthoringStores,appointmentAuthoring=globalValue.authorValue.storeauthoring.appointmentsAndWaitTime;vm.noResultMessage=generalAuthoring.noResultsMessage||"No Record has been found",vm.model.maxStoreDisplay=parseInt(generalAuthoring.numberOfResults,10)||"10",vm.toggles=toggleService.model.toggles,storeLocatorModelService.setInfoCarouselConfig(),storeLocatorModelService.listenToLivePersonChatEvent(),storeLocatorModelService.engageLivePerson(),$scope.$on("$destroy",function(){$scope.$destroy()}),subscribeToMapEvents(),vm.updateStoreType=storeLocatorUtil.updateStoreType,vm.setStoreMarkers=mapEventHandlerUtil.setStoreMarkers,vm.onClickSearchThisArea=storeLocatorInitUtil.onSearchThisAreaClicked,vm.onClickNotYourLocation=storeLocatorInitUtil.onNotYourLocationClicked,vm.onClickUpDownArrow=storeLocatorInitUtil.onCarouselToggleClicked,vm.onClickBreadcrumbLink=onClickBreadcrumbLink}storeLocatorContainerControllerConstructor.$inject=["$scope","commonServices","storeLocatorUtil","storeLocatorModelService","storeAppointmentService","mapEventHandlerUtil","pdlService","geoLocation","storeLocatorInitUtil","storeAppointmentUtil","toggleService","genericModalUtil","storeFilterUtil","storeLocatorConstants","globalValue","STORE_LOCATOR_STATE_NAME"],angular.module("tmobileApp").controller("storeLocatorContainerController",storeLocatorContainerControllerConstructor)}(window.angular,window._),function(angular){"use strict";function benefitsContainerController(analyticsUtils,$scope,$element,$window,$document,$timeout,utils){var vm=this,modalContent=utils.getClosest($element[0],".modal-content");vm.timeOfPrevScroll=(new Date).getTime(),vm.slickConfig={infinite:!0,arrows:!1,accessibility:!0,focusOnSelect:!1,speed:600,lazyLoad:"ondemand",useTransform:!0,autoplay:!1,cssEase:"ease-out",dots:!1,vertical:!0,verticalSwiping:!0,pauseOnHover:!1,autoplaySpeed:12e3,method:{},event:{beforeChange:function(event,slick,currentSlide,nextSlide){var direction;direction=1===Math.abs(nextSlide-currentSlide)?nextSlide-currentSlide>0?"up":"down":nextSlide-currentSlide>0?"down":"up","up"===direction?analyticsUtils.trackCarousel(!0,$element):analyticsUtils.trackCarousel(!1,$element),modalContent&&(modalContent.classList.remove("gradient-border-pos-"+currentSlide%4),modalContent.classList.add("gradient-border-pos-"+nextSlide%4)),$scope.$broadcast("benefits-modal-translate")}}},$scope.$on("modalOpen",function(){$window.addEventListener("wheel",_.throttle(vm.scroll,50)),$window.addEventListener("keydown",vm.keydown)}),$scope.$on("modalClosed",function(){$window.removeEventListener("wheel",_.throttle(vm.scroll,50)),$window.removeEventListener("keydown",vm.keydown)}),vm.scroll=function(e){if(Math.abs(e.deltaY)>70)e.deltaY<0?vm.slickConfig.method.slickPrev():vm.slickConfig.method.slickNext();else{var timeOfCurScroll=(new Date).getTime(),timeThreshold=100,timeDiff=timeOfCurScroll-vm.timeOfPrevScroll;timeDiff>timeThreshold&&(e.deltaY<0?vm.slickConfig.method.slickPrev():vm.slickConfig.method.slickNext()),vm.timeOfPrevScroll=timeOfCurScroll}},vm.keydown=function(e){switch(e.key){case"ArrowUp":vm.slickConfig.method.slickPrev();break;case"ArrowDown":vm.slickConfig.method.slickNext();break;case"PageUp":vm.slickConfig.method.slickPrev();break;case"PageDown":vm.slickConfig.method.slickNext();break;case"Tab":vm.handleTabKeydown(e)}},vm.handleTabKeydown=function(e){var section=$element[0].querySelector(".slick-active"),actionableElements=section.querySelectorAll("a"),closeButton=$document[0].querySelector(".modal-dialog button.close");e.shiftKey||0!==actionableElements.length?(e.shiftKey||$document[0].activeElement!==actionableElements[actionableElements.length-1]||(e.preventDefault(),vm.slickConfig.method.slickNext(),$timeout(function(){closeButton.focus()},600)),e.shiftKey&&$document[0].activeElement===closeButton&&(vm.slickConfig.method.slickPrev(),$timeout(function(){section=$element[0].querySelector(".slick-active"),actionableElements=section.querySelectorAll("a"),actionableElements[actionableElements.length-1].focus()},600))):(e.preventDefault(),vm.slickConfig.method.slickNext(),$timeout(function(){closeButton.focus()},600))}}var benefitsContainerComponent={templateUrl:"app/marketing/components/benefitsContainer/benefitsContainer.component.tpl.html",controller:benefitsContainerController,bindings:{settings:"<"},controllerAs:"vm"};angular.module("marketingCore").component("benefitsContainer",benefitsContainerComponent)}(angular),function(angular){"use strict";var timeSlotSelector={templateUrl:"app/storeLocator/components/timeSlotSelector/timeSlotSelector.tpl.html",controller:"TimeSlotSelectorController",controllerAs:"vm",bindings:{}};angular.module("tmobileApp").component("timeSlotSelector",timeSlotSelector)}(window.angular),function(angular,lodash,moment){"use strict";function emailCaptureController($window,analyticsUtils,csrfTokenUtils,eventRouterService){var vm=this;vm.moduleId=vm.settings.config.moduleID?vm.settings.config.moduleID.replace(/\s+/g,"-"):"email-capture",vm.view="",vm.isFormStarted=!1,vm.views={CAPTURE_EMAIL:"captureEmail",CONFIRM_SUBMISSION:"confirmSubmission"},vm.hasServerError=!1,vm.allowOptIn="true"===vm.settings.content["default"].optIn.enabled,vm.$onInit=function(){vm.view=vm.views.CAPTURE_EMAIL,vm.optIn=vm.settings.content["default"].optIn.initialValue},vm.formStart=function(){vm.isFormStarted||(analyticsUtils.trackForm({attributes:{type:"navigation"},eventType:"form start",assetType:"navigation",formName:vm.settings.content["default"].headline,analyticsID:vm.settings.config.analyticsID}),vm.isFormStarted=!0)},vm.collateFormData=function(form){var data={},inputs=vm.settings.content["default"].inputs;for(var input in inputs)if(input){var inputName=inputs[input].inputName;data[inputName]=form[inputName].$modelValue||""}return data},vm.collectCSRFToken=function(){csrfTokenUtils.getCSRF(vm.settings.config.authToken).then(vm.sendEmailData,vm.logError)},vm.generateDataPayload=function(){var array=new Uint8Array(1),payloadData={id:(window.crypto.getRandomValues(array)/(Math.pow(2,8)-1)).toString(36).replace(/[^a-zA-Z0-9]+/g,"").substr(0,6),createdDate:moment().format("YYYY-MM-DD hh:mm:ss.SSS"),language:$window.document.documentElement.lang,optInEmail:vm.optIn,optInSource:"Web",sourceUrl:$window.location.href.split(/[?#]/)[0]};return lodash.merge(vm.formData,payloadData)},vm.logSuccess=function(response){vm.view=vm.views.CONFIRM_SUBMISSION,analyticsUtils.trackForm({attributes:{type:"navigation"},eventType:"form complete",assetType:"navigation",formName:vm.settings.content["default"].headline,analyticsID:vm.settings.config.analyticsID})},vm.logError=function(response){vm.hasServerError=!0},vm.sendEmailData=function(token){var payload={method:vm.settings.config.serviceMethod,url:vm.settings.config.serviceURL,headers:{Authorization:"Basic "+vm.settings.config.authToken,"CSRF-Token":token},data:vm.generatedData};eventRouterService.sendEmailCaptureData(payload).then(function(response){response.success&&200===response.status?vm.logSuccess():vm.logError()})},vm.processSubmission=function(form){vm.hasServerError=!1,form.$valid?(vm.formData=vm.collateFormData(form),vm.generatedData=vm.generateDataPayload(),vm.collectCSRFToken(),analyticsUtils.trackFormSubmit({eventType:"clickToAction",assetType:"button",formName:vm.settings.content["default"].headline,analyticsID:vm.settings.config.analyticsID,submitText:vm.settings.content["default"].cta.text,targetUrl:vm.settings.content["default"].cta.analyticsId})):vm.formData=void 0}}emailCaptureController.$inject=["$window","analyticsUtils","csrfTokenUtils","eventRouterService"];var emailCaptureComponent={templateUrl:"app/marketing/components/emailCapture/emailCapture.component.tpl.html",controller:emailCaptureController,controllerAs:"vm",bindings:{settings:"<",onSubmit:"&"}};angular.module("marketingCore").component("emailCapture2",emailCaptureComponent)}(angular,_,moment),function(angular,lodash){"use strict";function timeSlotSelectorController($log,storeLocatorModelService,storeAppointmentService,pdlService,genericModalUtil,mapUtil,storeLocatorConstants,globalValue){function submitSelectedAppointment(){var elem=angular.element(".store-locator-container")[0];lodash.isEmpty(elem)||angular.element(".store-locator-container").scrollTop(0);var dateData="Select Date: "+vm.model.selectedDateAndDay.date+" Select Time: "+vm.model.selectedDateAndDay.timeSlots[vm.model.selectedTimeIndex];storeAppointmentService.getReasons("schedule").then(function(reasonsResponse){vm.model.reasons=reasonsResponse;var ctaName="CTA Click : Next";pdlService.CTAClickEvent(ctaName,"","","",dateData,vm.store.id),vm.model.sectionToDisplay=vm.views.APPOINTMENT_FORM})}function onClickTime(index){vm.model.selectedTimeIndex=index}var vm=this;vm.modalName="Select Time & Date",vm.model=storeLocatorModelService.model,vm.store=vm.model.store,vm.views=storeLocatorConstants.SECTIONS,vm.authoring=globalValue.authorValue.storeauthoring.appointmentsAndWaitTime,vm.model.selectedSlot=[],storeLocatorModelService.createStoreAddress(),mapUtil.setMarkers(!0,[vm.model.store],1,null),vm.model.isAppointmentRescheduled?(vm.modalName="Modify Time & Date",vm.header=vm.authoring.rescheduleTimeSelectorHeader,vm.model.selectedDateIndex=0,vm.model.selectedTimeIndex=null):vm.header=vm.authoring.selectTimeFieldLabel,vm.submitSelectedAppointment=submitSelectedAppointment,vm.onClickTime=onClickTime,vm.closeAppointment=storeAppointmentService.closeAppointment}timeSlotSelectorController.$inject=["$log","storeLocatorModelService","storeAppointmentService","pdlService","genericModalUtil","mapUtil","storeLocatorConstants","globalValue"],angular.module("tmobileApp").controller("TimeSlotSelectorController",timeSlotSelectorController)}(window.angular,window._),function(angular){"use strict";function marketingOptOutController($anchorScroll,$sce,$log,marketingConstants,apiURLs,marketingHttpRequest,analyticsUtils,JWToken,commonServices){function prePopulateEmail(){vm.queryEmail=$location.search().email,vm.queryEmail&&(vm.queryEmail=vm.queryEmail.replace(" ","%2B"),vm.queryEmail=$window.decodeURIComponent(vm.queryEmail),vm.mooDataEmail=vm.queryEmail)}var formNameOption,formType,vm=this,$window=commonServices.$window,$location=commonServices.$location,emailForm="email"===vm.settings.content["default"].displayFormAs;vm.states=marketingConstants.states,formNameOption=window.TMOPersonalize&&"customer"===window.TMOPersonalize.page?"Customer Marketing Communications Opt Out ":"Marketing Communications Opt Out ",formType=emailForm?"Type 1":"Type 2",vm.view="",vm.views={CAPTURE_OPT_OUT:"captureOptOut",CONFIRM_SUBMISSION:"confirmSubmission"},vm.hasServerError=!1,vm.analyticsValues={formName:"optOutForm",formStart:{analyticsID:vm.settings.config.analyticsID,formName:formNameOption+formType,eventType:"form start",ctaName:""},formSubmit:{analyticsID:vm.settings.config.analyticsID,formName:formNameOption+formType,eventType:"clickToNavigate",submitText:vm.settings.content["default"].unsubscribeCta.text,icid:vm.settings.content["default"].unsubscribeCta.icid,attributes:{type:"navigation"}},formEnd:{analyticsID:vm.settings.config.analyticsID,formName:formNameOption+formType,eventType:"form complete",ctaName:vm.settings.content["default"].unsubscribeCta.text}},vm.$onInit=function(){vm.view=vm.views.CAPTURE_OPT_OUT,prePopulateEmail()},vm.formatPhoneNumber=function(phoneNumberString){if(!phoneNumberString)return"";var cleaned=(""+phoneNumberString).replace(/\D/g,""),match=cleaned.match(/^(\d{3})(\d{3})(\d{4})$/);match&&(vm.formattedNumber="("+match[1]+") "+match[2]+"-"+match[3]);
},vm.trustHtml=function(value){return $sce.trustAsHtml(value)},vm.updateAnalytics=function(){var userSelectionArr=[],hasSelectedCheckbox=!1;emailForm&&userSelectionArr.push("Email Address"),vm.mooDataEmailCheck&&(hasSelectedCheckbox=!0,userSelectionArr.push(vm.settings.content["default"].fullOptOutForm.emailHeadline)),vm.mooDataPhoneCheck&&(hasSelectedCheckbox=!0,userSelectionArr.push(vm.settings.content["default"].fullOptOutForm.phoneHeadline)),vm.mooDataMailCheck&&(hasSelectedCheckbox=!0,userSelectionArr.push(vm.settings.content["default"].fullOptOutForm.mailHeadline)),vm.analyticsValues.formEnd.promoCode=vm.mooDataOfferCode,(hasSelectedCheckbox||emailForm)&&(vm.analyticsValues.formEnd.userSelection="Opt Out Selection : "+userSelectionArr.join(" | "))},vm.submit=function(form){if(vm.submitted=!0,vm.hasServerError=!1,form.$valid){var url=apiURLs.marketingOptOutApi,headers={"Content-Type":"application/json"},data={serviceType:"NONCUSTOMER",attribute:{code:"LANG_CODE",value:"ENG",updatedTime:"8"},attributeLevel:"0"};(vm.mooDataEmailCheck||"email"===vm.settings.content["default"].displayFormAs)&&(data.email=[{emailAddressType:"Other",emailAddress:vm.mooDataEmail,isValidated:"Y"}],"email"===vm.settings.content["default"].displayFormAs&&(data.firstName="Valued",data.familyNames="Customer")),"full"===vm.settings.content["default"].displayFormAs&&(data.firstName=vm.mooDataFirstName,data.familyNames=vm.mooDataLastName,vm.mooDataPhoneCheck&&(data.phone=[{phoneNumber:vm.mooDataPhone,isValidated:"N",phoneType:"Other"}]),vm.mooDataMailCheck&&(data.physicalAddress=[{isValidated:"N",isOverride:"N",physicalAddressType:"Other",addressLine1:vm.mooDataAddressOne,addressLine2:vm.mooDataAddressTwo,cityName:vm.mooDataCity,stateName:vm.mooDataState,postalCode:vm.mooDataZip}],data.offerCodes=[{offerId:vm.mooDataOfferCode}])),JWToken.getJSONWebToken().then(function(jwtresponse){headers.Authorization="Bearer "+jwtresponse,headers.Accept="application/json",marketingHttpRequest.patch(url,headers,data,!1).then(function(response){vm.confirmationNumber=response.data.confirmationCode,vm.logSuccess()})["catch"](function(error){vm.logError(!0)})})["catch"](function(){vm.logError(),$log.log("Error, valid token not available")})}else $log.log("error","Form is invalid")},vm.logSuccess=function(){vm.view=vm.views.CONFIRM_SUBMISSION,analyticsUtils.trackForm(vm.analyticsValues.formEnd)},vm.logError=function(isoptoutServiceError){vm.hasServerError=!0,isoptoutServiceError&&analyticsUtils.trackServiceError(vm.settings.content["default"].serverErrorCopy,"")},vm.scrollToTop=function(id){$anchorScroll(id)},vm.validatePhoneOnChange=function(formInput){void 0===formInput.$modelValue||formInput.$modelValue.length<10?formInput.$setValidity("minlength",!1):formInput.$setValidity("minlength",!0)}}marketingOptOutController.$inject=["$anchorScroll","$sce","$log","marketingConstants","apiURLs","marketingHttpRequest","analyticsUtils","JWToken","commonServices"];var marketingOptOutComponent={templateUrl:"app/marketing/components/marketingOptOut/marketingOptOut.component.tpl.html",controller:marketingOptOutController,bindings:{settings:"<",mooDataPhone:"@",mooDataEmail:"@",mooDataOfferCode:"<",mooDataEmailCheck:"<",mooDataPhoneCheck:"<",mooDataMailCheck:"<",mooDataSmsCheck:"<"},controllerAs:"vm"};angular.module("marketingCore").component("marketingOptOut",marketingOptOutComponent)}(angular),function(angular){"use strict";function genericModalControllerConstructor($modalInstance,storeLocatorModelService,pdlService,storeLocatorConstants){function dismiss(modalName){$modalInstance.dismiss("cancel")}function close(flow,modalName){$modalInstance.close(flow),flow===storeLocatorConstants.APPT_FLOWS.ORIGINAL&&pdlService.setFormCompleteEvent()}var vm=this;vm.model=storeLocatorModelService.model,vm.dismiss=dismiss,vm.close=close}genericModalControllerConstructor.$inject=["$modalInstance","storeLocatorModelService","pdlService","storeLocatorConstants"],angular.module("tmobileApp").controller("genericModalController",genericModalControllerConstructor)}(window.angular),function(angular){"use strict";function pagerController(utils){var vm=this;vm.$onInit=function(){}}pagerController.$inject=["utils"];var pagerComponent={controller:pagerController,template:'<div class="pager-container" >pager placeholder</div>',bindings:{totalCount:"<",pageSize:"<",settings:"<",onPageSelectionChanged:"&"}};angular.module("marketingCore").component("pager",pagerComponent)}(window.angular),function(angular,lodash){"use strict";function storeAppointmentService($rootScope,$state,apiService,geoLocation,storeAppointmentUtil,httpRequestWrapper,storeLocatorInitUtil,genericModalUtil,commonServices,storeLocatorModelService,storeLocatorUtil,globalValue,storeLocatorConstants,navigationUtil,pdlService,STORE_LOCATOR_STATE_NAME){function errorhandler(returnCode){switch(returnCode){case 102:vm.model.isAppointmentRescheduled=!0,vm.model.modalToBeDisplayed=modals.CONCURRENT_APPOINTMENT,vm.model.sectionToDisplay=views.TIME_SLOT_SELECTOR;break;case 103:vm.model.modalToBeDisplayed=modals.PRE_EXISTING_APPOINTMENT;break;default:vm.model.modalToBeDisplayed=modals.ERROR_STATE}return"fail"}function createLead(){var urlObject,user,status,header={"Content-Type":"application/json"};urlObject=apiService.getURL("storeLocator.createLead"),user=storeLocatorModelService.model.user;var data={storeId:storeLocatorModelService.model.store.id,firstName:user.firstName,lastName:user.lastName,email:user.email,phoneNumber:user.phone,zipCode:user.zipCode,company:user.companyName,locale:user.languagePreferenceOptions?"English"===user.languagePreferenceOptions?"en_US":"en_es":"",existingCustomer:user.customerStatusOptions?"Yes"===user.customerStatusOptions?"true":"false":"",notes:user.notes,reason:user.reason,updateRecord:"true",consent:user.consent?user.consentObject.uniqueId:"",channel:channel},adobeCampaignId=""!==$cookies.get(campaignCookies.URL_CAMPAIGN_ID)?$cookies.get(campaignCookies.URL_CAMPAIGN_ID):"";return isB2B&&(data.adobeCampaignId=adobeCampaignId),httpRequestWrapper.post(urlObject.url,data,"",header,!0).then(function(response){var returnCode=response.data.returnCode||response.data.result.returnCode;if(0===returnCode)storeLocatorModelService.model.user.leadId=response.data.leadId,status="success";else{status=errorhandler(returnCode);var errorText=response.data.errorList[0]?response.data.errorList[0].substr(0,254):"";vm.model.appointmentErrorCode=returnCode,vm.model.appointmentErrorText=errorText}return status},function(error){return $log.log(error),status=errorhandler(),vm.model.appointmentErrorCode=error.statusCode,vm.model.appointmentErrorText=error.statusText.substr(0,254),status})["catch"](function(){return status=errorhandler(),vm.model.appointmentErrorCode="-1",vm.model.appointmentErrorText="",status})}function scheduleAppointment(){var status,urlObject,data,headers={"Content-Type":"application/json"};return urlObject=apiService.getURL("storeLocator.scheduleAppointment"),data={storeId:storeLocatorModelService.model.store.id,leadId:storeLocatorModelService.model.user.leadId,appointmentDate:storeLocatorModelService.model.selectedDateAndDay.date,appointmentTime:storeLocatorModelService.model.selectedTimeSlot,autoReschedule:"false",channel:channel,transactionId:storeLocatorModelService.model.transactionId},httpRequestWrapper.post(urlObject.url,data,"",headers,!0).then(function(response){var returnCode=response.data.returnCode||response.data.result.returnCode;if(0===returnCode)storeLocatorModelService.model.user.appointmentId=response.data.appointmentList[0].appointmentId,status="success";else{status=errorhandler(returnCode);var errorText=response.data.errorList[0]?response.data.errorList[0].substr(0,254):"";vm.model.appointmentErrorCode=returnCode,vm.model.appointmentErrorText=errorText}return status},function(error){return $log.log(error),status=errorhandler(),vm.model.appointmentErrorCode=error.statusCode,vm.model.appointmentErrorText=error.statusText.substr(0,254),status})["catch"](function(){return status=errorhandler(),vm.model.appointmentErrorCode="-1",vm.model.appointmentErrorText="",status})}function getAvailableTimeSlots(storeId){var status,headers={"Content-Type":"application/json"},urlObject=apiService.getURL("storeLocator.availableTimeSlotsForAppointment"),url=urlObject.url,query={storeId:storeLocatorModelService.model.store.id,requestDateTime:moment().format("MM/DD/YYYY"),numberOfDays:"15"};return httpRequestWrapper.get(url,query,headers,!0).then(function(response){var returnCode=response.data.returnCode||response.data.result.returnCode;if(0===returnCode)vm.model.availableTimeSlots=lodash.get(response.data,"availableTimeSlots"),vm.model.timeSlotsAvailableFor=lodash.get(response.data,"storeId"),status="success";else if(106===returnCode){var obj={availableTimeSlots:[]},today=new Date;const FULL_DAYS=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];for(var i=0;14>i;i++){0!==i&&today.setDate(today.getDate()+1);var month=""+(today.getMonth()+1),day=""+today.getDate();month.length<2&&(month="0"+month),day.length<2&&(day="0"+day);var temp={timeSlots:[],day:FULL_DAYS[today.getDay()],date:month+"/"+day+"/"+today.getFullYear()};obj.availableTimeSlots.push(temp)}vm.model.availableTimeSlots=lodash.get(obj,"availableTimeSlots"),vm.model.timeSlotsAvailableFor=lodash.get(storeId),status="success"}else{status=errorhandler(returnCode);var errorText=response.data.errorList[0]?response.data.errorList[0].substr(0,254):"";vm.model.appointmentErrorCode=returnCode,vm.model.appointmentErrorText=errorText}return status},function(error){return $log.log(error),status=errorhandler(),vm.model.appointmentErrorCode=error.statusCode,vm.model.appointmentErrorText=error.statusText.substr(0,254),status})["catch"](function(){return status=errorhandler(),vm.model.appointmentErrorCode="-1",vm.model.appointmentErrorText="",status})}function cancelAppointment(reason){var status,urlObject=apiService.getURL("storeLocator.cancelAppointment"),headers={"Content-Type":"application/json"},body={leadId:storeLocatorModelService.model.user.leadId,appointmentId:storeLocatorModelService.model.user.appointmentId,reasonForCancel:reason,channel:channel};return httpRequestWrapper.post(urlObject.url,body,"",headers,!0).then(function(response){var returnCode=response.data.returnCode||response.data.result.returnCode;if(0===returnCode)storeLocatorModelService.model.user.appointmentId=null,storeLocatorModelService.model.user.leadId=null,storeLocatorModelService.model.sectionToDisplay=views.CANCEL_CONFIRMATION,storeLocatorModelService.model.isAppointmentRescheduled=!1,status="success";else{status=errorhandler(returnCode);var errorText=response.data.errorList[0]?response.data.errorList[0].substr(0,254):"";vm.model.appointmentErrorCode=returnCode,vm.model.appointmentErrorText=errorText}return status},function(error){return $log.log(error),status=errorhandler(),vm.model.appointmentErrorCode=error.statusCode,vm.model.appointmentErrorText=error.statusText.substr(0,254),status})["catch"](function(){return status=errorhandler(),vm.model.appointmentErrorCode="-1",vm.model.appointmentErrorText="",status})}function rescheduleAppointment(){var status,body={storeId:storeLocatorModelService.model.store.id,leadId:storeLocatorModelService.model.user.leadId,appointmentId:storeLocatorModelService.model.user.appointmentId,appointmentDate:storeLocatorModelService.model.selectedDateAndDay.date,appointmentTime:storeLocatorModelService.model.selectedTimeSlot,autoReschedule:"true",channel:channel,transactionId:storeLocatorModelService.model.transactionId},header={"Content-Type":"application/json"},urlObject=apiService.getURL("storeLocator.rescheduleAppointment");return httpRequestWrapper.post(urlObject.url,body,"",header,!0).then(function(response){var returnCode=response.data.returnCode||response.data.result.returnCode;if(0===returnCode)storeLocatorModelService.model.user.appointmentId=response.data.appointmentList[0].appointmentId,status="success";else{status=errorhandler(returnCode);var errorText=response.data.errorList[0]?response.data.errorList[0].substr(0,254):"";vm.model.appointmentErrorCode=returnCode,vm.model.appointmentErrorText=errorText}return status},function(error){return $log.log(error),status=errorhandler(),vm.model.appointmentErrorCode=error.statusCode,vm.model.appointmentErrorText=error.statusText.substr(0,254),status})["catch"](function(){return status=errorhandler(),vm.model.appointmentErrorCode="-1",vm.model.appointmentErrorText="",status})}function getReasons(form){var urlObject,url;return urlObject=apiService.getURL("storeLocator.reasonsForAppointmentAndCancel"),url=urlObject.url,url=url.replace("{{form}}",form),httpRequestWrapper.get(url,"",null,!0).then(function(response){var deferred=$q.defer(),reasons=response.data.reasons;return 200===response.status?deferred.resolve(reasons):deferred.reject(),deferred.promise})}function getMyAppointments(){var url=apiService.getURL("storeLocator.myAppointments").url;return url=url.replace("{{leadId}}",storeLocatorModelService.model.user.leadId),httpRequestWrapper.get(url,"",null,!0).then(function(response){var deferred=$q.defer(),returnCode=response.data.returnCode||response.data.result.returnCode;if(0===returnCode){var appointment=response.data.appointmentList[0];deferred.resolve(appointment)}else{var errorText=response.data.errorList[0]?response.data.errorList[0].substr(0,254):"";vm.pdlForErrorEvent(returnCode,errorText),deferred.reject()}return deferred.promise})}function getLeadInfo(){var url=apiService.getURL("storeLocator.getLeadInfo").url;return url=url.replace("{{leadId}}",storeLocatorModelService.model.user.leadId),httpRequestWrapper.get(url,"",null,!0).then(function(response){var deferred=$q.defer(),returnCode=response.data.returnCode||response.data.result.returnCode;if(0===returnCode){var userDetails=response.data;deferred.resolve(userDetails)}else{var errorText=response.data.errorList[0]?response.data.errorList[0].substr(0,254):"";vm.pdlForErrorEvent(returnCode,errorText),deferred.reject()}return deferred.promise})}function getRelevantStoreDetails(){var storeName=vm.model.preExistingAppointment.normalizedStoreName,cityName=vm.model.preExistingAppointment.normalizedCity,stateName=vm.model.preExistingAppointment.normalizeState,storeId=vm.model.preExistingAppointment.storeId;return geoLocation.getLatLng(vm.model.preExistingAppointment.storezip).then(function(latLng){var latLngObject={lat:latLng[0],lng:latLng[1]};return vm.model.spatialPointLatLng=latLng,storeLocatorUtil.getStoreList(latLngObject,vm.model.startIndex,vm.model.resultCount,vm.model.miles,!1).then(function(response){vm.model.startIndex=response.startIndex,vm.model.numberFound=response.numberFound,vm.model.storeList=response.data,vm.model.completeStoreList=response.data,vm.model.noStoresFound=!1;var queryParam={state:stateName,city:cityName,storeName:storeName,operation:storeLocatorConstants.PAGES.ISA};return storeLocatorModelService.changeState(queryParam),storeLocatorInitUtil.pickStore(storeName,storeId)})})}function closeAppointment(modalName){return vm.model.onStoreLocatorModal=!1,vm.model.sectionToDisplay===views.APPOINTMENT_CONFIRMATION&&!vm.model.isUserRedirectedFromMail||vm.model.sectionToDisplay===views.CANCEL_CONFIRMATION?(vm.model.selectedStoreIndex=null,void navigationUtil.backToStoreLocatorMap()):void storeLocatorModelService.showOperationSection()}function getRescheduleAppointmentModel(){vm.model.isUserRedirectedFromMail=!1,vm.model.modalToBeDisplayed=modals.RESCHEDULE,vm.model.isAppointmentRescheduled=!0,genericModalUtil.openModal().then(function(successResult){successResult===modals.CANCEL?navigationUtil.backToStoreLocatorMap():getAvailableTimeSlots().then(function(status){"success"===status?(vm.model.sectionToDisplay=views.TIME_SLOT_SELECTOR,vm.model.selectedDateAndDay=vm.model.availableTimeSlots[0]):genericModalUtil.openModal().then(function(result){$log.log(result),vm.model.sectionToDisplay=storeLocatorConstants.SECTIONS.STORE_DETAILS})})},function(cancelResult){$log.log(cancelResult)})}function getCancelAppointmentModel(){vm.model.isUserRedirectedFromMail=!1,vm.model.modalToBeDisplayed=modals.CANCEL,genericModalUtil.openModal().then(function(successResult){vm.model.sectionToDisplay=views.CANCEL_CONFIRMATION},function(cancelResult){$log.log(cancelResult)})}function pdlForErrorEvent(errorCode,errorText){var pdlObject={errorCode:errorCode,errorText:errorText,modalName:lodash.isEmpty(vm.model.modalToBeDisplayed)?"":vm.model.modalToBeDisplayed};pdlService.callErrorEvent(pdlObject)}var vm=this,$q=commonServices.$q,modals=storeLocatorConstants.MODALS,views=storeLocatorConstants.SECTIONS,channels=storeLocatorConstants.CHANNELS,$log=commonServices.$log;commonServices.$location,commonServices.$stateParams;vm.model=storeLocatorModelService.model;var isB2B=vm.model.isB2B,channel=vm.model.isTMOApp?channels.APP:isB2B?channels.WEB_B2B:channels.WEB,$cookies=commonServices.$cookies,campaignCookies=storeLocatorConstants.CAMPAIGN_COOKIES_NAME;vm.getCancelAppointmentModel=getCancelAppointmentModel,vm.getRescheduleAppointmentModel=getRescheduleAppointmentModel,vm.scheduleAppointment=scheduleAppointment,vm.getAvailableTimeSlots=getAvailableTimeSlots,vm.cancelAppointment=cancelAppointment,vm.rescheduleAppointment=rescheduleAppointment,vm.getReasons=getReasons,vm.getMyAppointments=getMyAppointments,vm.getLeadInfo=getLeadInfo,vm.getRelevantStoreDetails=getRelevantStoreDetails,vm.closeAppointment=closeAppointment,vm.createLead=createLead,vm.pdlForErrorEvent=pdlForErrorEvent}storeAppointmentService.$inject=["$rootScope","$state","apiService","geoLocation","storeAppointmentUtil","httpRequestWrapper","storeLocatorInitUtil","genericModalUtil","commonServices","storeLocatorModelService","storeLocatorUtil","globalValue","storeLocatorConstants","navigationUtil","pdlService","STORE_LOCATOR_STATE_NAME"],angular.module("tmobileApp").service("storeAppointmentService",storeAppointmentService)}(window.angular,window._),function(angular){"use strict";var tradeInComponent={templateUrl:"app/marketing/components/tradeIn/tradeIn.component.tpl.html",controller:"tradeInDetailsController",bindings:{cacheFlag:"<",estimateTerms:"@",deviceCarrier:"@",deviceCarrierError:"@",deviceManufacturer:"@",deviceManufacturerError:"@",deviceModel:"@",deviceModelError:"@",estimateHeader:"@",shopNow:"@",back:"@",shopNowUrl:"@",ctaLabel:"@",shopNowWindowTarget:"@",showShopNowBtn:"<",ctaLabelIcid:"@",shopNowIcid:"@",backIcid:"@",parentAnalyticsId:"@"},controllerAs:"vm"};angular.module("marketingCore").component("tradeInComponent",tradeInComponent)}(window.angular),function(angular,lodash){"use strict";function storeLocatorModelService(commonServices,pdlService,universalMenuDataService,toggleService,mapUtil,genericModalUtil,globalValue,storeLocatorConstants,STORE_LOCATOR_STATE_NAME,digitalToRetailConstant,productDetailsService,cartStorage){function listenToLivePersonChatEvent(){$window.addEventListener("storeLocatorLPEvent",function(event){event&&"chatNotification"===event.detail&&enableLPChat()})}function enableLPChat(){model.enableLPChatCTA=!0}function engageLivePerson(){$window.lpTag&&$window.lpTag.newPage&&$window.lpTag.newPage(document.URL,{section:lpTag.section})}function sortValueMappingForAPI(value){var map={};return map.type1=storeAuthoringOption.recommendedOption,map[storeAuthoringOption.recommendedOption]=storeAuthoringOption.recommendedOption,map.type2=storeAuthoringOption.distanceOption,map[storeAuthoringOption.distanceOption]=storeAuthoringOption.distanceOption,toggleService.model.toggles.enableProductRepairCenter&&(map.type4=storeAuthoringOption.productRepairCentersOption,map[storeAuthoringOption.productRepairCentersOption]=storeAuthoringOption.productRepairCentersOption),map[value]?map[value]:map.type1}function sortValueMappingForUrl(sortBy){var map={};return map.type1=storeAuthoringOption.recommendedOption,map[storeAuthoringOption.recommendedOption]="type1",map.type2=storeAuthoringOption.distanceOption,map[storeAuthoringOption.distanceOption]="type2",toggleService.model.toggles.enableProductRepairCenter&&(map[storeAuthoringOption.productRepairCentersOption]="type4"),map[sortBy]}function backToSearchResult(){model.showSearchResultView?(model.sectionToDisplay=views.SEARCH_RESULTS,model.hideCompleteCarousel=!0,model.clearSearchButton=!0,model.openNow=!1,model.serveSprint=!1,model.repairCenter=!1):(model.sectionToDisplay="",model.hideCompleteCarousel=!1,model.zoomEventTriggeredManually=!1,model.backtoCityPage=!0,model.isMobileView?mapUtil.sendOffsets(20,50,20,80):mapUtil.sendOffsets(0,0,0,100),mapUtil.setMarkers(!0,model.storeList,model.start,model.end),$rootScope.$$postDigest(function(){model.slickConfig.method.slickGoTo(model.selectedStoreIndex)})),model.nearByStoreSelected=!1,model.store.nearbyStores=model.SDPViaDeeplink?model.store.nearbyStores:[],mapUtil.selectMarkerWithHtml(model.selectedStoreIndex,!1,!0,null),model.selectedStoreIndex=model.SDPViaDeeplink?model.selectedStoreIndex:null,changeState(model.prevUrlStateAndQueryParams,!0,!1,!0),$timeout(function(){model.prevUrlStateAndQueryParams=""},0)}function showOperationSection(operation,storeLocatorInModalFlag){var stateRouteConfig={},inherit=!1,notify=!1;switch(model.hideCompleteCarousel=!0,model.sectionToDisplay="",operation){case pages.GIL:model.store.inStoreWaitTime>=0?(model.sectionToDisplay=views.GET_IN_LINE,stateRouteConfig=setStateConfig(model.store),stateRouteConfig.operation=operation):(model.modalToBeDisplayed=storeLocatorConstants.MODALS.ERROR_STATE,model.errorState=storeLocatorConstants.PAGES.GIL,stateRouteConfig=setStateConfig(model.store),genericModalUtil.openModal().then(function(successResult){$log.log(successResult),model.sectionToDisplay=views.STORE_DETAILS}));break;case pages.ISA:model.sectionToDisplay=views.TIME_SLOT_SELECTOR,model.selectedDateIndex=0,model.selectedTimeIndex=null,model.isUserRedirectedFromMail=!1,1==storeLocatorInModalFlag&&(model.storeLocatorInModal=!0),stateRouteConfig=setStateConfig(model.store),stateRouteConfig.operation=operation;break;default:angular.isDefined(operation)?(notify=!1,model.sectionToDisplay=views.STORE_DETAILS,stateRouteConfig=setStateConfig(model.store)):(notify=!1,model.sectionToDisplay=views.STORE_DETAILS,stateRouteConfig=setStateConfig(model.store))}updateQueryParams(),changeState(stateRouteConfig,!0,inherit,notify,!0)}function setStateConfig(store){var stateName=$filter("normalize")(store.location.address.addressRegion),cityName=$filter("normalize")(store.location.address.addressLocality),storeName=$filter("normalize")(store.name),stateRouteConfig={state:stateName,city:cityName,storeName:storeName};return stateRouteConfig}function citySelected(rowItem){var normCity="";if(lodash.isNil(rowItem))return void $log.error("Invalid data: no data found");if(lodash.isNil(rowItem.name))return void $log.error("Invalid data: no property for city name found");model.zoomEventTriggeredManually=!1,model.showPrev=!1,model.selectedCity=rowItem,normCity=$filter("normalize")(rowItem.name),$stateParams.city=normCity;var ctaName="SRP Blade Click: "+rowItem.name,targetUrl=commonServices.$location.path()+"/"+normCity;pdlService.CTANavOrClickEvent(ctaName,targetUrl,!0,"","blade"),changeState({state:$stateParams.state,city:$stateParams.city},!0,!0,!0),$rootScope.$broadcast("SL_SEO_UPDATE",{})}function createStoreAddress(){var storeAddressObject=lodash.get(model,"store.location.address");lodash.isEmpty(storeAddressObject)||(model.storeAddress=storeAddressObject.streetAddress+", "+storeAddressObject.addressLocality+", "+storeAddressObject.addressRegion+" "+storeAddressObject.postalCode)}function validatePhoneNumberOnChange(formInput){angular.isUndefined(formInput.$modelValue)||""===formInput.$modelValue?formInput.$setValidity("minlength",!1):angular.isDefined(formInput.$modelValue)&&formInput.$modelValue.length>0&&formInput.$modelValue.length<10?formInput.$setValidity("minlength",!1):formInput.$setValidity("minlength",!0)}function setInfoCarouselConfig(){model.slickConfig={dots:!0,variableWidth:!0,centerMode:!1,centerPadding:"5px",draggable:!0,focusOnSelect:!0,infinite:!1,mobileFirst:!0,prevArrow:".slick-prev",nextArrow:".slick-next",swipeToSlide:!0,method:{},event:{init:function(){mapUtil.selectMarkerWithHtml(0,!0,!0,null)},beforeChange:function(event,slick,currentSlide,nextSlide){mapUtil.selectMarkerWithHtml(currentSlide,!1,!1,model.htmlToSend)},afterChange:function(event,slick,currentSlide,nextSlide){mapUtil.selectMarkerWithHtml(currentSlide,!0,!0,model.htmlToSend)}}}}function updateQueryParams(){var queryParamsFinal=lodash.omit(queryParams,["filterBy","sortBy","page","search","additionalUrl","appointment_Id","filter"]);lodash.isEmpty(queryParamsFinal)||lodash.forIn(queryParamsFinal,function(value,key){$location.search(key,value)})}function changeState(stateParams,location,inherit,notify,updateParams){model.storeLocatorInModal||($state.transitionTo(STORE_LOCATOR_STATE_NAME,angular.extend({},stateParams),{location:location||storeLocatorConstants.OTHERS.REPLACE,inherit:inherit||!1,relative:$state.$current,notify:notify||!1}),updateParams&&updateQueryParams())}function setStoreFilterAuthorContentInModel(pageType){var storeFilterAuthor={},digitalToRetailAuthoring=globalValue.authorValue.storeauthoring.digitalToRetail;pageType===digitalToRetailConstant.PAGE_TYPE.CART?(storeFilterAuthor.applyFilter=digitalToRetailAuthoring.applyStoreFilterCart===digitalToRetailConstant.APPLY_STORE_FILTER.YES,storeFilterAuthor.headerLabel=digitalToRetailAuthoring.headerLabelStoreFilterCart,storeFilterAuthor.checkboxDescription=digitalToRetailAuthoring.checkboxDescriptionlStoreFilterCart,storeFilterAuthor.checkboxMessage=digitalToRetailAuthoring.checkboxMessagelStoreFilterCart):(storeFilterAuthor.applyFilter=digitalToRetailAuthoring.applyStoreFilterPDP===digitalToRetailConstant.APPLY_STORE_FILTER.YES,storeFilterAuthor.headerLabel=digitalToRetailAuthoring.headerLabelStoreFilterPDP,storeFilterAuthor.checkboxDescription=digitalToRetailAuthoring.checkboxDescriptionlStoreFilterPDP,storeFilterAuthor.checkboxMessage=digitalToRetailAuthoring.checkboxMessagelStoreFilterPDP),model.storeFilterAuthor=storeFilterAuthor,model.pageType=pageType}function isNoNearbyStoreWithInventory(){return angular.isUndefined(lodash.find(model.d2rModelManager.getInStockStores(),function(store){return!isNaN(store.storeDistance)&&parseFloat(store.storeDistance)<=parseFloat(model.miles)}))}function getPDLDataReady(){var productCartData=[],cartData=cartStorage.getGlobalSmartCartInfo(),productPDPData=Object.assign({},productDetailsService.model.selectedProduct),productMiniPDPData=Object.assign({},productDetailsService.miniPDPSelectedProduct);"cart"===model.pageType&&cartData&&angular.forEach(cartData.lineItems,function(productsData){angular.isDefined(productsData.lineItemDetails.deviceDetails.id)&&productCartData.push(productsData.lineItemDetails.deviceDetails)}),"pdp"===model.pageType&&productPDPData.Family?productCartData.push(productPDPData):"minipdp"===model.pageType&&productCartData.push(productMiniPDPData),productAnalyticsData=Object.assign({},productCartData),lodash.isEmpty(model.store)||lodash.forEach(productAnalyticsData,function(pdlObj){model.store.inventoryDetails&&model.store.inventoryDetails.length>0&&(pdlObj.SKU||pdlObj.sku)===model.store.inventoryDetails[0].sku?(pdlObj.storeID=model.store.id,pdlObj.statusValue=model.store.inventoryMessage):("pdp"===model.pageType||"minipdp"===model.pageType)&&(pdlObj.storeID=model.store.id,pdlObj.statusValue=getInventoryStatus(model.store.availabilityCode))}),model.productAnalyticsData=productAnalyticsData}function getInventoryStatus(availabilityCode){var digitalToRetailAuthoring=globalValue.authorValue.storeauthoring.digitalToRetail;switch(availabilityCode){case digitalToRetailConstant.INVENTORY_STATUS_CODE.IN_STOCK:return digitalToRetailAuthoring.inStock||digitalToRetailConstant.INVENTORY_STATUS[103];case digitalToRetailConstant.INVENTORY_STATUS_CODE.FEW_LEFT:return digitalToRetailAuthoring.fewLeft||digitalToRetailConstant.INVENTORY_STATUS[102];case digitalToRetailConstant.INVENTORY_STATUS_CODE.OUT_OF_STOCK:return digitalToRetailAuthoring.outOfStock||digitalToRetailConstant.INVENTORY_STATUS[101];default:return digitalToRetailAuthoring.inventoryStatusUnavailable||digitalToRetailConstant.INVENTORY_STATUS.INV_UNKNOWN}}function getStoreServeText(store){var serveText="";return store.hasSprintStack&&!store.hasTmobileStack?serveText=lodash.get(storeAuthoringOption,"serveSprintText",""):store.hasSprintStack&&store.hasTmobileStack?serveText=lodash.get(storeAuthoringOption,"serveDualText",""):!store.hasSprintStack&&store.hasTmobileStack&&(serveText=lodash.get(storeAuthoringOption,"serveTmobileText","")),serveText}var generalAuthoring=globalValue.authorValue.storeauthoring?globalValue.authorValue.storeauthoring.generalAuthoringStores:{},$rootScope=commonServices.$rootScope,$window=commonServices.$window,$log=commonServices.$log,$state=commonServices.$state,$filter=commonServices.$filter,$stateParams=commonServices.$stateParams,views=storeLocatorConstants.SECTIONS,pages=storeLocatorConstants.PAGES,$location=commonServices.$location,$timeout=commonServices.$timeout,queryParams=angular.copy($location.search()),productAnalyticsData={},model={spatialPointLatLng:[],expandMileRadiusCount:0,hideFindNearByStoreLink:!1,storeList:[],completeStoreList:[],cityList:[],availableTimeSlots:[],miles:generalAuthoring.numberOfMiles||"20",resultCount:generalAuthoring.numberOfTotalResults||"50",d2rResultsCount:"25",storeFilters:[],storeSortByOption:generalAuthoring.recommendedOption,selectedDateAndDay:{},selectedDateIndex:0,selectedTimeIndex:null,sectionToDisplay:"",showSTALink:!1,showNYLLink:!1,clearSearchButton:!1,start:1,end:10,enablePagination:!0,maxStoreDisplay:10,slickConfig:{},lat:"","long":"",isMobileView:universalMenuDataService.isMobileView(),showPrev:!1,showNext:!1,user:{},invalidSearchAddress:!1,isUserRedirectedFromMail:!1,noStoresFound:!1,noCitiesFound:!1,loadPrevStoreListView:!1,searchField:"",breadCrumbItems:[],startIndex:0,currentPageNumber:1,storeLocatorInModal:!1,isB2B:window.isB2B,storeInventoryData:{},store:{},inventoryFilter:{},pageType:"",hideContainer:!1,inventoryDetails:{},currentStore:"",productAnalyticsData:{},isIfTFBStoreAppointmentAvail:window.isB2B?!toggleService.model.toggles.disableTFBStoreAppointment:!0,enableLPChatCTA:!1},storeAuthoringOption=(lodash.get(globalValue.authorValue.storeauthoring,"storeFilters.tmobileStoresDescription",""),lodash.get(globalValue.authorValue.storeauthoring,"storeFilters.authorizedDealerDescription",""),lodash.get(globalValue.authorValue.storeauthoring,"storeFilters.tprStoreDescription",""),lodash.get(globalValue.authorValue.storeauthoring,"generalAuthoringStores",""));return{model:model,backToSearchResult:backToSearchResult,showOperationSection:showOperationSection,createStoreAddress:createStoreAddress,validatePhoneNumberOnChange:validatePhoneNumberOnChange,citySelected:citySelected,sortValueMappingForAPI:sortValueMappingForAPI,sortValueMappingForUrl:sortValueMappingForUrl,setInfoCarouselConfig:setInfoCarouselConfig,setStateConfig:setStateConfig,changeState:changeState,setStoreFilterAuthorContentInModel:setStoreFilterAuthorContentInModel,isNoNearbyStoreWithInventory:isNoNearbyStoreWithInventory,getPDLDataReady:getPDLDataReady,getInventoryStatus:getInventoryStatus,listenToLivePersonChatEvent:listenToLivePersonChatEvent,engageLivePerson:engageLivePerson,getStoreServeText:getStoreServeText}}storeLocatorModelService.$inject=["commonServices","pdlService","universalMenuDataService","toggleService","mapUtil","genericModalUtil","globalValue","storeLocatorConstants","STORE_LOCATOR_STATE_NAME","digitalToRetailConstant","productDetailsService","cartStorage"],angular.module("tmobileApp").factory("storeLocatorModelService",storeLocatorModelService)}(window.angular,window._),function(angular,lodash){"use strict";function ComparisonChartController($scope,$timeout,analyticsUtils){
function onInit(){$timeout(function(){broadcastEvent(0),broadcastEvent(1)},1)}function broadcastEvent(which){$scope.$broadcast("dropdown-select",which)}function onSelectAnalytics(which,data){0===which?data.ctaName=$scope.data.columnOne:data.ctaName=$scope.data.columnTwo,analyticsUtils.trackEvent("CLICK_EVENT",data.analyticsID,{eventInfo:{eventAction:"click",eventType:"clickToAction"},attributes:{type:"navigation"},eventDescription:{dataAnalyticsID:data.analyticsID,ctaName:"Dropdown Menu Click : "+data.ctaName.replace(/<(?:.|\n)*?>/gm," ")}})}function onToolTipAnalytics(data){analyticsUtils.trackEvent("CLICK_EVENT",data.analyticsID,{eventInfo:{eventAction:"click",eventType:"clickToAction"},attributes:{type:"tooltip"},eventDescription:{dataAnalyticsID:data.analyticsID,ctaName:data.ctaName.replace(/<(?:.|\n)*?>/gm," ")}})}var vm=this;vm.broadcastEvent=broadcastEvent,vm.onSelectAnalytics=onSelectAnalytics,vm.onInit=onInit,vm.onToolTipAnalytics=onToolTipAnalytics}ComparisonChartController.$inject=["$scope","$timeout","analyticsUtils"],angular.module("marketingCore").controller("ComparisonChartController",ComparisonChartController)}(angular,window._),function(angular){"use strict";angular.module("tmobileApp").constant("storeLocatorConstants",{MAP_EVENTS:{LOAD:"mapLoaded",OVER:"markerMouseOver",OUT:"markerMouseOut",CLICK:"markerClick",DRAG:"mapDragStart",ZOOM:"mapZoomChanged",IDLE:"mapIdle"},MOUSE_EVENTS:{LEFT:"LEFT",RIGHT:"RIGHT",MIDDLE:"MIDDLE"},URL_NAMES:{},DAY_OF_WEEKS:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],STORE_STATUS:{},URL_PLACEHOLDERS:{STATIC_MAP_URL:"storeLocationStaticMap"},OTHERS:{REPLACE:"replace",TRUE:!0,AEL:"addEventListener",AE:"attachEvent",OM:"onmessage",M:"message",TMO:"t-mobile.com"},MARKER_COLORS:{},MARKER_TYPES:{},STORE_TYPES:{},ALL_DAYS:["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],MODALS:{CANCEL:"cancel",RESCHEDULE:"reschedule",CHICKEN_SWITCH:"chickenSwitch",FILTERCLOSE:"filterClose",PRE_EXISTING_APPOINTMENT:"preExistingAppointment",ERROR_STATE:"errorState",CONCURRENT_APPOINTMENT:"concurrentAppointment",APPOINTMENT_NOT_FOUND:"appointmentNotFound",CART:"cart",CARTACCESSORIES:"cart-accessories",PDP:"pdp",MINIPDP:"minipdp",ACCESSORY_MINI_PDP:"accessory-minipdp"},CHANNELS:{APP:"MyT-Mobile.com",WEB:"T-Mobile.com",WEB_B2B:"T-Mobile.com Business"},CAMPAIGN_COOKIES_NAME:{URL_CAMPAIGN_ID:"url_campaign_id"},PAGES:{LANDING:"landingPage",STATE:"statePage",CITY:"cityPage",STORE:"storePage",GIL:"get-in-line",ISA:"appointment",FILTER:"filter",APPTCONFIRMATION:"apptconfirmation",CART:"cart",CARTACCESSORIES:"cart-accessories",PDP:"pdp",MINIPDP:"minipdp",ACCESSORYMMINIPDP:"accessory-minipdp"},SECTIONS:{SEARCH_RESULTS:"searchResultView",STATE_RESULTS:"stateResultsView",CITY_RESULTS:"cityResultsView",GET_IN_LINE:"getInLine",STORE_DETAILS:"storeDetailView",TIME_SLOT_SELECTOR:"timeSlotSelector",APPOINTMENT_FORM:"appointmentForm",APPOINTMENT_CONFIRMATION:"appointmentConfirmation",CANCEL_CONFIRMATION:"cancelConfirmation"},ADOBE_LOCATION:{LATITUDE:"profile.geoLatitude",LONGITUDE:"profile.geoLongitude"},COOKIES:{LANGUAGE:"MP_LANG"},LANGUAGES:{ENGLISH:"en",ESPANOL:"es"},PLUGINS:{GEOLOCATION:"geolocation"},PERMISSIONS:{GRANTED:"granted",DENIED:"denied",PROMPT:"prompt"},STATUS:{INVENTORY_UNKNOWN:"INV_UNKNOWN",STORE_UNKNOWN:"STORE_UNKNOWN"},IN_STORE_APPOINTMENT_TIME:["106","1143","120E","1225","123D","124D","1253","1258","131D","133E","134","1519","1521","154","1549","155","156","157","1577","158","159","166","167","168","1689","169","1704","1876","194D","196","2016","202","2046","2048","204E","2081","2102","212","213D","215","2199","2278","2293","2348","2368","2380","2381","2406","2411","246E","2554","257E","2615","2631","270","2708","2711","2720","2749","2772","2774","2787","2788","2792","2807","2840","2850","2851","2852","2853","2854","2855","2856","2857","2888","2901","2926","2930","2934","2939","2954","2957","2960","2962","2974","2983","2984","2989","300","301","327","340","341","342D","344D","360D","364E","365E","3783","3847","3848","4008","4010","4062","4087","4094","409E","4124","4125","4134","4156","4159","4185","4197","4209","4220","4221","4222","4224","4237","4239","423E","4249","4260","4261","4270","4276","4287","4289","4298","4305","431D","4328","4331","4347","4352","4386","4389","4414","4452","4458","4464","4465","4471","4472","4475","4501","4521","4522","4531","4535","4536","4577","457D","4582","4585","4595","4599","4601","4604","4607","4644","4666","4706","4710","4731","4732","4733","4740","4746","4757","4797","4820","4826","4827","4834","4947","5116","5121","520","5207","521","5255","527","5278","529","530","5300","5316","532","533","534","535","536","537","5377","5478","5505","5543","5553","5558","5565","5566","5568","5574","5586","5594","5641","565D","5679","5732","5746","603D","622D","637E","640E","645D","645E","647E","6493","6496","692E","7345","7368","7371","7373","7374","7376","7377","7378","7379","7380","7383","7385","7387","7390","7391","7392","7393","7397","7399","7400","7404","7422","7515","7517","7518","7519","7521","7524","7526","7532","7587","7591","7627","7628","7629","7728","7769","7771","7781","7788","7791","7792","7805","7818","7819","7852","788D","7904","790D","7928","792D","7952","7971","7980","8004","8005","8018","8031","8059","8060","8148","8173","8174","8175","8194","8235","8259","8269","8308","8309","8440","8442","8443","8477","8534","8539","8556","8573","8588","8608","8624","8625","8649","8695","8738","8741","8755","8764","876D","8817","8821","8841","88881","8909","8910","8913","8915","8925","8932","8935","8936","8945","8963","8981","8993","9004","9023","9045","9060","9078","9106","910D","9131","9167","9169","9170","9178","9184","9235","9237","9301","9305","9308","9328","9329","9333","9334","9481","9518","9528","9546","9551","9562","9596","961D","9652","9682","9685","9687","9700","9703","9714","971D","9720","9738","9753","9759","9763","9775","9791","9793","9797","9842","9875","9914","9916","9969","9993","9997","9999"],CAL_TYPES:["Apple Calendar","Google","Outlook","Outlook.com","Yahoo"],APPT_FLOWS:{ORIGINAL:"original",NEW:"new"},MAX_IMAGE_DISPLAY:5,MAX_IMAGE_DISPLAY_IN_CAROUSEL:15,MAX_INPUT_FIELD_LENGTH:40,INTERIOR_PHOTO_ALTERNATE_TEXT:"Interior photo of the store",EXTERIOR_PHOTO_ALTERNATE_TEXT:"Exterior photo of the store",PREVIEW_STATE_IMAGE_CONTAINER_HEIGHT:120,STORE_TYPE:{RETAIL:"RETAIL",NATIONAL_RETAIL:"National Retail"},STORE_DEFINITION:{TPR:"(TPR)Third Party Retail",FPR:"(FPR)First Party Retail"},STORE_TAG:{SIGNATURE:"signature",EXPERIENCE:"experience"},CITIES:"Cities",STORES:"Stores",SAR_RC:"SAR(RC)",SAR:"SAR",TMAR_RC:"TMAR(RC)",TMAR:"TMAR",TMSS:"TMSS",TMSS_RC:"TMSS(RC)",SS:"SS",TMS_RC:"TMS(RC)",TMS:"TMS",TMAD:"TMAD",TMES:"TMES",TMES_RC:"TMES(RC)"})}(window.angular),function(angular){"use strict";function IconCarouselController($scope){function onInit(data){$scope.slickConfig={nextArrow:'<button type="button" data-role="none" class="slick-next slick-arrow" aria-label="'+data.carouselSettings.nextAriaLabel+'" role="button" style="display: block;">'+data.carouselSettings.nextAriaLabel+"</button>",prevArrow:'<button type="button" data-role="none" class="slick-prev slick-arrow" aria-label="'+data.carouselSettings.previousAriaLabel+'" role="button" style="display: block;">'+data.carouselSettings.previousAriaLabel+"</button>",infinite:!0,accessibility:!0,focusOnSelect:!1,speed:400,useTransform:!0,cssEase:"ease",slidesToShow:3,slidesToScroll:1,lazyLoad:"ondemand",responsive:[{breakpoint:992,settings:{slidesToShow:3,slidesToScroll:1}},{breakpoint:640,settings:{slidesToShow:1,slidesToScroll:1}}],method:{},event:{}}}$scope.carousel={},$scope.onInit=onInit}IconCarouselController.$inject=["$scope"],angular.module("marketingCore").controller("IconCarouselController",IconCarouselController)}(angular),function(angular){"use strict";function storeLocatorControllerConstructor($window,pdlService,universalMenuDataService,contactFormDataService,apiService,commonServices,storeLocatorModelService,toggleService){function isTMOApp(){var userAgent=$window.navigator.userAgent;vm.model.isTMOApp=userAgent&&userAgent.toLowerCase().indexOf("applicationversioncode")>=0}function setMapMargin(){var innerWidth=$window.innerWidth,headerEl=document.querySelector("#header_navbar"),footerEl=document.querySelector("#divfootermain");if(headerEl){var navHeight=headerEl?headerEl.clientHeight:0,footerHeight=footerEl?footerEl.clientHeight:0,navFooterHeight=navHeight+footerHeight;vm.mapMargin=footerEl?navFooterHeight:navHeight,vm.footerMargin=footerHeight}else vm.mapMargin=innerWidth>1023?62:50}var $stateParams=commonServices.$stateParams,$location=commonServices.$location,vm=this;vm.storeParams=$stateParams,vm.mapMargin=0,vm.footerMargin=0,vm.isOsNav=universalMenuDataService.isOsNav();var pccMapUrl=apiService.getURL("pccMap").url,baseUrl=$location.protocol()+"://"+$location.host();if(baseUrl="&css="+baseUrl+"/etc/clientlibs/t-mobile/publish/app/clientlibs_storelocator/css/infobox.css",vm.pccMapUrl=pccMapUrl+baseUrl,vm.model=storeLocatorModelService.model,vm.urlPath=new URL($window.location.href).pathname,isTMOApp(),vm.model.isTMOApp||vm.model.storeLocatorInModal||setTimeout(function(){setMapMargin()},100),vm.storeParams.state){var getState=commonServices.$filter("normalize")($stateParams.state),buildUrl="/store-locator/"+getState;if(vm.storeParams.city){var getCity=commonServices.$filter("normalize")($stateParams.city);if(buildUrl+="/"+getCity,vm.storeParams.storeName){var getStore=commonServices.$filter("normalize")($stateParams.storeName);buildUrl+="/"+getStore}if(vm.storeParams.operation){var getOperation=commonServices.$filter("normalize")($stateParams.operation);buildUrl+="/"+getOperation}}$location.path(buildUrl)}vm.urlPath&&"/store-locator"===vm.urlPath.toLowerCase()&&pdlService.setSLPageLoadEvent(),universalMenuDataService.unavData(),contactFormDataService.getContactFormData()}storeLocatorControllerConstructor.$inject=["$window","pdlService","universalMenuDataService","contactFormDataService","apiService","commonServices","storeLocatorModelService","toggleService"],angular.module("tmobileApp").controller("StoreLocatorController",storeLocatorControllerConstructor)}(window.angular),function(angular){"use strict";function MsisdnPortabilityController($scope,$http,$log,marketingHttpRequest,apiURLsV2,JWToken,globalConfig,analyticsUtils,$compile,$window){function onInit(data){var dataObject=angular.fromJson(data);vm.settings.moduleId=dataObject.moduleId,vm.settings.siteId=dataObject.siteId,JWToken.getJSONWebToken().then(function(successRes){vm.authToken=successRes,grecaptcha.reset()},function(errorRes){$log.error("Portability controller: Error while getting the token ")})}function trackToolWithDynamicContent(dynamicContent,stage,ctaName){var analyticsData={name:vm.toolName,stage:stage,dynamicContent:dynamicContent,eventType:"tool"};"complete"===stage&&(analyticsData.ctaName=ctaName),analyticsUtils.trackToolWithDynamicContent(analyticsData)}function trackFormSubmit(ctaLabelText,ctaIcid,targetUrl){var analyticsData={eventType:"clickToAction",assetType:"button",analyticsID:vm.analyticsId,submitText:ctaLabelText,targetUrl:targetUrl,icid:ctaIcid,toolName:vm.toolName,ModuleName:vm.analyticsId};analyticsUtils.trackFormSubmit(analyticsData)}function checkPortability(){vm.form1Submitted||(vm.form1Submitted=!0),10==vm.phoneNumber.length&&(vm.isApiError=!1,vm.showResults=!1,vm.dontModalAnounce=!1,grecaptcha.execute(),trackToolWithDynamicContent("","start"),trackFormSubmit(vm.checkeligibility,vm.checkEligibilityIcid,"#"))}function showResultsPage(response){vm.showFirstPage=!1,vm.isApiError=!1,vm.showResults=!0,vm.dontModalAnounce=!0;var resultEle=angular.element("#resultsPage")[0];if(response.data){setTimeout(function(){resultEle.focus()},0);var _eligibilityResponseData=response.data.success[0];vm.phoneNumber=atob(_eligibilityResponseData.mobileNumber),vm.formatedPhoneNumber=vm.phoneNumber.replace(/(\d{3})(\d{3})(\d{4})/,"($1) $2-$3"),vm.eligibilityResponse=_eligibilityResponseData.portEligibility,vm.isTmobileNumber=checkIsTmobileNumber(_eligibilityResponseData);var dynamicContent="";dynamicContent=vm.isTmobileNumber&&"no"===vm.eligibilityResponse.toLowerCase()?"Port-in Ineligible TMO Cust":"no"===vm.eligibilityResponse.toLowerCase()?"Port-in Ineligible":"Port-in Eligible",compileHtml(),trackToolWithDynamicContent(dynamicContent,"complete",vm.checkeligibility)}}function checkIsTmobileNumber(eligibilityResponse){if(vm.codes&&eligibilityResponse){if("eligible"===eligibilityResponse.isTmobileNumber.toLowerCase())return!0;var allCodes=vm.codes.split(","),reg=/\w+(,\w+)*/g;if(reg.test(eligibilityResponse))for(var allReasons=eligibilityResponse.ineligibilityReason.split(","),i=0;i<allReasons.length;i++){var reason=allReasons[i];if(allCodes.indexOf(reason)>-1)return!0}else retrun(allCodes.indexOf(eligibilityResponse.ineligibilityReason)>-1)}return!1}function compileHtml(){angular.element("#resultsPage>.note").length&&angular.element("#resultsPage>.note").empty();var angularElement=angular.element(vm.eligibilityNote),linkFunction=$compile(angularElement),element=linkFunction($scope);angular.element("#resultsPage>.note").append(element)}function showError(errorRes){vm.isApiError=!0,vm.showFirstPage=!0,vm.showResults=!1,vm.dontModalAnounce=!0;var errorEle=angular.element("#apiErroContent")[0];setTimeout(function(){errorEle.focus()},0)}function checkAnotherNumber(){vm.showResults=!1,vm.showFirstPage=!0,vm.phoneNumber="",grecaptcha.reset(),trackFormSubmit(vm.checkAnotherNumberLabel,vm.checkAnotherNumberLabelIcid,"#")}function onExecuteGrecaptcha(response){vm.grecaptchaResponse=response,$http({method:"GET",url:"/bin/services/marketing/gvalidation",params:{response:vm.grecaptchaResponse}}).then(onSuccess,onError)}function onSuccess(response){if(vm.form1Submitted=!1,vm.isMockDataUsing)vm.isSuccessRes?showResultsPage(successData):showError(errorData);else if(vm.authToken){var requestBody={};requestBody.mobileNumbers=[btoa(vm.phoneNumber)],globalConfig&&globalConfig.credentials&&globalConfig.credentials&&globalConfig.credentials.portability&&(requestBody.serviceProviderCode=globalConfig.credentials.portability.serviceProviderCode),marketingHttpRequest.authPost(apiURLsV2.portEligibility,{"Content-Type":globalConfig&&globalConfig.credentials&&globalConfig.credentials.global_v2.content_type.json,Accept:globalConfig&&globalConfig.credentials&&globalConfig.credentials.global_v2.content_type.json,Authorization:"Bearer "+vm.authToken,"x-Auth-Originator":vm.authToken},requestBody,!1).then(function(successRes){showResultsPage(successRes)},function(errorRes){showError(errorRes)})}}function onError(response){vm.form1Submitted=!1,$log.error("reCaptcha failed"),vm.reCaptchaErrorResponse=response}function onPhoneNumberFieldFocus(){vm.isApiError=!1}var successData={data:{success:[{mobileNumber:"NDA0MjAwMTMxOQ==",portEligibility:"NO",serviceProviderName:"PAC-WEST TELECOMM",serviceProviderShortName:"Pac-West",localRoutingNumber:"string",serviceProviderCode:"6529",numberGroup:"BLN",portPath:"PORT_IN",rateCenterIndicator:"string",isTmobileNumber:"NOT_ELIGIBLE",coordinates:"string",submarket:"MINNEAPOLIS_MN",returningToOriginalServiceProvider:!1,ineligibilityReason:"ALREADY_PORTEDIN",openPortRequestExist:"string",requestNumber:"string",requestStatus:"COMPLETED",withinCoverageArea:"string"}],failure:[]}},errorData={failure:[{mobileNumber:"NDA0MjAwMTMxOQ==",error:{code:"401",userMessage:"Failed to find product.",systemMessage:"PRODUCT_NOT_FOUND",detailLink:"http://aaa.bbb.ccc/"}}]},IsEmptyMsisdn=function(viewValue){return""===viewValue.replace(/[^0-9() ]/g,"").slice(0,10)},vm=this;vm.showFirstPage=!0,vm.form1Submitted=!1,vm.showResults=!1,vm.settings={},vm.phoneNumber="",vm.eligibilityResponse="",vm.isTmobileNumber=void 0,vm.reCaptchaErrorResponse="",vm.authToken="",vm.isApiError=!1,vm.isMockDataUsing=!1,vm.isSuccessRes=!1,vm.genericNote="",vm.dontModalAnounce=!0,vm.toolName="Port-in Eligibility Checker",vm.onInit=onInit,vm.checkPortability=checkPortability,vm.checkIsTmobileNumber=checkIsTmobileNumber,vm.checkAnotherNumber=checkAnotherNumber,vm.IsEmptyMsisdn=IsEmptyMsisdn,vm.onPhoneNumberFieldFocus=onPhoneNumberFieldFocus,vm.trackToolWithDynamicContent=trackToolWithDynamicContent,vm.trackFormSubmit=trackFormSubmit,vm.compileHtml=compileHtml,vm.onExecuteGrecaptcha=onExecuteGrecaptcha,$window.onExecuteGrecaptcha=onExecuteGrecaptcha}MsisdnPortabilityController.$inject=["$scope","$http","$log","marketingHttpRequest","apiURLsV2","JWToken","globalConfig","analyticsUtils","$compile","$window"],angular.module("marketingCore").controller("MsisdnPortabilityController",MsisdnPortabilityController)}(window.angular),function(angular,externalLogger){"use strict";angular.module("tmobileApp").constant("STORE_LOCATOR_STATE_NAME","store-locator").config(["$stateProvider","APP_ROOT_STATE_NAME","STORE_LOCATOR_STATE_NAME",function($stateProvider,APP_ROOT_STATE_NAME,STORE_LOCATOR_STATE_NAME){externalLogger.moduleConfigured("tmobileApp","storeLocator.js :: config router");var storeLocatorConfig={url:"/store-locator/{state}/{city}/{storeName}/{operation}?filterBy&sortBy&page&search&additionalUrl&appointment_Id&filter&Confirmation&RSVPConfirmation&Reschedule&Cancel",parent:APP_ROOT_STATE_NAME,params:{state:{value:null,squash:!0},city:{value:null,squash:!0},storeName:{value:null,squash:!0},operation:{value:null,squash:!0}},views:{main:{templateUrl:"app/storeLocator/storeLocator.tpl.html",controller:"StoreLocatorController as vm",bindings:{stores:"="}}},resolve:{toggleData:function($log,toggleService){return""===toggleService.model.toggles?toggleService.getToggleFeature().then(function(){$log.log(" resolve :: toggleService")}):void 0}}};$stateProvider.state(STORE_LOCATOR_STATE_NAME,storeLocatorConfig)}])}(angular,externalLogger),function(angular){"use strict";function SwitcherOBCallingController($scope,$log,$timeout,$cookies,geoLocation,salesforceUtils){function onInit(data,analyticsId){settings=data,vm.analyticsID=analyticsId,vm.switcher={},callMeNowJson=settings.outbound,vm.switcher.authToken=settings.authToken,vm.view=vm.views.CAPTURE_OBCALLINFO}function hideShowOBCall(array,el){for(var i=0;i<array.length;i++)if(angular.toJson(array[i]).indexOf(el)>-1)return!0;return!1}function onSuccessOBCallConfirmed(){vm.OBCallServiceError=!1,vm.view=vm.views.CONFIRM_SUCCESS_SUBMISSION,$scope.$broadcast("OBCallConfirmed",!0)}function onErrorOBCallConfirmed(response){$log.error("error outbound calling",response),vm.OBCallServiceError=!0}function OBCallSubmit(isValid){vm.submitted=!0,holidaysOpHrs=callMeNowJson.callMeNowHolidaysOpHrs,blockedStates=holidaysOpHrs.blockedStates,isValid?($scope.$broadcast("OBValid",!0),zipCode=vm.OBCallFormData.ZipCode.toString(),payload={config:"switcher",userData:{sfid:vipId,firstName:vm.OBCallFormData.FirstName,lastName:vm.OBCallFormData.LastName,Web_Submission_Time__c:(new Date).toISOString(),Phone:vm.OBCallFormData.PhoneNumber,ZIP__c:vm.OBCallFormData.ZipCode,Consent__c:"true"}},geoLocation.getUserCurrentLocationState(zipCode).then(function(data){state=data,isBlockedState=hideShowOBCall(blockedStates,state),isBlockedState?vm.view=vm.views.BLOCKED_STATE_SUBMISSION:salesforceUtils.createSalesforceLead(vm.switcher.authToken,payload).then(onSuccessOBCallConfirmed,onErrorOBCallConfirmed)},function(data){$log.error("There was a problem getting state.",data)})):$timeout(function(){$scope.$broadcast("OBValid",!1)},100)}function OBFormStart(){$scope.$broadcast("OBFormStart",!0)}var settings,zipCode,payload,holidaysOpHrs,blockedStates,state,callMeNowJson,vm=this,vipId=$cookies.get("switcherId"),isBlockedState=!1;vm.view="",vm.views={CAPTURE_OBCALLINFO:"captureOBCallInfo",CONFIRM_SUCCESS_SUBMISSION:"confirmSuccessSubmission",BLOCKED_STATE_SUBMISSION:"blockedStateSubmmision"},vm.OBCallFormData={},vm.OBFormStart=OBFormStart,vm.OBCallSubmit=OBCallSubmit,vm.onInit=onInit}SwitcherOBCallingController.$inject=["$scope","$log","$timeout","$cookies","geoLocation","salesforceUtils"],angular.module("marketingCore").controller("SwitcherOBCallingController",SwitcherOBCallingController)}(window.angular),function(angular,lodash){"use strict";function mapEventHandlerUtilConstructor(mapUtil,storeLocatorUtil,pdlService,toggleService,coreServices,storeLocatorModelService,storeLocatorConstants,commonServices,globalValue){function onMarkerMouseOver(data){model.htmlToSend=model.isMobileView?null:getInfoboxTemplate(data.index),mapUtil.selectMarkerWithHtml(data.index,!0,!1,model.htmlToSend),model.sectionToDisplay!==storeLocatorConstants.SECTIONS.STATE_RESULTS&&(mouseOverTimeout=$timeout(function(){switch(angular.isDefined(model.slickConfig)&&angular.isDefined(model.slickConfig.method)&&angular.isDefined(model.slickConfig.method.slickGoTo)?model.slickConfig.method.slickGoTo(data.index):$log.info("Slick carousel is not initialized yet"),model.sectionToDisplay){case storeLocatorConstants.SECTIONS.STORE_DETAILS:toggleService.model.toggles.digitalToRetailOnCart&&model.storeLocatorInModal?(model.hideCompleteCarousel=!0,model.showCarouselUp=!1):(model.hideCompleteCarousel=!1,model.showCarouselUp=!0);break;default:$log.log("Default behaviour to hide carousel for state ["+model.sectionToDisplay+"]")}},500),model.isClickOnDownArrow=!1)}function onMarkerMouseOut(index){model.selectedStoreIndex!==index&&(mapUtil.selectMarkerWithHtml(index,!1,!1,null),model.sectionToDisplay!==storeLocatorConstants.SECTIONS.STATE_RESULTS&&$timeout.cancel(mouseOverTimeout))}function onMarkerClick(index){mapUtil.selectMarkerWithHtml(index,!0,!0,null),angular.isDefined(model.slickConfig.method)&&angular.isDefined(model.slickConfig.method.slickGoTo)?model.slickConfig.method.slickGoTo(index):$log.info("Slick carousel is not initialized yet"),model.isClickOnDownArrow=!1;var info,storeData;if(lodash.isNil($stateParams.storeName)&&lodash.isEmpty(model.store.nearbyStores))if(lodash.isNil($stateParams.city))if(lodash.isNil($stateParams.state))storeData=commonUtils.searchJson(model.storeList,index),info=storeData.name;else{var cityData=commonUtils.searchJson(model.cityList,index);info=angular.uppercase($stateParams.state)+", "+cityData.displayName}else storeData=commonUtils.searchJson(model.storeList,index),info=storeData.name;else storeData=lodash.isEmpty(model.storeList)?model.store.nearbyStores?model.store.nearbyStores[index]:void 0:model.storeList[index],info=angular.isDefined(storeData)?storeData.name:"";toggleService.model.toggles.digitalToRetailOnCart&&storeLocatorConstants.SECTIONS.STORE_DETAILS&&model.storeLocatorInModal&&(model.hideCompleteCarousel=!0,model.showCarouselUp=!1,model.sectionToDisplay=storeLocatorConstants.SECTIONS.SEARCH_RESULTS);var ctaName="Map Location Pin Click: "+info,targetUrl="NA";pdlService.CTANavOrClickEvent(ctaName,targetUrl,!1)}function onMapDragOrZoom(){model.loadPrevStoreListView||(model.sectionToDisplay===storeLocatorConstants.SECTIONS.STATE_RESULTS?model.showSTALink=!1:model.showSTALink=!0,model.showNYLLink=!1,model.showCarouselUp=model.searchResultsCleared,model.hideCompleteCarousel=""!==model.sectionToDisplay,model.searchField="",model.storeLocatorInModal&&(model.start<model.maxStoreDisplay?model.showPrev=!1:model.showPrev=!0,model.end>=model.storeList.length?model.showNext=!1:model.showNext=!0),$timeout.cancel(carouselUpDownTimeout),model.searchResultsCleared=!1)}function onMapIdle(data){model.lat=data.lat,model["long"]=data.lng,model.loadPrevStoreListView=!1;var carouselUp=!lodash.isEmpty(data.markers)&&model.sectionToDisplay!==storeLocatorConstants.SECTIONS.SEARCH_RESULTS;carouselUpDownTimeout=$timeout(function(){model.isClickOnDownArrow||(model.showCarouselUp=carouselUp)},2e3)}function clearMarkers(fitsInView){mapUtil.clearMarkers(fitsInView)}function setDefaultMap(){mapUtil.setDefaultMap()}function getInfoboxTemplate(index){var store=lodash.isEmpty(model.store.nearbyStores)||model.storeLocatorInModal?model.storeList[index]:model.store.nearbyStores[index],template=[];if(angular.isDefined(store)){var telephone=store.telephone?store.telephone:"",storeObj=globalValue.authorValue.storeauthoring.generalAuthoringStores,storeTypeTag="",tmobileSignatureStoreInfoboxIcon=lodash.get(storeObj,"tmobileSignatureStoreInfoboxIcon","");"RETAIL"===store.type&&"(TPR)Third Party Retail"===store.storeDefinition?lodash.get(toggleService.model,"toggles.isSprintStoresEnabled",!1)?store.hasSprintStack&&!store.hasTmobileStack?(store.isSprintOnlyStore=!0,storeTypeTag=store.deviceRepair?lodash.get(storeObj,"sprintAuthorizedRetailRepairStoreTag",""):lodash.get(storeObj,"sprintAuthorizedRetailStoreTag","")):storeTypeTag=store.hasSprintStack&&store.hasTmobileStack?store.deviceRepair?lodash.get(storeObj,"tmobileSprintAuthorizedRetailRepairStoreTag",""):lodash.get(storeObj,"tmobileSprintAuthorizedRetailStoreTag",""):store.deviceRepair?lodash.get(storeObj,"tprRepairStoreTag",""):lodash.get(storeObj,"tprStoreTag",""):storeTypeTag=lodash.get(storeObj,"tprStoreTag",""):"RETAIL"===store.type&&"(FPR)First Party Retail"===store.storeDefinition?store.storeTag&&store.storeTag.includes("signature")&&!store.storeTag.includes("experience")?storeTypeTag=lodash.get(storeObj,"tmobileSignatureStoreTag",""):lodash.get(toggleService.model,"toggles.experienceStoreTagEnabled",!1)&&store.storeTag&&store.storeTag.includes("experience")?storeTypeTag=lodash.get(storeObj,"tmobileExperienceStore",""):lodash.get(toggleService.model,"toggles.isSprintStoresEnabled",!1)?store.hasSprintStack&&!store.hasTmobileStack?(store.isSprintOnlyStore=!0,storeTypeTag=store.deviceRepair?lodash.get(storeObj,"sprintRetailRepairStoreTag",""):lodash.get(storeObj,"sprintRetailStoreTag","")):storeTypeTag=store.hasSprintStack&&store.hasTmobileStack?store.deviceRepair?lodash.get(storeObj,"tmobileSprintRetailRepairStoreTag",""):lodash.get(storeObj,"tmobileSprintRetailStoreTag",""):store.deviceRepair?lodash.get(storeObj,"tmobileRepairStoreTag",""):lodash.get(storeObj,"tmobileStoreTag",""):storeTypeTag=lodash.get(storeObj,"tmobileStoreTag",""):"RETAIL"!==store.type&&(storeTypeTag=lodash.get(storeObj,"authDealerTag",""));var appointmentsMessage="";!(store.inStoreAppointment&&toggleService.model.toggles.inStoreAppointment&&model.isIfTFBStoreAppointmentAvail)||toggleService.model.toggles.storeOpenByAppointmentOnly&&store.isStoreClosedForEntireWeek||store.isSprintOnlyStore?store.inStoreAppointment&&toggleService.model.toggles.inStoreAppointment&&toggleService.model.toggles.storeOpenByAppointmentOnly&&store.isStoreClosedForEntireWeek&&!store.isSprintOnlyStore&&(appointmentsMessage=globalValue.authorValue.storeauthoring.generalAuthoringStores.byAppointmentOnlyShortMessage||"By appointment only"):appointmentsMessage=globalValue.authorValue.storeauthoring.appointmentsAndWaitTime.appointmentsMessage,model.selectedStoreIndex!==index&&(template="RETAIL"===store.type&&"(FPR)First Party Retail"===store.storeDefinition?["<div class='sl-tmobile-info-window'>","<div class='sl-info-window-content'>","<p class='sl-storename'>"+store.name+"</p>","<p>"+store.location.address.streetAddress+", "+store.location.address.addressLocality+"</p>","<p>"+telephone+"</p>","CONDITIONAL_STORE_HOURS","<p class='sl-message'>"+appointmentsMessage+"</p>","<div class='sl-distance'>","CONDITIONAL_STORE_DISTANCE","<div class='sl-info-window-footer'>","<span>","CONDITION_SIGNATURE_STORE_ICON","<p>"+storeTypeTag+"</p>","</span>","CONDITION_SERVE_TEXT","</div>","</div>","</div>","</div>"]:["<div class='sl-tmobile-info-window'>","<div class='sl-info-window-content non-tmobile-content'>","<p class='sl-storename'>"+store.name+"</p>","<p>"+store.location.address.streetAddress+", "+store.location.address.addressLocality+"</p>","<p>"+telephone+"</p>","CONDITIONAL_STORE_HOURS","<p class='sl-message'>"+appointmentsMessage+"</p>","<div class='sl-distance'>","CONDITIONAL_STORE_DISTANCE","</div>","<div class='sl-info-window-footer'>","<p>"+storeTypeTag+"</p>","CONDITION_SERVE_TEXT","</div>","</div>","</div>"]);var indexOfConditionalStoreHoursItem=template.indexOf("CONDITIONAL_STORE_HOURS");store&&store.todayHours&&(!toggleService.model.toggles.storeOpenByAppointmentOnly||toggleService.model.toggles.storeOpenByAppointmentOnly&&!store.isStoreClosedForEntireWeek||toggleService.model.toggles.storeOpenByAppointmentOnly&&!store.inStoreAppointment)?"Closed"===store.todayHours?template[indexOfConditionalStoreHoursItem]="<p class='today-hours'><span class='today-hours'>Today's Hours</span> &#8226; "+store.todayHours+" </p>":(template[indexOfConditionalStoreHoursItem]="<p class='today-hours'><span class='today-hours'>Today's Hours</span> &#8226; "+store.todayHours,template[indexOfConditionalStoreHoursItem]+=store.isOpenNow?"<p class='today-hours-open'> Open now </p> </p>":"</p>"):template.splice(indexOfConditionalStoreHoursItem,1);var indexOfConditionalStoreDistanceItem=template.indexOf("CONDITIONAL_STORE_DISTANCE");store&&store.storeDistance?template[indexOfConditionalStoreDistanceItem]="<p>"+store.storeDistance+" miles</p>":template.splice(indexOfConditionalStoreDistanceItem,1);var indexOfSignatureStoreIconItem=template.indexOf("CONDITION_SIGNATURE_STORE_ICON");indexOfSignatureStoreIconItem>1&&(store&&tmobileSignatureStoreInfoboxIcon&&store.storeTag&&store.storeTag.includes("signature")&&!store.storeTag.includes("experience")?template[indexOfSignatureStoreIconItem]="<img class='p-r-5' src="+tmobileSignatureStoreInfoboxIcon+" alt='T-Mobile Signature Store'/>":lodash.get(toggleService.model,"toggles.experienceStoreTagEnabled",!1)&&store&&tmobileSignatureStoreInfoboxIcon&&store.storeTag&&store.storeTag.includes("experience")?template[indexOfSignatureStoreIconItem]="<img class='p-r-5' src="+tmobileSignatureStoreInfoboxIcon+" alt='T-Mobile Experience Store'/>":template.splice(indexOfSignatureStoreIconItem,1));var indexOfServeTextItem=template.indexOf("CONDITION_SERVE_TEXT");if(indexOfServeTextItem>1&&lodash.get(toggleService.model,"toggles.storeServeTextEnabled",!1)){var storeServeText=storeLocatorModelService.getStoreServeText(store);template[indexOfServeTextItem]="<p class='sl-text'>"+storeServeText+"</p>"}else template.splice(indexOfServeTextItem,1)}return template.join("\n")}var mouseOverTimeout,carouselUpDownTimeout,commonUtils=coreServices.commonUtils,$timeout=commonServices.$timeout,model=storeLocatorModelService.model,$log=commonServices.$log,$stateParams=commonServices.$stateParams;return{onMarkerMouseOver:onMarkerMouseOver,onMarkerMouseOut:onMarkerMouseOut,onMarkerClick:onMarkerClick,onMapDragOrZoom:onMapDragOrZoom,onMapIdle:onMapIdle,clearMarkers:clearMarkers,setDefaultMap:setDefaultMap,getInfoboxTemplate:getInfoboxTemplate}}mapEventHandlerUtilConstructor.$inject=["mapUtil","storeLocatorUtil","pdlService","toggleService","coreServices","storeLocatorModelService","storeLocatorConstants","commonServices","globalValue"],angular.module("tmobileApp").factory("mapEventHandlerUtil",mapEventHandlerUtilConstructor)}(window.angular,window._),function(angular){"use strict";function accessibleForm(){return{restrict:"A",link:function(scope,element){element.on("submit",function(){var firstInvalid=element[0].querySelector(".ng-invalid");firstInvalid&&firstInvalid.focus()})}}}angular.module("marketingCore").directive("accessibleForm",accessibleForm)}(angular),function(angular){"use strict";function mapEventSubscriberUtilConstructor(storeLocatorModelService,storeLocatorInitUtil,storeLocatorConstants,mapEventHandlerUtil,storeLocatorUtil,commonServices){function subscribeToMapEvents(){if(!model.alreadyListening){var eventMethod=$window.addEventListener?storeLocatorConstants.OTHERS.AEL:storeLocatorConstants.OTHERS.AE,eventer=$window[eventMethod],messageEvent=eventMethod===storeLocatorConstants.OTHERS.AE?storeLocatorConstants.OTHERS.OM:storeLocatorConstants.OTHERS.M;eventer(messageEvent,receiveMessage),model.alreadyListening=!0}}function receiveMessage(event){if(event.origin.contains(storeLocatorConstants.OTHERS.TMO)){var json=angular.fromJson(event.data);switch(json.event){
case storeLocatorConstants.MAP_EVENTS.LOAD:"storeDetailView"!==model.sectionToDisplay&&storeLocatorInitUtil.loadStoreMarkers();break;case storeLocatorConstants.MAP_EVENTS.OVER:model.markerSelected=!0,model.markerIndex=json.data.index,mapEventHandlerUtil.onMarkerMouseOver(json.data);break;case storeLocatorConstants.MAP_EVENTS.OUT:mapEventHandlerUtil.onMarkerMouseOut(json.data.index),$timeout(function(){model.markerSelected=!1,model.markerIndex=null},0);break;case storeLocatorConstants.MAP_EVENTS.CLICK:storeLocatorUtil.getCurrentPage()===storeLocatorConstants.PAGES.STATE?storeLocatorModelService.citySelected(model.cityList[json.data.index]):mapEventHandlerUtil.onMarkerClick(json.data.index);break;case storeLocatorConstants.MAP_EVENTS.DRAG:mapEventHandlerUtil.onMapDragOrZoom();break;case storeLocatorConstants.MAP_EVENTS.ZOOM:model.zoomEventTriggeredManually&&mapEventHandlerUtil.onMapDragOrZoom();break;case storeLocatorConstants.MAP_EVENTS.IDLE:mapEventHandlerUtil.onMapIdle(json.data)}}}var model=storeLocatorModelService.model,$window=commonServices.$window,$timeout=commonServices.$timeout;return{receiveMessage:receiveMessage,subscribeToMapEvents:subscribeToMapEvents}}mapEventSubscriberUtilConstructor.$inject=["storeLocatorModelService","storeLocatorInitUtil","storeLocatorConstants","mapEventHandlerUtil","storeLocatorUtil","commonServices"],angular.module("tmobileApp").factory("mapEventSubscriberUtil",mapEventSubscriberUtilConstructor)}(window.angular),function(angular){angular.module("tmobileApp").constant("creditClassData",{creditClass1:{"class":"creditClass1"},creditClass2:{"class":"creditClass2"},creditClass3:{"class":"creditClass3"}})}(angular),function(angular,lodash,google){"use strict";function mapUtilConstructor(toggleService,universalMenuDataService){function postMessage(message){var json=angular.toJson(message),pccIFrame=angular.element("#pccIFrame")[0];pccIFrame.contentWindow.postMessage(json,"*")}function createLatLngArray(stores,startOfPinMarkers,endOfPinMarkers,fromStorePage,selectedIndex,SDPView){var storesLatLngs=[],isMobileView=universalMenuDataService.isMobileView();return angular.forEach(stores,function(store,index){var markerColor="RETAIL"===store.type?"red":"black";"RETAIL"===store.type&&(store.storeTag&&(store.storeTag.includes("signature")||toggleService.model.toggles.experienceStoreTagEnabled&&store.storeTag.includes("experience"))?markerColor="signature":!toggleService.model.toggles.isSprintStoresEnabled||store.storeTag&&store.storeTag.includes("experience")||(store.hasSprintStack&&store.hasTmobileStack?markerColor="dual":store.hasSprintStack&&!store.hasTmobileStack&&(markerColor="yellow")));var markerType=fromStorePage&&0!==index||selectedIndex!==index&&SDPView?isMobileView?"DotBig":"Dot":"Pin";storesLatLngs.push({type:markerColor+markerType,label:"",lat:store.location.latitude,lng:store.location.longitude})}),storesLatLngs}function selectMarkerWithHtml(index,selected,centerInView,html){var message={event:"selectMarker",data:{index:index,selected:selected,centerInView:centerInView,html:html}};postMessage(message)}function setMarkers(fitsInView,storeList,start,end,fromStorePage,selectedIndex,SDPView){var arrayLngAndLat;arrayLngAndLat=lodash.isEmpty(storeList)?[]:createLatLngArray(storeList,start,end,fromStorePage,selectedIndex,SDPView);var message={event:"setMarkers",data:{fitInView:lodash.isEmpty(storeList)?!1:fitsInView,markers:arrayLngAndLat}};postMessage(message);var bounds=new google.maps.LatLngBounds,boundsarr=arrayLngAndLat.slice(start-1,start+4);lodash.forIn(boundsarr,function(value,key){var latLng=new google.maps.LatLng(value.lat,value.lng);bounds.extend(latLng)}),setViewport(bounds)}function getLatLongForCities(cityList){var cityLatLngs=[];return angular.forEach(cityList,function(cityItem,index){cityLatLngs.push({type:"bubble",label:cityItem.storeCount.toString(),lat:cityItem.centerPoint.latitude,lng:cityItem.centerPoint.longitude})}),cityLatLngs}function setBubbles(fitsInView,cityList){var cityLatLngs=getLatLongForCities(cityList),message={event:"setMarkers",data:{fitInView:fitsInView,markers:cityLatLngs}};postMessage(message)}function clearMarkers(fitsInView){var message={event:"setMarkers",data:{fitInView:fitsInView,markers:[]}};postMessage(message)}function setDefaultMap(){var defaultMapParm={event:"setViewport",data:{south:25.82,west:-124.39,north:49.38,east:-66.94}};postMessage(defaultMapParm)}function sendOffsets(left,top,right,bottom){var message={event:"setOffset",data:{left:left,top:top,right:right,bottom:bottom}};postMessage(message)}function setViewport(boundsData){var message={event:"setViewport",data:boundsData};postMessage(message)}function setViewportForCoordinates(coordinates,latKeyExpr,lngKeyExpr){var bounds=new google.maps.LatLngBounds;lodash.forEach(coordinates,function(item){var lat=lodash.get(coordinates,latKeyExpr,coordinates.latitude),lng=lodash.get(coordinates,lngKeyExpr,coordinates.longitude),latLng=new google.maps.LatLng(lat,lng);bounds.extend(latLng)}),setViewport(bounds)}return{selectMarkerWithHtml:selectMarkerWithHtml,setMarkers:setMarkers,sendOffsets:sendOffsets,setBubbles:setBubbles,clearMarkers:clearMarkers,setDefaultMap:setDefaultMap,setViewport:setViewport,setViewportForCoordinates:setViewportForCoordinates}}mapUtilConstructor.$inject=["toggleService","universalMenuDataService"],angular.module("tmobileApp").factory("mapUtil",mapUtilConstructor)}(window.angular,window._,window.google),function(angular,lodash){"use strict";function fraudCheckModelService(checkOutConstants,checkOutModelService,authTokenManager,apiService,apiURLs,cartHttpDataService,commonServices){function getReviewOuestions(){return vm.model.fraudCheck.conversationResponse.questionSet}function createPayloadForInitiateConversation(){var firstName,lastName,streetAddress1,city,state,zip5,ssn,dob,payload={};return firstName=lodash.get(checkOutModelService.model.checkOutInfo.personalInfo,"firstName"),lastName=lodash.get(checkOutModelService.model.checkOutInfo.personalInfo,"lastName"),streetAddress1=lodash.get(checkOutModelService.model.checkOutInfo.billInfo,"address1"),city=lodash.get(checkOutModelService.model.checkOutInfo.billInfo,"city"),state=lodash.get(checkOutModelService.model.checkOutInfo.billInfo,"state"),zip5=lodash.get(checkOutModelService.model.checkOutInfo.billInfo,"zip"),ssn=lodash.get(checkOutModelService.model.checkOutInfo.creditcheckTpp,"ssn"),dob=lodash.get(checkOutModelService.model.checkOutInfo.creditcheckTpp,"dob"),firstName&&lastName&&streetAddress1&&city&&state&&zip5&&(payload.name={firstName:firstName,lastName:lastName},payload.addresses=[{streetAddress1:streetAddress1,city:city,state:state,zip5:zip5,context:checkOutConstants.PRIMARY}],payload.context=checkOutConstants.PRIMARY,ssn&&(payload.SSN={number:ssn.slice(-4),type:checkOutConstants.SSN_TYPE}),dob&&(payload.dateOfBirth={year:dob.slice(4),month:dob.slice(0,2),day:dob.slice(2,4)})),payload}function createPayloadForContinueConversation(choiceId){var payLoad={},response=vm.model.fraudCheck.conversationResponse;return lodash.get(response,"questionSet")&&lodash.get(response,"status")&&(payLoad={conversationId:response.status.conversationId,answers:{questionSetId:response.questionSet.questionSetId,questions:[{questionId:response.questionSet.questions[0].questionId,choices:[{choice:choiceId}]}]}}),payLoad}function getPoPTokenParameters(apiKey){var parameter={};return parameter.authToken=authTokenManager.getTokenCookies("jwt_token",angular.equals(apiURLs.storage,"localStorage")),parameter.request={url:apiService.getURL(apiKey).url,method:"POST"},parameter}function redirectToReviewPage(continueConversationResponse){var getQuotePromise=cartHttpDataService.getQuotes(checkOutModelService.model.checkOutInfo);return commonServices.$q.all([getQuotePromise]).then(function(arrayOfResults){var promiseSuccess=validateResponseStatus(arrayOfResults);promiseSuccess&&checkOutModelService.setSectionToBeDisplayed(checkOutConstants.SECTIONS.REVIEW)})["catch"](function(redirectToReviewPageError){commonServices.$log.error("something went wrong while redirecting to review page",redirectToReviewPageError)})}function validateResponseStatus(responseArray){var failureResponse=lodash.find(responseArray,function(res){return null===res.data||-1===checkOutConstants.SUCCESS_STATUS_CODES.indexOf(res.status)});return angular.isUndefined(failureResponse)}var vm=this;return vm.model={fraudCheck:{conversationResponse:""}},vm.token="",vm.getReviewOuestions=getReviewOuestions,vm.createPayloadForInitiateConversation=createPayloadForInitiateConversation,vm.createPayloadForContinueConversation=createPayloadForContinueConversation,vm.getPoPTokenParameters=getPoPTokenParameters,vm.redirectToReviewPage=redirectToReviewPage,vm}fraudCheckModelService.$inject=["checkOutConstants","checkOutModelService","authTokenManager","apiService","apiURLs","cartHttpDataService","commonServices"],angular.module("tmobileApp").factory("fraudCheckModelService",fraudCheckModelService)}(angular,window._),function(angular){"use strict";function genericModalUtilConstructor($modal){function openModal(){var modalInstance=$modal.open(modalSettings);return modalInstance.result}var modalSettings={size:"sm",windowClass:"generic-modal",templateUrl:"app/storeLocator/genericModal/genericModal.tpl.html",controller:"genericModalController",controllerAs:"vm",backdrop:"static",keyboard:!1};return{openModal:openModal}}genericModalUtilConstructor.$inject=["$modal"],angular.module("tmobileApp").factory("genericModalUtil",genericModalUtilConstructor)}(angular),function(angular){"use strict";function rangeFilter(){var filter=function(arr,lower,upper){var i=lower;for(i=lower;upper>=i;i+=1)arr.push(i);return arr};return filter}angular.module("tmobileCheckOut").filter("range",rangeFilter)}(angular),function(angular,lodash){"use strict";function navigationUtilConstructor($window,$state,storeLocatorModelService,toggleService,storeLocatorUtil,storeLocatorConstants,STORE_LOCATOR_STATE_NAME){function navigateToStore(){var mapUrl,query=$window.encodeURIComponent(vm.model.storeAddress),userAgent=$window.navigator.userAgent;vm.model.isMobileView&&(mapUrl=userAgent.match(/iPhone|iPad|iPod/i)?"maps://maps.google.com?q="+query:"http://maps.google.com?q="+query,$window.open(mapUrl,"_blank")),storeLocatorModelService.showOperationSection()}function navigateToStoreWithAddress(storeAddress){var mapUrl,query=$window.encodeURIComponent(storeAddress),userAgent=$window.navigator.userAgent;vm.model.isMobileView&&(mapUrl=userAgent.match(/iPhone|iPad|iPod/i)?"maps://maps.google.com?q="+query:"http://maps.google.com?q="+query,$window.open(mapUrl,"_blank"))}function backToStoreLocatorMap(){vm.model.sectionToDisplay="",vm.model.hideCompleteCarousel=!1,storeLocatorModelService.changeState()}var vm=this;return vm.model=storeLocatorModelService.model,{navigateToStore:navigateToStore,backToStoreLocatorMap:backToStoreLocatorMap,navigateToStoreWithAddress:navigateToStoreWithAddress}}navigationUtilConstructor.$inject=["$window","$state","storeLocatorModelService","toggleService","storeLocatorUtil","storeLocatorConstants","STORE_LOCATOR_STATE_NAME"],angular.module("tmobileApp").factory("navigationUtil",navigationUtilConstructor)}(window.angular,window._),function(angular){"use strict";function cartToolTipFn($document){return{restrict:"A",link:function($scope,element,attrs){function documentClick(e){this.querySelectorAll(".popover.in")&&e.target!==popOver&&!e.target.parentNode.classList.contains("popover")&&angular.element(popOver).popover("hide")}function cleanup(){$document[0].removeEventListener("click",documentClick)}var popOver=element[0],contentText=attrs.tooltipContent;angular.element(popOver).popover({placement:"bottom",html:!0,content:contentText,trigger:"manual"}),$document[0].addEventListener("click",documentClick),$scope.tooltipClick=function(e){angular.element(popOver).popover("toggle")},$scope.$on("$destroy",cleanup)}}}cartToolTipFn.$inject=["$document"];var moduleName="tmobileApp",directiveName="cartToolTip";angular.module(moduleName).directive(directiveName,cartToolTipFn)}(window.angular),function(angular,lodash,google){"use strict";function searchBoxUtilConstructor(commonServices){function placeFromAddress(place){var cityObject,stateObject,relevantPlaceInfo={};return"locality"===place.types[0]||"administrative_area_level_1"===place.types[0]?(cityObject=lodash.find(place.address_components,{types:["locality"]}),relevantPlaceInfo.city=cityObject&&cityObject.short_name,stateObject=lodash.find(place.address_components,{types:["administrative_area_level_1"]}),relevantPlaceInfo.state=stateObject&&stateObject.short_name):"Puerto Rico"===place.address_components[0].long_name&&(relevantPlaceInfo.state="pr"),relevantPlaceInfo.latLng=[place.geometry.location.lat(),place.geometry.location.lng()],relevantPlaceInfo}function placeFromLatLng(location){var deferred=$q.defer(),response=[],geocoder=new $window.google.maps.Geocoder;return geocoder.geocode({address:location},function(results,status){status===$window.google.maps.GeocoderStatus.OK?(response=placeFromAddress(results[0]),deferred.resolve(response)):deferred.reject({results:results,status:status})}),deferred.promise}var $window=commonServices.$window,$q=commonServices.$q;return{placeFromAddress:placeFromAddress,placeFromLatLng:placeFromLatLng}}searchBoxUtilConstructor.$inject=["commonServices"],angular.module("tmobileApp").factory("searchBoxUtil",searchBoxUtilConstructor)}(window.angular,window._,window.google),function(angular,lodash){"use strict";function creditCheckTppController(globalValue,commonUtils,checkOutModelService,checkOutValidationUtil,paymentAndCreditCheckUtil,cartHttpDataService,checkOutConstants,modalDialogFactory){var vm=this;vm.idNumberRegex=/^[a-zA-Z0-9]*$/,vm.checkoutAuthorValue=lodash.get(globalValue.authorValue,"checkout.creditCheckTpp"),vm.creditCheckAuthorValue=vm.verifyIdentity?{header:commonUtils.searchJson(vm.checkoutAuthorValue,"verifyIdentityHeader"),subHeader:commonUtils.searchJson(vm.checkoutAuthorValue,"verifyIdentitySubHeader"),ssnHeader:commonUtils.searchJson(vm.checkoutAuthorValue,"verifyIdentitySSNHeader"),ssnMismatchError:commonUtils.searchJson(vm.checkoutAuthorValue,"verifyIdSSNMismatchErrMsg"),nextBtn:commonUtils.searchJson(vm.checkoutAuthorValue,"verifyIdentityNextBtn")}:{header:commonUtils.searchJson(vm.checkoutAuthorValue,"creditCheckHeader"),subHeader:commonUtils.searchJson(vm.checkoutAuthorValue,"creditCheckSubHeader"),ssnHeader:commonUtils.searchJson(vm.checkoutAuthorValue,"creditCheckSSNHeader"),ssnSubHeader:commonUtils.searchJson(vm.checkoutAuthorValue,"creditCheckSSNSubHeader"),nextBtn:commonUtils.searchJson(vm.checkoutAuthorValue,"creditCheckNextBtn")},vm.checkoutInfo=checkOutModelService.model.checkOutInfo,vm.icons=lodash.get(globalValue.authorValue,"checkout.icons"),vm.resedentialAuthorValue=lodash.get(globalValue.authorValue,"checkout"),vm.authorValue=lodash.get(globalValue.authorValue,"checkout.paymentAndCreditCheck"),vm.checkoutInitData=checkOutModelService.model.checkoutInitData,vm.validateSsnOnChange=checkOutValidationUtil.validateSsnOnChange,vm.validateExpOnChange=checkOutValidationUtil.validateExpireDateOnChange,vm.stateChanged=paymentAndCreditCheckUtil.stateChanged,vm.openSsnLearnMoreModal=modalDialogFactory.openSsnLearnMoreModal,vm.checkoutAuthorValue.userConsent&&vm.checkoutAuthorValue.userConsent.length&&(vm.userConsentIndex=vm.checkoutAuthorValue.userConsent.length-1,angular.isObject(vm.checkoutAuthorValue.userConsent[vm.userConsentIndex])||(vm.checkoutAuthorValue.userConsent[vm.userConsentIndex]=angular.fromJson(vm.checkoutAuthorValue.userConsent[vm.userConsentIndex])))}creditCheckTppController.$inject=["globalValue","commonUtils","checkOutModelService","checkOutValidationUtil","paymentAndCreditCheckUtil","cartHttpDataService","checkOutConstants","modalDialogFactory"],angular.module("tmobileApp").controller("CreditCheckTppController",creditCheckTppController)}(window.angular,window._),function(angular,lodash,moment){"use strict";function storeAppointmentUtilConstructor(commonServices,httpRequestWrapper,apiService,storeLocatorModelService,globalValue,storeLocatorConstants){function generateURLs(){var endDate,startDate,outlookStartDate,outlookEndDate,viewModel=storeLocatorModelService.model,appointmentDate=viewModel.selectedDateAndDay.date+" "+viewModel.selectedTimeSlot;outlookStartDate=new Date(appointmentDate).toISOString(),outlookEndDate=moment(appointmentDate).add(30,"m").toDate().toISOString(),startDate=moment.utc(appointmentDate,"MM/DD/YYYY HH:mm a").format().replace(/-|:|Z/g,""),endDate=moment.utc(appointmentDate,"MM/DD/YYYY HH:mm a").add(30,"m").format().replace(/-|:|Z/g,"");var title=globalValue.authorValue.storeauthoring.appointmentsAndWaitTime.appointmentSubject,location=viewModel.storeAddress,description=globalValue.authorValue.storeauthoring.appointmentsAndWaitTime.appointmentBody;googleUrl="https://www.google.com/calendar/render?action=TEMPLATE&text="+title+"&dates="+startDate+"/"+endDate+"&details="+description+"&location="+location,yahooUrl="http://calendar.yahoo.com/?v=60&view=d&type=20&title="+title+"&st="+startDate+"&dur=0030&desc="+description+"&in_loc="+location,outlookUrl="https://outlook.live.com/owa/?path=/calendar/action/compose&rru=addevent&startdt="+outlookStartDate+"&enddt="+outlookEndDate+"&subject="+title+"&location="+location+"&body="+description+"&uid=1521611146tmobilecom",servletUrl=apiService.getURL("storeLocator.addToCalendar").url.replace("{{startDate}}",startDate).replace("{{endDate}}",endDate).replace("{{location}}",location).replace("{{description}}",description).replace("{{title}}",title)}function selectedCalendarChanged(selectedCalendar){switch(selectedCalendar){case"Google":$window.open(googleUrl,"_blank");break;case"Outlook.com":$window.open(outlookUrl,"_blank");break;case"Yahoo":$window.open(yahooUrl,"_blank");break;default:$window.location.href=servletUrl}}function getAppointmentEligibleStores(){var urlObject,url;return urlObject=apiService.getURL("storeLocator.storesWithAppointment"),url=urlObject.url,httpRequestWrapper.get(url,"",null,!0).then(function(response){var deferred=$q.defer(),eligibleStores=response.data.stores;return 200===response.status?deferred.resolve(eligibleStores):deferred.reject(),deferred.promise})}var googleUrl,yahooUrl,outlookUrl,servletUrl,$q=(commonServices.$http,commonServices.$q),$window=commonServices.$window;return{getAppointmentEligibleStores:getAppointmentEligibleStores,generateURLs:generateURLs,selectedCalendarChanged:selectedCalendarChanged}}storeAppointmentUtilConstructor.$inject=["commonServices","httpRequestWrapper","apiService","storeLocatorModelService","globalValue","storeLocatorConstants"],angular.module("tmobileApp").factory("storeAppointmentUtil",storeAppointmentUtilConstructor)}(window.angular,window._,window.moment),function(angular,lodash){"use strict";function responseTransformationServiceV2Fn(jsonPath,$log,aemRoutingService,toggleService,globalAssetRepositoryConstants,checkOutConstants,globalValue,creditClassConstant){function getJsonPath(jsonData,jPath){var value,_val=jsonPath(jsonData,"$.."+jPath);return angular.isDefined(_val)&&_val.length>0&&(value=_val[0]),value}function getGARImagePathForOfferModal(longDes){var longDescription=longDes;return toggleService.model.toggles.enableGar&&_.includes(longDes,"/content/dam")&&(longDescription=longDes.replace("/content/dam",globalAssetRepositoryConstants.url+"/content/dam")),longDescription}function getGARImagePath(imgPath){var imagePath=imgPath;return toggleService.model.toggles.enableGar&&_.includes(imgPath,"/content/dam")&&(imagePath=globalAssetRepositoryConstants.url+imgPath),imagePath}function _getFormattedDate(dateValue){if(angular.isDefined(dateValue)){var myDate=new Date(dateValue);if(myDate=moment(myDate),myDate.isValid())return myDate.format("M/D")}return""}function getAEMData(){service.aemValues||aemRoutingService.loadRoutingStates().then(function(resp){service.aemValues=resp,angular.forEach(resp,function(val,key){val.data&&val.data.defaultsku&&service.aemDefaultSku.push(val)})})}function mostPopularDevicesTransformation(oldResponse){$log.log("oldResponse",service.aemDefaultSku,oldResponse);var newResponse=[],override=lodash.get(globalValue,"authorValue.rootPage.overrideInvStatus.invStatusDetails",[]);if(override=lodash.isArray(override)?override:[override],oldResponse){if(oldResponse.values)return oldResponse.values.products.forEach(function(product){var prefIndex=0,chkBoolForPrefIndAuthor=!1,chkBoolForPrefIndSku=!1,chkBoolForPrefIndColor=!1,newProduct={};newProduct.offerId=product.offerId,newProduct.Family=product.familyName,newProduct.ProductName=product.productName,newProduct.productSubtype=product.productSubtype;var priceTypes=["listPriceSku","payNowGoodCredit_s","monthlyPriceGCS","payNowBuildCredit_s","monthlyPriceBCS"];if(priceTypes.forEach(function(priceType,priceIndex){("0"===product[priceType]||""===product[priceType]||"|"===product[priceType]||"||"===product[priceType]||"|||"===product[priceType])&&(product[priceType]="0.00|0.00|0.00|0.00")}),product.listPriceSku=product.listPriceSku?product.listPriceSku.split("|"):void 0,product.payNowGoodCredit_s=product.payNowGoodCredit_s?product.payNowGoodCredit_s.split("|"):void 0,product.monthlyPriceGCS=product.monthlyPriceGCS?product.monthlyPriceGCS.split("|"):void 0,product.payNowBuildCredit_s=product.payNowBuildCredit_s?product.payNowBuildCredit_s.split("|"):void 0,product.monthlyPriceBCS=product.monthlyPriceBCS?product.monthlyPriceBCS.split("|"):void 0,product.skuCode=product.skuCode?product.skuCode.split("|"):void 0,product.salePriceSku=product.salePriceSku?product.salePriceSku.split("|"):void 0,product.internalMemorySizes=product.internalMemorySizes?product.internalMemorySizes.replace(/SIZE_|GB/g,"").split("|"):void 0,product.deviceColorSKU=product.deviceColorSKU?product.deviceColorSKU.split("|"):void 0,product.deviceMemorySKU=product.deviceMemorySKU?product.deviceMemorySKU.split("|"):void 0,product.bogoSku=product.bogoSku?product.bogoSku.split("|"):void 0,product.onSaleSku=product.onSaleSku?product.onSaleSku.split("|"):void 0,product.specialOfferSku=product.specialOfferSku?product.specialOfferSku.split("|"):void 0,product.webOnlySku=product.webOnlySku?product.webOnlySku.split("|"):void 0,product.thumbNail=product.thumbNail?product.thumbNail.split("|"):void 0,product.priceTypeAvailableEIP=product.priceTypeAvailableEIP?product.priceTypeAvailableEIP.split("|"):void 0,product.priceTypeAvailableFRP=product.priceTypeAvailableFRP?product.priceTypeAvailableFRP.split("|"):void 0,product.memorySKU=[],"Wearable"!==product.productSubtype)for(var m=0;product.deviceMemorySKU&&m<product.deviceMemorySKU.length;m++)product.memorySKU.push(product.deviceMemorySKU[m].split("_")[1]);for(var productsWithPricesAndMemory=[],i=0;product.salePriceSku&&i<product.salePriceSku.length;i++){var productToPush={};productToPush.listPriceSku=product.listPriceSku[i],productToPush.payNowGoodCredit_s=product.payNowGoodCredit_s[i],productToPush.monthlyPriceGCS=product.monthlyPriceGCS[i],productToPush.payNowBuildCredit_s=product.payNowBuildCredit_s[i],productToPush.monthlyPriceBCS=product.monthlyPriceBCS[i],productToPush.skuCode=product.skuCode[i],productToPush.salePriceSku=product.salePriceSku[i],productToPush.deviceColorSKU=product.deviceColorSKU?product.deviceColorSKU[i]:void 0,productToPush.deviceMemorySKU=product.deviceMemorySKU?product.deviceMemorySKU[i]:void 0,productToPush.bogoSku=product.bogoSku?product.bogoSku[i]:void 0,productToPush.onSaleSku=product.onSaleSku?product.onSaleSku[i]:void 0,productToPush.specialOfferSku=product.specialOfferSku?product.specialOfferSku[i]:void 0,productToPush.webOnlySku=product.webOnlySku?product.webOnlySku[i]:void 0,productToPush.thumbNail=product.thumbNail?product.thumbNail[i]:void 0,productToPush.priceTypeAvailableEIP=product.priceTypeAvailableEIP?product.priceTypeAvailableEIP[i]:void 0,productToPush.priceTypeAvailableFRP=product.priceTypeAvailableFRP?product.priceTypeAvailableFRP[i]:void 0,productsWithPricesAndMemory.push(productToPush),productToPush.memorySKU=_.isEmpty(product.memorySKU)?void 0:product.memorySKU[i]}if(service.aemDefaultSku.forEach(function(aemSku,index){productsWithPricesAndMemory.forEach(function(productDetails,prodIndex){productDetails.skuCode===aemSku.data.defaultsku&&(prefIndex=prodIndex,chkBoolForPrefIndAuthor=!0)})}),0===prefIndex&&(productsWithPricesAndMemory.sort(function(a,b){return parseFloat(a.memorySKU)-parseFloat(b.memorySKU)}),productsWithPricesAndMemory.sort(function(a,b){return parseFloat(a.salePriceSku)-parseFloat(b.salePriceSku)})),chkBoolForPrefIndAuthor||chkBoolForPrefIndSku||chkBoolForPrefIndColor||(prefIndex=0),productsWithPricesAndMemory.length>0){newProduct.CreditClass=[{CreditClass1:{Upfront:"$"+productsWithPricesAndMemory[prefIndex].payNowGoodCredit_s,Monthly:"$"+productsWithPricesAndMemory[prefIndex].monthlyPriceGCS,DiscountedPrice:"$"+productsWithPricesAndMemory[prefIndex].listPriceSku},CreditClass2:{Upfront:"$"+productsWithPricesAndMemory[prefIndex].payNowBuildCredit_s,Monthly:"$"+productsWithPricesAndMemory[prefIndex].monthlyPriceBCS,DiscountedPrice:"$"+productsWithPricesAndMemory[prefIndex].listPriceSku},CreditClass3:{Upfront:"$"+productsWithPricesAndMemory[prefIndex].listPriceSku,Monthly:"$0.00",DiscountedPrice:"$"+productsWithPricesAndMemory[prefIndex].salePriceSku}}],newProduct.sku=productsWithPricesAndMemory[prefIndex].skuCode,newProduct.bogoSku=productsWithPricesAndMemory[prefIndex].bogoSku,newProduct.onSaleSku=productsWithPricesAndMemory[prefIndex].onSaleSku,newProduct.specialOfferSku=productsWithPricesAndMemory[prefIndex].specialOfferSku,newProduct.webOnlySku=productsWithPricesAndMemory[prefIndex].webOnlySku,newProduct.FrontImage=getGARImagePath(productsWithPricesAndMemory[prefIndex].thumbNail),newProduct.priceTypeAvailableEIP=productsWithPricesAndMemory[prefIndex].priceTypeAvailableEIP,newProduct.priceTypeAvailableFRP=productsWithPricesAndMemory[prefIndex].priceTypeAvailableFRP,newProduct.availabilityRule=product.availabilityRule,lodash.forEach(override,function(item){angular.isString(item)&&(item=angular.fromJson(item)),newProduct.sku==item.sku&&item.status&&(newProduct.availabilityRule=item.status)}),newProduct.offer=getProductOffer(product,prefIndex),"true"===newProduct.onSaleSku?(newProduct.bogoSku="false",newProduct.specialOfferSku="false",newProduct.webOnlySku="false"):"true"===newProduct.webOnlySku?(newProduct.bogoSku="false",newProduct.onSaleSku="false",newProduct.specialOfferSku="false"):"true"===newProduct.specialOfferSku?(newProduct.bogoSku="false",newProduct.onSaleSku="false",newProduct.webOnlySku="false"):"true"===newProduct.bogoSku&&(newProduct.onSaleSku="false",newProduct.specialOfferSku="false",newProduct.webOnlySku="false");var prefColor=productsWithPricesAndMemory[prefIndex].deviceColorSKU;if(angular.isDefined(prefColor)){var arrSearchableColors=_.isEmpty(product.searchableColors)?void 0:product.searchableColors.split("|");if(arrSearchableColors&&arrSearchableColors.length>0){var selectedColorIndex=arrSearchableColors.indexOf(prefColor);(_.isEmpty(newProduct.FrontImage)||angular.isUndefined(newProduct.FrontImage))&&(newProduct.FrontImage=angular.isDefined(product.thumbNail)?product.thumbNail[selectedColorIndex]:newProduct.FrontImage)}}newResponse.push(newProduct)}}),$log.log("newResponse",newResponse),newResponse;$log.log("Error: Response didnt come through.")}}function getProductOffer(prodObj,prefIndex){var offer={},skuOfferName=prodObj.skuOfferDisplayName.split("|")[prefIndex],skuOfferDescription=prodObj.skuOfferDescription.split("|")[prefIndex],skuOfferDisplayName=prodObj.skuOfferDisplayName.split("|")[prefIndex];return _.isEmpty(prodObj.skuOfferDisplayName)?(offer.name=_.isEmpty(prodObj.offerShortDescription)?"":prodObj.offerShortDescription,offer.description=_.isEmpty(prodObj.offerDescription)?"":getGARImagePathForOfferModal(prodObj.offerDescription),offer.displayname=_.isEmpty(prodObj.offerDisplayName)?"":prodObj.offerDisplayName):(offer.name=skuOfferName,offer.description=_.isEmpty(skuOfferDescription)?"":getGARImagePathForOfferModal(skuOfferDescription),offer.displayname=_.isEmpty(skuOfferDisplayName)?"":skuOfferDisplayName),offer}function getTransformedCreditClassPricingDetails(oldResponse,isPreviewcartAPIV2){if($log.log("Old Response : ",oldResponse),oldResponse&&(oldResponse.cart||oldResponse.creditPrice)){var creditClass,cartPricing={},creditClass1={},creditClass2={},creditClass3={};return isPreviewcartAPIV2?(creditClass=oldResponse.creditPrice,angular.forEach(creditClass,function(value,key){value.creditLevel===creditClassConstant.creditClasses.GOOD?cartPricing.creditClass1=getCreditClass(value):value.creditLevel===creditClassConstant.creditClasses.BUILDING?cartPricing.creditClass2=getCreditClass(value):value.creditLevel===creditClassConstant.creditClasses.NONE&&(cartPricing.creditClass3=getCreditClass(value))})):(creditClass=oldResponse.cart.creditClass,creditClass1.payNowPrice=getJsonPath(creditClass.creditClass1,"paynowprice.display"),creditClass1.payNowPriceAmount=getJsonPath(creditClass.creditClass1,"paynowprice.display"),creditClass1.monthlyPrice=getJsonPath(creditClass.creditClass1,"monthlyprice.display"),creditClass1.monthlyPriceAmount=getJsonPath(creditClass.creditClass1,"monthlyprice.amount"),creditClass1.creditLevel=getJsonPath(creditClass.creditClass1,"creditLevel"),creditClass2.payNowPrice=getJsonPath(creditClass.creditClass2,"paynowprice.display"),creditClass2.payNowPriceAmount=getJsonPath(creditClass.creditClass2,"paynowprice.display"),creditClass2.monthlyPrice=getJsonPath(creditClass.creditClass2,"monthlyprice.display"),creditClass2.monthlyPriceAmount=getJsonPath(creditClass.creditClass2,"monthlyprice.amount"),creditClass2.creditLevel=getJsonPath(creditClass.creditClass2,"creditLevel"),creditClass3.payNowPrice=getJsonPath(creditClass.creditClass3,"paynowprice.display"),creditClass3.payNowPriceAmount=getJsonPath(creditClass.creditClass3,"paynowprice.display"),creditClass3.monthlyPrice=getJsonPath(creditClass.creditClass3,"monthlyprice.display"),creditClass3.monthlyPriceAmount=getJsonPath(creditClass.creditClass3,"monthlyprice.amount"),creditClass3.creditLevel=getJsonPath(creditClass.creditClass3,"creditLevel"),cartPricing.creditClass1=creditClass1,cartPricing.creditClass2=creditClass2,cartPricing.creditClass3=creditClass3),cartPricing}}function getCreditClass(inValue){var creditClass={};return creditClass.payNowPrice=getJsonPath(inValue,creditClassConstant.creditClasses.PAYNOWPRICE),creditClass.payNowPriceAmount=getJsonPath(inValue,creditClassConstant.creditClasses.PAYNOWPRICE),creditClass.monthlyPrice=getJsonPath(inValue,creditClassConstant.creditClasses.MONTHLYPRICE),creditClass.monthlyPriceAmount=getJsonPath(inValue,creditClassConstant.creditClasses.MONTHLYPRICEAMOUNT),creditClass.creditLevel=getJsonPath(inValue,creditClassConstant.creditClasses.CREDITLEVEL),creditClass}function getServices(servicesResponse,serviceDefintion){var itemArray,constituentsArray,partialServiceItems=[],partialServiceConstituents=[],serviceData={},services=[];servicesResponse&&servicesResponse["configuration-state"]?(itemArray=servicesResponse._item,constituentsArray=servicesResponse["configuration-state"].constituents):servicesResponse&&servicesResponse._itemconfiguration&&(itemArray=servicesResponse._itemconfiguration[0]._item,constituentsArray=servicesResponse._itemconfiguration[0]["configuration-state"].constituents),serviceDefintion?partialServiceItems=serviceDefintion.services:angular.forEach(itemArray,function(item,itemKey){var serviceToPush={code:getJsonPath(item,"_code[0].code"),name:getJsonPath(item,"_definition[0].display-name"),description:getJsonPath(item,'_definition[0].details[?(@.name=="Description")].display-value'),recommended:getJsonPath(item,'_definition[0].details[?(@.name=="recommendedFlag")].display-value'),monthlyPrice:getJsonPath(item,"price.priceSummary.monthlyPrice.salePrice.display"),
serviceCategory:getJsonPath(item,'_definition[0].details[?(@.name=="ServiceCat")].display-value')};serviceToPush.recommended?serviceToPush.orderGroup=0:serviceToPush.orderGroup=10,"SERVICES"!==serviceToPush.code&&partialServiceItems.push(serviceToPush)}),angular.forEach(constituentsArray,function(constituent,constituentKey){var constituentToPush={constituentId:getJsonPath(constituent,"constituent-id"),constituentUri:getJsonPath(constituent,"constituent-uri"),enabled:getJsonPath(constituent,"enabled"),selected:getJsonPath(constituent,"selected"),code:getJsonPath(constituent,"sku-code")};partialServiceConstituents.push(constituentToPush)}),angular.forEach(partialServiceConstituents,function(partialServiceItem,itemKey){services.push(_.extend(partialServiceItem,_.find(partialServiceItems,{code:partialServiceItem.code})))});var _addtolineaction=getJsonPath(servicesResponse,'_addtolineform..[?(@.rel =="addtolineaction")].href'),_constituentActionUrl=getJsonPath(servicesResponse,'_constituentselectorform..[?(@.rel =="selectconstituentaction")].href');return serviceData={services:services,addtolineaction:_addtolineaction,constituentActionUrl:_constituentActionUrl}}function getTransformedServies(servicesResponse){var serviceData=[];return angular.forEach(servicesResponse.services.details,function(value,key){var description=getJsonPath(value,"description");description=lodash.isArray(description)?description[0]:description;var category=getJsonPath(value,"category");category=lodash.isArray(category)?category[0]:category;var serviceToPush={code:getJsonPath(value,"offerID"),id:getJsonPath(value,"id"),name:getJsonPath(value,"offerName"),description:description,enabled:getJsonPath(value,"enabled"),selected:getJsonPath(value,"selected"),serviceCategory:category,recommended:getJsonPath(value,"isRecommended")?"isRecommended":!1,monthlyPrice:getJsonPath(value,"price.priceSummary.monthlyPrice.salePrice.display"),pricing:getJsonPath(value,"price.priceSummary.monthlyPrice.salePrice.display")};serviceData.push(serviceToPush)}),serviceData}function getTransformedProductDetails(product){for(var bulkProudctData=[],i=0;i<product.data.productdetails.length;i++)product.data.productdetails[i].AvailableFromDate=_getFormattedDate(product.data.productdetails[i].AvailableFromDate),product.data.productdetails[i].AvailableToDate=_getFormattedDate(product.data.productdetails[i].AvailableToDate);for(var responseUniqueColors=_.uniq(_.map(product.data.productdetails,"Color")),idx=0;idx<responseUniqueColors.length;idx++){var colorFilteredProducts=_.filter(product.data.productdetails,{Color:responseUniqueColors[idx]});colorFilteredProducts=_.sortBy(colorFilteredProducts,function(d){return parseInt(d.Memory,10)});for(var index=0;index<colorFilteredProducts.length;index++)bulkProudctData.push(colorFilteredProducts[index])}bulkProudctData=_.sortBy(bulkProudctData,function(d){return parseInt(d.Memory,10)});var miniPDPData={bulkProudctData:bulkProudctData};return miniPDPData}function transformShippingOptionsResponse(shippingOptionResponse){var jsonData=shippingOptionResponse.shippingOptions,selectedShippingOptions=[];return angular.forEach(jsonData,function(value,key){var option={deliveryTime:value.deliveryTime,name:value.displayName,displayName:value.name,selected:value.selected,cost:value.cost,actionUrl:value.actionURL,costValue:parseFloat(value.cost.substring(1))};angular.equals(option.name,checkOutConstants.STANDARD_SHIPPING)?option.orderNumber=1:angular.equals(option.name,checkOutConstants.SHIPPING_OVERNIGHT)?option.orderNumber=2:option.orderNumber=3,selectedShippingOptions.push(option)}),selectedShippingOptions}var service=this;return getAEMData(),service.aemValues=null,service.aemDefaultSku=[],service.getAEMData=getAEMData,service.mostPopularDevicesTransformation=mostPopularDevicesTransformation,service.getTransformedServies=getTransformedServies,service.getTransformedProductDetails=getTransformedProductDetails,service.getTransformedCreditClassPricingDetails=getTransformedCreditClassPricingDetails,service.getServices=getServices,service.transformShippingOptionsResponse=transformShippingOptionsResponse,service.getCreditClass=getCreditClass,service}responseTransformationServiceV2Fn.$inject=["jsonPath","$log","aemRoutingService","toggleService","globalAssetRepositoryConstants","checkOutConstants","globalValue","creditClassConstant"],angular.module("tmobileApp").service("responseTransformationServiceV2",responseTransformationServiceV2Fn)}(window.angular,_),function(angular,lodash){"use strict";function storeDetailsUtilConstructor(storeLocatorConstants,apiService,httpRequestWrapper,commonServices,globalValue){function getFormattedStoreHours(unformattedStoreHours){var storeHours=unformattedStoreHours.map(function(storeHour){return{name:storeHour.eventName||storeHour.day.substr(0,3),isHoliday:storeHour.eventName?!0:!1,opens:storeHour.formattedOpens,closes:storeHour.formattedCloses}}),formattedStoreHours=[];return storeHours.forEach(function(storeHour,index){if(0===index)formattedStoreHours.push(storeHour);else{var latestStoreHour=formattedStoreHours[formattedStoreHours.length-1];storeHour.isHoliday?formattedStoreHours.push(storeHour):latestStoreHour.opens===storeHour.opens&&latestStoreHour.closes===storeHour.closes?latestStoreHour.name.indexOf("-")>-1?latestStoreHour.name=latestStoreHour.name.split("-")[0]+"-"+storeHour.name:latestStoreHour.name+="-"+storeHour.name:formattedStoreHours.push(storeHour)}}),formattedStoreHours}function getArrayToDisplay(unformattedHours){var formattedHours=[];return unformattedHours.forEach(function(e1,index){if(0===index)e1["opens-closes"]=e1.opens+"-"+e1.closes,formattedHours.push(e1);else{var latest=formattedHours[formattedHours.length-1];e1["opens-closes"]=e1.opens+"-"+e1.closes,latest.day===e1.day&&latest.EventName===e1.EventName?latest["opens-closes"]=latest["opens-closes"]+","+e1["opens-closes"]:formattedHours.push(e1)}}),formattedHours.some(function(el){el["opens-closes"]&&(el["opens-closes"]=el["opens-closes"].split(",").join(",<br />"))}),formattedHours}function formatConsolidatedArray(unformattedHours){var hours=unformattedHours.map(function(hour){return{name:hour.eventName?hour.eventName:hour.day.substr(0,3),event:hour.eventName,opens:hour.formattedOpens,closes:hour.formattedCloses,day:hour.day}}),formattedHours=[];return hours.forEach(function(hour,index){if(0===index)formattedHours.push(hour);else{var latestHour=formattedHours[formattedHours.length-1];hour.event?formattedHours.push(hour):latestHour.opens===hour.opens&&latestHour.closes===hour.closes?latestHour.name.indexOf("-")>-1?latestHour.name=latestHour.name.split("-")[0]+"-"+hour.name:latestHour.name+="-"+hour.name:formattedHours.push(hour)}}),formattedHours}function getConsolidatedArray(day,emergencyHours,holidayHours,hours,npiHours){var availableInEmergency=emergencyHours&&emergencyHours.length>0?emergencyHours.filter(function(hour){return hour.day===day}):!1;if(availableInEmergency&&availableInEmergency.length>0)return availableInEmergency.map(function(obj){return obj.isEmergencyHours=!0,obj}),availableInEmergency;var availableInNpi=npiHours&&npiHours.length>0?npiHours.filter(function(hour){return hour.day===day}):!1;if(availableInNpi&&availableInNpi.length>0)return availableInNpi.map(function(obj){return obj.isNpiHours=!0,obj}),availableInNpi;var availableInHoliday=holidayHours&&holidayHours.length>0?holidayHours.filter(function(hour){return hour.day===day}):!1;if(availableInHoliday&&availableInHoliday.length>0)return availableInHoliday.map(function(obj){return obj.isHolidayHours=!0,obj}),availableInHoliday;var availableInHours=hours&&hours.length>0?hours.filter(function(hour){return hour.day===day}):!1;return availableInHours&&availableInHours.length>0?availableInHours:void 0}function isEmergencyClosed(emergencyHours){for(var emergencyClosed=!0,i=0;i<vm.alldays.length&&(emergencyClosed=emergencyHours.some(function(el){return el.day===vm.alldays[i]&&!el.opens&&!el.closes}),emergencyClosed);i++);return emergencyClosed}function checkForTitle(specialHoursAuthor,authoringHolidayHours,storeHoursLabel,emergencyHours,holidayHours,npiHours){var title="";return title=emergencyHours&&0!==emergencyHours.length||!holidayHours||!(holidayHours.length>0)||npiHours&&0!==npiHours.length?npiHours&&npiHours.length?specialHoursAuthor:storeHoursLabel:authoringHolidayHours}function getStoreHoursArray(arrayOfStoreHours){for(var finalArray=[],arrayOfDays=arrayOfStoreHours;arrayOfDays.length>0;){var indexOfIntermediateDay=0;1===arrayOfDays.length?finalArray.push({day:arrayOfDays[0].day.substring(0,3),hours:(arrayOfDays[0].opens.toLowerCase()+"-"+arrayOfDays[0].closes.toLowerCase()).replace(":00","")}):(arrayOfDays.map(function(item,key){arrayOfDays[0].closes===item.closes&&arrayOfDays[0].opens===item.opens&&0!==key&&(indexOfIntermediateDay=key)}),0===indexOfIntermediateDay?finalArray.push({day:arrayOfDays[0].day.substring(0,3),hours:(arrayOfDays[0].opens.toLowerCase()+"-"+arrayOfDays[0].closes.toLowerCase()).replace(":00","")}):finalArray.push({day:arrayOfDays[0].day.substring(0,3)+"-"+arrayOfDays[indexOfIntermediateDay].day.substring(0,3),hours:(arrayOfDays[0].opens.toLowerCase()+"-"+arrayOfDays[0].closes.toLowerCase()).replace(":00","")})),arrayOfDays=arrayOfDays.splice(indexOfIntermediateDay+1)}return finalArray}function getFormattedHours(unformattedHours,holidayHours){var storeHours=[];if(angular.isDefined(unformattedHours)&&!lodash.isEmpty(unformattedHours)&&(unformattedHours.forEach(function(day){if(day.opens){day.opens=day.opens.split(":");var storeStartHours=parseInt(day.opens[0],10),openTimePeriod=storeStartHours>=12?"pm":"am";day.opens=storeStartHours+":"+day.opens[1]+openTimePeriod}else day.opens="N.A.";if(day.close||day.closes){day.closes=(day.close||day.closes).split(":");var storeEndHours=day.closes[0],closeTimePeriod=storeEndHours>=12?"pm":"am";storeEndHours=storeEndHours>12?parseInt(storeEndHours,10)-12:storeEndHours;var storeEndMinutes=":"+day.closes[1];day.closes=storeEndHours+storeEndMinutes+closeTimePeriod}else day.closes="N.A."}),storeHours=getStoreHoursArray(unformattedHours)),angular.isDefined(holidayHours)){var day,hours;holidayHours.forEach(function(item){var arr=item.split(/(\s*(\d+):\d{2}\s+(\w+)\s*)/);if(day=arr[0],lodash.includes(day,"Closed")){hours="Closed";var closedArray=day.split(/(\s*(\w+)\s+)/);day=closedArray[2]+" "+closedArray[5]}else{var startHours=parseInt(arr[2],10)+arr[3].toLowerCase(),endHours=arr[6]+arr[7].toLowerCase();hours=startHours+"-"+endHours}var dayObj={day:day,hours:hours};storeHours.push(dayObj)})}return storeHours}function sortPhotos(photo){var sortOrderRegExp=/_([0-9]+)(?:_[0-9]+x[0-9]+)*\.(?:[a-z]|[A-Z]){3,4}$/;return photo.sort(function(currentPhoto,nextPhoto){if(currentPhoto.image&&currentPhoto.image.sourceUrl&&nextPhoto.image&&nextPhoto.image.sourceUrl){var currentSortResult=currentPhoto.image.sourceUrl.match(sortOrderRegExp),nextSortResult=nextPhoto.image.sourceUrl.match(sortOrderRegExp),currentPhotoSortOrder=currentSortResult?parseInt(currentSortResult[1],10):0,nextPhotoSortOrder=nextSortResult?parseInt(nextSortResult[1],10):0;return currentPhotoSortOrder===nextPhotoSortOrder?0:currentPhotoSortOrder>nextPhotoSortOrder?1:-1}return 0}),photo}function imageSelector(photo,containerHeight){for(var sortedPhotos=sortPhotos(photo),storePhotos=[],i=0;i<sortedPhotos.length;i++)if(sortedPhotos[i].image.thumbnails&&sortedPhotos[i].image.thumbnails.length>0){sortedPhotos[i].description&&(sortedPhotos[i].image.description=sortedPhotos[i].description);var validImages=sortedPhotos[i].image.thumbnails;validImages.unshift(sortedPhotos[i].image);var finalArray=validImages.reduce(function(accumulator,currentValue){if(!currentValue.height){var resultArr=currentValue.url.match(/x([0-9]+){1}\.(?:[a-z]|[A-Z]){3,4}$/);resultArr&&(currentValue.height=resultArr[1])}return currentValue.height<accumulator.height&&currentValue.height>containerHeight?(currentValue.alternateText||(currentValue.alternateText=accumulator.alternateText),!currentValue.description&&accumulator.description&&(currentValue.description=accumulator.description),currentValue):accumulator});storePhotos.push(finalArray)}else storePhotos.push(sortedPhotos[i].image);return storePhotos}function alternateTextCarouselImage(image,interiorPhotoAlternateText,exteriorPhotoAlternateText){var alternateText;return image.alternateText?alternateText=image.alternateText:image.sourceUrl&&(image.sourceUrl.toLowerCase().includes("_int_")?(alternateText=interiorPhotoAlternateText,image.alternateText=alternateText):image.sourceUrl.toLowerCase().includes("_ext_")&&(alternateText=exteriorPhotoAlternateText,image.alternateText=alternateText)),alternateText}function getStoreEvents(eventIds,storeId){var urlObject=apiService.getURL("storeLocator.storeEvents"),url=urlObject.url,header={Accept:"application/json"},queryParams={storeId:storeId};return httpRequestWrapper.get(url,queryParams,header).then(function(result){for(var events=[],i=0;i<eventIds.length;i++){var eventId=eventIds[i];if(result.data.eventIds.hasOwnProperty(eventId)){var eventObj=result.data.eventIds[eventId];eventObj.eventId=eventId;var startDate=moment(eventObj.startDate,"MM-DD-YYYY"),endDate=moment(eventObj.endDate,"MM-DD-YYYY"),strArray=["JAN","FEB","MAR","APR","MAY","JUN","JUL","AUG","SEP","OCT","NOV","DEC"],opensMoment=moment(eventObj.opens,"HH:mm"),closesMoment=moment(eventObj.closes,"HH:mm");if(eventObj.formattedCloses=0===closesMoment.minutes()?closesMoment.format("ha"):closesMoment.format("h:mma"),startDate.month()===endDate.month()&&startDate.date()===endDate.date()){eventObj.formattedEventDate=strArray[startDate.month()]+" "+startDate.date();var isMeridiemReq=!(opensMoment.hours()>=12&&closesMoment.hours()>=12||opensMoment.hours()<12&&closesMoment.hours()<12);eventObj.formattedOpens=0===opensMoment.minutes()?opensMoment.format(isMeridiemReq?"ha":"h"):opensMoment.format(isMeridiemReq?"h:mma":"h:mm")}else eventObj.formattedStartDate=strArray[startDate.month()]+" "+startDate.date(),eventObj.formattedEndDate=strArray[endDate.month()]+" "+endDate.date(),eventObj.formattedOpens=0===opensMoment.minutes()?opensMoment.format("ha"):opensMoment.format("h:mma");events.push(eventObj)}}return events.sort(function(current,previous){return moment(current.startDate+" "+current.opens,"MM-DD-YYYY HH:mm").isBefore(moment(previous.startDate+" "+previous.opens,"MM-DD-YYYY HH:mm"))?-1:1}),$q.resolve(events)})}function getStoreServices(store){if(store.storeTag&&!store.storeTag.includes(storeLocatorConstants.STORE_TAG.EXPERIENCE)&&!store.storeTag.includes(storeLocatorConstants.STORE_TAG.SIGNATURE)&&store.type&&store.type!=storeLocatorConstants.STORE_TYPE.NATIONAL_RETAIL){var aemServices=lodash.get(vm.storeDetailsAuthoring,"services","");""!==aemServices&&(aemServices=angular.isArray(aemServices)?aemServices.map(function(service){return service.serviceDescription}).filter(function(msg){return""!==msg}):[aemServices.serviceDescription],store.services=store.services?aemServices.concat(store.services):aemServices)}return store.services}function getSpecialMessages(store){var aemSpecialMessages=lodash.get(vm.storeDetailsAuthoring,"specialMessagesArray",""),validAemSpecialMessages=[];return""!==aemSpecialMessages&&(angular.isArray(aemSpecialMessages)?angular.forEach(aemSpecialMessages,function(msg){validAemSpecialMessages.push(reStructureMessage(msg))}):validAemSpecialMessages.push(reStructureMessage(aemSpecialMessages))),store.specialMessages=store.specialMessages?validAemSpecialMessages.concat(store.specialMessages):validAemSpecialMessages,store.specialMessages=store.specialMessages.filter(function(msg){return msg.iconUrl&&(msg.message1||msg.message2||msg.hyperLink&&msg.hyperLink.text&&msg.hyperLink.url)?msg:void 0}),store.specialMessages}function reStructureMessage(msg){var msgObj={};return msgObj.iconUrl=msg.iconUrl,msgObj.message1=msg.message1,msgObj.message2=msg.message2,msgObj.hyperLink={},msg.hyperLinkText&&(msgObj.hyperLink.text=msg.hyperLinkText),msg.hyperLinkUrl&&(msgObj.hyperLink.url=msg.hyperLinkUrl),msgObj}var vm=this;vm.alldays=storeLocatorConstants.ALL_DAYS;var $q=commonServices.$q;return vm.storeDetailsAuthoring=globalValue.authorValue.storeauthoring.storeDetailsSection,{getFormattedStoreHours:getFormattedStoreHours,getFormattedHours:getFormattedHours,checkForTitle:checkForTitle,isEmergencyClosed:isEmergencyClosed,getConsolidatedArray:getConsolidatedArray,formatConsolidatedArray:formatConsolidatedArray,getArrayToDisplay:getArrayToDisplay,imageSelector:imageSelector,alternateTextCarouselImage:alternateTextCarouselImage,sortPhotos:sortPhotos,getStoreEvents:getStoreEvents,getStoreServices:getStoreServices,getSpecialMessages:getSpecialMessages,storeDetailsAuthoring:vm.storeDetailsAuthoring}}storeDetailsUtilConstructor.$inject=["storeLocatorConstants","apiService","httpRequestWrapper","commonServices","globalValue"],angular.module("tmobileApp").factory("storeDetailsUtil",storeDetailsUtilConstructor)}(window.angular,window._),function(angular){"use strict";function CheckCompatibilityModalControllerConstructor($modalInstance,openView,checkCompatibilityDataService,selectedLine,commonUtils){function cancel(){$modalInstance.dismiss("cancel")}function checkCompatibility(){selectedLine.selectedCarrier=commonUtils.searchJson(vm.model.selectedCarrier,"carrier"),selectedLine.selectedDevice=commonUtils.searchJson(vm.model.selectedDevice,"device_name"),checkCompatibilityDataService.isCompatible()?vm.showResult=!0:$modalInstance.close(selectedLine)}function init(){vm.model=checkCompatibilityDataService.model,checkCompatibilityDataService.model.openView=openView,vm.model.selectedCarrier=null,vm.model.selectedDevice=null,checkCompatibilityDataService.init()}function hideResult(){vm.showResult=!1}var vm=this;vm.showResult=!1,vm.cancel=cancel,vm.checkCompatibility=checkCompatibility,vm.hideResult=hideResult,init()}CheckCompatibilityModalControllerConstructor.$inject=["$modalInstance","openView","checkCompatibilityDataService","selectedLine","commonUtils"],angular.module("tmobileApp").controller("CheckCompatibilityModalController",CheckCompatibilityModalControllerConstructor)}(angular),function(angular,lodash){"use strict";function storeFilterUtilConstructor(commonServices,storeLocatorModelService,pdlService,storeLocatorUtil,mapUtil,STORE_LOCATOR_STATE_NAME,storeLocatorConstants,toggleService,globalValue,storeDetailsUtil){function setTempFilters(tempSortOption){sortByOption=storeLocatorModelService.sortValueMappingForAPI(tempSortOption)}function applyFilter(ctaName,modalName,filterOptions){vm.model.storeSortByOption=sortByOption,vm.model.hideCompleteCarousel=!0,vm.model.zoomEventTriggeredManually=!1,vm.model.hideFindNearByStoreLink=!0,vm.model.storeList=[],vm.model.showPrev=!1,vm.model.start=1,vm.model.storeList=vm.model.completeStoreList,vm.model.currentPageNumber=1,filterOptions&&(vm.model.openNow=toggleService.model.toggles.enableSLPOpenNow&&filterOptions.openNow,vm.model.serveSprint=toggleService.model.toggles.sprintFiltersEnabled&&filterOptions.serveSprint,vm.model.repairCenter=toggleService.model.toggles.sprintFiltersEnabled&&filterOptions.repairCenter),vm.model.openNow&&(vm.model.storeList=lodash.filter(vm.model.storeList,function(store){return store.isOpenNow})),vm.model.repairCenter&&(vm.model.storeList=lodash.filter(vm.model.storeList,function(store){return store.hasSprintStack&&store.deviceRepair})),vm.model.storeList=storeLocatorUtil.sortStoresByType(vm.model.storeList,vm.model.storeSortByOption),vm.model.storeList.length<=vm.model.maxStoreDisplay?(vm.model.end=vm.model.storeList.length,vm.model.showNext=!1):(vm.model.end=vm.model.maxStoreDisplay,vm.model.showNext=!0),vm.model.sectionToDisplay="searchResultView";var sortByValue=storeLocatorModelService.sortValueMappingForUrl(vm.model.storeSortByOption),stateRouteConfig={sortBy:sortByValue,page:vm.model.currentPageNumber,filter:null};storeLocatorModelService.changeState(stateRouteConfig,!0,!0);var offSetValue=$window.innerWidth/2;if(vm.model.isMobileView?mapUtil.sendOffsets(20,50,20,80):mapUtil.sendOffsets(offSetValue,0,0,0),vm.model.storeList.length>0?mapUtil.setMarkers(!0,vm.model.storeList,vm.model.start,vm.model.end):mapUtil.clearMarkers(),ctaName==storeAuthoringOption.openNowLabel&&vm.model.openNow||ctaName==storeAuthoringOption.serveSprintLabel&&vm.model.serveSprint||ctaName==storeAuthoringOption.repairCenterLabel&&vm.model.repairCenter){var filterName,pdlData={assetType:storeLocatorConstants.PAGES.FILTER};vm.model.openNow&&vm.model.serveSprint&&vm.model.repairCenter?filterName=storeAuthoringOption.openNowLabel+", "+storeAuthoringOption.serveSprintLabel+", "+storeAuthoringOption.repairCenterLabel:!vm.model.openNow||vm.model.serveSprint||vm.model.repairCenter?vm.model.openNow||!vm.model.serveSprint||vm.model.repairCenter?vm.model.openNow||vm.model.serveSprint||!vm.model.repairCenter?!vm.model.openNow&&vm.model.serveSprint&&vm.model.repairCenter?filterName=storeAuthoringOption.serveSprintLabel+", "+storeAuthoringOption.repairCenterLabel:vm.model.openNow&&vm.model.serveSprint&&!vm.model.repairCenter?filterName=storeAuthoringOption.openNowLabel+", "+storeAuthoringOption.serveSprintLabel:vm.model.openNow&&!vm.model.serveSprint&&vm.model.repairCenter&&(filterName=storeAuthoringOption.openNowLabel+", "+storeAuthoringOption.repairCenterLabel):filterName=storeAuthoringOption.repairCenterLabel:filterName=storeAuthoringOption.serveSprintLabel:filterName=storeAuthoringOption.openNowLabel,pdlData.filterName=filterName,pdlService.applyStoreFilterEvent(pdlData)}else if("sortOrder"==ctaName||!ctaName){var pdlData={formName:"",sortName:vm.model.storeSortByOption,assetType:"sort",modalName:modalName};pdlService.applyStoreFilterCTAEvent(pdlData)}}var vm=this,$window=commonServices.$window;commonServices.$state;vm.model=storeLocatorModelService.model;var sortByOption="",storeAuthoringOption=lodash.get(globalValue.authorValue.storeauthoring,"generalAuthoringStores","");return{applyFilter:applyFilter,setTempFilters:setTempFilters}}storeFilterUtilConstructor.$inject=["commonServices","storeLocatorModelService","pdlService","storeLocatorUtil","mapUtil","STORE_LOCATOR_STATE_NAME","storeLocatorConstants","toggleService","globalValue","storeDetailsUtil"],angular.module("tmobileApp").factory("storeFilterUtil",storeFilterUtilConstructor)}(window.angular,window._),function(angular,lodash){"use strict";function cartCommonOperationsService($log,$rootScope,commonUtils,loggingService,cartHttpDataService,CartCommonModal,creditClassService,cartStorage,tmobNotificationService,cartAccessoryService,commonServices,deviceProtectionAndServicesHttpData,cartControllerHelperService,globalConfig,globalValue,checkOutHttpDataUtil,accessoriesService,toggleService,pdlService,$timeout,essentialsService,cartConstants){function setStructCartData(){return service.model.structCartData=cartControllerHelperService.getGlobalCart(),service.model.structCartData}function updateStructCartData(){var newStructCartData=cartStorage.getGlobalSmartCartInfo();service.model.structCartData=newStructCartData,$rootScope.$$postDigest(function(){service.model.structCartData=newStructCartData})}function editProductClose(selectedLine){var id="#cartDeviceSection_"+selectedLine.lineNumber;return service.addRole(id),selectedLine.mvcAttrs.editProductInProgress=!1,selectedLine.mvcAttrs.editProductInProgress}function addRole(id){var elm=angular.element(id);elm.attr("role","button")}function addNewLineFocus(divClass){$rootScope.$$postDigest(function(){commonServices.$window.scrollTo(0,angular.element(divClass).offset().top)})}function addLineByLineType(lineType){var lineTypeVal=lineType,lineItemsHandsetArray=_searchJsonPathArray(service.model.structCartData.lineItems,'[?(@.lineType=="HANDSET")]')||[],lineItemsTabletArray=_searchJsonPathArray(service.model.structCartData.lineItems,'[?(@.lineType=="TABLET")]')||[],lineItemsWearableArray=_searchJsonPathArray(service.model.structCartData.lineItems,'[?(@.lineType=="WEARABLE")]')||[];if(lineTypeVal||(lineTypeVal="HANDSET"),!(service.model.deviceLimitReached||"HANDSET"===lineTypeVal&&service.model.lineMaxHandsetLimitReached||"TABLET"===lineTypeVal&&service.model.lineMaxTabletLimitReached)){var requestBody,itemCode;itemCode=globalConfig.cartSettings.constants.mockSKUs.addNewLine,requestBody={itemCode:itemCode,selectedCreditLevel:creditClassService.getEPCreditClass(),financeOption:"",subType:lineTypeVal},cartHttpDataService.addNewLine(requestBody,service.model).then(function(){service.model.structCartData=cartStorage.getGlobalSmartCartInfo();var length=service.model.structCartData.lineItems.length-1;service.model.structCartData.lineItems[length].lineId;cartStorage.setLineType(lineTypeVal,service.model.structCartData.lineItems[length].lineId),cartStorage.getDefaultCartFlag()===!0&&cartStorage.setDefaultCartFlag(!1),accessoryService.showAccessoryNudgeWhenEIP(!0,service.model.structCartData),service.removeMagentaClass(),service.checkDeviceLimit(),cartStorage.getCartId()||(cartStorage.setCartId(service.model.structCartData.cartId),cartStorage.setOrderId(service.model.structCartData.orderId)),addNewLineFocus(".cart-product:last"),"HANDSET"===lineTypeVal&&0===lineItemsHandsetArray.length&&(lineItemsTabletArray.length>0||lineItemsWearableArray.length>0)?(tmobNotificationService.addNotification.push("cart032"),tmobNotificationService.showNotification(tmobNotificationService.addNotification)):"TABLET"===lineTypeVal&&0===lineItemsTabletArray.length&&0===lineItemsWearableArray.length&&lineItemsHandsetArray.length>0?(tmobNotificationService.addNotification.push("cart031"),tmobNotificationService.showNotification(tmobNotificationService.addNotification)):"TABLET"===lineTypeVal&&(lineItemsTabletArray.length>0||lineItemsWearableArray.length>0)&&lineItemsHandsetArray.length>0&&(tmobNotificationService.addNotification.push("cart033"),tmobNotificationService.showNotification(tmobNotificationService.addNotification))})}}function fetchEligiblePlans(lineId,lineTypeVal,isDefaultPlan,isPageLoadEvent){return essentialsService.getEligiblePlans(lineId,lineTypeVal,isDefaultPlan).then(function(plans){if(!lodash.isEmpty(plans.eligiblePlans)&&angular.isDefined(plans.eligiblePlans)&&(service.model.eligiblePlans=plans.eligiblePlans,service.setActiveIndex(),angular.isDefined(isPageLoadEvent)&&isPageLoadEvent)){var activePlan=cartControllerHelperService.getDefaultPlanData({lineType:lineTypeVal},plans);service.changeLinePlan(activePlan)}},function(error){$log.log("Error getting plans from getEligiblePlans: "+error)})}function setActiveIndex(){var cartData=cartStorage.getGlobalSmartCartInfo();angular.isDefined(cartData.lineItems)&&cartData.lineItems.length>0&&angular.isDefined(cartData.lineItems[0].lineItemDetails)&&angular.isDefined(cartData.lineItems[0].lineItemDetails.planDetails.planName)&&(service.model.activePlanName=cartData.lineItems[0].lineItemDetails.planDetails.planName)}function resetFlags(){angular.isDefined(service.keyValues.essentials)&&angular.isDefined(service.keyValues.essentials.devicePlans)&&(lodash.isArray(service.keyValues.essentials.devicePlans)?angular.forEach(service.keyValues.essentials.devicePlans,function(plan){plan.isDeviceDisabled=!1,plan.isTabletDisabled=!1,plan.isWearableDisabled=!1}):(service.keyValues.essentials.devicePlans.isDeviceDisabled=!1,service.keyValues.essentials.devicePlans.isTabletDisabled=!1,service.keyValues.essentials.devicePlans.isWearableDisabled=!1))}function setPlanDisable(){resetFlags(),service.keyValues=service.getAuthorKeyValues(globalValue.authorValue);var cartData=cartStorage.getGlobalSmartCartInfo(),devicePlans=[];if(angular.isDefined(cartData.lineItems)&&cartData.lineItems.length>0)if(angular.forEach(cartData.lineItems,function(item){if(angular.isDefined(service.keyValues.essentials))switch(devicePlans=service.keyValues.essentials.devicePlans,item.lineType){case cartConstants.DEVICE_TYPE.HANDSET:lodash.isArray(devicePlans)?angular.forEach(devicePlans,function(plan){plan.isDeviceDisabled=!1}):service.keyValues.essentials.devicePlans.isDeviceDisabled=!1;break;case cartConstants.DEVICE_TYPE.TABLET:comparePlanToDisablePlanTile(devicePlans,service.keyValues.essentials.tabletPlans,item.lineType);break;case cartConstants.DEVICE_TYPE.WEARABLE:comparePlanToDisablePlanTile(devicePlans,service.keyValues.essentials.wearablePlans,item.lineType);break;default:$log.log("Not a type: ",item.lineType)}}),devicePlans&&angular.isArray(devicePlans)){var devicePlanDisabled=lodash.find(service.keyValues.essentials.devicePlans,{isDeviceDisabled:!0})?!0:!1,tabletPlanDisabled=lodash.find(service.keyValues.essentials.devicePlans,{isTabletDisabled:!0})?!0:!1,wearablePlanDisabled=lodash.find(service.keyValues.essentials.devicePlans,{isWearableDisabled:!0})?!0:!1;service.model.isDisabledButton=devicePlanDisabled||tabletPlanDisabled||wearablePlanDisabled}else service.model.isDisabledButton=devicePlans.isDeviceDisabled||devicePlans.isTabletDisabled||devicePlans.isWearableDisabled;checkDeviceLimit()}function comparePlanToDisablePlanTile(devicePlans,plansToCompare,lineType){lodash.isArray(devicePlans)?angular.forEach(devicePlans,function(plan){lodash.isArray(plansToCompare)?setFlags(plan,plansToCompare,lineType,!0):setFlags(plan,plansToCompare,lineType,!1)}):lodash.isArray(plansToCompare)?setFlags(devicePlans,plansToCompare,lineType,!0):setFlags(devicePlans,plansToCompare,lineType,!1)}function setFlags(plan,plansToCompare,lineType,isArrayplansToCompare){if(isArrayplansToCompare){var matchedPlan=lodash.find(plansToCompare,{planType:plan.planType});lineType===cartConstants.DEVICE_TYPE.TABLET?plan.isTabletDisabled=angular.isUndefined(matchedPlan):lineType===cartConstants.DEVICE_TYPE.WEARABLE&&(plan.isWearableDisabled=angular.isUndefined(matchedPlan))}else lineType===cartConstants.DEVICE_TYPE.TABLET?plan.isTabletDisabled=plansToCompare.planType!==plan.planType:lineType===cartConstants.DEVICE_TYPE.WEARABLE&&(plan.isWearableDisabled=plansToCompare.planType!==plan.planType)}function getAuthorKeyValues(authorValue){var keyValues={};if(authorValue&&"cart"in authorValue&&(keyValues=authorValue.cart,"miniPdp"in keyValues&&("productImageArrows"in keyValues.miniPdp&&(keyValues.miniPdp.productImageArrows=keyValues.miniPdp.productImageArrows.toString()),"productImagePagination"in keyValues.miniPdp&&(keyValues.miniPdp.productImagePagination=keyValues.miniPdp.productImagePagination.toString())),"creditSelector"in keyValues&&"class"in keyValues.creditSelector)){keyValues["class"]=[];for(var pos=0;pos<keyValues.creditSelector["class"].length;pos++)keyValues["class"].push(angular.fromJson(keyValues.creditSelector["class"][pos])),"enable"in keyValues["class"][pos]&&(keyValues["class"][pos].enable=keyValues["class"][pos].enable.toString())}return keyValues}function removeServicesFromCart(selectedLine){deviceProtectionAndServicesHttpData.getServices(selectedLine.lineId).then(function(serviceResponse){cartStorage.setServiceId(serviceResponse.data.services.id,selectedLine.lineId),deviceProtectionAndServicesHttpData.addServicesToLine(selectedLine.lineId).then(function(cartResponseStatus){angular.equals(cartResponseStatus,200)?(service.removeMagentaClass(),selectedLine.mvcAttrs.isDeviceChanged=!0,selectedLine.mvcAttrs.isServiceChanged=!1,selectedLine.lineItemDetails.serviceDetails&&selectedLine.lineItemDetails.serviceDetails.length>0?(tmobNotificationService.addNotification.push(["cart003","cart009"]),tmobNotificationService.showNotification(tmobNotificationService.addNotification)):(tmobNotificationService.addNotification.push("cart003"),tmobNotificationService.showNotification(tmobNotificationService.addNotification)),service.model.structCartData=cartStorage.getGlobalSmartCartInfo(),selectedLine.serviceAddedBy="serviceModal"):loggingService.error("We have an error adding new line to cart.")})})}function addDeviceToLine(modalData,selectedLine,oldDevice,newDevice){var requestBody={sku:modalData.SKU,pricingOption:"FULL"===modalData.paymentOption?"FULL":""
};"SIM_KIT_BYOD"!==modalData.SKU||angular.equals(modalData.SKU,oldDevice)?cartHttpDataService.addToLine(requestBody,selectedLine.lineId).then(function(){cartStorage.setMockCartCreated("itemadded"),oldDevice?oldDevice===newDevice?(service.removeMagentaClass(),selectedLine.mvcAttrs.isDeviceChanged=!0,selectedLine.mvcAttrs.isServiceChanged=!1,tmobNotificationService.showNotification(["cart003"])):(service.removeServicesFromCart(selectedLine),service.model.showCompatibleNotification?tmobNotificationService.addNotification.push("cart035"):tmobNotificationService.addNotification.push("cart003"),tmobNotificationService.showNotification(tmobNotificationService.addNotification)):(service.model.showCompatibleNotification?tmobNotificationService.addNotification.push("cart035"):tmobNotificationService.addNotification.push("cart002"),tmobNotificationService.showNotification(tmobNotificationService.addNotification)),service.model.structCartData=cartStorage.getGlobalSmartCartInfo(),checkDeviceLimit(),service.model.structCartData.lineItems,lodash.get(toggleService.model,"toggles.isEssentialsEnabled",!1)&&lodash.get(toggleService.model,"toggles.isPlanMgmtEnabled",!1)&&setEligiblePlan(selectedLine),accessoryService.showAccessoryNudgeWhenEIP(!0,service.model.structCartData)}):cartHttpDataService.removeDeviceFromLine(selectedLine.lineId,selectedLine.lineItemDetails.deviceDetails.id).then(function(){cartHttpDataService.addToLine(requestBody,selectedLine.lineId).then(function(){cartStorage.setMockCartCreated("itemadded"),oldDevice?oldDevice===newDevice?(service.removeMagentaClass(),selectedLine.mvcAttrs.isDeviceChanged=!0,selectedLine.mvcAttrs.isServiceChanged=!1):service.removeServicesFromCart(selectedLine):(tmobNotificationService.addNotification.push("cart006"),tmobNotificationService.showNotification(tmobNotificationService.addNotification)),service.model.structCartData=cartStorage.getGlobalSmartCartInfo(),checkDeviceLimit(),service.model.structCartData.lineItems,lodash.get(toggleService.model,"toggles.isEssentialsEnabled",!1)&&lodash.get(toggleService.model,"toggles.isPlanMgmtEnabled",!1)&&setEligiblePlan(selectedLine),accessoryService.showAccessoryNudgeWhenEIP(!0,service.model.structCartData)})})}function setEligiblePlan(selectedLine){var length=service.model.structCartData.lineItems.length-1,createdLineItem=service.model.structCartData.lineItems[length];cartControllerHelperService.eligiblePlans(selectedLine.lineId,createdLineItem,!0).then(function(cartData){cartData&&cartData.cartId?(service.model.structCartData=cartStorage.getGlobalSmartCartInfo(),service.disableProductCta()):$log.error("Error: cart data not found")},function(error){$log.error("Error fetching cart data : "+error)})}function disableCheckoutCTA(){var deviceData=lodash.get(service.model.structCartData,"lineItems",[]),authorFamilyid=lodash.get(globalValue.authorValue,"cart.disableHybridBan.familyId");authorFamilyid=lodash.isArray(authorFamilyid)?authorFamilyid:[authorFamilyid];var hybridBanFamilyId=!1,isCheckoutEnable=service.model.structCartData.flags.isCheckoutEnable,isOrderEligible=service.model.structCartData.flags.isOrderEligible;lodash.forEach(deviceData,function(item){lodash.get(item,"lineItemDetails.deviceDetails.familyId")&&lodash.includes(authorFamilyid,item.lineItemDetails.deviceDetails.familyId)&&(hybridBanFamilyId=!0)}),isCheckoutEnable=hybridBanFamilyId?service.model.structCartData.flags.isDeviceInHandset===!0&&service.model.structCartData.flags.isEmptyLine===!1?isOrderEligible:!1:isOrderEligible,service.model.structCartData.flags.isCheckoutEnable=isCheckoutEnable}function removeMagentaClass(){service.model.structCartData&&service.model.structCartData.lineItems&&angular.forEach(service.model.structCartData.lineItems,function(line){line.mvcAttrs.isDeviceChanged=!1,line.mvcAttrs.isServiceChanged=!1})}function checkDeviceLimit(){var cartSettings=globalConfig.cartSettings;if(service.model.structCartData)if(0===service.model.structCartData.lineItems.length)service.model.deviceLimitReached=!1,service.model.lineMaxHandsetLimitReached=!1,service.model.lineMaxTabletLimitReached=!1;else{var length,maxHandsetLength,maxTabletLength,lineItemsHandsetArray,lineItemsTabletArray,lineItemsWearableArray;service.model.structCartData&&service.model.structCartData.selectedCreditClass&&"creditClass3"===service.model.structCartData.selectedCreditClass["class"]?(length=cartSettings.maxLineLimit.creditClass3.maxTotalLine,maxHandsetLength=cartSettings.maxLineLimit.creditClass3.maxHandsetLine,maxTabletLength=cartSettings.maxLineLimit.creditClass3.maxTabletLine):(length=cartSettings.maxLineLimit.creditClass1.maxTotalLine,maxHandsetLength=cartSettings.maxLineLimit.creditClass1.maxHandsetLine,maxTabletLength=cartSettings.maxLineLimit.creditClass1.maxTabletLine),lineItemsHandsetArray=commonUtils.searchJsonArray(service.model.structCartData.lineItems,'[?(@.lineType=="HANDSET")]'),lineItemsTabletArray=commonUtils.searchJsonArray(service.model.structCartData.lineItems,'[?(@.lineType=="TABLET")]'),lineItemsWearableArray=commonUtils.searchJsonArray(service.model.structCartData.lineItems,'[?(@.lineType=="WEARABLE")]'),lineItemsWearableArray&&(lineItemsTabletArray=angular.isDefined(lineItemsTabletArray)?lineItemsTabletArray:[],lineItemsTabletArray=lineItemsTabletArray.concat(lineItemsWearableArray)),service.model.lineMaxHandsetLimitReached=lineItemsHandsetArray&&lineItemsHandsetArray.length>=maxHandsetLength,service.model.lineMaxTabletLimitReached=lineItemsTabletArray&&lineItemsTabletArray.length>=maxTabletLength,service.model.deviceLimitReached=service.lineMaxHandsetLimitReached&&service.lineMaxTabletLimitReached||service.model.structCartData.lineItems.length>=length,service.model.deviceLimitReached&&(service.model.lineMaxHandsetLimitReached=!0,service.model.lineMaxTabletLimitReached=!0)}disableCheckoutCTA()}function checkStatus(){var flag=commonUtils.searchJson(service.model.structCartData,"flags");if(!flag)return service.model.structCartData.flags={isAccessoryFlow:!1},!1;var accessoryDetails=commonUtils.searchJson(service.model.structCartData,"accessories.accessoryDetails");accessoryDetails=accessoryDetails?accessoryDetails.length:0;var lineItems=commonUtils.searchJson(service.model.structCartData,"lineItems");return lineItems=lineItems?lineItems.length:0,0===accessoryDetails&&0===lineItems?service.model.structCartData.flags.isAccessoryFlow=!1:service.model.structCartData.flags.isAccessoryFlow=!0,!0}function isZipCodeAdded(){return cartStorage.getZipCode()?!0:!1}function openCreditClassSelectorModal(current,keyValues,callback,planModalOpen){var commonResolves=cartControllerHelperService.commonResolves(null,current,null,keyValues);angular.extend(commonResolves,cartControllerHelperService.isPlanSelectorModal(planModalOpen));var resolveAttributes={resolve:angular.extend(commonResolves.selectedCreditClass,commonResolves.source,commonResolves.isPlanSelectorModal,commonResolves.keyValues,commonResolves.selectedLine)},modalCallBack=function(modalObject){modalObject.isModalCanced||(service.model.structCartData.selectedCreditClass&&angular.equals(service.model.structCartData.selectedCreditClass["class"],modalObject.selectedCreditClass["class"])||(creditClassService.setCreditClass(modalObject.selectedCreditClass),service.model.structCartData.selectedCreditClass=modalObject.selectedCreditClass,cartHttpDataService.getCart().then(function(){removeMagentaClass();var accessoryFlow=service.model.structCartData.flags.isAccessoryFlow;service.model.structCartData=cartStorage.getGlobalSmartCartInfo(),checkDeviceLimit(),service.model.structCartData.flags.isAccessoryFlow=accessoryFlow})),callback&&callback(modalObject))},modalDismissCallBack=function(){cartHttpDataService.saveCreditLevel(service.model.structCartData.selectedCreditClass,function(result){$log.log("reverted credit Class to EP..")})};if(CartCommonModal.openCartModal("creditSelectionModal",resolveAttributes,modalCallBack,modalDismissCallBack),angular.isFunction($document.querySelector)){var uiViewElement=angular.element($document.querySelector(".ng-main-view"));uiViewElement.removeClass("ng-main-view"),$timeout(function(){uiViewElement.addClass("ng-main-view")},1e3)}}function openAlertMessageModal(modalData){var commonResolves=cartControllerHelperService.commonResolves(null,null,null,modalData),resolveAttributes={resolve:angular.extend(commonResolves.keyValues)};CartCommonModal.openCartModal("alertMessageModal",resolveAttributes,emptyCallBack,alertDissmissCallback,modalData.disableBackdrop)}function openSaveCartModal(){var commonResolves=cartControllerHelperService.commonResolves(null,null,null,null),resolveAttributes={resolve:angular.extend(commonResolves.keyValues)};CartCommonModal.openCartModal("saveCartModal",resolveAttributes,callSaveCartThankYouModal)}function openFinalizeInStoreModal(data){var commonResolves=cartControllerHelperService.commonResolves(null,null,null,null),resolveAttributes={resolve:angular.extend(commonResolves.keyValues)};lodash.isNil(data)?service.model.storeLocatorFlag=!1:(service.model.storeLocatorFlag=!0,service.model.storeLocationData=data);var modalDismissCallBack=function(){service.model.isOverrideCart=!1};CartCommonModal.openCartModal("finalizeInStoreModal",resolveAttributes,emptyCallBack,modalDismissCallBack)}function finalizeInStoreThankYouModal(data,flag){var commonResolves=cartControllerHelperService.commonResolves(null,null,null,null,null,null,null,null,null,data),resolveAttributes={resolve:angular.extend(commonResolves.keyValues,commonResolves.orderInStoreData)};service.isSavePage=flag,CartCommonModal.openCartModal("finalizeCartThankYouModal",resolveAttributes,emptyCallBack)}function saveCartWebConfirmationModal(data,flag){var commonResolves=cartControllerHelperService.commonResolves(null,null,null,null,null,null,null,null,null,data),resolveAttributes={resolve:angular.extend(commonResolves.keyValues,commonResolves.orderInStoreData)};service.isSavePage=flag,CartCommonModal.openCartModal("saveCartWebConfirmationModal",resolveAttributes,emptyCallBack)}function openSaveCartThankYouModal(){var commonResolves=cartControllerHelperService.commonResolves(null,null,null,null,null,null,null,service.cartSaveOption,service.userName),resolveAttributes={resolve:angular.extend(commonResolves.keyValues,commonResolves.cartSaveOption,commonResolves.userName)};CartCommonModal.openCartModal("saveCartThankYouModal",resolveAttributes,emptyCallBack)}function openLoadCartModal(){var commonResolves=cartControllerHelperService.commonResolves(null,null,null,null),resolveAttributes={resolve:angular.extend(commonResolves.keyValues)};CartCommonModal.openCartModal("loadCartModal",resolveAttributes,emptyCallBack)}function openAuthenticationModal(){var commonResolves=cartControllerHelperService.commonResolves(null,null,null,null),resolveAttributes={resolve:angular.extend(commonResolves.keyValues)};CartCommonModal.openCartModal("authenticationModal",resolveAttributes,emptyCallBack)}function openTradeInTool(selectedLine){var commonResolves=cartControllerHelperService.commonResolves(null,selectedLine,null,null),resolveAttributes={resolve:angular.extend(commonResolves.keyValues,commonResolves.selectedLine)};CartCommonModal.openCartModal("tradeInTool",resolveAttributes,emptyCallBack)}function emptyCallBack(){}function alertDissmissCallback(){}function callSaveCartThankYouModal(modalObj){service.userName=modalObj.name,service.cartSaveOption=modalObj.saveCartOption,modalObj.toggle&&openSaveCartThankYouModal()}function updateCurrentPlanTile(currentPlanTile,planOptionsArray,currentPlanListSize,userOption){service.model.currPlanTile=currentPlanTile,service.model.planListSize=currentPlanListSize,"Back"===userOption?(service.model.currPlanTile-=1,service.model.showMore=!1):"SeeMore"===userOption&&(service.model.currPlanTile+=1,service.model.currPlanTile>=planOptionsArray.length/service.model.planListSize-1?service.model.showMore=!0:service.model.showMore=!1)}function checkDuplicateDisable(selectedLine){var disableDuplicate=!1;return(service.model.deviceLimitReached||"TABLET"===selectedLine.lineType&&service.model.lineMaxTabletLimitReached||"HANDSET"===selectedLine.lineType&&service.model.lineMaxHandsetLimitReached||"WEARABLE"===selectedLine.lineType&&service.model.lineMaxTabletLimitReached)&&(disableDuplicate=!0),disableDuplicate}function saveCartURL(){var urlSaveCart=location.origin+"/cart/SC?id="+cartStorage.getCartId();return cartStorage.setSaveCartURL(urlSaveCart),cartStorage.setSaveCartFlag(!0),checkOutHttpDataUtil.getAutoPayState().then(function(responseData){if(angular.equals(responseData.status,200)&&responseData.data){var scCartURL,isAutoPay={},isStorePayment={};if(angular.isUndefined(responseData.data.auditRecords))isAutoPay={auditValue:!0},isStorePayment={auditValue:!0};else{var auditRecords=responseData.data.auditRecords;scCartURL=_.find(auditRecords,{auditKey:"SAVE_CART_URL"}),isAutoPay=_.find(auditRecords,{auditKey:"AUTO_PAY"}),isStorePayment=_.find(auditRecords,{auditKey:"STORE_PAYMENT"}),angular.isUndefined(isStorePayment)&&(isStorePayment={auditValue:!0})}if(angular.isUndefined(scCartURL))return checkOutHttpDataUtil.createAuditRecords(JSON.parse(isAutoPay.auditValue),JSON.parse(isStorePayment.auditValue),null,null,null,cartStorage.getSaveCartURL())}})}function loadOrderDetailsView(){if(toggleService.model.toggles.cartVsOrderDetails&&service.model.structCartData&&service.model.structCartData.cartId){var _commonResolves=cartControllerHelperService.commonResolves(null,service.model.structCartData,null,globalValue.authorValue.cart,null,null,"cart"),resolveAttributes={resolve:angular.extend(_commonResolves.keyValues,_commonResolves.selectedLine,_commonResolves.source)};CartCommonModal.openCartModal("priceBreakdownModal",resolveAttributes)}}function disableProductCta(){service.keyValues=service.getAuthorKeyValues(globalValue.authorValue);var currentPlanObject,cartData=cartStorage.getGlobalSmartCartInfo();if(angular.isDefined(service.keyValues.essentials)){if(angular.isDefined(cartData.lineItems)){var length=cartData.lineItems.length-1;if(length>=0&&cartData.lineItems[length].lineItemDetails&&cartData.lineItems[length].lineItemDetails.planDetails&&cartData.lineItems[length].lineItemDetails.planDetails.sku){var planId=service.model.structCartData.flags.isDeviceInHandset?getHandsetPlanId():cartData.lineItems[length].lineItemDetails.planDetails.sku;angular.isDefined(planId)&&angular.isDefined(service.keyValues.essentials.devicePlans)&&(lodash.isArray(service.keyValues.essentials.devicePlans)?currentPlanObject=lodash.find(service.keyValues.essentials.devicePlans,function(plan){return lodash.find(plan.planUIDs,{planUid:planId})?plan:void 0}):lodash.find(service.keyValues.essentials.devicePlans.planUIDs,{planUid:planId})&&(currentPlanObject=service.keyValues.essentials.devicePlans),angular.isDefined(currentPlanObject)&&(service.model.selectedPlanType=currentPlanObject.planType,lodash.get(toggleService.model,"toggles.isTaxesEnabled",!1)&&cartStorage.setSelectedPlanType(currentPlanObject.planType)),service.model.isDeviceDisabled=checkProductEligibility(service.keyValues.essentials.devicePlans),service.model.isTabletDisabled=checkProductEligibility(service.keyValues.essentials.tabletPlans),service.model.isWearableDisabled=checkProductEligibility(service.keyValues.essentials.wearablePlans))}else 0>length&&lodash.get(toggleService.model,"toggles.isPlanIntentEnabled",!1)&&service.disableProductForRatePlan()}service.setActiveIndex(),setPlanDisable(),changeLinePlan({planType:service.model.selectedPlanType})}}function getHandsetPlanId(){var handSetLine,cartData=cartStorage.getGlobalSmartCartInfo();return lodash.isEmpty(cartData.lineItems)||(handSetLine=lodash.find(cartData.lineItems,{lineType:cartConstants.DEVICE_TYPE.HANDSET})),handSetLine.lineItemDetails.planDetails.sku}function checkProductEligibility(availablePlans){var planObject={};return lodash.isArray(availablePlans)?planObject=lodash.find(availablePlans,function(plan){return plan.planType===service.model.selectedPlanType}):availablePlans.planType===service.model.selectedPlanType&&(planObject=availablePlans),lodash.isEmpty(planObject)}function getPlanTileAuthorValues(planType,lineType){var planTile={};switch(lineType){case cartConstants.DEVICE_TYPE.HANDSET:var devicePlan;devicePlan=globalValue.authorValue.cart.essentials.devicePlans instanceof Array?lodash.find(globalValue.authorValue.cart.essentials.devicePlans,function(plan){return plan.planType===planType}):globalValue.authorValue.cart.essentials.devicePlans,angular.isDefined(devicePlan)&&(planTile.planName=devicePlan.devicePlanNameAtLineLevel,planTile.planDescription=devicePlan.devicePlanDescriptionAtLineLevel);break;case cartConstants.DEVICE_TYPE.TABLET:var tabletPlan;tabletPlan=globalValue.authorValue.cart.essentials.tabletPlans instanceof Array?lodash.find(globalValue.authorValue.cart.essentials.tabletPlans,function(plan){return plan.planType===planType}):globalValue.authorValue.cart.essentials.tabletPlans,angular.isDefined(tabletPlan)&&(planTile.planName=tabletPlan.tabletPlanNameAtLineLevel,planTile.planDescription=tabletPlan.tabletPlanDescriptionAtLineLevel);break;case cartConstants.DEVICE_TYPE.WEARABLE:var wearablePlan;wearablePlan=globalValue.authorValue.cart.essentials.wearablePlans instanceof Array?lodash.find(globalValue.authorValue.cart.essentials.wearablePlans,function(plan){return plan.planType===planType}):globalValue.authorValue.cart.essentials.wearablePlans,lodash.isEmpty(wearablePlan)||(planTile.planName=wearablePlan.wearablePlanNameAtLineLevel,planTile.planDescription=wearablePlan.wearablePlanDescriptionAtLineLevel);break;default:planTile.planName="",planTile.planDescription=""}return planTile}function changeLinePlan(activePlan){service.model.activeLinePlan={HANDSET:service.getPlanTileAuthorValues(activePlan.planType,cartConstants.DEVICE_TYPE.HANDSET),TABLET:service.getPlanTileAuthorValues(activePlan.planType,cartConstants.DEVICE_TYPE.TABLET),WEARABLE:service.getPlanTileAuthorValues(activePlan.planType,cartConstants.DEVICE_TYPE.WEARABLE)}}function isCRPVerifiedForTPP(){var isTPPOn=lodash.get(toggleService.model,"toggles.isTPPON",!1);return!isTPPOn||isTPPOn&&(cartStorage.getHardCreditCheck()||cartStorage.getSoftCreditCheck())}function triggerNotification(cartData){var count=0;service.keyValues=service.getAuthorKeyValues(globalValue.authorValue),angular.isDefined(service.keyValues)&&angular.isDefined(service.keyValues.essentials)&&(angular.forEach(cartData.lineItems,function(lineItem){if(angular.isDefined(lineItem.lineItemDetails)&&angular.isDefined(lineItem.lineItemDetails.planDetails)){var socUIds=lineItem.lineItemDetails.planDetails.planSOCs[0];socUIds===service.keyValues.essentials.promotionDataSoc&&(count+=1)}}),count>1&&(tmobNotificationService.addNotification.push("cart036"),tmobNotificationService.showNotification(tmobNotificationService.addNotification)))}function checkProductEligibilityFromPlanIntentCookie(availablePlans){var planObject={},storedPlan=cartStorage.getPlanIntentCookie();return lodash.isArray(availablePlans)?planObject=lodash.find(availablePlans,function(plan){return plan.planType===storedPlan}):availablePlans.planType===storedPlan&&(planObject=availablePlans),lodash.isEmpty(planObject)}function disableProductForRatePlan(){service.keyValues=service.getAuthorKeyValues(globalValue.authorValue);var storedPlan=cartStorage.getPlanIntentCookie();angular.isDefined(storedPlan)&&angular.isDefined(service.keyValues.essentials)&&angular.isDefined(service.keyValues.essentials.devicePlans)&&(service.model.isDeviceDisabled=checkProductEligibilityFromPlanIntentCookie(service.keyValues.essentials.devicePlans),service.model.isTabletDisabled=checkProductEligibilityFromPlanIntentCookie(service.keyValues.essentials.tabletPlans),service.model.isWearableDisabled=checkProductEligibilityFromPlanIntentCookie(service.keyValues.essentials.wearablePlans))}function serviceTaxLabel(serviceItem){var isTaxInclusive=serviceItem.isTaxInclusive;return globalValue.authorValue.rootPage&&isTaxInclusive===!1?globalValue.authorValue.rootPage.pricing.plusTaxLabel:void 0}function showRightSubText(){return service.model.structCartData.flags.isAutoPayOn?service.rightAutoPayText():service.rightNoAutoPayText()}function checkLineServiceTaxed(line){var flag=!0;return angular.forEach(line.lineItemDetails.serviceDetails,function(service){service.isTaxInclusive||(flag=!1)}),flag}function rightNoAutoPayText(){return cartStorage.getSelectedPlanType().toUpperCase()==cartConstants.PLAN_TYPES.T_MOBILE_ESSENTIALS.toUpperCase()?globalValue.authorValue.rootPage.pricing.noAutoPayEssentialText:globalValue.authorValue.rootPage.pricing.noAutoPayNonEssentialText}function rightAutoPayText(){return cartStorage.getSelectedPlanType().toUpperCase()==cartConstants.PLAN_TYPES.T_MOBILE_ESSENTIALS.toUpperCase()?globalValue.authorValue.rootPage.pricing.autoPayEssentialText:globalValue.authorValue.rootPage.pricing.autoPayNonEssentialText}function planPromotionAmount(promotion){var promotionalCredits;return angular.isDefined(promotion.promotionalCredits)&&(promotionalCredits=lodash.find(promotion.promotionalCredits,{creditType:"RECURRING"})),promotionalCredits?promotionalCredits.recurringAmount:promotion.discountValue?promotion.discountValue.amount:void 0}var service=this,$document=commonServices.$document,_searchJsonPathArray=commonUtils.searchJsonArray,accessoryService=toggleService.model.toggles.newAccessory?accessoriesService:cartAccessoryService,keyValues={};return service.model={structCartData:{},deviceLimitReached:!1,lineMaxHandsetLimitReached:!1,lineMaxTabletLimitReached:!1,currPlanTile:0,planListSize:globalConfig.cartSettings.planListSize,showMore:!1,ispfcart:!1,storeLocationData:{},storeLocatorFlag:!1,eligiblePlans:[],activePlanName:"",isDisabledButton:!1,isDeviceDisabled:!1,isTabletDisabled:!1,isWearableDisabled:!1,activeLinePlan:{},isOverrideCart:!1},service.authorValue=globalValue.authorValue,service.checkDuplicateDisable=checkDuplicateDisable,service.updateCurrentPlanTile=updateCurrentPlanTile,service.setStructCartData=setStructCartData,service.updateStructCartData=updateStructCartData,service.editProductClose=editProductClose,service.addRole=addRole,service.addLineByLineType=addLineByLineType,service.getAuthorKeyValues=getAuthorKeyValues,service.removeServicesFromCart=removeServicesFromCart,service.addDeviceToLine=addDeviceToLine,service.removeMagentaClass=removeMagentaClass,service.checkDeviceLimit=checkDeviceLimit,service.checkStatus=checkStatus,service.isZipCodeAdded=isZipCodeAdded,service.openAlertMessageModal=openAlertMessageModal,service.openSaveCartModal=openSaveCartModal,service.openSaveCartThankYouModal=openSaveCartThankYouModal,service.openLoadCartModal=openLoadCartModal,service.openAuthenticationModal=openAuthenticationModal,service.openCreditClassSelectorModal=openCreditClassSelectorModal,service.saveCartURL=saveCartURL,service.openTradeInTool=openTradeInTool,service.disableCheckoutCTA=disableCheckoutCTA,service.openFinalizeInStoreModal=openFinalizeInStoreModal,service.finalizeInStoreThankYouModal=finalizeInStoreThankYouModal,service.isSavePage=!1,service.loadOrderDetailsView=loadOrderDetailsView,service.isDeeplinkFlow=!1,service.saveCartWebConfirmationModal=saveCartWebConfirmationModal,service.fetchEligiblePlans=fetchEligiblePlans,service.disableProductCta=disableProductCta,service.keyValues=keyValues,service.changeLinePlan=changeLinePlan,service.getPlanTileAuthorValues=getPlanTileAuthorValues,service.setActiveIndex=setActiveIndex,service.setEligiblePlan=setEligiblePlan,service.setPlanDisable=setPlanDisable,service.getHandsetPlanId=getHandsetPlanId,service.isCRPVerifiedForTPP=isCRPVerifiedForTPP,service.triggerNotification=triggerNotification,service.disableProductForRatePlan=disableProductForRatePlan,service.serviceTaxLabel=serviceTaxLabel,service.rightNoAutoPayText=rightNoAutoPayText,service.rightAutoPayText=rightAutoPayText,service.checkLineServiceTaxed=checkLineServiceTaxed,service.showRightSubText=showRightSubText,service.planPromotionAmount=planPromotionAmount,service}cartCommonOperationsService.$inject=["$log","$rootScope","commonUtils","loggingService","cartHttpDataService","CartCommonModal","creditClassService","cartStorage","tmobNotificationService","cartAccessoryService","commonServices","deviceProtectionAndServicesHttpData","cartControllerHelperService","globalConfig","globalValue","checkOutHttpDataUtil","accessoriesService","toggleService","pdlService","$timeout","essentialsService","cartConstants"],angular.module("tmobileApp").service("cartCommonOperationsService",cartCommonOperationsService)}(window.angular,_),function(angular,lodash){"use strict";function storeLocatorInitUtilConstructor(commonServices,storeLocatorModelService,storeLocatorUtil,mapUtil,geoLocation,mpLocalizationService,toggleService,globalValue,storeLocatorConstants,mapEventHandlerUtil){function sendOffSets(){model.isMobileView?mapUtil.sendOffsets(20,50,20,80):mapUtil.sendOffsets(0,0,0,100)}function showCarouselWithMarkers(spatialPoint,ignoreLoadingBar,fromSearchThisArea){model.searchingStore=!0,model.noStoresFound=!1,storeLocatorUtil.getStoreList(spatialPoint,model.startIndex,model.resultCount,model.miles,ignoreLoadingBar).then(function(response){model.searchingStore=!1,model.storeLocatorInModal||(model.storeList=response.data),lodash.isEmpty(response.data)&&fromSearchThisArea?(model.sectionToDisplay=storeLocatorConstants.SECTIONS.SEARCH_RESULTS,model.clearSearchButton=!0,model.noStoresFound=!0):!lodash.isEmpty(response.data)&&fromSearchThisArea&&model.storeLocatorInModal?(model.d2rModelManager.setStores(response.data),commonServices.$rootScope.$broadcast("apply-inventory-filter")):(model.storeLocatorInModal?model.sectionToDisplay=storeLocatorConstants.SECTIONS.SEARCH_RESULTS:model.sectionToDisplay="",sendOffSets(),model.storeLocatorInModal&&(model.storeList=lodash.filter(response.data,function(store){return"RETAIL"===store.type})),mapUtil.setMarkers(!0,model.storeList,model.start,model.end)),model.zoomEventTriggeredManually=!1,model.showSTALink=!1,model.showCarouselUp=!0,model.hideCompleteCarousel=!1})["catch"](function(error){error.data&&"No content found"===error.data.systemMessage&&404===error.data.code&&fromSearchThisArea&&(model.sectionToDisplay=storeLocatorConstants.SECTIONS.SEARCH_RESULTS,model.clearSearchButton=!0,mapEventHandlerUtil.clearMarkers(),model.noStoresFound=!0,model.showSTALink=!1,model.searchingStore=!1)})}function getAdobeLocation(NYLcta){var latitude,longitude,sessionIPC=angular.fromJson(sessionStorage.getItem("IPC"));if(sessionIPC&&(latitude=sessionIPC.latitude,longitude=sessionIPC.longitude),angular.isDefined(latitude)&&angular.isDefined(longitude)){var spatialPoint={lat:latitude,lng:longitude};model.spatialPointLatLng=[latitude,longitude],showCarouselWithMarkers(spatialPoint,!1)}model.showNYLLink=NYLcta,model.showSTALink=!1}function pickStore(storeName,storeId){var deffered=$q.defer();return lodash.isEmpty(model.storeList)?deffered.reject():(model.store=lodash.find(model.storeList,function(store){var normalizedStoreName=$filter("normalize")(store.name);return normalizedStoreName===storeName||store.id===storeId}),deffered.resolve()),deffered.promise}function onSearchThisAreaClicked(){storeLocatorModelService&&storeLocatorModelService.model&&storeLocatorModelService.model.store&&(storeLocatorModelService.model.currentStore=storeLocatorModelService.model.store),model.zoomEventTriggeredManually=!0,model.storeList=[],model.store.nearbyStores=[];var spatialPoint={lat:model.lat,lng:model["long"]};storeLocatorModelService.changeState(),showCarouselWithMarkers(spatialPoint,!0,!0)}function onNotYourLocationClicked(){model.showNYLLink=!1,geoLocation.getCoordinates().then(function(pos){model.storeList=[],model.showSTALink=!1;var spatialPoint={lat:pos.coords.latitude,lng:pos.coords.longitude};showCarouselWithMarkers(spatialPoint,!1)})}function onCarouselToggleClicked(){model.showCarouselUp?(model.showCarouselUp=!1,model.isClickOnDownArrow=!0):(model.closeBtn=!1,model.showCarouselUp=!0,model.isClickOnDownArrow=!1)}function loadStoreMarkers(){if(lodash.isEmpty(model.storeList))storeLocatorUtil.getCurrentPage()===storeLocatorConstants.PAGES.CITY&&model.selectedCity&&(mapUtil.clearMarkers(),mapUtil.setViewportForCoordinates(model.selectedCity,"centerPoint.latitude","centerPoint.longitude"));else{var offSetValue=$window.innerWidth/2;model.isMobileView?mapUtil.sendOffsets(20,50,20,80):mapUtil.sendOffsets(offSetValue,0,0,0),mapUtil.setMarkers(!0,model.storeList,model.start,model.end),model.zoomEventTriggeredManually=!1,model.showSTALink=!1}}function loadCityBubbles(){if(!lodash.isEmpty(model.cityList)){var offSetValue=$window.innerWidth/2;model.isMobileView?mapUtil.sendOffsets(20,50,20,80):mapUtil.sendOffsets(offSetValue,0,0,0),mapUtil.setBubbles(!0,model.cityList),model.zoomEventTriggeredManually=!1,model.showSTALink=!1}}function getLocationCoordinates(){geoLocation.getCoordinates().then(function(pos){model.showNYLLink=!1,model.showSTALink=!1;var spatialPoint={lat:pos.coords.latitude,lng:pos.coords.longitude};model.spatialPointLatLng=[pos.coords.latitude,pos.coords.longitude],showCarouselWithMarkers(spatialPoint,!1)})["catch"](function(){getFallBackLocation(!1)})}function afterMapLoad(){var userAgent=$window.navigator.userAgent,isTMOApp=userAgent&&userAgent.toLowerCase().indexOf("applicationversioncode")>=0;model.SDPViaDeeplink&&!lodash.isEmpty(model.store.nearbyStores)?(mapUtil.sendOffsets(400,0,0,0),mapUtil.setMarkers(!0,model.store.nearbyStores,1,0,!1,model.selectedStoreIndex,!0),mapUtil.selectMarkerWithHtml(model.selectedStoreIndex,!0,!0,null)):lodash.isEmpty(model.storeList)?isTMOApp?getLocationCoordinates():navigator.permissions?navigator.permissions.query({name:storeLocatorConstants.PLUGINS.GEOLOCATION}).then(function(permissionStatus){permissionStatus.state===storeLocatorConstants.PERMISSIONS.GRANTED?getLocationCoordinates():getFallBackLocation(permissionStatus.state===storeLocatorConstants.PERMISSIONS.PROMPT?!0:!1)})["catch"](function(){getFallBackLocation(!1)}):getFallBackLocation(!0):(model.loadPrevStoreListView=!0,model.showSearchResultView?(model.hideCompleteCarousel=!0,model.sectionToDisplay=storeLocatorConstants.SECTIONS.SEARCH_RESULTS):(model.hideCompleteCarousel=!1,model.showCarouselUp=!0,model.sectionToDisplay="",model.searchField=""),mapUtil.setMarkers(!0,model.storeList,model.start,model.end))}function getFallBackLocation(NYLcta){var lang=null===mpLocalizationService.getCookie(storeLocatorConstants.COOKIES.LANGUAGE)?storeLocatorConstants.LANGUAGES.ENGLISH:mpLocalizationService.getCookie(storeLocatorConstants.COOKIES.LANGUAGE),isAdobeAllowed=angular.equals(lang,storeLocatorConstants.LANGUAGES.ENGLISH)||angular.equals(lang,storeLocatorConstants.LANGUAGES.ESPANOL),userAgent=$window.navigator.userAgent,isTMOApp=userAgent&&userAgent.toLowerCase().indexOf("applicationversioncode")>=0,sessionIPC=angular.fromJson(sessionStorage.getItem("IPC")),latitudeFromIpc=sessionIPC?sessionIPC.latitude:void 0,longitudeFromIpc=sessionIPC?sessionIPC.longitude:void 0,isSessionLocationEnabled=lodash.get(toggleService.model,"toggles.isSessionLocationEnabled",!1);if(latitudeFromIpc&&longitudeFromIpc&&isSessionLocationEnabled){var spatialPoint={lat:latitudeFromIpc,lng:longitudeFromIpc};model.spatialPointLatLng=[latitudeFromIpc,longitudeFromIpc],showCarouselWithMarkers(spatialPoint,!1),model.showSTALink=!1,model.showNYLLink=!1}else isAdobeAllowed&&!isTMOApp&&getAdobeLocation(NYLcta)}var $q=commonServices.$q,$window=commonServices.$window,$filter=commonServices.$filter,model=storeLocatorModelService.model;lodash.get(toggleService.model,"toggles.digitalToRetail",!1),lodash.get(toggleService.model,"toggles.digitalToRetailOnCart",!1);return{pickStore:pickStore,onSearchThisAreaClicked:onSearchThisAreaClicked,onNotYourLocationClicked:onNotYourLocationClicked,onCarouselToggleClicked:onCarouselToggleClicked,loadStoreMarkers:loadStoreMarkers,afterMapLoad:afterMapLoad,
loadCityBubbles:loadCityBubbles,showCarouselWithMarkers:showCarouselWithMarkers}}storeLocatorInitUtilConstructor.$inject=["commonServices","storeLocatorModelService","storeLocatorUtil","mapUtil","geoLocation","mpLocalizationService","toggleService","globalValue","storeLocatorConstants","mapEventHandlerUtil"],angular.module("tmobileApp").factory("storeLocatorInitUtil",storeLocatorInitUtilConstructor)}(window.angular,window._),angular.module("tmobileApp").directive("ngEnter",function(){return function(scope,element,attrs){element.bind("keydown keypress",function(event){13===event.which&&(scope.$apply(function(){scope.$eval(attrs.ngEnter)}),event.preventDefault())})}}),function(angular,lodash,moment){"use strict";function storeLocatorUtilConstructor(commonUtils,commonServices,apiService,storeLocatorModelService,geoLocation,httpRequestWrapper,globalValue,storeLocatorConstants,toggleService,mapUtil,pdlService,productDetailsService,inventoryUtils,mpLocalizationService,digitalToRetailConstant,cartStorage,storeDetailsUtil){function transformV1toV2(storeHours){if(!lodash.isEmpty(storeHours)){var v2Hours=[];return storeHours.forEach(function(hours){var splitString=hours.split(" ");if(hours.contains("-")){var startDay=splitString[0],endDay=splitString[2],openTimeHours="PM"===splitString[4]&&parseInt(splitString[3].split(":")[0],10)<12?parseInt(splitString[3].split(":")[0],10)+12:splitString[3].split(":")[0],openTimeMinutes=splitString[3].split(":")[1],closeTimeHours="PM"===splitString[7]&&parseInt(splitString[6].split(":")[0],10)<12?parseInt(splitString[6].split(":")[0],10)+12:splitString[6].split(":")[0],closeTimeMinutes=splitString[6].split(":")[1],daysArray=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"];daysArray=daysArray.slice(daysArray.indexOf(startDay),daysArray.indexOf(endDay)+1),v2Hours=daysArray.map(function(day){return{day:day,opens:openTimeHours+":"+openTimeMinutes,closes:closeTimeHours+":"+closeTimeMinutes}})}else{var day=splitString[0],openHours="PM"===splitString[2]&&parseInt(splitString[1].split(":")[0],10)<12?parseInt(splitString[1].split(":")[0],10)+12:splitString[1].split(":")[0],openMinutes=splitString[1].split(":")[1],closeHours="PM"===splitString[5]&&parseInt(splitString[4].split(":")[0],10)<12?parseInt(splitString[4].split(":")[0],10)+12:splitString[4].split(":")[0],closeMinutes=splitString[4].split(":")[1],singleDay={day:day,opens:openHours+":"+openMinutes,closes:closeHours+":"+closeMinutes};v2Hours.push(singleDay)}}),v2Hours}}function isEmergencyClosed(emergencyHours){if(!emergencyHours)return!1;for(var emergencyClosed=!0,i=0;i<vm.alldays.length&&(emergencyClosed=emergencyHours.some(function(el){return el.day===vm.alldays[i]&&!el.opens&&!el.closes}),emergencyClosed);i++);return emergencyClosed}function getTodaysHours(store){"National Retail"===store.type&&lodash.get(toggleService.model,"toggles.removeHoursforNRstores",!1)&&(store.holidayHours=null,store.emergencyHours=null,store.standardHours=null,store.npiHours=null);var todaysHours="",dayOfWeekAsInteger=(new Date).getUTCDay(),today=storeLocatorConstants.DAY_OF_WEEKS[dayOfWeekAsInteger],finalDayValue=storeDetailsUtil.getConsolidatedArray(today,store.emergencyHours,store.holidayHours,store.standardHours,store.npiHours);return angular.isDefined(finalDayValue)&&(todaysHours=formatHours(finalDayValue[0])),todaysHours}function formatHours(day){try{var opens=day.formattedOpens,closes=day.formattedCloses;return opens.replace(":00","")+"-"+closes.replace(":00","")}catch(ex){return"Closed"}}function toSentenceCase(inputString){for(var stringArray=inputString.split(" "),index=0;index<stringArray.length;index++)stringArray[index]=stringArray[index].substr(0,1).toUpperCase()+stringArray[index].substr(1).toLowerCase();return stringArray.join(" ")}function hasInStoreAppointment(store){return lodash.includes(vm.model.eligibleStoresForAppointment,store.storeID)}function getReasons(storeId){var urlObject=apiService.getURL("storeLocator.getReasonsForVisitByStoreId");return httpRequestWrapper.get(urlObject.url,{storeId:storeId},null,!0)}function getStoreIDByRange(stores,start,end){return lodash.compact(lodash.map(stores.slice(start-1,end),"id")).join()}function getStoreList(location,startIndex,maxResult,miles,ignoreLoadingBar,storeFilterFlags){var header,url,urlObject,query,distance;return header={"Content-Type":"application/json",Accept:"application/json"},query={latitude:location.lat,longitude:location.lng,count:maxResult,radius:miles,ignoreLoadingBar:ignoreLoadingBar},urlObject=apiService.getURL("storeLocator.search"),url=urlObject.url,httpRequestWrapper.get(url,query,header).then(function(response){return response.data&&response.data.code&&404===response.data.code&&response.data.systemMessage&&"No content found"===response.data.systemMessage?$q.reject(response):(angular.forEach(response.data,function(store){if(store.todayHours=getTodaysHours(store),distance=store.storeDistance,store.storeDistance=distance&&""!==distance&&!isNaN(distance)&&distance.toPrecision?parseFloat(distance.toPrecision(2)):null,store.type=store.type&&"RETAIL"===store.type.toUpperCase()?store.type.toUpperCase():store.type,setStoreTypeLabel(store),store.emergencyHours&&isEmergencyClosed(store.emergencyHours))store.isStoreClosedForEntireWeek=!0,store.isOpenNow=!1;else if("National Retail"===store.type&&lodash.get(toggleService.model,"toggles.removeHoursforNRstores",!1))store.isOpenNow=!1;else{store.isStoreClosedForEntireWeek=!1;for(var localeHours=[],i=0;i<storeLocatorConstants.ALL_DAYS.length;i++){var finalDayValue=storeDetailsUtil.getConsolidatedArray(storeLocatorConstants.ALL_DAYS[i],store.emergencyHours,store.holidayHours,store.standardHours);finalDayValue&&finalDayValue.length&&Array.prototype.push.apply(localeHours,finalDayValue)}store.isOpenNow=isStoreOpenToDisplayWaitTime(localeHours,store.location.utcOffset,!0)}}),$q.resolve(response))})}function fetchData(skuArray,storeIdArray){var deferred=$q.defer();return inventoryUtils.callInventoryAvailabilityAPI(skuArray,storeIdArray).then(function(inventoryData){angular.equals(inventoryData.data.statusCode,"200")&&deferred.resolve(inventoryData.data.result.inventoryAvailabilityList)},function(error){$log.log("Error loading inventory search results: "+error),deferred.reject(error)}),deferred.promise}function setInventoryData(skuArray,storeIdArray){var accessoriesInCart=[];if(vm.toggles.d2rAccessories){var cartObj=cartStorage.getGlobalSmartCartInfo();angular.isDefined(cartObj.accessories.accessoryDetails)&&angular.forEach(cartObj.accessories.accessoryDetails,function(accessory){angular.isDefined(accessory.sku)&&accessoriesInCart.push(accessory)})}var deferred=$q.defer();return fetchData(skuArray,storeIdArray).then(function(storeInventoryData){angular.isDefined(storeInventoryData)&&storeInventoryData.length&&(setInventoryToStoreList(storeInventoryData,accessoriesInCart),deferred.resolve())},function(error){$log.log("Error loading inventory search results: "+error),deferred.reject()}),deferred.promise}function setInventoryToStoreList(storeInventoryData,accessoriesInCart){var cartStorageLines=cartStorage.getGlobalSmartCartInfo(),lines=[];lodash.isEmpty(cartStorageLines)||(lines=lodash.filter(cartStorageLines.lineItems,function(line){return line.isProductAdded})),vm.model.d2rModelManager.storesModelArr=lodash.map(vm.model.d2rModelManager.storesModelArr,function(store){var indexOfMatchedId=getStoreIndex(store,storeInventoryData);if(store.inventoryDetails=[],indexOfMatchedId>-1&&!lodash.isEmpty(storeInventoryData[indexOfMatchedId].skuDetails))if((lines&&lines.length||accessoriesInCart&&accessoriesInCart.length)&&storeInventoryData[indexOfMatchedId].skuDetails.length>1){store.inventoryDetails=lodash.map(lines,function(line){var skuInvDetail=lodash.find(storeInventoryData[indexOfMatchedId].skuDetails,function(skuDetail){return skuDetail.skuId===line.lineItemDetails.deviceDetails.sku})||{};return{availabilityCode:skuInvDetail.availabilityStatus,sku:line.lineItemDetails.deviceDetails.sku,deviceName:line.lineItemDetails.deviceDetails.familyName,lineId:line.lineId}});var inventoryDetailsAccessories=[];inventoryDetailsAccessories=lodash.map(accessoriesInCart,function(accessory){var skuInvDetail=lodash.find(storeInventoryData[indexOfMatchedId].skuDetails,function(skuDetail){return skuDetail.skuId===accessory.sku})||{};return{availabilityCode:skuInvDetail.availabilityStatus,sku:accessory.sku,deviceName:accessory.familyName,lineId:accessory.id}}),store.inventoryDetails=lodash.concat(store.inventoryDetails,inventoryDetailsAccessories),store.availabilityCode=setAvailabilityCodeSummaryInStore(store.inventoryDetails)}else{var skuInvDetail=storeInventoryData[indexOfMatchedId].skuDetails[0]||{};store.inventoryDetails=[{availabilityCode:skuInvDetail.availabilityStatus,sku:skuInvDetail.skuId}],store.availabilityCode=skuInvDetail.availabilityStatus}return store})}function setAvailabilityCodeSummaryInStore(inventoryDetails){var availabilityCode=digitalToRetailConstant.INVENTORY_STATUS_CODE.OUT_OF_STOCK;if(inventoryDetails&&inventoryDetails.length){var invInstock=lodash.every(inventoryDetails,function(inv){return digitalToRetailConstant.INVENTORY_STATUS_CODE.FEW_LEFT===inv.availabilityCode||digitalToRetailConstant.INVENTORY_STATUS_CODE.IN_STOCK===inv.availabilityCode});invInstock&&(availabilityCode=digitalToRetailConstant.INVENTORY_STATUS_CODE.IN_STOCK)}return availabilityCode}function getStoreIndex(store,storeInventoryData){return lodash.findIndex(storeInventoryData,function(storeInventory){return store.id===storeInventory.storeId})}function getUpdatedStoreList(miles,searchInput,autoSearch){var spatialPoint={lat:vm.model.spatialPointLatLng[0],lng:vm.model.spatialPointLatLng[1]};return vm.model.rat=!0,getStoreList(spatialPoint,vm.model.startIndex,vm.model.resultCount,miles,!1).then(function(result){vm.model.clearSearchButton=!0,vm.model.start=1,vm.model.end=result.data.length<vm.model.maxStoreDisplay?result.data.length:vm.model.maxStoreDisplay,vm.model.showSTALink=!1,vm.model.currentPageNumber=1;var storeTypeList=[],storeTypeCount={};if(angular.forEach(result.data,function(store){store.storeShortLabel in storeTypeCount?storeTypeCount[store.storeShortLabel]+=1:(storeTypeCount[store.storeShortLabel]=1,storeTypeList.push({name:store.storeShortLabel}))}),angular.forEach(storeTypeList,function(item){item.result=""+storeTypeCount[item.name]}),searchInput&&pdlService.callPdlClickForSubmitSearch(searchInput,autoSearch,result.data.length),pdlService.setSearchPageLoadEvent(void 0,void 0,storeTypeList),lodash.isEmpty(result.data))return vm.model.rat1=!0,lodash.isEmpty(vm.model.spatialPointLatLng[2])?mapUtil.setMarkers(!1):mapUtil.setViewport(vm.model.spatialPointLatLng[2]),vm.model.expandMileRadiusCount=++vm.model.expandMileRadiusCount,void(vm.model.sectionToDisplay="searchResultView");if(vm.model.sectionToDisplay="searchResultView",vm.model.d2rModelManager?(vm.model.d2rModelManager.setStores(result.data),result.data=vm.model.d2rModelManager.removeNonMagentaStores(result.data)):vm.model.storeList=result.data,vm.model.storeLocatorInModal){var storeIdArray=lodash.map(vm.model.d2rModelManager.storesModelArr,function(obj){return obj.id}),skuArray=vm.model.d2rModelManager.getSKUArr(vm.model.pageType);setInventoryData(skuArray,storeIdArray).then(function(){vm.model.showNext=vm.model.storeList.length>=vm.model.maxStoreDisplay})}vm.model.storeList=lodash.sortBy(vm.model.storeList,["storeDistance"]),vm.model.completeStoreList=result.data,vm.model.showPrev=!1,vm.model.showNext=vm.model.storeList.length>=vm.model.maxStoreDisplay;var offSetValue=$window.innerWidth/2;vm.model.isMobileView?mapUtil.sendOffsets(20,50,20,80):mapUtil.sendOffsets(offSetValue,0,0,0),mapUtil.setMarkers(!0,vm.model.storeList,vm.model.start,vm.model.end),vm.model.zoomEventTriggeredManually=!1,vm.model.showSTALink=!1,vm.model.noStoresFound=!1,vm.model.enablePagination=!0,vm.model.showCarouselUp=!0},function(error){vm.model.sectionToDisplay=views.SEARCH_RESULTS,vm.model.completeStoreList=[],mapUtil.clearMarkers(),$log.log("Error loading search results: "+error)})}function addCustomer(formData){var urlObject=apiService.getURL("storeLocator.queueInLine"),data=formData,headers={"Content-Type":"application/json"};return httpRequestWrapper.post(urlObject.url,data,"",headers,!0)}function getCityList(abbrState){if(lodash.isNil(abbrState))return $q.reject("Abbreviation of state should be defined");if(2!==abbrState.length)return $q.reject("Abbreviation of state should contain only 2 letters");var state=abbrState.toLowerCase(),urlObject=apiService.getURL("storeLocator.stateSearch");if(lodash.isNil(urlObject)||lodash.isNil(urlObject.url))return $q.reject("Global config not found for URL key: storeLocator");var url=urlObject.url,header={Accept:"application/json"},queryParams={state:state};return httpRequestWrapper.get(url,queryParams,header)}function getStoresInCity(stateParm,cityParm){if(lodash.isNil(stateParm))return $q.reject("Abbreviation of state should be defined");if(2!==stateParm.length)return $q.reject("Abbreviation of state should contain only 2 letters");if(lodash.isNil(cityParm))return $q.reject("City should be defined");var state=stateParm.toLowerCase(),city=cityParm.toLowerCase(),urlObject=apiService.getURL("storeLocator.citySearch");if(lodash.isNil(urlObject)||lodash.isNil(urlObject.url))return $q.reject("Global config not found for URL key: storeLocator");var url=urlObject.url,header={Accept:"application/json"},queryParams={state:state,city:city};return httpRequestWrapper.get(url,queryParams,header).then(function(result){return vm.model.enablePagination=!0,vm.model.start=1,vm.model.end=result.data.storeCount<vm.model.maxStoreDisplay?result.data.storeCount:vm.model.maxStoreDisplay,vm.model.showPrev=vm.model.start>vm.model.maxStoreDisplay,vm.model.showNext=vm.model.end<result.data.storeCount,angular.forEach(result.data.storeList,function(store){if(store.type=store.type&&"RETAIL"===store.type.toUpperCase()?store.type.toUpperCase():store.type,setStoreTypeLabel(store),store.emergencyHours&&isEmergencyClosed(store.emergencyHours))store.isStoreClosedForEntireWeek=!0,store.isOpenNow=!1;else{store.isStoreClosedForEntireWeek=!1;for(var localeHours=[],i=0;i<storeLocatorConstants.ALL_DAYS.length;i++){var finalDayValue=storeDetailsUtil.getConsolidatedArray(storeLocatorConstants.ALL_DAYS[i],store.emergencyHours,store.holidayHours,store.standardHours);finalDayValue&&finalDayValue.length&&Array.prototype.push.apply(localeHours,finalDayValue)}store.isOpenNow=isStoreOpenToDisplayWaitTime(localeHours,store.location.utcOffset,!0)}}),$q.resolve(result)})}function initalizePagination(){vm.model.storeList.length>vm.model.end&&(vm.model.showNext=!0)}function getStoreDetails(stateParams){var state=stateParams.state.toLowerCase(),city=stateParams.city.toLowerCase(),store=stateParams.storeName.toLowerCase(),urlObject=apiService.getURL("storeLocator.storeSearch"),url=urlObject.url,header={Accept:"application/json"},queryParams={state:state,city:city,storeName:store,ignoreLoadingBar:vm.model.ignoreLoadingBar};return httpRequestWrapper.get(url,queryParams,header).then(function(result){if(result.data.type=result.data.type&&"RETAIL"===result.data.type.toUpperCase()?result.data.type.toUpperCase():result.data.type,result.data.emergencyHours&&isEmergencyClosed(result.data.emergencyHours))result.data.isStoreClosedForEntireWeek=!0,result.data.isOpenNow=!1;else{result.data.isStoreClosedForEntireWeek=!1;for(var localeHours=[],i=0;i<storeLocatorConstants.ALL_DAYS.length;i++){var finalDayValue=storeDetailsUtil.getConsolidatedArray(storeLocatorConstants.ALL_DAYS[i],result.data.emergencyHours,result.data.holidayHours,result.data.standardHours);finalDayValue&&finalDayValue.length&&Array.prototype.push.apply(localeHours,finalDayValue)}result.data.isOpenNow=isStoreOpenToDisplayWaitTime(localeHours,result.data.location.utcOffset,!0)}return $q.resolve(result)})}function getStoreDetailsById(storeId){var urlObject=apiService.getURL("storeLocator.getStoreById"),url=urlObject.url;url=url.replace("{{storeId}}",storeId);var header={Accept:"application/json"};return httpRequestWrapper.get(url,void 0,header).then(function(result){if(result.data.type=result.data.type&&"RETAIL"===result.data.type.toUpperCase()?result.data.type.toUpperCase():result.data.type,result.data.emergencyHours&&isEmergencyClosed(result.data.emergencyHours))result.data.isStoreClosedForEntireWeek=!0,result.data.isOpenNow=!1;else{result.data.isStoreClosedForEntireWeek=!1;for(var localeHours=[],i=0;i<storeLocatorConstants.ALL_DAYS.length;i++){var finalDayValue=storeDetailsUtil.getConsolidatedArray(storeLocatorConstants.ALL_DAYS[i],result.data.emergencyHours,result.data.holidayHours,result.data.standardHours);finalDayValue&&finalDayValue.length&&Array.prototype.push.apply(localeHours,finalDayValue)}result.data.isOpenNow=isStoreOpenToDisplayWaitTime(localeHours,result.data.location.utcOffset,!0)}return $q.resolve(result)})}function getLocationPath(state,city,store){var indexFound=$location.path().indexOf("/",1),path=$location.path();return-1!==indexFound&&(path=path.substring(0,indexFound)),lodash.isEmpty(state)||(path=lodash.join([path,state],"/"),lodash.isEmpty(city)||(path=lodash.join([path,city],"/"),lodash.isEmpty(store)||(path=lodash.join([path,store],"/")))),path}function getBreadcrumbItems(pState,pCity,pStoreName){var items=[],domain="https://www.t-mobile.com",state=$filter("normalize")(pState),city=$filter("normalize")(pCity),storeName=$filter("normalize")(pStoreName);return items.push({index:0,label:lodash.get(authorValue,"generalAuthoringStores.breadcrumbRootNodeLabel","T-Mobile Stores"),url:lodash.join([domain,getLocationPath()],"")}),lodash.isEmpty(state)||(items.push({index:1,label:angular.uppercase(state),url:lodash.join([domain,getLocationPath(state)],"")}),lodash.isEmpty(city)||(items.push({index:2,label:denormalize(city),url:lodash.join([domain,getLocationPath(state,city)],"")}),lodash.isEmpty(storeName)||items.push({index:3,label:pStoreName,url:lodash.join([domain,getLocationPath(state,city,storeName)],"")}))),items}function denormalize(input){return lodash.isEmpty(input)?"":input.replace("-"," ").replace(/\w\S*/g,function(txt){return txt.charAt(0).toUpperCase()+txt.substr(1).toLowerCase()})}function getCurrentPage(){var currentPage=storeLocatorConstants.PAGES.LANDING;return vm.model.isUserRedirectedFromMail?currentPage=storeLocatorConstants.PAGES.APPTCONFIRMATION:lodash.isEmpty($stateParams.state)||(currentPage=storeLocatorConstants.PAGES.STATE,lodash.isEmpty($stateParams.city)||(currentPage=storeLocatorConstants.PAGES.CITY,lodash.isEmpty($stateParams.storeName)||(currentPage=storeLocatorConstants.PAGES.STORE,lodash.isEmpty($stateParams.operation)||(currentPage=$stateParams.operation===storeLocatorConstants.PAGES.GIL?storeLocatorConstants.PAGES.GIL:storeLocatorConstants.PAGES.ISA)))),currentPage}function showStoreDetail(store,selectedStoreIndex){vm.model.prevUrlStateAndQueryParams=$location.search();var stateParams=$location.path().split("/");return vm.model.prevUrlStateAndQueryParams.state=stateParams[2],vm.model.prevUrlStateAndQueryParams.city=stateParams[3],vm.model.prevUrlStateAndQueryParams.storeName=vm.model.nearByStoreSelected?stateParams[4]:"",$timeout(function(){vm.model.sectionToDisplay=""},0),lodash.isNil(store)||lodash.isEmpty(store)?void $log.error("Invalid data: no data found"):(vm.model.showSearchResultView=vm.model.sectionToDisplay===views.SEARCH_RESULTS||vm.model.sectionToDisplay===views.CITY_RESULTS,vm.model.selectedStoreIndex=selectedStoreIndex,vm.model.showSearchResultView||(vm.model.searchField="",vm.model.clearSearchButton=!1),vm.model.store=store,vm.model.hideCompleteCarousel=!0,vm.model.showSTALink=!1,void $timeout(function(){storeLocatorModelService.showOperationSection($stateParams.operation)},0))}function showStoreAppointmentModel(store,selectedStoreIndex){return lodash.isNil(store)||lodash.isEmpty(store)?void $log.error("Invalid data: no data found"):(vm.model.selectedStoreIndex=selectedStoreIndex,vm.model.store=store,vm.model.hideCompleteCarousel=!0,vm.model.showSTALink=!1,void(vm.model.isUserRedirectedFromMail||storeLocatorModelService.showOperationSection(vm.pages.ISA)))}function setStartAndEndBasedOnPageNumber(pageNumber){vm.model.sectionToDisplay="",vm.model.zoomEventTriggeredManually=!1;var index,pagedStoreList=[];for(index=0;index<vm.model.storeList.length;index+=vm.model.maxStoreDisplay)pagedStoreList.push(vm.model.storeList.slice(index,index+vm.model.maxStoreDisplay));if(pagedStoreList.length<pageNumber)vm.model.currentPageNumber=1,vm.model.end=vm.model.storeList.length<vm.model.maxStoreDisplay?vm.model.storeList.length:vm.model.maxStoreDisplay;else{var storesOnCurrentPage=pagedStoreList[pageNumber-1],startStoreOnCurrentPage=storesOnCurrentPage[0],endStoreOnCurrentPage=storesOnCurrentPage[storesOnCurrentPage.length-1];vm.model.start=vm.model.storeList.indexOf(startStoreOnCurrentPage)+1,vm.model.end=vm.model.storeList.indexOf(endStoreOnCurrentPage)+1,vm.model.currentPageNumber=pageNumber}vm.model.clearSearchButton=!0,vm.model.hideCompleteCarousel=!0,mapUtil.setMarkers(!0,vm.model.storeList,vm.model.start,vm.model.end),vm.model.start>vm.model.maxStoreDisplay&&(vm.model.showPrev=!0),vm.model.showNext=vm.model.end<vm.model.storeList.length}function getUserLocation(){var deferred=$q.defer();return geoLocation.getLocation().then(function(locationData){if(locationData.coords&&locationData.coords.latitude&&locationData.coords.longitude){var location={};location.lat=locationData.coords.latitude,location.lng=locationData.coords.longitude,location.isUserLocationEnabled=locationData.isUserLocationEnabled,deferred.resolve(location)}else deferred.reject("No Location Available");return deferred.promise})}function getInventoryOnChangeLocation(skuArray,store){inventoryUtils.callInventoryAvailabilityAPI(skuArray,store.id).then(function(inventoryResponse){var d2rModels=vm.model.d2rModelManager.models();if(angular.equals(inventoryResponse.data.statusCode,"200")){var result=inventoryResponse.data.result;if(result){var storeParticipation=result.inventoryAvailabilityList[0].storeParticipation,skuDetails=result.inventoryAvailabilityList[0].skuDetails;skuDetails?lodash.forEach(d2rModels,function(model,index){lodash.forEach(skuDetails,function(skuDetail){model.product.sku===skuDetail.skuId&&(storeLocatorModelService.getPDLDataReady(),model.product.inventoryUpdateOnCart(skuDetail),model.getSelectedStore().inventoryUpdateOnCart(skuDetail,model.product.getFamilyId(),storeParticipation))})}):setproductAvailabilityStatus(d2rModels)}else setproductAvailabilityStatus(d2rModels)}else setproductAvailabilityStatus(d2rModels);vm.model.hideContainer=!1},function(error){vm.model.hideContainer=!0,$log.log("Error loading inventory search results: "+error)})}function setproductAvailabilityStatus(d2rModels){lodash.forEach(d2rModels,function(model,index){model.product.setInventoryAvailability(digitalToRetailConstant.INVENTORY_STATUS.INV_UNKNOWN)})}function getStoreIDsFromStoreList(stores){return lodash.map(stores,function(store){return store.id}).join(",")}function isStoreOpenToDisplayWaitTime(hours,utcOffset,isOpenNowLabel){if(moment&&hours&&hours.length>0&&utcOffset){moment.updateLocale("en",{week:{dow:1}});var localTime=moment().utcOffset(utcOffset),todaysHours=hours[localTime.weekday()];if(todaysHours.opens&&todaysHours.closes){var beginningHours=todaysHours.opens.split(":"),beginningTime=moment().utcOffset(utcOffset);beginningTime.hours(beginningHours[0]),beginningTime.minutes(beginningHours[1]);var endHours=todaysHours.closes.split(":"),endTime=moment().utcOffset(utcOffset);return endTime.hours(endHours[0]),endTime.minutes(endHours[1]),isOpenNowLabel||(beginningTime.add("m",15),endTime.subtract("m",15)),localTime.isBetween(beginningTime,endTime)}}return!1}function setStoreTypeLabel(store){lodash.get(toggleService.model,"toggles.experienceStoreTagEnabled",!1)&&"387F"==store.id&&(store.storeTag.includes(storeLocatorConstants.STORE_TAG.EXPERIENCE)?"":store.storeTag.push(storeLocatorConstants.STORE_TAG.EXPERIENCE),store.storeDefinition=storeLocatorConstants.STORE_DEFINITION.FPR);var retailStore=storeLocatorConstants.STORE_TYPE.RETAIL;store&&(store.type===retailStore&&store.storeDefinition===storeLocatorConstants.STORE_DEFINITION.TPR?lodash.get(toggleService.model,"toggles.isSprintStoresEnabled",!1)?store.hasSprintStack&&!store.hasTmobileStack?(vm.isSprintOnlyStore=!0,store.storeShortLabel=store.deviceRepair?storeLocatorConstants.SAR_RC:storeLocatorConstants.SAR,store.storeTypeLabel=store.deviceRepair?authorValue.generalAuthoringStores.sprintAuthorizedRetailRepairStoreTag:authorValue.generalAuthoringStores.sprintAuthorizedRetailStoreTag):store.hasSprintStack&&store.hasTmobileStack?(vm.isDualStore=!0,store.storeShortLabel=store.deviceRepair?storeLocatorConstants.TMAR_RC:storeLocatorConstants.TMAR,store.storeTypeLabel=store.deviceRepair?authorValue.generalAuthoringStores.tmobileSprintAuthorizedRetailRepairStoreTag:authorValue.generalAuthoringStores.tmobileSprintAuthorizedRetailStoreTag):(store.storeShortLabel=store.deviceRepair?storeLocatorConstants.TMAR_RC:storeLocatorConstants.TMAR,store.storeTypeLabel=store.deviceRepair?authorValue.generalAuthoringStores.tprRepairStoreTag:authorValue.generalAuthoringStores.tprStoreTag):(store.storeShortLabel=storeLocatorConstants.TMAR,store.storeTypeLabel=authorValue.generalAuthoringStores.tprStoreTag):store.type===retailStore&&store.storeDefinition===storeLocatorConstants.STORE_DEFINITION.FPR?store.storeTag&&store.storeTag.includes(storeLocatorConstants.STORE_TAG.SIGNATURE)&&!store.storeTag.includes(storeLocatorConstants.STORE_TAG.EXPERIENCE)?(store.storeShortLabel=store.deviceRepair?storeLocatorConstants.TMSS_RC:storeLocatorConstants.TMSS,store.storeTypeLabel=store.deviceRepair?authorValue.generalAuthoringStores.tmobileRepairSignatureStoreTag:authorValue.generalAuthoringStores.tmobileSignatureStoreTag):lodash.get(toggleService.model,"toggles.experienceStoreTagEnabled",!1)&&store.storeTag&&store.storeTag.includes(storeLocatorConstants.STORE_TAG.EXPERIENCE)?(store.storeShortLabel=store.deviceRepair?storeLocatorConstants.TMES_RC:storeLocatorConstants.TMES,store.storeTypeLabel=store.deviceRepair?authorValue.generalAuthoringStores.tmobileRepairExperienceStore:authorValue.generalAuthoringStores.tmobileExperienceStore):lodash.get(toggleService.model,"toggles.isSprintStoresEnabled",!1)?store.hasSprintStack&&!store.hasTmobileStack?(vm.isSprintOnlyStore=!0,store.storeShortLabel=storeLocatorConstants.SS,store.storeTypeLabel=store.deviceRepair?authorValue.generalAuthoringStores.sprintRetailRepairStoreTag:authorValue.generalAuthoringStores.sprintRetailStoreTag):store.hasSprintStack&&store.hasTmobileStack?(vm.isDualStore=!0,store.storeShortLabel=store.deviceRepair?storeLocatorConstants.TMS_RC:storeLocatorConstants.TMS,store.storeTypeLabel=store.deviceRepair?authorValue.generalAuthoringStores.tmobileSprintRetailRepairStoreTag:authorValue.generalAuthoringStores.tmobileSprintRetailStoreTag):(store.storeShortLabel=store.deviceRepair?storeLocatorConstants.TMS_RC:storeLocatorConstants.TMS,store.storeTypeLabel=store.deviceRepair?authorValue.generalAuthoringStores.tmobileRepairStoreTag:authorValue.generalAuthoringStores.tmobileStoreTag):(store.storeShortLabel=storeLocatorConstants.TMS,store.storeTypeLabel=authorValue.generalAuthoringStores.tmobileStoreTag):store.type!==retailStore&&(store.storeShortLabel=storeLocatorConstants.TMAD,store.storeTypeLabel=authorValue.generalAuthoringStores.authDealerTag))}function sortStoresByType(stores,sortOption){var expSigStores=[],tmoStores=[],dealerStores=[],expSigStoresIndex=0,tmoStoresIndex=0,dealerStoresIndex=0,distanceLimitForFeatureStore=10;if(null!=authorValue.generalAuthoringStores.numberOfMilesForFeatured&&(distanceLimitForFeatureStore=parseFloat(authorValue.generalAuthoringStores.numberOfMilesForFeatured)),void 0!==sortOption&&"Distance"===sortOption){stores.forEach(function(store){delete store.expStoreTypeIndex,delete store.tmoStoreTypeIndex,delete store.dealerStoreTypeIndex,("TMES"===store.storeShortLabel||"TMES(RC)"===store.storeShortLabel||"TMSS"===store.storeShortLabel||"TMSS(RC)"===store.storeShortLabel)&&parseFloat(store.storeDistance)<=distanceLimitForFeatureStore?(store.expStoreTypeIndex=expSigStoresIndex,expSigStores.push(store),expSigStoresIndex++):tmoStores.push(store)});var storesList=expSigStores.concat(lodash.sortBy(tmoStores,["storeDistance"]))}else{stores.forEach(function(store){("TMES"===store.storeShortLabel||"TMES(RC)"===store.storeShortLabel||"TMSS"===store.storeShortLabel||"TMSS(RC)"===store.storeShortLabel)&&parseFloat(store.storeDistance)<=distanceLimitForFeatureStore?(store.expStoreTypeIndex=expSigStoresIndex,expSigStores.push(store),expSigStoresIndex++):"TMS"===store.storeShortLabel||"TMS(RC)"===store.storeShortLabel?(store.tmoStoreTypeIndex=tmoStoresIndex,tmoStores.push(store),tmoStoresIndex++):("TMAR"===store.storeShortLabel||"TMAR(RC)"===store.storeShortLabel||"TMAD"===store.storeShortLabel||"SS"===store.storeShortLabel)&&(store.dealerStoreTypeIndex=dealerStoresIndex,dealerStores.push(store),dealerStoresIndex++)});var storesList=expSigStores.concat(tmoStores,dealerStores)}return storesList}var vm=this,authorValue=globalValue.authorValue.storeauthoring,$q=(commonServices.$http,commonServices.$q),$window=commonServices.$window,$filter=commonServices.$filter,$location=commonServices.$location,$log=commonServices.$log,$stateParams=commonServices.$stateParams,$timeout=commonServices.$timeout,views=(storeLocatorConstants.IN_STORE_APPOINTMENT_TIME,storeLocatorConstants.SECTIONS);lodash.get(globalValue.authorValue.storeauthoring,"appointmentsAndWaitTime.waitTimeInfoText");return vm.model=storeLocatorModelService.model,vm.toggles=toggleService.model.toggles,vm.pages=storeLocatorConstants.PAGES,vm.alldays=storeLocatorConstants.ALL_DAYS,vm.isSprintOnlyStore=!1,vm.isDualStore=!1,{setAvailabilityCodeSummaryInStore:setAvailabilityCodeSummaryInStore,setInventoryToStoreList:setInventoryToStoreList,transformV1toV2:transformV1toV2,hasInStoreAppointment:hasInStoreAppointment,getStoreList:getStoreList,getReasons:getReasons,addCustomer:addCustomer,toSentenceCase:toSentenceCase,getCityList:getCityList,getStoresInCity:getStoresInCity,getStoreDetails:getStoreDetails,getStoreDetailsById:getStoreDetailsById,getBreadcrumbItems:getBreadcrumbItems,denormalize:denormalize,getLocationPath:getLocationPath,getCurrentPage:getCurrentPage,getTodaysHours:getTodaysHours,getUpdatedStoreList:getUpdatedStoreList,showStoreDetail:showStoreDetail,showStoreAppointmentModel:showStoreAppointmentModel,setStartAndEndBasedOnPageNumber:setStartAndEndBasedOnPageNumber,getUserLocation:getUserLocation,initalizePagination:initalizePagination,getStoreIDByRange:getStoreIDByRange,setInventoryData:setInventoryData,getInventoryOnChangeLocation:getInventoryOnChangeLocation,getStoreIDsFromStoreList:getStoreIDsFromStoreList,isStoreOpenToDisplayWaitTime:isStoreOpenToDisplayWaitTime,isEmergencyClosed:isEmergencyClosed,setStoreTypeLabel:setStoreTypeLabel,sortStoresByType:sortStoresByType}}storeLocatorUtilConstructor.$inject=["commonUtils","commonServices","apiService","storeLocatorModelService","geoLocation","httpRequestWrapper","globalValue","storeLocatorConstants","toggleService","mapUtil","pdlService","productDetailsService","inventoryUtils","mpLocalizationService","digitalToRetailConstant","cartStorage","storeDetailsUtil"],angular.module("tmobileApp").factory("storeLocatorUtil",storeLocatorUtilConstructor)}(window.angular,window._,window.moment),function(angular,lodash){"use strict";function extantCartConstructor($stateParams,$state,extantCartService,authTokenManager,cartCommonOperationsService,cartStorage,creditClassService,tmobNotificationService,globalValue,CART_STATE_NAME){function init(){var type,cartId,token;if($stateParams.type&&$stateParams.id)if(type=$stateParams.type,vm.message=lodash.get(vm.keyValues[type],"cartSuccess","Please wait while we fetch your cart details!"),
"AB"===type)$stateParams.key?(cartId=$stateParams.id,token=$stateParams.key,cartStorage.setCartId(cartId),authTokenManager.setTokenCookies({access_token:token}),extantCartService.getCartData(cartId,token).then(function(responseData){angular.equals(responseData.status,200)?tmobNotificationService.isAbLoaded=!0:(vm.message=lodash.get(vm.keyValues[type],"cartFailed","Something went wrong! We're taking you to an empty cart."),cartStorage.setCartId(void 0),authTokenManager.setTokenCookies(void 0),creditClassService.setCreditClass(void 0)),$state.go(CART_STATE_NAME)})):(vm.message=lodash.get(vm.keyValues[type],"cartFailed","Something went wrong! We're taking you to an empty cart."),$state.go(CART_STATE_NAME));else if("SC"===type){cartId=cartStorage.getCartId(),cartCommonOperationsService.model.ispfcart=!0;var loadCartId=$stateParams.id;if(vm.cartId=cartId,vm.loadCartId=loadCartId,""!==loadCartId&&angular.isUndefined(cartId)||""!==loadCartId&&"true"===sessionStorage.getItem("preConfiguredModalDisplayed"))sessionStorage.removeItem("preConfiguredModalDisplayed"),extantCartService.addConfigCart(cartId,loadCartId).then(function(responseData){angular.equals(responseData.status,200)||angular.equals(responseData.status,201)?cartCommonOperationsService.isDeeplinkFlow=!0:vm.message=lodash.get(vm.keyValues[type],"cartFailed","Something went wrong! We're taking you to an empty cart."),$state.go(CART_STATE_NAME)});else if(""!==loadCartId&&""!==cartId){var modalData={errorHeader:vm.globalValue.authorValue.rootPage.preConfiguredCart.modalHeader,errorBody:vm.globalValue.authorValue.rootPage.preConfiguredCart.modalBody,failureCTA:vm.globalValue.authorValue.rootPage.preConfiguredCart.noBtn,successCTA:vm.globalValue.authorValue.rootPage.preConfiguredCart.yesBtn,enableCTA:!0,cartId:cartId,loadCartId:loadCartId,cartFailedMessage:lodash.get(vm.keyValues[type],"cartFailed","Something went wrong! We're taking you to an empty cart."),successMethod:"preConfigureAddOfferToCart",failureMethod:"preConfigureGoToExistingCart",disableBackdrop:!0};cartCommonOperationsService.openAlertMessageModal(modalData)}else vm.message=lodash.get(vm.keyValues[type],"cartFailed","Something went wrong! We're taking you to an empty cart."),$state.go(CART_STATE_NAME)}else if("BOT"===type){var productType=["HANDSET","TABLET"];$stateParams.psId&&$stateParams.fbId&&"CART"===$stateParams.key.toUpperCase()?(cartId=cartStorage.getCartId(),loadCartId=$stateParams.id,vm.cartId=cartId,vm.loadCartId=loadCartId,extantCartService.addConfigCart(cartId,loadCartId).then(function(responseData){angular.equals(responseData.status,200)?(cartStorage.setFbSessionId($stateParams.fbId),cartStorage.setPsSessionId($stateParams.psId)):vm.message=lodash.get(vm.keyValues[type],"cartFailed","Something went wrong! We're taking you to an empty cart."),$state.go(CART_STATE_NAME)})):$stateParams.psId&&$stateParams.fbId&&productType.indexOf($stateParams.key.toUpperCase())>-1?extantCartService.addProductToLine($stateParams.key.toUpperCase(),$stateParams.id).then(function(status){if(angular.equals(status,200)){cartStorage.setFbSessionId($stateParams.fbId),cartStorage.setPsSessionId($stateParams.psId);var creditSelector=globalValue.authorValue.cart.creditSelector["class"],creditClassObject=_.find(creditSelector,{"class":"creditClass1"});creditClassService.setCreditClass(creditClassObject)}else vm.message=lodash.get(vm.keyValues[type],"cartFailed","Something went wrong! We're taking you to an empty cart.");$state.go(CART_STATE_NAME)}):(vm.message=lodash.get(vm.keyValues[type],"cartFailed","Something went wrong! We're taking you to an empty cart."),$state.go(CART_STATE_NAME))}else vm.message=lodash.get(vm.keyValues[type],"cartFailed","Something went wrong! We're taking you to an empty cart."),$state.go(CART_STATE_NAME);else vm.message=lodash.get(vm.keyValues[$stateParams.type],"cartFailed","Something went wrong! We're taking you to an empty cart."),$state.go(CART_STATE_NAME)}var vm=this;vm.keyValues=lodash.get(globalValue,"authorValue.cart.extantCart"),vm.cartCommonOperationsService=cartCommonOperationsService,vm.globalValue=globalValue,init()}extantCartConstructor.$inject=["$stateParams","$state","extantCartService","authTokenManager","cartCommonOperationsService","cartStorage","creditClassService","tmobNotificationService","globalValue","CART_STATE_NAME"],angular.module("tmobileApp").controller("extantCartCtrl",extantCartConstructor)}(window.angular,window._),function(angular){"use strict";var lazyThirdPartyScript={bindings:{thirdPartyScripts:"<"},controller:"lazyThirdPartyScriptController",controllerAs:"vm"};angular.module("marketingCore").component("lazyThirdPartyScript",lazyThirdPartyScript)}(window.angular),function(angular){"use strict";var articleCardGridComponent={templateUrl:"app/marketing/components/articleCardGrid/articleCardGrid.component.tpl.html",bindings:{articles:"<"},controllerAs:"vm"};angular.module("marketingCore").component("articleCardGrid",articleCardGridComponent)}(angular),function(angular){"use strict";function lazyThirdPartyScriptControllerConstructor($window,$log){function init(){vm.thirdPartyScripts&&$window.addEventListener("load",function(){try{for(var code,scriptContainer=$window.document.getElementsByTagName("lazy-third-party-script")[0],i=0;i<vm.thirdPartyScripts.formData.length;i++){code=vm.thirdPartyScripts.formData[i].scriptDetail,code=code.replace(/(?:\r\n|\r|\n)/g,""),code=code.replace(/&~&/g,"'");var fragment=$window.document.createRange().createContextualFragment(code);scriptContainer.appendChild(fragment)}}catch(err){$log.log("lazyThirdPartyScript :: Error occurred while lazy loading third party scripts",err)}})}var vm=this;init()}lazyThirdPartyScriptControllerConstructor.$inject=["$window","$log"],angular.module("marketingCore").controller("lazyThirdPartyScriptController",lazyThirdPartyScriptControllerConstructor)}(window.angular),function(angular){"use strict";var ibaOptOutComponent={templateUrl:"app/marketing/components/ibaOptOut/ibaOptOut.tpl.html",controller:"ibaOptOutController",controllerAs:"vm",bindings:{authorValue:"<"}};angular.module("marketingCore").component("ibaOptOut",ibaOptOutComponent)}(window.angular),function(angular){"use strict";function thirdPartyScriptComponentControllerConstructor(thirdPartyScriptService){function addRow(){vm.data.formData.push({scriptName:"",scriptDetail:""})}function saveData(){thirdPartyScriptService.postthirdPartyScriptData(vm.data).then(function(){},function(){})}function deleteItem(index){vm.data.formData.splice(index,1)}function init(){if(vm.data=angular.merge(_DEFAULT_FORM_DATA,vm.thirdPartyScriptData||{}),vm.data.formData)for(var z=0;z<vm.data.formData.length;z++)vm.data.formData[z].scriptDetail=vm.data.formData[z].scriptDetail.replace(/&~&/g,'"')}var vm=this,_DEFAULT_FORM_DATA={formData:[]};vm.addRow=addRow,vm.saveData=saveData,vm.deleteItem=deleteItem,init()}thirdPartyScriptComponentControllerConstructor.$inject=["thirdPartyScriptService"],angular.module("tmobileApp").controller("thirdPartyScriptComponentController",thirdPartyScriptComponentControllerConstructor)}(window.angular),function(angular){"use strict";function takeoverBenefitsCard($element,$window,$scope,$timeout,$sce,$document,utils,analyticsUtils){var vm=this;vm.modalLegal=""!==vm.settings.modalLegal&&""!==vm.settings.modalLegalAriaLabel&&""!==vm.settings.modalLegalCtaText,this.$onInit=function(){utils.getClosest($element[0],".takeover-modal-container")||$element.children()[0].classList.add("takeover-benefits-card-library-section")},$scope.$on("modalOpen",function(){$window.addEventListener("resize",_.throttle(vm.adjustBgImgGuideLines,100)),$timeout(function(){vm.adjustBgImgGuideLines()},450)}),$scope.$on("modalClosed",function(){$window.removeEventListener("resize",_.throttle(vm.adjustBgImgGuideLines,100))}),$scope.$on("takeover-modal-translate",function(){vm.adjustBgImgGuideLines()}),$element.on("click","button[data-analytics-id], a[data-analytics-id], [role=button][data-analytics-id]",function(e){analyticsUtils.trackActionableElementClick(e.currentTarget,utils.getPageReach(angular.element($window),angular.element("html")))}),vm.adjustBgImgGuideLines=function(){var sectionContent=$element[0].querySelector(".section-content"),pictureContainer=$element[0].querySelector(".picture-container"),bgImgGuideLines=$element[0].querySelectorAll(".bg-img-guide-line");if(sectionContent&&pictureContainer){const margin=36,height=(pictureContainer.clientHeight-sectionContent.clientHeight)/2-margin;bgImgGuideLines[0].setAttribute("style","height:"+Math.max(height,0)+"px"),bgImgGuideLines[1].setAttribute("style","height:"+Math.max(height,0)+"px")}},vm.onLegalModalOpen=function(){$document[0].querySelector(".modal-backdrop").classList.remove("takeover-modal-backdrop")},vm.trustHtml=function(value){return $sce.trustAsHtml(value)}}var takeoverBenefitsCardComponent={templateUrl:"app/marketing/components/takeoverBenefitsCard/takeoverBenefitsCard.component.tpl.html",controller:takeoverBenefitsCard,bindings:{settings:"<"},controllerAs:"vm"};angular.module("marketingCore").component("takeoverBenefitsCard",takeoverBenefitsCardComponent)}(angular),function(angular){"use strict";var thirdPartyScriptComponent={bindings:{thirdPartyScriptData:"<"},controller:"thirdPartyScriptComponentController",controllerAs:"vm",templateUrl:"app/thirdPartyScript/component/thirdPartyScript.component.html"};angular.module("tmobileApp").component("thirdPartyScriptComponent",thirdPartyScriptComponent)}(angular),function(angular){"use strict";function DealSignUpController($scope,$window,$cookies,$log,selligentUtils){function onInit(data,analyticsID,options){vm.lang=$cookies.get("MP_LANG")||"en",vm.authToken=data.authToken,vm.analyticsID=analyticsID,vm.eventOptions=options,vm.formData.optinText=data.optInText,vm.formData.project=data.project,vm.formData.manufacturer=data.manufacturer,vm.formData.codename=data.codename,vm.formData.optin=data.optinDefault,vm.formData.currentCustomer="",vm.selligentData=data.selligentData,vm.ppr.serverError=!1}function update(){$scope.$broadcast("update_carrier")}function submit(isValid){vm.submitted=!0,isValid?"eventRouter"===vm.eventOptions.type?createEventRouterPayload():"both"===vm.eventOptions.type?(createEventRouterPayload(),createSelligentPayload()):createSelligentPayload():$scope.$broadcast("valid",!1)}function onSuccessSelligent(response){$scope.$broadcast("valid",!0),vm.response=response.data,vm.dealsSignUpForm.$setPristine(),vm.dealsSignUpForm.$setUntouched(),vm.formData={}}function onErrorSelligent(response){vm.serverError=!0,$log.error("error selligent call",response),$scope.$broadcast("valid",!1)}function createEventRouterPayload(){var locationUrl=$window.location.href,index=locationUrl.indexOf("?"),noQueryLocationUrl=locationUrl;-1!==index&&(noQueryLocationUrl=locationUrl.slice(0,index));var time=(new Date).toISOString(),eventRouterPayload={leadb2cmktEvents:[{middleName:"Not Applicable",birthDate:"Not Applicable",prefix:"Not Applicable",selectedCreditClass:"Not Applicable",currentCarrier:"Not Applicable",currentNumberOfLines:"Not Applicable",interestedNumberOfLines:"Not Applicable",interestedAccessories:"Not Applicable",interestedDevice:"Not Applicable",address1:"Not Applicable",address2:"Not Applicable",city:"Not Applicable",country:"Not Applicable",state:"Not Applicable",addressType:"Not Applicable",languagePreference:"Not Applicable",contactPreferenceMail:"Not Applicable",contactPreferenceEmail:"Not Applicable",contactPreferenceCall:"Not Applicable",contactPreferenceSms:"Not Applicable",source:"Web",webformUrl:noQueryLocationUrl,webformSubmissionTime:time,webformName:vm.formData.project,webformLanguage:vm.lang,testIndicator:vm.selligentData.testIndicator===!1?"N":"Y",firstName:$scope.formData.firstName?$scope.formData.firstName:"",lastName:$scope.formData.lastName?$scope.formData.lastName:"",existingCustomerFlag:0===parseInt($scope.formData.currentCustomer,10)?"N":"Y",primaryEmailAddress:$scope.formData.email,primaryPhoneNumber:$scope.formData.phone?""+$scope.formData.phone:"Not Applicable",zipcode:$scope.formData.zip?""+$scope.formData.zip:"Not Applicable",marketingCommunicationOptIn:0===angular.fromJson(vm.formData.optin)?"N":"Y",audience:"Consumer",destination:"CRM",recordId:UUIDjs.create(4).toString(),keys:[]}]};angular.forEach(vm.formData.custom,function(value,key){eventRouterPayload.leadb2cmktEvents[0].keys.push({name:key,value:value})}),selligentUtils.createSelligentLead(vm.authToken,eventRouterPayload,"eventRouter",vm.eventOptions.urlEventRouter).then(onSuccessSelligent,onErrorSelligent)}function createSelligentPayload(){var locationUrl=$window.location.href,noQueryLocationUrl=locationUrl.slice(0,locationUrl.indexOf("?")),sellPayload={config:"prereg",operation:vm.selligentData.operation,userData:{Mail:$scope.formData.email,PHONE_NUMBER:$scope.formData.phone?""+$scope.formData.phone.replace(/[- .●)(]/g,""):"",ZIP:$scope.formData.zip?""+$scope.formData.zip:"",FIRST_NAME:$scope.formData.firstName?$scope.formData.firstName:"",NAME:$scope.formData.lastName?$scope.formData.lastName:"",CUSTOMER:angular.fromJson($scope.formData.currentCustomer),LANGUAGE:vm.lang,SUBSCRIBE_SOURCE:"Web"},triggerData:{},campaignData:{ACTIONID:"13",ACTIONCODE:"PREREG",PROJECT:vm.formData.project,MANUFACTURER:vm.formData.manufacturer,CODENAME:vm.formData.codename,OPTINTOMAINMARKETINGMAILS:angular.fromJson(vm.formData.optin),TEXT_OF_OPTIN_AGRMT:vm.formData.optinText,LEAD_CAPTURE_LOCATION:noQueryLocationUrl,MARKETING_PROGRAM:"Consumer"}};angular.forEach(vm.formData.custom,function(value,key){sellPayload.campaignData[key]=value}),_.merge(sellPayload.triggerData,vm.selligentData.triggerData),_.merge(sellPayload.campaignData,vm.selligentData.campaignData),selligentUtils.createSelligentLead(vm.authToken,sellPayload,"selligent",vm.eventOptions.urlSelligent).then(onSuccessSelligent,onErrorSelligent)}var vm=this;vm.formData={},vm.selligentData={},vm.ppr={},vm.formData.custom={},vm.onInit=onInit,vm.update=update,vm.submit=submit}DealSignUpController.$inject=["$scope","$window","$cookies","$log","selligentUtils"],angular.module("marketingCore").controller("DealSignUpController",DealSignUpController)}(window.angular),function(angular){"use strict";function thirdPartyScriptControllerConstructor(){}angular.module("tmobileApp").controller("thirdPartyScriptController",thirdPartyScriptControllerConstructor)}(angular),function(angular){"use strict";function ProductTileController(analyticsUtils){function onInit(analyticsID){vm.analyticsID=analyticsID}function sendCTAClick(e,data){e.stopPropagation(),analyticsUtils.trackEvent("CLICK_EVENT",vm.analyticsID,{eventInfo:{eventAction:"click",eventType:"clickToNavigate"},eventDescription:{icid:data.icid,ctaName:data.ctaName,targetUrl:data.targetUrl,dataAnalyticsID:data.analyticsID}})}var vm=this;vm.onInit=onInit,vm.sendCTAClick=sendCTAClick}ProductTileController.$inject=["analyticsUtils"],angular.module("marketingCore").controller("ProductTileController",ProductTileController)}(angular),function(angular,externalLogger){"use strict";function configureRouter($stateProvider,APP_ROOT_STATE_NAME){externalLogger.moduleConfigured("tmobileApp","thirdPartyScript.js"),$stateProvider.state("root.thirdPartyScript",{parent:APP_ROOT_STATE_NAME,url:"/thirdPartyScript",views:{main:{templateUrl:"/app/thirdPartyScript/thirdPartyScript.tpl.html",controller:"thirdPartyScriptController as vm"}}})}configureRouter.$inject=["$stateProvider","APP_ROOT_STATE_NAME"],angular.module("tmobileApp").config(configureRouter)}(angular,externalLogger),function(angular){"use strict";function captureFocus(){return{restrict:"A",link:function(scope,element,attrs){scope.$watch(attrs.captureFocus,function(value){value===!0&&(element[0].focus(),scope[attrs.captureFocus]=!1)})}}}angular.module("marketingCore").directive("captureFocus",captureFocus)}(angular),function(angular){"use strict";function thirdPartyScriptServiceConstructor(httpRequest){function postthirdPartyScriptData(response){for(var data=angular.copy(response),url="srvspub/thirdPartyScript",z=0;z<data.formData.length;z++)data.formData[z].scriptDetail=data.formData[z].scriptDetail.replace(/(?:\r\n|\r|\n)/g,""),data.formData[z].scriptDetail=data.formData[z].scriptDetail.replace(/["]/g,"&~&");return httpRequest.post(url,data)}return{postthirdPartyScriptData:postthirdPartyScriptData}}thirdPartyScriptServiceConstructor.$inject=["httpRequest"],angular.module("tmobileApp").service("thirdPartyScriptService",thirdPartyScriptServiceConstructor)}(angular),function(angular,lodash){"use strict";function fraudQuestionModalController($modalInstance,authorValues,modalDialogFactory,fraudCheckModelService,cartHttpDataService,checkOutConstants,tokenUtils,$log,checkOutHttpDataUtil){function close(){$modalInstance.close(),modalDialogFactory.openCancelCtaModal()}function submit(){var getPoPTokenParameters=fraudCheckModelService.getPoPTokenParameters("continueConversation");angular.isDefined(getPoPTokenParameters)&&getPoPTokenParameters.authToken&&getPoPTokenParameters.request&&tokenUtils.generatePoPToken(getPoPTokenParameters.authToken,getPoPTokenParameters.request).then(function(token){fraudCheckModelService.token=token,vm.continueConversation()})["catch"](function(popTokenGenerationError){$log.error("something went wrong while generating pop token",popTokenGenerationError)})}function initializeFraudQuestion(){var getPoPTokenParameters=fraudCheckModelService.getPoPTokenParameters("initiateConversation");angular.isDefined(getPoPTokenParameters)&&getPoPTokenParameters.authToken&&getPoPTokenParameters.request&&tokenUtils.generatePoPToken(getPoPTokenParameters.authToken,getPoPTokenParameters.request).then(function(token){fraudCheckModelService.token=token,vm.initiateConversation()})["catch"](function(popTokenGenerationError){$log.error("something went wrong while generating pop token",popTokenGenerationError)})}function initiateConversation(){var payload=fraudCheckModelService.createPayloadForInitiateConversation();lodash.isEmpty(payload)||cartHttpDataService.initiateConversation(payload).then(function(initiateConversationResponse){angular.equals(checkOutConstants.HTTP_CODES.STATUS_SUCCESS,initiateConversationResponse.status)&&angular.equals(checkOutConstants.FRAUD_QUESTION_RESPONSE.PENDING,initiateConversationResponse.data.status.transactionStatus)?(fraudCheckModelService.model.fraudCheck.conversationResponse=initiateConversationResponse.data,vm.reviewQuestions=fraudCheckModelService.getReviewOuestions()):angular.equals(checkOutConstants.HTTP_CODES.STATUS_SUCCESS,initiateConversationResponse.status)&&angular.equals(checkOutConstants.FRAUD_QUESTION_RESPONSE.FAILED,initiateConversationResponse.data.status.transactionStatus)?($modalInstance.close(),checkOutHttpDataUtil.cancelOrder().then(function(){modalDialogFactory.openFraudCheckRejectModal()})["catch"](function(cancelOrderError){$log.error("something went wrong while cancelling order",cancelOrderError)})):($modalInstance.close(),modalDialogFactory.openFraudCheckTimeoutModal())})["catch"](function(initiateConverstaionError){$log.error("something went wrong while calling Initiate converstaion",initiateConverstaionError)})}function continueConversation(){var payload=fraudCheckModelService.createPayloadForContinueConversation(vm.optionsRadio);lodash.isEmpty(payload)||cartHttpDataService.continueConversation(payload).then(function(continueConversationResponse){angular.equals(checkOutConstants.HTTP_CODES.STATUS_SUCCESS,continueConversationResponse.status)&&angular.equals(checkOutConstants.FRAUD_QUESTION_RESPONSE.PENDING,continueConversationResponse.data.status.transactionStatus)?(fraudCheckModelService.model.fraudCheck.conversationResponse=continueConversationResponse.data,vm.questionNumber+=1,vm.showQuestionNumber=vm.questionNumber+".",vm.submitDisabled=!0,vm.reviewQuestions=fraudCheckModelService.getReviewOuestions()):angular.equals(checkOutConstants.HTTP_CODES.STATUS_SUCCESS,continueConversationResponse.status)&&angular.equals(checkOutConstants.FRAUD_QUESTION_RESPONSE.PASSED,continueConversationResponse.data.status.transactionStatus)?($modalInstance.close(),fraudCheckModelService.redirectToReviewPage(continueConversationResponse)):angular.equals(checkOutConstants.HTTP_CODES.STATUS_SUCCESS,continueConversationResponse.status)&&angular.equals(checkOutConstants.FRAUD_QUESTION_RESPONSE.FAILED,continueConversationResponse.data.status.transactionStatus)?($modalInstance.close(),checkOutHttpDataUtil.cancelOrder().then(function(){modalDialogFactory.openFraudCheckRejectModal()})["catch"](function(cancelOrderError){$log.error("something went wrong while while cancelling order",cancelOrderError)})):($modalInstance.close(),modalDialogFactory.openFraudCheckTimeoutModal())})["catch"](function(continueError){$log.error("something went wrong while calling continue converstaion",continueError)})}var vm=this;vm.submitDisabled=!0,vm.optionsRadio="",vm.showQuestionNumber="1.",vm.reviewQuestions="",vm.questionNumber=1,vm.radioChanged=function(){vm.submitDisabled=!1},vm.fraudQuestionModal=lodash.get(authorValues,"checkout.fraudCheck",{}),vm.close=close,vm.continueConversation=continueConversation,vm.submit=submit,vm.initiateConversation=initiateConversation,vm.initializeFraudQuestion=initializeFraudQuestion,vm.initializeFraudQuestion()}fraudQuestionModalController.$inject=["$modalInstance","authorValues","modalDialogFactory","fraudCheckModelService","cartHttpDataService","checkOutConstants","tokenUtils","$log","checkOutHttpDataUtil"],angular.module("tmobileApp").controller("fraudQuestionModalController",fraudQuestionModalController)}(window.angular,window._),function(angular){"use strict";function portOutPinController(globalValue,checkOutModelService){var vm=this;vm.authorValue=globalValue.authorValue.checkout.paymentAndCreditCheck,vm.icons=globalValue.authorValue.checkout.icons,vm.checkOutInfo=checkOutModelService.model.checkOutInfo}portOutPinController.$inject=["globalValue","checkOutModelService"],angular.module("tmobileApp").controller("PortOutPinController",portOutPinController)}(window.angular),function(angular){"use strict";function upperFunnelControllerConstructor($log,toggleService,universalMenuDataService,unavMenuService,contactFormDataService){function loadNavJs(){var toggles=toggleService.model.toggles;return vm.enableModernizedUNAV=toggles.enableModernizedUNAV,vm.enableModernizedUNAV?(vm.isOsNav||universalMenuDataService.unavData(),void contactFormDataService.getContactFormData()):unavMenuService.getUnavMenuData()}$log.log("Upper Funnel Controller is initializing...");var vm=this;vm.isOsNav=universalMenuDataService.isOsNav(),loadNavJs()}upperFunnelControllerConstructor.$inject=["$log","toggleService","universalMenuDataService","unavMenuService","contactFormDataService"],angular.module("tmobileCore").controller("UpperFunnelController",upperFunnelControllerConstructor)}(angular),function(angular){"use strict";function keyValuesUtilitiesFn(cartHttpDataService,$q,$log,globalConfig){function getKeyValuePairs(){var promise;if(keyValuePairs||globalConfig.authorValueFlagEnable){var deffered=$q.defer();promise=deffered.promise,deffered.resolve(angular.copy(keyValuePairs))}else promise=cartHttpDataService.getKeyValuePairs().then(function(response){return 200===response.status?(keyValuePairs=response.data,$log.log("keyValuePairs",keyValuePairs),angular.copy(keyValuePairs)):void 0},function(error){$log.log("Error getting the keyValuePairs from API")});return promise}var keyValuePairs;return{getKeyValuePairs:getKeyValuePairs}}keyValuesUtilitiesFn.$inject=["cartHttpDataService","$q","$log","globalConfig"],angular.module("tmobileApp").factory("keyValuesUtilities",keyValuesUtilitiesFn)}(angular),function(angular){"use strict";function cartCounterConstructor($compile,$timeout,cartStorage,toggleService){return{restrict:"A",link:function(scope,element,attrs){if(cartStorage.getGlobalSmartCartInfo()){var ItemsAdd=cartStorage.getGlobalSmartCartInfo(),DeviceCount=0,AccCount=0;if(ItemsAdd){var AccAdded=ItemsAdd.accessories.accessoryDetails;angular.forEach(AccAdded,function(value,index){var qty=value.quantity;AccCount+=qty});var DvcAdded=ItemsAdd.lineItems;angular.forEach(DvcAdded,function(value,index){(value.simKitDetails.isBYODAdded||value.lineItemDetails.deviceDetails.isHandset||value.lineItemDetails.deviceDetails.isTablet||value.lineItemDetails.deviceDetails.isWearable)&&(DeviceCount+=1)})}var totalItems=AccCount+DeviceCount;if(0==totalItems&&DvcAdded.length>0)angular.element(element[0].querySelector(".count")).html("&#8230").removeClass("hidden");else{if(0==totalItems&&0==DvcAdded.length)return!1;angular.element(element[0].querySelector(".count")).text(totalItems).removeClass("hidden")}}}}}cartCounterConstructor.$inject=["$compile","$timeout","cartStorage","toggleService"],angular.module("tmobileCore").directive("cartCounter",cartCounterConstructor)}(window.angular),function(angular,externalLogger){"use strict";function myCartConfig($httpProvider){externalLogger.moduleConfigured("tmobileApp","cart.config.js :: myCartConfig"),$httpProvider.interceptors.push("authInterceptor")}myCartConfig.$inject=["$httpProvider"],angular.module("tmobileApp").config(myCartConfig)}(angular,externalLogger),function(angular){"use strict";function contactFormDataServiceFn($location,$window,httpRequest,universalMenuDataService,apiService){function isB2b(){return service.model.isB2b=$location.host().contains("business.t-mobile.com"),service.model.isB2b}function getContactFormData(){isB2b();if(service.model.isB2b){var getObject=apiService.getURL("contactFormData"),url=getObject.url;httpRequest.authGet(url).then(function(result){service.model.data=result.data})}}var service=this;service.model={data:{},isB2b:""},service.getContactFormData=getContactFormData,service.isB2b=isB2b}contactFormDataServiceFn.$inject=["$location","$window","httpRequest","universalMenuDataService","apiService"],angular.module("tmobileApp").service("contactFormDataService",contactFormDataServiceFn)}(angular),function(angular){"use strict";angular.module("tmobileCore").constant("imeiErrorCode",{"GENERAL-0000":{code:"GENERAL-0000",message:["Backend Connection Error"]},"GENERAL-0001":{code:"GENERAL-0001",message:["Invalid accountType/SubType","Input Data Invalid"]},"TRADEIN-00144":{code:"TRADEIN-00144",message:["Reported lost by a T-Mobile customer"]},"SYSTEM-0001":{code:"SYSTEM-0001",message:["Unknown Backend Error"]},"SYSTEM-0002":{code:"SYSTEM-0002",message:["Backend Timeout"]},"TRADEIN-00101":{code:"TRADEIN-00101",message:["DealerCode is mandatory and it has to be 7 digit numeric value","AccountNumber or AccountType and AccountSubType is mandatory for Account_eligiblity check","AccountNumber or AccountType and AccountSubType, SerialNumber are mandatory for eligibility check ALL"]},"TRADEIN-00102":{code:"TRADEIN-00102",message:["Customers credit class is not supported at this time.","Partner is not eligible to retrieve details for the selected account sub-type.","Invalid Input provided for the device validation","No IMSI found in EIR system for the IMEI provided.","No MSISDN found in HLR system for the IMSI retrieved.","No BAN found in SAMSON for the MSISDN retrieved","No IMSI returned","The IMEI was not found in EIR System","SAP OER System returned an error for the Serial Number.","Blocks not found in SAP OER System.","The IMEI is Non-Tmobile.","SAP OER System returned an error for the Serial Number.","Web service call to subsystem failed.",'Account or device is ""Dynamic reason code from back end e.g. Blocked 35:39 Stolen']},"TRADEIN-00103":{code:"TRADEIN-00103",message:["No data found for requested inputs"]},"TRADEIN-00104":{code:"TRADEIN-00104",message:["Invalid account number."]},"TRADEIN-00131":{code:"TRADEIN-00131",message:["This device is JUMP-Return-Pending and may not be traded-in"]},"TRADEIN-00132":{code:"TRADEIN-00132",message:["This device is Msisdn-Transfer-Pending and may not be traded-in"]},"TRADEIN-00133":{code:"TRADEIN-00133",message:["This is a loan device and may not be traded-in"]},"TRADEIN-00134":{code:"TRADEIN-00134",message:["This device has an open EIP balance which must be paid in order to trade-in the device"]},"TRADEIN-00135":{code:"TRADEIN-00135",message:["Ineligible accountTypeSubType"]},"TRADEIN-00136":{code:"TRADEIN-00136",message:['"Dynamic statusDescription" from getBasicAccountDetailsResponse']},"TRADEIN-00137":{code:"TRADEIN-00137",message:['Advanced Warranty Exchange has happened in last "DYNAMIC" days.']},"TRADEIN-00138":{code:"TRADEIN-00138",message:["Ineligible accountTypeSubType and also Advanced Warranty Exchange has happened in last DYNAMIC days."]},"TRADEIN-00139":{code:"TRADEIN-00139",message:['Ineligible AccountTypeSubType and "DYNAMIC-there should be one of the reasons Blocked/Stolen/Both']},"TRADEIN-00143":{code:"TRADEIN-00143",message:["This is a leased device and may not be traded-in"]}})}(angular),function(angular){"use strict";function unavMenu($compile,$timeout,$cookies,unavMenuService,cartStorage,toggleService){function setSubMenuId(element){var subNavElements=element[0].querySelectorAll(".container > .subnav ");angular.forEach(subNavElements,function(nav,key){var classNames=angular.element(nav).attr("class"),splitClassNames=classNames.split(" ");angular.forEach(splitClassNames,function(className,k){if(className.indexOf("subnav-")>-1){var menuName=className.substring(className.indexOf("subnav-")+7);angular.element(nav).attr("sub-menu-id",menuName);var subMenus2=nav.querySelectorAll(".unstyled.ui-list-2 > li");angular.forEach(subMenus2,function(menu,k1){var subMenu=angular.element(menu);subMenu.attr("sub-menu-id","l"+menuName+"_menu_"+(parseInt(k1)+1))})}})})}function addHiddenToAllSubMenu1(element){var subNavElements=element[0].querySelectorAll(".container > .subnav ");angular.forEach(subNavElements,function(nav,key){angular.element(nav).addClass("hidden")})}function removeRootNavMenutActive(element){var subNavElements=element[0].querySelectorAll(".nav > .primary");removeActiveClass(subNavElements)}function removeActiveClass(subMenus2){angular.forEach(subMenus2,function(subMenu,key){var subNavElement=angular.element(subMenu);subNavElement.removeClass("active")})}function addMouseOverSubmenu2(element){var subMenus2=element[0].querySelectorAll(".unstyled.ui-list-2 > li");removeActiveClass(subMenus2),angular.forEach(subMenus2,function(menu,key){function mouseOutfn(){enteredSubMenu=!1,$timeout(function(){enteredSubMenu||(addHiddenToAllSubMenu1(element),removeRootNavMenutActive(element))},1e3)}var subMenu=angular.element(menu),subMenus3=element[0].querySelector("#"+subMenu.attr("sub-menu-id"));angular.element(subMenus3).bind("mouseout",mouseOutfn),subMenu.bind("mouseout",mouseOutfn),subMenu.bind("mouseover",function(){removeActiveClass(subMenus2);var allSubMenus3=element[0].querySelectorAll(".tab-content > .tab-pane");removeActiveClass(allSubMenus3),enteredSubMenu=!0;var subNavElement=angular.element(subMenu);subNavElement.addClass("active"),angular.element(subMenus3).addClass("active")})})}function showDefaultSubmenu2(rootElement,element){var subMenus2All=rootElement[0].querySelectorAll(".unstyled.ui-list-2 > li");if(removeActiveClass(subMenus2All),element&&0!=element.length){var subMenus2=element[0].querySelector(".unstyled.ui-list-2 > li"),subNavElement=angular.element(subMenus2);subNavElement.addClass("active");var subMenus3=element[0].querySelector("#"+subNavElement.attr("sub-menu-id"));angular.element(subMenus3).addClass("active")}}function addMouseOver(element){if(element){addHiddenToAllSubMenu1(element),setSubMenuId(element),addMouseOverSubmenu2(element);var rootNavMenus=element[0].querySelectorAll(".nav > .primary,.nav > .glyph");angular.forEach(rootNavMenus,function(rootNavMenu,key){function mouseOutfnRootMenu(){enteredSubMenu=!1,$timeout(function(){enteredSubMenu||(subNavElement.addClass("hidden"),rootNavElement.removeClass("active"))},2e3)}var rootNavElement=angular.element(rootNavMenu),navAElement=rootNavElement[0].querySelector("[data-subnav]"),subANav=angular.element(navAElement),subNavName=subANav[0].dataset.subnav;
rootNavElement.attr("menu-id",subNavName);var subNav=element[0].querySelector(".subnav-"+subNavName);subNav&&angular.element(subNav).addClass("hidden"),angular.element(element[0].querySelector(".sub-navbar")).removeClass("hidden"),rootNavElement.bind("mouseover",function(){removeActiveClass(rootNavMenus),rootNavElement.addClass("active"),addHiddenToAllSubMenu1(element),enteredSubMenu=!0,subNavElement.removeClass("hidden");var tempEl=element[0].querySelector('[sub-menu-id="'+rootNavElement.attr("menu-id")+'"]');showDefaultSubmenu2(element,angular.element(tempEl))});var subNavElement=angular.element(subNav);subNavElement.bind("mouseover",function(){enteredSubMenu=!0}),rootNavElement.bind("mouseout",mouseOutfnRootMenu),subNavElement.bind("mouseout",mouseOutfnRootMenu)})}}function renderHtml(html,element,scope){html=html.replace(/data-toggle="tab"/g,""),element.html(html).show(),$compile(element.contents())(scope),addMouseOver(element),$timeout(function(){if(cartStorage.getGlobalSmartCartInfo()){var ItemsAdd=cartStorage.getGlobalSmartCartInfo(),DeviceCount=0,AccCount=0;if(ItemsAdd){var AccAdded=ItemsAdd.accessories.accessoryDetails;angular.forEach(AccAdded,function(value,index){var qty=value.quantity;AccCount+=qty});var DvcAdded=ItemsAdd.lineItems;angular.forEach(DvcAdded,function(value,index){(value.simKitDetails.isBYODAdded||value.lineItemDetails.deviceDetails.isHandset||value.lineItemDetails.deviceDetails.isTablet||value.lineItemDetails.deviceDetails.isWearable)&&(DeviceCount+=1)})}var totalItems=AccCount+DeviceCount;if(0==totalItems&&DvcAdded.length>0)angular.element(element[0].querySelector(".count")).html("&#8230").removeClass("hidden");else{if(0==totalItems&&0==DvcAdded.length)return!1;angular.element(element[0].querySelector(".count")).text(totalItems).removeClass("hidden")}}},3e3),void 0!==$cookies.get("MyTMobile")?($(".login-controls .loggedin").removeClass("hidden"),$(".login-controls .loggedout").addClass("hidden"),$(".login-controls .signup").addClass("hidden")):($(".login-controls .loggedout").removeClass("hidden"),$(".login-controls .signup").removeClass("hidden"),$(".login-controls .loggedin").addClass("hidden"))}var enteredSubMenu=!1,NAV_SECTIONS={header:"HeaderHTML",footer:"FooterHTML"};return{restrict:"EA",replace:!0,link:function(scope,element,attrs){unavMenuService.getUnavMenuData().then(function(menuData){renderHtml(menuData[NAV_SECTIONS[attrs.unavMenu]],element,scope)})}}}unavMenu.$inject=["$compile","$timeout","$cookies","unavMenuService","cartStorage","toggleService"],angular.module("tmobileApp").directive("unavMenu",unavMenu)}(angular),function(angular,lodash){"use strict";function sideBarTileController(analyticsUtils){function fireAnalytics(e){analyticsUtils.trackSideBarClick(e.currentTarget)}var vm=this;vm.onClickNavigationElement=function(data){fireAnalytics(data)}}var sideBarTile={templateUrl:"app/marketing/components/navigation/sideBarTile/sideBarTile.component.tpl.html",controller:sideBarTileController,controllerAs:"vm",bindings:{settings:"<",count:"@",analytics:"@"}};angular.module("marketingCore").component("sideBarTile",sideBarTile)}(angular,_),function(angular){"use strict";function unavMenuService($q,$http,CacheFactory,apiURLs){function getUnavMenuData(){function failed(error){deferred.reject(error),deferred=null}function success(response){200!==response.status?failed(response):deferred.resolve(response.data)}if(!deferred){deferred=$q.defer();var url=window.isB2B?apiURLs.unavMenuDataBusiness:apiURLs.unavMenuData;$http.get(url).then(success,failed)}return deferred.promise}var deferred,svc=this,UNAV_CACHE_NAME="unavCache";CacheFactory.get(UNAV_CACHE_NAME)||CacheFactory.createCache(UNAV_CACHE_NAME,{maxAge:18e5,deleteOnExpire:"aggressive",onExpire:getUnavMenuData,storageMode:"sessionStorage"}),svc.getUnavMenuData=getUnavMenuData}unavMenuService.$inject=["$q","$http","CacheFactory","apiURLs"],angular.module("tmobileApp").service("unavMenuService",unavMenuService)}(angular),function(angular){"use strict";function MixedMediaWrapperController($document,$element,$scope,$log,utils,analyticsUtils){function onInit(params){function initComplete(){}function trackEvent(objID,compClass,instName,timeStamp,eventInfo){var deviceName="iPhone7Plus",eventType=eventInfo.split(",")[0];switch(eventType){case"SWATCH":trackThumbnailClick(deviceName,compClass);break;case"SPIN":trackSpinner(deviceName);break;case"PLAY":trackStartVideo(deviceName)}trackCarouselArrows()}function trackThumbnailClick(deviceName,compClass){analyticsUtils.trackMixedMediaClick(deviceName,compClass)}function trackCarouselArrows(deviceName){var leftArrow=$element[0].querySelector(".s7scrollleftbutton"),rightArrow=$element[0].querySelector(".s7scrollrightbutton");leftArrow&&rightArrow&&(leftArrow.addEventListener("click",trackLeftArrow),rightArrow.addEventListener("click",trackRightArrow))}function trackLeftArrow(event){var deviceName="iPhone7Plus",eventDescription="Left Arrow";analyticsUtils.trackMixedMediaClick(deviceName,eventDescription)}function trackRightArrow(event){var deviceName="iPhone7Plus",eventDescription="Right Arrow";analyticsUtils.trackMixedMediaClick(deviceName,eventDescription)}function trackSpinner(deviceName){var eventDescription="360 image Rotation";analyticsUtils.trackMixedMediaClick(deviceName,eventDescription)}function trackStartVideo(deviceName,eventInfo){analyticsUtils.trackMixedMediaPlayClick(deviceName,eventInfo)}params=params||{},params.handlers={initComplete:initComplete,trackEvent:trackEvent};new s7viewers.MixedMediaViewer(params).init();$scope.$on("sliderDataChangeEvent",function(event,args){})}var vm=this;vm.onInit=onInit}MixedMediaWrapperController.$inject=["$document","$element","$scope","$log","utils","analyticsUtils"],angular.module("marketingCore").controller("MixedMediaWrapperController",MixedMediaWrapperController)}(window.angular),function(angular){"use strict";function accordionConstructor($window){return{restrict:"A",link:function(scope,element,attrs){element.bind("click",function(){if($window.innerWidth<724){var elem=$(this);elem.hasClass("section-expanded")?elem.removeClass("section-expanded"):elem.addClass("section-expanded")}})}}}accordionConstructor.$inject=["$window"],angular.module("tmobileCore").directive("accordion",accordionConstructor)}(window.angular),function(angular,lodash){"use strict";function paymentAndCreditCheckUtilConstructor(creditCardUtil,checkOutModelService,checkOutHttpDataUtil,creditClassService,commonServices,coreServices,checkOutControllerHelperUtil,globalConfig,checkOutConstants,apiService,cartHttpDataService){function stateChanged(){lodash.get(checkOutModelService.model.checkOutInfo,"creditcheck.idType.isMandatoryState")||(checkOutModelService.model.checkOutInfo.creditcheck.state=null)}function errorHandler(error){return commonServices.$log.log("Something went wront: ",error),error}function submitPaymentAndCreditCheck(){var newvalue="20",crName=commonServices.$filter("validate")(checkOutModelService.model.checkOutInfo.cardInfo.creditCardNumber,!0);checkOutModelService.model.checkOutInfo.cardInfo.crType=checkOutControllerHelperUtil.getCreditTypeToSend(crName),checkOutModelService.model.checkOutInfo.cardInfo.expMonth=checkOutModelService.model.checkOutInfo.cardInfo.expiryDate.substring(0,2);var exp=checkOutModelService.model.checkOutInfo.cardInfo.expiryDate.substring(2,4);checkOutModelService.model.checkOutInfo.cardInfo.expYear=newvalue.concat(exp),checkOutModelService.model.checkOutInfo.cardInfo.nameoncard=checkOutModelService.model.checkOutInfo.personalInfo.firstName+" "+checkOutModelService.model.checkOutInfo.personalInfo.lastName,globalConfig.cartSettings.autoPayValue=checkOutModelService.model.checkOutInfo.flags.isAutoPay;var options={ignoreLoadingBar:!1},isOnlyAccessoryFlow=coreServices.commonUtils.searchJson(checkOutModelService.model.checkOutInfo,"reviewCart.flags.isOnlyAccessory"),isNoCreditCheckSelected=angular.equals(creditClassService.getEPCreditClass(),"NONE"),promises={setCreditCardInfoPromise:creditCardUtil.setCreditCardInfo(checkOutModelService.model.checkOutInfo)};return checkOutModelService.model.checkOutInfo.creditcheck.portOutPinCode&&(promises.updateProfilePromise=checkOutHttpDataUtil.updateProfileInfo()),isOnlyAccessoryFlow||(promises.setCreditCheckInfoPromise=creditCardUtil.setCreditCheckInfo(checkOutModelService.model.checkOutInfo)),isNoCreditCheckSelected||(promises.auditRecordsPromise=checkOutHttpDataUtil.createAuditRecords(checkOutModelService.model.checkOutInfo.flags.isAutoPay,checkOutModelService.model.checkOutInfo.flags.isStorePayment)),commonServices.$q.all(promises).then(function(promisesResponse){var creditCardResponse=promisesResponse.setCreditCardInfoPromise,creditCheckResponse=promisesResponse.setCreditCheckInfoPromise,auditRecordsResponse=promisesResponse.auditRecordsPromise,status=angular.equals(200,creditCardResponse.status);return isOnlyAccessoryFlow||(status=status&&angular.equals(checkOutConstants.DONESTATUS,creditCheckResponse)),isNoCreditCheckSelected||(status=auditRecordsResponse?status&&angular.equals(200,auditRecordsResponse.status):!1),status?checkOutHttpDataUtil.loadCheckOutData(options).then(function(cartResponse){angular.equals(checkOutConstants.FAILEDSTATUS,cartResponse.status)?checkOutModelService.model.errors.displayErrorMessage=!0:(coreServices.cartStorage.setGlobalSmartCartInfo(cartResponse.reviewCart),checkOutModelService.model.checkOutInfo.reviewCart=cartResponse.reviewCart,checkOutModelService.model.checkOutInfo.subTotal=cartResponse.subTotal,checkOutModelService.model.checkOutInfo.total=cartResponse.total,checkOutModelService.setSectionToBeDisplayed(checkOutConstants.SECTIONS.REVIEW),checkOutModelService.model.errors.displayErrorMessage=!1)})["catch"](errorHandler):void(checkOutModelService.model.errors.displayErrorMessage=!0)})["catch"](errorHandler)}function _structurePaymentRequestBodyV3(checkOutInfo,billingAddressId,encryptedCardNumber){var cartData=coreServices.cartStorage.getGlobalSmartCartInfo(),orderId=angular.isDefined(cartData)?cartData.orderId:"",cardName=commonServices.$filter("validate")(checkOutInfo.cardInfo.creditCardNumber,!0),typeCode=checkOutControllerHelperUtil.getCreditCardTypeCode(cardName),newValue="20";checkOutInfo.cardInfo.expMonth=checkOutInfo.cardInfo.expiryDate.substring(0,2);var expiryYear=checkOutInfo.cardInfo.expiryDate.substring(2,4);return checkOutInfo.cardInfo.expYear=newValue.concat(expiryYear),{cardHolderFirstName:checkOutInfo.personalInfo.firstName,cardHolderLastName:checkOutInfo.personalInfo.lastName,cardHolderName:checkOutInfo.personalInfo.firstName+" "+checkOutInfo.personalInfo.lastName,maskedCardNumber:encryptedCardNumber,cardTypeIndicator:checkOutConstants.PAYMENT_METHOD,cvv:checkOutInfo.cardInfo.securityCode,expirationMonth:checkOutInfo.cardInfo.expMonth,expirationYear:checkOutInfo.cardInfo.expYear,paymentMethod:checkOutConstants.PAYMENT_METHOD,amount:cartData.payNowPrice.amount,extCartId:orderId,address:{addressType:checkOutConstants.PAYMENT_TEXT,addressId:billingAddressId},billingType:checkOutConstants.BILLING_TYPE,typeCode:typeCode,settlementIndicator:checkOutConstants.SETTLEMENT_INDICATOR,storePayment:checkOutConstants.STOREPAYMENT,isAuthRequired:checkOutConstants.ISAUTHREQUIRED,isFullAuth:checkOutConstants.ISFULLAUTH,customerPresentIndicator:checkOutConstants.CUSTOMER_PRESENT_INDICATOR,fingerprintId:coreServices.cartStorage.getFingerPrintId()}}function getApiUrl(apiName){return apiService.getURL(apiName).url}function setPaymentInfoV3(checkOutInfo,billingAddressId,encryptedCardNumber){var cartId,body,paymentUrl;return cartId=coreServices.cartStorage.getCartId(),paymentUrl=getApiUrl(checkOutConstants.POSTPAYMENT),paymentUrl=paymentUrl.replace("{{cartID}}",cartId),body=_structurePaymentRequestBodyV3(checkOutInfo,billingAddressId,encryptedCardNumber),coreServices.httpRequestWrapper.post(paymentUrl,body,null,null,!0).then(paymentSuccessHandler)}function encryptVerifyIdDetails(publickKey,key,value){encrypt(publickKey,value,function(encryptedRes){checkOutModelService.model.checkOutInfo.verifyId[key]=encryptedRes},function(error){commonServices.$log.log("Something went wrong: ",error)})}function getPublicKey(){var url=getApiUrl(checkOutConstants.GET_PUBLIC_KEY_PAYMENT),header=cartHttpDataService.getEOSApiHeaders();return coreServices.httpRequestWrapper.get(url,null,header,!0,checkOutConstants.GET_PUBLIC_KEY_PAYMENT).then(function(response){if(angular.equals(response.status,200)){var apiResponse=response.data.publicKey;return checkOutModelService.model.checkOutInfo.cardInfo.publicKey=JSON.parse(apiResponse.trim()),response}})["catch"](errorHandler)}function paymentSuccessHandler(response){return 200===response.status?!0:400!==response.status?(checkOutModelService.model.errors.displayErrorMessage=!0,!1):(checkOutModelService.model.checkOutInfo.cardInfo.securityCode="",void checkOutControllerHelperUtil.authCheck().then(authFailModalHandler))}function authFailModalHandler(){return checkOutModelService.model.showExpertBar=!0,!1}return{submitPaymentAndCreditCheck:submitPaymentAndCreditCheck,stateChanged:stateChanged,setPaymentInfoV3:setPaymentInfoV3,getPublicKey:getPublicKey,encryptVerifyIdDetails:encryptVerifyIdDetails}}paymentAndCreditCheckUtilConstructor.$inject=["creditCardUtil","checkOutModelService","checkOutHttpDataUtil","creditClassService","commonServices","coreServices","checkOutControllerHelperUtil","globalConfig","checkOutConstants","apiService","cartHttpDataService"],angular.module("tmobileApp").factory("paymentAndCreditCheckUtil",paymentAndCreditCheckUtilConstructor)}(window.angular,window._),function(angular){"use strict";var universalfootercomponentconstructor={templateUrl:"app/upperFunnel/universalFooter/universalFooter.component.html",controller:"universalFooterController",controllerAs:"vm",bindings:{}};angular.module("tmobileApp").component("universalFooter",universalfootercomponentconstructor)}(angular),function(angular,externalLogger,lodash){"use strict";angular.module("tmobileApp").constant("CHECKOUT_STATE_NAME","checkOut").config(["$stateProvider","LOWER_FUNNEL_ABSTRACT_ROOT_STATE_NAME","CHECKOUT_STATE_NAME",function($stateProvider,LOWER_FUNNEL_ABSTRACT_ROOT_STATE_NAME,CHECKOUT_STATE_NAME){externalLogger.moduleConfigured("tmobileApp","checkOut :: config "+CHECKOUT_STATE_NAME+" route");var checkoutStateConfig={url:"/checkout",parent:LOWER_FUNNEL_ABSTRACT_ROOT_STATE_NAME,data:{title:"Checkout"},views:{content:{templateUrl:"app/checkOut/checkOut.tpl.html",controller:"CheckOutCtrl",controllerAs:"vm"}},resolve:{toggleData:function($log,toggleService){return""===toggleService.model.toggles?toggleService.getToggleFeature().then(function(toggle){return $log.log(" resolve :: toggleService"),toggle}):toggleService.model},keyValues:function($log,keyValuesUtilities){return keyValuesUtilities.getKeyValuePairs().then(function(keyValues){return keyValues?keyValues:void 0},function(){$log.log("Error getting keyValues for checkout.js")})},checkout:function(){}}};$stateProvider.state(CHECKOUT_STATE_NAME,checkoutStateConfig)}]).run(["$rootScope","authorValueService","cartStateChangeService","$q","unoHandOff","checkOutHttpDataUtil","CHECKOUT_STATE_NAME",function($rootScope,authorValueService,cartStateChangeService,$q,unoHandOff,checkOutHttpDataUtil,CHECKOUT_STATE_NAME){$rootScope.$on("$stateChangeStart",function(event,toState,toParams){toState.resolve||(toState.resolve={}),toState.resolve.pauseStateChange=[function(){return authorValueService.workRouterLogic(toState,toParams).then(function(){if(angular.equals(toState.name,CHECKOUT_STATE_NAME)){cartStateChangeService.workRouterLogic(toState,toParams);var defer=$q.defer(),checkoutCookies=unoHandOff.getSharedCookieForCheckout();return checkoutCookies.token&&checkoutCookies.cartId&&checkoutCookies.profileId&&checkoutCookies.creditProfileId?cartStateChangeService.checkOutHandoff("checkOut",checkoutCookies.cartId).then(function(checkoutInfo){checkoutInfo?defer.resolve():checkOutHttpDataUtil.redirectToUnoCart()}):checkOutHttpDataUtil.redirectToUnoCart(),defer.promise}})}]})}])}(window.angular,window.externalLogger,window._),function(angular){"use strict";function universalFooterControllerFunction(universalMenuDataService){var vm=this;vm.universalNavService=universalMenuDataService,vm.isMobileView=universalMenuDataService.isMobileView()}universalFooterControllerFunction.$inject=["universalMenuDataService"],angular.module("tmobileApp").controller("universalFooterController",universalFooterControllerFunction)}(angular),function(angular){"use strict";function serverConfigServiceConstructor(httpRequest){function getServerConfigData(){var url="srvspub/siteMapJsonRetrieval";return httpRequest.get(url)}function postServerConfigData(data){var url="srvspub/toggle";return httpRequest.post(url,data)}return{postServerConfigData:postServerConfigData,getServerConfigData:getServerConfigData}}serverConfigServiceConstructor.$inject=["httpRequest"],angular.module("tmobileApp").service("serverConfigService",serverConfigServiceConstructor)}(angular),function(angular){"use strict";function byodCheckerController(byodCheckerService,analyticsUtils,$window,$anchorScroll,$timeout){function onImeiChange(imei){if(imei){if(!vm.imeiEntered){var analyticsData={name:"BYOD Checker",stage:"start"};analyticsUtils.trackToolWithDynamicContent(analyticsData),vm.imeiEntered=!0}vm.imeiFormModel.disabled=imei.length<15?!0:!1,vm.imeiFormModel.imeiModal=imei,vm.byodChkSuccess=!1,vm.byodChkApiError=!1,vm.byodCheckResModel={}}else vm.imeiFormModel={imeiModal:void 0,disabled:!0}}function toolBlur($event){analyticsUtils.trackTool({type:"Start",name:"Byod Checker",analyticsID:vm.analyticsID})}function setFocus(){$timeout(function(){window.innerWidth<1024?$anchorScroll.yOffset=51:$anchorScroll.yOffset=66,$anchorScroll("imei-results"),angular.element("#imei-results")[0].focus()},100)}function onInit(){$window.onbeforeunload=function(){$window.scrollTo(0,0)}}function submit($event){var analyticsData={name:"BYOD Checker",stage:"complete",dynamicContent:"",ctaName:""},deviceName="NotFound",networkCompatibility="NotFound",deviceEligibility="NotFound";vm.spinner=!0,byodCheckerService.getCompatabilityandEligibilityDetails(vm.imeiFormModel.imeiModal).then(function(response){vm.spinner=!1,null!=response.data&&byodCheckerService.byodCheckerModel.byodCheckSuccess?(vm.byodCheckResModel=response.data[0],vm.byodChkSuccess=byodCheckerService.byodCheckerModel.byodCheckSuccess,vm.byodCheckResModel.MarketingName=null!=vm.byodCheckResModel.MarketingName&&void 0!=vm.byodCheckResModel.MarketingName?vm.byodCheckResModel.MarketingName.split("(")[0]:vm.byodCheckResModel.MarketingName,vm.byodChkApiError=!vm.byodCheckResModel.EligibilityServiceUp&&!vm.byodCheckResModel.CompatibilityServiceUp):(vm.byodChkSuccess=!1,vm.byodChkApiError=!0),vm.setFocus(),vm.byodCheckResModel.MarketingName&&(deviceName=vm.byodCheckResModel.MarketingName),vm.byodCheckResModel.Compatibility&&(networkCompatibility=vm.byodCheckResModel.Compatibility),vm.byodCheckResModel.hasOwnProperty("Blocked")&&!vm.byodCheckResModel.Blocked?deviceEligibility="Not Blocked":vm.byodCheckResModel.hasOwnProperty("Blocked")&&vm.byodCheckResModel.Blocked?deviceEligibility="Blocked":vm.byodCheckResModel.hasOwnProperty("Unlocked")&&vm.byodCheckResModel.Unlocked?deviceEligibility="Not Locked":vm.byodCheckResModel.hasOwnProperty("Unlocked")&&!vm.byodCheckResModel.Unlocked&&(deviceEligibility="Locked"),analyticsData.dynamicContent=deviceName+":"+networkCompatibility+":"+deviceEligibility,analyticsData.ctaName=$event.target.innerText,analyticsUtils.trackToolWithDynamicContent(analyticsData)},function(errorResponse){vm.spinner=!1,vm.byodChkSuccess=!1,vm.byodChkApiError=!0})}function nextStepCTA(redirectURL,$event){var analyticsData={formName:"",ctaName:$event.target.innerText,isActionClick:!1,assetType:"Button",modalName:"",targetUrl:redirectURL};analyticsUtils.trackClickEvent(analyticsData),$window.open(redirectURL,"_blank")}function openByodModal($event){var analyticsData={formName:"",ctaName:$event.target.innerText,isActionClick:!1,assetType:"Link",modalName:""};analyticsUtils.trackClickEvent(analyticsData)}function closeButtonByodModal($event,modalName){var analyticsData={formName:"",ctaName:$event.target.innerText,isActionClick:!1,assetType:"Button",modalName:modalName};analyticsUtils.trackClickEvent(analyticsData)}var vm=this;vm.byodCheckerService=byodCheckerService,vm.submit=submit,vm.onImeiChange=onImeiChange,vm.toolBlur=toolBlur,vm.nextStepCTA=nextStepCTA,vm.openByodModal=openByodModal,vm.closeButtonByodModal=closeButtonByodModal,vm.setFocus=setFocus,vm.onInit=onInit,vm.byodCheckResModel={},vm.spinner=!1,vm.imeiFormModel={imeiModal:void 0,disabled:!0},vm.byodFindIMEImodalHeadline="Find your IMEI number in your phone's settings.",vm.byodTellmemoreHeadline="Key T-Mobile network technology",vm.imeiEntered=!1,vm.onInit()}byodCheckerController.$inject=["byodCheckerService","analyticsUtils","$window","$anchorScroll","$timeout"],angular.module("marketingCore").controller("byodCheckerController",byodCheckerController)}(window.angular),function(angular){"use strict";var usercartcomponentconstructor={templateUrl:"app/upperFunnel/universalMenu/userCart/userCart.component.html",controller:"UserCartController",controllerAs:"vm",bindings:{}};angular.module("tmobileApp").component("userCart",usercartcomponentconstructor)}(angular),function(angular){"use strict";function userCartControllerFunction(universalMenuDataService,cartHttpDataService,$window){function init(){cartHttpDataService.getCart().then(function(response){for(var devices=0,lineItems=response.lineItems,i=1;i<=lineItems.length;i++){var itemDetails=lineItems[i-1].lineItemDetails.deviceDetails,id=itemDetails.id;void 0!=id&&(devices=i)}var accessories=response.accessories.accessoryDetails.length;vm.counter=devices+accessories,(0!=vm.counter||"0"!=vm.counter)&&(vm.isZero=!1),(0==vm.counter||"0"==vm.counter)&&(0!=lineItems.length?angular.element(document.querySelector(".cartZeroVal")).text("…"):angular.element(document.querySelector(".cartZeroVal")).text("")),vm.display=!0})}function initDelay(AEM_ROUTES){"/store-locator"===$window.location.pathname?$window.addEventListener("load",function(){init()}):init()}var vm=this;vm.isZero=!0,vm.isMobileView=universalMenuDataService.isMobileView(),vm.display=!1,initDelay()}userCartControllerFunction.$inject=["universalMenuDataService","cartHttpDataService","$window"],angular.module("tmobileApp").controller("UserCartController",userCartControllerFunction)}(angular),function(angular){"use strict";function universalMenuControllerFunction(universalMenuDataService,$scope,contactFormDataService,commonServices,pdlService,toggleService){function searchSubmit(){var formAction=vm.universalNavService.model.unavData.header.misc.search.href;$window.location.href=formAction+"?q="+$scope.q+"&count=20&do=redesign&i=1&page=1&x1=category&q1=device&mlay=Grid"}function setNavigationClickPDL(element,navType){var targetURL=element.currentTarget.href,icid=element.currentTarget.href.split("icid=")[1],evt={category:navType,subCategory:element.currentTarget.innerText,ctaName:element.currentTarget.innerText,targetUrl:targetURL,icid:icid};pdlService.setUNavClickEvent(evt)}function setNavigationSearchClickPDL(element,navType){var targetURL=vm.universalNavService.model.unavData.header.misc.search.href,icid=targetURL.split("icid=")[1],evt={category:navType,subCategory:"Search",ctaName:"Search",targetUrl:targetURL,icid:icid};pdlService.setUNavClickEvent(evt)}function setNavigationCartClickPDL(element,navType){var targetURL=element.currentTarget.href,icid=element.currentTarget.href.split("icid=")[1],evt={category:navType,subCategory:"cart",ctaName:"cart",targetUrl:targetURL,icid:icid};pdlService.setUNavClickEvent(evt)}function setNavigationLogoClickPDL(element,navType){var targetURL=element.currentTarget.href,icid=element.currentTarget.href.split("icid=")[1],evt={category:navType,subCategory:"Home",ctaName:"Home",targetUrl:targetURL,icid:icid};pdlService.setUNavClickEvent(evt)}function setMenuNavigationClickPDL(element,navType){var evt={category:navType,subCategory:"MENU",ctaName:"MENU",targetUrl:"#"};pdlService.setMenuNavigationClickPDL(evt)}var vm=this;vm.universalNavService=universalMenuDataService,vm.contactFormVal=contactFormDataService,vm.isMobileView=universalMenuDataService.isMobileView(),vm.toggles=toggleService.model.toggles,vm.isOsNav=universalMenuDataService.isOsNav();var $window=commonServices.$window;vm.searchSubmit=searchSubmit,vm.setNavigationClickPDL=setNavigationClickPDL,vm.setMenuNavigationClickPDL=setMenuNavigationClickPDL,vm.setNavigationSearchClickPDL=setNavigationSearchClickPDL,vm.setNavigationCartClickPDL=setNavigationCartClickPDL,vm.setNavigationLogoClickPDL=setNavigationLogoClickPDL}universalMenuControllerFunction.$inject=["universalMenuDataService","$scope","contactFormDataService","commonServices","pdlService","toggleService"],angular.module("tmobileApp").controller("universalMenuController",universalMenuControllerFunction)}(window.angular),function(angular){"use strict";var universalmenucomponentconstructor={templateUrl:"app/upperFunnel/universalMenu/universalMenu.component.html",controller:"universalMenuController",controllerAs:"vm",bindings:{}};angular.module("tmobileApp").component("universalMenu",universalmenucomponentconstructor)}(angular),function(angular,lodash){"use strict";function tradeInDetailsController($scope,marketingHttpRequest,apiURLsV2,$compile,analyticsUtils,$window,$timeout){function loadData(){vm.cacheFlag?_fromCache():_fromDirect()}function _fromDirect(){var data={programType:"DRP"},header={"Content-Type":"application/json",Accept:"application/json"};marketingHttpRequest.authPost(apiURLsV2.tradeInDevices,header,data,!0).then(function(tradeInResponse){lodash.isEmpty(tradeInResponse.data)||(vm.devicesInfo=tradeInResponse.data,getdeviceCarrierList())})}function _fromCache(){marketingHttpRequest.get(apiURLsV2.tradeInCache).then(function(tradeInResponse){lodash.isEmpty(tradeInResponse.data)?_fromDirect():(vm.devicesInfo=tradeInResponse.data,getdeviceCarrierList())})}function getdeviceCarrierList(){vm.deviceCarrierSelection=null,vm.deviceManufacturerSelection=null,vm.deviceModelSelection=null,vm.deviceCarrierList=lodash.uniqBy(lodash.map(vm.devicesInfo.productOfferings,function(value){return{serviceProvider:value.products[0].serviceProvider}}),"serviceProvider")}function checkdeviceCarrierSelection(){vm.deviceCarrierSelection&&vm.deviceCarrierList.find(function(value){return value.serviceProvider.toLowerCase()===vm.deviceCarrierSelection.toLowerCase()})?(vm.deviceCarrierSelectionError=!1,vm.checkList=!1,getManufactureList()):(vm.deviceCarrierSelectionError=!0,vm.deviceManufacturerSelection=null,vm.deviceManufacturerSelectionError=!1,vm.deviceModelSelection=null,vm.deviceModelSelectionError=!1)}function checkdeviceManufacturerSelection(){vm.deviceManufacturerSelection&&vm.deviceManufacturerList.find(function(value){return value.manufacturer.toLowerCase()===vm.deviceManufacturerSelection.toLowerCase()})?(vm.deviceManufacturerSelectionError=!1,vm.checkList=!1,getModelsList()):(vm.deviceManufacturerSelectionError=!0,vm.deviceModelSelection=null,vm.deviceModelSelectionError=!1)}function checkdeviceModelSelection(){if(vm.deviceModelSelection&&vm.deviceModelList.find(function(value){return value.model.toLowerCase()===vm.deviceModelSelection.toLowerCase()})){vm.deviceModelSelectionError=!1,vm.checkList=!1;var selectedItem=lodash.find(vm.devicesInfo.productOfferings,lodash.flow(lodash.property("products"),lodash.partialRight(lodash.some,function(products){return products.serviceProvider.toLowerCase()===vm.deviceCarrierSelection.toLowerCase()&&products.manufacturer.toLowerCase()===vm.deviceManufacturerSelection.toLowerCase()&&products.model.toLowerCase()===vm.deviceModelSelection.toLowerCase()})));selectedItem&&selectedItem.products?(vm.isEnableButton=!1,vm.estimateValue=selectedItem.prices[0].oneTimeCharges[0].amount,$timeout(function(){angular.element(".trade-in-button")[0].focus()},0)):vm.deviceModelSelectionError=!0}else vm.deviceModelSelectionError=!0}function getManufactureList(){vm.deviceManufacturerList=lodash.uniqBy(lodash.map(lodash.filter(vm.devicesInfo.productOfferings,function(device){return lodash.some(device.products,function(products){return products.serviceProvider.toLowerCase()===vm.deviceCarrierSelection.toLowerCase()})}),function(item){return{manufacturer:item.products[0].manufacturer}}),"manufacturer"),vm.deviceManufacturerList.find(function(value){return value.manufacturer===vm.deviceManufacturerSelection})||(vm.deviceManufacturerSelection=null,vm.deviceModelSelection=null,vm.deviceModelList=[])}function getModelsList(){vm.deviceModelList=lodash.uniqBy(lodash.map(lodash.filter(vm.devicesInfo.productOfferings,function(device){return lodash.some(device.products,function(products){return products.serviceProvider.toLowerCase()===vm.deviceCarrierSelection.toLowerCase()&&products.manufacturer.toLowerCase()===vm.deviceManufacturerSelection.toLowerCase()})}),function(item){return{model:item.products[0].model}}),"model"),vm.deviceModelList.find(function(value){return value.model===vm.deviceModelSelection})||(vm.deviceModelSelection=null)}function togglePage(){if(vm.showGetEstimate=!vm.showGetEstimate,vm.isEnableButton=!0,vm.deviceManufacturerList=[],vm.deviceModelList=[],vm.showGetEstimate){var angularElement=angular.element(vm.html),linkFunction=$compile(angularElement),element=linkFunction($scope);if(vm.selectedDeviceinfo=vm.deviceManufacturerSelection+" "+vm.deviceModelSelection,angular.element(".tradein-conditions").append(element),angular.element(".tradein-conditions>ul").length)for(var i=0;i<angular.element(".tradein-conditions>ul>li").length;i++)$(angular.element(".tradein-conditions>ul>li:eq("+i+")")[0]).attr("aria-label",angular.element(".tradein-conditions>ul>li:eq("+i+")")[0].innerText);angular.element(".section-content>h1")[0].style.display="none",angular.element(".section-content>h3")[0].style.display="none",trackFormSubmit(vm.ctaLabel,vm.ctaLabelIcid,"#");var analyticsData={name:vm.toolName,stage:"complete",dynamicContent:"",ctaName:vm.ctaLabel,eventType:"tool"};analyticsData.dynamicContent="$"+vm.estimateValue+":"+vm.deviceCarrierSelection+":"+vm.deviceManufacturerSelection+":"+vm.deviceModelSelection+(0!=vm.estimateValue&&angularElement[0].textContent?":"+angularElement[0].textContent:""),analyticsUtils.trackToolWithDynamicContent(analyticsData)}else trackFormSubmit(vm.back,vm.backIcid,"#"),vm.deviceCarrierSelection=null,vm.deviceManufacturerSelection=null,vm.deviceModelSelection=null,vm.selectedDeviceinfo=null,angular.element(".section-content>h1").length>0?angular.element(".section-content>h1")[0].style.display="":"",angular.element(".section-content>h3").length>0?angular.element(".section-content>h3")[0].style.display="":"",angular.element(".tradein-conditions").length>0&&angular.element(".tradein-conditions>")[0].remove(),angular.element(".tradein-conditions>ol").length>0&&angular.element(".tradein-conditions>ol")[0].remove(),$timeout(function(){angular.element("#deviceCarrier")[0].firstElementChild.focus()},0)}function redirectOnShopNow(){trackFormSubmit(vm.shopNow,vm.shopNowIcid,vm.shopNowUrl),JSON.parse(vm.shopNowWindowTarget)?window.open(vm.shopNowUrl,"_blank"):window.location=vm.shopNowUrl}function toolBlur(type){vm.checkList=!0,checkDevices(type),"serviceProvider"===type&&onFocus("deviceCarrierMsg")}function checkDevices(type){switch(type){case"serviceProvider":checkdeviceCarrierSelection();break;case"manufacturer":checkdeviceManufacturerSelection();break;case"model":checkdeviceModelSelection();break;default:return}}function onFocus(elementId){angular.element("#"+elementId)[0].style.display="none",$timeout(function(){angular.element("#"+elementId)[0].style.display="block"},100)}var vm=this;vm.estimateValue=0,vm.showGetEstimate=!1,vm.deviceCarrierSelection=null,vm.deviceCarrierSelectionError=!1,
vm.deviceManufacturerSelection=null,vm.deviceManufacturerSelectionError=!1,vm.deviceModelSelection=null,vm.deviceModelSelectionError=!1,vm.isEnableButton=!0,vm.checkList=!1,vm.deviceCarrierList=[],vm.deviceManufacturerList=[],vm.deviceModelList=[],vm.devicesInfo={},vm.html=vm.estimateTerms,vm.showShopNowBtn=vm.showShopNowBtn,vm.selectedDeviceinfo=null,vm.analyticsID=vm.parentAnalyticsId,vm.toolName="Trade-in Estimator",vm.isIE=$window?$window.navigator.userAgent.indexOf("MSIE ")>-1||$window.navigator.userAgent.indexOf("Trident/")>-1:!1;var trackToolWithDynamicContent=function(){if($window.digitalData&&$window.digitalData.events&&!$window.digitalData.events.some(function(e){return e.tool?e.tool.name===vm.toolName&&"start"===e.tool.stage:void 0})){var analyticsData={name:vm.toolName,stage:"start",dynamicContent:"",eventType:"tool"};analyticsUtils.trackToolWithDynamicContent(analyticsData)}},trackFormSubmit=function(ctaLabelText,ctaIcid,targetUrl){var analyticsData={eventType:"clickToAction",assetType:"button",analyticsID:vm.analyticsID,submitText:ctaLabelText,targetUrl:targetUrl,icid:ctaIcid,toolName:vm.toolName,ModuleName:vm.analyticsID};analyticsUtils.trackFormSubmit(analyticsData)};loadData(),$scope.$watch("vm.deviceCarrierSelection",function(newValue){vm.deviceCarrierSelectionError=!1,vm.deviceModelSelectionError=!1,vm.deviceManufacturerSelectionError=!1,vm.deviceManufacturerSelection=null,vm.deviceModelSelection=null,vm.deviceManufacturerList=[],vm.deviceModelList=[],vm.checkList&&(checkdeviceCarrierSelection(),trackToolWithDynamicContent())}),$scope.$watch("vm.deviceManufacturerSelection",function(newValue){vm.deviceModelSelection=null,vm.deviceModelSelectionError=!1,vm.deviceManufacturerSelectionError=!1,vm.deviceModelList=[],vm.checkList&&(checkdeviceManufacturerSelection(),trackToolWithDynamicContent())}),$scope.$watch("vm.deviceModelSelection",function(){vm.deviceModelSelectionError=!1,vm.deviceCarrierSelection&&vm.deviceManufacturerSelection&&vm.deviceModelSelection&&vm.checkList&&(checkdeviceModelSelection(),trackToolWithDynamicContent())}),vm.keySelect=function($event,type){vm.checkList=!1,vm.isEnableButton=!0;var keyCode=$event.which||$event.keyCode;if(13===keyCode){var dropdownActive=$event.currentTarget.nextElementSibling.querySelector(".active").innerText;angular.element($event.currentTarget.nextElementSibling).removeClass("open"),vm.checkList=!0,"serviceProvider"===type?vm.deviceCarrierSelection=dropdownActive:"manufacturer"===type?vm.deviceManufacturerSelection=dropdownActive:vm.deviceModelSelection=dropdownActive,$event.currentTarget.setAttribute("aria-expanded",!1),$event.currentTarget.setAttribute("aria-activedescendant","")}},vm.keysActions=function($event,type){$event.currentTarget.setAttribute("aria-expanded",!0);var element=$event.currentTarget.nextElementSibling;if(!element||38!==$event.keyCode&&40!==$event.keyCode)9===$event.keyCode&&checkDevices(type),vm.isEnableButton=!0;else{var index=Number($event.currentTarget.nextElementSibling.querySelector(".active").getAttribute("index")),listLenght=$event.currentTarget.nextElementSibling.querySelector("ul").getElementsByTagName("li").length-1;38===$event.keyCode?0===index?index=listLenght:index===listLenght?index--:index--:40===$event.keyCode&&(index===listLenght?index=0:index>=0&&index++);for(var els=$event.currentTarget.nextElementSibling.querySelectorAll("li.active"),i=0;i<els.length;i++)els[i].classList.remove("active");element.querySelector("#"+type+"-"+index).classList.add("active"),$event.currentTarget.setAttribute("aria-activedescendant",type+"-"+index)}},vm.redirectOnShopNow=redirectOnShopNow,vm.togglePage=togglePage,vm.toolBlur=toolBlur,vm._fromCache=_fromCache,vm.loadData=loadData,vm.checkdeviceModelSelection=checkdeviceModelSelection,vm.onFocus=onFocus}tradeInDetailsController.$inject=["$scope","marketingHttpRequest","apiURLsV2","$compile","analyticsUtils","$window","$timeout"],angular.module("marketingCore").controller("tradeInDetailsController",tradeInDetailsController)}(window.angular,window._),function(angular){"use strict";function resultsComponentController($timeout){function handleMultipleDiscountedRates(discountedRates){var overrideRegex=/override(\w+)ratedescription/gi;_.forEach(discountedRates,function(rate){var currentVoiceRate={},currentTextRate={},currentDataRate={};_.forEach(rate,function(value,key){value.length>0&&("voicerate"===key.toLowerCase()?(currentVoiceRate=_.merge(currentVoiceRate,validateRate(value[0])),vm.unlimitedVoiceRate||(vm.unlimitedVoiceRate=0===value[0].rate&&-1===value[0].allowance)):"datarate"===key.toLowerCase()?(currentDataRate=_.merge(currentDataRate,validateRate(value[0])),vm.unlimitedDataRate||(vm.unlimitedDataRate=0===value[0].rate&&-1===value[0].allowance)):"textrate"===key.toLowerCase()?(currentTextRate=_.merge(currentTextRate,validateRate(value[0])),vm.unlimitedTextRate||(vm.unlimitedTextRate=0===value[0].rate&&-1===value[0].allowance)):null!=key.match(overrideRegex)&&(key.toLowerCase().indexOf("voice")>-1?currentVoiceRate.overrideDescription=value:key.toLowerCase().indexOf("data")>-1?currentDataRate.overrideDescription=value:key.toLowerCase().indexOf("text")>-1&&(currentTextRate.overrideDescription=value)))}),Object.keys(currentVoiceRate).length>0&&vm.discountedVoiceRate.push(currentVoiceRate),Object.keys(currentDataRate).length>0&&vm.discountedDataRate.push(currentDataRate),Object.keys(currentTextRate).length>0&&vm.discountedTextRate.push(currentTextRate)})}function validateRate(rateObject){return rateObject&&rateObject.rate&&(rateObject.rate=parseFloat(rateObject.rate).toFixed(2)),rateObject}function getCoverageMapCodes(wirelessNetworks){for(var coverageMapCodes={isoCode:vm.planData.result.region.isoCode,MapCodes:{Net1:"",Net2:"",dataAvailableNet1:!1,dataAvailableNet2:!1}},mapCodes={net1:[],net2:[]},i=0;i<wirelessNetworks.length;i++)if("active"===wirelessNetworks[i].status.toLowerCase())for(var wirelessNetworkTechnologies=wirelessNetworks[i].wirelessNetworkTechnologies,j=0;j<wirelessNetworkTechnologies.length;j++)if(wirelessNetworkTechnologies[j].mapCodes)switch(wirelessNetworkTechnologies[j].name){case"GSM":case"GPRS/EDGE":coverageMapCodes.MapCodes.dataAvailableNet1||(coverageMapCodes.MapCodes.dataAvailableNet1=-1!==wirelessNetworkTechnologies[j].services.indexOf("Data"));for(var mCodes=wirelessNetworkTechnologies[j].mapCodes,x=0;x<mCodes.length;x++)mCodes[x]&&-1===mapCodes.net1.indexOf(mCodes[x])&&mapCodes.net1.push(mCodes[x]);break;case"UMTS":case"LTE":coverageMapCodes.MapCodes.dataAvailableNet2||(coverageMapCodes.MapCodes.dataAvailableNet2=-1!==wirelessNetworkTechnologies[j].services.indexOf("Data"));for(var mCodes=wirelessNetworkTechnologies[j].mapCodes,x=0;x<mCodes.length;x++)mCodes[x]&&-1===mapCodes.net2.indexOf(mCodes[x])&&mapCodes.net2.push(mCodes[x])}return coverageMapCodes.MapCodes.Net1=mapCodes.net1.toString(),coverageMapCodes.MapCodes.Net2=mapCodes.net2.toString(),coverageMapCodes}var vm=this;vm.rates={},vm.defaultRates={},vm.discountedRates={},vm.defaultDataRate={},vm.defaultTextRate={},vm.defaultVoiceRate={},vm.discountedDataRate=[],vm.discountedTextRate=[],vm.discountedVoiceRate=[],vm.regionName="",vm.callingCode="",vm.isDefaultRatesExists=!1,vm.isDiscountedRatesExists=!1,vm.unlimitedDataRate=!1,vm.unlimitedTextRate=!1,vm.unlimitedVoiceRate=!1,vm.$onChanges=function(changes){if(vm.toggleFeature){if(vm.clearRates(),vm.planData&&vm.planData.result&&vm.planData.result.region&&vm.planData.result.region.roaming){vm.regionName=vm.planData.result.region.regionName,vm.callingCode=vm.planData.result.region.callingCode,vm.defaultRates=angular.fromJson(vm.planData.result.region.roaming.defaultRate),_.isEmpty(vm.defaultRates)||(vm.defaultDataRate=vm.defaultRates.dataRate&&vm.defaultRates.dataRate.length>0?validateRate(vm.defaultRates.dataRate[0]):{},vm.defaultTextRate=vm.defaultRates.textRate&&vm.defaultRates.textRate.length>0?validateRate(vm.defaultRates.textRate[0]):{},vm.defaultVoiceRate=vm.defaultRates.voiceRate&&vm.defaultRates.voiceRate.length>0?validateRate(vm.defaultRates.voiceRate[0]):{},vm.isDefaultRatesExists=0!==Object.keys(vm.defaultDataRate).length||0!==Object.keys(vm.defaultTextRate).length||0!==Object.keys(vm.defaultVoiceRate).length),vm.discountedRates=vm.planData.result.region.roaming.discountedRates&&vm.planData.result.region.roaming.discountedRates.length>0?angular.fromJson(vm.planData.result.region.roaming.discountedRates):{},_.isEmpty(vm.discountedRates)||(vm.discountedRates.length>1?(handleMultipleDiscountedRates(vm.discountedRates),vm.isDiscountedRatesExists=0!==vm.discountedDataRate.length||0!==vm.discountedTextRate.length||0!==vm.discountedVoiceRate.length):(vm.discountedRates[0].dataRate&&vm.discountedRates[0].dataRate.length>0&&(vm.discountedDataRate=[validateRate(vm.discountedRates[0].dataRate[0])],vm.unlimitedDataRate=0===vm.discountedDataRate[0].rate&&-1===vm.discountedDataRate[0].allowance),vm.discountedRates[0].textRate&&vm.discountedRates[0].textRate.length>0&&(vm.discountedTextRate=[validateRate(vm.discountedRates[0].textRate[0])],vm.unlimitedTextRate=0===vm.discountedTextRate[0].rate&&-1===vm.discountedTextRate[0].allowance),vm.discountedRates[0].voiceRate&&vm.discountedRates[0].voiceRate.length>0&&(vm.discountedVoiceRate=[validateRate(vm.discountedRates[0].voiceRate[0])],vm.unlimitedVoiceRate=0===vm.discountedVoiceRate[0].rate&&-1===vm.discountedVoiceRate[0].allowance),vm.isDiscountedRatesExists=vm.discountedDataRate.length>0&&0!==Object.keys(vm.discountedDataRate[0]).length||vm.discountedTextRate.length>0&&0!==Object.keys(vm.discountedTextRate[0]).length||vm.discountedVoiceRate.length>0&&0!==Object.keys(vm.discountedVoiceRate[0]).length));var wirelessNetworksList=vm.planData.result.region.wirelessNetworks&&vm.planData.result.region.wirelessNetworks.length>0?vm.planData.result.region.wirelessNetworks:[];if(wirelessNetworksList.length>0){var coverageMapCodes=getCoverageMapCodes(wirelessNetworksList);vm.mapPlanData=angular.copy(coverageMapCodes)}}}else vm.rates=null,vm.planData&&vm.planData.result&&vm.planData.result[0]&&($timeout(function(){vm.rates=angular.fromJson(vm.planData.result[0].Rates)}),vm.mapPlanData=angular.copy(vm.planData)),vm.planData.result&&!vm.planData.result[0]&&$timeout(function(){vm.rates={}},1);changes.moduleId&&vm.moduleId&&(vm.templateUrl=vm.moduleId+(vm.toggleFeature?"/common/newresults.html":"/common/results.html"))},vm.$onInit=function(){vm.templateUrl=vm.moduleId+(vm.toggleFeature?"/common/newresults.html":"/common/results.html")},vm.handleMultipleDiscountedRates=handleMultipleDiscountedRates,vm.clearRates=function(){vm.isDefaultRatesExists=!1,vm.isDiscountedRatesExists=!1,vm.defaultRates={},vm.discountedRates={},vm.defaultDataRate={},vm.defaultTextRate={},vm.defaultVoiceRate={},vm.discountedDataRate=[],vm.discountedTextRate=[],vm.discountedVoiceRate=[],vm.regionName="",vm.mapPlanData="",vm.unlimitedDataRate=!1,vm.unlimitedTextRate=!1,vm.unlimitedVoiceRate=!1}}var travelResultsComponent={template:'<div ng-include="$ctrl.templateUrl"> </div>',controller:resultsComponentController,bindings:{moduleId:"@",planData:"<",toggleFeature:"<"}};angular.module("marketingCore").component("travelResults",travelResultsComponent)}(window.angular),function(angular){"use strict";function deviceProtectionAndServicesConstructor(cartStorage,creditClassService,apiURLs,apiService,apiZoomLevel,httpRequestWrapper,cartHttpWrapper,toggleService){function generateUrl(urlKey,lineId){var urlObject=apiService.getURL(urlKey),apiURL=urlObject.url;return apiURL=apiURL.replace("{{cartID}}",cartStorage.getCartId()),apiURL=apiURL.replace("{{lineID}}",lineId)}function _generateQuery(){var query={},zipCode=cartStorage.getZipCode()||cartStorage.getRecommendedZipCode()||98006;return 3===apiService.getVersion()?query["zip-code"]=zipCode:(query.zipCode=zipCode,query.creditLevel=creditClassService.getEPCreditClass()||"GOOD"),query}function getServices(lineId,queryData){var apiURL=generateUrl("getServices",lineId),query=_generateQuery();return queryData&&(query.ignoreLoadingBar=queryData.ignoreLoadingBar),httpRequestWrapper.get(apiURL,query,null,!0,"getServices")}function bundleServices(lineId,sku,queryData){var urlObject=apiService.getURL("bundleService"),apiURL=urlObject.url,header={};apiURL=apiURL.replace("{{cartID}}",cartStorage.getCartId()),apiURL=apiURL.replace("{{lineID}}",lineId);var query=_generateQuery();queryData&&(query.ignoreLoadingBar=queryData.ignoreLoadingBar);var apiVersion=toggleService.model.toggles.apiVersion2,body={};return header.follow="TRUE",sku&&(apiVersion?body.itemId=sku:body.sku=sku,body.id=cartStorage.getSelectedServiceId(lineId)),angular.isUndefined(body.id)&&(body.id=cartStorage.getServiceId(lineId)),apiVersion?httpRequestWrapper.post(apiURL,body,query,header,!0,"bundleService"):httpRequestWrapper.post(apiURL,body,query,null,!0,"bundleService")}function addServicesToLine(lineId,queryData,body){var urlObject=apiService.getURL("addServiceToLine"),apiURL=urlObject.url,header={};3!==urlObject.version&&(body={id:cartStorage.getServiceId(lineId)}),apiURL=apiURL.replace("{{cartID}}",cartStorage.getCartId()),apiURL=apiURL.replace("{{lineID}}",lineId);var apiVersion=toggleService.model.toggles.apiVersion2,isDcpV3ApiEnabled=toggleService.model.toggles.isDcpV3ApiEnabled;if(apiVersion||isDcpV3ApiEnabled)return header.follow="TRUE",cartHttpWrapper.post(apiURL,body,null,"addServicesToLine","addServiceToLine",header);apiURL=generateUrl("addServiceToLine",lineId);var query=_generateQuery();return queryData&&(query.ignoreLoadingBar=queryData.ignoreLoadingBar),cartHttpWrapper.post(apiURL,body,query,"addServicesToLine","addServiceToLine")}function initSelectedServices(){return{addServices:{offerIds:[]},removeServices:{offerIds:[]},removeExistingServices:{offerIds:[]}}}function getDataToUpdateServicesInLineV3(availableServices,selectedLine){var selectedServices=initSelectedServices(),cartServicesUpc=[];return selectedLine.lineItemDetails.serviceDetails&&selectedLine.lineItemDetails.serviceDetails.length>0&&angular.forEach(selectedLine.lineItemDetails.serviceDetails,function(service){cartServicesUpc.push(service.upc)}),angular.forEach(availableServices,function(selectedPlan){var selectedPlanIndex=cartServicesUpc.indexOf(selectedPlan.code);selectedPlan.selected&&0>selectedPlanIndex&&!selectedPlan.isDataSoc?selectedServices.addServices.offerIds.push(selectedPlan.code):!selectedPlan.selected&&selectedPlanIndex>=0&&!selectedPlan.isDataSoc&&selectedServices.removeServices.offerIds.push(selectedPlan.code)}),selectedServices}return{getServices:getServices,bundleServices:bundleServices,addServicesToLine:addServicesToLine,initSelectedServices:initSelectedServices,getDataToUpdateServicesInLineV3:getDataToUpdateServicesInLineV3}}deviceProtectionAndServicesConstructor.$inject=["cartStorage","creditClassService","apiURLs","apiService","apiZoomLevel","httpRequestWrapper","cartHttpWrapper","toggleService"],angular.module("tmobileApp").service("deviceProtectionAndServicesHttpData",deviceProtectionAndServicesConstructor)}(angular),function(angular){"use strict";function onlyNumberInputFn($browser){return{require:"ngModel",link:function($scope,$element,$attrs,ngModelCtrl){function inputChangeListener(){var cursorPos=$element[0].selectionStart,value=$element.val().replace(/[^0-9]/g,"");$element.val(value),$element[0].setSelectionRange(cursorPos,cursorPos)}function keyDownListener(event){var key=event.keyCode;if(!(13===key||9===key||46===key||91===key||key>15&&19>key||key>=35&&40>=key))return event.ctrlKey===!0&&65===key?!0:void $browser.defer(inputChangeListener)}function pasteCutListener(){$browser.defer(inputChangeListener)}function renderFromModel(){$element.val(ngModelCtrl.$viewValue,!1)}function integerInputParser(inputValue){if(!inputValue)return"";var cleanInputValue=inputValue.replace(/[^0-9]/g,"");return cleanInputValue!==inputValue&&(ngModelCtrl.$setViewValue(cleanInputValue),ngModelCtrl.$render()),cleanInputValue}ngModelCtrl.$parsers.push(integerInputParser),ngModelCtrl.$render=renderFromModel,$element.bind("change",inputChangeListener),$element.bind("keydown",keyDownListener),$element.bind("paste cut",pasteCutListener)}}}onlyNumberInputFn.$inject=["$browser"],angular.module("marketingCore").directive("onlyNumberInput",onlyNumberInputFn)}(angular);